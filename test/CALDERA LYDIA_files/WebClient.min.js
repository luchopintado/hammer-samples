var __rest = this && this.__rest || function (e, t) { var n = {}; for (var s in e) if (Object.prototype.hasOwnProperty.call(e, s) && t.indexOf(s) < 0) n[s] = e[s]; if (e != null && typeof Object.getOwnPropertySymbols === "function") for (var a = 0, s = Object.getOwnPropertySymbols(e); a < s.length; a++) { if (t.indexOf(s[a]) < 0 && Object.prototype.propertyIsEnumerable.call(e, s[a])) n[s[a]] = e[s[a]] } return n }; var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class MessageBox { constructor(t, n, s, a) { const { div: r } = e.DOMUtils; this.Background = r({ className: "BackgroundMessageBox", style: { display: "none" }, children: [this.Element = r({ className: "MessageBox", style: { display: "none" }, children: [r({ className: "margin", children: [this.TextMessageBox = r({ className: "textMessageBox", innerHTML: t }), r({ className: "containerButtonsMessageBox", children: n.map(this.buildButton.bind(this)) })] })] })] }); if (s) { this.WidthContainer = s; this.Element.style.width = `${this.WidthContainer}px` } if (a) { this.HeightContainer = a; this.Element.style.height = `${this.HeightContainer}px` } document.body.appendChild(this.Background) } Show() { this.Background.style.display = "block"; this.Element.style.display = "block" } Hide() { this.Background.style.display = "none"; this.Element.style.display = "none"; e.DOMUtils.RemoveItem(this.Background) } buildButton(t) { return e.DOMUtils.button({ type: "button", id: t.Id, name: t.Name, innerHTML: t.Text, className: t.ClassNames ? t.ClassNames.join(" ") : "", onclick: e => { t.Action(e); this.Hide() } }) } } e.MessageBox = MessageBox })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class ButtonArrange { constructor(e, t, n, s) { this.parent = e; this.size = t; this.callback = s; this.loadSvg(n); this.parent.appendChild(this.svgElement) } loadSvg(t) { const n = document.createElement("div"); n.innerHTML = t; const s = n.firstElementChild; if (typeof this.size === "object") { s.setAttribute("width", this.size["width"].toString()); s.setAttribute("height", this.size["height"].toString()) } else { s.setAttribute("width", this.size.toString()); s.setAttribute("height", this.size.toString()) } this.svgElement = s; this.svgElement.querySelectorAll(".button").forEach((t => { t.style.cursor = "pointer"; t.addEventListener("mousedown", (() => { t.classList.add("pressed"); this.callback(t); setTimeout((() => { var n = setInterval((() => { try { if (e.DOMUtils.HasClass(t, "pressed")) this.callback(t) } catch (e) { t.classList.remove("pressed"); clearInterval(n) } finally { if (!e.DOMUtils.HasClass(t, "pressed")) clearInterval(n) } }), 100) }), 300) })); t.addEventListener("mouseup", (() => { t.classList.remove("pressed") })); t.addEventListener("mouseleave", (() => { t.classList.remove("pressed") })) })) } } e.ButtonArrange = ButtonArrange })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["Basic"] = 0] = "Basic"; e[e["Extended"] = 1] = "Extended" })(t = e.EAdjustViewMode || (e.EAdjustViewMode = {})); class AdjustControl extends e.ButtonArrange { constructor(e, n, s, a = t.Extended) { var r; if (a === t.Basic) { r = `<?xml version="1.0" encoding="UTF-8"?>\n                <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n                <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="222mm" height="222mm" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 7481 7481" xmlns:xlink="http://www.w3.org/1999/xlink">\n                    <defs>\n                    <style type="text/css">\n                        <![CDATA[\n                        .fil1 {fill:white}\n                        .button-fill {fill:#34b0f0;transition:fill 0.2s}\n                        .button.pressed .button-fill {fill:#007EBD}\n                        ]]>\n                    </style>\n                    </defs>\n                    <g id="adjustcontrol">\n                        <g class="button" data-control="rotate-cw">\n                            <path class="button-fill"  d="M 3690,2058 C 3690,2058 3690,5423 3690,5423 2784,5396 2057,4653 2057,3740 2057,2828 2784,2085 3690,2058 3690,2058 3690,2058 3690,2058 Z" />\t \n                            <path class="fil1"  d="M 3136,4559 C 3136,4559 3218,4237 3218,4237 3218,4237 3300,3915 3300,3915 3300,3915 2975,4044 2975,4044 2852,3731 2874,3397 3010,3119 3010,3119 2935,3082 2935,3082 2789,3381 2765,3739 2897,4074 2897,4074 2576,4201 2576,4201 2576,4201 2856,4380 2856,4380 2856,4380 3136,4559 3136,4559 3136,4559 3136,4559 3136,4559 Z" />\n                        </g>\n                        <g class="button" data-control="rotate-ccw">\n                            <path class="button-fill" d="M 3791,5423 C 3791,5423 3791,2058 3791,2058 4697,2085 5424,2828 5424,3740 \t5424,4653 4697,5396 3791,5423 Z" />\n                            <path class="fil1" d="M 4292,4559 C 4292,4559 4210,4237 4210,4237 4210,4237 4128,3915 4128,3915 4128,3915 4453,4044 4453,4044 4576,3731 4554,3397 4418,3119 4418,3119 4493,3082 4493,3082 4639,3381 4663,3739 4531,4074 4531,4074 4852,4201 4852,4201 4852,4201 4572,4380 4572,4380 4572,4380 4292,4559 4292,4559 4292,4559 4292,4559 4292,4559 Z" />\n                        </g>\n                        <g class="button" data-control="left-up">\n                            <path class="button-fill" d="M 2332,0.00 C 2332,0.00 505,0.00 505,0.00 227,0.00 0.00,227 0.00,505 0.00,505 0.00,2332 0.00,2332 0.00,2332 2332,-0.00 2332,-0.00 2332,-0.00 2332,0.00 2332,0.00 Z" />\n                            <path class="fil1" d="M 351,346 C 351,346 735,337 735,337 735,337 1120,328 1120,328 1120,328 727,722 727,722 727,722 334,1115 334,1115 334,1115 342,730 342,730 342,730 351,346 351,346 Z" />\n                        </g>\n                        <g class="button" data-control="up-right">\n                            <path class="button-fill" d="M 7482,2332 C 7482,2332 7482,505 7482,505 7482,227 7254,0.00 6976,0.00 6976,0.00 5149,0.00 5149,0.00 5149,0.00 7482,2332 7482,2332 7482,2332 7482,2332 7482,2332 Z" />\n                            <path class="fil1" d="M 7135,351 C 7135,351 7144,735 7144,735 7144,735 7153,1120 7153,1120 7153,1120 6759,727 6759,727 6759,727 6366,334 6366,334 6366,334 6751,342 6751,342 6751,342 7135,351 7135,351 Z" />\n                        </g>\n                        <g class="button" data-control="down-right">\n                            <path class="button-fill" d="M 5149,7482 C 5149,7482 6976,7482 6976,7482 7254,7482 7482,7254 7482,6976 7482,6976 7482,5149 7482,5149 7482,5149 5149,7482 5149,7482 5149,7482 5149,7482 5149,7482 Z" />\n                            <path class="fil1" d="M 7130,7135 C 7130,7135 6746,7144 6746,7144 6746,7144 6361,7153 6361,7153 6361,7153 6754,6759 6754,6759 6754,6759 7147,6366 7147,6366 7147,6366 7139,6751 7139,6751 7139,6751 7130,7135 7130,7135 Z" />\n                        </g>\n                        <g class="button" data-control="down-left">\n                            <path class="button-fill" d="M 0.00,5149 C 0.00,5149 0.00,6976 0.00,6976 0.00,7254 227,7482 505,7482 505,7482 2332,7482 2332,7482 2332,7482 -0.00,5149 -0.00,5149 -0.00,5149 -0.00,5149 -0.00,5149 -0.00,5149 0.00,5149 0.00,5149 Z" />\n                            <path class="fil1" d="M 346,7130 C 346,7130 337,6746 337,6746 337,6746 328,6361 328,6361 328,6361 722,6754 722,6754 722,6754 1115,7147 1115,7147 1115,7147 730,7139 730,7139 730,7139 346,7130 346,7130 Z" />\n                        </g>\n                        <g class="button" data-control="up">\n                            <path class="button-fill" d="M 5048,0.00 C 5048,0.00 2433,0.00 2433,0.00 2433,0.00 1255,1178 1255,1178 1255,1178 2518,2441 2518,2441 2837,2140 3267,1956 3741,1956 4216,1956 4649,2142 4969,2446 4969,2446 6231,1183 6231,1183 6231,1183 5048,-0.00 5048,-0.00 5048,-0.00 5048,0.00 5048,0.00 Z" />\n                            <path class="fil1" d="M 3744,522 C 3744,522 4022,787 4022,787 4022,787 4300,1053 4300,1053 4300,1053 3744,1053 3744,1053 3744,1053 3188,1053 3188,1053 3188,1053 3466,787 3466,787 \t3466,787 3744,522 3744,522 Z" />\n                        </g>\n                        <g class="button" data-control="right">\n                            <path class="button-fill" d="M 7482,5048 C 7482,5048 7482,2433 7482,2433 7482,2433 6303,1255 6303,1255 6303,1255 5040,2518 5040,2518 5341,2837 5525,3267 5525,3741 5525,4216 5339,4649 5035,4969 5035,4969 6298,6231 6298,6231 6298,6231 7482,5048 7482,5048 7482,5048 7482,5048 7482,5048 Z" />\n                            <path class="fil1" d="M 6959,3744 C 6959,3744 6694,4022 6694,4022 6694,4022 6428,4300 6428,4300 6428,4300 6428,3744 6428,3744 6428,3744 6428,3188 6428,3188 6428,3188 6694,3466 6694,3466 6694,3466 6959,3744 6959,3744 Z" />\n                        </g>\n                        <g class="button" data-control="down">\n                            <path class="button-fill" d="M 2433,7482 C 2433,7482 5048,7482 5048,7482 5048,7482 6226,6303 6226,6303 6226,6303 4963,5040 4963,5040 4644,5341 4214,5525 3740,5525 3265,5525 2832,5339 2512,5035 2512,5035 1250,6298 1250,6298 1250,6298 2433,7482 2433,7482 2433,7482 2433,7482 2433,7482 Z" />\n                            <path class="fil1" d="M 3737,6959 C 3737,6959 3459,6694 3459,6694 3459,6694 3181,6428 3181,6428 3181,6428 3737,6428 3737,6428 3737,6428 4293,6428 4293,6428 4293,6428 4015,6694 4015,6694 4015,6694 3737,6959 3737,6959 Z" />\n                        </g>\n                        <g class="button" data-control="left">\n                            <path class="button-fill" d="M 0.00,5048 C 0.00,5048 1178,6226 1178,6226 1178,6226 2441,4963 2441,4963 2140,4644 1956,4214 1956,3740 1956,3265 2142,2832 2446,2512 2446,2512 1183,1250 1183,1250 1183,1250 -0.00,2433 -0.00,2433 -0.00,2433 -0.00,5048 -0.00,5048 -0.00,5048 -0.00,5048 -0.00,5048 -0.00,5048 0.00,5048 0.00,5048 Z" />\n                            <path class="fil1" d="M 522,3737 C 522,3737 787,3459 787,3459 787,3459 1053,3181 1053,3181 1053,3181 1053,3737 1053,3737 1053,3737 1053,4293 1053,4293 1053,4293 787,4015 787,4015 787,4015 522,3737 522,3737 Z" />\n                        </g>\n                    </g>\n                </svg>` } else if (a === t.Extended) { r = `<?xml version="1.0" encoding="UTF-8"?>\n                <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n                <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="222mm" height="269mm" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 7481 9100.8153" xmlns:xlink="http://www.w3.org/1999/xlink">\n                    <defs>\n                    <style type="text/css">\n                        <![CDATA[\n                        .fil1 {fill:white}\n                        .button-fill {fill:#34b0f0;transition:fill 0.2s}\n                        .button.pressed .button-fill {fill:#007EBD}\n                        ]]>\n                    </style>\n                    </defs>\n                    <g id="adjustcontrol">\n                        <g class="button" data-control="rotate-cw">\n                            <path class="button-fill"  d="M 3690,2058 C 3690,2058 3690,5423 3690,5423 2784,5396 2057,4653 2057,3740 2057,2828 2784,2085 3690,2058 3690,2058 3690,2058 3690,2058 Z" />\t \n                            <path class="fil1"  d="M 3136,4559 C 3136,4559 3218,4237 3218,4237 3218,4237 3300,3915 3300,3915 3300,3915 2975,4044 2975,4044 2852,3731 2874,3397 3010,3119 3010,3119 2935,3082 2935,3082 2789,3381 2765,3739 2897,4074 2897,4074 2576,4201 2576,4201 2576,4201 2856,4380 2856,4380 2856,4380 3136,4559 3136,4559 3136,4559 3136,4559 3136,4559 Z" />\n                        </g>\n                        <g class="button" data-control="rotate-ccw">\n                            <path class="button-fill" d="M 3791,5423 C 3791,5423 3791,2058 3791,2058 4697,2085 5424,2828 5424,3740 \t5424,4653 4697,5396 3791,5423 Z" />\n                            <path class="fil1" d="M 4292,4559 C 4292,4559 4210,4237 4210,4237 4210,4237 4128,3915 4128,3915 4128,3915 4453,4044 4453,4044 4576,3731 4554,3397 4418,3119 4418,3119 4493,3082 4493,3082 4639,3381 4663,3739 4531,4074 4531,4074 4852,4201 4852,4201 4852,4201 4572,4380 4572,4380 4572,4380 4292,4559 4292,4559 4292,4559 4292,4559 4292,4559 Z" />\n                        </g>\n                        <g class="button" data-control="left-up">\n                            <path class="button-fill" d="M 2332,0.00 C 2332,0.00 505,0.00 505,0.00 227,0.00 0.00,227 0.00,505 0.00,505 0.00,2332 0.00,2332 0.00,2332 2332,-0.00 2332,-0.00 2332,-0.00 2332,0.00 2332,0.00 Z" />\n                            <path class="fil1" d="M 351,346 C 351,346 735,337 735,337 735,337 1120,328 1120,328 1120,328 727,722 727,722 727,722 334,1115 334,1115 334,1115 342,730 342,730 342,730 351,346 351,346 Z" />\n                        </g>\n                        <g class="button" data-control="up-right">\n                            <path class="button-fill" d="M 7482,2332 C 7482,2332 7482,505 7482,505 7482,227 7254,0.00 6976,0.00 6976,0.00 5149,0.00 5149,0.00 5149,0.00 7482,2332 7482,2332 7482,2332 7482,2332 7482,2332 Z" />\n                            <path class="fil1" d="M 7135,351 C 7135,351 7144,735 7144,735 7144,735 7153,1120 7153,1120 7153,1120 6759,727 6759,727 6759,727 6366,334 6366,334 6366,334 6751,342 6751,342 6751,342 7135,351 7135,351 Z" />\n                        </g>\n                        <g class="button" data-control="down-right">\n                            <path class="button-fill" d="m 5149,7482 2333,-0.8138 V 5149 Z" />\n                            <path class="fil1" d="M 7130,7135 C 7130,7135 6746,7144 6746,7144 6746,7144 6361,7153 6361,7153 6361,7153 6754,6759 6754,6759 6754,6759 7147,6366 7147,6366 7147,6366 7139,6751 7139,6751 7139,6751 7130,7135 7130,7135 Z" />\n                        </g>\n                        <g class="button" data-control="down-left">\n                            <path class="button-fill" d="M 0,5149 V 7481.0239 L 2332,7482 Z" />\n                            <path class="fil1" d="M 346,7130 C 346,7130 337,6746 337,6746 337,6746 328,6361 328,6361 328,6361 722,6754 722,6754 722,6754 1115,7147 1115,7147 1115,7147 730,7139 730,7139 730,7139 346,7130 346,7130 Z" />\n                        </g>\n                        <g class="button" data-control="up">\n                            <path class="button-fill" d="M 5048,0.00 C 5048,0.00 2433,0.00 2433,0.00 2433,0.00 1255,1178 1255,1178 1255,1178 2518,2441 2518,2441 2837,2140 3267,1956 3741,1956 4216,1956 4649,2142 4969,2446 4969,2446 6231,1183 6231,1183 6231,1183 5048,-0.00 5048,-0.00 5048,-0.00 5048,0.00 5048,0.00 Z" />\n                            <path class="fil1" d="M 3744,522 C 3744,522 4022,787 4022,787 4022,787 4300,1053 4300,1053 4300,1053 3744,1053 3744,1053 3744,1053 3188,1053 3188,1053 3188,1053 3466,787 3466,787 \t3466,787 3744,522 3744,522 Z" />\n                        </g>\n                        <g class="button" data-control="right">\n                            <path class="button-fill" d="M 7482,5048 C 7482,5048 7482,2433 7482,2433 7482,2433 6303,1255 6303,1255 6303,1255 5040,2518 5040,2518 5341,2837 5525,3267 5525,3741 5525,4216 5339,4649 5035,4969 5035,4969 6298,6231 6298,6231 6298,6231 7482,5048 7482,5048 7482,5048 7482,5048 7482,5048 Z" />\n                            <path class="fil1" d="M 6959,3744 C 6959,3744 6694,4022 6694,4022 6694,4022 6428,4300 6428,4300 6428,4300 6428,3744 6428,3744 6428,3744 6428,3188 6428,3188 6428,3188 6694,3466 6694,3466 6694,3466 6959,3744 6959,3744 Z" />\n                        </g>\n                        <g class="button" data-control="down">\n                            <path class="button-fill" d="M 2433,7482 C 2433,7482 5048,7482 5048,7482 5048,7482 6226,6303 6226,6303 6226,6303 4963,5040 4963,5040 4644,5341 4214,5525 3740,5525 3265,5525 2832,5339 2512,5035 2512,5035 1250,6298 1250,6298 1250,6298 2433,7482 2433,7482 2433,7482 2433,7482 2433,7482 Z" />\n                            <path class="fil1" d="M 3737,6959 C 3737,6959 3459,6694 3459,6694 3459,6694 3181,6428 3181,6428 3181,6428 3737,6428 3737,6428 3737,6428 4293,6428 4293,6428 4293,6428 4015,6694 4015,6694 4015,6694 3737,6959 3737,6959 Z" />\n                        </g>\n                        <g class="button" data-control="left">\n                            <path class="button-fill" d="M 0.00,5048 C 0.00,5048 1178,6226 1178,6226 1178,6226 2441,4963 2441,4963 2140,4644 1956,4214 1956,3740 1956,3265 2142,2832 2446,2512 2446,2512 1183,1250 1183,1250 1183,1250 -0.00,2433 -0.00,2433 -0.00,2433 -0.00,5048 -0.00,5048 -0.00,5048 -0.00,5048 -0.00,5048 -0.00,5048 0.00,5048 0.00,5048 Z" />\n                            <path class="fil1" d="M 522,3737 C 522,3737 787,3459 787,3459 787,3459 1053,3181 1053,3181 1053,3181 1053,3737 1053,3737 1053,3737 1053,4293 1053,4293 1053,4293 787,4015 787,4015 787,4015 522,3737 522,3737 Z" />\n                        </g>\n                        <g class="button" data-control="minus">\n                            <path class="button-fill" d="m 3706.3707,9100.7687 c -3191.92141,0 -3191.92141,0 -3191.92141,0 -282.33942,0 -511.1829516,-228.8435 -511.1829516,-511.183 0,-1043.1698 0,-1043.1698 0,-1043.1698 3703.1043616,0 3703.1043616,0 3703.1043616,0 z" />\n                            <path class="fil1" d="m 1516.0113,8202.8905 h 677.6146 v 172.3756 h -677.6146 z" />\n                        </g>\n                        <g class="button" data-control="plus">\n                            <path class="button-fill" d="m 3780.6707,9100.7687 c 3191.9214,0 3191.9214,0 3191.9214,0 282.3393,0 514.1549,-228.8435 514.1549,-511.183 0,-1043.1698 0,-1043.1698 0,-1043.1698 -3706.0763,0 -3706.0763,0 -3706.0763,0 z" />\n                            <path class="fil1" d="M 5296.3875,8202.8905 H 5546.035 V 7950.271 h 172.3756 v 252.6195 h 252.6195 v 172.3756 h -252.6195 v 249.6475 H 5546.035 v -249.6475 h -249.6475 z"/>\n                        </g>\n                    </g>\n                </svg>` } super(e, n, r, s) } } e.AdjustControl = AdjustControl })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class AdjustControl2 extends e.ButtonArrange { constructor(e, t, n) { var s = `<?xml version="1.0" encoding="UTF-8" ?>\n            <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="2000" height="200" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 17832 1783" xmlns:xlink="http://www.w3.org/1999/xlink">\n                <defs>\n                <style type="text/css">\n                    <![CDATA[\n                    .fil1 {fill:#888888}\n                    .button-fill {fill:#333333;transition:fill 0.2s}\n                    .button.pressed .button-fill {fill:#444444}\n                    ]]>\n                </style>\n                </defs>\n                <g id="adjustcontrol2">\n                    <g class="button" data-control="rotate-ccw" transform="matrix(1.008 0 0 .97571 0 -.0029549)">\n                        <path class="button-fill" transform="scale(8.916)" d="m56.548 204.96c25.844 1.0392 216.27 0 216.27 0v-204.96h-216.18c-31.18 0-56.641 27.226-56.641 58.406 0 0-2.382 58.864 0 88.141 3.1127 38.258 29.911 57.348 56.548 58.419z" />\n                        <path class="fil1" d="m675.66 1454.5s319.86-89.986 319.86-89.986l319.86-89.986-274.22-216.96c209.57-263.02 509.82-410.97 818.57-432.19l-5.457-83.452c-331.94 23.06-653.98 181.28-878.1 463.09l-270.49-214.49s-15.019 331.99-15.019 331.99l-15.019 331.99z" />\n                    </g>\n                    <g class="button" data-control="up" transform="translate(65.311)">\n                        <path class="button-fill" d="m5059.7-0.0029549v1783.1h2451.9v-1783.2z" />\n                        <path class="fil1" d="m6285.6 625.98 278 265 278 266h-556-556l278-266 278-265z" />\n                    </g>\n                    <g class="button" data-control="left" transform="translate(29.878)">\n                        <path class="button-fill" d="m2532.6-0.0029549v1783.1h2451.9v-1783.1h-2438.4z" />\n                        <path class="fil1" d="m3493.1 891.54s265-278 265-278l266-278v556 556l-266-278s-265-278-265-278z" />\n                    </g>\n                    <g class="button" data-control="right" transform="translate(145.35)">\n                        <path class="button-fill" d="m12557 1783v-1783.1h-2451.9v1783.1h2427.2z" />\n                        <path class="fil1" d="m11596 891.42s-265 278-265 278l-266 278v-556-556l266 278s265 278 265 278z" />\n                    </g>\n                    <g class="button" data-control="down" transform="translate(115.47)">\n                        <path class="button-fill" d="m10024 1783v-1783.1h-2451.9v1783.1z" />\n                        <path class="fil1" d="m8798 1156.9-278-265-278-266h556 556l-278 266-278 265z" />\n                    </g>\n                    <g class="button" data-control="rotate-cw" transform="translate(180.78)">\n                        <path class="button-fill" d="m15084-0.12166h-2451.9v1783.1l2451.9-0.01z" />\n                        <path class="fil1" d="m14450 1347.7s-319.86-89.986-319.86-89.986-319.86-89.986-319.86-89.986l274.22-216.96c-209.57-263.02-509.82-410.97-818.57-432.19l5.457-83.452c331.94 23.06 653.98 181.28 878.1 463.09l270.49-214.49s15.018 331.99 15.018 331.99 15.019 331.99 15.019 331.99z" />\n                    </g>\n                    <g class="button" data-control="center" transform="translate(231.81)">\n                        <path class="button-fill" d="m17595 508.09c-3.585-237.56-247.12-510.6-512.09-508.21h-1939.8v1783.1h1939.7c281.4 0 512.18-222.46 512.18-493.71z" />\n                        <path class="fil1" transform="matrix(8.916 0 0 8.916 0 -.11915)" d="m1829.3 43.299v50.08h-50.078v13.227h50.078v50.08h13.228v-50.08h50.078v-13.227h-50.078v-50.08z" />\n                    </g>\n                </g>\n            </svg>`; super(e, t, s, n) } } e.AdjustControl2 = AdjustControl2 })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class AssemblyInfo { } AssemblyInfo.Version = "5.7.0"; AssemblyInfo.Copyright = "(c) Efferent Health, LLC"; e.AssemblyInfo = AssemblyInfo })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class CalendarUtils { static GetNumberWithZero(e) { return `0${e}`.substr(-2) } static TimeFormat(e, t) { return `${CalendarUtils.GetNumberWithZero(e)}:${CalendarUtils.GetNumberWithZero(t)}` } static GetSimpleTimeFormat(e) { const t = CalendarUtils.GetNumberWithZero(`0${e.getMonth() + 1}`.substr(-2)); const n = CalendarUtils.GetNumberWithZero(`0${e.getDate()}`.substr(-2)); const s = e.getFullYear(); const a = CalendarUtils.GetNumberWithZero(e.getHours()); const r = CalendarUtils.GetNumberWithZero(e.getMinutes()); return `${s}/${t}/${n} ${a}:${r}` } static GetDateNameInString(e, t = "/") { const n = CalendarUtils.GetNumberWithZero(`0${e.getMonth() + 1}`.substr(-2)); const s = CalendarUtils.GetNumberWithZero(`0${e.getDate()}`.substr(-2)); const a = e.getFullYear(); return `${a}${t}${n}${t}${s}` } static GetFormattedDate(e, t) { if (e && t) { const n = t.includes("-") ? "-" : "/"; const s = t.split(n).join("-"); const a = CalendarUtils.GetNumberWithZero(e.getMonth() + 1); const r = CalendarUtils.GetNumberWithZero(e.getDate()); const o = e.getFullYear(); switch (s.toUpperCase()) { case CalendarUtils.DATE_FORMAT_YMD: return `${o}${n}${a}${n}${r}`; case CalendarUtils.DATE_FORMAT_MDY: return `${a}${n}${r}${n}${o}`; case CalendarUtils.DATE_FORMAT_DMY: return `${r}${n}${a}${n}${o}`; default: return "" } } return "" } static GetFormattedStringDate(e, t) { if (e && t) { const n = t.includes("-") ? "-" : "/"; const s = t.split(n).join("-"); const a = e.includes("-") ? "-" : "/"; const [r, o, l] = e.split(a); switch (s.toUpperCase()) { case CalendarUtils.DATE_FORMAT_YMD: return `${r}${n}${o}${n}${l}`; case CalendarUtils.DATE_FORMAT_MDY: return `${o}${n}${l}${n}${r}`; case CalendarUtils.DATE_FORMAT_DMY: return `${l}${n}${o}${n}${r}`; default: return "" } } return "" } static GetFormattedDateTimeFromDB(e, t = CalendarUtils.DATE_FORMAT_YMD) { try { const [n, s] = e.split(/[/\sT]/g); const a = CalendarUtils.GetFormattedStringDate(n, t); if (s) { const e = CalendarUtils.GetTimeFromString(s); return `${a} ${e}` } else { return a } } catch (e) { return "" } } static GetDateFromString(e, t) { if (e && t) { let n = e; if (n.includes("T")) { n = e.split("T")[0]; if (n.includes("+")) n = n.split("+")[0] } const s = t.includes("-") ? "-" : "/"; const a = t.split(s).join("-"); const r = n.includes("-") ? "-" : "/"; switch (a.toUpperCase()) { case CalendarUtils.DATE_FORMAT_YMD: const [e, t, s] = n.split(r); return new Date(+e, +t - 1, +s); case CalendarUtils.DATE_FORMAT_MDY: const [a, o, l] = n.split(r); return new Date(+l, +a - 1, +o); case CalendarUtils.DATE_FORMAT_DMY: const [c, d, h] = n.split(r); return new Date(+h, +d - 1, +c); default: return new Date } } return new Date } static GetTimeFromString(e) { const [t, n] = e.split(":"); return `${t}:${n}` } static GetDaysInMonth(e, t) { return new Date(t, e, 0).getDate() } static IsCorrectDate(e, t, n) { const s = CalendarUtils.GetDaysInMonth(t, n); return e <= s } static CorrectDate(e, t, n, s) { const a = CalendarUtils.GetDaysInMonth(+t, +n); const r = s.includes("-") ? "-" : "/"; switch (s.toLocaleUpperCase()) { case CalendarUtils.DATE_FORMAT_YMD: return `${n}${r}${t}${r}${a}`; case CalendarUtils.DATE_FORMAT_MDY: return `${t}${r}${a}${r}${n}`; case CalendarUtils.DATE_FORMAT_DMY: return `${a}${r}${t}${r}${n}`; default: return "" } } static GetMinutesDiff(e, t) { const n = e.getTime() - t.getTime(); const s = 1 * 60 * 60 * 1e3; return Math.round(n / s) } static GetShortMonthName(e) { return e.substr(0, 3) } static AddDays(e, t) { const n = new Date(e); n.setDate(n.getDate() + t); return n } static GenerateWeekDays(e) { const t = e.getDay(); const n = []; for (let s = 0 - t; s < 7 - t; s++) { n.push(CalendarUtils.AddDays(e, s)) } return n } static IsToday(e, t, n) { const s = new Date; return s.getDate() === e && s.getMonth() === t && s.getFullYear() === n } } CalendarUtils.DaysOfTheWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; CalendarUtils.Months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]; CalendarUtils.DATE_FORMAT_DMY = "DD-MM-YYYY"; CalendarUtils.DATE_FORMAT_MDY = "MM-DD-YYYY"; CalendarUtils.DATE_FORMAT_YMD = "YYYY-MM-DD"; e.CalendarUtils = CalendarUtils })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); CanvasRenderingContext2D.prototype.dashedLine = (e, t, n, s, a, r) => { var o = e; if (r === undefined) r = 2; o.beginPath(); o.moveTo(t, n); if (r === 0) { o.lineTo(s, a) } else { var l = s - t; var c = a - n; var d = Math.floor(Math.sqrt(l * l + c * c) / r); var h = l / d; var u = c / d; var f = 0; while (f++ < d) { t += h; n += u; o[f % 2 === 0 ? "moveTo" : "lineTo"](t, n) } o[f % 2 === 0 ? "moveTo" : "lineTo"](s, a) } o.stroke(); o.closePath() }; CanvasRenderingContext2D.prototype.drawEllipse = (e, t, n, s, a) => { var r = e; var o = .5522848; var l = (s - t) / 2 * o; var c = (a - n) / 2 * o; var d = (t + s) / 2; var h = (n + a) / 2; r.beginPath(); r.moveTo(t, h); r.bezierCurveTo(t, h - c, d - l, n, d, n); r.bezierCurveTo(d + l, n, s, h - c, s, h); r.bezierCurveTo(s, h + c, d + l, a, d, a); r.bezierCurveTo(d - l, a, t, h + c, t, h); r.closePath(); r.stroke() }; CanvasRenderingContext2D.prototype.drawArrow = (e, t, n, s, a, r) => { var o = e; var l = Math.atan2(a - n, s - t); var c = Math.sqrt((s - t) * (s - t) + (a - n) * (a - n)); o.beginPath(); o.moveTo(t, n); o.lineTo(s, a); if (c > r) { o.lineTo(s - r * Math.cos(l - Math.PI / 6), a - r * Math.sin(l - Math.PI / 6)); o.moveTo(s, a); o.lineTo(s - r * Math.cos(l + Math.PI / 6), a - r * Math.sin(l + Math.PI / 6)) } o.stroke() }; CanvasRenderingContext2D.prototype.drawCircle = (e, t, n, s) => { var a = e; a.beginPath(); a.moveTo(t, n); a.arc(t, n, s, 0, 2 * Math.PI, false); a.fill(); a.stroke() }; CanvasRenderingContext2D.prototype.drawLine = (e, t, n, s, a) => { var r = e; r.dashedLine(r, t, n, s, a, 0) }; var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class Cloner { constructor(e) { var t; this.opts = e !== null && e !== void 0 ? e : {}; this.excludeProperties = (t = this.opts["excludeProperties"]) !== null && t !== void 0 ? t : [] } Clone(e) { if (typeof e === "object") this.namePrincipalObject = e.constructor.name; if (this.opts["circles"]) return new RfdcCircles(this.opts).Clone(e); return this.opts["proto"] ? this.cloneProto(e) : this.clone(e) } cloneArray(e, t) { var n = Object.keys(e); var s = new Array(n.length); for (var a = 0; a < n.length; a++) { var r = n[a]; var o = e[r]; if (typeof o !== "object" || o === null || typeof o === "object" && o.constructor.name === "HTMLImageElement") s[r] = o; else if (o instanceof Date) s[r] = new Date(o); else if (ArrayBuffer.isView(o)) s[r] = Cloner.CopyBuffer(o); else s[r] = t.call(this, o) } return s } clone(e) { if (typeof e !== "object" || e === null) return e; if (e instanceof Date) return new Date(e); if (Array.isArray(e)) return this.cloneArray(e, this.clone); if (e instanceof Map) return new Map(this.cloneArray(Array.from(e), this.clone)); if (e instanceof Set) return new Set(this.cloneArray(Array.from(e), this.clone)); var t = {}; for (var n in e) { if (Object.hasOwnProperty.call(e, n) === false) continue; if (this.excludeProperties.some((e => e === n))) continue; var s = e[n]; if (s && this.namePrincipalObject === s.constructor.name) continue; if (typeof s !== "object" || s === null || typeof s === "object" && s.constructor.name === "HTMLImageElement") t[n] = s; else if (s instanceof Date) t[n] = new Date(s); else if (s instanceof Map) t[n] = new Map(this.cloneArray(Array.from(s), this.clone)); else if (s instanceof Set) t[n] = new Set(this.cloneArray(Array.from(s), this.clone)); else if (ArrayBuffer.isView(s)) t[n] = Cloner.CopyBuffer(s); else t[n] = this.clone(s) } return t } cloneProto(e) { if (typeof e !== "object" || e === null) return e; if (e instanceof Date) return new Date(e); if (Array.isArray(e)) return this.cloneArray(e, this.cloneProto); if (e instanceof Map) return new Map(this.cloneArray(Array.from(e), this.cloneProto)); if (e instanceof Set) return new Set(this.cloneArray(Array.from(e), this.cloneProto)); var t = {}; for (var n in e) { if (e.hasOwnProperty(n)) { if (this.excludeProperties.some((e => e === n))) continue; var s = e[n]; if (s && this.namePrincipalObject === s.constructor.name) continue; if (typeof s !== "object" || s === null || typeof s === "object" && s.constructor.name === "HTMLImageElement") t[n] = s; else if (s instanceof Date) t[n] = new Date(s); else if (s instanceof Map) t[n] = new Map(this.cloneArray(Array.from(s), this.cloneProto)); else if (s instanceof Set) t[n] = new Set(this.cloneArray(Array.from(s), this.cloneProto)); else if (ArrayBuffer.isView(s)) t[n] = Cloner.CopyBuffer(s); else t[n] = this.cloneProto(s) } } t["__proto__"] = e["__proto__"]; return t } static CopyBuffer(e) { if (e instanceof Buffer) return Buffer.from(e); return new e.constructor(e.buffer.slice(), e.byteOffset, e.length) } static CopyObjectFromto(e, t, n = []) { for (const a in e) { if (Object.prototype.hasOwnProperty.call(e, a)) { const r = e[a]; if (r !== null && r !== undefined && !Array.isArray(r) && typeof r === "object") { if (n.some((e => e === a))) continue; if (r instanceof Date || r.constructor.name === "HTMLImageElement") { t[a] = r } else { t[a] = {}; var s = Object.keys(r); if (s.length > 0) Cloner.CopyObjectFromto(r, t[a]) } } else { t[a] = r } } } t["__proto__"] = e["__proto__"]; return t } } e.Cloner = Cloner; class RfdcCircles { constructor(e) { var t; this.refs = []; this.refsNew = []; this.opts = e; this.excludeProperties = (t = this.opts["excludeProperties"]) !== null && t !== void 0 ? t : [] } Clone(e) { if (typeof e === "object") this.namePrincipalObject = e.constructor.name; return this.opts["proto"] ? this.cloneProto(e) : this.clone(e) } cloneArray(e, t) { var n = Object.keys(e); var s = new Array(n.length); for (var a = 0; a < n.length; a++) { var r = n[a]; var o = e[r]; if (typeof o !== "object" || o === null || typeof o === "object" && o.constructor.name === "HTMLImageElement") { s[r] = o } else if (o instanceof Date) { s[r] = new Date(o) } else if (ArrayBuffer.isView(o)) { s[r] = Cloner.CopyBuffer(o) } else { var l = this.refs.indexOf(o); if (l !== -1) s[r] = this.refsNew[l]; else s[r] = t.call(this, o) } } return s } clone(e) { if (typeof e !== "object" || e === null) return e; if (e instanceof Date) return new Date(e); if (Array.isArray(e)) return this.cloneArray(e, this.clone); if (e instanceof Map) return new Map(this.cloneArray(Array.from(e), this.clone)); if (e instanceof Set) return new Set(this.cloneArray(Array.from(e), this.clone)); var t = {}; this.refs.push(e); this.refsNew.push(t); for (var n in e) { if (Object.hasOwnProperty.call(e, n) === false) continue; if (this.excludeProperties.some((e => e === n))) continue; var s = e[n]; if (s && this.namePrincipalObject === s.constructor.name) continue; if (typeof s !== "object" || s === null || typeof s === "object" && s.constructor.name === "HTMLImageElement") { t[n] = s } else if (s instanceof Date) { t[n] = new Date(s) } else if (s instanceof Map) { t[n] = new Map(this.cloneArray(Array.from(s), this.clone)) } else if (s instanceof Set) { t[n] = new Set(this.cloneArray(Array.from(s), this.clone)) } else if (ArrayBuffer.isView(s)) { t[n] = Cloner.CopyBuffer(s) } else { var a = this.refs.indexOf(s); if (a !== -1) t[n] = this.refsNew[a]; else t[n] = this.clone(s) } } this.refs.pop(); this.refsNew.pop(); return t } cloneProto(e) { if (typeof e !== "object" || e === null) return e; if (e instanceof Date) return new Date(e); if (Array.isArray(e)) return this.cloneArray(e, this.cloneProto); if (e instanceof Map) return new Map(this.cloneArray(Array.from(e), this.cloneProto)); if (e instanceof Set) return new Set(this.cloneArray(Array.from(e), this.cloneProto)); var t = {}; this.refs.push(e); this.refsNew.push(t); for (var n in e) { if (e.hasOwnProperty(n)) { if (this.excludeProperties.some((e => e === n))) continue; var s = e[n]; if (s && this.namePrincipalObject === s.constructor.name) continue; if (typeof s !== "object" || s === null || typeof s === "object" && s.constructor.name === "HTMLImageElement") { t[n] = s } else if (s instanceof Date) { t[n] = new Date(s) } else if (s instanceof Map) { t[n] = new Map(this.cloneArray(Array.from(s), this.cloneProto)) } else if (s instanceof Set) { t[n] = new Set(this.cloneArray(Array.from(s), this.cloneProto)) } else if (ArrayBuffer.isView(s)) { t[n] = Cloner.CopyBuffer(s) } else { var a = this.refs.indexOf(s); if (a !== -1) t[n] = this.refsNew[a]; else t[n] = this.cloneProto(s) } } } this.refs.pop(); this.refsNew.pop(); t["__proto__"] = e["__proto__"]; return t } } e.RfdcCircles = RfdcCircles })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class Colors { } Colors.Turquoise = "#1ABC9C"; Colors.GreenSea = "#16A085"; Colors.Emerald = "#2ECC71"; Colors.Nephritis = "#27AE60"; Colors.BelizeHole = "#2980B9"; Colors.Asbestos = "#7F8C8D"; Colors.PeterRiver = "#3498DB"; Colors.Amethyst = "#9B59B6"; Colors.Wisteria = "#8E44AD"; Colors.SunFlower = "#F1C40F"; Colors.Orange = "#F39C12"; Colors.Carrot = "#E67E22"; Colors.Pumpkin = "#D35400"; Colors.Alizarin = "#E74C3C"; Colors.Pomegranate = "#C0392B"; Colors.Clouds = "#ECF0F1"; Colors.Silver = "#BDC3C7"; Colors.Concrete = "#95A5A6"; Colors.FullBlack = "#000000"; Colors.FullWhite = "#ffffff"; Colors.BgLighter = "#34495E"; Colors.BgDarker = "#2C3E50"; e.Colors = Colors })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class DOMUtils { static IsValidBrowser() { const e = window.navigator.userAgent.indexOf("Trident/") > -1; const t = window.navigator.userAgent.indexOf("MSIE") > -1; const n = window.navigator.userAgent.indexOf("OPR") > -1; return !(e && t || n) } static IsGoogleChrome() { return window["chrome"] != null && window.navigator.vendor === "Google Inc." } static GuessCountryCode(e) { const t = this.CountryCodes.map((e => e.code)); e = e.replace("+", ""); let n = { code: "1", phoneNumber: e }; for (let s = 0; s < e.length - 1; s++) { const a = e.slice(0, s + 1); if (t.indexOf(a) > -1) { n["code"] = a; n["phoneNumber"] = e.slice(s + 1, e.length) } if (s === 6) { break } } return n } static SetOptions(e, t) { const { className: n, children: s, style: a, dataset: r, attr: o } = t, l = __rest(t, ["className", "children", "style", "dataset", "attr"]); Object.assign(e, l); if (n) e.className = n; if (a) DOMUtils.SetStyles(e, a); if (r) DOMUtils.setData(e, r); if (o) DOMUtils.setAttributes(e, o); if (Array.isArray(s) && s.length > 0) s.forEach((t => { if (t) e.appendChild(t) })); return e } static ConvertEmailToLower(e) { if (e !== null && e !== undefined) { e.onchange = e => { e.target.value = e.target.value.toLowerCase() } } } static SetStyles(e, t) { Object.keys(t).forEach((n => { if (n in e.style) e.style[n] = t[n]; else console.warn(`${n} is not a valid style for a <${e.tagName.toLowerCase()}>`) })) } static ExportCanvasAsJpeg(e, t, n) { const s = n !== null && n !== void 0 ? n : "image/jpeg"; const a = e.toDataURL(s); const r = document.createElement("a"); r.download = t; r.href = a; r.dataset.downloadurl = [s, r.download, r.href].join(":"); document.body.appendChild(r); r.click(); document.body.removeChild(r) } static GetSizeElement(e) { const t = window.getComputedStyle(e); const n = e.offsetWidth; const s = parseFloat(t.marginLeft) + parseFloat(t.marginRight); const a = parseFloat(t.paddingLeft) + parseFloat(t.paddingRight); const r = parseFloat(t.borderLeftWidth) + parseFloat(t.borderRightWidth); const o = e.offsetHeight; const l = parseFloat(t.marginTop) + parseFloat(t.marginBottom); const c = parseFloat(t.paddingTop) + parseFloat(t.paddingBottom); const d = parseFloat(t.borderTopWidth) + parseFloat(t.borderBottomWidth); return { width: n + s - a + r, height: o + l - c + d } } static CheckFlexGap() { var e = document.createElement("div"); e.style.display = "flex"; e.style.flexDirection = "column"; e.style.rowGap = "1px"; e.appendChild(document.createElement("div")); e.appendChild(document.createElement("div")); document.body.appendChild(e); var t = e.scrollHeight === 1; e.parentNode.removeChild(e); return t } static LoadJsToHead(t, n) { let s = 0; const a = document.head || document.getElementsByTagName("head")[0]; const r = { load: (e, t, n, s) => { const a = document.createElement("script"); a.type = "text/javascript"; a.onerror = loadError; if (n) { a.onload = () => { n(s) } } t.appendChild(a); a.src = e } }; const loadError = t => { e.Utils.DebugConsoleLog("Error: The script " + t.target.src + " is not accessible.") }; const loadCallback = s => { while (DOMUtils.ExistsScriptOnDOM(t[++s]) && s < t.length) { s++ } if (s < t.length) { r["load"](t[s], a, loadCallback, s) } else { e.Loader.HideAll(); if (n !== undefined) n.forEach((e => { e() })) } }; while (DOMUtils.ExistsScriptOnDOM(t[s]) && s < t.length) { s++ } e.Loader.Show("Loading application..."); if (s < t.length) r["load"](t[s], a, loadCallback, s); else loadCallback(s) } static ExistsScriptOnDOM(e) { let t = false; const n = document.head || document.getElementsByTagName("head")[0]; const s = n.getElementsByTagName("script"); for (let n = 0; n < s.length; n++) { const a = s[n]; if (a.type === "text/javascript") { if (a.src.match(e)) { t = true; break } } } return t } static SwithButtonsInContainer(e, t) { if (typeof e === "string") e = document.getElementById(e); var n = e.getElementsByTagName("button"); for (var s = 0; s < n.length; s++) { var a = n[s]; t.map((e => { if (e.id === a.id) a.disabled = e.disabled })) } } static HasClassInAnyParents(e, t) { do { if (DOMUtils.HasClass(e, t)) return true; else e = e.parentElement } while (e.parentElement) } static HasClass(e, t) { if (e && t && t.length) return e.classList.contains(t); return false } static AddClass(e, t) { if (e && t && t.length) { const n = t.split(" ") || []; if (n.length) e.classList.add(...n); else e.classList.add(t) } } static RemoveClass(e, t) { try { if (e && t && t.length) e.classList.remove(t) } catch (e) { } } static HideElement(e) { e.style.display = "none" } static ShowElement(e) { e.style.display = "" } static ToggleFullScreen(e) { var t = document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement; if (!e) { if (document.documentElement.mozRequestFullScreen) document.documentElement.mozRequestFullScreen(); else if (document.documentElement.msRequestFullscreen) document.documentElement.msRequestFullscreen(); else if (document.documentElement.webkitRequestFullScreen) document.documentElement.webkitRequestFullScreen() } else { if (document.mozCancelFullScreen) document.mozCancelFullScreen(); else if (document.msExitFullscreen) document.msExitFullscreen(); else if (document.webkitExitFullscreen) document.webkitExitFullscreen() } } static IsPortrait() { if (window.matchMedia("(orientation: portrait)").matches) return true; return false } static IsSmallDevice() { return window.matchMedia("(max-width: 375px)").matches && window.matchMedia("(orientation: portrait)").matches || window.matchMedia("(max-height: 375px)").matches && window.matchMedia("(orientation: landscape)").matches } static OpenMultipleWindows(t) { var n = new Array; var s = new Array; for (var a = 0; a < t.length; a++) { var r = document.createElement("a"); r.innerHTML = "-"; r.id = e.Utils.GetGuid(); r.target = "_blank"; r.style.display = "none"; r.href = t[a]; document.body.appendChild(r); n.push(r); s.push(r.id) } n.forEach((e => { e.click() })); for (var o = 0; o < s.length; o++) { var l = document.getElementById(s[o]); DOMUtils.RemoveItem(l) } } static CreateModal(e) { var t = document.createElement("div"); DOMUtils.AddClass(t, "backgroundlayer"); var n = document.createElement("div"); DOMUtils.AddClass(n, "modalbox_container"); if (e.title !== undefined) n.appendChild(e.title); if (e.content !== undefined) n.appendChild(e.content); if (e.close) { var s = document.createElement("div"); s.innerHTML = "<span style='color:white'>x</span>"; DOMUtils.AddClass(s, "closebtn"); s.addEventListener("click", (e => { document.getElementsByClassName("modalbox_container")[0].remove(); document.getElementsByClassName("backgroundlayer")[0].remove() })); n.appendChild(s) } document.body.appendChild(t); document.body.appendChild(n) } static ScrollElement(e, t = 0, n = true, s = true) { if (e === undefined || e === null) return; var a = e.getAttribute("data-blockScroll") === "yes"; var r; var o; var l; var c; var d; var h; var u; if (Math.abs(t) > 0) { t = t * .075; e.setAttribute("data-scrollExecute", "1"); if (n) { c = e.scrollHeight; h = e.clientHeight; o = e.scrollTop; r = getComputedStyle(e, null).overflowY; if (!a && r === "auto") { if (c - h > 0) { var f; if (s === true) f = o - t; else f = o + t; if (f >= 0 && o <= c - h) e.scrollTop = f; else if (f < 0) e.scrollTop = 0 } } } else { d = e.scrollWidth; u = e.clientWidth; l = e.scrollLeft; r = getComputedStyle(e, null).overflowX; if (!a && r === "auto") { if (d - u > 0) { if (l + t >= 0 && l <= d - u) e.scrollLeft = l + t; else if (l + t < 0) e.scrollLeft = 0 } } } setTimeout((() => { try { e.setAttribute("data-scrollExecute", "0") } catch (e) { } }), 1e3) } o = e.scrollTop; l = e.scrollLeft; e.onscroll = t => { t.preventDefault(); t.stopPropagation(); var n = t.currentTarget; var s = DOMUtils.IsIOS(); if (s) { e.scrollTop = o; e.scrollLeft = l } } } static IsIOS() { return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream } static ForceNumbers(e) { e.oninput = () => { var t = e.value.replace(/\D/g, ""); e.value = t } } static ForceNoSpecialCharacters(e) { e.oninput = () => { var t = e.value.replace(/[^\w\s\/\-:.]/gi, ""); e.value = t } } static ForceCharacter(e) { e.oninput = () => { var t = e.value.replace(/^\ /, ""); e.value = t } } static ForcePagesNumeration(e, t) { e.onkeydown = n => { if (n.key !== "Backspace" && !(n.shiftKey && n.key === "ArrowLeft")) { if (e.value.length > 0 && !"-0123456789,".includes(n.key) && e.selectionStart > 0) { e.disabled = true; const t = setTimeout((() => { e.disabled = false; e.focus(); clearTimeout(t) }), 1) } } if (t) t(n) }; e.oninput = t => { const n = t.target.value; if (e.value.length === 1 && !"123456789".includes(e.value)) { e.value = ""; return } let s = n.replace(/,+/g, ",").replace(/ +/g, "").replace(/-+/g, "-"); if (s.slice(-1) === "-") { const e = s.split(","); const t = e.pop(); if (t.split("-").length > 2) s = e.join(",") + "," + t.slice(0, -1) } e.value = s } } static ForcePhoneNumberInput(e) { e.onkeydown = t => { if (e.value.length > 0 && t.key === "+" && e.selectionStart > 0) { e.disabled = true; setTimeout((() => { e.disabled = false; e.focus() }), 1) } }; e.oninput = () => { var t = e.value.replace(/(?:[^0123456789\+]*)/g, ""); e.value = t } } static FindNearestAncestor(e, t) { while ((e = e.parentElement) && !e.classList.contains(t)); return e } static IsDisplay(e) { if (e) { try { var t = e.style.display; var n = getComputedStyle(e, null).display; return (t === "" || t !== "none") && n !== "none" } catch (e) { return false } } else { return false } } static RemoveItem(e) { try { if ("remove" in Element.prototype) e.remove(); else e.parentNode.removeChild(e) } catch (e) { } } static InjectCSS(e, t) { if (t) { const e = document.querySelector(`style#${t}`); if (e) return } var n = document.createElement("style"); n.setAttribute("type", "text/css"); if (t) n.setAttribute("id", t); n.innerHTML = e; document.head.appendChild(n); return n } static IsTouch(e) { return e.pointerType === "touch" } static GetTransformProperty(e) { var t = ["transform", "WebkitTransform", "msTransform", "MozTransform", "OTransform"]; var n; while (n = t.shift()) { if (typeof e.style[n] !== "undefined") { return n } } return false } static AppendToolTip(e, t) { e.classList.add("simpleTooltip"); t.replaceAll("\n", "A"); e.setAttribute("simpleTooltip", t); e.onmouseenter = t => { const n = t.pageY; if (n < 230) { e.classList.add("simpleTooltipTop"); e.classList.remove("simpleTooltipBottom") } else { e.classList.remove("simpleTooltipTop"); e.classList.add("simpleTooltipBottom") } if (e.offsetLeft > window.innerWidth - 300) { e.classList.add("simpleTooltipRight"); e.classList.remove("simpleTooltipLeft") } else { e.classList.remove("simpleTooltipRight"); e.classList.add("simpleTooltipLeft") } } } static Debug(e) { let t; if (typeof e === "string") t = e; else if (typeof e === "object") t = JSON.stringify(e, null, 2); const n = document.createElement("div"); DOMUtils.AddClass(n, "debugconsole"); const s = document.createElement("pre"); const a = document.createTextNode(t); s.appendChild(a); n.appendChild(s); document.getElementById("content").appendChild(n) } static GetOffset(e, t) { var n = window.navigator.userAgent.match("Firefox"); if (e === undefined) return; else { if (!this.IsTouch(e)) { switch (t) { case "x": return e.offsetX || (e.srcEvent ? (n ? e.srcEvent.layerX : e.srcEvent.offsetX) || (e.srcEvent.touches ? e.srcEvent.touches[0].pageX : 0) : 0); case "y": return e.offsetY || (e.srcEvent ? (n ? e.srcEvent.layerY : e.srcEvent.offsetY) || (e.srcEvent.touches ? e.srcEvent.touches[0].pageY : 0) : 0); case "left": return e.target.offsetLeft || (e.target.srcEvent ? e.target.srcEvent.offsetLeft || (e.target.srcEvent.touches ? e.target.srcEvent.touches[0].offsetleft : 0) : 0); case "top": return e.target.offsetTop || (e.target.srcEvent ? e.target.srcEvent.offsetTop || (e.target.srcEvent.touches ? e.target.srcEvent.touches[0].offsetTop : 0) : 0) } } else { switch (t) { case "x": return e.offsetX || (e.srcEvent ? e.srcEvent.layerX || e.srcEvent.offsetX || (e.srcEvent.touches ? e.srcEvent.touches[0].pageX : 0) : 0); case "y": return e.offsetY || (e.srcEvent ? e.srcEvent.layerY || e.srcEvent.offsetY || (e.srcEvent.touches ? e.srcEvent.touches[0].pageY : 0) : 0); case "left": return e.target.offsetLeft || (e.target.srcEvent ? e.target.srcEvent.offsetLeft || (e.target.srcEvent.touches ? e.target.srcEvent.touches[0].offsetleft : 0) : 0); case "top": return e.target.offsetTop || (e.target.srcEvent ? e.target.srcEvent.offsetTop || (e.target.srcEvent.touches ? e.target.srcEvent.touches[0].offsetTop : 0) : 0) } } } } static CreateDownloaderAnchor(e, t) { const n = window.URL.createObjectURL(e); const s = document.createElement("a"); s.href = n; s.download = t; document.body.appendChild(s); s.click(); const a = setTimeout((() => { document.body.removeChild(s); clearTimeout(a) }), 1e3) } static InsertAfter(e, t) { const n = t.parentNode; if (n.lastChild === t) n.appendChild(e); else n.insertBefore(e, t.nextSibling) } static SetBoundRectangle(e, t) { e.style.left = `${t.left}px`; e.style.top = `${t.top}px`; e.style.width = `${t.width}px`; e.style.height = `${t.height}px` } static DectectClosestItem(e, t) { let n = null; let s = Number.MAX_VALUE; for (let a = 0; a < e.length; a++) { const r = e[a]; const o = r.getBoundingClientRect(); const l = Math.abs(o.left - t.x) + Math.abs(o.top - t.y); if (l < s) { n = r; s = l } } return n } static IsBeforeElement(e, t) { const n = e.getBoundingClientRect(); const s = t.getBoundingClientRect(); return s.left + s.width < n.left + n.width } static createElement(e, t) { var n = document.createElement(e); return this.SetOptions(n, t) } static setData(e, t) { Object.keys(t).forEach((n => { e.dataset[n] = t[n].toString() })) } static setAttributes(e, t) { Object.keys(t).forEach((n => { e.setAttribute(n, t[n]) })) } } DOMUtils.CountryCodes = [{ country: "Afghanistan", code: "93", iso: "AF" }, { country: "Albania", code: "355", iso: "AL" }, { country: "Algeria", code: "213", iso: "DZ" }, { country: "American Samoa", code: "1-684", iso: "AS" }, { country: "Andorra", code: "376", iso: "AD" }, { country: "Angola", code: "244", iso: "AO" }, { country: "Anguilla", code: "1-264", iso: "AI" }, { country: "Antarctica", code: "672", iso: "AQ" }, { country: "Antigua and Barbuda", code: "1-268", iso: "AG" }, { country: "Argentina", code: "54", iso: "AR" }, { country: "Armenia", code: "374", iso: "AM" }, { country: "Aruba", code: "297", iso: "AW" }, { country: "Australia", code: "61", iso: "AU" }, { country: "Austria", code: "43", iso: "AT" }, { country: "Azerbaijan", code: "994", iso: "AZ" }, { country: "Bahamas", code: "1-242", iso: "BS" }, { country: "Bahrain", code: "973", iso: "BH" }, { country: "Bangladesh", code: "880", iso: "BD" }, { country: "Barbados", code: "1-246", iso: "BB" }, { country: "Belarus", code: "375", iso: "BY" }, { country: "Belgium", code: "32", iso: "BE" }, { country: "Belize", code: "501", iso: "BZ" }, { country: "Benin", code: "229", iso: "BJ" }, { country: "Bermuda", code: "1-441", iso: "BM" }, { country: "Bhutan", code: "975", iso: "BT" }, { country: "Bolivia", code: "591", iso: "BO" }, { country: "Bosnia and Herzegovina", code: "387", iso: "BA" }, { country: "Botswana", code: "267", iso: "BW" }, { country: "Brazil", code: "55", iso: "BR" }, { country: "British Indian Ocean Territory", code: "246", iso: "IO" }, { country: "British Virgin Islands", code: "1-284", iso: "VG" }, { country: "Brunei", code: "673", iso: "BN" }, { country: "Bulgaria", code: "359", iso: "BG" }, { country: "Burkina Faso", code: "226", iso: "BF" }, { country: "Burundi", code: "257", iso: "BI" }, { country: "Cambodia", code: "855", iso: "KH" }, { country: "Cameroon", code: "237", iso: "CM" }, { country: "Cape Verde", code: "238", iso: "CV" }, { country: "Cayman Islands", code: "1-345", iso: "KY" }, { country: "Central African Republic", code: "236", iso: "CF" }, { country: "Chad", code: "235", iso: "TD" }, { country: "Chile", code: "56", iso: "CL" }, { country: "China", code: "86", iso: "CN" }, { country: "Christmas Island", code: "61", iso: "CX" }, { country: "Cocos Islands", code: "61", iso: "CC" }, { country: "Colombia", code: "57", iso: "CO" }, { country: "Comoros", code: "269", iso: "KM" }, { country: "Cook Islands", code: "682", iso: "CK" }, { country: "Costa Rica", code: "506", iso: "CR" }, { country: "Croatia", code: "385", iso: "HR" }, { country: "Cuba", code: "53", iso: "CU" }, { country: "Curacao", code: "599", iso: "CW" }, { country: "Cyprus", code: "357", iso: "CY" }, { country: "Czech Republic", code: "420", iso: "CZ" }, { country: "Democratic Republic of the Congo", code: "243", iso: "CD" }, { country: "Denmark", code: "45", iso: "DK" }, { country: "Djibouti", code: "253", iso: "DJ" }, { country: "Dominica", code: "1-767", iso: "DM" }, { country: "Dominican Republic", code: "1-809, 1-829, 1-849", iso: "DO" }, { country: "East Timor", code: "670", iso: "TL" }, { country: "Ecuador", code: "593", iso: "EC" }, { country: "Egypt", code: "20", iso: "EG" }, { country: "El Salvador", code: "503", iso: "SV" }, { country: "Equatorial Guinea", code: "240", iso: "GQ" }, { country: "Eritrea", code: "291", iso: "ER" }, { country: "Estonia", code: "372", iso: "EE" }, { country: "Ethiopia", code: "251", iso: "ET" }, { country: "Falkland Islands", code: "500", iso: "FK" }, { country: "Faroe Islands", code: "298", iso: "FO" }, { country: "Fiji", code: "679", iso: "FJ" }, { country: "Finland", code: "358", iso: "FI" }, { country: "France", code: "33", iso: "FR" }, { country: "French Polynesia", code: "689", iso: "PF" }, { country: "Gabon", code: "241", iso: "GA" }, { country: "Gambia", code: "220", iso: "GM" }, { country: "Georgia", code: "995", iso: "GE" }, { country: "Germany", code: "49", iso: "DE" }, { country: "Ghana", code: "233", iso: "GH" }, { country: "Gibraltar", code: "350", iso: "GI" }, { country: "Greece", code: "30", iso: "GR" }, { country: "Greenland", code: "299", iso: "GL" }, { country: "Grenada", code: "1-473", iso: "GD" }, { country: "Guam", code: "1-671", iso: "GU" }, { country: "Guatemala", code: "502", iso: "GT" }, { country: "Guernsey", code: "44-1481", iso: "GG" }, { country: "Guinea", code: "224", iso: "GN" }, { country: "Guinea-Bissau", code: "245", iso: "GW" }, { country: "Guyana", code: "592", iso: "GY" }, { country: "Haiti", code: "509", iso: "HT" }, { country: "Honduras", code: "504", iso: "HN" }, { country: "Hong Kong", code: "852", iso: "HK" }, { country: "Hungary", code: "36", iso: "HU" }, { country: "Iceland", code: "354", iso: "IS" }, { country: "India", code: "91", iso: "IN" }, { country: "Indonesia", code: "62", iso: "ID" }, { country: "Iran", code: "98", iso: "IR" }, { country: "Iraq", code: "964", iso: "IQ" }, { country: "Ireland", code: "353", iso: "IE" }, { country: "Isle of Man", code: "44-1624", iso: "IM" }, { country: "Israel", code: "972", iso: "IL" }, { country: "Italy", code: "39", iso: "IT" }, { country: "Ivory Coast", code: "225", iso: "CI" }, { country: "Jamaica", code: "1-876", iso: "JM" }, { country: "Japan", code: "81", iso: "JP" }, { country: "Jersey", code: "44-1534", iso: "JE" }, { country: "Jordan", code: "962", iso: "JO" }, { country: "Kazakhstan", code: "7", iso: "KZ" }, { country: "Kenya", code: "254", iso: "KE" }, { country: "Kiribati", code: "686", iso: "KI" }, { country: "Kosovo", code: "383", iso: "XK" }, { country: "Kuwait", code: "965", iso: "KW" }, { country: "Kyrgyzstan", code: "996", iso: "KG" }, { country: "Laos", code: "856", iso: "LA" }, { country: "Latvia", code: "371", iso: "LV" }, { country: "Lebanon", code: "961", iso: "LB" }, { country: "Lesotho", code: "266", iso: "LS" }, { country: "Liberia", code: "231", iso: "LR" }, { country: "Libya", code: "218", iso: "LY" }, { country: "Liechtenstein", code: "423", iso: "LI" }, { country: "Lithuania", code: "370", iso: "LT" }, { country: "Luxembourg", code: "352", iso: "LU" }, { country: "Macao", code: "853", iso: "MO" }, { country: "Macedonia", code: "389", iso: "MK" }, { country: "Madagascar", code: "261", iso: "MG" }, { country: "Malawi", code: "265", iso: "MW" }, { country: "Malaysia", code: "60", iso: "MY" }, { country: "Maldives", code: "960", iso: "MV" }, { country: "Mali", code: "223", iso: "ML" }, { country: "Malta", code: "356", iso: "MT" }, { country: "Marshall Islands", code: "692", iso: "MH" }, { country: "Mauritania", code: "222", iso: "MR" }, { country: "Mauritius", code: "230", iso: "MU" }, { country: "Mayotte", code: "262", iso: "YT" }, { country: "Mexico", code: "52", iso: "MX" }, { country: "Micronesia", code: "691", iso: "FM" }, { country: "Moldova", code: "373", iso: "MD" }, { country: "Monaco", code: "377", iso: "MC" }, { country: "Mongolia", code: "976", iso: "MN" }, { country: "Montenegro", code: "382", iso: "ME" }, { country: "Montserrat", code: "1-664", iso: "MS" }, { country: "Morocco", code: "212", iso: "MA" }, { country: "Mozambique", code: "258", iso: "MZ" }, { country: "Myanmar", code: "95", iso: "MM" }, { country: "Namibia", code: "264", iso: "NA" }, { country: "Nauru", code: "674", iso: "NR" }, { country: "Nepal", code: "977", iso: "NP" }, { country: "Netherlands", code: "31", iso: "NL" }, { country: "Netherlands Antilles", code: "599", iso: "AN" }, { country: "New Caledonia", code: "687", iso: "NC" }, { country: "New Zealand", code: "64", iso: "NZ" }, { country: "Nicaragua", code: "505", iso: "NI" }, { country: "Niger", code: "227", iso: "NE" }, { country: "Nigeria", code: "234", iso: "NG" }, { country: "Niue", code: "683", iso: "NU" }, { country: "North Korea", code: "850", iso: "KP" }, { country: "Northern Mariana Islands", code: "1-670", iso: "MP" }, { country: "Norway", code: "47", iso: "NO" }, { country: "Oman", code: "968", iso: "OM" }, { country: "Pakistan", code: "92", iso: "PK" }, { country: "Palau", code: "680", iso: "PW" }, { country: "Palestine", code: "970", iso: "PS" }, { country: "Panama", code: "507", iso: "PA" }, { country: "Papua New Guinea", code: "675", iso: "PG" }, { country: "Paraguay", code: "595", iso: "PY" }, { country: "Peru", code: "51", iso: "PE" }, { country: "Philippines", code: "63", iso: "PH" }, { country: "Pitcairn", code: "64", iso: "PN" }, { country: "Poland", code: "48", iso: "PL" }, { country: "Portugal", code: "351", iso: "PT" }, { country: "Puerto Rico", code: "1-787, 1-939", iso: "PR" }, { country: "Qatar", code: "974", iso: "QA" }, { country: "Republic of the Congo", code: "242", iso: "CG" }, { country: "Reunion", code: "262", iso: "RE" }, { country: "Romania", code: "40", iso: "RO" }, { country: "Russia", code: "7", iso: "RU" }, { country: "Rwanda", code: "250", iso: "RW" }, { country: "Saint Barthelemy", code: "590", iso: "BL" }, { country: "Saint Helena", code: "290", iso: "SH" }, { country: "Saint Kitts and Nevis", code: "1-869", iso: "KN" }, { country: "Saint Lucia", code: "1-758", iso: "LC" }, { country: "Saint Martin", code: "590", iso: "MF" }, { country: "Saint Pierre and Miquelon", code: "508", iso: "PM" }, { country: "Saint Vincent and the Grenadines", code: "1-784", iso: "VC" }, { country: "Samoa", code: "685", iso: "WS" }, { country: "San Marino", code: "378", iso: "SM" }, { country: "Sao Tome and Principe", code: "239", iso: "ST" }, { country: "Saudi Arabia", code: "966", iso: "SA" }, { country: "Senegal", code: "221", iso: "SN" }, { country: "Serbia", code: "381", iso: "RS" }, { country: "Seychelles", code: "248", iso: "SC" }, { country: "Sierra Leone", code: "232", iso: "SL" }, { country: "Singapore", code: "65", iso: "SG" }, { country: "Sint Maarten", code: "1-721", iso: "SX" }, { country: "Slovakia", code: "421", iso: "SK" }, { country: "Slovenia", code: "386", iso: "SI" }, { country: "Solomon Islands", code: "677", iso: "SB" }, { country: "Somalia", code: "252", iso: "SO" }, { country: "South Africa", code: "27", iso: "ZA" }, { country: "South Korea", code: "82", iso: "KR" }, { country: "South Sudan", code: "211", iso: "SS" }, { country: "Spain", code: "34", iso: "ES" }, { country: "Sri Lanka", code: "94", iso: "LK" }, { country: "Sudan", code: "249", iso: "SD" }, { country: "Suriname", code: "597", iso: "SR" }, { country: "Svalbard and Jan Mayen", code: "47", iso: "SJ" }, { country: "Swaziland", code: "268", iso: "SZ" }, { country: "Sweden", code: "46", iso: "SE" }, { country: "Switzerland", code: "41", iso: "CH" }, { country: "Syria", code: "963", iso: "SY" }, { country: "Taiwan", code: "886", iso: "TW" }, { country: "Tajikistan", code: "992", iso: "TJ" }, { country: "Tanzania", code: "255", iso: "TZ" }, { country: "Thailand", code: "66", iso: "TH" }, { country: "Togo", code: "228", iso: "TG" }, { country: "Tokelau", code: "690", iso: "TK" }, { country: "Tonga", code: "676", iso: "TO" }, { country: "Trinidad and Tobago", code: "1-868", iso: "TT" }, { country: "Tunisia", code: "216", iso: "TN" }, { country: "Turkey", code: "90", iso: "TR" }, { country: "Turkmenistan", code: "993", iso: "TM" }, { country: "Turks and Caicos Islands", code: "1-649", iso: "TC" }, { country: "Tuvalu", code: "688", iso: "TV" }, { country: "U.S. Virgin Islands", code: "1-340", iso: "VI" }, { country: "Uganda", code: "256", iso: "UG" }, { country: "Ukraine", code: "380", iso: "UA" }, { country: "United Arab Emirates", code: "971", iso: "AE" }, { country: "United Kingdom", code: "44", iso: "GB" }, { country: "United States", code: "1", iso: "US" }, { country: "Uruguay", code: "598", iso: "UY" }, { country: "Uzbekistan", code: "998", iso: "UZ" }, { country: "Vanuatu", code: "678", iso: "VU" }, { country: "Vatican", code: "379", iso: "VA" }, { country: "Venezuela", code: "58", iso: "VE" }, { country: "Vietnam", code: "84", iso: "VN" }, { country: "Wallis and Futuna", code: "681", iso: "WF" }, { country: "Western Sahara", code: "212", iso: "EH" }, { country: "Yemen", code: "967", iso: "YE" }, { country: "Zambia", code: "260", iso: "ZM" }, { country: "Zimbabwe", code: "263", iso: "ZW" }]; DOMUtils.div = e => DOMUtils.createElement("div", e); DOMUtils.span = e => DOMUtils.createElement("span", e); DOMUtils.h1 = e => DOMUtils.createElement("h1", e); DOMUtils.h2 = e => DOMUtils.createElement("h2", e); DOMUtils.h3 = e => DOMUtils.createElement("h3", e); DOMUtils.h4 = e => DOMUtils.createElement("h4", e); DOMUtils.p = e => DOMUtils.createElement("p", e); DOMUtils.b = e => DOMUtils.createElement("b", e); DOMUtils.label = e => DOMUtils.createElement("label", e); DOMUtils.input = e => DOMUtils.createElement("input", e); DOMUtils.button = e => DOMUtils.createElement("button", e); DOMUtils.textarea = e => DOMUtils.createElement("textarea", e); DOMUtils.ul = e => DOMUtils.createElement("ul", e); DOMUtils.li = e => DOMUtils.createElement("li", e); DOMUtils.select = e => DOMUtils.createElement("select", e); DOMUtils.option = e => DOMUtils.createElement("option", e); DOMUtils.img = e => DOMUtils.createElement("img", e); DOMUtils.anchor = e => DOMUtils.createElement("a", e); DOMUtils.br = e => DOMUtils.createElement("br", e); DOMUtils.table = e => DOMUtils.createElement("table", e); DOMUtils.thead = e => DOMUtils.createElement("thead", e); DOMUtils.tbody = e => DOMUtils.createElement("tbody", e); DOMUtils.tr = e => DOMUtils.createElement("tr", e); DOMUtils.td = e => DOMUtils.createElement("td", e); DOMUtils.th = e => DOMUtils.createElement("th", e); DOMUtils.colgroup = e => DOMUtils.createElement("colgroup", e); DOMUtils.col = e => DOMUtils.createElement("col", e); DOMUtils.textNode = e => document.createTextNode(e); e.DOMUtils = DOMUtils })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (t) { var n; (function (t) { let n; (function (e) { e[e["Lossy"] = 0] = "Lossy"; e[e["High"] = 1] = "High" })(n = t.EQualityImage || (t.EQualityImage = {})); class DicomBufferRenderer { static GetWLFromImage(e) { if (e === null || e["dicomTags"] === undefined) return; var n = e["buffer"]; var s = parseInt(e["dicomTags"]["0028_0002"]); var a = Number.MAX_VALUE; var r = Number.MIN_VALUE; var o; var l = 0; var c = 1; var d = 0; var h = false; var u; var f; if (e["photometric"] !== undefined) { if (e["photometric"].toUpperCase() === "MONOCHROME1") h = true } if (e["dicomTags"]["0028_1050"] && e["dicomTags"]["0028_1051"]) { e["WLDicomTag"] = e["dicomTags"]["0028_1050"]; e["WWDicomTag"] = e["dicomTags"]["0028_1051"] } else { e["WLDicomTag"] = undefined; e["WWDicomTag"] = undefined } if (e.TransferSyntax === "1.2.840.10008.1.2.4.50") { h = t.SequenceLUT.InvertImageForLut(e); if (s === 1) { d = n.length; for (var p = 0; p < d; p++) { o = n[p] * c + l; a = Math.min(o, a); r = Math.max(o, r) } e["dicomTags"]["minValue"] = a; e["dicomTags"]["maxValue"] = r; u = parseInt((r - a).toString()); f = parseInt((a + u / 2).toString()); e["dicomTags"]["0028_1050"] = f; e["dicomTags"]["0028_1051"] = u } else { u = 256; f = 128; e["dicomTags"]["0028_1050"] = f; e["dicomTags"]["0028_1051"] = u } } else { if (e["dicomTags"]["0028_1052"] !== undefined && e["dicomTags"]["0028_1053"] !== undefined) { l = parseInt(e["dicomTags"]["0028_1052"]); c = parseInt(e["dicomTags"]["0028_1053"]) } d = n.length; for (var m = 0; m < d; m++) { o = n[m] * c + l; a = Math.min(o, a); r = Math.max(o, r) } e["dicomTags"]["minValue"] = a; e["dicomTags"]["maxValue"] = r; u = parseInt((r - a).toString()); f = parseInt((a + u / 2).toString()); if (e["dicomTags"]["0028_1050"] === undefined || e["dicomTags"]["0028_1051"] === undefined) { e["dicomTags"]["0028_1050"] = f; e["dicomTags"]["0028_1051"] = u } } e["WLEvue"] = f; e["WWEvue"] = u; e["dicomTags"]["invert"] = h } static ProcessBuffer(e, t, n, s, a = -1, r = false) { if (e === null || e["dicomTags"] === undefined) return; var o = e["buffer"]; var l = parseInt(e["dicomTags"]["0028_0011"]); var c = parseInt(e["dicomTags"]["0028_0010"]); var d = parseInt(e["dicomTags"]["0028_0002"]); var h = (e["photometric"] || "").toString().trim().toUpperCase(); var u = e["dicomTags"]["0008_0060"]; var f = parseInt(e["dicomTags"]["0028_1053"]); var p = parseInt(e["dicomTags"]["0028_1052"]); var m = e["dicomTags"]["0002_0010"]; var g = l * c * d; var C = document.createElement("canvas"); C.width = l; C.height = c; var v = C.getContext("2d"); var E = v.createImageData(l, c); var y = false; if (h === "" || h.indexOf("MONOCHROME") === 0 || d === 1) { let e = false; if (u === "CT" && h === "MONOCHROME2" && p < 0) e = true; if (t) y = DicomBufferRenderer.processMonochromeInvert(o, E, g, n, s, e, f, p); else y = DicomBufferRenderer.processMonochrome(o, E, g, n, s, e, f, p) } else if (d === 3) { if (m === "1.2.840.10008.1.2.4.50") { if (t) y = DicomBufferRenderer.processJpegInvert(o, E, n, s, r); else y = DicomBufferRenderer.processJpeg(o, E, n, s, r, h) } else { y = DicomBufferRenderer.processColor(o, E, g, h, l) } } v.putImageData(E, 0, 0); return { canvasObject: C, contextFilled: y } } static GetThumbnailFromImage(s, a, r = 0) { let o = new t.ImageEntityBase; o["dicomTags"] = s["dicomTags"]; o.TransferSyntax = s.TransferSyntax; let l = s["bufferOriginalBase"]; let c; if (s.TransferSyntax === "1.2.840.10008.1.2.4.50") c = n.Lossy; else c = n.High; let d; try { switch (c) { case n.Lossy: let s = new Image; s.onload = e => { let t = document.createElement("canvas"); let n = t.getContext("2d"); if (s.width >= s.height) { let e = 120; t.width = e; t.height = t.width * (s.height / s.width) } else { let e = 120; t.height = e; t.width = t.height * (s.width / s.height) } n.drawImage(s, 0, 0, t.width, t.height); if (e.target.getAttribute("invertThumb") === "true") { var r = n.getImageData(0, 0, t.width, t.height); for (let e = 0; e < r.data.length; e += 4) { r.data[e] = 255 - r.data[e]; r.data[e + 1] = 255 - r.data[e + 1]; r.data[e + 2] = 255 - r.data[e + 2]; r.data[e + 3] = 255 } n.putImageData(r, 0, 0) } let o = t.toDataURL(); a(o) }; t.DicomBufferRenderer.GetFramesBuffer(o, l); if (o["buffer"] !== null) { d = l } else { d = o["bufferArray"][r]; o["buffer"] = d } let c = window.btoa(t.Utils.Uint8ToString(d)); let u = "data:image/jpeg;base64," + c; const f = t.SequenceLUT.InvertImageForLut(o); if (f) { s.setAttribute("invertThumb", "true") } s.src = u; break; case n.High: t.DicomBufferRenderer.GetFramesBuffer(o, l); if (o["buffer"] !== null) { d = l } else { d = o["bufferArray"][r]; o["buffer"] = d } let p = parseInt(o["dicomTags"]["0028_1050"] || 0); let m = parseInt(o["dicomTags"]["0028_1051"] || 1); let g = parseInt(o["dicomTags"]["0028_0011"]); let C = parseInt(o["dicomTags"]["0028_0010"]); let v = e.Frontend.WebClient.DicomBufferRenderer.ProcessBuffer(o, o["dicomTags"]["invert"], m, p, r, false); let E = document.createElement("canvas"); let y = E.getContext("2d"); if (g >= C) { E.width = 120; E.height = E.width * (C / g) } else { E.height = 120; E.width = E.height * (g / C) } y.drawImage(v.canvasObject, 0, 0, E.width, E.height); var h = E.toDataURL(); a(h); break } } catch (e) { t.Utils.DebugConsoleLog(e); a(null) } } static GetFramesBuffer(e, n) { var s = e["dicomTags"]; var a = s["0028_0008"] !== undefined ? parseInt(s["0028_0008"]) : 1; var r = (e["photometric"] || "").toString().trim().toUpperCase(); if (a === 1) { let s = new t.SequenceLUT(e); e["buffer"] = s.AnalizeLUT(n) } else { e["bufferArray"] = new Array; var o; if (e.TransferSyntax === "1.2.840.10008.1.2.4.50") { var l = 0; var c = [[255, 216, 255, 224], [255, 216, 255, 219], [255, 216, 255, 238], [255, 216, 255, 225]]; if (!n.buffer) { let t = n; for (let n = 0; n < t.length; n++) { e: for (let s = 0; s < c.length; s++) { if (t[n][0] === c[s][0] && t[n][1] === c[s][1] && t[n][2] === c[s][2] && t[n][3] === c[s][3]) { e["bufferArray"].push(t[n]); break e } } } } else { var d = 0; var h = 0; while (l < c.length) { var u = c[l]; for (var f = 0; f < n.byteLength; f++) { if (n[f] === u[0] && n[f + 1] === u[1] && n[f + 2] === u[2] && n[f + 3] === u[3]) { d = f; for (var p = d + 1; p < n.byteLength; p++) { if (n[p] === u[0] && n[p + 1] === u[1] && n[p + 2] === u[2] && n[p + 3] === u[3] || e["bufferArray"].length + 1 === a) { if (e["bufferArray"].length + 1 === a) { h = p = n.byteLength } else { h = p - 8 } o = new Uint8Array(n.slice(d, h)); f = p - 1; e["bufferArray"].push(o); break } } } } if (e["bufferArray"].length === 0) l++; else l = c.length } } } else if (e.TransferSyntax === "1.2.840.10008.1.2.1") { var m = parseInt(s["0028_0011"]) * parseInt(s["0028_0010"]) * parseInt(s["0028_0002"]); if (r === "YBR_FULL_422") m = parseInt(s["0028_0011"]) * parseInt(s["0028_0010"]); var g = 0; for (var C = 0; C < a; C++) { var v = n.slice(g, g + m); g += m; e["bufferArray"].push(v) } } e["buffer"] = null } } static processMonochrome(e, t, n, s, a, r, o, l) { var c = false; try { var d = new Uint32Array(t.data.buffer); var h = a - s / 2; var u = a + s / 2; var f = s / 255; for (var p = n; p--;) { var m = e[p]; if (r) m = m * o + l; if (m <= h) { d[p] = 4278190080 } else if (m >= u) { d[p] = 4294967295 } else { var g = (m - h) / f | 0; d[p] = g * 65793 | 4278190080 } } c = true } catch (e) { c = false } return c } static processMonochromeInvert(e, t, n, s, a, r, o, l) { var c = false; try { var d = new Uint32Array(t.data.buffer); var h = a - s / 2; var u = a + s / 2; var f = s / 255; for (var p = n; p--;) { var m = e[p]; if (r) m = m * o + l; if (m <= h) { d[p] = 4294967295 } else if (m >= u) { d[p] = 4278190080 } else { var g = 255 - ((m - h) / f | 0); d[p] = g * 65793 | 4278190080 } } c = true } catch (e) { c = false } return c } static processColor(e, t, n, s, a, ...r) { var o = false; try { if (s.includes("YBR")) { let n; let r; let l; switch (s) { case "YBR_FULL_422": n = new Uint8ClampedArray(t.data.buffer); r = new Uint8Array(e.buffer); l = r.length; for (let e = 0, t = 0, s = 0; e < l;) { let o = r[e++]; let l = r[e++]; let c = r[e++]; let d = r[e++]; let h = o + 1.402 * (d - 128); let u = o + .34414 * (c - 128) - .71414 * (d - 128); let f = o + 1.772 * (c - 128); n[t++] = h; n[t++] = u; n[t++] = f; n[t++] = 255; if (++s === a) { s = 0; continue } let p = l + 1.402 * (d - 128); let m = l + .34414 * (c - 128) - .71414 * (d - 128); let g = l + 1.772 * (c - 128); n[t++] = p; n[t++] = m; n[t++] = g; n[t++] = 255; if (++s === a) s = 0 } break; case "YBR_FULL": n = new Uint8ClampedArray(t.data.buffer); r = new Uint8Array(e.buffer); l = r.length; for (let e = 0, t = 0; e < l; e += 3) { let s = r[e + 0]; let a = r[e + 1]; let o = r[e + 2]; n[t++] = s + 1.402 * (o - 128) + .5; n[t++] = s - .3441 * (a - 128) - .7141 * (o - 128) + .5; n[t++] = s + 1.772 * (a - 128) + .5; n[t++] = 255 } break; case "YBR_PARTIAL_422": n = new Uint8ClampedArray(t.data.buffer); r = new Uint8Array(e.buffer); l = r.length; for (let e = 0, t = 0, s = 0; e < l;) { let o = r[e++]; let l = r[e++]; let c = r[e++]; let d = r[e++]; let h = 1.1644 * (o - 16) + 1.596 * (d - 128) + .5; let u = 1.1644 * (o - 16) - .3917 * (c - 128) - .813 * (d - 128) + .5; let f = 1.1644 * (o - 16) + 2.0173 * (c - 128) + .5; n[t++] = h; n[t++] = u; n[t++] = f; n[t++] = 255; if (++s === a) { s = 0; continue } let p = 1.1644 * (l - 16) + 1.596 * (d - 128) + .5; let m = 1.1644 * (l - 16) - .3917 * (c - 128) - .813 * (d - 128) + .5; let g = 1.1644 * (l - 16) + 2.0173 * (c - 128) + .5; n[t++] = p; n[t++] = m; n[t++] = g; n[t++] = 255; if (++s === a) s = 0 } break }o = true } else if (s === "PALETTE COLOR") { n = r[0]["0028_1101"]; let e = r[0]["0028_1201"]; let s = r[0]["0028_1202"]; let a = r[0]["0028_1203"]; for (let r = 0, o = 0; r < n; r++) { t.data[o++] = e[r]; t.data[o++] = s[r]; t.data[o++] = a[r]; t.data[o++] = 255 } } else { for (var l = 0, c = 0; l < n;) { t.data[c++] = e[l++]; t.data[c++] = e[l++]; t.data[c++] = e[l++]; t.data[c++] = 255 } o = true } } catch (e) { o = false } return o } static processJpeg(e, t, n, s, a, r) { var o = false; try { var l = s - n / 2; var c = n / 255; var d = e.length; var h; var u = new Uint8ClampedArray(t.data.buffer); if (e.constructor.name === "Uint8ClampedArray") { for (var f = d; f--;) { if (!a) { u[f--] = 255 } else { h = (e[f] - l) / c; u[f--] = h } h = (e[f] - l) / c; u[f--] = h; h = (e[f] - l) / c; u[f--] = h; h = (e[f] - l) / c; u[f] = h } o = true } } catch (e) { o = false } return o } static processJpegInvert(e, t, n, s, a) { var r = false; try { var o = s - n / 2; var l = n / 255; var c = e.length; var d; var h = new Uint8ClampedArray(t.data.buffer); if (e.constructor.name === "Uint8ClampedArray") { for (var u = c; u--;) { if (!a) { h[u--] = 255 } else { d = (e[u] - o) / l; h[u--] = 255 - d } d = (e[u] - o) / l; h[u--] = 255 - d; d = (e[u] - o) / l; h[u--] = 255 - d; d = (e[u] - o) / l; h[u] = 255 - d } r = true } } catch (e) { r = false } return r } } t.DicomBufferRenderer = DicomBufferRenderer })(n = t.WebClient || (t.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class FloatingbarItem { constructor(e, t) { this.Item = e; this.Display = t } } e.FloatingbarItem = FloatingbarItem; class FloatingBar { constructor(t, n, s) { this.Offset = { x: 0, y: 0 }; this.Position = { x: 0, y: 0 }; this.Dragging = false; this.Resizing = false; this.Parent = t; this.Element = document.createElement("div"); this.ResizeCallback = s; if (n !== undefined && n !== null && n !== "") e.DOMUtils.AddClass(this.Element, n); else e.DOMUtils.AddClass(this.Element, "floatingTopBar"); this.Parent.appendChild(this.Element); this.Position["x"] = 0; this.Position["y"] = 0; this.Element.style.left = this.Position["x"] + "px"; this.Element.style.top = this.Position["y"] + "px"; if (!document.documentElement.hasAttribute("floatingBarResize")) { window.addEventListener("resize", (() => { if (this.Element) { document.documentElement.setAttribute("floatingBarResize", "true"); if (this.Element.classList.contains("static")) this.SetStaticPosition(); if (this.Position["x"] + 30 > document.documentElement.clientWidth) { this.Position["x"] = document.documentElement.clientWidth - 30; this.Element.style.left = this.Position["x"] + "px" } if (this.Position["y"] + 30 > document.documentElement.clientHeight) { this.Position["y"] = document.documentElement.clientHeight - 30; this.Element.style.top = this.Position["y"] + "px" } } })) } } GetPosition() { return this.Position } SetPosition(e, t) { this.Position = { x: e, y: t }; this.Element.style.left = this.Position["x"] + "px"; this.Element.style.top = this.Position["y"] + "px" } Show() { this.Element.style.display = "flex"; if (this.PostActionShow !== undefined && this.PostActionShow !== null) this.PostActionShow(); let t = this.Element.getElementsByClassName("resizerBar"); if (t.length > 0) e.DOMUtils.RemoveItem(t[0]); this.resizerBar = document.createElement("div"); e.DOMUtils.AddClass(this.resizerBar, "resizerBar"); this.Element.appendChild(this.resizerBar); var n = new Hammer.Manager(this.resizerBar); n = new Hammer(this.resizerBar); n.get("pan").set({ direction: Hammer.DIRECTION_ALL, threshold: 0, pointers: 0 }); n.on("panstart panmove panend pancancel press pressup", (e => { if (this.IsEmptyContainer()) return; switch (e.type) { case "panstart": this.Resizing = true; this.StartingHeight = this.Element.childNodes[0].clientHeight; this.ContentStartingHeight = this.ContentBox.clientHeight - 10; this.ResizerStartY = this.resizerBar.offsetTop + this.Element.offsetTop + (e.center.y - (this.resizerBar.offsetTop + this.Element.offsetTop)); break } })) } SetContentBox(e) { this.ContentBox = e } Hide() { this.Element.parentElement.style.height = "auto"; this.Element.style.display = "none"; this.Element.innerHTML = ""; if (this.ResizeCallback) this.ResizeCallback() } RemoveElement() { e.DOMUtils.RemoveItem(this.Element); this.Element = null } BuildForm(e, t) { this.Sections = e; this.SectionShowNumbers = t; e.forEach((e => { e.style.display = "none" })); t.forEach((t => { var n; if (!isNaN(t)) { n = e[t]; this.showSection(n, t) } else { var s = this.getIndexSection(this.Sections, t); n = e[s]; this.showSection(n, s) } })); this.Show() } IsDisplay() { return e.DOMUtils.IsDisplay(this.Element) } IsEmptyContainer() { var e; return ((e = this.Element.children) === null || e === void 0 ? void 0 : e.length) === 0 } SetStaticPosition() { this.Element.classList.add("static"); const e = document.querySelector(".viewportPane").clientHeight; this.Element.style.height = `${e}px`; this.Element.children[0].style.height = `${e - 5}px` } SetFloatingPosition() { this.Element.classList.remove("static"); this.Element.style.height = "auto"; this.Element.children[0].style.height = "" } showSection(e, t) { if (e) { e.style.display = "flex"; e.style.flexWrap = "wrap"; e.style.margin = "0px"; e.style.gap = "8px" } } getIndexSection(e, t) { var n = -1; e.forEach(((e, s) => { if (e.getAttribute("id") === t) n = s })); return n } } e.FloatingBar = FloatingBar })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { const t = 32; const n = 64; class FloatingBarManager { constructor() { this.floatingBars = new Array } CreateFloatingBar(t, n, s, a, r) { let o; this.rightDropPanel = document.querySelector(".right-drop-panel"); this.leftDropPanel = document.querySelector(".left-drop-panel"); if (s) { this.floatingBars.forEach((e => { if (e.NameUniqueTool === a) { o = e; o.Element.innerHTML = "" } })) } if (!o) { o = new e.FloatingBar(t, n, r); o.IsUniqueTool = s; o.NameUniqueTool = a; let l = e.Utils.GetGuid(); o.Id = l; o.Element.setAttribute("idFloating", l); this.createEvents(o); this.floatingBars.push(o) } return o } CalculatePosition(e) { var t = this.GetFloatingBar(e); if (this.floatingBars.length > 0) { let n; let s; let a = document.documentElement.clientWidth; let r = document.documentElement.clientHeight; let o = new Array; let l = new Array; this.floatingBars.forEach((t => { if (t.Id !== e) { let e = t.GetPosition(); o.push({ x0: e.x, x1: e.x + t.Element.clientWidth }); l.push({ y0: e.y, y1: e.y + t.Element.clientHeight }) } })); o = o.sort(((e, t) => e.x0 - t.x0)); l = l.sort(((e, t) => e.y0 - t.y0)); for (let e = 0; e < o.length; e++) { if (o[e].x0 - t.Element.clientWidth >= 0) { n = o[e].x0 - t.Element.clientWidth; break } else { if (o[e].x1 + t.Element.clientWidth <= a) { n = o[e].x1 + 10; for (let n = e + 1; n < o.length; n++) { if (o[e].x1 + t.Element.clientWidth < o[n].x0) { e = o.length; break } } } } } t.SetPosition(n !== null && n !== void 0 ? n : 0, s !== null && s !== void 0 ? s : 0) } else { t.SetPosition(0, 0) } } ShowFloatingBar(e) { let t = this.GetFloatingBar(e); if (t) { t.Show(); this.CalculatePosition(e) } } HideFloatingBar(e) { let t = this.GetFloatingBar(e); if (t) { this.HideDropPanel(t); t.Hide() } } RemoveFloatingBar(e) { let t = this.GetFloatingBar(e); if (t) { this.HideDropPanel(t); t.Hide(); t.RemoveElement(); let n = this.floatingBars.findIndex((t => t.Id === e)); this.floatingBars.splice(n, 1) } } RemoveAllInstancesFloatingBar() { for (let e = this.floatingBars.length - 1; e >= 0; e -= 1) { this.RemoveFloatingBar(this.floatingBars[e].Id) } this.floatingBars = new Array } GetFloatingBar(e) { let t = this.floatingBars.find((t => t.Id === e)); return t } GetFloatingBars() { return this.floatingBars } HideDropPanel(e) { if (e.Element.classList.contains("static")) { e.Element.classList.remove("static"); let t = e.Element.parentElement; if (t.classList.contains("right-drop-panel")) this.rightDropPanel.style.width = "0px"; if (t.classList.contains("left-drop-panel")) this.leftDropPanel.style.width = "0px" } } getidFloatingInParent(e) { if (!e.getAttribute("idFloating") && e !== document.body) return this.getidFloatingInParent(e.parentElement); else return e.getAttribute("idFloating") } createEvents(e) { let s = 0; var a = new Hammer.Manager(e.Element); a = new Hammer(e.Element); a.get("pan").set({ direction: Hammer.DIRECTION_ALL, threshold: 0, pointers: 0 }); a.on("panstart panmove panend pancancel press pressup", (e => { let t = this.getidFloatingInParent(e.target); if (!t) return; this.currentFloatingBar = this.GetFloatingBar(t); if (this.currentFloatingBar.IsEmptyContainer()) return; switch (e.type) { case "panstart": s = 0; var n = e.target.nodeName; if (n === "DIV" || n === "P") { if (!this.currentFloatingBar.Resizing && !e.target.classList.contains("orthoCissDialog")) { this.currentFloatingBar.Dragging = true; this.currentFloatingBar.Offset["x"] = this.currentFloatingBar.Element.offsetLeft - e.center.x; this.currentFloatingBar.Offset["y"] = this.currentFloatingBar.Element.offsetTop - e.center.y } } break } })); var r = new Hammer.Manager(document.body); r = new Hammer(document.body); r.get("pan").set({ direction: Hammer.DIRECTION_ALL, threshold: 0, pointers: 0 }); r.on("panstart panmove panend pancancel press pressup", (e => { if (this.currentFloatingBar && this.currentFloatingBar.Element) { const r = document.body.querySelector(".viewportPane"); const o = r.closest(".dockpanel"); const l = this.currentFloatingBar.Element.getBoundingClientRect(); const c = o.getBoundingClientRect(); const d = o.offsetLeft ? 10 + 4 : 0; if (this.currentFloatingBar.IsEmptyContainer()) return; switch (e.type) { case "panmove": if (this.currentFloatingBar.Resizing) { this.currentFloatingBar.Dragging = false; var a = e.center.y - this.currentFloatingBar.ResizerStartY; if (this.currentFloatingBar.StartingHeight + a >= this.currentFloatingBar.MinHeight) { this.currentFloatingBar.ContentBox.style.height = this.currentFloatingBar.ContentStartingHeight + a + "px"; this.currentFloatingBar.Element.style.height = this.currentFloatingBar.StartingHeight + a + "px" } } else if (this.currentFloatingBar.Dragging) { this.currentFloatingBar.Position["x"] = e.center.x + this.currentFloatingBar.Offset["x"]; this.currentFloatingBar.Position["y"] = e.center.y + this.currentFloatingBar.Offset["y"]; if (e.center.x - s > 50) { if (this.currentFloatingBar.Element.classList.contains("static")) { if (l.left + l.width - d > o.clientWidth + o.offsetLeft - t) { this.rightDropPanel.classList.add("highlight-drop-panel"); this.rightDropPanel.style.width = "0px"; this.currentFloatingBar.SetFloatingPosition(); s = 0; if (this.currentFloatingBar.ResizeCallback) this.currentFloatingBar.ResizeCallback() } if (l.left < o.offsetLeft + t) { this.leftDropPanel.classList.add("highlight-drop-panel"); this.leftDropPanel.style.width = "0px"; this.currentFloatingBar.SetFloatingPosition(); s = 0; if (this.currentFloatingBar.ResizeCallback) this.currentFloatingBar.ResizeCallback() } } } s = e.center.x; if (l.left + l.width - d > o.clientWidth + o.offsetLeft - n) { if (!this.rightDropPanel.classList.contains("highlight-drop-panel") && parseInt(this.rightDropPanel.style.width) === 0) { this.rightDropPanel.classList.add("highlight-drop-panel"); if (this.currentFloatingBar.ResizeCallback) this.currentFloatingBar.ResizeCallback() } } else { if (this.rightDropPanel.classList.contains("highlight-drop-panel")) { this.rightDropPanel.classList.remove("highlight-drop-panel"); if (this.currentFloatingBar.ResizeCallback) this.currentFloatingBar.ResizeCallback() } } if (l.left < o.offsetLeft + n) { if (!this.leftDropPanel.classList.contains("highlight-drop-panel") && parseInt(this.leftDropPanel.style.width) === 0) { this.leftDropPanel.classList.add("highlight-drop-panel"); if (this.currentFloatingBar.ResizeCallback) this.currentFloatingBar.ResizeCallback() } } else { if (this.leftDropPanel.classList.contains("highlight-drop-panel")) { this.leftDropPanel.classList.remove("highlight-drop-panel"); if (this.currentFloatingBar.ResizeCallback) this.currentFloatingBar.ResizeCallback() } } if (e.center.x > 30 && e.center.x < document.documentElement.clientWidth - 30) this.currentFloatingBar.Element.style.left = this.currentFloatingBar.Position["x"] + "px"; if (e.center.y > 30 && e.center.y < document.documentElement.clientHeight - 30) this.currentFloatingBar.Element.style.top = this.currentFloatingBar.Position["y"] + "px" } break; case "panend": if (e.center.x > 30 && e.center.x < document.documentElement.clientWidth - 30 && (this.currentFloatingBar.Dragging || this.currentFloatingBar.Resizing)) { const e = getComputedStyle(this.currentFloatingBar.Element); if (parseInt(this.rightDropPanel.style.width) === 0) { if (l.left + l.width > c.left + c.width - t) { this.rightDropPanel.classList.remove("highlight-drop-panel"); const t = parseInt(e.width, 10) + 12; this.rightDropPanel.style.width = `${t}px`; this.rightDropPanel.appendChild(this.currentFloatingBar.Element); this.currentFloatingBar.SetStaticPosition(); if (this.currentFloatingBar.ResizeCallback) this.currentFloatingBar.ResizeCallback() } } if (parseInt(this.leftDropPanel.style.width) === 0) { if (l.left < c.left + t) { this.leftDropPanel.classList.remove("highlight-drop-panel"); const t = parseInt(e.width, 10) + 12; this.leftDropPanel.style.width = `${t}px`; this.leftDropPanel.appendChild(this.currentFloatingBar.Element); this.currentFloatingBar.SetStaticPosition(); if (this.currentFloatingBar.ResizeCallback) this.currentFloatingBar.ResizeCallback() } } } if (this.currentFloatingBar.Dragging) this.currentFloatingBar.Dragging = false; if (this.currentFloatingBar.Resizing) this.currentFloatingBar.Resizing = false; if (this.leftDropPanel.classList.contains("highlight-drop-panel")) this.leftDropPanel.classList.remove("highlight-drop-panel"); if (this.rightDropPanel.classList.contains("highlight-drop-panel")) this.rightDropPanel.classList.remove("highlight-drop-panel"); this.currentFloatingBar = null; break; case "pancancel": if (this.currentFloatingBar.Dragging) this.currentFloatingBar.Dragging = false; if (this.currentFloatingBar.Resizing) this.currentFloatingBar.Resizing = false; this.currentFloatingBar = null; break } } })) } static getInstance() { if (!FloatingBarManager.instance) FloatingBarManager.instance = new FloatingBarManager; return FloatingBarManager.instance } } e.FloatingBarManager = FloatingBarManager })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class HipaaWarningBox extends e.MessageBox { constructor(t, n, s, a) { var r = { deleteRecoverMessage: "<p>By clicking on the Accept button, I declare the purpose of removing records or recover delete records containing protected health information as said information was inaccurate or incomplete, as per specified in HIPAA Privacy Rule, located at 45 CFR § 164.310(e)(2)(i).</p>", shareMessage: "<p>I have been assigned a user name and password by <b>Efferent Health</b>, which permits me to use eVue for the purpose of viewing images and obtaining my patients' clinical information. By clicking the link below, I agree that the issue of a user name and password and my use of such user name and password are subject to the following conditions:</p><p><ol style='padding-left: 12px;'><li>PASSWORD/USER NAME CONFIDENTIALITY. I will not divulge my password, user name, or any other information required to access eVue to any other person, nor shall I permit any other person to use my user name or password. I agree to make my best efforts to safeguard my user name and password so that they are not unintentionally divulged.</li><p></p><li>USE FOR TREATMENT ONLY. I will use my user name and password only to gain access to images of patients who I am currently treating or evaluating for treatment. I understand that I have no right to view images or other information about persons who are not my patients, and I agree that I will not do so.</li><p></p><li>COMPLIANCE WITH APPLICABLE LAW. I understand that eVue contains confidential information that may be protected under the Health Insurance Portability and Accountability Act of 1996, other federal laws, state law, and the ethics rules of the medical profession.</li><p></p><li>DUTY TO REPORT. I will contact my PACS Administrator immediately upon any of the following events:<ul style='list-style-type: lower-latin; padding-top: 5px;'><li> Learning that my patients’ images have been improperly accessed by a third party;</li><li> Learning that my password or user name is or has been in the possession of any third party; or</li><li> Learning of any other misuse of eVue.</li></ul></li></ol></p>" }; var o = { Id: "acceptDelete", Name: "accept", Text: "Accept", Action: () => { n() } }; var l = { Id: "declineDelete", Name: "decline", Text: "Decline", Action: () => { s() } }; o.ClassNames = ["green"]; l.ClassNames = ["red"]; super(a ? r[t] + a : r[t], [o, l]); const { div: c, img: d } = e.DOMUtils; const h = c({ style: { position: "relative", margin: "auto", padding: "5px", width: "max-content" }, children: [c({ style: { display: "inline-block" }, children: [d({ src: e.ResourceBag.Icons8CaduceusFilled50Png })] }), c({ innerHTML: "HIPAA WARNING", style: { display: "inline-block", marginLeft: "10px", verticalAlign: "top", paddingTop: "20px", fontSize: "15px" } })] }); this.Element.children[0].insertBefore(h, this.TextMessageBox) } } e.HipaaWarningBox = HipaaWarningBox })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["Void"] = 0] = "Void"; e[e["Pending"] = 1] = "Pending"; e[e["Abort"] = 2] = "Abort"; e[e["Ready"] = 3] = "Ready"; e[e["Done"] = 4] = "Done"; e[e["Error"] = 5] = "Error" })(t = e.ERequestAjaxStatus || (e.ERequestAjaxStatus = {})); class HttpUtils { static AjaxCall(e, t, n, s, a, r, o, l = null, c = null, d = null, h = null, u = null, f = null) { if (c !== null) c(); const p = new XMLHttpRequest; if (l !== null) p.addEventListener("progress", l, false); if (h !== null) { p.addEventListener("load", h, false); p.addEventListener("loadend", h, false) } if (d !== null) { p.addEventListener("error", d, false); p.addEventListener("abort", d, false) } p.open(t, e, true); if (u !== null) p.timeout = u; if (f !== null) p.ontimeout = f; if (typeof n !== "string") { if (sessionStorage["token"]) p.setRequestHeader("Authorization", "Bearer " + sessionStorage["token"]); if (n !== undefined && n !== null) { const e = Object.keys(n); e.forEach(((e, t, s) => { const a = n[e]; p.setRequestHeader(e, a) })) } } else if (typeof n === "string" && n === "min") { if (sessionStorage["token"]) p.setRequestHeader("Authorization", "Bearer " + sessionStorage["token"]) } if (o !== undefined && o !== null) p.responseType = o; p.onreadystatechange = () => { if (p.readyState === 4) { const t = /^2[0-9][0-9]$/; if (t.test(p.status.toString())) { let e; switch (p.responseType) { case "document": e = p.responseXML; break; case "arraybuffer": case "blob": e = p.response; break; case "json": case "text": case "": e = p.responseText; break; default: e = p.responseText; break }if (a !== undefined && o !== "blob") { a(p, e) } else { const e = Date.now() + ".zip"; const t = p.response; const n = document.createElement("a"); n.href = window.URL.createObjectURL(t); n.download = e; n.click() } if (HttpUtils.OnSuccessAjaxControl !== undefined) { HttpUtils.OnSuccessAjaxControl(p, p.status) } else { if (window["OnSuccessAjaxControl"] !== undefined) window["OnSuccessAjaxControl"](p, p.status) } } else { if (r !== undefined) r(p.status, p); if (HttpUtils.OnErrorAjaxControl !== undefined) { HttpUtils.OnErrorAjaxControl(e, p, p.status) } else { if (window["OnErrorAjaxControl"] !== undefined) window["OnErrorAjaxControl"](e, p, p.status) } } } }; if (s !== null && s !== undefined) p.send(s); else p.send(); return p } static GetUrlParameter(e) { e = e.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); const t = new RegExp("[\\?&]" + e + "=([^&#]*)"); const n = t.exec(location.search); return n === null ? "" : decodeURIComponent(n[1].replace(/\+/g, " ")) } static UpdateUrlToCurrentHost(e) { let t; try { const n = new URL(e); t = e.replace(n.host, location.host); t = t.replace(n.protocol, location.protocol) } catch (t) { e = HttpUtils.UpdateAbsoluteUrlToRelativeCurrenHost(e); this.UpdateUrlToCurrentHost(e); return } return t } static UpdateAbsoluteUrlToRelativeCurrenHost(e) { let t = e; try { const t = new URL(e) } catch (n) { t = location.protocol + "//" + location.host + (e.charAt(0) === "/" ? e : "/" + e) } return t } static GetRelativeUrl(e) { let t; try { t = new URL(e).pathname } catch (e) { t = null } return t } } e.HttpUtils = HttpUtils })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class ResizeStructure { constructor(e, t, n) { this.Id = e; this.ClassInstance = t; this.GroupName = n } } e.ResizeStructure = ResizeStructure; let t; (function (e) { e[e["Offline"] = 0] = "Offline"; e[e["Cloud"] = 1] = "Cloud" })(t = e.EViewerMode || (e.EViewerMode = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class JwtParser { constructor(t) { var n = t.split("."); if (n.length !== 3) throw new Error("Invalid JWT format"); this.Header = JSON.parse(e.Utils.DecodeBase64(n[0])); this.Payload = JSON.parse(e.Utils.DecodeBase64(n[1])); this.Signature = n[2] } Validate(e) { return false } } e.JwtParser = JwtParser })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class Dictionary { constructor(e) { this.LanguageManager = e } } e.Dictionary = Dictionary; class LanguageManager { constructor(e) { this.Dictionaries = {}; this.ServiceUrl = e } ChangeLanguage(e) { if (e === this.CurrentLanguage) return; this.CurrentLanguage = e } AddDictionary(e, t, n) { this.Dictionaries[t] = n; n["<URL>"] = e } GetValues(e) { var t = e.split(":"); if (t.length !== 2) return null; return this.GetValuesFromDict(t[0], t[1]) } GetValuesFromDict(e, t) { var n = this.Dictionaries[e]; if (n === undefined) return t.charAt(0).toUpperCase() + t.slice(1); var s = n[t]; if (s === undefined || s === null) return t.charAt(0).toUpperCase() + t.slice(1); return s } GetFormattedString(e, ...t) { var n = e.split(":"); if (n.length !== 2) return null; return this.GetFormattedStringFromDict(n[0], n[1], t) } GetFormattedStringFromDict(e, t, ...n) { var s = this.GetFormattedString(e, t); if (s === null) return null; return s.replace(/{(\d+)}/g, ((e, t) => typeof n[t] !== "undefined" ? n[t] : e)) } Clean() { this.Dictionaries = {} } } e.LanguageManager = LanguageManager })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class Loader { static Show(t) { return; this.instances++; var n = e.Utils.GetGuid(); var s = document.createElement("div"); s.id = "Loader" + n; s.innerHTML = e.ResourceBag.RingSvg; s.setAttribute("class", "loaderScreen"); s.style.height = window.innerHeight + "px"; s.style.width = window.innerWidth + "px"; if (t !== undefined) { var a = document.createElement("div"); a.setAttribute("class", "textLoader"); a.innerHTML = t; s.appendChild(a); setTimeout((() => { a.innerHTML = "The process is taking longer than expected. Please wait." }), 20 * 1e3) } if (this.instances === 1) document.body.appendChild(s); return s } static Hide(t) { this.instances--; if (this.instances < 0) this.instances = 0; try { var n; if (t) n = document.getElementById(t); else n = document.getElementsByClassName("loaderScreen")[0]; if (n !== null && n !== undefined && this.instances === 0) e.DOMUtils.RemoveItem(n) } catch (e) { setTimeout((() => { this.HideAll() }), 5250) } } static HideAll() { this.instances = 0; try { var t = document.getElementsByClassName("loaderScreen"); var n = Array.prototype.slice.call(t, 0); for (var s = 0; s < n.length; s++) { e.DOMUtils.RemoveItem(n[s]) } } catch (e) { } } static OnResize() { try { var e = document.getElementsByClassName("loaderScreen"); var t = Array.prototype.slice.call(e, 0); for (var n = 0; n < t.length; n++) { var s = t[n]; s.style.height = window.innerHeight + "px"; s.style.width = window.innerWidth + "px" } } catch (e) { } } } Loader.instances = 0; e.Loader = Loader })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class LocalStorage { static Initialize(e) { LocalStorage.username = e } static Get(e) { var t; var n = Object.keys(localStorage); n.forEach(((n, s, a) => { try { var r = n.split("~"); var o = r[0]; var l = r[1]; if (o === LocalStorage.username && l === e) { t = localStorage[n] } } catch (e) { t = undefined } })); return t } static Set(e, t) { localStorage[LocalStorage.username + "~" + e] = t } static Delete(e) { localStorage.removeItem(LocalStorage.username + "~" + e) } } e.LocalStorage = LocalStorage })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class LongRunningTaskDialog { static Show(t, n) { var s = document.createElement("div"); s.setAttribute("class", "longRunningTask"); var a = document.createElement("div"); a.classList.add("messageBox"); var r = document.createElement("div"); r.classList.add("message"); r.innerText = "This task may take some time. If so, you may close this window and you will be notified by email."; this.progress = document.createElement("div"); this.progress.style.marginBottom = "10px"; this.progress.innerHTML = "<b>Progress: </b>"; var o = document.createElement("div"); o.classList.add("loadingBar"); this.loadingBarProgress = document.createElement("div"); this.loadingBarProgress.classList.add("loadingBarProgress"); o.appendChild(this.loadingBarProgress); var l = document.createElement("button"); l.type = "button"; l.style.marginLeft = "auto"; l.classList.add("red", "inline"); l.innerText = "Close"; this.results = document.createElement("div"); this.results.classList.add("results"); s.appendChild(a); a.appendChild(r); a.appendChild(this.progress); a.appendChild(o); a.appendChild(this.results); a.appendChild(l); document.body.appendChild(s); this.timeoutValue = 1e4; this.progressValue = 0; this.tryCounter = 0; this.getTaskInfo(t); this.view = n; l.addEventListener("click", (() => { clearTimeout(this.timeout); s.remove(); if (this.view && this.progressValue >= 100) this.view.Refresh(); var t = e.HttpUtils.GetUrlParameter("showTask"); if (t !== "" && t !== null) { var n = ""; var a = window.location.href.substring(0, window.location.href.indexOf("?")); var r = new URLSearchParams(new URL(window.location.href).search); r.delete("showTask"); var o = r.entries(); var l = o.next(); while (!l.done) { n += l.value[0] + "=" + encodeURIComponent(l.value[1]) + "&"; l = o.next() } n = n.substr(0, n.length - 1); if (n !== "") { n = "?" + n } history.replaceState("", "", a + n) } })) } static getTaskInfo(t) { e.HttpUtils.AjaxCall(t, "GET", {}, undefined, (n => { switch (n.status) { case 200: { var s = JSON.parse(n.response); var a = parseInt(s["Progress"]); if (a > this.progressValue) { this.loadingBarProgress.style.width = a + "%"; this.progressValue = a } if (s.hasOwnProperty("Phase")) this.progress.innerHTML = "<b>Progress: </b>" + s["Phase"]; if (this.progressValue < 100) { this.timeout = setTimeout((() => { this.getTaskInfo(t) }), this.timeoutValue) } else { var r = s["OutputParametersDictionary"]; if (s["Status"] === "error") { this.loadingBarProgress.style.backgroundColor = e.Colors.Alizarin; this.progress.innerHTML = "<b>Progress: </b> the operation failed" } else { this.progress.innerHTML = "<b>Progress: </b> completed!" } for (var o in r) { if (r.hasOwnProperty(o)) { var l = r[o]; var c = typeof l; var d = o; var h = l; if (c === "string") { var u = l.indexOf("https://") !== -1; if (u) { d = "Download now"; h = "<a href='" + l + "'><button class='green inlineButton' style='height: 25px; width: 75px'>Click here</button></a>" } } if (c === "boolean") h = l === true ? "true" : "false"; if (c === "number") { if (d === "FileSize") h = (h / 1024 / 1024).toFixed(2) + "mb" } var f = document.createElement("div"); this.results.appendChild(f); f.innerHTML = "<b>" + d + ": </b>" + h } } this.results.style.display = "block" } break } default: { if (this.tryCounter <= 10) { this.tryCounter++; if (this.progressValue < 100) { this.timeout = setTimeout((() => { this.getTaskInfo(t) }), this.timeoutValue) } } else { this.results.innerHTML = ""; var p = "Connection with platform is lost"; var m = document.createElement("div"); m.style.color = e.Colors.Pomegranate; m.innerHTML = "<b>Result: </b>" + p; this.results.appendChild(m); this.results.style.display = "block" } break } } })) } } e.LongRunningTaskDialog = LongRunningTaskDialog })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class MapStructure { constructor() { this.IndexData = new Array; this.StructureData = {} } } e.MapStructure = MapStructure })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["DATE"] = 1] = "DATE"; e[e["MONTH"] = 2] = "MONTH"; e[e["YEAR"] = 3] = "YEAR" })(t || (t = {})); const { div: n, anchor: s, input: a } = e.DOMUtils; class MonthCalendar { constructor(e, n = false) { this.calContainer = e; this.onlySingle = n; this.calendarMode = t.DATE } GenerateCalendar(t) { const n = t || new Date; const s = n.getFullYear(); const a = n.getMonth(); const r = new Date(s, a, 1).getDay(); let o = e.CalendarUtils.GetDaysInMonth(a + 1, s); let l = 1; const generateRow = e => `<tr>${e}</tr>`; const generateCell = (t, n) => { const c = new Date(s, a, l); const d = l <= o && (t > 0 || n >= r); const h = e.CalendarUtils.IsToday(l, a, s) ? "today" : ""; const u = this.DayColor ? this.DayColor(c) || h : h; return d ? `<td class="${u}">${l++}</td>` : "<td>&nbsp;</td>" }; const c = `\n                <div>\n                    <table cellpadding=4 cellspacing=0 class="calendar-table">\n                        <thead>\n                            <tr>\n                                ${e.CalendarUtils.DaysOfTheWeek.map((e => `<th>${e.substr(0, 2).toUpperCase()}</th>`)).join("")}\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${Array(6).fill("").map(((e, t) => generateRow(Array(7).fill("").map(((e, n) => generateCell(t, n))).join("")))).join("")}\n                        </tbody>\n                    </table>\n\n                    ${this.rangeText ? `<div class="range-days">${this.rangeText}</div>` : ""}\n                </div>\n            `; this.calContainer.innerHTML = c } GenerateMonthPicker(t) { const n = e.CalendarUtils.Months.map(((n, s) => `\n                    <div class="${this.DayColor && s === t.getMonth() ? this.DayColor(t) : ""}"  data-month="${s}">\n                        ${e.CalendarUtils.GetShortMonthName(n)}\n                    </div>\n                `)).join(""); this.calContainer.innerHTML = `\n                <div class="grid-months">\n                    ${n}\n                </div>\n            ` } GenerateYearPicker(e) { const t = +e.getFullYear(); const n = Array(12).map((e => `<div class="year-option">${t + e - 6}</div>`)); this.calContainer.innerHTML = `\n                <div class="grid">\n                    ${n};\n                </div>\n            ` } GenerateHeader(r) { const o = e.CalendarUtils.Months[r.getMonth()]; const l = n({ className: "daterange_header", children: [n({ className: "daterange_prev", innerHTML: MonthCalendar.ARROW_PREVIOUS, onclick: () => this.moveMonth(r, -1) }), s({ href: "#", innerHTML: o, onclick: e => { e.preventDefault(); this.calendarMode = this.calendarMode === t.MONTH ? t.DATE : t.MONTH; this.UpdateCalendar(r) } }), this.editableYearLabel = a({ type: "text", className: "editableYearLabel", maxLength: 4, value: `${r.getFullYear()}`, onchange: () => { this.SetSpecificYear(this, parseInt(this.editableYearLabel.value), r) }, onkeydown: t => { const n = t.key; if (![e.Utils.INPUTKEY_NAMES.BACKSPACE, e.Utils.INPUTKEY_NAMES.TAB].includes(n)) { if (isNaN(+n)) { t.preventDefault(); t.stopPropagation(); return } } }, onclick: () => { document.execCommand("selectall") }, onblur: () => { if (this.editableYearLabel.value.length !== 4) alert("Please enter 4 digit year") } }), n({ className: this.onlySingle ? "daterange_next_alt" : "daterange_next", innerHTML: MonthCalendar.ARROW_NEXT, onclick: () => this.moveMonth(r, 1) })] }); this.calContainer.insertBefore(l, this.calContainer.firstChild) } UpdateCalendar(e, n) { switch (this.calendarMode) { case t.DATE: this.GenerateCalendar(e); break; case t.MONTH: this.GenerateMonthPicker(e); break; case t.YEAR: this.GenerateYearPicker(e); break }this.GenerateHeader(e) } setCalendarModeDays() { this.calendarMode = t.DATE; setTimeout((() => { this.setFocusOnEditableYear() }), 150) } setCalendarModeMonths() { this.calendarMode = t.MONTH } setFocusOnEditableYear() { this.editableYearLabel.focus(); const e = this.editableYearLabel.value; this.editableYearLabel.value = ""; this.editableYearLabel.value = e } moveMonth(e, t) { var n = this.addMonths(e, t); if (this.CanMoveTo && !this.CanMoveTo(this, n)) return; this.UpdateCalendar(n) } addMonths(e, t) { var n = (e = new Date(+e)).getDate(); e.setMonth(e.getMonth() + t, 1); var s = e.getMonth(); e.setDate(n); if (e.getMonth() !== s) e.setDate(0); return e } } MonthCalendar.ARROW_PREVIOUS = "&#9664;"; MonthCalendar.ARROW_NEXT = "&#9654;"; e.MonthCalendar = MonthCalendar })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class PlatformContext { static SetPlatformUri(t) { let n; const s = new URLSearchParams(window.location.search); if (s.get("host")) n = s.get("host"); else n = location.host; var a = t ? t.trim() : location.protocol + "//" + n; var r = a.substr(a.length - 1); if (r === "/") a = a.substring(0, a.length - 1); if (a.length === 0) { e.Toaster.ShowToast("The Platform URI is empty.", e.Colors.Alizarin, 5); return false } else { e.PlatformContext.PlatformUri = a; return true } } } e.PlatformContext = PlatformContext })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class PlotControlSeries { constructor(e, t) { this.Data = e; this.Label = t; this.Show = true } } e.PlotControlSeries = PlotControlSeries; class PlotControl { constructor(t) { this.currentSeries = 0; this.colors = ["#66CCEE", "#228833", "#CCBB44", "#EE6677", "#4477AA"]; this.gridColor = "#BBBBBB"; this.allSeries = []; this.parentContainer = t; this.canvas = document.createElement("canvas"); e.DOMUtils.AddClass(this.canvas, "dottedBorder"); this.context = this.canvas.getContext("2d"); this.canvas.width = t.offsetWidth - 2; this.canvas.height = 500; t.appendChild(this.canvas); this.LegendSection = document.createElement("div"); t.appendChild(this.LegendSection) } AddSeries(e, t) { this.allSeries.push(new PlotControlSeries(e, t)); var n = this.allSeries.length - 1; this.LegendSection.appendChild(this.createLegendLabel(t, n)) } ShowOnly(e) { for (var t = 0; t < this.allSeries.length; t++) { this.allSeries[t].Show = t === e } this.Render() } Clear() { this.allSeries = []; this.LegendSection.innerHTML = ""; this.width = this.canvas.width; this.height = this.canvas.height; this.context.clearRect(0, 0, this.width, this.height) } Render() { this.width = this.canvas.width; this.height = this.canvas.height; this.context.clearRect(0, 0, this.width, this.height); if (this.allSeries.length === 0) return; var e = this.allSeries[this.currentSeries]; if (e.Data.length === 0) return; this.preCalc(e); this.drawGrid(); this.drawLine(e) } preCalc(e) { this.plotHeight = this.height - 40; this.min = e.Data.reduce(((e, t) => Math.min(e, t))); this.max = e.Data.reduce(((e, t) => Math.max(e, t))); if (this.min === this.max) { this.min *= .9; this.max *= 1.1 } this.verticalLabels = []; var t = Math.round(Math.log10(this.max - this.min)); var n = Math.pow(10, t); var s = Math.trunc(this.min / n) * n; if (s > this.min) s -= n; var a = Math.trunc(this.max / n) * n; if (a < this.max) a += n; this.min = s - .1 * (a - s); this.max = a + .1 * (a - s); var r = 10; var o = this.plotHeight / r; if (o < 20) { r = 5; o = this.plotHeight / r } if (o < 20) { r = 1; o = this.plotHeight } var l = (this.max - this.min) / r; for (var c = this.min, d = 0; d <= r; c += l, d++)this.verticalLabels.push(c.toFixed(Math.max(0, -t + 1))); var h = this.verticalLabels.reduce(((e, t) => e.length > t.length ? e : t), ""); this.left = this.context.measureText(h).width + 25 } drawGrid() { const t = 5; var n = this.verticalLabels.length; var s = this.plotHeight - t; var a = s / (n - 1); this.context.beginPath(); this.context.strokeStyle = this.gridColor; this.context.lineWidth = 1; for (var r = this.height, o = 0; o <= n; r -= a, o++) { var l = Math.round(r); this.context.moveTo(this.left, l); this.context.lineTo(this.width - this.left, l); this.context.fillStyle = e.Colors.PeterRiver; this.context.font = "12px Arial"; this.context.fillText(this.verticalLabels[o], 10, l) } this.context.stroke() } drawLine(e) { var t = e.Data.length; var n = (this.width - this.left * 2) / (t - 1); var s = this.height / (this.max - this.min); this.context.beginPath(); var a = this.currentSeries % this.colors.length; this.context.strokeStyle = this.colors[a]; this.context.lineWidth = 1; var r = this.height - (e.Data[this.currentSeries] - this.min) * s; this.context.moveTo(this.left, r); for (var o = 1, l = this.left + n; o < e.Data.length; l += n, o++) { r = this.height - (e.Data[o] - this.min) * s; this.context.lineTo(l, r) } this.context.stroke() } createLegendLabel(e, t) { var n = document.createElement("h3"); n.classList.add("seriesLabel"); n.innerText = e; var s = t % this.colors.length; n.style.borderLeft = "10px solid " + this.colors[s]; n.addEventListener("click", (() => { this.currentSeries = t; this.Render() })); return n } } e.PlotControl = PlotControl })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class Point { constructor(e, t) { this.X = e; this.Y = t } Clone() { return new Point(this.X, this.Y) } AddXY(e, t) { this.X += e; this.Y += t; return this } ToString(e) { e = e || " "; return this.X + e + this.Y } } e.Point = Point; class Line { } e.Line = Line; class Point3D extends Point { constructor(...e) { if (typeof e[0] === "number") { super(e[0], e[1]); this.Z = e[2] } else { var t = e[1]; super(e[0][t], e[0][t + 1]); this.Z = e[0][t + 2] } } Clone() { return new Point3D(this.X, this.Y, this.Z) } ToString(e) { e = e || " "; return this.X + e + this.Y + e + this.Z } } e.Point3D = Point3D; class Size { constructor(e, t) { this.Width = e; this.Height = t } Clone() { return new Point(this.Width, this.Height) } ToString() { return this.Width + "x" + this.Height } } e.Size = Size })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class ProgressRing { constructor(e, t) { this.container = e; this.centerX = e.width / 2; this.centerY = e.height / 2; this.radius = Math.min(this.centerX, this.centerY); this.color = t } ShowWatch() { var e = this.getContext(); e.beginPath(); e.arc(this.centerX, this.centerY, this.radius * .7, 0, 2 * Math.PI, false); e.moveTo(this.centerX, this.centerY - this.radius * .5); e.lineTo(this.centerX, this.centerY); e.lineTo(this.centerX + this.radius * .3, this.centerY); e.stroke() } ShowPercentage(e) { if (isFinite(e)) { var t = Math.PI * (1.5 + e / 50); var n = this.getContext(); n.beginPath(); n.arc(this.centerX, this.centerY, this.radius * .7, Math.PI * 1.5, t, true); n.stroke() } } Clear() { var e = this.container.getContext("2d"); e.clearRect(0, 0, this.container.width, this.container.height); return e } getContext() { var t = this.Clear(); t.lineWidth = this.radius / 10; t.strokeStyle = this.color ? this.color : e.Colors.PeterRiver; t.shadowBlur = t.lineWidth; t.shadowOffsetX = 0; t.shadowOffsetY = 0; t.shadowColor = e.Colors.FullBlack; return t } } e.ProgressRing = ProgressRing })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class ResourceActionController { constructor(e) { this.action = e } ExecuteAction(resources, view) { let first; let parameters; if (resources === null || resources === undefined || resources.length === 0) first = null; else first = resources[0]; const execute = (actionsArray, actionIndex) => { if (actionIndex < actionsArray.length) { if (!actionsArray[actionIndex].hasOwnProperty("ExecuteWhen") || actionsArray[actionIndex].hasOwnProperty("ExecuteWhen") && !WebClient.Utils.CheckNotAllowTag(actionsArray[actionIndex].ExecuteWhen)) { let currentAction = actionsArray[actionIndex]; if (first === null && this.action.Type !== "GenericAction") { if (currentAction.RequiresResource) { WebClient.Toaster.ShowToast("Please select a record", WebClient.Colors.BelizeHole, 3); return } } switch (currentAction.Type) { case "ViewAction": parameters = this.getParameters(first, currentAction); let missingParam = false; if (Object.keys(parameters).length > 0) { for (const e in parameters) { if (!parameters[e]) { missingParam = true; break } } } if (!missingParam) { const e = currentAction; let t = "?view=" + encodeURIComponent(e.NewView); const n = this.buildQueryString(parameters); if (n != null) t += n; const s = e.OptionalParameters ? e.OptionalParameters : resources; if (e.NewWindow) window.open(window.location.href.split("?")[0] + t); else view.Platform.SwitchView(t, undefined, s) } else { WebClient.Toaster.ShowToast("Cannot open resource. Missing necessary information.", WebClient.Colors.Orange, 4) } execute(actionsArray, actionIndex + 1); break; case "SubViewAction": parameters = this.getParameters(first, currentAction); if (parameters) { const e = currentAction; const t = view.Platform.CurrentSpec.Functions[0].Views[e.NewView]; const n = t.Type; view.Platform.ActivateSubView(n, e.Parameters, resources) } execute(actionsArray, actionIndex + 1); break; case "ApiAction": if (!first || !resources) { WebClient.Toaster.ShowToast("Please select a record", WebClient.Colors.BelizeHole, 3); return } parameters = this.getParameters(first, currentAction); const apiAction = currentAction; const url = WebClient.Utils.ResolveVariables(first, apiAction.URL); const verb = apiAction.Verb; let headers = this.getHeaders(first, apiAction.Headers); let platformUri = WebClient.PlatformContext.PlatformUri; if (url.indexOf("http") !== -1) platformUri = ""; const specCall = bodyString => { WebClient.Loader.Show(); if (apiAction.ForceNoHeaders) headers = null; if (apiAction.External) headers = { From: sessionStorage["userEmail"] }; let refreshUIAddendum = ""; if (apiAction.RefreshUI) refreshUIAddendum = url.indexOf("?") > -1 ? "&refreshUI=true" : "?refreshUI=true"; if (bodyString) { const resourceRegex = /{\$(.+?)}/; let resourceRegexResult; while ((resourceRegexResult = resourceRegex.exec(bodyString)) !== null) { let value; const thisExpression = resourceRegexResult[0]; try { const splitExpression = resourceRegexResult[1].split("."); value = eval("first." + resourceRegexResult[1]); if (!value && splitExpression[splitExpression.length - 1] === "reference") { const resourcePath = splitExpression.slice(0, splitExpression.length - 1).join("."); let resource = eval("first." + resourcePath); value = resource["resourceType"] + "/" + resource["id"] } } catch (e) { value = "" } bodyString = bodyString.replace(thisExpression, value) } const sessionStorageRegex = /{\#(.+?)}/; let sessionStorageRegexResult; while ((sessionStorageRegexResult = sessionStorageRegex.exec(bodyString)) !== null) { const e = sessionStorageRegexResult[0]; const t = sessionStorageRegexResult[1]; bodyString = bodyString.replace(e, sessionStorage[t]) } } WebClient.HttpUtils.AjaxCall(platformUri + url + refreshUIAddendum, verb, headers, bodyString, ((e, t) => { WebClient.Loader.HideAll(); WebClient.Toaster.ShowToast("Operation succeeded.", WebClient.Colors.Emerald, 5); if (apiAction.RefreshUI && e.status !== 202) { view.LoadData() } else if (apiAction.AutoDownload) { if (t) { switch (apiAction.TypeDownload) { case "json": case "text": const e = apiAction.CharsetDownload + "," + encodeURIComponent(t); const n = document.createElement("a"); n.href = "data:" + e; n.download = apiAction.FilenameDowload; n.click(); break } } else { WebClient.Toaster.ShowToast("Download without content.", WebClient.Colors.Alizarin, 5) } WebClient.Toolbar.HideAllMenus() } execute(actionsArray, actionIndex + 1) }), (e => { WebClient.Loader.HideAll(); switch (e) { case 404: WebClient.Toaster.ShowToast("Resource not found.", WebClient.Colors.Alizarin, 5); break; default: WebClient.Toaster.ShowToast("Operation failed.", WebClient.Colors.Alizarin, 5); break }if (!this.action.StopOnError) execute(actionsArray, actionIndex + 1); else WebClient.Toaster.ShowToast("Error in step " + (actionIndex + 1) + ". Operation stopped.", WebClient.Colors.Alizarin, 5) })) }; const checkIfHasWarning = e => { if (apiAction.ShowHIPAAWarning) { const t = this.getPacientSummary(first); const n = new WebClient.HipaaWarningBox("deleteRecoverMessage", (() => { specCall(e) }), (() => { }), t); n.Show() } else if (apiAction.hasOwnProperty("ShowMessageBox")) { const t = { Id: "noButton", Name: "no", Text: "No", ClassNames: ["red"], Action: () => { } }; const n = { Id: "yesButton", Name: "yes", ClassNames: ["green"], Text: "Yes", Action: t => { specCall(e) } }; const s = new WebClient.MessageBox(apiAction.ShowMessageBox, [n, t]); s.Show() } else { specCall(e) } }; if (apiAction.SendResourceAsBody) { if (apiAction.Source) { WebClient.Loader.Show(); const sourceUrl = platformUri + WebClient.Utils.ResolveVariables(first, apiAction.Source); const resourceCall = eval('new Efferent.Frontend.FhirClient.FhirCall("' + sourceUrl + '", "GET")'); resourceCall.FuncOk = (e, t) => { checkIfHasWarning(e); WebClient.Loader.HideAll(); execute(actionsArray, actionIndex + 1) }; resourceCall.FuncError = (e, t) => { WebClient.Loader.HideAll(); if (e === 403) { if (t.AjaxRequest.response && t.AjaxRequest.response.indexOf("|draft") > -1) { this.resourceRequiresHipaa(t.AjaxRequest.response.split("|")[0], (() => { WebClient.Loader.Show(); resourceCall.Send() })) } else { WebClient.Toaster.ShowToast("Error getting resource.", WebClient.Colors.Alizarin, 5) } } else { WebClient.Toaster.ShowToast("Error getting resource.", WebClient.Colors.Alizarin, 5) } execute(actionsArray, actionIndex + 1) }; resourceCall.Send() } else { this.getResource(first, (e => { checkIfHasWarning(e) }), apiAction.IsSummary, apiAction.ResourceIncludes) } } else { if (apiAction.OperationBody) checkIfHasWarning(JSON.stringify(apiAction.OperationBody)); else checkIfHasWarning(null) } break; case "TaskAction": parameters = this.getParameters(resources, currentAction); if (parameters) { const e = currentAction; const continueAction = () => { const t = "/task/" + e.TaskName + (e.RefreshUI ? "?refreshUI=true" : ""); const n = {}; n.InputParameters = btoa(JSON.stringify(parameters)); n.Author = sessionStorage["userEmail"]; n.Notify = e.Notify; const s = JSON.stringify(n); WebClient.HttpUtils.AjaxCall(WebClient.PlatformContext.PlatformUri + t, "POST", "min", s, (() => { execute(actionsArray, actionIndex + 1) }), (() => { if (!this.action.StopOnError) execute(actionsArray, actionIndex + 1); else WebClient.Toaster.ShowToast("Error in step " + (actionIndex + 1) + ". Operation stopped.", WebClient.Colors.Alizarin, 5) })) }; if (e.hasOwnProperty("ShowMessageBox")) { const t = { Id: "noButton", Name: "no", Text: "No", ClassNames: ["red"], Action: () => { } }; const n = { Id: "yesButton", Name: "yes", ClassNames: ["green"], Text: "Yes", Action: e => { continueAction() } }; const s = new WebClient.MessageBox(e.ShowMessageBox, [n, t]); s.Show() } else { continueAction() } } WebClient.Toolbar.HideAllMenus(); break; case "OpenUrlAction": parameters = this.getParameters(resources, currentAction); const openAction = e => { WebClient.Toolbar.HideAllMenus(); switch (currentAction.Parameters.Mode) { case "SameTab": window.location.replace(e); break; default: window.open(e); break } }; if (parameters) { if (Array.isArray(parameters.URL)) { const e = {}; for (let t = 0; t < parameters.URL.length; t++) { const n = parameters.URL[t].split("?")[1]; const s = new URLSearchParams(n); const a = Object.fromEntries(s.entries()); for (let t in a) { if (e[t]) { if (e[t].indexOf(a[t]) === -1) e[t].push(a[t]) } else { e[t] = [a[t]] } } } let t = parameters.URL[0].split("?")[0] + "?"; for (let n in e) { if (e.hasOwnProperty(n)) t += n + "=" + e[n].join(",") + "&" } if (t.slice(-1) === "&") t = t.slice(0, -1); openAction(t) } else { openAction(parameters.URL) } } execute(actionsArray, actionIndex + 1); break } } else { execute(actionsArray, actionIndex + 1) } } }; const actions = Array.isArray(this.action.Action) ? this.action.Action : [this.action.Action]; execute(actions, 0) } resourceRequiresHipaa(consentId, callbackConsentOK) { var hipaa = new WebClient.HipaaWarningBox("shareMessage", (() => { var urlConsentAccept = "Consent/" + consentId + "/$accept-consent"; const fhirConsentAccept = eval('new Efferent.Frontend.FhirClient.FhirCall("' + urlConsentAccept + '", "POST")'); fhirConsentAccept.FuncOk = () => { WebClient.Loader.Hide(); callbackConsentOK() }; fhirConsentAccept.FuncError = () => { WebClient.Loader.Hide(); WebClient.Toaster.ShowToast("The Consent to accept the operation was not satisfactory", WebClient.Colors.PeterRiver, 3.5) }; WebClient.Loader.Show(); fhirConsentAccept.Send() }), (() => { })); hipaa.Show() } getPacientSummary(e) { const t = e.subject; const n = WebClient.ResourceDataSynthesizer.Synthesize(e); let s = ""; if (t && t.name && t.name[0] && t.name[0].text) s = t.name[0].text; let a = ""; if (e.started) { a = WebClient.CalendarUtils.GetFormattedDateTimeFromDB(e.started); return `${s}, ${a}, ${n}` } return `${s}, ${n}` } getResource(resource, callback, asSummary, ResourceIncludes) { WebClient.Loader.Show(); let resourceCall; const callFirstPart = 'new Efferent.Frontend.FhirClient.FhirCall("' + WebClient.PlatformContext.PlatformUri + "/fhir/" + resource["resourceType"]; if (ResourceIncludes) resourceCall = eval(callFirstPart + "?_id=" + resource["id"] + ResourceIncludes + (asSummary ? "&_summary=true" : "") + '", "GET")'); else resourceCall = eval(callFirstPart + "/" + resource["id"] + (asSummary ? "?_summary=true" : "") + '", "GET")'); resourceCall.FuncOk = (e, t) => { callback(e); WebClient.Loader.HideAll() }; resourceCall.FuncError = e => { WebClient.Toaster.ShowToast("Error getting resource.", WebClient.Colors.Alizarin, 5); WebClient.Loader.HideAll() }; resourceCall.Send() } getParameters(e, t) { let n; let s; if (Array.isArray(e)) n = e; else n = [e]; const a = {}; for (let r in t.Parameters) { if (t.Parameters.hasOwnProperty(r)) { const o = r.length > 0 && r.lastIndexOf("*") === r.length - 1; if (o) { const e = r; r = r.substr(0, r.length - 1); const a = []; for (let s = 0; s < n.length; s++) { const r = this.parseParameter(n[s], t.Parameters[e]); if (r !== null) a.push(r) } s = a } else { if (e) { if (Array.isArray(t.Parameters[r])) { let n = []; t.Parameters[r].forEach((t => { s = this.parseParameter(e, t); n.push(s) })); s = n } else { s = this.parseParameter(e, t.Parameters[r]) } } else { s = t.Parameters[r] } } a[r] = s } } return a } getHeaders(e, t) { const n = {}; for (const s in t) { if (t.hasOwnProperty(s)) { const a = this.parseParameter(e, t[s]); n[s] = a } } return n } parseParameter(e, t) { if (typeof t !== "string" || !e) return t; return WebClient.Utils.ResolveVariables(e, t) } buildQueryString(e) { let t = ""; for (const n in e) { if (e.hasOwnProperty(n)) t += "&" + encodeURIComponent(n) + "=" + encodeURIComponent(e[n]) } return t === "" ? null : t } } WebClient.ResourceActionController = ResourceActionController })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class ResourceBag { } ResourceBag.Icons8AdminSettingsMale32Png = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAORSURBVFhH1ZddTM1hHMcrVqKVlmamiVaYhU3mLYm2Mi6Y0ViT15hc1I0LN0aGxo3RcuN9w9ZwQVveGQ1ji40LEmV0kbiwvIuTz/e/X6eOzul0nNOF7/bZ8zzf3+/5Pc/5n/95/v8T9l/L5XLFwhAb9r86OjoiYA2L3oCv9B3Rr4ciS+sfsUA0XNbCUAGLYRrksocdtO1wF+bYlNCKwnuhGdLM8hB+FpyDLzDZ7NCITxhHUX3yVWZ5FXnh5FyBs2aFRhTMgV8QbZZPkbMEfrCZQWYFLwpuggYb9iryUllcN+Y4s4IXxYrhpQ17lb4u20CmWcGLYoXwzoa9irxk28BEs4IXxaZa0USzfIqceeAiPc6s4EW9JNvAfLN8ipzt0Ep6uFnBi4LroYWiQ83yKXIybLOhOwtsAx+oG2GWT5GTYhtINyt4UWwENT/S3jTLq4jr4dQI9X3ZbECi6CLQYRRrVg8RWwjfdRXMCp0oOpDirVBqVg8RuwihPYa7i+Il0AY9fuN4Oit0hSaZJW8kG9dNmUHf7zHuV/peKfQJCsxyC6+CeD5tlFnyTuE5op9nnjv+T6KWbsYSGzrC01NwOCTAIzgOifAcdkMDOVthNv3XUGxTAxMF9Fj+BtIZGAOzoIxYJK0WfwZa5DcoN4/YCdBVkKe3KZ2U+Va2b2LOdHgAL0B3uxZrV2GUYTmHoQmSYAP+MGcyYjwDlsIuaCM2ykK+RZLu/GVQq1Uk+kU0uuRVNnY/pul3PoiWW846qIGjFpOnt6pKm+Jdlrga3oLehI7BFCgnpnvgEOjVS5f6JN542lvw3uJRoMU19wDcg1eg98o98BOeQrkt2SUKxBNw3nqhDBIspNgAxhdo9SlXwlXYx3C2PLSR8QTl0l6Cg9bXCSllkRNDmw16wa1V3C2CWuAONNH3eppZgRzauaCN7KdxNkBfP9Fq5dEeAX1yLb4AdOOl0ORBs+V7bgBjBeh93+9RSt5pK1JDo3slDdaaNxOSodHG0k6bp5fWOsgFz/cLjCo4z5x4f5CnZ76Kf6aJsfn6AFI2nv7EDKafCamKM+68wg/pR8rzEIE6AgGLeaU0OgdaQN/tFngDOoR0OOkruA6PodDmbLNlu4SZTsw5uwOBeWNtfgHoeaAbuJKYfhF6RmjhJ3AfT4vrrEh2Fg21KKy/bM6/J9pquA16ROeDniV6oPXP4n+LhTbDNcHio83uprCwP+1QMHjFQSsBAAAAAElFTkSuQmCC"; ResourceBag.Icons8CaduceusFilled50Png = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAADFwAAAxcBwpsE1QAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAATYSURBVGiB1ZptaFZlGMf/9zZdk17c5kullJHGwolKUdoXo5A+ZDUIlMIshF5p5EoqIlxvOsIgohkIfdCI0gihCUpoQQsxl9mHJdoUKp1BJnOaTt1yvz7c99MuT2fbeeZ5Oo9/OJz7XPd1rpdzv17XfaQ8AYwFlgHfAMeALuBLYFKEbxTQBPwariZgVITnRuA7PM4D7cDrwMR87crHgTLgNeA08TgIjDH8TTE8q0z95cBvg8g6C7wNXJa2E1PMlxsK9eadIzH1naa+PoG8fcCsJDaWJHBinqQ2SbcnkDd7GNmWNj2BvBpJO4CFwzEO6QjwnKRtksYnUCpJXaa8Lqbe0o4llDlG0gZgNVCW8B0PYDzwWYKmj6LOyMgN9qPhumCwA/eMQH4rMC2JA6OBx/GzUb44CyRtOQHXA+dGoOcM0AiMtfIc8IykakkzJM2TNCGpMTE4Lt8V651zR4FbJO2T5CRNcs51ALWSmiXNkVR+Ebp6JG2XdEDSGQXv0sZsSQJ+NLSWQLu3APqaSyS9KenTi/gycagwXy2HvnAvTVnXFknPlzjn+p1zD0uaL2mNpFZJf45A4NeSFslPq22BdsbU94b7Vkm1kh4KuvJFl6RvJa2VtEDSfc653lhOYDLwDrAF2M7gqznA38Cjg8hpMXwfDcLzGNA3hPy/8Nuh3cBG4KY4ObHzsnOuU9Jyo+wKSbfKf+GJkqZKape0UVKjc249UC1phaS7wmsf6sKu1Qs0SFoqCfkWfMM5tw6okNQoabGkWZL2SjohPxm0OedOx9mZGoDFQCl+2t4V8zW/MuWtMfU78etNKWYNygzA/ca4buAwsBL4wNDfB1aFum5DX5C1/f8CWGIMW2boV+K3/HuB1Yb+oOFfko3VMQBqIl3mC2BuhKcq3O+ItMjceKkZAWiOGQN7gQZgnOGbyUBIsBtwWdr9H4QBuxLojXGoJ4yXGwJvGfAicF3Wdg8KoBb4mPgNYU9ooWHjoKIBcA3wKnAoxqFN5Btb/N8AnsCEp/g15ingeMSZ5UPJyRTAbUB/MLQVmGLqavABVg4daepOu6/WycceklQl6RB+5Z7unNuvC3fZk9NUnLYjFaa8xznXL+lmSecCrdrUH0lZd3oAnjRd5w9M0i50Ozs1v5elrUMCmBCm2Bx+MmtHFX4bDnCqqNcQyaeQIrNTNyYvBSwFHsnSxsQAVsSsHWvxccelBaAujBOL9lxXK3oADh9RCqgG1kecOQxMzdrOYYFP8HUCDxjafOB348wPwOgs7RwWQIcx2AZT08JslcOiNPUWYhc6xZT35wrOuQOSdpq6VMdKIRzpNOWFkZnqhCmnutdKHcBLkcF9ELg71DngBXzkWPRjZBSwOeJMPz4ULg88lVnbmQj4UPZl4GTEoW1F3xJxwEeJ0QOjp7O2KzGADcAc87zGOLIjS9vyAv5U6TzwVni+2jjSXQidhcpmdATZuVY5FS5p4Jyk+IHfpoD/K+KqQLsW+BzYlLV9iQGUAJ8EZ/YAM03duKHeLSrgk9elwCv4RF0f/ni6uHNZUeBD2i2hO80Avg+t08IllmXMJanvDM/lwM+BNmeY10eEQn2dXeH+Lj7JUKmB30BOFkhn+sD/AvJLaIHV+I0iwIasbcsb+PRPA/6EuBJ4Fn9gWhD8A3T13HNx2LigAAAAAElFTkSuQmCC"; ResourceBag.Icons8Delete32Png = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAOdJREFUWAntldEJwzAMRO3SMTpioWt0gK5bXKskIBtZ9ukK/XEgJJbu3tn6SFLa155AN4FSyrPe965ML4Up7CnoEL5/uQmYCRucY4VZYaPaDM1gAIxXnSGlCCjiaUL7BQJEtH2Ou14Br2jckFnTC/B6My7Ut4KsGgRFxTpQv6McSq+Cqa/mhdrFv8zq9PKDkZuaAnQOK9CqQdBVsRfk9Vb5rm4lYEXjhoyaCBjRjvKaegQY8TSh54IBMd5vPg2olDAjbDxHp54wCzaosNGrx7waplutPXLOL6MXKgmrbkK8wt7XnkAzgQ+2xtFqX+VZZgAAAABJRU5ErkJggg=="; ResourceBag.Icons8Home32Png = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHKSURBVFhH7ZXPK8NxGMfHDtjUSsRVWuQmP7JajQux4m9w8aMsBweOHPgHlHLiwMVZDnJQrvJjDoqIWrhgpRC2eT3fPbH6zvhuvovsXa+e7/f9PJ/neez73ThyUTweb4Rqvc2vGByCZ7iCgNr2i2FuWIEnGIEFeIHxRCJRpGX2iCFeCMMFtKot/gA8ssAqlKtXz3VzCk6jOFvRsJ8mUeIGsVLtd+E3wRkckW8gbhNT5dFSa+Kgk2azEIMZudeUSeQrYB3u4RqmoccYn80CHK6CTbiDPrUzikHFMEV9jCiPpANE1hagQRvIsz4Ar9rfFmd64QbOLS/AoWGQt3yZgy61LYvztbAr04mdan8uisqoXSLK93tU7ZxEv1J6LWrPkNpmkZRt9yACPrV/TPQcAvlU5TfErXZSGEG4hUuw7aeVT8Ovj+MQku8VFz54hRMIG6ZNYrZHF5BZ8geXiOniooU4mccFAtCudlL5XAD51foQ5u9fgHwXTHxBnZabxIycF5inLgo76SAvL3NQy02iJvcFYE1vTaKH/LcsLFBYoLBAYYG/vUCEOJiBLVkyjW9A7gHm0uUEcmNEkXkBkt1wDKc2s88CNTr238vheANAX0KpNm6RAQAAAABJRU5ErkJggg=="; ResourceBag.Icons8Shutdown32Png = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALKSURBVFhH1ZdNSFRhFIYnS0kzkGIgyqxo1U7a2KqIhKgWtWqTJFRQEgS2iKB11qZwES5a5CrpZ5WLNoUERZQVIRRRuwgqJdICMUxnet7rW+Mwc5vvzg/RCw953u+c75y5c+/cr9R/rUwm0wu7HNZONNkON+FTNptdalv+Q7jgUPFW+AyXYLPt8sUm6+EOzMNdmnd6KRJe3gAajvgYjMEs9EGjl5OJwj3wDUbZuN12nljLG2Cx8A/CR3gDm2yHiYIjMEfji1Bnu0DkxA4gsbYK7sN43IcoEMn7YA5O2YoVOX8dQKJxPTk34AO02i4ukttgqtSmv0VeyQEk9mwg7zE84+8/N3GBSBiGpyTFXvbFIjdoAIm8dfAdil9ZFnbAPM3DvitEfvAAErn63ZikR7OtnFi4DcMOg0R+0gEa4Qsct7UgJmrB/Al7bQWJ/EQDSORfhicOF4ShO/8Hgyy3FSRqEg9Aj05q9GFX2oo2Og+PHAaLmnKuwArQADttReY1uO4wWNQkHkCiRu+Lww4jQ7/3/Q6DRY0G6HMYLGpeQa/DyNATcNVhsKjRvbPFYbCoeQd5A/RDokewEtFrGrodRnfmWYwxhzUVfdL0y/Jvh63I3AbSWls1Ez266D8F9baiK1DHgt7dJ2zVTPTQ/TbkMCfMK/BSw9iquthfJ6wZehywlRMLelvp5uiyVXWx9yDNn8MSW/kiQWe495C2VTWxpw62OlvGn6KZrIkEfQ0PoMF2xWLPDTABA7biRVKrkhngFiR6ORUTe2xkv9cwEvyhSGynQGe4USj70aRWl12ffARW2w4TQ6yhSOc4Hc3PETd5qaTIbaNmEPSdDxDnnvkkonAZG/SAfiPGtRnsLjYMfhoOgZ7zGXgB1flvGw2b2ewk3INZYv2UfgW91d7CtL1JGIL9hMUftUrFxi2gU81ROAOnoRs68Mu71P9OqdQv3MUq0JKAc3QAAAAASUVORK5CYII="; ResourceBag.Icons8Undo32Png = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGBSURBVFhH7Za9SsNgFIbj4F9RB0FQKQ5VoUbdnRwcumkRJ0G8AEcdvAGvwMFBvAknMRcg4lCQrh1EBRUcBH/AJfH54K04FMyXlBMEH3hovtO+3zlN2qbBnyFJkh4d2kPzShzHN7iqkh00ncZbPGeQkso2/GgeFdX8rqjmM0U2ny26+T1e4wIDVH5xnNf1K54fNmuwqTfk3rGJx7iFg9rSD4Lz+IRX7FvFTu/6W163iMu4hvt4Sv2Fx2c84HhAW6eHYHsIt1mfyqkhM0R2Bx+wybqqp9JDMNcQDrJjGKH7QJdVTg+hEHMNQa5E/hIvOPa/l2iIx5xDuM/KJ66r5Ec3hiB7gmda+kN4TkNsquQFuTp+YLavp8OFM11HIDtB1v1ehCrZQu9eDbCikj00d9S0tIXGwzoDSyrZQuPQDQBTKtnCABv4xgDF/LGl+RFGWtpD8xbuaWkLjdvX3/+u2A0Y4BAbWtpC41F8xW2VbKHxLrY4/ZluYrmh+QhOavlPB4LgC+v3IICml9ZoAAAAAElFTkSuQmCC"; ResourceBag.Icons8ViewMore32Png = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANvSURBVFhH1ZdLSFVRGIUtLcwCjTJEs8eoCKImkU4aVKSTHlAIlSIVvRCCohcU1KSgBmJW9ho4yuj9lAaCFFJElCFUULOS3vQkE6y0b+1Wmuk17/VKtODD869/73/vu885ex8T/iu1trYOgbmwAw7Bxba2tlP83QdbIJd4oJvHTxTOgbPQBM1w03E5HIHL0ADSc9gPWe4euygyHk7Dd7gAi2Co011ELhNWwz34ArsgYvseRceZ8BbqIMd2r6TbQJ+l0Aj1kO1U70SHZfAVSimWaDtq0XckNa7DS5hiu2fRUL+8BdbZ6pOYxCBqnYBGrjNsdy8ajKOhlr3UVlxE3RRq3hJcJ9nuKhrogaujUczLHknUHQ0fYY2tziIxHfS0R/XARSNqb4cX0PXNwDwHFxz2i3wrXkGJrZ/C0A73GRba6jcxRgXUOPwpjHnQzAyH2eo3Mc4caGGsVFvB1N5+w2EQDYbDTvxjkG+7XXjang/DHui07dIvEU87YiXXq6D9fOA6BdrIzbIViqnQGYdqpHdXO9gj0J6vTWmR02qfC9/gCqjdU/qkOa28llmv83F4B2VOBdlb6TAY56HcoeJpnuUoxwehOiQR1zoJQ0yzZK7fQ4FjbcM6tMLzxN/F8EnXv0T8EDY5DIbe/6MOVWSiJzCdP1rOajjptNrvhXpyGlwHlk7IPKeVfw0bfa1X71lIWMSPYb3DYJTBJYdBxLr3Wvo3oOWc7JRyOvV00GgpNfhVTdRp5ZeDbpHeedUociqIWCtU7DD84q0YDQ7bhTcDlkC4Fb+LPqn4BZDPdZePEPxJUAQTbAURp9M+rK6tYOqJljJt9ZsYo5DxP8AgW+0Pjr5kut+n4yjG0PNW5bBDmAfgniZjK+6ifjZow1tgq0MkskAPR6GtuIva2pjuwABbnUWD3fAE0m3FTdTUA63TtmMH/FPMTKeVbsM1GGy7z6LmWNDeUGErsmikD4fXTOAUJNuOWdTQV9YDqO31j6LhVDpoo7kNMb+a9NWy65fXwgjbvROTyKCT/gHRZ9Q24hSn/irajqFPJeieVxB3vPPRiI5JFFgL2iP0JaNTLq+7yeCng/4X0Huu7fkuRH7gohEDDqNYCdSAPia0leocuA86spvs6VSsgvmE3b9qfRWF02A2g6yAzbABikEnZ2xL/e+UkPADzXcnZPOUsDsAAAAASUVORK5CYII="; ResourceBag.RingSvg = `<?xml version="1.0" encoding="utf-8"?><svg width='98px' height='98px' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><rect x="0" y="0" width="100" height="100" fill="none"></rect><circle cx="50" cy="50" r="45" stroke-dasharray="184 99" stroke="white" fill="none" stroke-width="10"><animateTransform attributeName="transform" type="rotate" values="0 50 50;180 50 50;360 50 50;" keyTimes="0;0.5;1" dur="2s" repeatCount="indefinite" begin="0s"></animateTransform></circle></svg>`; ResourceBag.Trash16Png = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAINJREFUOBHtU1sKwCAMq8N7zIPp/T92CJcIESfdGIzBPhYoaZtYwYfZG6i1FsSGIMjl9j4wR64CVi4iswCiNySoSYdycgBUX2nyNJ6NBxGFpy+zibWMM3ted4BnPOv9A8wen0E/XFyZXmDqzSGBnnitgPsimxViRugP0DyC/TzM/Ei6Aw+yeVDlQsi8AAAAAElFTkSuQmCC"; e.ResourceBag = ResourceBag })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class ResourceDataSynthesizer { static Synthesize(resource) { let importantData = []; if (resource.hasOwnProperty("resourceType")) { const resourceType = resource["resourceType"]; if (this.resourceTypes.hasOwnProperty(resourceType)) { const thisResourceProperties = this.resourceTypes[resourceType]; for (let i = 0; i < thisResourceProperties.length; i++) { const path = thisResourceProperties[i]; let data; try { data = eval("resource." + path) } catch (e) { data = "" } if (data) importantData.push(data) } } } else if (resource.hasOwnProperty("display")) { const e = resource["display"]; importantData.push(e) } if (importantData.length === 0) { if (resource.hasOwnProperty("identifier") && resource["identifier"] !== "") importantData = ["UID: " + resource["identifier"]]; else importantData = ["ID: " + resource["id"]] } return importantData.join(", ") } } ResourceDataSynthesizer.resourceTypes = { Patient: ["name[0].text", "gender", "birthDate"], ImagingStudy: ["description", "modality[0].code"], Practitioner: ["name[0].text"], PractitionerRole: ["code[0].coding[0].code"], Location: ["name"], Device: ["id", "deviceName"], Procedure: ["status", "performed.performedPeriod.start", "performed.performedPeriod.end", "code.coding[0].display"], EpisodeOfCare: ["class.display"], RiskAssessment: ["status"], Condition: ["code.coding[0].code"], AllergyIntolerance: ["code.coding[0].code"], Organization: ["name"], ServiceRequest: ["code.text"] }; WebClient.ResourceDataSynthesizer = ResourceDataSynthesizer })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class SequenceLUT { constructor(e) { this.image = e } AnalizeLUT(e) { const t = this.image["dicomTags"]; const n = t["0028_3010"]; const s = t["0002_0010"]; if (n && s === "1.2.840.10008.1.2.1") { this.isLUT = true; this.getLUTDescriptor(); this.getLUTData(); if (this.lUTDataArray && this.lUTDataArray.length > 0) { const n = parseInt(t["0028_0011"]); const s = parseInt(t["0028_0010"]); let a = new e.constructor(e.length); for (let t = 0; t < s; t++) { for (let s = n * t, r = s + n; s < r; s++) { a[s] = this.getValue(e[s]) } } return a } else { return e } } else { return e } } getLUTDescriptor() { var t; try { const e = this.image["dicomTags"]; const n = e["0028_3010"]; const s = n[0].value; let a = s.filter((e => e.tag === "0028_3002")); let r = (t = a[0].value) === null || t === void 0 ? void 0 : t.split("/"); this.nrOfEntries = +r[0]; this.firstInputValue = +r[1]; this.nrOfBitsPerEntry = +r[2]; if (this.nrOfEntries === 0) { this.nrOfEntries = 1 << 16 } } catch (t) { e.Utils.DebugConsoleLog(t) } } getLUTData() { try { const e = this.image["dicomTags"]; const t = e["0028_3010"]; const n = t[0].value; let s = n.filter((e => e.tag === "0028_3006")); this.lUTDataArray = s[0].value } catch (t) { e.Utils.DebugConsoleLog(t) } } getValue(e) { if (e < this.firstInputValue) { return this.lUTDataArray[0] } else if (e > this.firstInputValue + this.nrOfEntries - 1) { return this.lUTDataArray[this.nrOfEntries - 1] } else { return this.lUTDataArray[+(e - this.firstInputValue)] } } static InvertImageForLut(e) { let t = false; const n = e["dicomTags"]["2050_0020"]; const s = e["dicomTags"]["0008_0060"]; const a = e["dicomTags"]["0028_3010"]; if (e.TransferSyntax === "1.2.840.10008.1.2.4.50") { if (!a) t = false; else if (n && n === "IDENTITY" && s !== "CR" && s !== "DX") t = true } return t } } e.SequenceLUT = SequenceLUT })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class SpecReader { constructor(e, t, n) { this.SearchParamsTemplates = {}; this.GridTemplates = {}; this.FormTemplates = {}; this.Dictionaries = {}; this.SearchParamsTemplates = e.SearchParamsTemplates; this.GridTemplates = e.GridTemplates; this.DefaultTags = e.DefaultTags; this.parseGridTemplates(); this.FormTemplates = e.FormTemplates; this.parseFormTemplates(); this.Dictionaries = e.Dictionaries; this.Functions = this.findRoleFunctions(e.Roles, t); this.applicationTags = n } GetDefaultView() { var e = this.Functions[0].Views; var t = null; var n = null; for (var s in e) { if (e.hasOwnProperty(s)) { var a = e[s]; if (a.IsDefault && t === null) { n = a } if (a.hasOwnProperty("IsDefaultWhen")) { for (var r = 0; r < a.IsDefaultWhen.length; r++) { if (this.applicationTags.hasOwnProperty(a.IsDefaultWhen[r])) { t = a.IsDefaultWhen[r]; n = a } } } } } return n } parseGridTemplates() { for (var e in this.GridTemplates) { if (this.GridTemplates.hasOwnProperty(e)) { var t = this.GridTemplates[e]; t.Columns.forEach((e => { e.Expression = this.preprocessExpression(e.Expression); if (e.hasOwnProperty("ExpressionFallback")) { for (let t = 0; t < e.ExpressionFallback.length; t++) { e.ExpressionFallback[t] = this.preprocessExpression(e.ExpressionFallback[t]) } } })) } } } parseFormTemplates() { for (var e in this.FormTemplates) { if (this.FormTemplates.hasOwnProperty(e)) { var t = this.FormTemplates[e]; t.Fields.forEach((e => { if (e.hasOwnProperty("Expression")) { e.Expression = this.preprocessExpression(e.Expression); if (Array.isArray(e.Expression)) { for (let t = 0; t < e.Expression.length; t++) { e.Expression[t] = this.preprocessExpression(e.Expression[t]) } } } if (e.hasOwnProperty("ExpressionFallback")) { for (let t = 0; t < e.ExpressionFallback.length; t++) { e.ExpressionFallback[t] = this.preprocessExpression(e.ExpressionFallback[t]) } } })) } } } preprocessExpression(e) { if (e === null || e === undefined) return ""; var t = /^([_a-z][_a-z0-9]*)\[([_a-z][_a-z0-9]*)=([_a-z0-9:/\.\-]+)\]$/i; var n = e.split("."); for (var s = 0; s < n.length; s++) { var a = t.exec(n[s]); if (a !== null) n[s] = a[1] + ".find(function(e){return e." + a[2] + '="' + a[3] + '"})' } return n.join(".") } findRoleFunctions(e, t) { var n = []; e.forEach((e => { if (e.Name.toUpperCase() === t.toUpperCase()) { if (e.Functions) { n = e.Functions; for (let e = 0; e < n.length; e++) { for (let t in n[e].Views) { if (n[e].Views.hasOwnProperty(t)) n[e].Views[t].Id = t } } } } })); if (n.length === 0) { n = e[0].Functions; for (let e = 0; e < n.length; e++) { for (let t in n[e].Views) { if (n[e].Views.hasOwnProperty(t)) n[e].Views[t].Id = t } } } return n } } e.SpecReader = SpecReader })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class SpecFunction { constructor() { this.Views = {} } } e.SpecFunction = SpecFunction; class SearchParamTemplateField { } e.SearchParamTemplateField = SearchParamTemplateField; class FormTemplateField { } e.FormTemplateField = FormTemplateField; class SearchParamTemplate { constructor() { this.SearchParams = new Array } } e.SearchParamTemplate = SearchParamTemplate; class FormTemplate { constructor() { this.Fields = new Array } } e.FormTemplate = FormTemplate; class SpecTemplateColumn { } e.SpecTemplateColumn = SpecTemplateColumn; class SpecTemplate { constructor() { this.Columns = new Array } } e.SpecTemplate = SpecTemplate; class SpecView { constructor() { this.SearchParameters = {}; this.SortParameters = {} } } e.SpecView = SpecView; class GenericAction { } e.GenericAction = GenericAction; class ActionGroup extends GenericAction { } e.ActionGroup = ActionGroup; class ResourceAction extends GenericAction { } e.ResourceAction = ResourceAction; class SpecViewButtonState { } e.SpecViewButtonState = SpecViewButtonState; class ConcreteAction { } e.ConcreteAction = ConcreteAction; class InputAction extends ConcreteAction { } e.InputAction = InputAction; class ApiAction extends ConcreteAction { } e.ApiAction = ApiAction; class ViewAction extends ConcreteAction { } e.ViewAction = ViewAction; class WorkflowAction extends ConcreteAction { } e.WorkflowAction = WorkflowAction; class TaskAction extends ConcreteAction { } e.TaskAction = TaskAction; class OpenUrlAction extends ConcreteAction { } e.OpenUrlAction = OpenUrlAction })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class SeriesEntityBase { } e.SeriesEntityBase = SeriesEntityBase; class ImageEntityBase { } e.ImageEntityBase = ImageEntityBase; class StudyEntityBase { } e.StudyEntityBase = StudyEntityBase; class KeyImageElementEntity { constructor() { this.Zoom = 1 } } e.KeyImageElementEntity = KeyImageElementEntity; class KeyImageEntity { IsCalibrated() { return this.CalibrationData !== "" && this.CalibrationData !== undefined && this.CalibrationData !== null } GetCalibration() { return JSON.parse(this.CalibrationData) } } e.KeyImageEntity = KeyImageEntity })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class TagUtils { static ParseTagRules(e) { var t = /(\[[\s\w,!]+\]|[\w!]+(\s[\w!]+)*)/g; var n = /\[\s*|\s*\]|\s*,\s*/; var s = e.match(t); var a = []; if (s === null) return a; for (var r = 0; r < s.length; r++) { var o = s[r]; if (o.charAt(0) === "[") { var l = o.split(n).filter((e => e !== "")); if (l.length === 1) { a.push(l[0]) } else { l.sort(((e, t) => e.localeCompare(t))); a.push(l) } } else { a.push(o) } } a.sort(((e, t) => { var e = Array.isArray(e) ? e[0] : e; var t = Array.isArray(t) ? t[0] : t; return e.localeCompare(t) })); return a } static ResourceHasTag(e, t) { try { if (e.meta.tag !== undefined && e.meta.tag !== null && e.meta.tag.length > 0) { if (e.meta.tag.some((e => e["code"] === t))) return true } } catch (e) { return false } return false } static RemoveDuplicatedTags(e) { return e.filter((e => e !== "")).filter(((e, t, n) => n.indexOf(e) === t)) } static SortTags(e, t) { var n = []; var s; var a = []; var r; e.forEach((e => { var s = WebClient.Utils.ArrayIndexOf(t, e); if (s === -1 && e !== "CASE" && e !== "READ") { a.push(e) } else if (s >= 0 || e === "CASE" || e === "READ") { n.push(e) } else if (typeof s === "object") { n.push([]); n[n.length - 1] = e } })); if (n.length > 0 && a.length > 0) r = ","; else if (n.length === 0 || a.length === 0) r = ""; s = n.toString() + r + a.toString(); s = TagUtils.RemoveDuplicatedTags(s.split(",")).toString(); return s } static SelectTagToMenu(e) { var t = "tagMenuToolbar"; var n = "activeTag"; var s = "tagButton"; var a = document.getElementById(t).getElementsByClassName(s); var r = []; if (e.length === 1) { var o = e; var l = TagUtils.GetTags(o[0]); if (l) { for (var c = 0; c < a.length; c++) { var d = a[c]; var h = d.firstChild.textContent; if (l.indexOf(h) >= 0) { WebClient.DOMUtils.AddClass(d, n); if (!WebClient.DOMUtils.HasClass(d, "extraButton")) r.push(h) } else { WebClient.DOMUtils.RemoveClass(d, n) } } } else { for (var u = 0; u < a.length; u++)WebClient.DOMUtils.RemoveClass(a[u].firstChild, n) } } else { var l = []; for (var f = 0; f < e.length; f++) { var p = TagUtils.GetTags(e[f]); var m = l.concat(p); l = m } if (l.length > 0) { for (var g = 0; g < a.length; g++) { var d = a[g]; var h = d.firstChild.textContent; if (l.indexOf(h) >= 0) { WebClient.DOMUtils.AddClass(d, n); if (!WebClient.DOMUtils.HasClass(d, "extraButton")) { r.push(h) } } else { WebClient.DOMUtils.RemoveClass(d, n) } } } } return r } static GetTags(resource) { var tags = []; if (resource !== undefined && resource.meta !== undefined && resource.meta.tag !== undefined && resource.meta !== "") { var tagArray = resource.meta.tag; try { for (var i = 0; i < tagArray.length; i++) { try { var tag = tagArray[i]; if (tag.system === "http://efferenthealth.com/schemas/tagValue") tags.push(tag.code) } catch (e) { continue } } } catch (e) { } } try { if (tags.length > 0) { var resourceType = eval("platform.CurrentSpec.GridTemplates[platform.CurrentView.SpecView.TemplateId]['ResourceType']"); var cleanTagsString = eval("platform.Configuration").Tags[resourceType].replace(/"/g, ""); var tagsFromServer = TagUtils.ParseTagRules(cleanTagsString); tags = TagUtils.SortTags(tags, tagsFromServer).split(",") } } catch (e) { } return tags } } WebClient.TagUtils = TagUtils })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class Toaster { static InitToast() { if (Toaster.toaster !== null) return; Toaster.toaster = "" } static ShowToast(t, n = "gray", s = 3, a = "white") { Toaster.InitToast(); const { div: r } = e.DOMUtils; let o; if (Toaster.toaster.indexOf("1") < 0) o = 1; else if (Toaster.toaster.indexOf("2") < 0) o = 2; else o = 3; Toaster.toaster = Toaster.toaster + o; const l = `toast-fadein-${o}  0.5s, toast-fadeout-${o} 0.5s ${s}s`; const c = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; const d = r({ className: "toast", innerHTML: t, style: { bottom: `${-45 + o * 55}px`, backgroundColor: n, color: a, animation: l, zIndex: "100001" } }); document.body.appendChild(d); d.style.left = `${c / 2 - d.clientWidth / 2}px`; const h = setTimeout((() => { document.body.removeChild(d); Toaster.toaster = Toaster.toaster.replace(o.toString(), ""); clearTimeout(h) }), s * 1e3 + 500) } } Toaster.toaster = null; e.Toaster = Toaster })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class ToolTipOptions { constructor(e, t) { this.Delay = e; this.Distance = t } } e.ToolTipOptions = ToolTipOptions; class Tooltip { constructor(e, t) { this.element = e; this.options = t; this.options.Delay = this.options.Delay || 0; this.options.Distance = this.options.Distance || 10; this.element.addEventListener("mouseover", (e => { if (!e.target.hasAttribute("data-tooltip")) return; var t = e.target.getAttribute("data-tooltip"); if (t) { var n = document.createElement("div"); n.className = "b-tooltip"; n.innerHTML = t; document.body.appendChild(n); var s = e.target.getAttribute("data-position") || "center top"; var a = s.split(" ")[0]; var r = s.split(" ")[1]; this.positionAt(e.target, n, a, r) } })); this.element.addEventListener("mouseout", (e => { if (e.target.hasAttribute("data-tooltip") && document.querySelector(".b-tooltip") !== null) { setTimeout((() => { document.body.removeChild(document.querySelector(".b-tooltip")) }), this.options.Delay) } })) } positionAt(e, t, n, s) { var a = e.getBoundingClientRect(); var r; var o; switch (n) { case "left": r = parseInt(a.left) - this.options.Distance - t.offsetWidth; if (parseInt(a.left) - t.offsetWidth < 0) r = this.options.Distance; break; case "right": r = a.right + this.options.Distance; if (parseInt(a.right) + t.offsetWidth > document.documentElement.clientWidth) r = document.documentElement.clientWidth - t.offsetWidth - this.options.Distance; break; default: case "center": r = parseInt(a.left) + (e.offsetWidth - t.offsetWidth) / 2 }switch (s) { case "center": o = (parseInt(a.top) + parseInt(a.bottom)) / 2 - t.offsetHeight / 2; break; case "bottom": o = parseInt(a.bottom) + this.options.Distance; break; default: case "top": o = parseInt(a.top) - t.offsetHeight - this.options.Distance }r = r < 0 ? parseInt(a.left) : r; o = o < 0 ? parseInt(a.bottom) + this.options.Distance : o; t.style.left = r + "px"; t.style.top = o + pageYOffset + "px" } static RemoveToolTips() { var e = document.querySelectorAll(".b-tooltip"); e.forEach((e => { document.body.removeChild(e) })) } } e.Tooltip = Tooltip })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class TreeListLevel { } WebClient.TreeListLevel = TreeListLevel; class TreeList { constructor(e, t, n, s) { this.data = e; this.levels = t; this.callback = s; var a = document.createElement("div"); n.innerHTML = ""; n.appendChild(a); n.className = "treeList"; this.parent = a; this.initializeUiElements(); window.addEventListener("resize", (e => { this.onResize() })) } initializeUiElements() { this.parent.innerHTML = ""; this.fillLevel(0, this.data, this.parent) } fillLevel(level, obj, container) { var ul = document.createElement("ul"); var expression = "obj" + this.levels[level].RootExpression; var root; try { root = eval(expression); if (root === undefined) { if (level > 0) { container.className = "treeListItemEmpty"; container.itemData = obj } return } } catch (e) { WebClient.Utils.DebugConsoleLog("Error on fillLevel"); return } for (var i = 0; i < root.length; i++) { var elem = eval("root[i]"); var display = eval("elem" + this.levels[level].DisplayExpression); var span = document.createElement("span"); span.innerHTML = decodeURIComponent(display); span.addEventListener("click", (e => this.onClick(e))); var guidReference = WebClient.Utils.GetGuid(); span.id = "SpanRoot_Level" + level + "_" + guidReference; var arrowButton = document.createElement("div"); arrowButton.style.width = "15px"; arrowButton.style.height = "20px"; arrowButton.style.position = "absolute"; arrowButton.style.transform = "translateY(-20px)"; span.appendChild(arrowButton); arrowButton.setAttribute("arrowId", "SpanRoot_Level" + level + "_" + guidReference); arrowButton.addEventListener("click", (e => { var t = document.querySelector("#" + e.target.getAttribute("arrowId")); this.onClick(t) })); var li = document.createElement("li"); li.appendChild(span); if (level === this.levels.length - 1) { li.className = "treeListItemEmpty"; li.itemData = elem } else { li.className = "treeListItemCollapsed" } if (level > 0) ul.style.display = "none"; ul.appendChild(li); if (level < this.levels.length - 1) this.fillLevel(level + 1, elem, li) } container.appendChild(ul) } onResize() { } onClick(e) { var t; var n; if (e instanceof Event) { t = e.target.nextElementSibling; n = e.target.parentElement } else { t = e.nextElementSibling; n = e.parentElement } if (t && n) { if (n.classList.contains("treeListItemCollapsed")) { n.classList.remove("treeListItemCollapsed"); n.classList.add("treeListItemExpanded"); t.style.display = "" } else if (n.classList.contains("treeListItemExpanded")) { n.classList.remove("treeListItemExpanded"); n.classList.add("treeListItemCollapsed"); t.style.display = "none" } } else if (n) { if (n.classList.contains("treeListItemEmpty")) this.callback(n.itemData) } } clearSelection() { this.setSelection(null) } setSelection(e) { } } WebClient.TreeList = TreeList })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class Utils { static EncodeBase64(e) { let t = window.btoa(encodeURIComponent(e)); return t } static DecodeBase64(e) { let t; try { if (e !== null && e !== undefined) t = decodeURIComponent(window.atob(e)); else t = e } catch (n) { t = decodeURIComponent(e) } return t } static FormatValue(e) { if (e === undefined) return e; const t = e.indexOf("^"); if (t !== -1) return Utils.FormatValue(e.replace("^", " ")); return e.trim() } static CopyProperties(e, t) { if (e && t) { let n = Object.values(e.attributes); n.forEach((e => { t.setAttribute(e.name, e.value) })) } } static EvaluateNullAndUndefined(value) { if (["undefined", "null"].some((e => e === value))) value = eval(value); return value } static IndexOf(e, t) { let n; e.some(((e, s, a) => { if (typeof e !== "object") { if (t === e) { n = s; return t === e } } else { e.some(((e, s) => { if (e === t) { n = s; return e === t } })) } })); if (n === undefined) n = -1; return n } static ArrayIndexOf(e, t) { let n; e.some(((e, s, a) => { if (typeof e !== "object") { if (t === e) { n = s; return t === e } } else { e.some(((e, a) => { if (e === t) { n = [s, a]; return e === t } })) } })); if (n === undefined) n = -1; return n } static GetLengthLiteralArray(e) { if (e !== undefined) return Object.keys(e).length; return 0 } static IsIP(e) { try { const t = /(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/.test(e); return t } catch (e) { return false } } static Uint8ToString(e) { const t = 32768; const n = []; for (let s = 0; s < e.length; s += t) { n.push(String.fromCharCode.apply(null, e.subarray(s, s + t))) } return n.join("") } static GetCurrentDate() { const e = new Date; const t = Utils.AddZeroToN(e.getDate()); const n = Utils.AddZeroToN(e.getMonth() + 1); const s = e.getFullYear(); return s + "-" + n + "-" + t } static IsValidDate(e) { if (e) { if (typeof e === "string") { if (/^\d{4}[./-]\d{2}[./-]\d{2}/.test(e)) { const t = new Date(e); return t !== "Invalid Date" && !isNaN(t) } } else { return !isNaN(+e) } } return false } static FormatDateTime(e, t = false) { if (e === "" || e === null) return ""; try { const n = e.split(/[/\sT]/g); const s = n[0].split("-"); const a = s[0]; let r = s[1]; if (parseInt(r) <= 9) r = "0" + parseInt(r).toString(); let o = s[2]; if (parseInt(o) <= 9) o = "0" + parseInt(o).toString(); let l = ""; let c = ""; let d = ""; if (n.length === 2) { const e = n[1].split(":"); l = e[0]; if (parseInt(l) <= 9) l = "0" + parseInt(l).toString(); c = e[1]; if (parseInt(c) <= 9) c = "0" + parseInt(c).toString(); d = e[2].split("/[.-]/g")[0]; if (parseInt(d) <= 9) d = "0" + parseInt(d).toString() } if (a !== undefined && r !== undefined && o !== undefined) return a + "-" + r + "-" + o + (n.length === 2 ? " " + l + ":" + c + (t ? ":" + d : "") : ""); else return "" } catch (e) { return "" } } static GetAgeFromDate(e, t) { let n = "0"; const s = new Date; let a = s.getFullYear(); let r = s.getMonth() + 1; let o = s.getDate(); if (t) { a = parseInt(t.substring(0, 4)); r = parseInt(t.substring(5, 7)); o = parseInt(t.substring(8, 10)) } const l = parseInt(e.substring(0, 4)); const c = parseInt(e.substring(5, 7)); const d = parseInt(e.substring(8, 10)); if (l === a) { n = "0" } else { n = (a - l).toString(); if (r < c || r <= c && o < d) { n = (parseInt(n) - 1).toString() } } return n } static GetGuid() { return "xxxxxxxx-xxxx-8xxx-yxxx-xxxxxxxyxxxx".replace(/[xy]/g, (e => { const t = Math.random() * 16 | 0; const n = e === "x" ? t : t & 2 | 6; return n.toString(16) })) } static GetNumberWithSpecificDigits(e) { let t = ""; let n = 1; while (n <= e) { t += "x"; n++ } const s = t.replace(/[x]/g, (t => { const n = Math.random() * e | 0; const s = t === "x" ? n : n & 2 | 6; return s.toString(e) })); return s } static IsNumber(e) { const t = e ? e : window.event; const n = t.which ? t.which : t.keyCode; if (n > 31 && (n < 48 || n > 57) && n !== 46) { return false } return true } static ValidateEmail(e) { const t = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/; return t.test(e) } static ValidateURL(e) { const t = /(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/; return t.test(e) } static IsURL(e) { try { const t = "^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$"; const n = new RegExp(t, "i"); return e.length < 2083 && n.test(e) } catch (e) { return false } } static CompareByName(e, t) { const n = typeof e === "object" ? e.Name.toUpperCase() : e.toUpperCase(); const s = typeof t === "object" ? t.Name.toUpperCase() : t.toUpperCase(); if (n > s) return 1; else if (n < s) return -1; else return 0 } static ResolveVariables(resource, expression) { var _a, _b; let resourceEval = Array.isArray(resource) ? resource[0] : resource; if (expression) { if (expression.indexOf("{$PractitionerId}") > -1) { const e = sessionStorage["practitionerId"].split("/")[1]; expression = expression.replace("{$PractitionerId}", e) } if (expression.indexOf("{$Token}") > -1) { expression = expression.replace("{$Token}", sessionStorage["token"]) } if (expression.indexOf("{$Extension.") > -1) { const cleanExpression = expression.replace("{$Extension.", ""); const expressionParts = cleanExpression.split("."); const where = expressionParts[0].split("='"); expressionParts.splice(0, 1); const path = expressionParts.join(".").replace("}", ""); const whereProp = where[0].replace("where(", ""); const whereValue = where[1].replace("')", ""); const resourceExtension = resource["extension"]; if (Array.isArray(resourceExtension)) { for (let i = 0; i < resourceExtension.length; i++) { const thisExtension = resource["extension"][i]; if (thisExtension.hasOwnProperty(whereProp)) { if (thisExtension[whereProp] === whereValue) { const value = eval("thisExtension." + path); const regex = /\{(.*?)\}/; const matched = regex.exec(expression)[0]; expression = expression.replace(matched, value); break } } } } if (expression.indexOf("{$Extension.") > -1) { expression = "" } } if (expression.indexOf("{$PractitionerRoleId}") > -1) { const e = sessionStorage["practitionerRoleId"]; expression = expression.replace("{$PractitionerRoleId}", e) } if (expression.indexOf("{$PatientId}") > -1) { const e = JSON.parse(sessionStorage["identityTokenData"]); const t = e["patient"]; expression = expression.replace("{$PatientId}", t) } if (expression.indexOf("{date}") > -1) { expression = expression.replace("{date}", (new Date).toISOString().split("T")[0]) } if (expression.indexOf("{dateTime}") > -1) { const e = (new Date).toLocaleTimeString(); expression = expression.replace("{dateTime}", (new Date).toISOString().split("T")[0] + "T" + e + ".0000000Z") } if (expression.indexOf("{$OrganizationId}") > -1) { const e = sessionStorage["organizationId"]; expression = expression.replace("{$OrganizationId}", e) } if (expression.indexOf("{$RegionName}") > -1) { let e = (_a = resourceEval["endpoint"][0]["address"]) === null || _a === void 0 ? void 0 : _a.split("/")[2]; if (e) { expression = expression.replace("{$RegionName}", e) } } if (expression.indexOf("{$StudyGuid}") > -1) { const e = (_b = resourceEval["identifier"][0]["value"]) === null || _b === void 0 ? void 0 : _b.split("urn:oid:"); if (e) { const t = e.length === 2 ? e[1] : e[0]; expression = expression.replace("{$StudyGuid}", t) } } if (expression.indexOf("{$OrganizationName}") > -1) { const e = sessionStorage["organizationName"]; expression = expression.replace("{$OrganizationName}", e) } const matches = expression.match(/{(.+?)}/g); if (matches != null) matches.forEach((key => { const expr = key.substr(1, key.length - 2); try { expression = expression.replace(key, eval(expr)) } catch (e) { expression = "undefined" } })) } return expression } static SetConnectivityListeners(e, t, n = false) { const s = document.body; if (n === false) { if (window.addEventListener) { window.addEventListener("online", e, false); window.addEventListener("offline", t, false) } else { s.ononline = e; s.onoffline = t } } else if (n === true) { if (window.addEventListener) { window.removeEventListener("online", e, true); window.removeEventListener("offline", t, true) } else { s.ononline = null; s.onoffline = null } } } static GetInstance(e, t, ...n) { const s = Object.create(e[t].prototype); s.constructor.apply(s, n); return s } static CloneAnnotation(object, exclusive) { const annotation = eval("new " + object["Namespace"] + "." + object["Name"] + "()"); for (const e in object) { if (object.hasOwnProperty(e)) { const t = object[e]; if (!exclusive.some((e => t === e))) { annotation[e] = t } } } return annotation } static GetUidFromIdentifier(e) { const t = e.lastIndexOf(":"); const n = e.substring(t + 1, e.length); return n } static DecodeXmlString(e) { return e.replace(/&apos;/g, "'").replace(/&quot;/g, '"').replace(/&gt;/g, ">").replace(/&lt;/g, "<").replace(/&amp;/g, "&") } static StrToBool(e) { const t = /^\s*(true|1|on)\s*$/i; return t.test(e) } static IsDebugActive() { const e = /[\\?&]debug=([^&#]*)/; const t = e.exec(location.search); const n = t === null ? "" : decodeURIComponent(t[1].replace(/\+/g, " ")); return n } static DebugConsoleLog(...e) { const t = this.IsDebugActive(); if (t === "active") { console.log(...e) } } static GetSizeInBytes(e) { let t; if (e > 1024 * 1024) t = (Math.round(e * 100 / (1024 * 1024)) / 100).toString() + " MB"; else t = (Math.round(e * 100 / 1024) / 100).toString() + " KB"; return t } static HexToRgb(e) { const t = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e); return t ? { R: parseInt(t[1], 16), G: parseInt(t[2], 16), B: parseInt(t[3], 16) } : null } static Capitalize(e) { return e && e !== "" ? e.charAt(0).toUpperCase() + e.slice(1) : "" } static CheckNotAllowTag(e) { const t = JSON.parse(sessionStorage.getItem("applicationTags")); let n = true; if (typeof e === "string") { if (t.hasOwnProperty(e)) n = false } else if (Array.isArray(e)) { for (let s = 0; s < e.length; s++) { if (t.hasOwnProperty(e[s])) { n = false; break } } } return n } static NumberWithCommas(e) { return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") } static FormatDateFromDicomTag(e, t = "/") { if (e) { const n = e.slice(0, 4); const s = e.slice(4, 6); const a = e.substring(6, 8); return `${n}${t}${s}${t}${a}` } return "" } static StringToFilename(e) { e = e.replace(/^\s+|\s+$/g, ""); e = e.toLowerCase(); var t = "àáäâèéëêìíïîòóöôùúüûñç·/_,:;"; var n = "aaaaeeeeiiiioooouuuunc------"; for (var s = 0, a = t.length; s < a; s++) { e = e.replace(new RegExp(t.charAt(s), "g"), n.charAt(s)) } e = e.replace(/[^a-z0-9 -]/g, "").replace(/\s+/g, "_").replace(/-+/g, "_"); return e } static GetTimeZone() { var e = (new Date).getTimezoneOffset(); var t = Math.abs(e); var n = (e < 0 ? "+" : "-") + ("00" + Math.floor(t / 60)).slice(-2) + ":" + ("00" + t % 60).slice(-2); return n } static AddZeroToN(e) { const t = typeof e === "string" ? parseInt(e) : e; let n; if (t < 10) { n = "0" + t } else { n = t.toString() } return n } static CreateDebouncer() { let e; const debounce = (t, n) => { clearTimeout(e); e = setTimeout(t, n) }; return debounce } } Utils.INPUTKEY_NAMES = { BACKSPACE: "Backspace", SPACE: " ", ENTER: "Enter", ESCAPE: "Escape", TAB: "Tab", ARROW_LEFT: "ArrowLeft", ARROW_RIGHT: "ArrowRight", ARROW_UP: "ArrowUP", ARROW_DOWN: "ArrowDown" }; Utils.INPUTKEY_EVENTS = { KEYUP: "keyup", KEYDOWN: "keydown" }; WebClient.Utils = Utils })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class ViewportLayoutGrid { constructor(n, s, a, r, o = t.topRight, l = e.Colors.GreenSea, c = e.Colors.Emerald) { this.container = n; this.HorizontalViewports = s; this.VerticalViewports = a; this.Size = r; this.Color = l; this.ActiveColor = c; this.Position = o; this.Element = document.createElement("div"); this.Element.className = "viewportLayoutGrid"; this.SubElement = document.createElement("div"); this.Element.appendChild(this.SubElement); this.container.appendChild(this.Element) } Render(n, s = null, a = null) { var r = 1; var o = a === null || a.marginTopIni === null ? 3 : a.marginTopIni; var l = a === null || a.marginLeftRight === null ? 2 : a.marginLeftRight; var c = 0; var d = 0; var h = this.container.clientWidth; var u = this.container.clientHeight; this.SubElement.innerHTML = ""; switch (this.Position) { case t.topRight: d = o; c = h - (l + this.HorizontalViewports * this.Size.width + this.HorizontalViewports * r); break; case t.topLeft: d = o; c = l; break; case t.bottomRight: d = u - (o + this.VerticalViewports * this.Size.height + this.VerticalViewports * r); c = h - (l + this.HorizontalViewports * this.Size.width + this.HorizontalViewports * r); break; case t.bottomLeft: d = u - (o + this.VerticalViewports * this.Size.height + this.VerticalViewports * r); c = l; break }this.Element.style.left = c + "px"; this.Element.style.top = d + "px"; this.SubElement.style.margin = "auto"; this.SubElement.style.position = "relative"; this.SubElement.style.width = this.Size.width * this.HorizontalViewports + this.HorizontalViewports * r + "px"; this.SubElement.style.height = this.Size.height * this.VerticalViewports + this.VerticalViewports * r + "px"; for (var f = 0; f < this.HorizontalViewports * this.VerticalViewports; f++) { var p = document.createElement("div"); e.DOMUtils.AddClass(p, "itemGrid"); p.style.width = this.Size.width + "px"; p.style.height = this.Size.height + "px"; p.style.marginLeft = r + "px"; p.style.marginTop = r + "px"; if (f + 1 === n) p.style.backgroundColor = this.ActiveColor; else p.style.backgroundColor = this.Color; if (s !== null) { for (var m = 0; m < s.length; m++) { if (f + 1 === s[m]) { p.style.backgroundColor = this.ActiveColor; break } } } this.SubElement.appendChild(p) } } } e.ViewportLayoutGrid = ViewportLayoutGrid; let t; (function (e) { e[e["topRight"] = 0] = "topRight"; e[e["topLeft"] = 1] = "topLeft"; e[e["bottomRight"] = 2] = "bottomRight"; e[e["bottomLeft"] = 3] = "bottomLeft" })(t = e.PositionLayoutGrid || (e.PositionLayoutGrid = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class AddressControl { constructor(parentContainer, resource) { this.codesSystemsStatus = 0; this.codeSystems = ["address-use", "address-type"]; WebClient.DOMUtils.AddClass(parentContainer, "dottedBorder"); parentContainer.style.padding = "5px"; this.resource = resource; if (resource.hasOwnProperty("address")) { this.currentAddressData = resource["address"] } this.entriesContainer = document.createElement("div"); parentContainer.appendChild(this.entriesContainer); var addEntryButton = document.createElement("button"); addEntryButton.style.width = "25px"; addEntryButton.style.height = "25px"; addEntryButton.style.marginLeft = "5px"; addEntryButton.style.marginTop = "5px"; addEntryButton.style.flex = "0 0 25px"; parentContainer.parentNode.insertBefore(addEntryButton, parentContainer.nextSibling); addEntryButton.innerText = "+"; WebClient.DOMUtils.AddClass(addEntryButton, "green inlineButton"); addEntryButton.addEventListener("click", (() => { if (this.codesSystemsStatus >= this.codeSystems.length) { this.CreateBlock() } })); this.valueHelper = eval("Efferent.Frontend.FhirClient.ValueHelper"); var checkCodesSystemsStatus = () => { this.CheckCodesSystemsStatus() }; WebClient.Loader.Show(); for (var i = 0; i < this.codeSystems.length; i++) { this.valueHelper.GetCodeSystem(null, checkCodesSystemsStatus, this.codeSystems[i]) } } CreateBlock(e) { var t = e ? e : {}; var n = document.createElement("div"); n.style.marginBottom = "7px"; this.entriesContainer.appendChild(n); var s = this.CreateSelectInput(t, "address-type", "type", 145); var a = this.CreateSelectInput(t, "address-use", "use", 130); var r = this.CreateTextInput(t, "city", 100); var o = this.CreateTextInput(t, "district", 100); var l = this.CreateTextInput(t, "state", 100); var c = document.createElement("input"); c.style.marginRight = "5px"; c.style.marginBottom = "5px"; c.style.width = "200px"; c.placeholder = "Enter address"; c.setAttribute("type", "text"); if (t.hasOwnProperty("line")) c.value = t["line"][0]; c.onchange = () => { if (!this.resource.hasOwnProperty("address")) { this.resource["address"] = [] } t["line"] = [c.value]; if (this.resource["address"].indexOf(t) === -1) { this.resource["address"].push(t) } }; var d = document.createElement("button"); d.innerText = "X"; d.style.width = "25px"; d.style.height = "25px"; WebClient.DOMUtils.AddClass(d, "red inlineButton"); d.addEventListener("click", (() => { if (this.resource.hasOwnProperty("address")) { var e = this.resource["address"].indexOf(t); if (e > -1) { this.resource["address"].splice(e, 1) } if (this.resource["address"].length === 0) { delete this.resource["address"] } } n.remove() })); n.appendChild(s); n.appendChild(a); n.appendChild(r); n.appendChild(o); n.appendChild(l); n.appendChild(c); n.appendChild(d) } CheckCodesSystemsStatus() { this.codesSystemsStatus++; if (this.codesSystemsStatus >= this.codeSystems.length) { WebClient.Loader.Hide(); if (this.currentAddressData) { for (var e = 0; e < this.currentAddressData.length; e++) { this.CreateBlock(this.currentAddressData[e]) } } } } CreateSelectInput(e, t, n, s) { var a = document.createElement("select"); a.style.marginRight = "5px"; a.style.width = s ? s + "px" : ""; this.InjectOptions(a, this.valueHelper.CodeSystems[t]["concept"], n); if (e.hasOwnProperty(n)) a.value = e[n]; a.onchange = () => { if (!this.resource.hasOwnProperty("address")) { this.resource["address"] = [] } e[n] = a.value; if (this.resource["address"].indexOf(e) === -1) { this.resource["address"].push(e) } }; return a } CreateTextInput(e, t, n) { var s = document.createElement("input"); s.style.marginRight = "5px"; s.style.marginBottom = "5px"; s.style.width = n ? n + "px" : ""; s.placeholder = "Enter " + t; s.setAttribute("type", "text"); if (e.hasOwnProperty(t)) s.value = e[t]; s.onchange = () => { if (!this.resource.hasOwnProperty("address")) { this.resource["address"] = [] } e[t] = s.value; if (this.resource["address"].indexOf(e) === -1) { this.resource["address"].push(e) } }; return s } InjectOptions(e, t, n) { var s = document.createElement("option"); s.innerHTML = "-- Select " + n + " --"; e.appendChild(s); for (var a = 0; a < t.length; a++) { var s = document.createElement("option"); s.innerHTML = t[a]["display"]; s.value = t[a]["code"]; e.appendChild(s) } } } WebClient.AddressControl = AddressControl })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class ContactPointControl { constructor(parentContainer, resource) { this.codesSystemsStatus = 0; this.codeSystems = ["contact-point-use", "contact-point-system"]; WebClient.DOMUtils.AddClass(parentContainer, "dottedBorder"); parentContainer.style.padding = "5px"; this.resource = resource; if (resource.hasOwnProperty("telecom")) { this.currentTelecomData = resource["telecom"] } this.entriesContainer = document.createElement("div"); parentContainer.appendChild(this.entriesContainer); var addEntryButton = document.createElement("button"); addEntryButton.style.width = "25px"; addEntryButton.style.height = "25px"; addEntryButton.style.marginLeft = "5px"; addEntryButton.style.marginTop = "5px"; addEntryButton.style.flex = "0 0 25px"; addEntryButton.innerText = "+"; WebClient.DOMUtils.AddClass(addEntryButton, "green inlineButton"); parentContainer.parentNode.insertBefore(addEntryButton, parentContainer.nextSibling); addEntryButton.addEventListener("click", (() => { if (this.codesSystemsStatus >= this.codeSystems.length) { this.CreateBlock() } })); this.valueHelper = eval("Efferent.Frontend.FhirClient.ValueHelper"); var checkCodesSystemsStatus = () => { this.CheckCodesSystemsStatus() }; WebClient.Loader.Show(); for (var i = 0; i < this.codeSystems.length; i++) { this.valueHelper.GetCodeSystem(null, checkCodesSystemsStatus, this.codeSystems[i]) } } CreateBlock(e) { var t = e ? e : {}; var n = document.createElement("div"); n.style.marginBottom = "7px"; this.entriesContainer.appendChild(n); var s = this.CreateSelectInput(t, "contact-point-system", "system", 145); var a = this.CreateSelectInput(t, "contact-point-use", "use", 120); var r = this.CreateTextInput(t, "value"); var o = document.createElement("button"); o.innerText = "X"; o.style.width = "25px"; o.style.height = "25px"; WebClient.DOMUtils.AddClass(o, "red inlineButton"); o.addEventListener("click", (() => { if (this.resource.hasOwnProperty("telecom")) { var e = this.resource["telecom"].indexOf(t); if (e > -1) { this.resource["telecom"].splice(e, 1) } if (this.resource["telecom"].length === 0) { delete this.resource["telecom"] } } n.remove() })); n.appendChild(s); n.appendChild(a); n.appendChild(r); n.appendChild(o) } CheckCodesSystemsStatus() { this.codesSystemsStatus++; if (this.codesSystemsStatus >= this.codeSystems.length) { WebClient.Loader.Hide(); if (this.currentTelecomData) { for (var e = 0; e < this.currentTelecomData.length; e++) { this.CreateBlock(this.currentTelecomData[e]) } } } } CreateSelectInput(e, t, n, s) { var a = document.createElement("select"); a.style.marginRight = "5px"; a.style.width = s ? s + "px" : ""; this.InjectOptions(a, this.valueHelper.CodeSystems[t]["concept"], n); if (e.hasOwnProperty(n)) a.value = e[n]; a.onchange = () => { if (!this.resource.hasOwnProperty("telecom")) { this.resource["telecom"] = [] } e[n] = a.value; if (this.resource["telecom"].indexOf(e) === -1) { this.resource["telecom"].push(e) } }; return a } CreateTextInput(e, t, n) { var s = document.createElement("input"); s.style.marginRight = "5px"; s.style.width = n ? n + "px" : ""; s.placeholder = "Enter " + t; s.setAttribute("type", "text"); if (e.hasOwnProperty(t)) s.value = e[t]; s.onchange = () => { if (!this.resource.hasOwnProperty("telecom")) { this.resource["telecom"] = [] } e[t] = s.value; if (this.resource["telecom"].indexOf(e) === -1) { this.resource["telecom"].push(e) } }; return s } InjectOptions(e, t, n) { var s = document.createElement("option"); s.innerHTML = "-- Select " + n + " --"; e.appendChild(s); for (var a = 0; a < t.length; a++) { var s = document.createElement("option"); s.innerHTML = t[a]["display"]; s.value = t[a]["code"]; e.appendChild(s) } } } WebClient.ContactPointControl = ContactPointControl })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["Single"] = 0] = "Single"; e[e["Range"] = 1] = "Range"; e[e["Relative"] = 2] = "Relative" })(t = e.EDateRangeType || (e.EDateRangeType = {})); e.DatePickerDayColors = { DAY_HIGHLIGHTED: "calendarColor1", DAY_PRIMARY: "calendarColor2", DAY_SECONDARY: "calendarColor3" }; const { div: n, span: s, input: a, img: r, label: o } = e.DOMUtils; class DateRangePicker { constructor(n, s, a, r, o) { this.data = s || null; if (this.data) { if (!this.data.range) this.data.range = 0; if (!this.data.from) this.data.from = new Date; if (!this.data.to) this.data.to = new Date } this.parent = n; this.today = new Date; this.today.setHours(0, 0, 0, 0); this.options = a || {}; this.isOpen = false; this.setTime = o; this.dayColor = this.dayColor.bind(this); this.canMoveTo = this.canMoveTo.bind(this); this.setSpecificYear = this.setSpecificYear.bind(this); this.dateFormat = a.dateFormat || DateRangePicker.DateFormat || e.CalendarUtils.DATE_FORMAT_YMD; if (this.data === null && this.options.allowEmpty !== true) { this.data.type = t.Single; this.data.date = new Date } switch (this.data.type) { case t.Single: if (this.options.allowEmpty) { if (!r) { this.data.date = new Date; this.init = true } } this.data.date.setHours(0, 0, 0, 0); break; case t.Range: if (this.options.allowEmpty) { if (!r) { this.data.from = this.data.to = new Date; this.init = true } } this.data.from.setHours(0, 0, 0, 0); this.data.to.setHours(0, 0, 0, 0); break; case t.Relative: if (this.options.allowEmpty) { if (!r) { this.data.from = this.data.to = new Date; this.init = true } } if (this.data.range > 0) { this.data.from = new Date; this.data.to = e.CalendarUtils.AddDays(new Date, this.data.range) } else { this.data.from = e.CalendarUtils.AddDays(new Date, this.data.range); this.data.to = new Date } break }this.generateContainer(); this.generateTopBar(); this.showSecondCalendar(this.data.type === t.Range); this.generateTextbox(this.parent, this.container); this.generateCloseButton(this.container); this.parent.setAttribute("data-typeCalendar", this.data.type.toString()) } GetData() { return this.data } Clear() { this.emptyValue(); this.parent.dispatchEvent(new Event("emptyValue")); this.parent["dataDPick"] = ""; this.parent.dispatchEvent(new Event("change")); this.container.setAttribute("data-range", ","); this.parent.removeAttribute("data-time") } SetReadonlyInputs(e) { this.timeInput.readOnly = e; this.dateInput.readOnly = e; this.openCalendarButton.style.visibility = e ? "hidden" : "inherit"; this.clearInputBtn.style.display = e ? "none" : "inherit" } generateCloseButton(e) { e.appendChild(n({ className: "daterange_close", innerHTML: "&times;", onclick: e => this.closeCalendar() })) } generateContainer() { const calendarKeyUpListener = t => { if ([e.Utils.INPUTKEY_NAMES.ENTER, e.Utils.INPUTKEY_NAMES.ESCAPE].includes(t.key)) this.closeCalendar() }; document.removeEventListener("keyup", calendarKeyUpListener); document.addEventListener("keyup", calendarKeyUpListener); let t; let a; this.container = n({ className: "daterange_container", style: { display: "none" }, children: [this.wrapDaterange = n({ className: "wrap-daterange", children: [t = n({ className: "daterange_month", onclick: e => { this.processClick(true, e); this.parent["dataDPick"] = this.GetData(); this.parent.dispatchEvent(new Event("change")) } }), n({ className: "daterange_sep", children: [n({ className: "daterange_line" }), s({ innerHTML: "TO" }), n({ className: "daterange_line" })] }), a = n({ className: "daterange_month", onclick: e => { this.processClick(false, e); this.parent["dataDPick"] = this.GetData(); this.parent.dispatchEvent(new Event("change")) } })] })] }); this.calendarFrom = this.createMonthCalendar(t, this.data.from, this.options.onlySingle); this.calendarTo = this.createMonthCalendar(a, this.data.to, false) } createMonthCalendar(t, n, s) { const a = new e.MonthCalendar(t, s); a.DayColor = this.dayColor; a.GenerateCalendar(n || new Date); a.GenerateHeader(n || new Date); a.CanMoveTo = this.canMoveTo; a.SetSpecificYear = this.setSpecificYear; return a } openCalendar() { this.container.style.display = "table"; this.container.style.position = "absolute"; this.container.style.visibility = "hidden"; this.isOpen = true; this.repositionateCalendar() } repositionateCalendar() { setTimeout((() => { const e = this.container.clientWidth; const t = this.parent.offsetLeft; const n = document.documentElement.clientWidth; if (n > 420) { if (t + e > n) this.container.style.right = "0px"; else this.container.style.right = "auto" } else { this.container.style.right = "0px" } this.container.style.visibility = "visible" }), 50) } closeCalendar() { this.container.style.display = "none"; this.isOpen = false } generateTextbox(o, l) { var c; this.timeInput = a({ className: "datepickerTime", type: "text" }); this.dateInput = a({ type: "text", className: "daterange_text", style: { display: "inline-block", width: "100%" } }); const d = s({ className: "date-mask-element" }); const h = s({ className: "time-mask-element" }); const u = new e.InputMaskedTime(this.timeInput, h, (e => { this.parent.setAttribute("data-time", e) })); u.SetValue(this.setTime); this.openCalendarButton = n({ className: "dropDownOpenButton", onclick: () => this.isOpen ? this.closeCalendar() : this.openCalendar() }); const f = r({ className: "deleteDatePickerValue invert", src: e.ResourceBag.Trash16Png, style: { marginLeft: this.setTime !== undefined ? "70px" : "10px" }, onclick: () => { this.Clear() } }); this.clearInputBtn = n({ className: "clearButton", children: [f] }); const p = [this.dateInput, d, l, this.openCalendarButton, this.clearInputBtn]; if (this.setTime !== undefined) { p.push(this.timeInput); p.push(h) } e.DOMUtils.SetOptions(o, { children: p }); o.classList.add("daterange_box"); this.dateInput.addEventListener("keydown", (t => { if (t.key === e.Utils.INPUTKEY_NAMES.ENTER) { if (this.options.onEnter) this.options.onEnter(t) } })); this.inputMaskedDate = new e.InputMaskedDate(this.dateInput, d, this.dateFormat, this.data.type, ((e, n, s) => { switch (this.data.type) { case t.Single: this.data.date = e; this.calendarFrom.UpdateCalendar(e); break; case t.Range: this.data.from = e; this.data.to = n; this.calendarFrom.UpdateCalendar(e); this.calendarTo.UpdateCalendar(n); break; case t.Relative: this.data.from = e; this.data.to = n; this.data.range = s || 0; this.calendarFrom.UpdateCalendar(e); break; default: }this.parent.setAttribute("data-range", this.getBackendDateFormat(",")) })); this.SetReadonlyInputs(((c = this.options) === null || c === void 0 ? void 0 : c.readOnly) || false); this.updateTextbox() } emptyValue() { this.init = true; this.data.range = 0; this.data.date = new Date; this.data.from = new Date; this.data.to = new Date; this.calendarFrom.UpdateCalendar(this.data.from); this.calendarTo.UpdateCalendar(this.data.to); this.timeInput.value = ""; this.closeCalendar(); this.updateTextbox() } showSecondCalendar(e) { const t = document.documentElement.clientWidth; if (t > 420) { this.wrapDaterange.children[1].style.display = e ? "block" : "none" } this.wrapDaterange.children[2].style.display = e ? "block" : "none" } generateButtonBar() { const e = n({ className: "buttonbar daterange_buttonbar" }); const s = Math.floor(Math.random() * 1e7); for (const n in t) { if (Number.isNaN(+n)) { const r = `${s}.${n}`; const l = a({ id: r, type: "radio", name: `datarange_${s}`, value: n, checked: this.data.type === t[n], attr: { "data-rangetype": t[n] }, onchange: e => { this.changeDateRangeType(t[n]); this.repositionateCalendar() } }); const c = o({ htmlFor: r, innerHTML: n }); e.appendChild(l); e.appendChild(c) } } return e } generateTopBar() { if (this.options.onlySingle === true) { const e = n({ style: { height: 0 } }); this.container.insertBefore(e, this.container.firstChild); return } const e = n({ children: [this.generateButtonBar(), n({ className: "daterange_close", innerHTML: "&times;", onclick: () => this.closeCalendar() })] }); this.container.insertBefore(e, this.container.firstChild) } processClick(e, n) { var s = parseInt(n.target.innerHTML); let a = -1; if (!s) { if (n.target && n.target.dataset && n.target.dataset.month) a = +n.target.dataset.month; else return } this.data.type = this.data.type; let r; if (s) { if (this.data.type === t.Relative) { r = new Date(this.data.from.getFullYear(), this.data.from.getMonth(), s) } else { r = e ? new Date(this.data.from.getFullYear(), this.data.from.getMonth(), s) : new Date(this.data.to.getFullYear(), this.data.to.getMonth(), s) } } if (a > -1) { if (e) { r = new Date(this.data.from.getFullYear(), a, this.data.from.getDate()); this.calendarFrom.setCalendarModeDays() } else { r = new Date(this.data.to.getFullYear(), a, this.data.to.getDate()); this.calendarTo.setCalendarModeDays() } } this.calendarFrom.rangeText = ""; this.processDates(r, e); this.updateTextbox() } processDates(e, n = false) { switch (this.data.type) { case t.Single: { this.data.date = e; this.data.from = e; this.calendarFrom.UpdateCalendar(this.data.from); break } case t.Range: { if (n) { this.data.from = e } else { this.data.to = e } if (this.data.to !== null && this.data.from > this.data.to) { var s = this.data.from; this.data.from = this.data.to; this.data.to = s } else { if (this.data.to === null) this.data.to = e } this.data.from = this.data.from; this.data.to = this.data.to; this.calendarFrom.UpdateCalendar(this.data.from); this.calendarTo.UpdateCalendar(this.data.to); break } case t.Relative: { const t = Math.round((+e - +this.today) / DateRangePicker.oneDay); this.data.range = t; if (this.data.range < 0) { this.data.from = e; this.data.to = this.today; const t = this.formatData("", this.dateFormat); this.calendarFrom.rangeText = t; this.calendarFrom.UpdateCalendar(e) } else { this.data.from = this.today; this.data.to = e; const t = this.formatData("", this.dateFormat); this.calendarFrom.rangeText = t; this.calendarFrom.UpdateCalendar(e) } break } } } getBackendDateFormat(t) { const n = e.CalendarUtils.DATE_FORMAT_YMD; return this.formatData(t, n) } formatData(n = " to ", s) { switch (this.data.type) { case t.Single: if (["to", ","].includes(n)) return e.CalendarUtils.GetFormattedDate(this.data.date, s) + n + e.CalendarUtils.GetFormattedDate(this.data.date, s); else return e.CalendarUtils.GetFormattedDate(this.data.date, s); case t.Range: if (n !== ",") n = " to "; return e.CalendarUtils.GetFormattedDate(this.data.from, s) + n + e.CalendarUtils.GetFormattedDate(this.data.to, s); case t.Relative: if (["to", ","].includes(n)) { if (this.data.to === null) this.data.to = this.data.from; return e.CalendarUtils.GetFormattedDate(this.data.from, s) + n + e.CalendarUtils.GetFormattedDate(this.data.to, s) } else { if (this.data.range === 0) return "today"; else return Math.abs(this.data.range) + (this.data.range < 0 ? " prev" : " next") + " days" } default: return "" } } dayColor(n) { switch (this.data.type) { case t.Single: if (+n - +this.data.date === 0) return e.DatePickerDayColors.DAY_HIGHLIGHTED; break; case t.Relative: if (+n - +this.today === 0) { return e.DatePickerDayColors.DAY_SECONDARY } else { var s = DateRangePicker.GetRange(this.data.type, this.data); var a = []; if (+n - +s.from === 0 || +n - +s.to === 0) { a.push(e.DatePickerDayColors.DAY_HIGHLIGHTED); a.push(+n - +s.from ? "start-range" : "end-range"); return a.join(" ") } if (n >= s.from && n <= s.to) return e.DatePickerDayColors.DAY_PRIMARY } break; case t.Range: var a = []; if (+n - +this.data.from === 0 || +n - +this.data.to === 0) { a.push(e.DatePickerDayColors.DAY_HIGHLIGHTED); a.push(+n - +this.data.from ? "start-range" : "end-range"); return a.join(" ") } if (n >= this.data.from && n <= this.data.to) return e.DatePickerDayColors.DAY_PRIMARY; break; default: return "" } } setSpecificYear(t, n, s) { var a = new Date(n, s.getMonth(), s.getDate()); if (!isNaN(a.getTime())) { t.UpdateCalendar(a); var r = t === this.calendarFrom; if (r) this.data.from = a; else this.data.to = a } else { t.UpdateCalendar(s); e.Toaster.ShowToast("Invalid date value.", e.Colors.Orange, 4) } } canMoveTo(e, n) { var s = e === this.calendarFrom; if (this.data.type === t.Range) if (s && n > this.data.to || !s && n < this.data.from) return false; if (s) this.data.from = n; else this.data.to = n; return true } changeDateRangeType(n) { if (this.data) { this.data.type = n; this.parent.setAttribute("data-typeCalendar", this.data.type.toString()); this.calendarFrom.rangeText = ""; this.calendarFrom.UpdateCalendar(this.data.from); if (this.data.to && n !== t.Single) this.calendarTo.UpdateCalendar(this.data.to); switch (n) { case t.Single: this.inputMaskedDate.SetType(n, this.dateFormat, e.CalendarUtils.GetFormattedDate(this.data.from, this.dateFormat)); break; case t.Range: this.inputMaskedDate.SetType(n, this.dateFormat, this.formatData("to", this.dateFormat)); break; case t.Relative: const s = this.formatData("", this.dateFormat); this.inputMaskedDate.SetType(n, this.dateFormat, s); break }this.showSecondCalendar(this.data.type === t.Range); this.updateTextbox(false) } } updateTextbox(e = true) { const t = this.dateInput; if (!t.getAttribute("has-click-listener")) { t.setAttribute("has-click-listener", "true"); t.addEventListener("click", (() => document.execCommand("selectall"))) } if (this.init === true) { this.inputMaskedDate.SetValue(""); this.parent.setAttribute("data-range", ","); this.init = false } else { if (e) { const e = this.formatData(this.data.type.toString(), this.dateFormat); this.inputMaskedDate.SetValue(e); t.style.removeProperty("color"); this.parent.removeAttribute("data-validDate") } this.parent.setAttribute("data-range", this.getBackendDateFormat(",")) } } static GetRelativeDays(e) { var t = Math.round((e.from - e.to) / this.oneDay); return t } static GetRange(e, n) { switch (e) { case t.Single: return { from: n.date, to: n.date }; case t.Range: return { from: n.from, to: n.to }; case t.Relative: var s = new Date; s.setHours(0, 0, 0, 0); var a = n.range < 0 ? new Date(s.getTime() + DateRangePicker.oneDay * n.range) : s; var r = n.range > 0 ? new Date(s.getTime() + DateRangePicker.oneDay * n.range) : s; return { from: a, to: r }; default: return null } } } DateRangePicker.oneDay = 864e5; e.DateRangePicker = DateRangePicker })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["Text"] = 0] = "Text"; e[e["Textbox"] = 1] = "Textbox"; e[e["Button"] = 2] = "Button"; e[e["Password"] = 3] = "Password"; e[e["SelectBox"] = 4] = "SelectBox"; e[e["DataList"] = 5] = "DataList"; e[e["DateTime"] = 6] = "DateTime"; e[e["Checkbox"] = 7] = "Checkbox"; e[e["ButtonBar"] = 8] = "ButtonBar"; e[e["Radio"] = 9] = "Radio"; e[e["NewLine"] = 10] = "NewLine"; e[e["ImageField"] = 11] = "ImageField"; e[e["File"] = 12] = "File"; e[e["DropZoneUpload"] = 13] = "DropZoneUpload"; e[e["EnqueueMessages"] = 14] = "EnqueueMessages"; e[e["Group"] = 15] = "Group"; e[e["Label"] = 16] = "Label"; e[e["List"] = 17] = "List"; e[e["CheckboxList"] = 18] = "CheckboxList"; e[e["Container"] = 19] = "Container"; e[e["UpDown"] = 20] = "UpDown"; e[e["HumanName"] = 21] = "HumanName"; e[e["Address"] = 22] = "Address" })(t = e.EFieldType || (e.EFieldType = {})); class Group { constructor(e = "") { this.fields = []; this.group = e } } e.Group = Group; class Field { constructor(e, t, n, s, a, r, o) { this.params = {}; this.styles = {}; this.params = n; this.property = t; this.type = e; this.styles = s; this.classes = a; this.actionClick = r; this.events = o } UpdateValue(e, t) { if (typeof t === "boolean" || typeof t === "object" || t instanceof Date) { e[this.property] = t; return } var n = this.GetValue(e); try { if (typeof n === "number") e[this.property] = parseFloat(t); else e[this.property] = t.toString() } catch (e) { } } GetValue(e) { var t = e[this.property]; return t === undefined || t === null ? "" : t } } e.Field = Field; class Literal { constructor(e) { this.literal = e } } e.Literal = Literal; class Form { constructor(e, t, n = "YYYY-MM-DD") { this.elements = []; this.lastGroup = null; this.lastid = 1; this.baseId = this.getBaseId(); t["form"] = this; if (t["forms"] === undefined) { t["forms"] = new Array; t["forms"].push(this) } else t["forms"].push(this); this.binding = t; this.parent = e; this.dateFormat = n } AddField(e) { if (e.type === t.Group) { var n = new Group(e.params["text"] || ""); this.elements.push(n); this.lastGroup = n; return } if (this.lastGroup === null) { var s = new Group; this.elements.push(s); this.lastGroup = s } this.lastGroup.fields.push(e) } GetFields() { return this.lastGroup.fields } GetField(e) { var t = this.lastGroup.fields; for (var n = 0; n < t.length; n++) { var s = t[n]; if (s.property === e) return s } return null } AddFields(e, t = null) { for (var n = 0; n < e.length; n++) { this.AddField(e[n]) } } AddLiteral(e) { this.elements.push(new Literal(e)) } GetElements(e) { for (var t = 0; t < this.elements.length; t++) { var n = this.elements[t]; if (n.hasOwnProperty("group")) { var s = n; return s.fields } } return null } Render() { for (var e = 0; e < this.elements.length; e++) { var n = this.elements[e]; if (n.hasOwnProperty("content")) { var s = n; this.parent.innerHTML += s.literal } else if (n.hasOwnProperty("group")) { var a = n; var r = document.createElement("div"); this.parent.appendChild(r); if (a.group.length > 0) { var o = document.createElement("h2"); o.innerHTML = a.group; r.appendChild(o) } for (var l = 0; l < a.fields.length; l++) { var c = a.fields[l]; c.styles = c.styles || {}; c.params = c.params || {}; if (c.params.hasOwnProperty("width") && !c.styles.hasOwnProperty("width")) c.styles["width"] = c.params["width"] + "px"; var d = ""; var h = c.styles; var u = Object.keys(h); u.forEach((e => { d += e + ":" + h[e] + ";" })); var f = ""; if (c.classes !== null && c.classes !== undefined) { c.classes.forEach((e => { f += e + " " })) } var p = c.params["containerId"]; var m; if (p !== null && p !== undefined && p !== "") m = r[p]; else m = null; switch (c.type) { case t.Container: this.createContainer(m, r, c, d, f); break; case t.Text: case t.Label: this.createText(m, r, c, d, f); break; case t.Textbox: case t.Password: this.createTextbox(m, r, c, d, f); break; case t.UpDown: this.createUpDown(m, r, c, d, f); break; case t.Checkbox: this.createCheckbox(m, r, c, d, f); break; case t.Radio: this.createRadio(m, r, c, d, f); break; case t.ButtonBar: this.createButtonBar(m, r, c, d, f); break; case t.SelectBox: this.createSelectBox(m, r, c, d, f); break; case t.DataList: this.createDatalist(m, r, c, d, f); break; case t.DateTime: this.createDateTime(m, r, c, d, f); break; case t.NewLine: this.createNewLine(m, r, c, d, f); break; case t.ImageField: this.createImageField(m, r, c, d, f); break; case t.Button: this.createButton(m, r, c, d, f); break; case t.CheckboxList: this.createCheckboxList(m, r, c, d, f); break; case t.List: this.createList(m, r, c, d, f); break; case t.File: this.createFile(m, r, c, d, f); break; case t.DropZoneUpload: this.createDropZoneUpload(m, r, c, d, f); break; case t.HumanName: this.createHumanName(r, c); break }if (c.params["newline"] === true) { var g = document.createElement("p"); g.style.margin = "0"; g.innerHTML = "&nbsp;"; if (m !== undefined && m !== null) m.appendChild(g); else r.appendChild(g) } } } } } createContainer(e, t, n, s, a) { var r = document.createElement("div"); var o = n.params["id"]; r.id = o; n.htmlElement = r; if (s !== "") r.setAttribute("style", s); if (a !== "") r.setAttribute("class", a); if (e) e.appendChild(r); else t.appendChild(r); t[o] = r } createText(e, t, n, s, a) { var r = document.createElement("div"); r.id = n.params["id"] === undefined ? this.getNewId() : n.params["id"]; var o = n.params["text"]; if (o !== "") { if (n.params["colon"] === true) o += ":"; r.innerHTML = o } else { r.innerHTML = " " } if (e) e.appendChild(r); else t.appendChild(r); if (s !== "") r.setAttribute("style", s); if (a !== "") r.setAttribute("class", a); n.htmlElement = r } createTextbox(n, s, a, r, o) { var l = document.createElement("input"); l.id = a.params["id"] === undefined ? this.getNewId() : a.params["id"]; l.type = a.type === t.Password ? "password" : a.params["type"] || "text"; l.value = a.params["value"] || ""; l["field"] = a; l["binding"] = this.binding; l["onBlur"] = a.params["onBlur"]; l.autocomplete = a.params["autocomplete"] || "off"; if (r !== "") l.setAttribute("style", r); if (o !== "") l.setAttribute("class", o); if (a.type === t.Textbox) l.placeholder = a.params["placeholder"] || ""; l.readOnly = a.params["readonly"] === undefined ? false : e.Utils.StrToBool(a.params["readonly"]); a.UpdateValue(this.binding, l.value); l.oninput = e => { var t = e.target; t["field"].UpdateValue(t["binding"], t.value) }; l.onfocus = e => { var t = e.target; if (t["focusIn"] !== undefined) t["focusIn"](e) }; l.onkeydown = e => { var t = e.target; if (t["keyDown"] !== undefined) t["keyDown"](e) }; l.onkeypress = e => { var t = e.target; if (t["keyPress"] !== undefined) t["keyPress"](e) }; l.onblur = e => { var t = e.target; if (t["onBlur"] !== undefined) { t["onBlur"](e); t["field"].UpdateValue(t["binding"], t.value) } }; a.htmlElement = l; if (n !== undefined && n !== null) n.appendChild(l); else s.appendChild(l) } createHumanName(t, n) { n["controller"] = new e.HumanNameControl(t) } createUpDown(t, n, s, a, r) { var o = s.params["isRange"]; var l = s.params["inc"]; var c = s.params["controlRefId"]; var d = s.params["defaultV"]; var h; if (t !== undefined && t !== null) h = t; else h = n; var u = new e.UpDownControl(c, s.params["values"], h, o, l, d); u.Element["UpDownObject"] = u; u.Element["GetIndexValue"] = (e, t) => { for (var n = 0; n < e.Items.length; n++) { var s = e.Items[n].Value.toString(); var a = new RegExp(t); if (s.match(a)) { return n } } return null }; u.Element["UpdateInputReference"] = (e, t) => { var n = document.getElementById(e.InputElement); var s; if (t) { s = e.Item = e.Items[e.Index] } else { var a = -1; for (var r = 0; r < e.Items.length; r++) { var o = isNaN(parseFloat(e.Items[r].Value)) === true ? e.Items[r].Value : parseFloat(e.Items[r].Value); var l = isNaN(parseFloat(e.Item.Value)) === true ? e.Items[r].Value : parseFloat(e.Item.Value); if (o === l) { a = r; break } } s = e.Item; e.Index = a } e.Element["field"].UpdateValue(e.Element["binding"], s); if (n !== null) n.value = s.Text }; if (a !== "") u.Element.setAttribute("style", a); if (r !== "") u.Element.setAttribute("class", r); u.IncreaseEv = (e, t, n) => { e["field"].UpdateValue(e["binding"], t); n.Element["UpdateInputReference"](n, true); if (n.Element["Increase"] !== undefined) n.Element["Increase"](t) }; u.DecreaseEv = (e, t, n) => { e["field"].UpdateValue(e["binding"], t); n.Element["UpdateInputReference"](n, true); if (n.Element["Decrease"] !== undefined) n.Element["Decrease"](t) }; u.Element["field"] = s; u.Element["binding"] = this.binding; u.Create(); s.UpdateValue(this.binding, u.Item); s.htmlElement = u.Element } createCheckbox(t, n, s, a, r) { var o = document.createElement("input"); o.id = s.params["id"] === undefined ? this.getNewId() : s.params["id"]; o.type = "checkbox"; o.checked = e.Utils.StrToBool(s.params["checked"]); o["field"] = s; o["binding"] = this.binding; o["action"] = s.params["action"]; if (a !== "") o.setAttribute("style", a); if (r !== "") o.setAttribute("class", r); if (s.params["disabled"] !== undefined) o.disabled = s.params["disabled"]; s.UpdateValue(this.binding, o.checked); o.onchange = e => { var t = e.target; t["field"].UpdateValue(t["binding"], t.checked); if (t["action"] !== null && t["action"] !== undefined) { var n = t["action"]; n(e, t["binding"], this) } if (t["field"].actionClick !== null && t["field"].actionClick !== undefined) { t["field"].actionClick(e, t["binding"], this) } }; if (t !== undefined && t !== null) t.appendChild(o); else n.appendChild(o); var l = document.createElement("label"); l.innerHTML = s.params["label"]; l.htmlFor = o.id; if (s.params["styleLabel"]) l.setAttribute("style", s.params["styleLabel"]); s.htmlElement = o; s.labelhtmlElement = l; if (t !== undefined && t !== null) t.appendChild(l); else n.appendChild(l) } createRadio(t, n, s, a, r) { var o = document.createElement("input"); o.id = this.getNewId(); o["field"] = s; o["binding"] = this.binding; o["action"] = s.params["action"]; o.type = "radio"; o.checked = e.Utils.StrToBool(s.params["checked"]); o.name = s.params["name"]; if (r !== "") o.setAttribute("class", r); s.UpdateValue(this.binding, o.checked); s.htmlElement = o; o.onchange = e => { var t = e.target; t["field"].UpdateValue(t["binding"], t.checked); if (t["action"] !== "" && t["action"] !== null && t["action"] !== undefined) { var n = t["action"]; n(e, t["binding"]) } }; if (t !== undefined && t !== null) t.appendChild(o); else n.appendChild(o); var l = document.createElement("label"); l.innerHTML = s.params["label"]; l.htmlFor = o.id; if (a !== "") l.setAttribute("style", a); if (t !== undefined && t !== null) t.appendChild(l); else n.appendChild(l) } createButtonBar(e, t, n, s, a) { var r = document.createElement("div"); r.className = "buttonbar"; if (e !== undefined && e !== null) e.appendChild(r); else t.appendChild(r); if (s !== "") r.setAttribute("style", s); if (a !== "") r.setAttribute("class", a); var o = n.params["options"] || []; var l = n.params["values"] || o; var c = n.params["onChange"]; var d = o.constructor === Array ? o : o.split(","); var h = l.constructor === Array ? l : l.split(","); n.htmlElements = new Array; for (var u = 0; u < d.length; u++) { var f = document.createElement("input"); var p = n.params["optionchecked"]; var m = n.params["id"]; f["field"] = n; f["binding"] = this.binding; f["bbValue"] = h[u]; f.id = m + "_" + u; f.type = "radio"; f.checked = p === h[u]; f.name = n.params["name"]; f["onChange"] = c; n.UpdateValue(this.binding, p); f.onchange = e => { var t = e.target; if (t["onChange"] !== undefined) t["onChange"](e); if (t.checked) t["field"].UpdateValue(t["binding"], t["bbValue"]) }; r.appendChild(f); var g = document.createElement("label"); g.innerHTML = d[u]; g.htmlFor = f.id; r.appendChild(g); n.htmlElements.push(f) } } createSelectBox(t, n, s, a, r) { var o = document.createElement("select"); o.id = s.params["id"] === undefined ? this.getNewId() : s.params["id"]; o["field"] = s; o["binding"] = this.binding; o["action"] = s.params["action"]; if (a !== "") o.setAttribute("style", a); if (r !== "") o.setAttribute("class", r); if (s.params["disabled"] !== undefined) o.disabled = s.params["disabled"]; s.UpdateValue(this.binding, s.params["value"]); o.onchange = e => { var t = e.target; t["field"].UpdateValue(t["binding"], t.options[t.selectedIndex]["value"] || ""); if (t["action"] !== null && t["action"] !== undefined) { var n = t["action"]; n(e, this) } }; var renderSelect = t => { var n = t.params["value"]; var s = t.params["options"] || []; var a = s.constructor === Array ? s : s.split(","); var r = t.params["values"] || []; var o = r.constructor === Array ? r : r.split(","); var l = t.params["isGroups"]; var c = t.params["dataOptions"] || []; t.UpdateValue(this.binding, t.params["value"]); if (l === undefined || !l) { for (var d = 0; d < a.length; d++) { var h = document.createElement("option"); h.value = o[d]; h.text = a[d]; if (c.length > d) h.setAttribute("data-aditional", c[d]); h.selected = h.value === n; t.htmlElement.appendChild(h) } } else { var u = t.params["groups"]; for (var f = 0; f < u.length; f++) { var p = document.createElement("optgroup"); p.style.color = e.Colors.BgDarker; p.label = u[f].groupName; for (var m = 0; m < u[f].names.length; m++) { var g = document.createElement("option"); g.value = u[f].values[m]; g.text = u[f].names[m]; g.selected = g.value === n; p.appendChild(g) } t.htmlElement.appendChild(p) } } }; o["UpdateData"] = e => { e.htmlElement.innerHTML = ""; renderSelect(e) }; s.htmlElement = o; renderSelect(s); if (t !== undefined && t !== null) t.appendChild(o); else n.appendChild(o) } createDatalist(t, n, s, a, r) { var o = document.createElement("input"); o.type = "text"; var l = this.getNewId(); o.id = s.params["id"] === undefined ? l : s.params["id"]; o.setAttribute("list", (s.params["id"] === undefined ? l : s.params["id"]) + "_"); var c = document.createElement("datalist"); c.id = (s.params["id"] === undefined ? l : s.params["id"]) + "_"; c["field"] = s; c["binding"] = this.binding; c["action"] = s.params["action"]; if (a !== "") o.setAttribute("style", a); if (r !== "") o.setAttribute("class", r); s.UpdateValue(this.binding, s.params["value"]); c.onchange = e => { var t = e.target; t["field"].UpdateValue(t["binding"], t.options[t.selectedIndex]["value"] || ""); if (t["action"] !== null && t["action"] !== undefined) { var n = t["action"]; n(e, this) } }; var renderSelect = t => { var n = t.params["value"]; var s = t.params["options"] || []; var a = s.constructor === Array ? s : s.split(","); var r = t.params["values"] || []; var o = r.constructor === Array ? r : r.split(","); var l = t.params["isGroups"]; var c = t.params["dataOptions"] || []; t.UpdateValue(this.binding, t.params["value"]); if (l === undefined || !l) { for (var d = 0; d < a.length; d++) { var h = document.createElement("option"); h.value = o[d]; h.text = a[d]; if (c.length > d) h.setAttribute("data-aditional", c[d]); h.selected = h.value === n; t.htmlElement.appendChild(h) } } else { var u = t.params["groups"]; for (var f = 0; f < u.length; f++) { var p = document.createElement("optgroup"); p.style.color = e.Colors.BgDarker; p.label = u[f].groupName; for (var m = 0; m < u[f].names.length; m++) { var g = document.createElement("option"); g.value = u[f].values[m]; g.text = u[f].names[m]; g.selected = g.value === n; p.appendChild(g) } t.htmlElement.appendChild(p) } } }; c["UpdateData"] = e => { e.htmlElement.innerHTML = ""; renderSelect(e) }; s.htmlElement = c; renderSelect(s); if (t !== undefined && t !== null) { t.appendChild(o); t.appendChild(c) } else { n.appendChild(o); n.appendChild(c) } } createDateTime(t, n, s, a, r) { var o = document.createElement("div"); o["field"] = s; o["binding"] = this.binding; o.id = s.params["id"] === undefined ? this.getNewId() : s.params["id"]; if (a !== "") o.setAttribute("style", a); if (r !== "") o.setAttribute("class", r); if (s.params.hasOwnProperty("space")) o.innerHTML = "&nbsp;"; if (t !== undefined && t !== null) t.appendChild(o); else n.appendChild(o); o["generateDatePicker"] = t => { var n = t.params["value"]; var s = t.params["controltype"]; var a = t.params["onlySingle"] === undefined ? false : t.params["onlySingle"]; var r = n !== null && n !== "" ? JSON.parse(n) : ""; var l; if (r !== "") s = e.EDateRangeType[r.type]; if (document.getElementById(t.params["id"]) !== null) e.DOMUtils.RemoveItem(document.getElementById(t.params["id"]).nextSibling); t.htmlElement.innerHTML = ""; switch (s) { case e.EDateRangeType[0]: if (r !== "") { l = new e.DateRangePicker(t.htmlElement, { date: new Date(r.date), from: null, to: null, type: e.EDateRangeType.Single }, { onlySingle: a }) } else l = new e.DateRangePicker(t.htmlElement, { date: new Date, from: new Date, to: new Date, type: e.EDateRangeType.Single }, { onlySingle: a }); break; case e.EDateRangeType[1]: if (r !== "") { l = new e.DateRangePicker(t.htmlElement, { date: new Date, from: new Date(r.from), to: new Date(r.to), type: e.EDateRangeType.Range }, { allowEmpty: false }) } else l = new e.DateRangePicker(t.htmlElement, { date: new Date, from: new Date, to: new Date, type: e.EDateRangeType.Range }, { allowEmpty: true }); break; case "relative": if (r !== "") { l = new e.DateRangePicker(t.htmlElement, { date: new Date, from: new Date(r.from), range: r.range, to: new Date(r.to), type: e.EDateRangeType.Relative }, { allowEmpty: false }) } else l = new e.DateRangePicker(t.htmlElement, { date: new Date, from: new Date, to: new Date, range: 0, type: e.EDateRangeType.Relative }, { allowEmpty: true }); break }o["datePickerObj"] = l; t.UpdateValue(this.binding, r !== "" ? l.getData() : "") }; o.addEventListener("emptyValue", (e => { var t = e.target; t["field"]["params"]["value"] = "" }), false); o.onchange = e => { var t = e.target; if (t["field"] !== undefined) t["field"].UpdateValue(t["binding"], t["dataDPick"]) }; s.htmlElement = o; o["generateDatePicker"](s) } createNewLine(e, t, n, s, a) { var r = document.createElement("p"); if (s !== "") r.setAttribute("style", s); if (a !== "") r.setAttribute("class", a); if (n.params.hasOwnProperty("space")) r.innerHTML = "&nbsp;"; if (e !== undefined && e !== null) e.appendChild(r); else t.appendChild(r) } createImageField(e, t, n, s, a) { var r = new Image; r.src = n.params["src"]; if (s !== "") r.setAttribute("style", s); if (a !== "") r.setAttribute("class", a); if (e !== undefined && e !== null) e.appendChild(r); else t.appendChild(r) } createButton(e, t, n, s, a) { var r = document.createElement("button"); r["actionItem"] = n.actionClick; r.innerHTML = n.params["text"]; r.type = "button"; if (s !== "") r.setAttribute("style", s); if (a !== "") r.setAttribute("class", a); if (n.params["disabled"] !== undefined) r.disabled = n.params["disabled"]; if (n.params["id"] !== undefined) r.id = n.params["id"]; r.onclick = e => { var t = e.target; if (t.nodeName.toLowerCase() !== "button") t = t.parentElement; var n = t["actionItem"]; if (n !== undefined) n(this.binding) }; n.htmlElement = r; if (e !== undefined && e !== null) e.appendChild(r); else t.appendChild(r) } createCheckboxList(t, n, s, a, r) { var o = document.createElement("div"); e.DOMUtils.AddClass(o, "checkboxListForm dottedBorder"); o["field"] = s; o["binding"] = this.binding; o.id = s.params["id"]; o["data"] = new Array; if (a !== "") o.setAttribute("style", a); if (r !== "") e.DOMUtils.AddClass(o, r); o["AddItem"] = e => { o["data"].push(e); updateCheckboxListBinding() }; o["RemoveItem"] = e => { var t = o["data"]; var n = new Array; for (var s = 0; s < t.length; s++) { var a = JSON.parse(t[s]); var r = JSON.parse(e); if (a["id"] !== r["id"]) n.push(t[s]) } o["data"] = n; updateCheckboxListBinding() }; o["Reset"] = () => { o["data"] = new Array; o.innerHTML = ""; updateCheckboxListBinding() }; var updateCheckboxListBinding = () => { var e = new Array; var t = new Array; var n = o.getElementsByClassName("chckItemListChForm"); for (var s = 0; s < n.length; s++) { if (n[s].checked) e.push(n[s].getAttribute("dataEntity")); else t.push(n[s].getAttribute("dataEntity")) } var a = { active: e, inactive: t }; o["field"].UpdateValue(o["binding"], JSON.stringify(a)) }; o["Render"] = () => { o.innerHTML = ""; var e = o["data"]; e.forEach((e => { var t = JSON.parse(e); var n = document.createElement("div"); n.className = "itemCheckboxListForm"; n.setAttribute("id", t["id"]); var s = document.createElement("input"); s.type = "checkbox"; s.className = "chckItemListChForm"; s.checked = t["checked"]; s.onchange = e => { var t = e.target; var n = JSON.parse(t.getAttribute("dataEntity")); n.checked = t.checked; t.setAttribute("dataEntity", JSON.stringify(n)); updateCheckboxListBinding() }; s.setAttribute("dataEntity", e); s.setAttribute("id", "checkId_" + t["id"]); var a = document.createElement("label"); a.setAttribute("for", "checkId_" + t["id"]); a.onclick = e => { var t = document.getElementById(e.target.getAttribute("for")); var n = JSON.parse(t.getAttribute("dataEntity")); n.checked = t.checked; t.setAttribute("dataEntity", JSON.stringify(n)); updateCheckboxListBinding() }; a.innerHTML = t["value"]; n.appendChild(s); n.appendChild(a); o.appendChild(n) })); updateCheckboxListBinding() }; s.htmlElement = o; if (t !== undefined && t !== null) t.appendChild(o); else n.appendChild(o) } createList(t, n, s, a, r) { var o = document.createElement("div"); e.DOMUtils.AddClass(o, "listForm dottedBorder"); o["field"] = s; o["binding"] = this.binding; o.id = s.params["id"]; o["data"] = new Array; if (a !== "") o.setAttribute("style", a); if (r !== "") e.DOMUtils.AddClass(o, r); o["AddItem"] = e => { o["data"].push(e) }; o["RemoveItem"] = e => { var t = o["data"]; var n = new Array; for (var s = 0; s < t.length; s++) { var a = JSON.parse(t[s]); var r = JSON.parse(e); if (a["id"] !== r["id"]) n.push(t[s]) } o["data"] = n }; o["Reset"] = () => { o["data"] = new Array; o.innerHTML = "" }; o["Render"] = (t, n) => { o.innerHTML = ""; var s = o["data"]; s.forEach((s => { var a = JSON.parse(s); var r = document.createElement("div"); r.className = "itemListForm"; r.setAttribute("dataEntity", s); r.setAttribute("id", a["id"]); r.innerHTML = a["value"]; r.onclick = s => { var a = s.target; if (!e.DOMUtils.HasClass(a, "itemSelectListForm")) { var r = o.getElementsByClassName("itemListForm"); for (var l = 0; l < r.length; l++) { if (e.DOMUtils.HasClass(r[l], "itemSelectListForm")) e.DOMUtils.RemoveClass(r[l], "itemSelectListForm") } e.DOMUtils.AddClass(a, "itemSelectListForm"); o["field"].UpdateValue(o["binding"], a.getAttribute("dataEntity")); if (t !== undefined) t(a.getAttribute("dataEntity")) } else { e.DOMUtils.RemoveClass(a, "itemSelectListForm"); o["field"].UpdateValue(o["binding"], null); if (n !== undefined) n() } }; o.appendChild(r) })) }; s.htmlElement = o; if (t !== undefined && t !== null) t.appendChild(o); else n.appendChild(o) } createFile(t, n, s, a, r) { var o = document.createElement("input"); o["field"] = s; o["binding"] = this.binding; o.id = s.params["id"]; o.name = o.id; o.type = "file"; o.multiple = e.Utils.StrToBool(s.params["multiple"]); o.accept = s.params["extension"]; o.style.width = "0.1px"; o.style.height = "0.1px"; o.style.opacity = "0"; o.style.overflow = "hidden"; o.style.position = "absolute"; o.style.zIndex = "-1"; if (o.multiple) { o.setAttribute("webkitdirectory", "multiple"); o.setAttribute("directory", "multiple") } var l = document.createElement("label"); l.setAttribute("for", o.id); l.innerHTML = s.params["label"]; if (a !== "") l.setAttribute("style", a); if (r !== "") l.setAttribute("class", r); var c = s.params["queueId"]; o.setAttribute("dropZoneId", c); o.onchange = e => { var t = event.target; t["field"].UpdateValue(t["binding"], t.files); var n = document.getElementById(t.getAttribute("dropZoneId")); if (n) { var s = t.files; n["filesList"] = s; n["field"].UpdateValue(n["binding"], s); for (var a = 0; a < s.length; a++) { var r = document.createElement("div"); r.className = "itemDropZone"; var o = s[a].name.trim().lastIndexOf("."); var l = s[a].name.trim().substring(o + 1); if (e.target["accept"] === "." + l) { r.innerHTML = s[a].name + ". Size : " + this.sizeAprox(s[a].size); n.appendChild(r) } } } }; if (t !== undefined && t !== null) { t.appendChild(o); t.appendChild(l) } else { n.appendChild(o); n.appendChild(l) } s.htmlElement = o } createDropZoneUpload(e, t, n, s, a) { var r = document.createElement("div"); r.id = n.params["id"]; r["actionClickItem"] = n.actionClick; r["actionsEvents"] = n.events; r["filesList"] = new Array; r["field"] = n; r["binding"] = this.binding; if (s !== "") r.setAttribute("style", s); if (a !== "") r.setAttribute("class", a); r.ondragover = r.ondragenter = e => { e.stopPropagation(); e.preventDefault(); var t = e.target["actionsEvents"]; t[0](this.binding, e.target) }; r.ondragleave = r.ondragend = e => { e.stopPropagation(); e.preventDefault(); var t = e.target["actionsEvents"]; t[1](this.binding, e.target) }; r.ondrop = e => { e.stopPropagation(); e.preventDefault(); var t = e.dataTransfer.files; var n = e.target; var s = n["filesList"]; for (var a = 0; a < t.length; a++) { var r = document.createElement("div"); r.className = "itemDropZone"; r.innerHTML = t[a].name + ". Size : " + this.sizeAprox(t[a].size); n.appendChild(r); s.push(t[a]) } n["field"].UpdateValue(n["binding"], s); n["filesList"] = s; var o = e.target["actionsEvents"]; o[2](this.binding, e.target) }; if (e !== undefined && e !== null) e.appendChild(r); else t.appendChild(r); n.htmlElement = r } sizeAprox(e) { var t = ""; for (var n = ["KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB"], s = 0, a = e / 1024; a > 1; a /= 1024, s++) { t = a.toFixed(3) + " " + n[s] } return t } getBaseId() { var e; do { e = "_" + Math.random().toString(36).substr(2, 5) } while (document.getElementById(e) !== null); return e } getNewId() { return this.baseId + "_" + this.lastid++ } static GetSectionOrBlockForm(e, t, n) { var s; if (!isNaN(t)) { if (n) { s = e[t] } else { e.forEach((e => { var n = e; var a = Object.keys(n); a.forEach(((e, a) => { var r = n[e]; if (a === t) s = r })) })) } } else { e.forEach((e => { var a = e.getAttribute("id"); if (n) { if (a === t) s = e } else { var r = Object.keys(e); r.forEach((n => { var a = e[n]; if (a.getAttribute("id") === t) s = a })) } })) } return s } static GetFieldFromForms(e, t, n) { var s = null; var a; if (Array.isArray(e)) { e.forEach((e => { a = e["forms"]; a.forEach((e => { if (t != null) { var a = e.GetField(t); if (a !== null) { s = a; return } } else if (n) { s = this.searchPropertiesInForms(e, n) } })) })) } else if (e instanceof Object) { a = e["forms"]; a === null || a === void 0 ? void 0 : a.forEach((e => { if (t !== null) { var a = e.GetField(t); if (a !== null) { s = a; return } } else if (n) { s = this.searchPropertiesInForms(e, n) } })) } return s } static searchPropertiesInForms(t, n) { var s = new Array; try { var a = t.elements; a.forEach((e => { if (n) { var t = e; t.fields.forEach((e => { if (n) { var t = e; var a = JSON.parse(n); var r = Object.keys(a); r.forEach((e => { if (n) { var r = a[e]; if (Array.isArray(t[e])) { if (t[e].some((e => e === r))) s.push(t) } else { if (t[e].match(r)) s.push(t) } } })) } })) } })) } catch (t) { e.Utils.DebugConsoleLog(t); s = null } return s } } e.Form = Form })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t = e.DOMUtils; class HumanNameControl { constructor(e, t) { this.extraPrefixesArray = []; this.extraSuffixesArray = []; this.parentContainer = e; this.familyInput = document.createElement("input"); this.familyInput.type = "text"; this.familyInput.style.width = "250px"; this.givenInput = document.createElement("input"); this.givenInput.type = "text"; this.givenInput.style.width = "250px"; this.prefixInput = document.createElement("input"); this.prefixInput.type = "text"; this.prefixInput.style.width = "50px"; this.prefixInput.style.display = "inline-block"; this.extraPrefixesArray.push(this.prefixInput); this.suffixInput = document.createElement("input"); this.suffixInput.type = "text"; this.suffixInput.style.width = "50px"; this.suffixInput.style.display = "inline-block"; this.extraSuffixesArray.push(this.suffixInput); this.extraPrefixesContainer = document.createElement("div"); this.extraPrefixesContainer.style.display = "inline-block"; this.extraSuffixesContainer = document.createElement("div"); this.extraSuffixesContainer.style.display = "inline-block"; if (t !== undefined) { this.SetFields(t) } this.CreateInputs() } NameIsSet() { var e = false; if (this.familyInput.value !== "" && this.givenInput.value !== "") { e = true } return e } SetFields(e) { try { this.givenInput.value = e[0].given } catch (e) { } try { this.familyInput.value = e[0].family } catch (e) { } try { if (e[0].prefix[0]) { this.prefixInput.value = e[0].prefix[0]; for (var t = 1; t < e[0].prefix.length; t++) { this.addSuffixPrefix("prefix", e[0].prefix[t]) } } } catch (e) { } try { if (e[0].suffix[0]) { this.suffixInput.value = e[0].suffix[0]; for (var t = 1; t < e[0].suffix.length; t++) { this.addSuffixPrefix("suffix", e[0].suffix[t]) } } } catch (e) { } } GetHumanNameObject() { var e = []; for (var t = 0; t < this.extraPrefixesArray.length; t++) { var n = this.extraPrefixesArray[t].value; if (n !== "") { e.push(n) } } var s = []; for (var a = 0; a < this.extraSuffixesArray.length; a++) { var r = this.extraSuffixesArray[a].value; if (r !== "") { s.push(r) } } var o = e.length > 0 ? e.join(" ") + " " : ""; var l = s.length > 0 ? " " + s.join(" ") : ""; var c = [{ given: [this.givenInput.value], family: this.familyInput.value, prefix: e, suffix: s, text: o + this.familyInput.value + " " + this.givenInput.value + l }]; return c } removeSuffixPrefix(e) { if (e === "suffix") { if (this.extraSuffixesArray.length > 1) { this.extraSuffixesArray[this.extraSuffixesArray.length - 1].remove(); this.extraSuffixesArray.pop() } } else if (e === "prefix") { if (this.extraPrefixesArray.length > 1) { this.extraPrefixesArray[this.extraPrefixesArray.length - 1].remove(); this.extraPrefixesArray.pop() } } } addSuffixPrefix(e, t) { var n = document.createElement("input"); n.type = "text"; n.style.width = "50px"; n.style.display = "inline-block"; n.style.marginLeft = "10px"; if (t !== undefined) { n.value = t } if (e === "suffix") { this.extraSuffixesContainer.appendChild(n); this.extraSuffixesArray.push(n) } else if (e === "prefix") { this.extraPrefixesContainer.appendChild(n); this.extraPrefixesArray.push(n) } } createLabel(e) { var t = document.createElement("div"); t.innerText = e; t.style.display = "inline-block"; t.style.width = "130px"; return t } createAddRemoveButtons(e, n) { var s = n === "add" ? "blue" : "red"; var a = n === "add" ? "+" : "-"; var r = document.createElement("button"); t.AddClass(r, s + " squareButton"); r.innerText = a; r.style.width = "20px"; r.style.marginLeft = "10px"; r.addEventListener("click", (() => { e() })); return r } CreateInputs() { var e = this.createLabel("Last name:"); var t = this.createLabel("First name:"); var n = this.createLabel("Prefix:"); var s = this.createLabel("Suffix:"); var a = document.createElement("p"); var r = this.createAddRemoveButtons((() => { this.addSuffixPrefix("suffix") }), "add"); var o = this.createAddRemoveButtons((() => { this.removeSuffixPrefix("suffix") }), "remove"); var l = this.createAddRemoveButtons((() => { this.addSuffixPrefix("prefix") }), "add"); var c = this.createAddRemoveButtons((() => { this.removeSuffixPrefix("prefix") }), "remove"); this.parentContainer.appendChild(n); this.parentContainer.appendChild(this.prefixInput); this.parentContainer.appendChild(this.extraPrefixesContainer); this.parentContainer.appendChild(l); this.parentContainer.appendChild(c); this.parentContainer.appendChild(a.cloneNode()); this.parentContainer.appendChild(e); this.parentContainer.appendChild(this.familyInput); this.parentContainer.appendChild(a); this.parentContainer.appendChild(t); this.parentContainer.appendChild(this.givenInput); this.parentContainer.appendChild(a.cloneNode()); this.parentContainer.appendChild(s); this.parentContainer.appendChild(this.suffixInput); this.parentContainer.appendChild(this.extraSuffixesContainer); this.parentContainer.appendChild(r); this.parentContainer.appendChild(o); this.parentContainer.appendChild(a.cloneNode()) } } e.HumanNameControl = HumanNameControl })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { const t = { REGEX_MONTH_INI: /[0-1]/i, REGEX_MONTH: /1[0-2]|0[1-9]/i, REGEX_DAY_INI: /[0-3]/i, REGEX_DAY: /3[0-1]|[1-2][0-9]|0[1-9]/i, REGEX_YEAR_INI: /[1-2]/i }; const n = "has-mask-date"; class InputMaskedDate { constructor(t, n, s, a = e.EDateRangeType.Single, r = ((e, t) => { })) { this.input = t; this.maskElement = n; this.format = this.fixFormat(s); this.type = a; this.mask = this.getMask(this.format, a); this.onChange = r; this.initInputEvents() } SetValue(e) { let t = ""; if (e) { if (e.indexOf("/") > -1) t = e.replace(/\//g, "-"); else t = e } this.updateInputControl(t) } SetFormat(t) { if (t) this.format = this.fixFormat(t); else this.format = e.CalendarUtils.DATE_FORMAT_YMD; this.mask = this.getMask(this.format, this.type); this.updateInputControl(this.input.value) } SetType(e, t, n) { this.type = e; this.mask = this.getMask(t || this.format, this.type); this.input.maxLength = this.mask.length; this.updateInputControl(n || this.input.value) } fixFormat(e) { return e.toUpperCase().replace(/\//g, "-") } updateInputControl(t) { var n; this.input.value = t; this.maskElement.innerHTML = this.getMaskedText(t); if (t.length === this.mask.length) { let n; let s; let a; switch (this.type) { case e.EDateRangeType.Single: n = e.CalendarUtils.GetDateFromString(t, this.format); s = null; break; case e.EDateRangeType.Range: const [r, o] = t.split(" to "); n = e.CalendarUtils.GetDateFromString(r, this.format); s = e.CalendarUtils.GetDateFromString(o, this.format); break; case e.EDateRangeType.Relative: const l = t.indexOf("prev") > -1 ? -1 : 1; const c = parseInt(t, 10); a = c; n = e.CalendarUtils.AddDays(new Date, c * l); s = null; break; default: break }this.onChange(n, s, a) } else { let s; let a; let r; if (this.type === e.EDateRangeType.Single) { s = new Date; a = new Date } if (this.type === e.EDateRangeType.Relative) { let r = 0; if (isNaN(+t)) { if (t === "today") { s = new Date; a = new Date } else if (t.includes("to")) { const [n, r] = t.split(" to "); s = e.CalendarUtils.GetDateFromString(n, this.format); a = e.CalendarUtils.GetDateFromString(r, this.format) } else if (t.includes("days")) { const o = (n = t.split("days")[0]) === null || n === void 0 ? void 0 : n.trim(); const l = o.includes("prev") ? -1 : +1; r = +(l * parseInt(o, 10)); if (r >= 0) { s = new Date; a = e.CalendarUtils.AddDays(s, r) } else { a = new Date; s = e.CalendarUtils.AddDays(a, r) } } else { s = e.CalendarUtils.GetDateFromString(t, this.format); a = e.CalendarUtils.GetDateFromString(t, this.format) } } else { r = +t; if (r >= 0) { s = new Date; a = e.CalendarUtils.AddDays(s, r) } else { a = new Date; s = e.CalendarUtils.AddDays(a, r) } } this.onChange(s, a, r) } } } getMask(t, n) { switch (n) { case e.EDateRangeType.Single: return t; case e.EDateRangeType.Range: return `${t} to ${t}`; case e.EDateRangeType.Relative: return "+/- N Days" + Array(5).fill(" ").join(""); default: return "" } } initInputEvents() { if (!this.input.hasAttribute(n)) { this.input.addEventListener("keydown", (e => this.processKeyDown(e))); this.input.addEventListener("input", (t => { if (this.type === e.EDateRangeType.Single && this.format === e.CalendarUtils.DATE_FORMAT_DMY) this.processSimpleDateInputDMY(t); if (this.type === e.EDateRangeType.Single && this.format === e.CalendarUtils.DATE_FORMAT_MDY) this.processSimpleDateInputMDY(t); if (this.type === e.EDateRangeType.Single && this.format === e.CalendarUtils.DATE_FORMAT_YMD) this.processSimpleDateInputYMD(t); if (this.type === e.EDateRangeType.Range && [e.CalendarUtils.DATE_FORMAT_DMY, e.CalendarUtils.DATE_FORMAT_MDY, e.CalendarUtils.DATE_FORMAT_YMD].includes(this.format)) this.processRangeDateInput(t); if (this.type === e.EDateRangeType.Relative) this.processRelativeDateInput(t) })); this.input.setAttribute(n, "true") } this.input.maxLength = this.mask.length; this.maskElement.innerHTML = this.mask } processKeyDown(t) { this.keyPressed = t.key; if (this.type === e.EDateRangeType.Relative) { if (![e.Utils.INPUTKEY_NAMES.BACKSPACE, e.Utils.INPUTKEY_NAMES.SPACE, e.Utils.INPUTKEY_NAMES.TAB].includes(this.keyPressed)) { if (!["+", "-"].includes(this.keyPressed)) { if (isNaN(+this.keyPressed)) { t.preventDefault(); t.stopPropagation(); return } } } } else { if (this.keyPressed !== e.Utils.INPUTKEY_NAMES.BACKSPACE) { if (isNaN(+this.keyPressed) || this.keyPressed === e.Utils.INPUTKEY_NAMES.SPACE) { if (this.keyPressed !== e.Utils.INPUTKEY_NAMES.TAB) { t.preventDefault(); t.stopPropagation(); return } } } } } processSimpleDateInputMDY(t) { const { value: n } = t.target; let s; if (this.keyPressed !== e.Utils.INPUTKEY_NAMES.BACKSPACE) s = this.getDateFormattedValueMDY(n); else s = this.getErasedText(n); this.updateInputControl(s) } getDateFormattedValueMDY(n) { let s = n; let a; switch (n.length) { case 1: s = t.REGEX_MONTH_INI.test(n) ? n : n.substr(0, n.length - 1); break; case 2: if (t.REGEX_MONTH.test(n)) s = `${n}-`; else s = n.substr(0, n.length - 1); break; case 3: a = n.substr(-1); if (a !== "-") { if (t.REGEX_DAY_INI.test(a)) s = `${n.substr(0, n.length - 1)}-${a}`; else s = `${n.substr(0, n.length - 1)}-` } break; case 4: s = t.REGEX_DAY_INI.test(n.substr(-1)) ? n : n.substr(0, n.length - 1); break; case 5: if (t.REGEX_DAY.test(n.substr(-2))) s = `${s}-`; else s = n.substr(0, n.length - 1); break; case 6: a = n.substr(-1); if (a !== "-") { if (t.REGEX_YEAR_INI.test(a)) s = `${n.substr(0, n.length - 1)}-${a}`; else s = `${n.substr(0, n.length - 1)}-` } break; case 7: if (t.REGEX_YEAR_INI.test(n.substr(-1))) s = n; else s = n.substr(0, n.length - 1); break; case 10: const [r, o, l] = s.split("-"); if (!e.CalendarUtils.IsCorrectDate(+o, +r, +l)) s = e.CalendarUtils.CorrectDate(o, r, l, this.format); break }return s } getErasedText(e) { let t; switch (e.length) { case 3: case 6: t = e.substr(0, e.length - 1); break; default: t = e }return t } processSimpleDateInputYMD(t) { const { value: n } = t.target; let s; if (this.keyPressed !== e.Utils.INPUTKEY_NAMES.BACKSPACE) s = this.getDateFormattedValueYMD(n); else s = this.getErasedTextYMD(n); this.updateInputControl(s) } getDateFormattedValueYMD(n, s) { let a = n; let r; switch (n.length) { case 1: a = t.REGEX_YEAR_INI.test(n) ? n : n.substr(0, n.length - 1); break; case 4: a = `${a}-`; break; case 5: r = n.substr(-1); if (r !== "-") { if (t.REGEX_MONTH_INI.test(r)) a = `${n.substr(0, n.length - 1)}-${r}`; else a = `${n.substr(0, n.length - 1)}-` } break; case 6: r = n.substr(-1); if (t.REGEX_MONTH_INI.test(r)) a = n; else a = n.substr(0, n.length - 1); break; case 7: if (t.REGEX_MONTH.test(n.substr(-2))) a = `${a}-`; else a = n.substr(0, n.length - 1); break; case 8: r = n.substr(-1); if (r !== "-") { if (t.REGEX_DAY_INI.test(r)) a = `${n.substr(0, n.length - 1)}-${r}`; else a = `${n.substr(0, n.length - 1)}-` } break; case 9: r = n.substr(-1); if (r !== "-") { if (t.REGEX_DAY_INI.test(r)) a = n; else a = n.substr(0, n.length - 1) } break; case 10: r = n.substr(-1); if (s) { const e = n.substr(-2); if (t.REGEX_DAY.test(e)) a = n; else a = n.substr(0, n.length - 1) } else { if (t.REGEX_DAY.test(n.substr(-2))) a = n; else a = n.substr(0, n.length - 1) } const [o, l, c] = a.split("-"); if (!e.CalendarUtils.IsCorrectDate(+c, +l, +o)) a = e.CalendarUtils.CorrectDate(c, l, o, this.format); break }return a } getErasedTextYMD(e) { let t; switch (e.length) { case 5: case 8: t = e.substr(0, e.length - 1); break; default: t = e }return t } processSimpleDateInputDMY(t) { const { value: n } = t.target; let s; if (this.keyPressed !== e.Utils.INPUTKEY_NAMES.BACKSPACE) s = this.getDateFormattedValueDMY(n); else s = this.getErasedText(n); this.updateInputControl(s) } getDateFormattedValueDMY(n) { let s = n; let a; switch (n.length) { case 1: s = t.REGEX_DAY_INI.test(n) ? n : n.substr(0, n.length - 1); break; case 2: if (t.REGEX_DAY.test(n)) s = `${n}-`; else s = n.substr(0, n.length - 1); break; case 3: a = n.substr(-1); if (a !== "-") { if (t.REGEX_MONTH_INI.test(a)) s = `${n.substr(0, n.length - 1)}-${a}`; else s = `${n.substr(0, n.length - 1)}-` } break; case 4: s = t.REGEX_MONTH_INI.test(n.substr(-1)) ? n : n.substr(0, n.length - 1); break; case 5: if (t.REGEX_MONTH.test(n.substr(-2))) s = `${s}-`; else s = n.substr(0, n.length - 1); break; case 6: a = n.substr(-1); if (a !== "-") { if (t.REGEX_YEAR_INI.test(a)) s = `${n.substr(0, n.length - 1)}-${a}`; else s = `${n.substr(0, n.length - 1)}-` } break; case 7: if (t.REGEX_YEAR_INI.test(n.substr(-1))) s = n; else s = n.substr(0, n.length - 1); break; case 10: const [r, o, l] = s.split("-"); if (!e.CalendarUtils.IsCorrectDate(+r, +o, +l)) s = e.CalendarUtils.CorrectDate(r, o, l, this.format); break }return s } processRangeDateInput(t) { const { value: n } = t.target; let s; let a; let r; switch (this.format) { case e.CalendarUtils.DATE_FORMAT_YMD: s = this.getDateFormattedValueYMD.bind(this); a = this.getErasedTextYMD; r = this.validateInput.bind(this); break; case e.CalendarUtils.DATE_FORMAT_DMY: s = this.getDateFormattedValueDMY.bind(this); a = this.getErasedText; r = this.validateInput.bind(this); break; case e.CalendarUtils.DATE_FORMAT_MDY: s = this.getDateFormattedValueMDY.bind(this); a = this.getErasedText; r = this.validateInput.bind(this); break; default: s = this.getDateFormattedValueYMD.bind(this); a = this.getErasedTextYMD; r = this.validateInput.bind(this); break }r(n, s, a) } validateInput(n, s, a) { let r = n; if (this.keyPressed !== e.Utils.INPUTKEY_NAMES.BACKSPACE) { if (n.length < InputMaskedDate.END_FIRST_DATE) { r = s(n) } else if (n.length === InputMaskedDate.END_FIRST_DATE) { if (this.format === e.CalendarUtils.DATE_FORMAT_YMD) { if (!t.REGEX_DAY.test(n.slice(8, 10))) { r = s(n.slice(0, 9)) } else { r = s(n); r = `${r} to ` } } else { r = s(n); r = `${r} to ` } } else if (n.length === 11) { const t = n.substr(-1); switch (this.format) { case e.CalendarUtils.DATE_FORMAT_YMD: if (t !== "-") { if (t === "0" || +t > 2) r = `${n.substr(0, n.length - 1)} to `; else r = `${n.substr(0, n.length - 1)} to ${t}` } break; case e.CalendarUtils.DATE_FORMAT_DMY: if (t !== "-") { if (+t > 3) r = `${n.substr(0, n.length - 1)} to `; else r = `${n.substr(0, n.length - 1)} to ${t}` } break; case e.CalendarUtils.DATE_FORMAT_MDY: if (t !== "-") { if (+t > 1) r = `${n.substr(0, n.length - 1)} to `; else r = `${n.substr(0, n.length - 1)} to ${t}` } break } } else if (n.length >= 12 && n.length <= 14) { const e = +n.charAt(n.length - 1); if (!isNaN(e)) r = `${n.slice(0, 10)} to ${e}` } else { const e = n.substr(0, InputMaskedDate.INI_SECOND_DATE); const t = n.substr(InputMaskedDate.INI_SECOND_DATE, n.length - 1); r = e + s(t, true) } this.updateInputControl(r) } else { if (n.length <= InputMaskedDate.END_FIRST_DATE) { r = a(n) } else if (n.length === 13) { r = n.slice(0, 10) } else if (n.length === InputMaskedDate.INI_SECOND_DATE) { r = n.substr(0, n.length - InputMaskedDate.COUNT_DATE_RANGE_SEPARATORS) } else { const e = n.substr(0, InputMaskedDate.INI_SECOND_DATE); const t = n.substr(InputMaskedDate.INI_SECOND_DATE, n.length - 1); r = e + a(t) } this.updateInputControl(r) } } processRelativeDateInput(t) { const { value: n } = t.target; const s = n.substr(0, 1); if (this.keyPressed !== e.Utils.INPUTKEY_NAMES.BACKSPACE) { this.maskElement.innerHTML = ""; if (n.length === 1) { if (!/[\+]|[\-]/.test(s)) t.target.value = "" } else if (n.length > 1) { if (!/\d/i.test(n)) t.target.value = n.substr(0, n.length - 1); else this.updateInputControl(n) } } else { if (n === "") this.maskElement.innerHTML = this.getMask(n, e.EDateRangeType.Relative) } } getMaskedText(t) { const n = t.length; const s = Array(n).fill("&nbsp;").join(""); if (this.type === e.EDateRangeType.Relative) { if (n >= 2) return ""; else return `${s}${this.mask.slice(n)}` } else { return `${s}${this.mask.slice(n)}` } } } InputMaskedDate.END_FIRST_DATE = 10; InputMaskedDate.INI_SECOND_DATE = 14; InputMaskedDate.COUNT_DATE_RANGE_SEPARATORS = 4; e.InputMaskedDate = InputMaskedDate })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { const t = "has-mask-time"; class InputMaskedTime { constructor(e, t, n = (e => { })) { this.input = e; this.maskElement = t; this.mask = "HH:MM"; this.onChange = n; this.initInputEvents() } SetValue(e) { let t = e || ""; this.updateInputControl(t) } updateInputControl(e) { this.input.value = e; this.maskElement.innerHTML = this.getMaskedText(e); if (e.length === 5) this.onChange(this.getBackendTimeFormat(e)) } getBackendTimeFormat(e) { return `T${e}` } initInputEvents() { if (!this.input.hasAttribute(t)) { this.input.addEventListener("keydown", (e => this.processKeyDown(e))); this.input.addEventListener("input", (e => this.processTimeInput(e))) } this.input.maxLength = this.mask.length; this.maskElement.innerHTML = this.mask } processKeyDown(t) { this.keyPressed = t.key; if (this.keyPressed !== e.Utils.INPUTKEY_NAMES.BACKSPACE) { if (isNaN(+this.keyPressed) || this.keyPressed === e.Utils.INPUTKEY_NAMES.SPACE) { t.preventDefault(); t.stopPropagation(); return } } } processTimeInput(e) { const { value: t } = e.target; let n; let s; if (this.keyPressed !== "Backspace") { n = this.getTimeFormattedValue(t); s = this.getMaskedText(n) } else { n = this.getErasedText(t); s = this.getMaskedText(n) } e.target.value = n; this.maskElement.innerHTML = s; this.updateInputControl(n) } getTimeFormattedValue(e) { let t = e; let n; switch (e.length) { case 1: t = /[0-2]/i.test(e) ? e : e.substr(0, e.length - 1); break; case 2: if (/[2][0-3]|[0-1][0-9]/i.test(e)) t = `${e}:`; else t = e.substr(0, e.length - 1); break; case 3: n = e.substr(-1); if (n !== ":") { if (/[0-5]/i.test(n)) t = `${e.substr(0, e.length - 1)}:${n}`; else t = `${e.substr(0, e.length - 1)}:` } break; case 4: t = /[0-5]/i.test(e.substr(-1)) ? e : e.substr(0, e.length - 1); break; case 5: if (/[0-5]\d/i.test(e.substr(-2))) t = t; else t = e.substr(0, e.length - 1); break }return t } getErasedText(e) { let t; switch (e.length) { case 3: t = e.substr(0, e.length - 1); break; default: t = e }return t } getMaskedText(e) { const t = e.length; const n = Array(t).fill("&nbsp;").join(""); return `${n}${this.mask.substr(t)}` } } e.InputMaskedTime = InputMaskedTime })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class SliderControl { constructor(t, n, s, a, r, o, l, c, d, h, u) { this.id = t; this.parent = n; this.widthControlContainer = s; this.min = a; this.max = r; this.value = o; this.step = l; this.Percent = 0; this.Units = c; this.CallbackSlide = d; this.WithLabels = h; this.NumberDivisionForLabels = u; this.sliderColor = e.Colors.Carrot; this.sliderBackgroundColor = e.Colors.PeterRiver; let f = document.querySelector(":root"); f.style.setProperty("--slider-Color", `${this.sliderColor}`); f.style.setProperty("--slider-BackgroundColor", `${this.sliderBackgroundColor}`); f.style.setProperty("--slider-Size", `18px`); f.style.setProperty("--slider-Position", `-8px`) } SetColor(e) { this.sliderColor = e; let t = document.querySelector(":root"); t.style.setProperty("--slider-Color", `${this.sliderColor}`) } SetBackgroundColor(e) { this.sliderBackgroundColor = e; let t = document.querySelector(":root"); t.style.setProperty("--slider-BackgroundColor", `${this.sliderBackgroundColor}`) } SetSliderSize(e) { let t = document.querySelector(":root"); t.style.setProperty("--slider-Size", `${e}px`) } SetSliderPosition(e) { let t = document.querySelector(":root"); t.style.setProperty("--slider-Position", `${e}px`) } SetStylesContainerGlobal(e) { if (e) { for (const t in e) { if (Object.prototype.hasOwnProperty.call(e, t)) { const n = e[t]; this.Container.style[t] = n } } } } SetStylesLabelSection(e) { if (e) { for (const t in e) { if (Object.prototype.hasOwnProperty.call(e, t)) { const n = e[t]; this.labelsSections.style[t] = n } } } } GetContainerSlider() { return this.leftSection } BuildUI() { this.Container = document.createElement("div"); this.ContainerControl = document.createElement("div"); e.DOMUtils.AddClass(this.Container, "ContainerSliderGlobal"); e.DOMUtils.AddClass(this.ContainerControl, "ContainerSliderControl"); this.leftSection = document.createElement("div"); e.DOMUtils.AddClass(this.leftSection, "ContainerSliderLeftSide"); this.leftSection.style.width = this.widthControlContainer + "px"; this.rightSection = document.createElement("div"); e.DOMUtils.AddClass(this.rightSection, "ContainerSliderRightSide"); this.rightSection.innerHTML = this.value.toString() + " " + this.Units; this.ContainerControl.appendChild(this.leftSection); this.ContainerControl.appendChild(this.rightSection); this.Element = document.createElement("input"); this.Element.type = "range"; this.Element.min = this.min.toString(); this.Element.max = this.max.toString(); this.Element.step = this.step.toString(); this.Element.value = this.value.toString(); this.Element.oninput = e => { this.Percent = (+e.target.value - this.min) / (this.max - this.min) * 100; this.rightSection.innerHTML = e.target.value + " " + this.Units; this.CallbackSlide(parseInt(e.target.value)) }; this.leftSection.appendChild(this.Element); if (this.WithLabels) { this.numberAcumForLabels = Math.round((this.max - this.min) / this.NumberDivisionForLabels); this.labelsSections = document.createElement("div"); this.labelsSections.style.gridTemplateColumns = `repeat(${this.NumberDivisionForLabels}, 1fr)`; let t = document.querySelector(":root"); t.style.setProperty("--init-text", `"${this.min.toString()}"`); e.DOMUtils.AddClass(this.labelsSections, "labelsSection"); let n = this.min; for (let e = 0; e < this.NumberDivisionForLabels; e++) { let e = document.createElement("div"); n += this.numberAcumForLabels; n = Math.min(n, this.max); e.innerHTML = n.toString(); this.labelsSections.appendChild(e) } this.leftSection.appendChild(this.labelsSections) } this.Container.appendChild(this.ContainerControl); this.parent.appendChild(this.Container) } } e.SliderControl = SliderControl })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class Tab { constructor(e, t, n, s) { this.Exclude = false; this.Id = e; this.Name = t; this.ToolTipString = n; this.Styles = s } ActiveTab() { if (this.Element !== null) { e.DOMUtils.RemoveClass(this.Element, "tab"); e.DOMUtils.AddClass(this.Element, "tabActive") } } } e.Tab = Tab })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class TabController { constructor() { } BuildTabs(t) { this.BarTabs.innerHTML = ""; if (this.Tabs.length > 0) { e: for (var n = 0; n < this.Tabs.length; n++) { if (t !== null && t !== undefined) { for (var s = 0; s < t.length; s++) { if (t[s].toLowerCase() === this.Tabs[n].Id.toLowerCase()) { this.Tabs[n].Exclude = true; continue e } } } var a = document.createElement("div"); a.innerHTML = this.Tabs[n].Name; a.setAttribute("data-tabid", this.Tabs[n].Id); e.DOMUtils.AddClass(a, "tab"); if (this.Tabs[n].Styles) { for (const e in this.Tabs[n].Styles) { if (Object.prototype.hasOwnProperty.call(this.Tabs[n].Styles, e)) { const t = this.Tabs[n].Styles[e]; a.style[e] = t } } } if (this.Tabs[n].ToolTipString) { a.setAttribute("data-tooltip", this.Tabs[n].ToolTipString); a.setAttribute("data-position", "center top"); var r = new e.Tooltip(a, new e.ToolTipOptions(0, 2)) } this.Tabs[n].Element = a; var o = new Hammer(a); o.on("tap", (t => { this.RemoveActiveTabs(); e.DOMUtils.RemoveClass(t.target, "tab"); e.DOMUtils.AddClass(t.target, "tabActive"); this.IdDefault = t.target.getAttribute("data-tabid"); var n = this.GetTabforId(this.IdDefault); this.OpenTab(n) })); this.BarTabs.appendChild(a) } } } RemoveActiveTabs() { for (var t = 0; t < this.Tabs.length; t++) { if (!this.Tabs[t].Exclude) { if (!e.DOMUtils.HasClass(this.Tabs[t].Element, "tab")) e.DOMUtils.AddClass(this.Tabs[t].Element, "tab"); e.DOMUtils.RemoveClass(this.Tabs[t].Element, "tabActive") } } } GetTabforId(e) { for (var t = 0; t < this.Tabs.length; t++) { if (this.Tabs[t].Id === e) return this.Tabs[t] } } } e.TabController = TabController })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class TimelineControl { constructor(e) { this.diameter = 7; this.minSeparation = 22; this.textLength = 40; this.container = e; this.parent = e.parentNode; this.lineLength = this.parent.clientWidth - this.textLength - this.minSeparation } LoadData(e, t, n) { try { this.lineLength = this.parent.clientWidth - this.textLength - this.minSeparation; this.dateField = t; this.colorField = n; this.data = e.sort(((e, n) => e[t] < n[t] ? -1 : e[t] > n[t] ? 1 : 0)); this.lapses = []; var s = 0; for (var a = 0; a < this.data.length - 1; a++) { var r = this.data[a + 1][t] - this.data[a][t]; this.lapses.push(r); s += r } var o = 0; var l = this.lineLength; for (var c = 0; c < this.lapses.length; c++) { var d = this.lapses[c] / s * this.lineLength; if (d <= this.minSeparation) { this.lapses[c] = this.minSeparation + 1; l -= this.minSeparation + 1 } else { this.lapses[c] = d; o += d } } if (o === 0 || l < this.minSeparation) { var h = this.lineLength / this.lapses.length; for (var u = 0; u < this.lapses.length; u++)this.lapses[u] = h } else { for (var f = 0; f < this.lapses.length; f++) { if (this.lapses[f] > this.minSeparation) this.lapses[f] = this.lapses[f] / o * l } } this.validData = true } catch (e) { this.validData = false } } Render() { if (!this.validData) return; var t = this.container.getContext("2d"); this.setHiDPICanvas(this.container, t, this.parent.clientWidth, this.parent.clientHeight); t.clearRect(0, 0, this.container.width, this.container.height); t.lineWidth = 1; t.strokeStyle = e.Colors.Clouds; var n = this.minSeparation * .5; var s = this.textLength + this.minSeparation; t.moveTo(0, s); t.lineTo(this.minSeparation + this.lineLength, s); t.stroke(); for (var a = 0; a < this.data.length; a++) { if (a > 0) n += this.lapses[a - 1]; var r = this.data[a][this.dateField]; var o = r.toJSON().substr(0, 10); t.beginPath(); t.arc(n, s, this.diameter / 2, 0, 2 * Math.PI, false); t.stroke(); var l = this.data[a][this.colorField]; if (l && l.toString().length > 0) t.fillStyle = l; else t.fillStyle = e.Colors.FullBlack; t.fill(); t.font = "9px Arial"; t.textAlign = "left"; t.fillStyle = e.Colors.Clouds; t.save(); t.translate(n, s); t.rotate(-Math.PI / 4); t.fillText(o, this.diameter, 0); t.restore() } } getPixelRatio(e) { var t = window.devicePixelRatio || 1; var n = e.webkitBackingStorePixelRatio || e.mozBackingStorePixelRatio || e.msBackingStorePixelRatio || e.oBackingStorePixelRatio || e.backingStorePixelRatio || 1; return t / n } setHiDPICanvas(e, t, n, s) { if (!this.dpiRatio) this.dpiRatio = this.getPixelRatio(t); e.width = n * this.dpiRatio; e.height = s * this.dpiRatio; e.style.width = n + "px"; e.style.height = s + "px"; t.setTransform(this.dpiRatio, 0, 0, this.dpiRatio, 0, 0) } } e.TimelineControl = TimelineControl })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e["ButtonA"] = "buttonA"; e["ButtonB"] = "buttonB" })(t = e.ETypeToggleButton || (e.ETypeToggleButton = {})); class ToggleButton { constructor(e, t, n, s, a, r) { this.parent = e; this.styleButton = t; this.textActive = n; this.textInactive = s; this.checkValue = a; this.eventAction = r } Create() { this.Element = e.DOMUtils.div({ className: "toggleButton", children: [e.DOMUtils.div({ className: `button r ${this.styleButton}`, children: [this.checkControl = e.DOMUtils.input({ type: "checkbox", checked: !this.checkValue, className: "checkbox", onchange: e => { if (this.eventAction) { this.eventAction(!e.target.checked) } } }), e.DOMUtils.div({ attr: { "data-on": this.textActive, "data-off": this.textInactive }, className: "knobs" }), e.DOMUtils.div({ className: "layer" })] })] }); this.parent.appendChild(this.Element) } GetStatus() { let e = !this.checkControl.checked; return e } SetStatus(e) { this.checkControl.checked = !e; if (this.eventAction) { this.eventAction(e) } } } e.ToggleButton = ToggleButton })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { const { div: t, button: n } = e.DOMUtils; class ValuesUD { constructor(e, t) { this.Value = e; this.Text = t } } e.ValuesUD = ValuesUD; class UpDownControl { constructor(e, n, s, a = false, r = 1, o) { this.InputElement = e; this.Items = n; this.DefaulItem = o; this.Parent = s; this.IsRange = a; this.Inc = r; this.IsCyclic = false; this.Element = t({ className: "UpDown" }); this.Parent.appendChild(this.Element) } Create() { if (this.IsRange && this.Items.length === 2) { var e = parseFloat(this.Items[0].Value); var t = parseFloat(this.Items[1].Value); this.Items = new Array; var n = 0; for (var s = e; s <= t; s += this.Inc) { this.Items.push(new ValuesUD(s.toFixed(n).toString(), s.toFixed(n).toString())) } } this.Index = Math.floor(this.Items.length / 2); const a = document.getElementById(this.InputElement) || null; var r = this.Item = this.DefaulItem || this.Items[this.Index]; if (a !== null) { a.value = r.Text; a.title = r.Text } this.Element.appendChild(this.createUpDownElement(false, this.DecreaseEv)); this.Element.appendChild(this.createUpDownElement(true, this.IncreaseEv)) } createUpDownElement(e, t) { const s = n({ type: "button", innerText: e ? "+" : "-" }); var ControlEvent = () => { if (this.Items.length > 0) { let s = true; this.Index += e ? 1 : -1; if (this.Index < 0) { if (this.IsCyclic) { this.Index = this.Items.length - 1 } else { this.Index = 0; s = false } } if (this.Index >= this.Items.length) { if (this.IsCyclic) { this.Index = 0 } else { this.Index = this.Items.length - 1; s = false } } this.Item = this.Items[this.Index]; var n = document.getElementById(this.InputElement) || null; if (n !== null) { n.value = this.Item.Text; n.title = this.Item.Text } if (s) t(this.Element, this.Item, this) } }; s.onmousedown = t => { this.isPressed = true; ControlEvent(); var n = this; setTimeout((() => { var t = setInterval((() => { try { if (n.isPressed) { if (n.Index <= n.Items.length - 1 && e || !e) { ControlEvent() } } } catch (e) { } finally { if (!n.isPressed) clearInterval(t) } }), 100) }), 300) }; s.onmouseleave = e => { this.isPressed = false }; s.onmouseup = e => { this.isPressed = false }; return s } } e.UpDownControl = UpDownControl })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["LEFT"] = 1] = "LEFT"; e[e["RIGHT"] = 2] = "RIGHT"; e[e["CENTER"] = 3] = "CENTER"; e[e["STRETCH"] = 4] = "STRETCH" })(t = e.PanelHorizontalAlignment || (e.PanelHorizontalAlignment = {})); let n; (function (e) { e[e["HORIZONTAL"] = 1] = "HORIZONTAL"; e[e["VERTICAL"] = 2] = "VERTICAL" })(n = e.PanelOrientation || (e.PanelOrientation = {})); let s; (function (e) { e["PANEL"] = "panel"; e["HORIZONTAL"] = "horizontal"; e["VERTICAL"] = "vertical" })(s = e.PanelUtilClassnames || (e.PanelUtilClassnames = {})); e.PanelHorizontalAlignmentClasses = { [t.LEFT]: "panelHorizontalAlignLeft", [t.RIGHT]: "panelHorizontalAlignRight", [t.CENTER]: "panelHorizontalAlignCenter", [t.STRETCH]: "panelHorizontalAlignStretch" }; let a; (function (e) { e[e["TOP"] = 1] = "TOP"; e[e["BOTTOM"] = 2] = "BOTTOM"; e[e["CENTER"] = 3] = "CENTER"; e[e["STRETCH"] = 4] = "STRETCH" })(a = e.PanelVerticalAlignment || (e.PanelVerticalAlignment = {})); e.PanelVerticalAlignmentClasses = { [a.TOP]: "panelVerticalAlignTop", [a.BOTTOM]: "panelVerticalAlignBottom", [a.CENTER]: "panelVerticalAlignCenter", [a.STRETCH]: "panelVerticalAlignStretch" }; e.PanelOrientationClassnames = { [n.HORIZONTAL]: s.HORIZONTAL, [n.VERTICAL]: s.VERTICAL }; class Panel { constructor(e, t) { this.config = e; this.children = []; if (this.config.domElement) this.domElement = this.config.domElement; else this.domElement = document.createElement("div"); if (t) this.Add(t); this.initClasses(); this.initStyles(); if (this.config.parentElement) this.render() } SetChildren(e) { this.children = []; this.Add(e) } Add(e) { var t, n; if (e) { if (Array.isArray(e)) { this.children = (t = this.children) === null || t === void 0 ? void 0 : t.concat(e); e.forEach((e => { e.SetParentElement(this.domElement); this.domElement.appendChild(e.GetDOMElement()) })) } else if (e instanceof Panel) { e.SetParentElement(this.domElement); (n = this.children) === null || n === void 0 ? void 0 : n.push(e); this.domElement.appendChild(e.GetDOMElement()) } } } Children() { return this.children } SetParentElement(e) { this.config.parentElement = e } IsVisible() { return this.config.visible } SetVisible(e) { this.config.visible = e; this.domElement.style.display = e ? "" : "none" } AddClass(e) { this.domElement.classList.add(e) } GetDOMElement() { return this.domElement } GetPosition() { var e; return (e = this.config) === null || e === void 0 ? void 0 : e.position } SetPosition(e) { this.config.position = e } GetOrientation() { var e; return (e = this.config) === null || e === void 0 ? void 0 : e.orientation } SetOrientation(e) { this.config.orientation = e } GetColumns() { var e; return (e = this.config) === null || e === void 0 ? void 0 : e.cols } SetColumns(e) { this.config.cols = e } GetRows() { var e; return (e = this.config) === null || e === void 0 ? void 0 : e.rows } SetRows(e) { this.config.rows = e } Log() { console.log(this.config) } initClasses() { if (this.config.className) this.domElement.className = this.config.className; this.domElement.classList.add(s.PANEL); if (this.config.horizontalAlignment) { const t = e.PanelHorizontalAlignmentClasses[this.config.horizontalAlignment]; if (t) this.domElement.classList.add(t) } if (this.config.verticalAlignment) { const t = e.PanelVerticalAlignmentClasses[this.config.verticalAlignment]; if (t) this.domElement.classList.add(t) } } initStyles() { const { width: e, height: t } = this.config; this.setNumericOrPercentStyle("width", e); this.setNumericOrPercentStyle("height", t); this.config.visible = true; if (this.config.style) { Object.keys(this.config.style).forEach((e => { if (e in this.domElement.style) this.domElement.style[e] = this.config.style[e] })) } } setNumericOrPercentStyle(e, t) { if (typeof t === "number") this.domElement.style[e] = `${t}px`; else this.domElement.style[e] = t } render() { if (this.config.parentElement) { this.config.parentElement.appendChild(this.domElement); this.domElement.innerHTML = ""; if (this.children) { this.children.forEach((e => { const { domElement: t } = e; this.domElement.appendChild(t) })) } } else { throw new Error("The panel has no parent element") } } } e.Panel = Panel })(t = e.LayoutManager || (e.LayoutManager = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["TOP"] = 1] = "TOP"; e[e["LEFT"] = 2] = "LEFT"; e[e["BOTTOM"] = 3] = "BOTTOM"; e[e["RIGHT"] = 4] = "RIGHT" })(t = e.DockPanelPosition || (e.DockPanelPosition = {})); e.DockPanelPositionClassnames = { [t.TOP]: "top", [t.LEFT]: "left", [t.BOTTOM]: "bottom", [t.RIGHT]: "right" }; let n; (function (e) { e["DOCKPANEL"] = "dockpanel"; e["REMAIN"] = "remain"; e["FLEXROW"] = "flexrow"; e["FLEXCOLUMN"] = "flexcolumn" })(n = e.DockPanelUtilClassnames || (e.DockPanelUtilClassnames = {})); class DockPanel extends e.Panel { constructor(e) { const t = Object.assign(Object.assign({}, e), { className: n.DOCKPANEL }); super(t); this.lastPanelAdded = false } AddChild(n, s = t.TOP) { n.SetPosition(s); n.AddClass(e.DockPanelPositionClassnames[s]); if (this.remainingPanel) this.addChildToPanel(this.remainingPanel, n, s); else this.addChildToPanel(this, n, s) } AddLast(e) { if (!this.lastPanelAdded) { if (!this.remainingPanel) this.remainingPanel = this.createRemainingPanel(); this.remainingPanel.Add(e); this.lastPanelAdded = true } else { throw new Error("Cannot add more chilren because last panel was added.") } } AddChildren(e) { super.Add(e) } SwapChildren() { if (this.Children().length !== 2) return; const [t, s] = this.Children(); const a = t.GetDOMElement(); const r = s.GetDOMElement(); if (a.classList.contains(n.REMAIN)) { const t = s.GetPosition(); const n = DockPanel.GetOppositePosition(t); if (r.classList.contains(e.DockPanelPositionClassnames[t])) { r.classList.remove(e.DockPanelPositionClassnames[t]); r.classList.add(e.DockPanelPositionClassnames[n]) } } else { const n = t.GetPosition(); const s = DockPanel.GetOppositePosition(n); if (a.classList.contains(e.DockPanelPositionClassnames[n])) { a.classList.remove(e.DockPanelPositionClassnames[n]); a.classList.add(e.DockPanelPositionClassnames[s]) } } r.parentNode.insertBefore(r, a); this.SetChildren([s, t]) } createRemainingPanel() { const t = document.createElement("div"); return new e.Panel({ domElement: t, className: n.REMAIN }) } addChildToPanel(e, s, a) { if ([t.LEFT, t.RIGHT].includes(a)) e.AddClass(n.FLEXROW); else e.AddClass(n.FLEXCOLUMN); const r = this.createRemainingPanel(); if ([t.BOTTOM, t.RIGHT].includes(a)) { e.Add(r); e.Add(s) } else { e.Add(s); e.Add(r) } this.remainingPanel = r } static GetOppositePosition(e) { switch (e) { case t.TOP: return t.BOTTOM; case t.BOTTOM: return t.TOP; case t.LEFT: return t.RIGHT; case t.RIGHT: return t.LEFT } } } e.DockPanel = DockPanel })(t = e.LayoutManager || (e.LayoutManager = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e["FLOWPANEL"] = "flowpanel" })(t = e.FlowPanelUtilClassnames || (e.FlowPanelUtilClassnames = {})); class FlowPanel extends e.Panel { constructor(e) { if (e.orientation) { const n = Object.assign(Object.assign({}, e), { className: t.FLOWPANEL }); super(n); this.orientation = e.orientation; this.addOrientationPanel() } else { throw new Error("Orientation is mandatory property for StackPanel") } } AddChild(e) { e.SetOrientation(this.orientation); this.orientationPanel.Add(e) } AddChildren(t) { if (t) { if (Array.isArray(t)) { t.forEach((e => { e.SetOrientation(this.orientation) })) } else if (t instanceof e.Panel) { t.SetOrientation(this.orientation) } super.Add(t) } } addOrientationPanel() { const t = document.createElement("div"); t.classList.add(e.PanelOrientationClassnames[this.orientation]); const n = new e.Panel({ domElement: t, parentElement: this.domElement }); this.orientationPanel = n; this.Add(this.orientationPanel) } } e.FlowPanel = FlowPanel })(t = e.LayoutManager || (e.LayoutManager = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e["GRIDPANEL"] = "gridpanel" })(t = e.GridPanelUtilClassnames || (e.GridPanelUtilClassnames = {})); class GridPanel extends e.Panel { constructor(e) { if (e.rows && e.cols) { const { rows: n, cols: s, gap: a = 0 } = e; const r = Object.assign(Object.assign({}, e), { className: t.GRIDPANEL, style: { gridTemplateRows: `repeat(${n}, 1fr)`, gridTemplateColumns: `repeat(${s}, 1fr)`, gridGap: `${a}px` } }); super(r) } else { throw new Error("Cols and rows are mandatory properties for GridPanel") } } AddChild(e) { super.Add(e) } AddChildren(e) { super.Add(e) } AddChildAt(e, t) { return } RemoveChildAt(e, t) { return } } e.GridPanel = GridPanel })(t = e.LayoutManager || (e.LayoutManager = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e["DOCK"] = "dock"; e["GRID"] = "grid"; e["FLOW"] = "flow"; e["STACK"] = "stack"; e["RELATIVE"] = "relative"; e["MOVABLE"] = "movable" })(t = e.LayoutType || (e.LayoutType = {})); class LayoutManager { constructor(t) { this.root = new e.Panel({ width: "100%", height: "100%", parentElement: t }); this.addedPanels = [] } SetLayout(n, s) { this.layoutType = n; s = s || {}; switch (n) { case t.DOCK: const n = new e.DockPanel(s); this.root.Add(n); break; case t.GRID: const a = new e.GridPanel(s); this.root.Add(a); break; case t.FLOW: const r = new e.FlowPanel(s); this.root.Add(r); break; case t.STACK: const o = new e.StackPanel(s); this.root.Add(o); case t.MOVABLE: const l = new e.MovablePanel(s); this.root.Add(l); break; case t.RELATIVE: return; default: return } } Add(e, n) { let s; switch (this.layoutType) { case t.DOCK: if (n) { s = this.GetLayoutPanel(); s.AddChild(e, n); this.addedPanels.push(e) } else { throw new Error("Dock layout needs specify the position") } break; case t.GRID: s = this.GetLayoutPanel(); s.AddChild(e); this.addedPanels.push(e); break; case t.FLOW: s = this.GetLayoutPanel(); s.AddChild(e); this.addedPanels.push(e); break; case t.STACK: s = this.GetLayoutPanel(); s.AddChild(e); this.addedPanels.push(e); break; case t.MOVABLE: s = this.GetLayoutPanel(); s.AddChild(e); this.addedPanels.push(e); case t.RELATIVE: return; default: return } } AddLast(e) { if (this.layoutType === t.DOCK) { const t = this.GetLayoutPanel(); t.AddLast(e) } else { throw new Error(`Call AddLast method only when the layout is ${t.DOCK}`) } } GetRoot() { return this.root } GetPanelAt(e) { if (e >= 0 && e < this.addedPanels.length) return this.addedPanels[e]; return null } GetLayoutPanel() { return this.root.Children()[0] } GetLayout() { return this.layoutType } } e.LayoutManager = LayoutManager })(t = e.LayoutManager || (e.LayoutManager = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e["MOVABLEPANEL"] = "movablepanel"; e["ROW"] = "row"; e["COLUMN"] = "column"; e["REVERSE_ROW"] = "row-reverse"; e["REVERSE_COLUMN"] = "column-reverse" })(t = e.MovablePanelUtilClassNames || (e.MovablePanelUtilClassNames = {})); let n; (function (e) { e[e["TOP"] = 1] = "TOP"; e[e["LEFT"] = 2] = "LEFT"; e[e["BOTTOM"] = 3] = "BOTTOM"; e[e["RIGHT"] = 4] = "RIGHT" })(n = e.MovablePanelDirection || (e.MovablePanelDirection = {})); class MovablePanel extends e.Panel { constructor(e) { const s = Object.assign(Object.assign({}, e), { className: t.MOVABLEPANEL, direction: e.direction || n.LEFT, minWidthChild: e.minWidthChild || 150, minHeightChild: e.minHeightChild || 150 }); super(s); this.direction = s.direction; this.countChilds = 0; this.setOrientationClass() } SetDirection(e) { this.direction = e; this.config.direction = e; this.setOrientationClass() } GetDirection() { return this.direction } Move(e) { this.SetDirection(e); this.setChildDimensions() } AddChild(e) { if (this.countChilds < 2) { super.Add(e); this.countChilds++; if (this.countChilds === 2) this.setChildDimensions() } else { throw new Error("Cannot add more than two children in MovablePanel") } } GetOrientation() { if ([n.LEFT, n.RIGHT].includes(this.direction)) return e.PanelOrientation.HORIZONTAL; else return e.PanelOrientation.VERTICAL } setOrientationClass() { this.clearClassList(); switch (this.direction) { case n.LEFT: this.domElement.classList.add(t.ROW); break; case n.RIGHT: this.domElement.classList.add(t.REVERSE_ROW); break; case n.TOP: this.domElement.classList.add(t.COLUMN); break; case n.BOTTOM: this.domElement.classList.add(t.REVERSE_COLUMN); break; default: this.domElement.classList.add(t.ROW); break } } setChildDimensions() { const [e, t] = this.Children(); switch (this.direction) { case n.LEFT: case n.RIGHT: if (e) { const t = e.GetDOMElement(); if (!this.config.isResponsive) { t.style.width = `${this.config.minWidthChild}px`; t.style.removeProperty("height") } } break; case n.TOP: case n.BOTTOM: if (e) { const t = e.GetDOMElement(); if (!this.config.isResponsive) { t.style.height = `${this.config.minWidthChild}px`; t.style.removeProperty("width") } } break; default: return }if (t) t.GetDOMElement().style.flexGrow = "1" } clearClassList() { const e = this;[t.ROW, t.COLUMN, t.REVERSE_ROW, t.REVERSE_COLUMN].forEach((t => { if (e.domElement.classList.contains(t)) e.domElement.classList.remove(t) })) } } e.MovablePanel = MovablePanel })(t = e.LayoutManager || (e.LayoutManager = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["TOP"] = 1] = "TOP"; e[e["LEFT"] = 2] = "LEFT"; e[e["BOTTOM"] = 3] = "BOTTOM"; e[e["RIGHT"] = 4] = "RIGHT" })(t = e.RelativePanelPosition || (e.RelativePanelPosition = {})); let n; (function (e) { e[e["NORMAL"] = 0] = "NORMAL"; e[e["STRETCH"] = 1] = "STRETCH" })(n = e.RelativePanelFill || (e.RelativePanelFill = {})); let s; (function (e) { e["RELATIVEPANEL"] = "relativepanel" })(s = e.RelativePanelUtilClassnames || (e.RelativePanelUtilClassnames = {})); class RelativePanel extends e.Panel { constructor(e) { const t = Object.assign(Object.assign({}, e), { className: s.RELATIVEPANEL }); super(t); this.numPanels = 0 } AddChild(e, t) { e.SetPosition(t); e.AddClass("relativepanel"); e.SetVisible(this.numPanels === 0); this.numPanels++ } SetVisiblePanel(e) { const t = this.Children(); if (typeof e === "number") { if (e >= 0 && e < t.length) { for (let n = 0; n < t.length; n++) { t[n].SetVisible(n === e) } } else { throw new Error("Invalid index panel") } } else { for (let n = 0; n < t.length; n++) { if (t[n] === e) t[n].SetVisible(true) } } } } e.RelativePanel = RelativePanel })(t = e.LayoutManager || (e.LayoutManager = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e["STACKPANEL"] = "stackpanel" })(t = e.StackPanelUtilClassnames || (e.StackPanelUtilClassnames = {})); class StackPanel extends e.Panel { constructor(e) { if (e.orientation) { const n = Object.assign(Object.assign({}, e), { className: t.STACKPANEL }); super(n); this.orientation = e.orientation; this.addOrientationPanel() } else { throw new Error("Orientation is mandatory property for StackPanel") } } AddChild(e) { e.SetOrientation(this.orientation); this.orientationPanel.Add(e) } AddChildren(e) { this.orientationPanel.Add(e) } addOrientationPanel() { const t = document.createElement("div"); t.classList.add(e.PanelOrientationClassnames[this.orientation]); const n = new e.Panel({ domElement: t, parentElement: this.domElement }); this.orientationPanel = n; this.Add(this.orientationPanel) } } e.StackPanel = StackPanel })(t = e.LayoutManager || (e.LayoutManager = {})) })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class ToolbarItemGroup { constructor(e, t) { this.Buttons = e; this.GroupName = t } Create(e, t) { this.Parent = e; this.Element = document.createElement("div"); this.Element.setAttribute("data-groupname", this.GroupName); this.Element.style.verticalAlign = "top"; WebClient.DOMUtils.AddClass(this.Element, "toolbarGroup"); for (var n = 0; n < this.Buttons.length; n++)this.Buttons[n].Create(this.Element); var s = this.Parent.getElementsByClassName("moreButton")[0]; if (t) { this.Parent.insertBefore(this.Element, t) } else { if (s !== undefined) this.Parent.insertBefore(this.Element, s); else this.Parent.appendChild(this.Element) } } AddItem(e) { this.Buttons.push(e); this.Buttons[this.Buttons.length - 1].Create(this.Element); this.Element.appendChild(e.Element) } GetFromButtonLeft(e) { var t = 0; for (var n = 0; n < e; n++)t += this.Buttons[n].Element.clientWidth; return t } ShowMoreControls() { var e = this.Element.getAttribute("data-indexButtonRange"); var t = e.split("-"); var n = parseInt(t[0]); var s = parseInt(t[1]); var a = this.Buttons.length - 1; var r = 0; var o = 0; var l = 0; o = s - n; n = s + 1; if (n >= a) n = 0; s = n + o; if (s > a) s = a; if (n === 0) l = 0; else l = this.GetFromButtonLeft(n); this.Buttons[0].Element.style.marginLeft = "-" + l + "px"; this.Element.setAttribute("data-indexButtonRange", n + "-" + s) } } WebClient.ToolbarItemGroup = ToolbarItemGroup; class Toolbar { constructor(e) { this.Groups = []; if (e instanceof WebClient.LanguageManager) { this.platform = null; this.language = e } else if (e) { this.platform = e; this.language = e.LanguageManager } } Create(parent, showDefaultButtons = true, groupName = "unnamed.1") { this.Parent = parent; this.Element = document.createElement("div"); WebClient.DOMUtils.AddClass(this.Element, "mainToolbar toolbar"); for (var i = 0; i < this.Groups.length; i++) { this.Groups[i].Create(this.Element) } this.Parent.appendChild(this.Element); this.createMoreButton(); if (showDefaultButtons && !this.platform.ApplicationTags.hasOwnProperty("dummyPatient")) { var homeButton = [["home", WebClient.ResourceBag.Icons8Home32Png, ev => { var Platform = eval("platform"); Platform.SwitchView("", "home") }]]; var backButton = [["back", WebClient.ResourceBag.Icons8Undo32Png, ev => { var Platform = eval("platform"); let optionalParameters; const viewName = WebClient.HttpUtils.GetUrlParameter("view"); if (viewName === "viewStudy" || viewName === "viewDeletedStudy") { optionalParameters = [{ lastResourceId: WebClient.HttpUtils.GetUrlParameter("Study") }] } Platform.SwitchView(this.platform.BrowsingHistory[this.platform.BrowsingHistory.length - 1], "back", optionalParameters) }]]; var mainGroup = this.CreateButtonsAndMenus([homeButton, backButton], "Efferent.PlatformClient", "main.1", "main"); this.Groups.push(mainGroup); mainGroup.Create(this.Element) } else { var emptyGroup = this.CreateButtonsAndMenus([], "Efferent.PlatformClient", groupName, "main"); this.Groups.push(emptyGroup); emptyGroup.Create(this.Element) } this.OnWindowResize(document.documentElement.clientWidth, document.documentElement.clientHeight); this.Topbar = new WebClient.TopBar(this.Parent.parentElement); this.Topbar.Hide() } OnWindowResize(e, t) { if (this.Groups.length > 0 && this.Groups[0].Element) { this.Groups[0].Element.style.marginLeft = "0" } for (var n = 0; n < this.Groups.length; n++) { var s = this.Groups[n]; var a = s.Buttons; for (var r = 0; r < a.length; r++) { var o = a[r]; if (o.Type === WebClient.EToolbarButtonType.DropDown && o.Child !== null && o.Child.Element) { var l = o.Child.Element; if (WebClient.DOMUtils.IsDisplay(l)) { var c = parseFloat(l.style.left); var d = l.clientWidth; var h = c + d; var u = e - h; var f; if (u < 0) f = o.Element.offsetLeft + u + "px"; else f = o.Element.offsetLeft + "px"; var p = { display: "inline-flex", left: f + "px" }; Toolbar.SetToolbarMenuClasses(l, p) } } } } if (["iPad", "iPhone", "iPod"].includes(navigator.platform)) { const e = setTimeout((() => { this.ManageButtonMore(); clearTimeout(e) }), 400) } else { this.ManageButtonMore() } } CreateTopViewButtons(e) { var t = this.platform.CurrentSpec.Functions[0]["Views"]; var n = []; for (var s in t) { if (t.hasOwnProperty(s)) { var a = t[s]; if (a.IsTop) { var action = () => { var t; try { t = a["OptionalParameters"] } catch (e) { t = undefined } var s = null; if (e["SpecView"].Id === a.Label) { s = "toolbarButtonActive" } var r = a.Label; var o = [[a.Label, a.Icon, n => { var s = "?view=" + r; e.Platform.SwitchView(s, undefined, t) }, null, null, null, [], s]]; n.push(o) }; action() } } } var r = this.CreateButtonsAndMenus(n, "SpecDictionary", "topViewsGroup.1", "workstation"); this.Groups.push(r); r.Create(this.Element) } CreateButtonGroupFromSpecView(e, t, n) { if (e) { var s = []; var a = []; for (var r = 0; r < e.length; r++) { var o = e[r]; var l = o.Icon.indexOf("base64") > -1 ? o.Icon : n[o.Icon]; var c = o.hasOwnProperty("ExtraClass") ? o.ExtraClass : null; if (o.Type === "ActionGroup") { var d = [[o.Label, l, (e, t) => { }, null, null, null, [o], c]]; var h = o.Actions; for (var u = 0; u < h.length; u++) { var f; if (h[u].Type !== "ActionSeparator") { var p = h[u].Icon.indexOf("base64") > -1 ? h[u].Icon : n[h[u].Icon]; var m = h[u].hasOwnProperty("ExtraClass") ? h[u].ExtraClass : null; f = [h[u].Label, p, (e, n) => { var s = n[0]; var a = new WebClient.ResourceActionController(s); var r = t.CurrentView.GetFhirEntities(); a.ExecuteAction(r, t.CurrentView) }, null, null, null, [h[u]], m] } else { f = h[u].Label } d.push(f) } if (o.IsDefault) a.unshift(d); else if (o.Important) a.push(d); else s.push(d) } else { var g = [[o.Label, l, (e, n) => { var s = n[0]; var a = new WebClient.ResourceActionController(s); var r = t.CurrentView.GetFhirEntities(); a.ExecuteAction(r, t.CurrentView) }, null, null, null, [o], c]]; if (o.IsDefault) a.unshift(g); else if (o.Important) a.push(g); else s.push(g) } } var C = this.CreateButtonsAndMenus(a, "SpecDictionary", "importantSpecButtons.1", "workstation"); this.Groups.push(C); C.Create(this.Element); var v = this.CreateButtonsAndMenus(s, "SpecDictionary", "specButtons.1", "workstation"); this.Groups.push(v); v.Create(this.Element) } } ManageButtonMore() { if (Toolbar.EditMode) return; if (this.Groups.length > 0) { var e = window.innerWidth - 48; var t = 0; var n = 0; var s = 0; let u = false; for (var a = 0; a < this.Groups.length; a++) { var r = this.Groups[a]; var o = 0; for (var l = 0; l < this.Groups[a].Buttons.length; l++) { var c = this.Groups[a].Buttons[l]; if (c.Element.style.display !== "none") o++ } s += o; for (var d = 0; d < r.Buttons.length; d++) { var h = r.Buttons[d]; t += h.Element.clientWidth; if (t > e) { t -= h.Element.clientWidth; e = t; this.Element.setAttribute("data-btns", (n - 1).toString()); this.Element.setAttribute("data-mxtop", (n - 1).toString()); this.Element.setAttribute("data-scrollw", (e - r.Buttons[d].Element.clientWidth).toString()); this.Element.style.width = e + "px"; this.Groups[0].Element.style.marginLeft = "0"; WebClient.DOMUtils.AddClass(this.Element, "cuttedGroup"); u = true; break } else { this.Element.removeAttribute("style"); WebClient.DOMUtils.RemoveClass(this.Element, "cuttedGroup") } if (h.HidePermanent !== true && h.Hide !== true && h.Element.clientWidth > 0) n++ } } if (!u) { this.Groups.forEach((e => { e.Buttons.forEach((e => { if (e.Element.style.display !== "none") e.Element.style.left = null })) })) } this.Element.setAttribute("data-numbuttons", s.toString()) } } GetRealGroupWidth(e) { var t = this.Groups[e].Buttons.length; var n = 0; var s = ""; for (var a = 0; a < t; ++a) { var r = this.Groups[e].Buttons[a]; if (!r.Hide && r.Name !== "more") { n += r.Element.clientWidth; s += " " + r.Name } } return n } SelectButton(e, t, n = "") { this.PerformButtonAction(e, t, (e => { WebClient.DOMUtils.AddClass(e.Element, "selected"); if (n !== "") WebClient.DOMUtils.AddClass(e.Element, n); return false })) } DeselectButton(e, t, n = "") { this.PerformButtonAction(e, t, (e => { WebClient.DOMUtils.RemoveClass(e.Element, "selected"); if (n !== "") WebClient.DOMUtils.RemoveClass(e.Element, n); return false })) } PerformButtonAction(e, t, n) { t = t.toLowerCase(); this.iterateButtons(e, ((e, s) => { if (s !== null && s !== undefined && s.toLowerCase() === t.toLowerCase()) { n(e); return true } return false })) } DeselectAllButtons() { this.iterateButtons(null, ((e, t) => { if (WebClient.DOMUtils.HasClass(e.Element, "selected") && (!WebClient.DOMUtils.HasClass(e.Element, "fixedSelected") && !WebClient.DOMUtils.HasClass(e.Element, "fixedSelectedMenu"))) { WebClient.DOMUtils.RemoveClass(e.Element, "selected"); return false } return false })) } GetButtonParent(e) { var t = null; this.iterateButtons(null, ((n, s, a, r) => { if (s !== null && s !== undefined && s.toLowerCase() === e.toLowerCase()) { if (a) t = r; return true } return false })); return t } GetButton(e, t = null) { var n = null; this.iterateButtons(t, ((t, s) => { if (s !== null && s !== undefined && s.toLowerCase() === e.toLowerCase()) { n = t; return true } return false })); return n } HideButton(e, t, n = false) { var s = this.Groups; e: for (var a = 0; a < s.length; a++) { if (e === null || e === undefined || s[a].GroupName.toLowerCase() === e.toLowerCase()) { for (var r = 0; r < s[a].Buttons.length; r++) { if (s[a].Buttons[r].Name.toLowerCase() === t.toLowerCase()) { var o = s[a].Buttons[r]; o.Hide = true; o.HidePermanent = n; o.Element.style.display = "none"; break e } else if (s[a].Buttons[r].Child !== null) { var l = s[a].Buttons[r].Child.ButtonItems; l.forEach((e => { if (e instanceof WebClient.MenuButtonItem) { if (e.Name === t) { e.Hide = true; e.Element.style.display = "none"; return } } })) } } } } } ShowButton(e, t) { var n = this.Groups; e: for (var s = 0; s < n.length; s++) { if (e === null || e === undefined || n[s].GroupName.toLowerCase() === e.toLowerCase()) { for (var a = 0; a < n[s].Buttons.length; a++) { if (n[s].Buttons[a].Name.toLowerCase() === t.toLowerCase()) { var r = n[s].Buttons[a]; if (!r.HidePermanent) { r.Hide = false; r.Element.style.display = "inline-block" } break e } else if (n[s].Buttons[a].Child !== null) { var o = n[s].Buttons[a].Child.ButtonItems; o.forEach((e => { if (e instanceof WebClient.MenuButtonItem) { if (e.Name === t) { e.Hide = false; e.Element.style.display = "table"; return } } })) } } } } } RemoveClassFromAllButtons(e, t, n = "") { this.iterateButtons(e, ((e, s) => { if (n !== "") { if (WebClient.DOMUtils.HasClass(e.Element, n)) WebClient.DOMUtils.RemoveClass(e.Element, t) } else { WebClient.DOMUtils.RemoveClass(e.Element, t) } return false })) } GetValueFromButtonBar(e, t) { var n = -1; this.iterateButtons(e, ((e, s) => { if (s === t) { if (e.Element.childNodes) { e.Element.childNodes.forEach((e => { if (e["type"] === "radio") { var t = e; var s = t.name; if (t.checked) { n = t.id.split[s][1] } } })) } return true } return false })); return n } SetValueToButtonBar(e, t, n) { this.iterateButtons(e, ((e, s) => { if (s === t) { if (e.Element.childNodes) { e.Element.childNodes.forEach((e => { if (e["type"] === "radio") { var t = e; var s = t.name; if (t.id === s + "" + n) { t.checked = true } } })) } return true } return false })) } AddDynamicSubMenu(e, t, n, s, a, r = true, o) { var l = this.GetButton(a); l.Type = e; if (l.Child !== undefined && l.Child !== null) { WebClient.DOMUtils.RemoveItem(l.Child.Element) } var c = this.createButtonItems(t, n, r); l.Child = new WebClient.ToolbarMenu(c, o); var d = l.Element.nextSibling; l.Remove(); l.Create(l.Parent, "rebuilded", d) } AppendControlsToLastGroup(e, t, n) { var s = this.createItems(e, t, n); var a = this.Groups; var r = a[a.length - 1]; for (var o = 0; o < s.length; o++) { if (!this.GetButton(s[o].Name, r.GroupName)) r.AddItem(s[o]) } } GroupNameExist(e) { return this.Groups.some((t => t.GroupName.toLowerCase() === e)) } IndexGroupPerName(e) { for (var t = 0; t < this.Groups.length; t++) { if (this.Groups[t].GroupName.toLowerCase() === e.toLowerCase()) { return t } } } GetGroupName(e) { var t = this.Groups.filter((t => { if (Array.isArray(e)) { if (t.Buttons.filter((t => { var n = e.filter((e => { if (e.toLowerCase() === t.Name.toLowerCase()) return true })).pop(); if (n !== undefined) { if (n.toLowerCase() === t.Name.toLowerCase()) return true } })).length === 1) return true } else { if (t.Buttons.filter((t => t.Name.toLowerCase() === e.toLowerCase())).length === 1) return true } })).pop(); if (t !== undefined) return t.GroupName; return this.Groups[this.Groups.length - 1].GroupName } GetElementsByGroupName(e) { var t; this.Groups.filter((n => { if (n.GroupName === e) t = n.Buttons })); return t } AppendMenuButtonItems(e, t, n, s, a, r = false) { var o = this.createButtonItems(e, t, true); var l = this.Groups; var c = -1; var d = -1; var h = -1; e: for (var u = 0; u < l.length; u++) { var f = l[u].Buttons; t: for (var p = 0; p < f.length; p++) { if (f[p].Name.toLowerCase() !== a.toLowerCase()) continue t; var m = f[p].Child; if (m) { var g = m.ButtonItems; n: for (var C = 0; C < g.length; C++) { var v = g[C]; var E = []; if (!Array.isArray(n)) E.push(n); else E = n; if (E.some((e => e.toLowerCase() === v.Name.toLowerCase()))) { c = u; d = p; h = C; C = g.length; p = f.length; break e } } } } } if (h !== -1) { o.forEach((e => { if (!this.Groups[c].Buttons[d].Child.ButtonItems.some((t => e.Name.toLowerCase() === t.Name.toLowerCase()))) { if (!r) { if (s) { this.Groups[c].Buttons[d].Child.ButtonItems.splice(h, 0, e); this.Groups[c].Buttons[d].Child.ButtonItems[h].Create(this.Groups[c].Buttons[d].Child.ButtonItems[h + 1].Element.parentElement); this.Groups[c].Buttons[d].Child.ButtonItems[h + 1].Element.parentElement.insertBefore(e.Element, this.Groups[c].Buttons[d].Child.ButtonItems[h + 1].Element); h++ } else { this.Groups[c].Buttons[d].Child.ButtonItems.splice(h + 1, 0, e); this.Groups[c].Buttons[d].Child.ButtonItems[h + 1].Create(this.Groups[c].Buttons[d].Child.ButtonItems[h + 1].Element.parentElement); this.Groups[c].Buttons[d].Child.ButtonItems[h + 2].Element.parentElement.insertBefore(e.Element, this.Groups[c].Buttons[d].Child.ButtonItems[h + 2].Element); h += 2 } } else { this.Groups[c].Buttons[d].Child.ButtonItems.push(e); this.Groups[c].Buttons[d].Child.ButtonItems[this.Groups[c].Buttons[d].Child.ButtonItems.length - 1].Create(this.Groups[c].Buttons[d].Child.ButtonItems[h].Element.parentElement); this.Groups[c].Buttons[d].Child.ButtonItems[h].Element.parentElement.appendChild(e.Element) } } })) } } ShowOrHideButtonsPerGroupName(e, t, n = false) { var s = this.Groups; for (var a = 0; a < s.length; a++) { if (e.some((e => e.toLowerCase() === s[a].GroupName.toLowerCase()))) { var r = s[a].Buttons; for (var o = 0; o < r.length; o++) { if (t) { if (!r[o].HidePermanent || n) { r[o].HidePermanent = false; r[o].Hide = false; r[o].Element.style.display = "inline-block" } } else { if (!r[o].ShowPermanent || n) { r[o].HidePermanent = true; r[o].Hide = true; r[o].Element.style.display = "none" } } } } } } AppendControlsToGroup(e, t, n, s, a = null) { var r = this.createItems(e, t, s); var o = this.Groups; for (var l = 0; l < o.length; l++) { if (o[l].GroupName.toLowerCase() === n.toLowerCase()) { e: for (var c = 0; c < r.length; c++) { if (o[l].Buttons.some((e => e.Name.toLowerCase() === r[c].Name.toLowerCase()))) continue e; if (a !== null) { var d = -1; var h = o[l].Buttons; var u; for (var f = 0; f < h.length; f++) { var p = Array.isArray(a) ? a.filter((e => e.toLowerCase() === h[f].Name.toLowerCase())).length === 1 : h[f].Name.toLowerCase() === a.toLowerCase(); if (p) { u = h[f].Element; d = f; break } } if (d !== -1 && u !== undefined) { o[l].Buttons.splice(d + c + 1, 0, r[c]); o[l].Buttons[d + c + 1].Create(o[l].Element); u.parentElement.insertBefore(r[c].Element, u) } else { o[l].AddItem(r[c]) } } else { o[l].AddItem(r[c]) } } break } } this.OnWindowResize(document.documentElement.clientWidth, document.documentElement.clientHeight) } CreateButtonsAndMenus(e, t, n, s) { var a = this.createItems(e, t, s); return new ToolbarItemGroup(a, n) } CheckApplicationTags(e) { if (!this.platform) return false; var t = this.platform.CurrentSpec.Functions[0]; var n = false; var s = []; var a = t["ButtonStates"]; s.push(a); var r = WebClient.HttpUtils.GetUrlParameter("view") || this.platform.CurrentSpec.GetDefaultView().Id; var o = t["Views"][r].ButtonStates; s.push(o); var processObject = t => { if (t !== undefined && t[e] !== undefined) { if (t[e].ShowWhen !== undefined) { n = true; var s = t[e].ShowWhen; for (var a = 0; a < s.length; a++) { if (this.platform.ApplicationTags.hasOwnProperty(s[a])) { n = false; break } } } if (t[e].HideWhen !== undefined) { var r = t[e].HideWhen; for (var a = 0; a < r.length; a++) { if (this.platform.ApplicationTags.hasOwnProperty(r[a])) { n = true; break } } } } }; for (var l = 0; l < s.length; l++) { if (s[l] !== undefined) processObject(s[l]) } return n } Show() { this.Element.style.display = "block" } Hide() { this.Element.style.display = "none" } createMoreButton() { this.Parent = this.Element; var e = document.createElement("div"); WebClient.DOMUtils.AddClass(e, "toolbar_cover"); this.Element.appendChild(e); var t = this.language.GetValuesFromDict("Efferent.PlatformClient", "more"); var buttonAction = e => { var t = parseFloat(this.Groups[0].Element.style.marginLeft) || 0; var n = parseFloat(this.Element.getAttribute("data-btns")); var s = parseFloat(this.Element.getAttribute("data-mxtop")); var a = parseFloat(this.Element.getAttribute("data-numbuttons")); var r; if (s >= a) { r = 0; this.Element.setAttribute("data-mxtop", n.toString()) } else { s += n; this.Element.setAttribute("data-mxtop", s.toString()); r = t - parseFloat(this.Element.getAttribute("data-scrollw")) } this.Groups[0].Element.style.marginLeft = r + "px" }; var n = new WebClient.ToolbarButton(t, "more", WebClient.ResourceBag.Icons8ViewMore32Png, WebClient.EToolbarButtonType.Push, buttonAction, null, null, false, false, [], "moreButton"); n.Create(this.Parent) } iterateButtons(e, t) { var n = this.Groups; if (e != null) e = e.toLowerCase(); for (var s = 0; s < n.length; s++) { if (e === null || n[s].GroupName.toLowerCase() === e.toLowerCase()) { for (var a = 0; a < n[s].Buttons.length; a++) { var r = n[s].Buttons[a]; if (t(r, r.Name, false, null) === true) { break } else { if (n[s].Buttons[a].Child !== null) { for (var o = 0; o < n[s].Buttons[a].Child.ButtonItems.length; o++) { var l = n[s].Buttons[a].Child.ButtonItems[o]; if (t(l, l.Name, true, n[s].Buttons[a]) === true) break } } } } } } } createButtonItems(e, t, n) { var s = new Array; var a; if (n) a = 1; else a = 0; for (var r = a; r < e.length; r++) { var o = e[r]; if (typeof o === "string") { var l = new WebClient.MenuButtonItem(this.language.GetValuesFromDict(t, o), o, null, null, "title"); s.push(l) } else if (o.constructor.name === "Object") { var c = new WebClient.MenuButtonItem(this.language.GetValuesFromDict(t, o["title"]), o["name"], o["imageString"], o["event"], "logo"); c.StylesImage = o["stylesImage"]; s.push(c) } else if (typeof o[1] === "string") { var d; var h; if (isNaN(parseInt(o[1]))) d = false; else d = "tagButton"; var u = this.CheckApplicationTags(o[0]); var f = o[7] !== undefined && o[7] !== null ? o[7] : "imageButton"; if (d || o[3] !== undefined && o[3] === "icon") h = new WebClient.MenuButtonItem(o[0], o[0], o[1], o[2], "regular", d, o[6], u); else h = new WebClient.MenuButtonItem(this.language.GetValuesFromDict(t, o[0]), o[0], o[1], o[2], "regular", f, o[6], u); s.push(h) } else if (o[1].length >= 1) { var p = new WebClient.MenuButtonbar(o[2]); for (var m = 0; m < o[1].length; m++)p.CreateItem(o[1][m].toString(), o[0]); s.push(p) } } return s } createItems(e, t, n) { var s, a, r, o, l, c, d, h; var u = new Array; for (var f = 0; f < e.length; f++) { var p = e[f]; if (p.length === 1) { var m = new WebClient.ToolbarButton(this.language.GetValuesFromDict(t, p[0][0]), p[0][0], p[0][1], WebClient.EToolbarButtonType.Push, p[0][2], n, (s = p[0][3]) !== null && s !== void 0 ? s : null, (a = p[0][4]) !== null && a !== void 0 ? a : this.CheckApplicationTags(p[0][0]), (r = p[0][5]) !== null && r !== void 0 ? r : this.CheckApplicationTags(p[0][0]), (o = p[0][6]) !== null && o !== void 0 ? o : [], p[0][7], p[0][8]); u.push(m) } else { var g = this.createButtonItems(p, t, true); var C = new WebClient.ToolbarMenu(g); var v = new WebClient.ToolbarButton(this.language.GetValuesFromDict(t, p[0][0]), p[0][0], p[0][1], WebClient.EToolbarButtonType.DropDown, (l = p[0][2]) !== null && l !== void 0 ? l : null, n, C, (c = p[0][4]) !== null && c !== void 0 ? c : this.CheckApplicationTags(p[0][0]), (d = p[0][5]) !== null && d !== void 0 ? d : this.CheckApplicationTags(p[0][0]), (h = p[0][6]) !== null && h !== void 0 ? h : [], p[0][7]); u.push(v) } } return u } static MenuOpened() { var e = false; var t = document.getElementsByClassName("toolbarMenu"); for (var n = 0; n < t.length; n++) { if (t[n].style.display !== "none") e = true } return e } static HideAllMenus() { var e = document.getElementsByClassName("toolbarMenu"); var t = document.getElementById("sharedFlyout"); if (t && WebClient.DOMUtils.IsDisplay(t)) t.style.display = "none"; if (e !== null) { for (var n = 0; n < e.length; n++)e[n].style.display = "none" } } static ResizeDropdown(e, t) { if (t === 1) { Toolbar.HideAllMenus() } else { e.getElementsByClassName("dropdown")[0].setAttribute("style", "height:" + "auto"); if (!e.offsetParent && e.offsetWidth === 0 && e.offsetHeight === 0) return; var n = Math.max(window.innerHeight, 0, document.body.offsetHeight, document.documentElement.clientHeight); var s = e.offsetTop; var a = n - s - 20; e.style.maxHeight = a + "px"; var r = e.getElementsByClassName("toolbarMenuGroup"); var o = 0; var l = 0; for (var c = 0; c < r.length; c++) { o = r[c].getBoundingClientRect().top + parseFloat(window.getComputedStyle(r[c]).height); if (o > l) l = o } e.style.maxHeight = a + "px"; var d = l - e.getBoundingClientRect().top + 5; e.getElementsByClassName("dropdown")[0].setAttribute("style", "height:" + d + "px"); var h = e.clientWidth; var u = parseFloat(getComputedStyle(e).left); var f = window.innerWidth; if (u + h > f) e.style.left = f - h + "px" } } static SetToolbarMenuClasses(e, t = {}) { if (t) { for (var n of Object.keys(t)) { e.style[n] = t[n] } } } static DeselectFixed() { var e = document.getElementsByClassName("toolbarDrop"); if (e !== null) { for (var t = 0; t < e.length; t++) { var n = e[t]; if (WebClient.DOMUtils.HasClass(n, "fixedSelectedMenu")) WebClient.DOMUtils.RemoveClass(n, "fixedSelectedMenu") } } } static SelectUnSelectFixedButton(e, t) { if (e) { if (t) { WebClient.DOMUtils.AddClass(e.Element, "selected"); WebClient.DOMUtils.AddClass(e.Element, "fixedSelected") } else { WebClient.DOMUtils.RemoveClass(e.Element, "selected"); WebClient.DOMUtils.RemoveClass(e.Element, "fixedSelected") } } } static UnBlockAndBlockButtons(e, t, n, s) { e.forEach((e => { if (!s || s && s.some((t => t === e.GroupName))) { e.Buttons.forEach((e => { if (!n || n && n.length === 0 || n && !n.some((t => t === e.Name))) { e.Element.setAttribute("data-static", t ? "1" : "0"); e.Element.style.opacity = t ? "0.33" : "1" } else { e.Element.setAttribute("data-static", !t ? "1" : "0"); e.Element.style.opacity = !t ? "0.33" : "1" } })) } })) } static UnBlockAndBlockOneButton(e, t, n) { e.forEach((e => { e.Buttons.forEach((e => { if (e.Name === n) { e.Element.setAttribute("data-static", t ? "1" : "0"); e.Element.style.opacity = t ? "0.33" : "1" } })) })) } static AddDynamicMenuNoToolbar(e, t, n, s) { var a = document.createElement("div"); a.setAttribute("id", t); WebClient.DOMUtils.AddClass(a, "toolbarMenu"); var r = document.createElement("div"); WebClient.DOMUtils.AddClass(r, "dropdown"); var o = document.createElement("div"); o.style.textAlign = "left"; WebClient.DOMUtils.AddClass(o, "toolbarMenuGroup"); r.appendChild(o); a.appendChild(r); var l = Object.keys(n); l.forEach(((e, t, s) => { a.style[e] = n[e] })); var c = new Array; s.forEach((t => { var n = t; if (n[0] !== null) { var s = document.createElement("div"); WebClient.DOMUtils.AddClass(s, "toolbarMenuItem"); var r = document.createElement("span"); WebClient.DOMUtils.AddClass(r, "groupTitle"); r.innerHTML = n[0]; s.appendChild(r); o.appendChild(s) } for (var l = 1; l < n.length; l++) { var d = n[l][0]; var h = n[l][1]; var u = n[l][2]; var f = n[l][3]; var p = document.createElement("div"); WebClient.DOMUtils.AddClass(p, "toolbarMenuItem"); c.push(p); if (h) WebClient.DOMUtils.AddClass(p, "selected"); var m = document.createElement("span"); m.innerHTML = d; p.setAttribute("data-user", u); p.onclick = e => { for (var t = 0; t < c.length; t++) { WebClient.DOMUtils.RemoveClass(c[t], "selected") } WebClient.DOMUtils.AddClass(e.currentTarget, "selected"); f(e.currentTarget.getAttribute("data-user")) }; p.appendChild(m); o.appendChild(p) } e.appendChild(a) })); return a } } WebClient.Toolbar = Toolbar })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class ToolbarButtonRef { constructor(e, t) { this.GroupName = e; this.ButtonName = t } } e.ToolbarButtonRef = ToolbarButtonRef; let t; (function (e) { e[e["Push"] = 0] = "Push"; e[e["Toggle"] = 1] = "Toggle"; e[e["DropDown"] = 2] = "DropDown" })(t = e.EToolbarButtonType || (e.EToolbarButtonType = {})); class ToolbarButton { constructor(e, t, n, s, a, r, o = null, l, c, d = [], h, u) { this.Title = e; this.Name = t; this.Image = n; this.Type = s; this.Action = a; this.Plugin = r; this.Child = o; this.Hide = l; this.HidePermanent = c; this.References = d; this.ExtraClass = h; this.ShowPermanent = false; this.ViewportsWorked = []; this.ControlDOMToCreate = u } Remove() { e.DOMUtils.RemoveItem(this.Element) } Create(n, s, a) { this.Parent = n; if (this.ControlDOMToCreate) { this.Element = document.createElement("div"); if (this.ExtraClass) e.DOMUtils.AddClass(this.Element, this.ExtraClass); if (a) this.Parent.insertBefore(this.Element, a); else this.Parent.appendChild(this.Element); this.ControlDOMToCreate(this.Element) } else { this.Element = document.createElement("div"); if (this.Plugin !== null) this.Element.setAttribute("data-plugin", this.Plugin); if (this.Hide) { this.Element.style.display = "none" } e.DOMUtils.AddClass(this.Element, "enabledButton"); if (this.ExtraClass) e.DOMUtils.AddClass(this.Element, this.ExtraClass); var r = document.createElement("span"); var o = this.Title.split(" "); var l = o[0]; o.shift(); var c = o.join(" "); if (o.length > 0) { r.innerHTML = l + "<br>" + c } else { r.style.paddingTop = "7px"; r.innerHTML = l } var d = e.Utils.ValidateURL(this.Image); if (!d) { if (this.Image !== null && this.Image !== undefined) d = this.Image.indexOf("data:image/png;base64,") === 0; else d = false } var h = new Image; h.onload = () => { if (!d && this.Image !== null && this.Image !== undefined) h.className = "icon " + this.Image; this.Element.innerHTML = ""; this.Element.appendChild(r); this.Element.appendChild(h) }; if (d) h.src = this.Image; else h.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"; var u = new Hammer(this.Element); u.on("tap", (t => { var n = t.srcEvent.target; t.srcEvent.stopPropagation(); if (e.Toolbar.EditMode && !this.Element.classList.contains("toolbarDrop")) return; else this.executeAction(n, t) })); if (this.Child !== null) { if (this.Type === t.DropDown) e.DOMUtils.AddClass(this.Element, "toolbarDrop"); this.menuHtml = this.Child.Create(this.Parent) } else { if (this.Type === t.Push) e.DOMUtils.AddClass(this.Element, "toolbarButton") } if (a) this.Parent.insertBefore(this.Element, a); else this.Parent.appendChild(this.Element) } } executeAction(n, s) { if (this.Type === t.DropDown) { if (!e.DOMUtils.HasClass(n, "toolbarDrop")) n = n.parentElement; if (e.DOMUtils.HasClass(n, "selected") && !e.DOMUtils.HasClass(n, "optionInMenuPressed")) { e.DOMUtils.RemoveClass(n, "selected"); e.Toolbar.HideAllMenus(); return } if (e.Toolbar.MenuOpened() && e.DOMUtils.HasClass(n, "optionInMenuPressed")) { e.Toolbar.HideAllMenus(); return } if (n.getAttribute("data-static") === "1") return; if (this.Action !== null) { var a = this.Action(s, this.References); if (a === "stop") { return } } if (e.DOMUtils.HasClass(n, "noShowMenu")) { e.DOMUtils.RemoveClass(n, "noShowMenu"); return } e.Toolbar.HideAllMenus(); const t = this.Element.getBoundingClientRect(); const r = { maxHeight: 0, display: "inline-flex", left: `${t.left}px`, top: `${t.top + t.height}px` }; e.Toolbar.SetToolbarMenuClasses(this.menuHtml, r); const o = document.getElementsByClassName("toolbarDrop"); if (o !== null) { for (let t = 0; t < o.length; t++) { const n = o[t]; if (!e.DOMUtils.HasClass(n, "optionInMenuPressed")) e.DOMUtils.RemoveClass(n, "selected") } } e.Toolbar.ResizeDropdown(this.menuHtml); e.DOMUtils.AddClass(this.Element, "selected") } else if (this.Type === t.Push) { if (!e.DOMUtils.HasClass(n, "toolbarButton")) n = n.parentElement; if (n.getAttribute("data-static") === "1") return; if (this.Action !== null) this.Action(s, this.References) } } } e.ToolbarButton = ToolbarButton })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class MenuButtonbar { constructor(e) { this.Items = new Array; this.func = e } Create(t) { this.Parent = t; this.Element = document.createElement("div"); e.DOMUtils.AddClass(this.Element, "buttonbar"); this.Parent.appendChild(this.Element); for (var n = 0; n < this.Items.length; n++) { var s = document.createElement("input"); var a = this.Items[n].split(","); var r = a[0]; var o = a[1]; if (this.Name === undefined) this.Name = o; s.setAttribute("type", "radio"); s.setAttribute("id", o + (n + 1).toString()); s.setAttribute("name", o); var l = document.createElement("label"); l.setAttribute("for", o + (n + 1).toString()); l.innerHTML = r; var c = new Hammer(l); c.on("tap", (e => { this.func(e, e.target.innerText) })); this.Element.appendChild(s); this.Element.appendChild(l) } } CreateItem(e, t) { this.Items.push(e + "," + t) } } e.MenuButtonbar = MenuButtonbar; class MenuButtonItem { constructor(e, t, n, s, a, r = null, o = null, l = false) { this.Title = e; this.Name = t; this.ImageButton = n; this.ActionFunction = s; this.Type = a; this.RefAction = o; this.Hide = l; if (r) this.ClassName = r } Create(t) { this.Parent = t; this.Element = document.createElement("div"); if (this.Hide) this.Element.style.display = "none"; e.DOMUtils.AddClass(this.Element, "toolbarMenuItem enabledButton"); if (this.ClassName) e.DOMUtils.AddClass(this.Element, this.ClassName); if (this.ImageButton !== null) { var n = document.createElement("span"); n.innerHTML = this.Title; n.title = this.Title; switch (this.ImageButton) { case "0": case "1": case "2": this.Element.appendChild(n); break; case "0-0": e.DOMUtils.AddClass(this.Element, "tagfirst"); this.Element.appendChild(n); break; case "0-1": e.DOMUtils.AddClass(this.Element, "tagbetween"); this.Element.appendChild(n); break; case "0-2": e.DOMUtils.AddClass(this.Element, "tagend"); this.Element.appendChild(n); break; case "active": e.DOMUtils.AddClass(this.Element, "activeTag"); e.DOMUtils.AddClass(this.Element, "tagButton"); this.Element.appendChild(n); break; case "noIcon": this.Element.appendChild(n); break; default: var s = new Image; s.onload = () => { this.Element.appendChild(n); this.Element.appendChild(s); if (this.StylesImage) { for (const e in this.StylesImage) { if (this.StylesImage.hasOwnProperty(e)) { const t = this.StylesImage[e]; s.style[e] = t } } } }; s.src = this.ImageButton; break }var a = new Hammer(this.Element); a.on("tap", (t => { var n = document.getElementsByClassName("toolbarDrop"); if (n !== null) { for (var s = 0; s < n.length; s++) { var a = n[s]; if (!e.DOMUtils.HasClass(a, "optionInMenuPressed")) e.DOMUtils.RemoveClass(a, "selected") } } var r = document.getElementsByClassName("toolbarMenuItem"); if (r !== null) { for (var o = 0; o < r.length; o++) { var l = r[o]; if (!e.DOMUtils.HasClass(l, "fixedSelected")) e.DOMUtils.RemoveClass(l, "selected") } } this.ActionFunction(t, this.RefAction) })) } else { var r = document.createElement("span"); e.DOMUtils.AddClass(r, "groupTitle"); r.innerHTML = this.Title; this.Element.appendChild(r) } this.Parent.appendChild(this.Element) } SelectedButton(t) { if (!t) e.DOMUtils.RemoveClass(this.Element, "selected"); else e.DOMUtils.AddClass(this.Element, "selected") } } e.MenuButtonItem = MenuButtonItem; class ToolbarMenu { constructor(e, t) { this.ButtonItems = e; this.id = t } CreateExtraContainer(t) { if (t !== undefined && t !== null) { this.id = t; this.Element.setAttribute("id", this.id); var n = document.createElement("div"); e.DOMUtils.AddClass(n, "toolbarMenuGroup"); n.setAttribute("id", this.id + "_extraButtonsContainer"); var s = document.createElement("div"); e.DOMUtils.AddClass(s, "toolbarMenuGroup"); s.setAttribute("id", this.id + "_topControlContainer"); var a = document.createElement("img"); a.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAACxUlEQVRYhcWWTYiNURjHf2eMJvna+ChiIeRroVhgq6HIRpkSiWLBwkyyURbKUsiQjyjZYOejbqIo2bBQlLKiLAxS49v4GH4W7zN6e91x33tnLqdu9z3nOef8/s95znPOgf9c0lAnUBcDO4BpJYf0AdeAkyklW4cIXwFcAe4C94H+EsNGAwfi+8SQ4GqfelStayXVE+plgIZWIOf5GWBnSslB+k0GOoDvwIWU0rsw9QFtjbAHPP+sdv/Nc3WK+lJ9pvaoT9TxYTukXgNoqRcOXCbzvHMwz6NsBXqBmcAsYBSwvtiptIA64ZCF9xvwgywE32kw5PllP1J2w6kz1HfqA/Wx+kKdGLbfIaipKOf5aaCrhOcApJSeqguBzWTpeSal9LrM2Dy8PTw/WW+q1Zi39iZU28lS7Rywvazn9ZaqAnLwU8COZsGrCsgdMqeAXU2CjyTLjj/hEfPDwxnzAiOpt9SzRcPAhjvcDHAOfjTukEV5w5KAH/pH8BVF40W10gRoizrmr/DouE99pc4fBmiruk29p/ablY/x3zXYoDa1ErdXwyLUCeod9YN6UF2lLlU3xPxfy4qY1wC8NeCP1OmD9OkIEZuGXUQs+/s8XF2pPir061TfqGOHVUTE/GChba36qdDWGg+U7VDlJEwpfQXWkj0yb6lzS8BHAIuAm1Ffra4DlgIj1HXxW5BS6gduAwtrTTqwEi9qiVBHxy5fFvWHam9sxp/x3avuDftx9VItx0qLiDz/oG4stP8Rgmi/rh6rKaCMiIB3xwpUCrZqe2Cq+kVdU0pAFRFzCvAj6ie1S/2mduTsC9T9uXqLetXsmVbXgzgvomdAhNmt+VldHvXdkeed6sgqnl9V3zZ82BVStBLw9kKfLQHpUc/HhrsRy/6gCK/7zlfbgD3AbKA7pXS3Sp9xwAayVJsEPAeuA5WU0s96mU0tvwBXVFlAqfYXpwAAAABJRU5ErkJggg=="; var r = document.createElement("span"); r.innerText = "New custom tag"; r.style.fontWeight = "300"; r.style.fontSize = "15px"; r.style.margin = "0px 0px 5px 10px"; r.style.display = "inline-block"; r.style.color = e.Colors.Clouds; r.style.position = "relative"; r.style.bottom = "10px"; var o = document.createElement("input"); o.style.display = "block"; o.type = "text"; o.id = "inputCustomTag"; o.style.width = "165px"; var l = document.createElement("div"); l.style.marginBottom = "5px"; l.innerText = "CUSTOM"; s.appendChild(l); s.appendChild(a); s.appendChild(r); s.appendChild(o); s.appendChild(n); var c = document.createElement("div"); c.id = "defaultTagsContainer"; var d = document.createElement("div"); d.style.margin = "5px 0px 5px"; d.id = "defaultTagsTitle"; d.innerText = "DEFAULT"; c.appendChild(d); s.appendChild(c); var h = document.createElement("div"); h.style.margin = "5px 0px 5px"; h.id = "presetsTagsTitle"; h.innerText = "PRESETS"; s.appendChild(h); var u = this.Element.firstChild.firstElementChild; this.Element.firstChild.insertBefore(s, u) } } Create(t) { this.Parent = t; var n = document.createElement("div"); e.DOMUtils.AddClass(n, "dropdown"); this.Element = document.createElement("div"); this.Element.appendChild(n); e.DOMUtils.AddClass(this.Element, "toolbarMenu"); var s = this.ButtonItems.length; var a = 0; var r = new Array; r[a] = document.createElement("div"); for (var o = 0; o < s; o++) { var l = this.ButtonItems[o]["Type"]; if (l === "title") { a++; r[a] = document.createElement("div") } e.DOMUtils.AddClass(r[a], "toolbarMenuGroup"); this.ButtonItems[o].Create(r[a]) } this.CreateExtraContainer(this.id); for (var c = 0; c < r.length; ++c) { if (r[c] !== undefined) this.Element.firstChild.appendChild(r[c]) } this.Element.style.display = "none"; this.Parent.appendChild(this.Element); return this.Element } } e.ToolbarMenu = ToolbarMenu })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { class TopbarItem { constructor(e, t) { this.Item = e; this.Display = t } } WebClient.TopbarItem = TopbarItem; class TopBar { constructor(e) { this.Parent = e; this.Element = document.createElement("div"); WebClient.DOMUtils.AddClass(this.Element, "staticTopBar"); this.Parent.appendChild(this.Element) } Show() { this.Element.style.display = "flex"; var platform = eval("window.platform"); if (platform && platform.Toolbar) platform.Toolbar.Element.style.display = "none"; if (this.PostActionShow !== undefined && this.PostActionShow !== null) { this.PostActionShow() } this.compensateWorklistHeight() } Hide() { this.Element.parentElement.style.height = "auto"; var platform = eval("window.platform"); if (platform && platform.Toolbar) platform.Toolbar.Element.style.removeProperty("display"); this.Element.style.display = "none"; this.Element.innerHTML = ""; this.compensateWorklistHeight(); window.dispatchEvent(new Event("resize")) } BuildForm(e, t) { this.Sections = e; this.SectionShowNumbers = t; e.forEach((e => { e.style.display = "none" })); t.forEach((t => { var n = e[t]; n.style.display = "flex"; n.style.width = "100%"; n.style.flexWrap = "wrap"; var s = n.childNodes; s[0].style.flex = "1 70%"; s[0].style.marginLeft = "10px"; s[0].style.paddingTop = "10px"; s[0].style.paddingBottom = "10px"; if (t !== 0) { var a = s[0].childNodes; a[0].style.display = "block" } s[1].style.flex = "2 20%"; s[1].style.marginRight = "10px"; s[1].style.paddingTop = "10px"; s[1].style.paddingBottom = "10px"; s[1].style.textAlign = "right" })); this.Show() } IsDisplay() { return WebClient.DOMUtils.IsDisplay(this.Element) } OnWindowResize(e, t) { if (this.Sections !== undefined && this.Sections.length > 0 && this.SectionShowNumbers.length > 0 && this.IsDisplay()) { this.Element.parentElement.style.height = this.Element.clientHeight + "px"; this.BuildForm(this.Sections, this.SectionShowNumbers) } } compensateWorklistHeight() { var e = document.getElementsByClassName("worklistPane")[0]; if (e) { var t = document.documentElement.clientHeight - e.offsetTop - 50; e.style.height = t + "px" } } } WebClient.TopBar = TopBar })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { class SubView { constructor(t, n, s, a) { this.Element = document.createElement("div"); this.parentView = a; this.ResizeListeners = new Array; this.container = t; this.orientationChange = false; this.platform = n; this.LocalTheme = this.platform.hasOwnProperty("CurrentView") && n.CurrentView.hasOwnProperty("LocalTheme") ? n.CurrentView["LocalTheme"] : null; this.HeaderSection = document.createElement("div"); e.DOMUtils.AddClass(this.HeaderSection, "headerSection"); this.BodySection = document.createElement("div"); e.DOMUtils.AddClass(this.BodySection, "bodySection"); this.Toolbar = new e.Toolbar(n.LanguageManager); this.Toolbar.Create(this.HeaderSection, false); e.DOMUtils.AddClass(this.Element, "SubViewPane"); this.Element.appendChild(this.HeaderSection); this.Element.appendChild(this.BodySection); this.container.appendChild(this.Element); window.addEventListener("resize", (e => { var t = document.documentElement.clientWidth; var n = document.documentElement.clientHeight; this.OnWindowResize(t, n, e) })); window.addEventListener("orientationchange", (e => { this.orientationChange = true })); this.dictionaryName = s; this.HoldAliveElement = false } SetButtons(t, n) { var s = [["close", e.ResourceBag.Icons8Delete32Png, e => { if (n) n(); if (!this.HoldAliveElement) this.CloseSubView() }]]; var a = new Array; t.forEach((e => { a.push(e) })); a.push(s); var r = this.Toolbar.CreateButtonsAndMenus(a, this.dictionaryName, "subView.1", "main"); this.Toolbar.Groups.push(r); r.Create(this.Toolbar.Element) } SwitchTheme() { this.platform.SwitchTheme(this) } CloseSubView() { e.DOMUtils.RemoveItem(this.Element); const t = this.parentView ? this.parentView : this.platform.CurrentView; if (!t.hasOwnProperty("SwitchThemeOnSubView") || t["SwitchThemeOnSubView"] === true) { this.platform.SwitchTheme(t) } } OnWindowResize(t, n, s) { if (s) { var a = s.target.document.activeElement; if (this.orientationChange || a.type !== "text" && a.type !== "password" && a.type !== "textarea") { this.Toolbar.OnWindowResize(t, n); for (var r in this.ResizeListeners) { if (this.ResizeListeners.hasOwnProperty(r)) { if (this.ResizeListeners[r] !== undefined) { try { this.ResizeListeners[r].ClassInstance.OnWindowResize(t, n) } catch (t) { e.Utils.DebugConsoleLog(t) } } } } this.orientationChange = false } } } } e.SubView = SubView })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { const { div: t, table: n, thead: s, tbody: a, tr: r, th: o, td: l, anchor: c, colgroup: d, col: h } = e.DOMUtils; class WLTable { constructor(e) { this.options = e; this.options.idField = e.idField || "Id"; this.isLoading = false } getShortText(e, t) { return e.length > t ? e.substring(0, t) + "..." : e } buildBodyLoading(e) { return a({ children: [r({ children: [l({ colSpan: e.length + 1, className: "text-center", innerHTML: `\n                                    <div class="spinner-grow my-3" style="width: 3rem; height: 3rem;" role="status">\n                                        <span class="visually-hidden">Loading...</span>\n                                    </div>\n                                    <p class="lead text-center">Loading...</p>\n                                    ` })] })] }) } buildCell(t, n, s, a = 0, r = false) { let o; const c = this.options.headers[n]; const d = (c.type === "number" ? "text-end" : "") + (c.nowrap ? " text-nowrap" : ""); if (c === null || c === void 0 ? void 0 : c.isLink) { if (this.options.isTree) { o = l({ className: d, children: [this.buildDetailLink(s, s[t])], attr: { header: c.name }, style: { cssText: `--depth: ${.75 * a}em` } }) } else { o = l({ className: d, children: [this.buildDetailLink(s, s[t])] }) } } else { let e = ""; if (this.options.isTree) e += `<span class="${n === 0 && r ? "treetoggle" : "treegap"}"></span>`; e += c && c.maxChars ? this.getShortText(s[t], c.maxChars) : c.type === "number" ? s[t] : c.renderFn ? c.renderFn(s[t]) : s[t] || ""; if (this.options.isTree) { o = l({ className: d, innerHTML: e, attr: { header: c.name }, style: { cssText: `--depth: ${.75 * a}em` } }) } else { o = l({ className: d, innerHTML: e }) } } if (c.withToolTip === true) { o.setAttribute("data-tooltip", s[t]); o.setAttribute("data-position", "center top"); var h = new e.Tooltip(o, new e.ToolTipOptions(0, 2)) } return o } buildBody(e) { const t = this.options.headers.map((e => e.field)); if (this.isLoading) return this.buildBodyLoading(t); return a({ children: e.map(((e, n) => { const s = t.map(((t, n) => this.buildCell(t, n, e))); if (this.options.actionButtons !== null) { s.push(l({ className: "text-end", children: [this.buildActions(e, n)] })) } return r({ attr: { "data-id": e[this.options.idField] }, children: s }) })) }) } buildDetailLink(e, t) { const n = window.location.hash; return c({ innerHTML: t, href: `${n}/detail/${e.Id}` }) } buildActions(e, n) { if (this.options.actionButtons) { if (Array.isArray(this.options.actionButtons)) { return t({ className: "d-grid gap-2 d-md-flex justify-content-md-end", children: this.options.actionButtons }) } else { return t({ className: "d-grid gap-2 d-md-flex justify-content-md-end", children: this.options.actionButtons(e, n) }) } } const s = window.location.hash; return t({ className: "d-grid gap-2 d-md-flex justify-content-md-end", children: [c({ innerHTML: "Edit", className: "btn btn-outline-primary btn-sm me-md-2", href: `${s}/edit/${e.Id}` }), c({ innerHTML: "Delete", className: "btn btn-outline-danger btn-sm me-md-2", href: `${s}/delete/${e.Id}` })] }) } setHighlightRow(e) { var t; const n = (t = this.element) === null || t === void 0 ? void 0 : t.querySelector(`[data-id="${e}"]`); if (n) { n.addEventListener("scroll", (() => { if (n.offsetHeight + n.scrollTop >= n.scrollHeight) console.log("scrolled to bottom") })); n.scrollIntoView({ block: "start", behavior: "smooth" }); n.classList.add("highlight") } } update() { this.element.innerHTML = ""; this.element.appendChild(this.buildTable()) } forceUpdate(e) { this.options.data = e; this.update() } setLoading(e) { this.isLoading = e } render() { return this.element = t({ className: "table table-responsive", children: [this.buildTable()] }) } buildHeader(e) { const buildTh = e => o({ innerHTML: e.name }); const t = e.map(buildTh); if (this.options.actionButtons) { t.push(o({ innerHTML: "Actions", className: "text-center" })) } return s({ children: [r({ children: t })] }) } buildColWidths(e) { const t = e.map((e => e.width ? h({ width: e.width }) : h({}))); if (this.options.actionButtons) t.push(h({})); return d({ children: t }) } buildTable() { const e = `table table-striped table-hover ${this.options.isTree ? "treetable light" : ""}`; return n({ className: e, children: [this.buildColWidths(this.options.headers), this.buildHeader(this.options.headers), this.buildBody(this.options.data)] }) } } e.WLTable = WLTable })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { const { tbody: t, tr: n, td: s } = e.DOMUtils; class WLTreeTable extends e.WLTable { constructor(e) { super(Object.assign(Object.assign({}, e), { isTree: true })) } buildBody(e) { const n = this.options.headers.map((e => e.field)); if (this.isLoading) return this.buildBodyLoading(n); let s = []; e.forEach(((e, t) => { s = s.concat(this.buildRowTree(n, e, t)) })); return t({ children: s }) } render() { const e = super.render(); e.addEventListener("click", (e => { const t = e.target; if (t.nodeName === "SPAN" && t.classList.contains("treetoggle")) { const e = t.closest("tr"); const n = e.dataset.id; e.classList.toggle("expand"); e.parentElement.querySelectorAll(`tr[data-parentid='${n}']`).forEach((t => { t.style.display = e.classList.contains("expand") ? "" : "none" })) } })); return e } buildRowTree(e, t, a, r = 0, o = null) { const l = e.map(((e, n) => this.buildCell(e, n, t, r, !!t["children"]))); if (this.options.actionButtons !== null) { l.push(s({ className: "text-end", children: [this.buildActions(t, a)] })) } const c = n({ attr: { "data-id": t[this.options.idField] }, children: l }); if (o) { c.dataset.parentid = o; c.style.display = "none" } if (t["children"]) { let n = []; t["children"].forEach(((s, a) => { n = n.concat(this.buildRowTree(e, s, a, r + 1, t[this.options.idField])) })); return [c].concat(n) } return [c] } } e.WLTreeTable = WLTreeTable })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (e) { var t; (function (e) { var t; (function (e) { let t; (function (e) { e[e["None"] = 0] = "None"; e[e["Up"] = 1] = "Up"; e[e["Down"] = 2] = "Down"; e[e["Neutral"] = 3] = "Neutral" })(t = e.EWorklistSort || (e.EWorklistSort = {})); class WorklistColumn { constructor(n, s, a, r = t.None, o = e.EWorklistFilter.Up, l = true, c) { this.holdDownCounter = 0; this.iconNoneSort = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABEElEQVRYR+2X6w3CMAyEnQ3YBEYok8MIsAkbBLlypCpy/LggBST6M3V7Xy4XNy20+CqL9em3AWqtJ3awlPJCnYQdEPGbCF9RCAjgIH4RgAcRQRBpgE78KQBnIoIgUgCK+CYAdyKCIMIAmnhbd7kHQYQALPGWfhTCBYiIz0CYABlxFGIIoGw1tNeYu0MF+KB4gx5CuBlApx197g/wnQ50TSW6nFYdfzM27YvpbcPWXmcghuL7WcJ6M9Jes83LzUAGIivuOpBpr4h4GIALLSdQ8RTACEJc4rMhH8/MwGl5czPQP6Q4wSWQeNqBQSZ4OD3z9q60AwoED6lNJtI8YIBDJtb8mERmF6mZciAi4NUsB3gDwOK0IU3kR60AAAAASUVORK5CYII="; this.iconDownSort = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACJSURBVHgB7c7hCYAgEAXgJzSIIzSSI7RBtUmb1QaNcN39k/sRYZoE7wNR5PQ9gIios+AvRCTqltDGFkI48ovBT9iAlrDjjLpWH35LSyxSz4IS+nCS9xLesA+kXEINhSUSatIPR13ng2CbGdHCgxLtwl2JvUt4ViK6EnaO+FJW4vtwVyKCiIj+7AI/KbF0ucqMOwAAAABJRU5ErkJggg=="; this.iconUpSort = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAB+SURBVHgB7c7bCYAwEETRWbCQlGBHtmAHYqXagSWsGzAgKKIxD4U5sPhl7gBERH+mqs4fatji03YOJe3iQbkRFmrtFj3yI1rkdBEPlmwjbsTzjbAHO32uQwqR8TQjXsaDHjHsx0HTGWrGL0c0J3FnH7EbkZb4t0VkBhERfckKUPMFADrr/W8AAAAASUVORK5CYII="; this.iconNeutralSort = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAZFJREFUeNq8lbFKxEAQhndz4Ug64RpLSWGtnYXCPYNCXuHAStBGwcr6zhcQvMJSxSYPYVo7kYDXxCbVgQfiGf+BP8dyhHPXRBc+kkxmZnf+2U2UchhlWXYElxjtkNzHZZ+PD1rrD5s43yH5Djg2bPeY5FM1HZQlBo9gQjLaOm0kH4AcpGCbJLQNWN2vk0uyVyaPqybTnvJd37kSWZUhiyTaNVeKe4+2lJXE1pUYmmfUW1br1fh5fPfi1BOWnDOwb+G/Rt+csX7tOeDse+AGhOACPIG5ReFb4BzMGHeFLTyv01xW0XQUZk90pScum2BdtTPewDOq+FL/MlBBF5yBaQsSvTNXd7nJYjhks+T+DkyATZkb4ADIB3AMTms/hpgkAEM2ewQii+oD+uaMjX4K6NGx4DcnXOEbgjF9h4zVLj3JOElknmZJQlvCvi00d2l8yMCikouJNVc64rvrVVXaVFL15JaTREuaB023cM+YJCELzds6J7JTjqj3lLJYrdzlpy9NPOHjJfb57K9OvNNu+RZgAK0Ao82T/br6AAAAAElFTkSuQmCC"; this.Name = n; this.Sort = r; this.Filter = o; this.Width = s; this.Actions = a; this.DisabledSort = l; this.Tooltip = c } Create(n, s) { this.ColumnIndex = s; var a = document.createElement("th"); a.setAttribute("data-sort", this.Sort.toString()); var r; switch (this.Sort) { case t.None: r = this.iconNoneSort; break; case t.Down: r = this.iconDownSort; break; case t.Up: r = this.iconUpSort; break; case t.Neutral: r = this.iconNeutralSort; break }let o = this.Name; if (this.Tooltip) { e.DOMUtils.AppendToolTip(a, this.Tooltip) } if (!this.DisabledSort) a.innerHTML = o + "<span><img src='" + r + "' /><span>"; else a.innerHTML = o; this.Element = a; const l = this; a.addEventListener("mousedown", (() => { if (!l.DisabledSort && !l.holdDownInterval) { l.holdDownCounter = 0; l.holdDownInterval = setInterval((() => { if (l.holdDownCounter < 500) { l.holdDownCounter += 50 } else { l.Actions["holdAction"](); clearInterval(l.holdDownInterval) } }), 50) } }));["mouseout", "mouseup"].forEach((e => { a.addEventListener(e, (() => { clearInterval(l.holdDownInterval); l.holdDownInterval = null })) })); a.addEventListener("click", (function action() { var e; if (l.holdDownCounter < 500) { sessionStorage.setItem("sortColIndex", (e = l.ColumnIndex) === null || e === void 0 ? void 0 : e.toString()); if (!l.DisabledSort) { const e = l.Element.innerHTML.indexOf(l.iconUpSort) > -1 ? l.iconDownSort : l.iconUpSort; l.Sort = l.Element.innerHTML.indexOf(l.iconUpSort) > -1 ? t.Down : t.Up; if (l.Actions["sortAction"]()) l.Element.innerHTML = l.Name + "<span><img src='" + e + "' /><span>"; this.removeEventListener("click", action) } } })); n.appendChild(a) } SetDefaultSortIcon() { const e = /\>([\s\S]+)\</; const t = e.exec(this.Name); let n = this.Name; if (t) { n = n.replace(t[0], "") } if (!this.DisabledSort) this.Element.innerHTML = n + "<span><img src='" + this.iconNoneSort + "' /><span>"; else this.Element.innerHTML = n } SetSortIcon() { var e; switch (this.Sort) { case t.None: e = this.iconNoneSort; break; case t.Down: e = this.iconDownSort; break; case t.Up: e = this.iconUpSort; break; case t.Neutral: e = this.iconNeutralSort; break }if (!this.DisabledSort) this.Element.innerHTML = this.Name + "<span><img src='" + e + "' /><span>"; else this.Element.innerHTML = this.Name } } e.WorklistColumn = WorklistColumn })(t = e.WebClient || (e.WebClient = {})) })(t = e.Frontend || (e.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { let EWorklistFilter; (function (e) { e[e["Up"] = 0] = "Up"; e[e["Down"] = 1] = "Down" })(EWorklistFilter = WebClient.EWorklistFilter || (WebClient.EWorklistFilter = {})); class WorklistGrid { constructor(e) { this.tagClassname = "tagRow"; this.selectedRows = Array(); this.Columns = e; document.documentElement.addEventListener("keydown", (e => { if (e.shiftKey && e.key === "ArrowUp") this.SelectItemsRowsWithShiftKeyRows(EWorklistFilter.Up); else if (e.shiftKey && e.key === "ArrowDown") this.SelectItemsRowsWithShiftKeyRows(EWorklistFilter.Down) })) } TriggerTagEvent(e) { this.ReferenceView = e } GetRowsPerSelectedEntities() { const e = new Array; for (let t = 0; t < this.SelectedEntities.length; t++) { const n = this.SelectedEntities[t]; for (let t = 0; t < this.Rows.length; t++) { if (this.Rows[t].EntityItem.id === n.id) { e.push(this.Rows[t]); t = this.Rows.length } } } return e } SelectItemsRowsWithShiftKeyRows(e) { var t; if (!this.Rows && !((t = this.SelectedEntities) === null || t === void 0 ? void 0 : t.length)) return; const n = this.GetRowsPerSelectedEntities(); if (n.length) { const t = n[0]; const r = t.Element; const o = n[n.length - 1]; const l = o.Element; const c = r.getAttribute("data-entityID"); switch (e) { case EWorklistFilter.Up: const e = this.GetRowOrItemList(l, true); if (!e) return; if (e && !WebClient.DOMUtils.HasClass(e, WebClient.WorklistRow.SELECTED_CLASSNAME)) { WebClient.DOMUtils.AddClass(e, WebClient.WorklistRow.SELECTED_CLASSNAME); if (e.previousSibling && WebClient.DOMUtils.HasClass(e.previousSibling, "tagRow")) WebClient.DOMUtils.AddClass(e.previousSibling, WebClient.WorklistRow.SELECTED_CLASSNAME); var s = this.GetEntityForEntityUidOrId(e.getAttribute("data-entityID"), false); this.SelectedEntities.push(s) } else if (l.getAttribute("data-entityID") !== c) { WebClient.DOMUtils.RemoveClass(l, WebClient.WorklistRow.SELECTED_CLASSNAME); if (l.previousSibling) WebClient.DOMUtils.RemoveClass(l.previousSibling, WebClient.WorklistRow.SELECTED_CLASSNAME); this.SelectedEntities.splice(this.SelectedEntities.length - 1, 1) } break; case EWorklistFilter.Down: const t = this.GetRowOrItemList(l, false); if (!t) return; if (t && !WebClient.DOMUtils.HasClass(t, WebClient.WorklistRow.SELECTED_CLASSNAME)) { WebClient.DOMUtils.AddClass(t, WebClient.WorklistRow.SELECTED_CLASSNAME); if (t.previousSibling) WebClient.DOMUtils.AddClass(t.previousSibling, WebClient.WorklistRow.SELECTED_CLASSNAME); var a = this.GetEntityForEntityUidOrId(t.getAttribute("data-entityID"), false); this.SelectedEntities.push(a) } else if (l.getAttribute("data-entityID") !== c) { WebClient.DOMUtils.RemoveClass(l, WebClient.WorklistRow.SELECTED_CLASSNAME); if (l.previousSibling) WebClient.DOMUtils.RemoveClass(l.previousSibling, WebClient.WorklistRow.SELECTED_CLASSNAME); this.SelectedEntities.splice(this.SelectedEntities.length - 1, 1) } break }if (t.WorklistItem.TriggerSelection) t.WorklistItem.TriggerSelection(); if (this.HighligthActionMenu) this.HighligthActionMenu() } } GetRowOrItemList(e, t) { if (e) { var n = t ? e.previousElementSibling : e.nextElementSibling; return !!(n === null || n === void 0 ? void 0 : n.getAttribute("data-entityID")) ? n : this.GetRowOrItemList(n, t) } return null } GetEntityForEntityUidOrId(e, t) { let n; const s = this.Rows; for (let a = 0; a < s.length; a++) { const r = s[a].EntityItem["identifier"] ? s[a].EntityItem["identifier"][0]["value"] : ""; if (t && WebClient.Utils.GetUidFromIdentifier(r) === e || !t && s[a].Element.getAttribute("data-entityID") === e) { n = s[a].EntityItem; n["rowClass"] = s[a]; break } } return n } CreateHead(e) { const t = document.createElement("tr"); this.Columns.forEach(((e, n) => { e.Create(t, n) })); e.appendChild(t) } CreateBody(parentGrid, parentList, actionCreateGrid, actionCreateList) { this.SelectedEntities = undefined; let avoidSelect; try { avoidSelect = eval("this.Controller.FormViewController.FormView.TabForm") } catch (e) { avoidSelect = false } this.Rows.forEach((e => { e.CreateGridElement(parentGrid, actionCreateGrid, avoidSelect); e.CreateListElement(parentList, actionCreateList) })) } UnSelectRows() { var e; if ((e = this.SelectedEntities) === null || e === void 0 ? void 0 : e.length) { this.SelectedEntities.forEach((e => { WebClient.DOMUtils.RemoveClass(e.Element, WebClient.WorklistRow.SELECTED_CLASSNAME); if (e.Element.previousElementSibling) { if (WebClient.DOMUtils.HasClass(e.Element.previousElementSibling, this.tagClassname)) { WebClient.DOMUtils.RemoveClass(e.Element.previousElementSibling, WebClient.WorklistRow.SELECTED_CLASSNAME) } } })); const e = this.GetRowsPerSelectedEntities(); e.forEach((e => { WebClient.DOMUtils.RemoveClass(e.Element, WebClient.WorklistRow.SELECTED_CLASSNAME); if (e.Element.previousElementSibling) { if (WebClient.DOMUtils.HasClass(e.Element.previousElementSibling, this.tagClassname)) WebClient.DOMUtils.RemoveClass(e.Element.previousElementSibling, WebClient.WorklistRow.SELECTED_CLASSNAME) } })) } } GetSelectedRows() { return this.selectedRows } GetParent() { return null } } WebClient.WorklistGrid = WorklistGrid })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {})); var Efferent; (function (Efferent) { var Frontend; (function (Frontend) { var WebClient; (function (WebClient) { let ECellType; (function (e) { e[e["Button"] = 0] = "Button"; e[e["Icon"] = 1] = "Icon"; e[e["Text"] = 2] = "Text"; e[e["Checkbox"] = 3] = "Checkbox" })(ECellType = WebClient.ECellType || (WebClient.ECellType = {})); let RowActionMode; (function (e) { e[e["Add"] = 1] = "Add"; e[e["Remove"] = 2] = "Remove"; e[e["Clear"] = 3] = "Clear" })(RowActionMode = WebClient.RowActionMode || (WebClient.RowActionMode = {})); let RowElementType; (function (e) { e[e["GridElement"] = 1] = "GridElement"; e[e["ListElement"] = 2] = "ListElement" })(RowElementType = WebClient.RowElementType || (WebClient.RowElementType = {})); class ItemCell { constructor(e = "", t = ECellType.Text, n = "", s = null) { this.Value = e; this.Type = t; this.Classes = n; this.EventClick = s } } WebClient.ItemCell = ItemCell; const { div: div, table: table, tr: tr, td: td, span: span, li: li, textNode: textNode } = WebClient.DOMUtils; class WorklistRow { constructor(e, t, n, s, a) { this.tagClassname = "tagRow"; this.EntityItem = e; this.Rows = t; this.EventClick = n; this.EventDoubleClick = s; this.WorklistItem = a } CreateGridElement(e, t, n) { this.parentElement = e; this.elementType = RowElementType.GridElement; this.rightClicked = false; const s = tr({ className: "handCursor WorklistGridTr" }); this.Element = this.elementTableTr = s; s.addEventListener("contextmenu", (e => { this.contextMenuHandler(e, s) })); if (WebClient.DOMUtils.IsIOS()) { let e = 0; let t; s.addEventListener("click", (n => { e++; if (e === 1) { this.SelectAction(s, n, this, false); t = setTimeout((() => { e = 0 }), 300) } else if (e === 2) { clearTimeout(t); e = 0; this.EventDoubleClick(n) } }), false) } else { let e = 0; let t; s.addEventListener("pointerdown", (a => { if (!n) { a.preventDefault(); this.SelectAction(s, a, this, false) } if (a.button === 0) { e++; if (e === 2) { const e = s.rowIndex; this.CleanSelected(); this.SelectItems(this, s, e, undefined, false); this.EventDoubleClick(a) } t = setTimeout((() => { clearTimeout(t); e = 0 }), 300) } })) } if (!document.body.getAttribute("has-contextmenu-listener")) { document.body.setAttribute("has-contextmenu-listener", "true"); document.addEventListener("contextmenu", (e => { e.preventDefault(); e.stopPropagation() })) } if (!document.body.hasAttribute("has-context-clickout-listener")) { document.body.setAttribute("has-context-clickout-listener", "true"); document.addEventListener("click", (() => { this.contextMenuRef = document.getElementsByClassName("contextMenuBox")[0]; if (WebClient.DOMUtils.IsDisplay(this.contextMenuRef)) this.contextMenuRef.style.display = "none" })) } this.Rows.forEach((e => { const t = td({}); const n = div({ className: "contentDiv" }); switch (e.Type) { case ECellType.Text: const a = /\>([\s\S]+)\</; const r = a.exec(e.Value); if (r) { WebClient.DOMUtils.AppendToolTip(t, r[1]); e.Value = e.Value.replace(r[0], "") } n.appendChild(textNode(e.Value)); break; case ECellType.Checkbox: const o = "check_" + Math.random(); const l = WebClient.DOMUtils.input({ id: o, type: "checkbox", onchange: () => { e.Value["Action"](l.checked) } }); const c = WebClient.DOMUtils.label({ style: { height: "100%" }, attr: { for: o } }); if (e.Value["Value"] === e.Value["Checked"]) l.checked = true; else if (e.Value["Value"] === e.Value["Unchecked"]) l.checked = false; else l.indeterminate = true; n.appendChild(l); n.appendChild(c); break; case ECellType.Icon: const d = span({ style: { display: "block", cursor: "pointer", width: "max-content" } }); if (e.ResourceImg) { const t = new Image; t.src = e.ResourceImg; d.appendChild(t) } else { d.innerHTML = "&nbsp;" } WebClient.DOMUtils.AddClass(d, e.Classes); d.addEventListener("pointerdown", (t => { t.preventDefault(); t.stopPropagation(); if (!WebClient.DOMUtils.HasClass(s, WorklistRow.SELECTED_CLASSNAME)) this.SelectAction(s, t, this, false); if (e.EventClick) e.EventClick() })); n.appendChild(d); break; case ECellType.Button: break }t.appendChild(n); s.appendChild(t); try { if (this.EntityItem.hasOwnProperty("identifier") && this.EntityItem["identifier"].length > 0) s.setAttribute("data-entityUID", WebClient.Utils.GetUidFromIdentifier(this.EntityItem["identifier"][0]["value"])); if (this.EntityItem["id"]) s.setAttribute("data-entityID", this.EntityItem["id"]) } catch (e) { WebClient.Utils.DebugConsoleLog("CreateGridElement => identifier or id property no exist on entity") } })); e.appendChild(s); try { t(this, this.Rows.length) } catch (e) { WebClient.Utils.DebugConsoleLog(e) } if (this.WorklistItem.ReferenceView && this.EntityItem["id"] === this.WorklistItem.ReferenceView["LastResourceId"]) { this.SelectAction(s, null, this, false); const e = this.WorklistItem["WorklistPane"]; const t = document.documentElement.clientHeight - e.offsetTop - 50; e.style.height = t + "px"; e.scrollTo(0, e.scrollHeight) } } CreateListElement(e, t) { var n, s, a; this.parentElement = e; this.elementType = RowElementType.ListElement; const r = li({ className: "WorklistListLi" }); r.addEventListener("contextmenu", (e => { this.contextMenuHandler(e, r) })); const o = table({}); if (WebClient.DOMUtils.IsIOS()) { let e = 0; let t; r.addEventListener("click", (n => { e++; if (e === 1) { this.SelectAction(r, n, this, false); t = setTimeout((() => { e = 0 }), 300) } else if (e === 2) { clearTimeout(t); e = 0; this.EventDoubleClick(n) } }), false) } else { let e = 0; let t; r.addEventListener("pointerdown", (n => { n.preventDefault(); this.SelectAction(r, n, this, false); if (n.button === 0) { e++; if (e === 2) { const e = Array.from(r.parentElement.children).indexOf(r) + 1; this.CleanSelected(); this.SelectItems(this, r, e, undefined, false); this.EventDoubleClick(n) } t = setTimeout((() => { clearTimeout(t); e = 0 }), 250) } })) } const l = this.Rows; const c = []; const d = []; this.WorklistItem.Columns.forEach(((e, n) => { var s; const a = e.Name; const r = tr({}); let h; let u; let f; if (d.indexOf(n - 1) !== -1) { f = tr({ className: "joinedTr" }) } if (d.indexOf(n) !== -1) { c[n] = []; c[n][0] = a } else if (d.indexOf(n - 1) !== -1) { if (!c[n - 1]) c[n - 1] = []; c[n - 1][0] += " / " + a + ":" } if (d.indexOf(n - 1) !== -1) { h = td({ innerHTML: c[n - 1][0] }); u = td({}) } const p = td({ innerHTML: `${a}:` }); const m = td({}); switch (l[n].Type) { case ECellType.Text: if ((s = l[n].Value) === null || s === void 0 ? void 0 : s.length) { m.innerHTML = `<div class="inline">${l[n].Value}</div>`; WebClient.DOMUtils.AddClass(m, "tdTag") } else { m.innerHTML = l[n].Value } break; case ECellType.Icon: const e = span({ innerHTML: "&nbsp;", className: l[n].Classes }); e.addEventListener("pointerdown", (e => { e.preventDefault(); e.stopPropagation(); if (l[n].EventClick) l[n].EventClick() })); m.appendChild(e); break; case ECellType.Button: break }if (d.indexOf(n) !== -1) { c[n][1] = l[n].Value } else if (d.indexOf(n - 1) !== -1) { if (l[n].Value) c[n - 1][1] += " / " + l[n].Value; u.innerHTML = c[n - 1][1] } if (n === 0) { try { t(this, r, p, m, n) } catch (e) { WebClient.Utils.DebugConsoleLog(e) } } if (d.indexOf(n - 1) !== -1) { f.appendChild(h); f.appendChild(u) } r.appendChild(p); r.appendChild(m); o.appendChild(r); if (d.indexOf(n - 1) !== -1) o.appendChild(f) })); r.appendChild(o); try { if (this.EntityItem.hasOwnProperty("identifier") && this.EntityItem["identifier"]) { if (this.EntityItem["identifier"].length) { const e = WebClient.Utils.GetUidFromIdentifier(this.EntityItem["identifier"][0]["value"]); r.setAttribute("data-entityUID", e) } } if (this.EntityItem.hasOwnProperty("id") && this.EntityItem["id"]) r.setAttribute("data-entityID", this.EntityItem["id"]) } catch (e) { WebClient.Utils.DebugConsoleLog("CreateGridElement => identifier or id property no exist on entity") } this.elementListLi = r; e.appendChild(r); if (this.WorklistItem.ReferenceView && this.EntityItem["id"] === this.WorklistItem.ReferenceView["LastResourceId"]) { if (((n = this.elementListLi) === null || n === void 0 ? void 0 : n.children) && ((s = this.elementListLi) === null || s === void 0 ? void 0 : s.children[0]) && ((a = this.elementListLi) === null || a === void 0 ? void 0 : a.children[0].classList)) this.elementListLi.children[0].classList.add(WorklistRow.SELECTED_CLASSNAME) } } SelectAction(e, t, n, s) { let a; let r; const o = n.WorklistItem.SelectedEntities; const l = e.tagName.toLowerCase(); if (l === "tr") { this.Element = this.elementTableTr; r = e.rowIndex; a = e.rowIndex; if (e.classList.contains(WorklistRow.SELECTED_CLASSNAME) && this.rightClicked) { this.rightClicked = false; return } } else if (l === "li") { this.Element = this.elementListLi; r = n.GetElementChildIndex(e); a = n.GetElementChildIndex(e) } if (t === null || t === void 0 ? void 0 : t.shiftKey) { let t = "shift"; const s = (o === null || o === void 0 ? void 0 : o.length) > 0; if (s) { if (o.length === 1) { const s = this.GetSelectedRows(); if (s.length) { const o = n.GetElementChildIndex(s[0].Element); const l = r; let c; if (o > l) { c = o; a = l } else if (o < l) { c = l; a = o } n.SelectRows(this, e, a, c, t) } } else if (n.areSelectedRowsConsecutive(e, this.WorklistItem)) { const s = n.getSelectedRowsRange(e, this.WorklistItem); if (s[0] > 0) { const a = r - s[0]; const o = r - s[1]; if (a < o) { n.SelectRows(this, e, r, s[0], t) } else if (a > o) { n.SelectRows(this, e, s[0], r, t) } else { } } else { } } else { n.SelectRows(this, e, r, undefined, t) } } } else if (t && (t.ctrlKey || t.metaKey)) { let t = "ctrl"; n.SelectRows(this, e, r, true, t) } else { const t = ""; if ((o === null || o === void 0 ? void 0 : o.length) === 1) { const s = n.EntityItem; const r = n.WorklistItem.SelectedEntities[0]; if (s === r) n.SelectRows(this, e, -1, undefined, t); else n.SelectRows(this, e, a, undefined, t) } else if ((o === null || o === void 0 ? void 0 : o.length) > 1) { this.CleanSelected(); n.SelectRows(this, e, a, undefined, t) } else { n.SelectRows(this, e, a, undefined, t) } this.EventClick() } if (typeof this.WorklistItem.TriggerSelection === "function") this.WorklistItem.TriggerSelection() } GetSelectedRows() { const e = new Array; const t = WebClient.DOMUtils.IsDisplay(this.parentElement); this.WorklistItem.Rows.forEach((n => { if (t) { if (WebClient.DOMUtils.HasClass(n.Element.children[0], WorklistRow.SELECTED_CLASSNAME)) e.push(n) } else { if (WebClient.DOMUtils.HasClass(n.Element, WorklistRow.SELECTED_CLASSNAME)) e.push(n) } })); return e } GetElementChildIndex(e) { const t = e.parentNode; const n = t.children; let s = n.length - 1; for (; s >= 0; s--) { if (e === n[s]) break } return s + 1 } CleanSelected() { this.WorklistItem.SelectedEntities = undefined; this.WorklistItem.Rows.forEach((e => { let t = e.elementTableTr; if (t) { WebClient.DOMUtils.RemoveClass(t, WorklistRow.SELECTED_CLASSNAME); const e = t.previousSibling; if (e && WebClient.DOMUtils.HasClass(e, this.tagClassname)) WebClient.DOMUtils.RemoveClass(e, WorklistRow.SELECTED_CLASSNAME) } })); this.WorklistItem.Rows.forEach((e => { let t = e.elementListLi; if (t) { WebClient.DOMUtils.RemoveClass(t.children[0], WorklistRow.SELECTED_CLASSNAME) } })); const e = this.parentElement.getElementsByClassName(WorklistRow.SELECTED_CLASSNAME); for (let t = 0; t < e.length; t++) { WebClient.DOMUtils.RemoveClass(e[t], WorklistRow.SELECTED_CLASSNAME) } } IncludeArrayCheck(e, t) { if (!e || !e.length) return false; else return e.some((e => e.EntityItem === t.EntityItem)) } SelectItems(e, t, n, s, a) { let r; if (n === false) { const e = document.getElementsByClassName(WorklistRow.SELECTED_CLASSNAME); for (let t = 0; t < e.length; t++) { const n = e[t]; WebClient.DOMUtils.RemoveClass(n, WorklistRow.SELECTED_CLASSNAME) } this.WorklistItem.SelectedEntities = undefined; if (this.WorklistItem.HighligthActionMenu) this.WorklistItem.HighligthActionMenu() } else if (typeof n === "number" && s === undefined) { if (a === false) this.CleanSelected(); if (e.Element.nodeName.toLowerCase() === "tr") { this.WorklistItem.Rows.some((e => { if (WebClient.DOMUtils.IsDisplay(e.elementTableTr.parentElement.parentElement)) r = e.elementTableTr; else if (WebClient.DOMUtils.IsDisplay(e.elementListLi.parentElement)) r = e.elementListLi; if (r.rowIndex === t["rowIndex"]) { if (this.IncludeArrayCheck(this.WorklistItem.SelectedEntities, e.EntityItem)) this.SelectRow(e, t, a, RowActionMode.Remove, false); else this.SelectRow(e, t, a, RowActionMode.Add); return r.rowIndex === t["rowIndex"] } })) } else if (e.Element.nodeName.toLowerCase() === "li") { this.WorklistItem.Rows.some(((e, s, r) => { if (s === n - 1) { if (this.IncludeArrayCheck(this.WorklistItem.SelectedEntities, e.EntityItem)) this.SelectRow(e, t, a, RowActionMode.Remove, false); else this.SelectRow(e, t, a, RowActionMode.Add); return s === n } })) } } else if (typeof n === "number" && s === true) { this.WorklistItem.Rows.forEach((e => { if (WebClient.DOMUtils.IsDisplay(e.elementTableTr.parentElement.parentElement)) r = e.elementTableTr; else if (WebClient.DOMUtils.IsDisplay(e.elementListLi.parentElement)) r = e.elementListLi; if (r.rowIndex === t["rowIndex"]) { let n = false; this.WorklistItem.SelectedEntities.forEach((e => { if (e.Element.rowIndex === r.rowIndex) n = true })); if (n) this.SelectRow(e, t, a, RowActionMode.Remove, false); else this.SelectRow(e, t, a, RowActionMode.Add) } })) } else { this.WorklistItem.Rows.forEach((e => { if (WebClient.DOMUtils.IsDisplay(e.elementTableTr.parentElement.parentElement)) r = e.elementTableTr; else if (WebClient.DOMUtils.IsDisplay(e.elementListLi.parentElement)) r = e.elementListLi; const o = r.rowIndex; if (o >= n && o <= s) this.SelectRow(e, t, a, RowActionMode.Add) })) } } ExistEntityInSelectedEntities(e) { return this.WorklistItem.SelectedEntities.some((t => e.id === t.id)) } SelectRow(e, t, n, s, a = true) { const r = e.EntityItem; const o = new Array; const l = this.WorklistItem.SelectedEntities || []; switch (s) { case RowActionMode.Add: if (!l.length) this.WorklistItem.SelectedEntities = []; if (!this.ExistEntityInSelectedEntities(r)) { r["rowClass"] = e; this.WorklistItem.SelectedEntities.push(r) } break; case RowActionMode.Remove: this.WorklistItem.SelectedEntities.forEach((e => { if (r !== e) o.push(r) })); break; case RowActionMode.Clear: break }if (n === "ctrl" && !a) { this.UpdatedItemsRowsClass(e, o, a); const t = this.WorklistItem.SelectedEntities.indexOf(r); this.WorklistItem.SelectedEntities.splice(t, 1) } else { this.UpdatedItemsRowsClass(e, e.WorklistItem.SelectedEntities, a) } if (this.WorklistItem.HighligthActionMenu) { this.WorklistItem.HighligthActionMenu() } } UpdatedItemsRowsClass(e, t, n) { let s; if (t && t.length) { t.forEach((t => { e.WorklistItem.Rows.some((e => { s = e.elementListLi; if (s) { if (e.EntityItem === t) { if (n) WebClient.DOMUtils.AddClass(s.firstChild, WorklistRow.SELECTED_CLASSNAME); else WebClient.DOMUtils.RemoveClass(s.firstChild, WorklistRow.SELECTED_CLASSNAME) } return e.EntityItem === t } })); e.WorklistItem.Rows.some((e => { s = e.elementTableTr; if (s) { if (e.EntityItem === t) { const e = s.nextElementSibling; const t = s.previousElementSibling; switch (n) { case true: if (WebClient.DOMUtils.HasClass(s, this.tagClassname)) WebClient.DOMUtils.AddClass(e, WorklistRow.SELECTED_CLASSNAME); else { if (t && WebClient.DOMUtils.HasClass(t, this.tagClassname)) WebClient.DOMUtils.AddClass(t, WorklistRow.SELECTED_CLASSNAME) } WebClient.DOMUtils.AddClass(s, WorklistRow.SELECTED_CLASSNAME); break; case false: if (WebClient.DOMUtils.HasClass(s, this.tagClassname)) WebClient.DOMUtils.RemoveClass(e, WorklistRow.SELECTED_CLASSNAME); else { if (s.previousElementSibling && WebClient.DOMUtils.HasClass(s.previousElementSibling, this.tagClassname)) WebClient.DOMUtils.RemoveClass(s.previousElementSibling, WorklistRow.SELECTED_CLASSNAME) } WebClient.DOMUtils.RemoveClass(s, WorklistRow.SELECTED_CLASSNAME); break } } return e.EntityItem === t } })) })) } } SelectRows(e, t, n, s, a) { let r; const o = this.WorklistItem.Rows; if (n === -1) { o.forEach((e => { this.SelectRow(e, t, a, RowActionMode.Remove, false) })); this.WorklistItem.SelectedEntities = undefined; if (this.WorklistItem.HighligthActionMenu) this.WorklistItem.HighligthActionMenu() } else if (n > -1 && s === undefined) { o.some((n => { var s; if (e.EntityItem === n.EntityItem) { const r = ((s = this.WorklistItem.SelectedEntities) === null || s === void 0 ? void 0 : s.some((e => e === n.EntityItem))) || false; if (r) { this.CleanSelected() } else { this.CleanSelected(); this.SelectRow(n, t, a, RowActionMode.Add) } return e.EntityItem === n.EntityItem } })) } else if (n > -1 && s === true) { o.forEach(((e, s) => { if (WebClient.DOMUtils.IsDisplay(e.elementTableTr.parentElement.parentElement)) { r = e.elementTableTr; if (r.rowIndex === n) { const n = this.WorklistItem.SelectedEntities.some((t => t.id === e.EntityItem.id)); if (n) this.SelectRow(e, t, a, RowActionMode.Remove, false); else this.SelectRow(e, t, a, RowActionMode.Add) } } else if (WebClient.DOMUtils.IsDisplay(e.elementListLi.parentElement)) { r = e.elementListLi; if (s + 1 === n) { const n = this.WorklistItem.SelectedEntities.some((t => t.id === e.EntityItem.id)); if (n) this.SelectRow(e, t, a, RowActionMode.Remove, false); else this.SelectRow(e, t, a, RowActionMode.Add) } } })) } else { if (n > s) { [n, s] = [s, n] } const e = WebClient.DOMUtils.IsDisplay(this.parentElement); if (e) { o.forEach(((e, r) => { const o = r + 1; if (o >= n && o <= s) this.SelectRow(e, t, a, RowActionMode.Add) })) } else { o.forEach((e => { r = e.elementTableTr; const o = r.rowIndex; if (o >= n && o <= s) this.SelectRow(e, t, a, RowActionMode.Add) })) } } } getSelectedRowsRange(e, t) { const n = []; let s; t.Rows.forEach(((e, t) => { if (WebClient.DOMUtils.IsDisplay(e.elementTableTr.parentElement.parentElement)) { s = e.elementTableTr; if (WebClient.DOMUtils.HasClass(s, WorklistRow.SELECTED_CLASSNAME)) n.push(s.rowIndex) } else if (WebClient.DOMUtils.IsDisplay(e.elementListLi.parentElement)) { s = e.elementListLi.children[0]; if (WebClient.DOMUtils.HasClass(s, WorklistRow.SELECTED_CLASSNAME)) n.push(t + 1) } })); if (n.length) { const e = Math.min.apply(null, n); const t = Math.max.apply(null, n); return [e, t] } else { return [0, 0] } } areSelectedRowsConsecutive(e, t) { const n = []; let s; const a = e.tagName.toLowerCase(); t.Rows.forEach(((e, t) => { switch (a) { case "tr": s = e.elementTableTr; break; case "li": s = e.elementListLi.children[0]; break }if (WebClient.DOMUtils.HasClass(s, WorklistRow.SELECTED_CLASSNAME)) n.push(t) })); if (n.length) { const e = Math.min.apply(null, n); const t = Math.max.apply(null, n); return t - e === n.length - 1 } return false } unHoverRows() { document.querySelectorAll(".workListTable tbody tr").forEach((e => { e.classList.remove(WorklistRow.HOVER_CLASSNAME) })) } contextMenuHandler(evt, item) { var _a; this.rightClicked = true; if (this.WorklistItem.ReferenceView.SpecView.hasOwnProperty("Actions")) { const showOnContextButtons = []; const viewActions = this.WorklistItem.ReferenceView.SpecView.Actions; for (let e = 0; e < viewActions.length; e++) { const t = viewActions[e]; if (t.Type === "ResourceAction") { if (t.hasOwnProperty("ShowOnContext")) { showOnContextButtons.push(t) } } else if (t.Type === "ActionGroup") { const e = t.Actions; for (let t = 0; t < e.length; t++) { const n = e[t]; if (n.hasOwnProperty("ShowOnContext")) { showOnContextButtons.push(n) } } } } if (showOnContextButtons.length > 0) { if (((_a = this.WorklistItem.SelectedEntities) === null || _a === void 0 ? void 0 : _a.length) > 0) { const platform = eval("window.platform"); this.contextMenuRef = document.querySelector(".contextMenuBox"); if (!this.contextMenuRef) { this.contextMenuRef = WebClient.DOMUtils.div({ className: "contextMenuBox" }); this.WorklistItem.GetParent().appendChild(this.contextMenuRef); for (let e = 0; e < showOnContextButtons.length; e++) { const setButtonReferenceAction = () => { const t = showOnContextButtons[e]; const n = WebClient.DOMUtils.anchor({ className: "contextMenuAction", innerText: platform.LanguageManager.GetValuesFromDict("SpecDictionary", t.Label) }); const s = platform.Toolbar.CheckApplicationTags(t.Label); if (!s) this.contextMenuRef.appendChild(n); const a = platform.Toolbar.GetButton(t.Label); n.addEventListener("pointerdown", (e => { if (a.hasOwnProperty("Action")) a.Action(e, [t]); else if (a.hasOwnProperty("ActionFunction")) a.ActionFunction(e, [t]) })) }; setButtonReferenceAction() } } this.contextMenuRef.style.left = `${evt.pageX}px`; this.contextMenuRef.style.display = "block"; const boxHeight = this.contextMenuRef.clientHeight; const contextMenuTopPosition = boxHeight + evt.pageY <= innerHeight ? evt.pageY : evt.pageY - boxHeight; this.contextMenuRef.style.top = `${contextMenuTopPosition}px` } } } } } WorklistRow.SELECTED_CLASSNAME = "selectable"; WorklistRow.HOVER_CLASSNAME = "hover"; WebClient.WorklistRow = WorklistRow })(WebClient = Frontend.WebClient || (Frontend.WebClient = {})) })(Frontend = Efferent.Frontend || (Efferent.Frontend = {})) })(Efferent || (Efferent = {}));