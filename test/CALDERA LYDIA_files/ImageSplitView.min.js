var Efferent;(function(e){var t;(function(t){var i;(function(t){var i=e.Frontend.WebClient.HttpUtils;var a=e.Frontend.WebClient.Utils;var r=e.Frontend.WebClient;var s=e.Frontend.FhirClient;class ImageSplitView extends r.SubView{constructor(e,i,a,r){super(e,i,"ImageSplitLanguage");this.ViewName="ImageSplitView";this.Platform=i;this.parent=this.BodySection;this.Studies=r;this.viewMode=parseInt(a.ViewMode);this.ResourceBag=t.ResourceBag;switch(this.viewMode){case 0:this.startAsSplit();break;case 1:this.startAsMerge();break;default:super.CloseSubView();break}}MoveImageToSeries(e,i){var a;var r=0;for(const t in e.ThumbnailImages){if(e.ThumbnailImages.hasOwnProperty(t)){const i=e.ThumbnailImages[t];i.forEach(((e,t)=>{if(e.Selected){a=e;r=t;return}}))}}if(a!==undefined&&a!==null){if(i.ThumbnailImages[a.SerieGuid]===undefined)i.ThumbnailImages[a.SerieGuid]=new Array;a.Selected=false;i.ThumbnailImages[a.SerieGuid].push(a);e.ThumbnailImages[a.SerieGuid].splice(r,1);e.UpdateRenderSerieContainer(t.EOperationThumbnail.Remove,a);i.UpdateRenderSerieContainer(t.EOperationThumbnail.Add,i.ThumbnailImages[a.SerieGuid][i.ThumbnailImages[a.SerieGuid].length-1])}}UnSelectAllThumbnails(e){for(const t in this.panelStudyA.ThumbnailImages){if(this.panelStudyA.ThumbnailImages.hasOwnProperty(t)){const i=this.panelStudyA.ThumbnailImages[t];i.forEach((t=>{if(t.ImageGuid!==e)t.SetSelected(false)}))}}for(const t in this.panelStudyB.ThumbnailImages){if(this.panelStudyB.ThumbnailImages.hasOwnProperty(t)){const i=this.panelStudyB.ThumbnailImages[t];i.forEach((t=>{if(t.ImageGuid!==e)t.SetSelected(false)}))}}}IsImagePanelSelected(e){var t=false;for(const i in e.ThumbnailImages){if(e.ThumbnailImages.hasOwnProperty(i)){const a=e.ThumbnailImages[i];a.forEach((e=>{if(e.Selected){t=true;return true}}))}}return t}Dispose(){this.stopWorker()}Refresh(){}OnWindowResize(e,t,i){super.OnWindowResize(e,t,i);var a=document.documentElement.clientHeight-this.Platform.ToolbarSectionHeight()-this.Platform.GetActiveMessageHeight();var r=a-30;this.outContainer.style.height=r+"px";if(this.viewMode===0){this.panelStudyA.Element.style.width=this.outContainer.clientWidth/2+"px";this.panelStudyB.Element.style.width=this.outContainer.clientWidth/2+"px";this.containerSplitPanels.style.height=this.outContainer.clientHeight-40+"px"}else if(this.viewMode===1){this.containerMergePanels.style.height=r+"px"}}startAsMerge(){this.StudiesReferences=new Array;if(this.Studies!==null&&this.Studies!==undefined&&this.Studies.length===2){if(this.Platform.CurrentView.ViewName.match("sharedWorklist")){r.Toaster.ShowToast("Select a study from general worklist",r.Colors.BelizeHole,3);this.CloseSubView();return}try{var i=false;this.Studies.forEach((e=>{if(e.meta.tag!==undefined){e.meta.tag.forEach((e=>{if(e["code"]==="CASE"){if(!i){i=true;r.Toaster.ShowToast("Select a non CASE study from general worklist",r.Colors.BelizeHole,3)}this.CloseSubView()}}))}}));if(i)return}catch(e){}if(this.Studies!==null&&this.Studies!==undefined&&this.Studies.length===2){this.Platform.LanguageManager.AddDictionary("{Efferent.ClientViews.ImageSplitView.ResourceBag.ImageSplitLanguageJson}","ImageSplitLanguage",e.ClientViews.ImageSplitView.ResourceBag.ImageSplitLanguageJson[this.Platform.LanguageManager.CurrentLanguage]);this.outContainer=document.createElement("div");this.outContainer.classList.add("imageMergeViewOutContainer");this.parent.appendChild(this.outContainer);this.containerMergePanels=document.createElement("div");this.containerMergePanels.className="ContainerMergePanels";var a=document.createElement("div");a.className="PanelMergeStudy";var s=document.createElement("div");s.className="PanelMergeStudy";this.useThisDataA=document.createElement("button");this.useThisDataA.classList.add("blue");this.useThisDataA.innerText="Use this data";this.useThisDataA.style.display="none";var n=document.createElement("div");n.className="TitleMergeStudy";n.style.backgroundColor=r.Colors.Nephritis;var o=document.createElement("span");o.innerText="This study data will be used.";n.appendChild(o);var d=document.createElement("div");d.className="FormMergeStudy";n.appendChild(this.useThisDataA);a.appendChild(n);a.appendChild(d);this.useThisDataB=document.createElement("button");this.useThisDataB.classList.add("blue");this.useThisDataB.innerText="Use this data";var l=document.createElement("div");l.className="TitleMergeStudy";l.style.backgroundColor=r.Colors.Alizarin;var u=document.createElement("span");u.innerText="This study data will be discarded.";l.appendChild(u);var h=document.createElement("div");h.className="FormMergeStudy";l.appendChild(this.useThisDataB);this.useThisDataA.addEventListener("click",(()=>{this.useThisDataA.style.display="none";this.useThisDataB.style.display="block";l.style.backgroundColor=r.Colors.Alizarin;u.innerText="This study data will be discarded.";n.style.backgroundColor=r.Colors.Nephritis;o.innerText="This study data will be used.";this.studyDataToKeep=this.fhirStudyA}));this.useThisDataB.addEventListener("click",(()=>{this.useThisDataA.style.display="block";this.useThisDataB.style.display="none";l.style.backgroundColor=r.Colors.Nephritis;u.innerText="This study data will be used.";n.style.backgroundColor=r.Colors.Alizarin;o.innerText="This study data will be discarded.";this.studyDataToKeep=this.fhirStudyB}));s.appendChild(l);s.appendChild(h);this.containerMergePanels.appendChild(a);this.containerMergePanels.appendChild(s);this.outContainer.appendChild(this.containerMergePanels);this.getImagingStudyResource(this.Studies,0,(()=>{this.fhirStudyA=this.copyFhirEntities(this.StudiesReferences,0);this.studyDataToKeep=this.fhirStudyA;this.fhirStudyB=this.copyFhirEntities(this.StudiesReferences,1);var t={FormMode:"reference",ResourceId:"ImagingStudy/"+this.fhirStudyA["id"],view:"studyForm",SwitchThemeOnSubView:false,PassParentContext:true};var i=[this.fhirStudyA,()=>{r.Toaster.ShowToast("Study A saved...",r.Colors.Emerald,3)},t];var a=new e.ClientViews.FormView.FormView(d,this.Platform,this.Platform.CurrentSpec.Functions[0].Views["studyForm"],t,i,this);var s={FormMode:"reference",ResourceId:"ImagingStudy/"+this.fhirStudyB["id"],view:"studyForm",SwitchThemeOnSubView:false,PassParentContext:true};var n=[this.fhirStudyB,()=>{r.Toaster.ShowToast("Study B saved...",r.Colors.Emerald,3)},s];var o=new e.ClientViews.FormView.FormView(h,this.Platform,this.Platform.CurrentSpec.Functions[0].Views["studyForm"],s,n,this);this.SwitchTheme()}));var g=[["mergeStudy",t.ResourceBag.Icons8MergeFiles32Png,e=>{this.mergeStudy()}]];super.SetButtons([g],(()=>{this.Dispose()}));this.OnWindowResize(0,0)}else{r.Toaster.ShowToast("Select two studies (hold CTRL or Shift and click to select multiple rows).",r.Colors.BelizeHole,6);this.CloseSubView()}}else{r.Toaster.ShowToast("Select two studies (hold CTRL or Shift and click to select multiple rows).",r.Colors.BelizeHole,6);this.CloseSubView()}}startAsSplit(){this.totalImages=0;this.loadImages=0;this.seriesIndex=0;this.imageIndex=0;this.phase=1;this.thumbnailImagesA={};this.thumbnailImagesB={};this.StudiesReferences=new Array;this.ProcessingSplitIsRunning=false;if(this.Platform.CurrentView.ViewName.match("sharedWorklist")){r.Toaster.ShowToast("Select a study from general worklist",r.Colors.BelizeHole,3);r.Loader.HideAll();super.CloseSubView();return}try{var i=false;this.Studies[0].meta.tag.forEach((e=>{if(e["code"]==="CASE"){r.Toaster.ShowToast("Select a non CASE study from general worklist",r.Colors.BelizeHole,3);r.Loader.HideAll();super.CloseSubView();i=true}}));if(i)return}catch(e){}if(this.Studies!==null&&this.Studies!==undefined&&this.Studies.length===1){var a=e.Frontend.WebClient.Utils.IsDebugActive()==="active"?"":".min";this.workerFile="WadoPlugin"+a+".js";r.DOMUtils.LoadJsToHead(["out/"+this.workerFile]);this.Platform.LanguageManager.AddDictionary("{Efferent.ClientViews.ImageSplitView.ResourceBag.ImageSplitLanguageJson}","ImageSplitLanguage",e.ClientViews.ImageSplitView.ResourceBag.ImageSplitLanguageJson[this.Platform.LanguageManager.CurrentLanguage]);this.outContainer=document.createElement("div");this.outContainer.classList.add("imageSplitViewOutContainer");this.parent.appendChild(this.outContainer);this.containerSplitPanels=document.createElement("div");this.containerSplitPanels.className="ContainerSplitPanels";this.containerSplitPanels.style.height=this.outContainer.clientHeight-40+"px";this.outContainer.appendChild(this.containerSplitPanels);var s=document.createElement("div");s.style.width=this.outContainer.clientWidth/2+"px";this.panelStudyA=new t.PanelStudy(this.thumbnailImagesA,this,this.containerSplitPanels,s,t.EPanelSide.Left);var n=document.createElement("div");n.style.width=this.outContainer.clientWidth/2+"px";this.panelStudyB=new t.PanelStudy(this.thumbnailImagesB,this,this.containerSplitPanels,n,t.EPanelSide.Right);var o=document.createElement("div");r.DOMUtils.AddClass(o,"progressBarContainer");this.progressBar=document.createElement("div");r.DOMUtils.AddClass(this.progressBar,"progressBar");o.appendChild(this.progressBar);this.outContainer.appendChild(o);let i=this.Platform.GetSetting("theme");var d=i.toLowerCase();var l=d.charAt(0).toUpperCase()+d.slice(1);this.SwitchTheme();var u=[["removeOfStudy",t.ResourceBag.Icons8Back32Png,e=>{if(this.IsImagePanelSelected(this.panelStudyB))this.MoveImageToSeries(this.panelStudyB,this.panelStudyA);else r.Toaster.ShowToast("Select a image on right side",r.Colors.BelizeHole,3)}]];var h=[["addToStudy",t.ResourceBag.Icons8Forward32Png,e=>{if(this.IsImagePanelSelected(this.panelStudyA))this.MoveImageToSeries(this.panelStudyA,this.panelStudyB);else r.Toaster.ShowToast("Select a image on left side",r.Colors.BelizeHole,3)}]];var g=[["editDemograStudy",t.ResourceBag.Icons8Plan32Png,e=>{this.editDemographic()}]];var c=[["splitStudy",t.ResourceBag.Icons8SplitFiles32Png,e=>{this.splitStudy()}]];super.SetButtons([h,u,g,c],(()=>{this.Dispose()}));this.OnWindowResize(0,0);this.getImagingStudyResource(this.Studies,0,(()=>{this.Studies[0]=this.copyFhirEntities(this.StudiesReferences,0,"series",this.Studies[0]);this.fhirStudyA=this.copyFhirEntities(this.StudiesReferences,0);this.fhirStudyB=this.copyFhirEntities(this.StudiesReferences,0);this.downloadStudy()}))}else{r.Toaster.ShowToast("Select a study",r.Colors.BelizeHole,3);super.CloseSubView()}}downloadStudy(){var t=this.Studies[0];var i=t["identifier"][0]["value"];var a=i.lastIndexOf(":");var n=i.substring(a+1,i.length);this.studyDownload=new r.StudyEntityBase;this.studyDownload.StudyGUID=n;this.downloadWorker=new Worker("out/"+this.workerFile);r.Loader.Show("Loading first resource.");this.downloadWorker.addEventListener("message",(e=>{var t=e.data;if(t.action==="imageRaw"){this.processRawImage(this.studyDownload,t);r.Loader.Hide()}else if(t.action==="videoMp4"){this.processMP4(this.studyDownload,t);r.Loader.Hide()}if(this.checkFullDownloadStudy(this.studyDownload)){this.stopWorker();r.Toaster.ShowToast("Study completed. "+this.loadImages+" images downloaded",r.Colors.BelizeHole,3)}}),false);s.FhirParser.GetStudyWithSeriesAndImagesReference(this.studyDownload,this.Studies[0],["Efferent.Frontend.WebClient.StudyEntityBase","Efferent.Frontend.WebClient.SeriesEntityBase","Efferent.Frontend.WebClient.ImageEntityBase"]);var o=this.getStudyEntityForWorker(this.studyDownload);this.StudyA=new r.StudyEntityBase;this.StudyA.StudyDescription=o.StudyDescription;this.panelStudyA.SetStudy(this.StudyA);this.StudyB=new r.StudyEntityBase;this.getTotalImages();var d=this.getSeriesAndImageGuids(this.studyDownload.StudyGUID);let l=this.Platform.GetSetting("localRepoActive");var u={action:"downloadImage",baseUri:r.PlatformContext.PlatformUri,dictionaryStudy:this.getStudyEntityForWorker(this.studyDownload),imageGuid:d.imageGuid,imageIndex:this.imageIndex,localRepositoryActive:l===undefined?"false":l,offlineMode:this.Platform.CacheConnect.OfflineMode,phase:this.phase,qualityMode:this.Platform.Configuration.QualityMode,seriesGuid:d.seriesGuid,seriesIndex:this.seriesIndex,urlLocalRepository:this.Platform.CacheConnect.ServiceUrlCache,xToken:sessionStorage["token"],xTokenCache:sessionStorage["tokenCache"],xUserEmail:sessionStorage["userEmail"],xUserPassword:sessionStorage["passwordUser"],xVersionSignature:e.Frontend.WebClient.AssemblyInfo.Version,organizationId:sessionStorage["organizationId"],applicationName:sessionStorage["application"]};this.downloadWorker.postMessage(u)}getTotalImages(){this.studyDownload.Series.IndexData.forEach((e=>{this.totalImages+=this.studyDownload.Series.StructureData[e].Images.IndexData.length}))}processMP4(e,i){this.imageIndex=parseInt(i.imageIndex);this.seriesIndex=parseInt(i.seriesIndex);var a=this.studyDownload;var r;var s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABaCAYAAABzAJLvAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH4QQZFxArNkqCtgAAAAd0RVh0QXV0aG9yAKmuzEgAAAAMdEVYdERlc2NyaXB0aW9uABMJISMAAAAKdEVYdENvcHlyaWdodACsD8w6AAAADnRFWHRDcmVhdGlvbiB0aW1lADX3DwkAAAAJdEVYdFNvZnR3YXJlAF1w/zoAAAALdEVYdERpc2NsYWltZXIAt8C0jwAAAAh0RVh0V2FybmluZwDAG+aHAAAAB3RFWHRTb3VyY2UA9f+D6wAAAAh0RVh0Q29tbWVudAD2zJa/AAAABnRFWHRUaXRsZQCo7tInAAAP8ElEQVR4nO2dfXhU1Z3HP/dlXjMjJj6u1ZW1z1NFeVFIFAUqvtQWhST4bFfBZ0VAUF5cK1ZRbBLY2tL9o75U3e52232qgFQQunYREBVxie4jrYhARR98Wt0SXA0kIYHMvXdm7tx79o9kwiTMfcFFJpnM97/JPfnO95zvPef8zplz708SQghKKFqoff9w5MgREp2dyLJcCD0lfAkIQAjBeeedh6r2trTXp1UrVvL4T3+KYRgoinI6NZbw/4AQAiuTYdjFF/PEU08xfMTwnmtSdoj+6MOPmDxpEmY6TSgcpjRyDxxIAJJEW2srU2prWfPiWiRJAnJ68Cef/JnORIKK8vJe/yyEcDRbkqQeIj/or1wAtm0PeK4hZ57Jp598QjKVIhIOAzkGy4qCkjPvSpKEaZrouk4oFMrbmLZtI4QgFosBuDa4aZoYhkEwECBfKcuyenE5QZIkMqaJbhgEAoG8ZWzbxrZtf1yZDJqmEQwGHbmEbVPmk0vXdUddQggsy/KtS9c0Ai66snWUJKmn7VVFgRwfegzue1+Zpkm0rIyHlixh+PDhWLbdq4wkSySNJGteeIE3t22jLBrNK1QIgWmahCMRFj/8ECNGjMQWNrkuy4qMpmmsX7eObVvfIBKJOFY+k8kQCAapW/wgo0aOQiB6cUmyjGEYrF+3jq2vvUY0j65cLlVVefiRRxhTWQl5uFLJJC+99BKvbNrki2vxkiVUVVbm1ZVOp9jwnxvYuGGDZx0VReniqqrKwyWRTCbZvGkzG373O1euE6LoLAzD4NHly5k1e5bjPwN869s3UDt5Cvv37yfcPSxkkb2rDMOgYdlS7po3z5XrxhtvombKFD7at4+wg2hN0/jhjx7lnnvvdeW6afJN1E6p5o979hBxMEbTNBqWLeO++xe565p8EzfX1PL+rl2OJuuaxpK6Oh5Y/KCHrikcav6CP/z+D45cmqbxwOLFPLTkYVeu6poaWltbebuxkbKysrxl8q6FLMsiHo8zYcJ41y8AiEQijK6sJJVO571uWRbRaJRx4525sjdCMBRk7NixrlzxeJzrrv+Wpy5VVZkwYQJp03TkisViXHvdtZ5ciqJw9cSJpB102bZNOBLh6okTPbkkCa64YqwjlxCCYCDAeB9tDzBu/DhMhzqCg8EAiixjWZavL+k7fPdFdk5xu378gzOPEIJgMIii+Fuje63lFUXxvVoIhUKeAZJlOdcxF7aw3bkkyXfb25Y7l3MLnETEJ3uUO5no0V85n7p8bNZIsl9dXtdPbR1PFVfeFpAkiXQ6jeUQoveF03CTrbRpmr57iqEbjtdkWUbXdXRD98XV2dnpeE2SJFKpFOlkfu190X6k3XOV4DZK5SKdTru2h2VZjsujvkgmk65ceQ1WFAXDMHju1896fsGH+z7k7cbGvJGcEAJZlkmn07yw+jeeXPs++IBt27Y5BwyyTDKZZNWKlZ5cH+//mNdfe80xwpRlmXQqxcoVKzyHw08//ZQtW7Y4ckndQ+rzK1e5zocATQeaeOP1rY4BVnblsfaFNZ66/vI/f2Hzpk2uUXTPTtYrmzcza8YdDBkypOeiYRhce911jBg5AknqfS9IkkQikeD1V1+lubmZSCTieCcJIUilUlxz7bUMHzECWZF7h/3dXK9u2cLhQ4dcuRACI5nk6muuYeSokV1bqn24dF3n1S1baP78cyLRqOsdrus6E775TUaPGXPCkJ7lemPrVg42NRH1wXXV+PFUVlWiyL23eiVJwjB03nxjGwcOHOgxxYnPMAzGjRvH6MpKVFXtVU6SupZJW19/naYDB3p0pVIphg4dyrbG7T38jgZLkoRt2+iaRsbpThKCaFkZwWDQteJZLk3TsDJW/ilUCCLRqOOmSl9omkbGNPNPjl+KK5NXlxCCSCRC2Of2raZpjkO1EIJIOEzY7Qb2yYWAcCTcS1c+gx3XwUIIJEny3MHJlvW6LkmS5w6OH64snIbxEldvOBqcxckGECWcHvhZtoEPgy3L4szycuLxuM/FSQlfJbL9teXwYUzT9DTZ0+CjHUeZt3ABDzzovgVXwumDZdlMnjSJP//pTydsD/eFp8ECQUANOP7aUkJhIEtSr1+NHMt5lhDOv0mWUBhYlpX3J9d88LWpe5K/UZdwGiCBL5NLJ+uKHCWDixwlg4scA97gUgDojgFvcCaT4SfLl/Px/v2FltIvMeANDgaDbN64iSk33sTq51cXWk6/w4A3GLrOA7e3t/PAffcx/+55fHbws0JL6jcoCoNBEA6HiZ9xBv+xbh211dX8dv36QovqFygKg6XuFb8kSZRXVNBy+DD3zF/Awnnz+ezgwcKKKzCKwuBcCNHdm+Nx1r34IrXVNax/cV2hZRUMRWdwFrIsU9Hdm+9duJCF8xfwv58Nvrm5aA3OPpwWDoeJxeOsW7t2UPbmojU4F5IkUVFRweFDh/iHe+5h4fwFfPH5F4WWdVowKAzOIhKJEI/FWL92LdWTJ/PbdcUfaQ8ag7NDdjbSPtTczD0LFrDoe9/jUHNzr3LFhEFjcC6yR2FjsRi/WbWaqTW1bHx5I+D/kZGBgkFpcBayLFNeUc7BpibunjOH7y9axKFDhwot65RiUBsMXb05Go0SjUZZ9dwKbq6u4eUNLx+/7vtwTP/EoDc4C1mWqTjrLA42NTFv7lweWHQ/LYdbkAb4YeGSwTkQ3Y+8RKNRVq5YQW11dc/cPFBRMjgPZFmmvLycpgMHmDd3Lt9fdD8tLS2FlvWlUDLYBdFolEgkwqoVK6idUs2mjZsKLemkUTLYA4qiUFFRwcGmJubMmsXC+fNpa2srtCzfKBlc5PB8dGWww7Isjh49ykXDhtGwbBk1tTWFlnRSKBnsAl3XEUIwc/Zs6hrqOfvsswst6aRRMjgPbNvu6bX1S5dSO7W20JK+NEoG50CSJHRNw7JtZs2ezQ/q6zn7rwZer81FyeBu2LbN0Y4OLho2jLqlS5l681Sga6tyIO9mDXqDJUlC0zRs22bmnbN5pK6Oc8455/j1AWwuDHKDbdvm2NFjfOOiC2lYtmxAz7VOGJQGZ99/ZZomt8+cQV19Ped87WvA8TcCFQsGjcFZ02zbpr29nQu+/nXq6uu5ZdqtecsVCwaNwdD19ri0aTL9tttY+sN/5Nxzzy20pK8cg8JgIURPr/1BXR23Tp9WaEmnDUVrcHaoNQwDM51m2m230bC0gb8+//wCKzu9KFqDbdumo6ODv7ngAurq6wdVr81F0Rnc9VZXg3Q6za3Tp9OwtIHzhw4ttKyCoSgMFt2BrxCCjvZ2hl5wAfVLG7jl1lvd/3EQoCgMhq73J2dMk7+bNo2ly5Zx/tDBNdc6oSgMPtrRQXl5OY8uX86MO2YUWk6/woA3OJ1OU11bwy233MLFl1xSaDn9DgPeYFVVqW9oKLSMfosBfyarlOfYHaXWKXKUDC5ylAwucvgyuMieiS4KCPwl+POR3K8UyPQ3KIri+yCRj2WSRCZjOuYnLOH0w7K6Mq/7eRW/p8HlZw5hzQtr2LRx0wA/flYcyE2rEwqFPMt7GiwrCh3t7bQO0McnixWnLDGWpmldw3PfWV0IFEUhEo0SCAR8vZ3GMAxSqdSJF4RAVhSiX4Yrjy5ZUYhEIp45Fb8KrmQ3lzgVXMkkqWQyL1c6nfbFldfgbIpTwzCorKpi9OjRKAEVYR8nUhSZ5uZmGrc3omuaZyJIQ9e5bMxoKqsuPyHztqLIHD7cwlvbt9PZ2enJpWs6l46+jKrLLycQULF7dHXddK2tbbzV2EhHe7tnUknDMBh16aVUVlURDAZyuLp0tbW10bjdP9fw4cO5fOxYQqHgCVytrW38d+NbtB1pc82wmj2rfcnw4Yy98sq8XO1H2nn7rbdoaWlx5XLswYlEgmnTp/PYk0+4jvU73tnBXXfeiaZpqGp+Ok3T+Nvvfpcnn/oZYZdct+/t3MnsO2aSSCQcuRKJBDW1tTz98392Td64d88eZt4+g46ODgKBgCvXM//yc8d8vgB/3LuXmbfPoL293ZFL0zS+M2kS//pvvyAWjztyfbhvHzNvn0FrSyuBoANXIsH1N9zAL371S8444wxHro/37+eOv7+d5uZmx8Rledc/lmURDoeZt2CB50Q+fsJ4rrv+egw9f1ZuIQSBQIC75893NRfgirFj+fak76A7cNm2TSAQYN6CBZ6ZOUePGcOkSZPQHTKK27aNqqrMmTvX1VyAy0aPprqm1lFX9iz1nLvvcjUXYOSoUUyprkbX9bxzqBBd7/WZPXeOq7kAF19yCbVTpzrqAgeDhRCEQiHHO6wvwuGw48uGsgbLstTz2Q3xeNxxZ8W2bcpiMYYMca94FuVnnYVT+qjsy9DK4t4pbwHXh9Cy7RVxySOYW+9QOASSc1uoqoqq+PuhrywWcw22HHcwhBDYHinGs/DMfCJErznEk8tFsIT/nTUvXUIIhM+sLX643MrkmiBs4b7kFAJhn5q2dzXYab7pC1VRXFtdAMHu0cArtJcl2TX4yGQyvlPteZUTQiD3ScXuBNu23OsoBIrPXqeoiuuIB/hue1l2bi9wMFhRFDo7O9m1633PL8hkMnz40UcEnCZ5WUbXdfbu3evJZds2u3fvdqycoigcO3aMd955x5MLYOe7O125EokEO3e+64trxzs7UB24sic533tvpy+uDz74AEXJf2PJskw6bbJnzx5fXLve3+UYkILLMikUCvFPP/4xtmVx6WWXnrgfLUl0HjvGv//yV+zZvds1UAmFQvzkR8sxzQxVl1d1VS7nrssuC5799bPs3rXLlSscDvPkY4+jKCpjKitR1eNcgq60q52JBKtXrmLnu++6ckUiEZ547HEAxl55ZVdD9dGlazpr1qzh9zt2EHUI7GRZJhqN8szPniIYCHLVuKtQVbVXz+p64M1g9fPP07i90TVIjJZFeebpZ1BUlasnTjxBF5JEKpnixbVraHzzv1y5JNGt4pXNm5k14w6GDBnSIyidTpNKpYjFYicMBZLUdZLRTKcpi7kHKj1cyRRlsTLkPAanUilSqVRXkIVzAJJNOW8YBrFY7IQ1dVZXOp0m5lNXMpl05EqlUqSSSc/oOFdXPBZDduJKpSgrK3OdqrJTka7rlMViqHm4zHQaI5nsxZVKpRg6dCjbGrcT6V6xuG50BAIBVFXFsiysPAGXqqq+Ekfnctm2nTcwUBSFWCzm+fimEAJVVYnH41iWlZfrZHUFAgFs28Y0zfy6PMzN1RWLxbBsG8uljn64FEXpqaOZh0uSZV9cPQbnNlbfu8VpvjhZ+OXy+1LuU6ULTt1PoqeyveDk65jp0xF7DP7GhRdSFouhaZrnllwJ/QsSgCRxtKODq6+5hnDOerxnDgZY+dwKnnjsMXRdd43MSuhfEEJgWRYXDRvGU8883et8eC+DAY60HSGR6Cyd4hhAEHSZfO555xHo0zFPMLiE4sL/Afgyge+7q9YWAAAAAElFTkSuQmCC";this.controlProgressbar();r=this.getSeriesAndImageGuids(e.StudyGUID);if(!i.error){if(this.thumbnailImagesA[r.seriesGuid]===undefined)this.thumbnailImagesA[r.seriesGuid]=new Array;a.Series.StructureData[i.seriesGuid].Images.StructureData[i.imageGuid]["Load"]=true;var n=new Image;n.setAttribute("data-seriesIndex",this.seriesIndex.toString());n.setAttribute("data-imageIndex",this.imageIndex.toString());n.onload=i=>{var a=i.currentTarget;var r=parseInt(a.getAttribute("data-imageIndex"));var s=parseInt(a.getAttribute("data-seriesIndex"));var o=document.createElement("canvas");var d=o.getContext("2d");if(n.width>=n.height){var l=120;o.width=l;o.height=o.width*(n.height/n.width)}else{var u=120;o.height=u;o.width=o.height*(n.width/n.height)}d.drawImage(n,0,0,o.width,o.height);var h=o.toDataURL();var g=this.getSeriesAndImageGuids(e.StudyGUID,s,r);this.thumbnailImagesA[g.seriesGuid].push(new t.ThumbnailImage(this.panelStudyA,g.seriesGuid,g.imageGuid,h));this.panelStudyA.RenderAllThumnails()};n.src=s}if(this.imageIndex===a.Series.StructureData[i.seriesGuid].Images.IndexData.length-1){this.seriesIndex+=1;this.imageIndex=0}else{this.imageIndex+=1}if(this.seriesIndex<a.Series.IndexData.length&&this.imageIndex<a.Series.StructureData[i.seriesGuid].Images.IndexData.length)this.sendDataToWorker(e,i)}processRawImage(e,i){this.imageIndex=parseInt(i.imageIndex);this.seriesIndex=parseInt(i.seriesIndex);var s;if(i["downloaded"]===true)s=this.studyDownload.Series.StructureData[i.seriesGuid].Images.StructureData[i.imageGuid]["buffer"];else s=i.imageBuffer;var n=i.dicomTags;var o=this.studyDownload;var d;var l;l=this.getSeriesAndImageGuids(e.StudyGUID);this.controlProgressbar();if(!i.error){o.Series.StructureData[i.seriesGuid].Images.StructureData[i.imageGuid]["Load"]=true;d=o.Series.StructureData[i.seriesGuid].Images.StructureData[i.imageGuid];d.TransferSyntax=i.transferSyntax.replace(/([^a-z0-9.]+)/gi,"");d["photometric"]=i.photometric;d["isUnsigned"]=i.isUnsigned;d["dicomTags"]=n;if(this.thumbnailImagesA[l.seriesGuid]===undefined)this.thumbnailImagesA[l.seriesGuid]=new Array;if(i.transferSyntax==="1.2.840.10008.1.2.4.50"){if(i.downloaded===undefined){r.DicomBufferRenderer.GetFramesBuffer(d,s);var u;if(d["buffer"]){u=s}else{u=d["bufferArray"][Math.floor(d["bufferArray"].length/2)];d["buffer"]=u}var h=window.btoa(a.Uint8ToString(u));var g="data:image/jpeg;base64,"+h;var c=new Image;c.setAttribute("data-seriesIndex",this.seriesIndex.toString());c.setAttribute("data-imageIndex",this.imageIndex.toString());c.onload=i=>{var a=i.currentTarget;var r=parseInt(a.getAttribute("data-imageIndex"));var s=parseInt(a.getAttribute("data-seriesIndex"));var n=document.createElement("canvas");var o=n.getContext("2d");if(c.width>=c.height){var d=120;n.width=d;n.height=n.width*(c.height/c.width)}else{var l=120;n.height=l;n.width=n.height*(c.width/c.height)}o.drawImage(c,0,0,n.width,n.height);var u=n.toDataURL();var h=this.getSeriesAndImageGuids(e.StudyGUID,s,r);this.thumbnailImagesA[h.seriesGuid].push(new t.ThumbnailImage(this.panelStudyA,h.seriesGuid,h.imageGuid,u));this.panelStudyA.RenderAllThumnails()};c.src=g}}else{if(i.downloaded===undefined){r.DicomBufferRenderer.GetFramesBuffer(d,s);var u;if(d["buffer"]===null){u=d["bufferArray"][d["bufferArray"].length/2];d["buffer"]=u}r.DicomBufferRenderer.GetWLFromImage(o.Series.StructureData[i.seriesGuid].Images.StructureData[i.imageGuid]);var m=parseInt(d["dicomTags"]["0028_1050"]||0);var S=parseInt(d["dicomTags"]["0028_1051"]||1);var A=parseInt(d["dicomTags"]["0028_0011"]);var p=parseInt(d["dicomTags"]["0028_0010"]);var f=r.DicomBufferRenderer.ProcessBuffer(d,d["dicomTags"]["invert"],S,m);var w=document.createElement("canvas");var y=w.getContext("2d");if(A>=p){w.width=120;w.height=w.width*(p/A)}else{w.height=120;w.width=w.height*(A/p)}if(f&&f.contextFilled)y.drawImage(f.canvasObject,0,0,w.width,w.height);var I=w.toDataURL();c=new Image;c.setAttribute("data-seriesIndex",this.seriesIndex.toString());c.setAttribute("data-imageIndex",this.imageIndex.toString());c.onload=i=>{var a=i.currentTarget;var r=parseInt(a.getAttribute("data-imageIndex"));var s=parseInt(a.getAttribute("data-seriesIndex"));var n=this.getSeriesAndImageGuids(e.StudyGUID,s,r);this.thumbnailImagesA[n.seriesGuid].push(new t.ThumbnailImage(this.panelStudyA,n.seriesGuid,n.imageGuid,I));this.panelStudyA.RenderAllThumnails()};c.src=I}}}if(this.imageIndex===o.Series.StructureData[i.seriesGuid].Images.IndexData.length-1){this.seriesIndex+=1;this.imageIndex=0}else{this.imageIndex+=1}if(this.seriesIndex<o.Series.IndexData.length&&this.imageIndex<o.Series.StructureData[i.seriesGuid].Images.IndexData.length)this.sendDataToWorker(e,i)}controlProgressbar(){this.loadImages+=1;var e=this.loadImages*100/this.totalImages;this.progressBar.style.width=e+"%";if(e>=100){setTimeout((()=>{this.progressBar.parentElement.style.height="0px"}),1500)}}sendDataToWorker(e,t){var i=this.studyDownload;var a=this.getSeriesAndImageGuids(e.StudyGUID);let s=this.Platform.GetSetting("localRepoActive");this.downloadWorker.postMessage({action:"downloadImage",baseUri:r.PlatformContext.PlatformUri,dictionaryStudy:this.getStudyEntityForWorker(i),error:t.error,imageGuid:a.imageGuid,imageIndex:this.imageIndex,index:this.imageIndex,localRepositoryActive:s===undefined?"false":s,offlineMode:this.Platform.CacheConnect.OfflineMode,seriesGuid:a.seriesGuid,seriesIndex:this.seriesIndex,urlLocalRepository:this.Platform.CacheConnect.ServiceUrlCache,xToken:sessionStorage["token"],xTokenCache:sessionStorage["tokenCache"],organizationId:sessionStorage["organizationId"],applicationName:sessionStorage["application"]})}getStudyEntityForWorker(e){var t=new r.StudyEntityBase;t.StudyGUID=e["StudyGUID"];t.PatientName=e["PatientName"];t.InstitutionName=e["InstitutionName"];t.StudyDescription=e["StudyDescription"];t.Series=new r.MapStructure;for(var i=0;i<e.Series.IndexData.length;i++){var a=e.Series.IndexData[i];var s=e.Series.StructureData[a].Images;t.Series.IndexData[i]=a;t.Series.StructureData[a]=new r.SeriesEntityBase;t.Series.StructureData[a].Images=new r.MapStructure;t.Series.StructureData[a]["SeriesGUID"]=e.Series.StructureData[a].SeriesGUID;t.Series.StructureData[a]["Description"]=e.Series.StructureData[a].Description;t.Series.StructureData[a]["ImageCount"]=e.Series.StructureData[a].ImageCount;if(s!==undefined&&s!==null){for(var n=0;n<s.IndexData.length;n++){var o=s.IndexData[n];t.Series.StructureData[a].Images.IndexData[n]=o;t.Series.StructureData[a].Images.StructureData[o]=new r.ImageEntityBase;t.Series.StructureData[a].Images.StructureData[o]["ImageGUID"]=s.StructureData[o].ImageGUID;t.Series.StructureData[a].Images.StructureData[o]["ImageUri"]=s.StructureData[o].ImageUri;t.Series.StructureData[a].Images.StructureData[o]["InstanceNumber"]=s.StructureData[o].InstanceNumber;t.Series.StructureData[a].Images.StructureData[o]["Load"]=s.StructureData[o]["Load"];t.Series.StructureData[a].Images.StructureData[o]["LoadAnnotations"]=s.StructureData[o]["LoadAnnotations"];t.Series.StructureData[a].Images.StructureData[o]["dicomTags"]=s.StructureData[o]["dicomTags"];t.Series.StructureData[a].Images.StructureData[o]["has3DInformation"]=s.StructureData[o]["has3DInformation"];t.Series.StructureData[a].Images.StructureData[o]["isUnsigned"]=s.StructureData[o]["isUnsigned"];t.Series.StructureData[a].Images.StructureData[o]["photometric"]=s.StructureData[o]["photometric"];t.Series.StructureData[a].Images.StructureData[o]["pixelSpacing"]=s.StructureData[o]["pixelSpacing"];t.Series.StructureData[a].Images.StructureData[o]["TransferSyntax"]=s.StructureData[o]["TransferSyntax"]}}}return t}getSeriesAndImageGuids(e,t,i){var a=this.studyDownload;var r=a.Series.IndexData[t===undefined?this.seriesIndex:t];var s=a.Series.StructureData[r].SeriesGUID;var n=a.Series.StructureData[s].Images.IndexData[i===undefined?this.imageIndex:i];var o=a.Series.StructureData[s].Images.StructureData[n].ImageGUID;return{seriesGuid:s,imageGuid:o}}stopWorker(){if(this.downloadWorker!==undefined)this.downloadWorker.terminate()}copyFhirEntities(e,t,i,a){var r=new Object;var subCopy=(e,t,i)=>{if(Array.isArray(i)){e[t]=new Array;i.forEach((i=>{var a=new Object;for(const e in i){if(i.hasOwnProperty(e)){const t=i[e];subCopy(a,e,t)}}e[t].push(a)}))}else{e[t]=i}};for(const s in e[t]){if(e[t].hasOwnProperty(s)){const n=e[t][s];if(i===undefined){subCopy(r,s,n)}else{if(i===s)subCopy(r,s,n);else if(a[s])r[s]=a[s]}}}for(const e in a){if(a.hasOwnProperty(e)){const t=a[e];if(!Object.keys(r).some((t=>t===e)))r[e]=t}}return r}checkFullDownloadStudy(e){var t=true;e.Series.IndexData.forEach((i=>{var a=e.Series.StructureData[i].Images;if(a!==undefined&&a!==null){a.IndexData.forEach((a=>{var r=e.Series.StructureData[i].Images.StructureData[a];if(r["Load"]===undefined){t=false;return false}}))}}));return t}editDemographic(){var e;var i;var a;a=this.IsImagePanelSelected(this.panelStudyA);if(a){i=this.panelStudyA}else{a=this.IsImagePanelSelected(this.panelStudyB);if(a)i=this.panelStudyB}if(i!==undefined){if(i.Side===t.EPanelSide.Left){e=this.fhirStudyA;r.Toaster.ShowToast("Study A selected",r.Colors.BelizeHole,3)}else{e=this.fhirStudyB;r.Toaster.ShowToast("Study B selected",r.Colors.BelizeHole,3)}}else{r.Toaster.ShowToast("Select a image for edit a study",r.Colors.BelizeHole,3)}if(e!==undefined){const a={ResourceId:"ImagingStudy/"+e["id"],FormMode:"edit",ParentContext:this,Fields:this.Platform.CurrentSpec.FormTemplates["defaultStudy"]["Fields"],PassParentContext:true,UpdateResourceCallback:a=>{a["modifierExtension"]=e["modifierExtension"];if(i.Side===t.EPanelSide.Left)this.fhirStudyA=a;else this.fhirStudyB=a}};if(i.Side===t.EPanelSide.Left)a["HardResourceData"]=this.fhirStudyA;else a["HardResourceData"]=this.fhirStudyB;const r=this.Platform.ActivateSubView("SubFormView",a);r.SetButtons([])}}updateSeriesAndInstanceOnFhir(e){var t=0;e["numberOfSeries"]=e["series"].length;e["series"].forEach((e=>{t+=e["instance"].length}));e["numberOfInstances"]=t}mergeStudy(){if(!this.ProcessingSplitIsRunning){r.Loader.Show();this.ProcessingSplitIsRunning=true;delete this.fhirStudyA["rowClass"];delete this.fhirStudyB["rowClass"];var e=this.fhirStudyA;var t=e["identifier"][0]["value"];var a=t.lastIndexOf(":");var s=t.substring(a+1,t.length);var n=this.fhirStudyB;var o=n["identifier"][0]["value"];var d=o.lastIndexOf(":");var l=o.substring(d+1,o.length);var u=new Object;var h={OldStudyUid1:s,OldStudyUid2:l,NewStudy:this.studyDataToKeep,OrganizationName:sessionStorage["organizationName"]};u["InputParameters"]=btoa(JSON.stringify(h));u["Progress"]=0;u["AuthorReference"]=sessionStorage["practitionerId"];u["Author"]=sessionStorage["userEmail"];u["Notify"]=false;u["IncludeInputFile"]=true;var g=JSON.stringify(u);i.AjaxCall(r.PlatformContext.PlatformUri+"/task/studytools-merger","POST","min",g,(e=>{r.Loader.Hide();this.CloseSubView()}),(()=>{this.ProcessingSplitIsRunning=false;r.Toaster.ShowToast("Could not merge studies.",r.Colors.Orange,3);r.Loader.Hide()}))}else{r.Toaster.ShowToast("Merge process executing...",r.Colors.BelizeHole,3)}}splitStudy(){if(!this.ProcessingSplitIsRunning){this.ProcessingSplitIsRunning=true;this.fhirStudyA=this.deleteSeriesOrInstancesOnFhir(this.fhirStudyA,this.thumbnailImagesA);this.fhirStudyB=this.deleteSeriesOrInstancesOnFhir(this.fhirStudyB,this.thumbnailImagesB);delete this.fhirStudyA["rowClass"];delete this.fhirStudyB["rowClass"];this.updateSeriesAndInstanceOnFhir(this.fhirStudyA);this.updateSeriesAndInstanceOnFhir(this.fhirStudyB);if(this.fhirStudyA["numberOfInstances"]>0&&this.fhirStudyB["numberOfInstances"]>0){var t="";var i=new Object;var a={OldStudyUid:this.studyDownload.StudyGUID,OldStudyFhirId:this.Studies[0]["id"],NewStudy1:this.fhirStudyA,NewStudy2:this.fhirStudyB,OrganizationName:sessionStorage["organizationName"]};i["InputParameters"]=btoa(JSON.stringify(a));i["Progress"]=0;i["AuthorReference"]=sessionStorage["practitionerId"];i["Author"]=sessionStorage["userEmail"];i["Notify"]=false;i["IncludeInputFile"]=true;t=JSON.stringify(i);r.Loader.Show("split operation working..");var s=e.Frontend.WebClient.PlatformContext.PlatformUri+"/task/studytools-splitter";e.Frontend.WebClient.HttpUtils.AjaxCall(s,"POST","min",t,((e,t)=>{r.Loader.Hide();this.CloseSubView()}),(e=>{this.ProcessingSplitIsRunning=false;r.Loader.Hide();r.Toaster.ShowToast("Error in the split operation",r.Colors.BelizeHole,3)}))}else{this.ProcessingSplitIsRunning=false;r.Toaster.ShowToast("Add at least one image in each study.",r.Colors.BelizeHole,3)}}else{r.Toaster.ShowToast("Split process executing...",r.Colors.BelizeHole,3)}}generateBundle(e,t){var i=new Object;i["entry"]=new Array;e.forEach((e=>{var a=new Object;a["fullUrl"]=t;a["resource"]=e;i["entry"].push(a)}));i["link"]=new Array;i["link"].push({relation:"self",url:""},{relation:"first",url:""},{relation:"last",url:""},{relation:"next",url:""},{relation:"preview",url:""});i["meta"]={lastUpdated:r.Utils.GetCurrentDate()};i["resourceType"]="Bundle";i["total"]=e.length;i["type"]="searchset";return i}getImagingStudyResource(t,i,a){var s="ImagingStudy?_id="+t[i]["id"]+"&_include=ImagingStudy:endpoint&_include=ImagingStudy:subject&_include=ImagingStudy:location";var n=r.PlatformContext.PlatformUri+"/fhir/"+s;var o=new e.Frontend.FhirClient.FhirCall(n,"GET");o.FuncOk=e=>{r.Loader.Hide();var s=JSON.parse(e);var n=s["entry"].filter((e=>e.fullUrl.match("ImagingStudy")));this.StudiesReferences[i]=n.pop()["resource"];if(i<t.length-1)this.getImagingStudyResource(t,i+1,a);else a()};o.FuncError=e=>{r.Loader.Hide();r.Toaster.ShowToast("Error getting resource data",r.Colors.BelizeHole,5);this.CloseSubView()};r.Loader.Show();o.Send()}deleteSeriesOrInstancesOnFhir(e,t){var i=this.copyFhirEntities(this.Studies,0,"series",e);for(var a=0;a<i.series.length;a++){var r=i.series[a];if(t[r["uid"]]===undefined||t[r["uid"]]!==undefined&&t[r["uid"]].length===0){i.series.splice(a,1);a=-1}else{for(var s=0;s<r.instance.length;s++){var n=r.instance[s];if(!this.existsSerieAndImageOnThumbnails(r["uid"],t,n["uid"])){r.instance.splice(s,1);s=-1}}}}return i}existsSerieAndImageOnThumbnails(e,t,i){var a=false;for(const r in t){if(t.hasOwnProperty(r)){const s=t[r];if(r===e){if(i===undefined){a=true;return}else{s.forEach((e=>{if(e.ImageGuid===i){a=true;return}}))}}}}return a}}t.ImageSplitView=ImageSplitView})(i=t.ImageSplitView||(t.ImageSplitView={}))})(t=e.ClientViews||(e.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(e){var t;(function(t){var i;(function(t){var i=e.Frontend.WebClient;let a;(function(e){e[e["Add"]=0]="Add";e[e["Remove"]=1]="Remove"})(a=t.EOperationThumbnail||(t.EOperationThumbnail={}));let r;(function(e){e[e["Left"]=0]="Left";e[e["Right"]=1]="Right"})(r=t.EPanelSide||(t.EPanelSide={}));class PanelStudy{constructor(e,t,a,s,n){this.ThumbnailImages=e;this.ImageSplitView=t;this.parent=a;this.Element=s;this.ContainerSeries={};this.Side=n;i.DOMUtils.AddClass(this.Element,"PanelStudy");this.studyDescriptionContainer=document.createElement("div");this.seriesImagesContainer=document.createElement("div");i.DOMUtils.AddClass(this.seriesImagesContainer,"SeriesSplit");i.DOMUtils.AddClass(this.studyDescriptionContainer,"StudyTitleSplit");this.InputStudyDescription=document.createElement("input");this.InputStudyDescription.style.width="240px";this.InputStudyDescription.style.display="none";this.InputStudyDescription.placeholder="Input study description";var o=document.createElement("label");o.innerHTML="Study "+(this.Side===r.Left?"A":"B")+" :";o.style.marginRight="5px";this.studyDescriptionContainer.appendChild(o);this.studyDescriptionContainer.appendChild(this.InputStudyDescription);this.Element.appendChild(this.studyDescriptionContainer);this.Element.appendChild(this.seriesImagesContainer);this.parent.appendChild(this.Element)}SetStudy(e){this.study=e}UpdateRenderSerieContainer(e,t){var r;if(e===a.Add){if(this.ContainerSeries[t.SerieGuid]===undefined)this.renderAddContainerSeries(t.SerieGuid);r=this.ContainerSeries[t.SerieGuid].childNodes[1];t.Parent=r;t.Render()}else if(e===a.Remove){r=this.ContainerSeries[t.SerieGuid];i.DOMUtils.RemoveItem(t.Element);if(this.ThumbnailImages[t.SerieGuid].length===0){i.DOMUtils.RemoveItem(r);delete this.ContainerSeries[t.SerieGuid]}}}RenderAllThumnails(){if(this.study!==undefined&&this.study!==null)this.InputStudyDescription.value=this.study.StudyDescription;for(const e in this.ThumbnailImages){if(this.ThumbnailImages.hasOwnProperty(e)){const t=this.ThumbnailImages[e];if(this.ContainerSeries[e]===undefined)this.renderAddContainerSeries(e);let a=0;t.forEach((t=>{if(!t.WasRender){var i=this.ContainerSeries[e].childNodes[1];t.Parent=i;t.Render()}a++}));if(a===0){let t=this.ContainerSeries[e].childNodes[1].parentElement;i.DOMUtils.RemoveItem(t)}}}}renderAddContainerSeries(e){this.ContainerSeries[e]=document.createElement("div");this.ContainerSeries[e].id="serie_"+e;var t=document.createElement("div");t.innerHTML="Series "+e;i.DOMUtils.AddClass(t,"TitleSerie");var a=document.createElement("div");i.DOMUtils.AddClass(a,"ThumbnailsSerie");this.ContainerSeries[e].appendChild(t);this.ContainerSeries[e].appendChild(a);this.seriesImagesContainer.appendChild(this.ContainerSeries[e])}}t.PanelStudy=PanelStudy})(i=t.ImageSplitView||(t.ImageSplitView={}))})(t=e.ClientViews||(e.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(e){var t;(function(e){var t;(function(e){class ResourceBag{}ResourceBag.ImageSplitViewCss=`.formViewContent{overflow-y:auto;margin-left:10px;margin-right:10px}@media(min-width: 600px){.formViewContent>div{width:80vw}}@media(min-width: 768px){.formViewContent>div{margin-left:0;margin-right:0}}@media(min-width: 801px){.formViewContent>div{width:60vw}}@media(min-width: 1025px){.formViewContent>div{width:50vw}}@media(min-width: 1025px){.formViewContent>div{width:50vw}}@media(min-width: 1281px){.formViewContent>div{width:min(540px,40vw)}}.tabsContainer .tabsHeader{display:flex}.tabsContainer .tabsHeader .tabName{padding:0px 10px;cursor:pointer;border-bottom:solid 4px}.tabsContainer .tabsHeader .activeTab{border-color:#f39c12}.tabsContainer .tabsHeader .inactiveTab{color:#95a5a6;border-color:rgba(0,0,0,0)}.tabsContainer .tabsBody{border:dotted 1px;padding:10px 0px;width:fit-content}.referencesContainer{position:relative;margin-bottom:15px}.referencesContainer .worklistPane{overflow:visible}.referencesContainer>h3{margin:0px 15px 10px 0px;font-size:16px}.referenceBox{padding:0 0 0 10px;display:flex;border-right:0px;border-top:0px;border-bottom:0px;flex-direction:column}.referenceBox h2{margin-right:5px !important}.referenceNoneLabel{margin:0px 0px 15px 15px}.multipleFieldsBox{padding:0 3px 0 3px;font-size:13px;outline:none;border:1px inset var(--color-border-input);border-radius:3px;overflow:hidden;min-height:24px;color:var(--font-color);box-shadow:0px 1px rgba(255,255,255,.75)}.multipleField{margin:3px 1px}.referenceButton{display:inline-block;padding:2px 10px;border-radius:3px;font-size:13px;cursor:pointer;text-align:center;color:#fff;background-color:#3498db;width:auto;height:24px}.StringAsReferenceContainer>.referenceButton+.referenceButton{margin-left:10px}.StringAsReferenceContainer button.referenceButton{margin-top:8px}@media(min-width: 600px){.StringAsReferenceContainer button.referenceButton{margin-top:0}}.marginLR{margin:0px 15px !important}.formViewLabel{margin-bottom:10px;display:flex;flex-direction:column}.formViewLabel.half input{flex-grow:0;min-width:240px}.formViewLabel.half .daterange_box input{min-width:auto}@media(min-width: 1025px){.formViewLabel{flex-direction:row}}.formViewLabel>div{display:flex;flex-grow:1}.formViewLabel .daterange_header span{font-size:13px !important}.formViewLabel input,.formViewLabel select{flex-grow:1}.formViewLabel h2{width:100px;min-width:100px;margin:0px 15px 0px 0px;font-size:16px;height:25px;line-height:25px;font-weight:normal;display:inline-block;text-overflow:ellipsis;overflow:hidden}.formViewLabel select{width:208px}.badInputNotice{height:0px;font-size:10px;color:#e74c3c;display:inline-block;margin-left:5px}.badInputNoticeReference{height:0px;font-size:10px;color:#e74c3c;transform:translate(12px, 21px);width:90px}.stringReference{width:320px !important}.StringAsReferenceContainer{display:none;margin-bottom:15px;flex-wrap:wrap}.StringAsReferenceContainer .breakline{display:block;width:100%;height:0}@media(min-width: 600px){.StringAsReferenceContainer .breakline{display:none}}.referenceRow{height:60px;overflow-y:hidden;margin-bottom:15px}.wrapButtons{display:flex;gap:5px}.selectResourceType{padding:0px 20px 0px 5px;border:0px;height:22px}.selectResourceType option{background-color:#fff;color:#2c3e50}.altSelectResourceBtn{display:none}.imageMergeViewOutContainer{display:flex;overflow:auto;flex-direction:column;width:100%}.imageMergeViewOutContainer .ContainerMergePanels{width:100%;display:flex;height:auto}.imageMergeViewOutContainer .ContainerMergePanels .PanelMergeStudy{padding:10px;overflow-y:auto;width:50%}.imageMergeViewOutContainer .ContainerMergePanels .PanelMergeStudy .TitleMergeStudy{margin:auto;text-align:center;height:30px;padding:10px;line-height:30px}.imageMergeViewOutContainer .ContainerMergePanels .PanelMergeStudy .TitleMergeStudy button{float:right;height:100%}.imageMergeViewOutContainer .ContainerMergePanels .PanelMergeStudy .FormMergeStudy{height:100%}.imageSplitViewOutContainer{display:flex;overflow:auto;flex-direction:column;width:100%}.imageSplitViewOutContainer .ContainerSplitPanels{width:100%;display:flex;height:auto}.imageSplitViewOutContainer .progressBarContainer{width:100%;height:30px;bottom:0px;position:absolute;background-color:#fff;transition:all .5s ease-out}.imageSplitViewOutContainer .progressBarContainer .progressBar{background-color:#27ae60;height:100%;width:0%;transition:all .5s ease-out}.imageSplitViewOutContainer .PanelStudy{padding:10px;overflow-y:auto}.imageSplitViewOutContainer .PanelStudy .StudyTitleSplit{display:block;margin-bottom:20px}.imageSplitViewOutContainer .PanelStudy .SeriesSplit{display:block}.imageSplitViewOutContainer .PanelStudy .SeriesSplit .TitleSerie{display:block;margin-bottom:10px}.imageSplitViewOutContainer .PanelStudy .SeriesSplit .ThumbnailsSerie{display:flex;height:135px;width:100%;overflow-x:auto;overflow-y:hidden;padding:5px}.imageSplitViewOutContainer .PanelStudy .SeriesSplit .ThumbnailsSerie .ThumbnailElement{width:120px;height:120px;border-width:0px;display:flex;margin-right:5px;vertical-align:top;cursor:pointer;text-align:center;white-space:nowrap;justify-content:center;overflow:hidden;position:relative;min-width:120px}.imageSplitViewOutContainer .PanelStudy .SeriesSplit .ThumbnailsSerie .SelectedThumbnail{outline:solid 3.5px #3498db;outline-style:double}`;ResourceBag.Icons8Back32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACCSURBVFhH7ZUxCoAwFEPrIIJXEMHN23hTV10VPYdOXqM1hf/Byc3gkAehNssLLg3iC2KMLTLYlUtKqYP8REareDzkK75rqzlILrnVHCTHuUhOA+IKOZCdLs9AWkA+IRfSW80F4vwXZo3QCEcjHI1wNML524jNKj54wEoMaOwqXgjhBju8anLOJF14AAAAAElFTkSuQmCC";ResourceBag.Icons8Checked32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAADA0lEQVRYhcWXS4iWZRiGr0cHig7aaabpZEjgjBGhLqSyA7aYTU5REJGrSgqiTbQJ2hRtpMNsgqYQ0toEWYJEQW0icuaHloGmI0FakWJpWmNBOlwtvkf7Hb75Dn9/+O7+/72f+77f73kPzwPneUQbsDoA3A2sA1YAS4BTwM/AYWAamI6I0301oI4CzwP3A0uB3cBPKSowDCwDbgH+AHYCmyNipqmRhYSH1C3qKXWXukkdrME/pn6tnlbfVa/oVXyN+qP6rTreQ/wGdb96QF3bNnhcPaluVy9qK97Fs0T9UN2sXqB+rt5XF7QmxV9VW23SCs5F6nvqEXV5FXAoP/v2fokn7wvqX+oddcAtmfOeP3sJ58PqnLpRHVZfXgg4mru99YarEF+r/qm+lL/H0sytZeBt6q4+ii9TD6nvd6dTnVbfmQ8eUI+qT/RJ/FL1G7WjXjhv7nH193PSrK7Pi2OoD+KL1U/U78v41KWpdS/Aovz/LmB3RBz5rwaAieTbUMYXESeAvcBt3QZuorjbS0emqPZKVZ8GngEeiYg9FdC9wPJuA5cBhyoCXgQ66g0V4mPAG8CzEfFZjddjwJXdBurGBHAUmFJHSsRXAh8AkxHxZgO+gTPaZwwcB65dCB0Rx4ExYAb4Sl3VJT4IfAp0gOearCa1fus28B1wXVVERJwExoEp4Ev1zjxiO4FZ4NGImGto4PrUPLuK9XlD1R7DPGZb88H6Qj2s3thQmLyO59R75pP+om5qSBLqa/nA3N5UPGOfUn/N8u6ciW3qVEuy0Tb4jOmoW8smVqh/qw+0JW0h/lA+eCsXAryt7lMv/h/EL1Fn1Mkq0JB6UP2ozwVJqDss6sOr6sCr1Vn19X6YSPGJ5FxVH8HZinbWoqDsOR352XckV3UxWhK8OtOxr5eNqT6YOT/QeOUlJIPqW7lzp9Un1asr8MOJ6eSJmqzLedPWbIR/W7PLgT3ADxStGcA1FK3ZzRR3/MfAK01as7bN6WKKYmMdMELRnAKcAPZTvBNTLd6E8z/+AZ9owaOJ8ea4AAAAAElFTkSuQmCC";ResourceBag.Icons8Forward32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAB6SURBVFhH7Y6xCYBQDAU/NhaCO9joQNauYekwLuFCWjiCFolPSMDORvIt3sFBSHMvkTdUtRCRAZb2igXhCq5wyTmigxtHcITDEQ7CLUfccITzpxE7nO0VC8I9POForzge8clecTDOeCiMMx4KojU8ssQdxBs7ycekdAEzfUZuiLGv7AAAAABJRU5ErkJggg==";ResourceBag.Icons8MergeFiles32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAB9klEQVRYheWWPWtVQRCGn9d7r/kFwUJS2EZbrRSiWJrCwo9C+/gLbG0iIhIQElSw0Sio2NmkSCOxtBEhldr40RvSJOp9LXbFw3HP5t4991joVMvO7MyzuzM7C/+76NfA9gHgMtBr4W8IPJb0ZdQF/cr4AnAd+NgC4CBhAzdKAHrAO0mzpdFtv2bME9zX4GjG9qVSkNYAwBzwwPZCXWH7mu3TkwLopyYlrdqeAu7Z7klaqajPA1+B9c4AIsR920QISVqeRMCRARIQdAGRBUhB/HWACsQAWAa+5UyBE7avZmxMeKw+ZwFsLwIXa9PfgakG+/2EN2AaOJcBOAzsALezAMAGsNWge1ULvgAMgGOSdjM+sb1JpfxzVbAGrOWcRYcC5oEXewVPyUg5kAl+BZgFzkgqytCml3CU4IrBN0uDQ+EJxDufp8XOiwFitg8Id+7K/FHgVMOyNzGnsgBD4FBsqU0iQqmlsv044R+wC3yq6Z7QkNBVgOeEGlfKMMpJYDqT7TuE07kl6U7Gz58A8WW6mTO23QfOZkw+AEv87qJ79o5WZZiSWu9wrZV3D5CAIAfRCcA4EJMEeAs8S0D0gRXbW5JWOwOQtE7imybpru1t4GVqXWdXUIN41KQbF2AIHLH9vgXPDPCjFOAh4VNS3MRi8Kct1v9j8hNJgMtHcDkBzAAAAABJRU5ErkJggg==";ResourceBag.Icons8Plan32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAArFJREFUWAm1l79rFUEQx99TEZUUGlCCIJJS0EIUO0VECRJJETCFotgpCNpZpNc/QYw2QkRCAilsQrBLCjEgdtEqEm1SpAzxB8bn53vuXvbu9t7uvpwDw/zamfnu7Lu9e61WJHU6nQU4lhYiy7badiGV96Dfgq/Du6zfkefQ5+GXjs+n3sE5BC95gn/wzcCT7Xb7t+JqamkM5Sn8At6yTkeeRF8hUSBqiY1cILgJf/Is2o1PPX7CrxV3ARzB/kKDBxQ5gH5cCxw67+ghdY0Fz0uLVqm9Se3L+NUrIxeA9UmegX3n2HX3TgHlLzu2VE1mseQrTKAck30C/m4C08j77OCmsevEQQI6/zGzYD/SdxxZuG4CJrf1VWOTQePHiAEbCMg18la1xhxn7fIQgDyRgm9yo0ElGkBdT3aos33oiT8D9FuPv+BKAkCz02QPUnjWqaJHat2xrfrDKt1kEgAKXYVH4RwAYN5ji3uiKABm52p+ER7AHkfqUppC1wU1ApdpjvjHsrNsRwEgaRDWzvUUHDL6O+QUfMzYiAJ9xmoGgDnzWbPzUeyzthX6HLq4J4qdgC2+gqKd5wSooxincse2sgy4b9umX0sCQEGNXOzSJYxJ12H0u8jy+6CyLAlAJRsHoF4hxD1RFADGvI/qfYkdNgAXvAuiAND4NjyRCKDRI9DF8yERQPYyCuVETYBR6qr1Xbeh+sF4FAB+Azeo9CRYrbhgHODZZ1fRXbSiAJCiGy0VQPAWFJQoAOxEXzS1XzUq1CtFAeAIrtDgXmKTRr8H9Dyn/giDd4A2FDUBjkBfs5UvWhXYKYUAPGL8v3bYZG+3/DoAGyTp4rnWLTkhplqqWSEvAEauRyh/51eyGnS4AKQfZuTDyOyPY4N9bKmsB4bb91+Mxv3wBLwF/y9SbfXot4j+AnduMjnJzAGnAAAAAElFTkSuQmCC";ResourceBag.Icons8SplitFiles32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAB+0lEQVRYheWWv08UQRTHP+84foQYYoMWhMIWtJLQWdhLYUGsbExIwIbSgp6gjTHxIiTEwsSCBCtKEisrg7EwodLKwB9ACAkE7msxczhudvZ2do8r8FW7OzPv+9n35r0Z+N/NOg+SbgNPgYEa/trARzM7LLugGTw/AVaB3zUAJnA/sFYFYAD4aWZTVdUl7ZEYwWbeR0k3gZnImiMz+5rIlgYA3AN2I2PfiMP1DCC0FeBd8H7RK/EyAMvAa1zY3/ZSuCzAJnACbEjiKiC6psDMNiXhIWRmrb4CBBBNoCXpwszWY1OBB5JeFLgTrlkdFAEc43Z7O4BY95Fo+XT8AyFpCNcDxoH5AoBp4BR4EwUws+/klFoAcZYRXwQGgVkzO8uuy8zdBxqd91IpyEJkHBowB+x0E8+zZICM+BIwBTwyM1Xx0eg+JSpuXny/qjhUjIDP+Rw1/rxjyRHwu30Ql3MF3595sCQLI9AG7vgjNWaGK7W83T5ETolKGgG+AAu+uqIA28AwwS0pxx4C43m7vaBPNID7wI08h5cAvjO9KhDHd8PHsXEPcY5r280yZ0etMoxAhGcHwPu+AmQhgNG+AUga4++d8BNwC3jZNwDgM27DlbZeAzwHxiJjP64coMptORWgDdyV9CtVKLBJgottKsAH4Jwah5gX36qx/prZH8mYuB3IfDUYAAAAAElFTkSuQmCC";ResourceBag.ImageSplitLanguageJson={en:{splitStudy:"Split",removeOfStudy:"to Left",addToStudy:"to Right",editDemograStudy:"Edit",mergeStudy:"Merge"},es:{splitStudy:"Cortar",removeOfStudy:"Izquierda",addToStudy:"Derecha",editDemograStudy:"Editar",mergeStudy:"Unir"}};e.ResourceBag=ResourceBag})(t=e.ImageSplitView||(e.ImageSplitView={}))})(t=e.ClientViews||(e.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(e){var t;(function(t){var i;(function(t){var i=e.Frontend.WebClient;class ThumbnailImage{constructor(e,t,i,a){this.panelStudy=e;this.SerieGuid=t;this.ImageGuid=i;this.Thumbnail=a;this.WasRender=false;this.Selected=false}Render(){this.Element=document.createElement("div");this.IdElement="thumb_"+this.ImageGuid;this.Element.id=this.IdElement;i.DOMUtils.AddClass(this.Element,"ThumbnailElement");var e=new Image;e.src=this.Thumbnail;this.Element.appendChild(e);this.Element.addEventListener("click",(e=>{this.panelStudy.ImageSplitView.UnSelectAllThumbnails(this.ImageGuid);this.SetSelected(!this.Selected)}),false);this.Parent.appendChild(this.Element);this.WasRender=true}SetSelected(e){this.Selected=e;if(e)i.DOMUtils.AddClass(this.Element,"SelectedThumbnail");else i.DOMUtils.RemoveClass(this.Element,"SelectedThumbnail")}}t.ThumbnailImage=ThumbnailImage})(i=t.ImageSplitView||(t.ImageSplitView={}))})(t=e.ClientViews||(e.ClientViews={}))})(Efferent||(Efferent={}));