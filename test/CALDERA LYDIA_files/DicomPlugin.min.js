var __awaiter=this&&this.__awaiter||function(e,t,n,o){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function fulfilled(e){try{step(o.next(e))}catch(e){s(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){s(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))};var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class AngleAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["Label"]=new Array;this.SnapPoints=new Array;this.Vectors={};this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=true;this.FactorScale=1}Render(){if(!this.Visible)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=16/o;e.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;e.strokeStyle=this.Status===n.EAnnotationStatus.Complete?t.Colors.SunFlower:t.Colors.SunFlower;e.strokeStyle=this.Selected===true?t.Colors.Emerald:e.strokeStyle;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var u=this.Points["EndPoints"];var c=this.Points["Label"];if(u.length===2){e.dashedLine(e,u[0].X,u[0].Y,u[1].X,u[1].Y,0)}else if(u.length===3){e.dashedLine(e,u[0].X,u[0].Y,u[1].X,u[1].Y,0);e.beginPath();e.moveTo(u[0].X,u[0].Y);e.lineTo(u[1].X,u[1].Y);e.lineTo(u[2].X,u[2].Y);e.stroke();if(this.Status!==n.EAnnotationStatus.Complete){var d=this.CalculateBisectorCoordinates();this.Points["Label"][0]=new n.AnnotationPoint(d)}}if(this.Status===n.EAnnotationStatus.Complete){if(c.length===1){e.dashedLine(e,u[1].X,u[1].Y,c[0].X,c[0].Y,3/o);var m=this.MeasureAnnotation(u[0],u[1],u[2]);var S=this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,u[1].X,u[1].Y,c[0].X,c[0].Y,m,l);this.TextboxLabel[0]={X0:S.X0,X1:S.X1,Y0:S.Y0,Y1:S.Y1,Text:m}}this.fillSnapPoints()}if(this.Selected)this.DrawGrips();if(this.ShowSnaps){this.DrawSnaps()}}DrawIsValid(){var e=false;var t=3;var o;var s=this.Context.CurrentAnnotation.Points["EndPoints"];if(s.length===2){o=n.Geometry.GetRealDistance(s[0],s[1],this.Context);e=o>t}else if(s.length===4){o=n.Geometry.GetRealDistance(s[2],s[3],this.Context);e=o>t}else e=true;return e}VectorsCalculate(){if(this.Points["EndPoints"].length>=2){var e=new n.AnnotationVector;e.Point1=this.Points["EndPoints"][1];e.Point2=this.Points["EndPoints"][0];var t=new n.AnnotationVector;t.Point1=this.Points["EndPoints"][1];t.Point2=this.Points["EndPoints"][2]||this.TemporalPoint;var o=new n.AnnotationVector;o.Point1=this.Points["EndPoints"][2]||this.TemporalPoint;o.Point2=this.Points["EndPoints"][0];e.Calculator();t.Calculator();o.Calculator();this.Vectors["Vector1"]=e;this.Vectors["Vector2"]=t;this.Vectors["Vector3"]=o}}CalculateBisectorCoordinates(){var e=this.Points["EndPoints"];var n=this.Vectors;var o=new t.Point(null,null);if(e.length>=2){this.VectorsCalculate();this.MeasureAnnotation(e[0],e[1],e[2]||this.TemporalPoint);var s=Math.abs(n["Vector1"].Distance/(n["Vector1"].Distance+n["Vector2"].Distance));var l=n["Vector1"].Vector.X-s*n["Vector3"].Vector.X;var u=n["Vector1"].Vector.Y-s*n["Vector3"].Vector.Y;if(this.Angle>10){o.X=e[1].X+l;o.Y=e[1].Y+u}else{o.X=e[1].X-l;o.Y=e[1].Y-u}}return o}HitTest(e,t){var o=this.Points["EndPoints"];if(n.Geometry.PointToLine(e.X,e.Y,o[0].X,o[0].Y,o[1].X,o[1].Y)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"};if(n.Geometry.PointToLine(e.X,e.Y,o[2].X,o[2].Y,o[1].X,o[1].Y)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:"2,2-1,1"};return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(e){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],e);return false}DrawGrips(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(e,n,t);this.Context.Viewport.AnnotationManager.DrawGrips(e,[o[0]],t)}DrawSnaps(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);this.Context.Viewport.AnnotationManager.DrawSnapsPoints(e,this.SnapPoints,t)}MeasureAnnotation(e,n,o){var s;var l=this.Points["EndPoints"];var u=this.Context.ImageEntity["pixelSpacing"][0];var c=this.Context.ImageEntity["pixelSpacing"][1];if(e===undefined||e===null)e=l[0];if(n===undefined||n===null)n=l[1];if(o===undefined||o===null)o=l[2];var d=new t.Point(e.X*u,e.Y*c);var m=new t.Point(n.X*u,n.Y*c);var S=new t.Point(o.X*u,o.Y*c);var C=Math.sqrt(Math.pow(m.X-d.X,2)+Math.pow(m.Y-d.Y,2));var p=Math.sqrt(Math.pow(m.X-S.X,2)+Math.pow(m.Y-S.Y,2));var A=Math.sqrt(Math.pow(S.X-d.X,2)+Math.pow(S.Y-d.Y,2));var f=Math.acos((p*p+C*C-A*A)/(2*p*C));this.Angle=Math.floor(f*180/Math.PI);s=Math.floor(f*180/Math.PI)+"°";return s}GetTemplate(){var t=e.ResourceBag.AngleTemplateJson;return t}EvaluatePointDragMoveAndEnd(e,t,n){return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";var t={Angle:this.Angle,Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};e=JSON.stringify(t);return e}Deserialize(e){var t=JSON.parse(e);this.Id=t["Id"]||t["id"];this.Author=t["Author"]||t["author"];this.Date=t["Date"]||t["date"];this.Type=t["Type"]||t["type"];this.Plugin=t["Plugin"]||t["plugin"];this.Selected=t["Selected"]||t["selected"];this.Status=t["Status"]||t["status"];this.Angle=t["Angle"]||t["angle"];this.TextboxLabel=t["TextboxLabel"]||t["textboxLabel"];this.ColsOrigin=parseInt(t["ColsOrigin"]||t["colsOrigin"]);this.RowsOrigin=parseInt(t["RowsOrigin"]||t["rowsOrigin"]);var o=t["Points"]||t["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=t["Name"]||t["name"]}ConvertPointsWithFactororResolution(e){}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=16/o;e.lineWidth=2/o;e.strokeStyle=this.Selected===true?t.Colors.Emerald:t.Colors.SunFlower;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";var u=this.Points["EndPoints"];var c=this.Points["Label"];if(this.Points[this.TemporalCurrentGroupName].length===1){e.dashedLine(e,u[0].X,u[0].Y,this.TemporalPoint.X,this.TemporalPoint.Y,0)}else if(this.Points[this.TemporalCurrentGroupName].length===2){e.dashedLine(e,u[0].X,u[0].Y,u[1].X,u[1].Y,0);e.beginPath();e.moveTo(u[0].X,u[0].Y);e.lineTo(u[1].X,u[1].Y);e.lineTo(this.TemporalPoint.X,this.TemporalPoint.Y);e.stroke();var d=this.CalculateBisectorCoordinates();this.Points["Label"][0]=new n.AnnotationPoint(d);e.dashedLine(e,u[1].X,u[1].Y,c[0].X,c[0].Y,3/o);var m=this.MeasureAnnotation(u[0],u[1],this.TemporalPoint);this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,u[1].X,u[1].Y,c[0].X,c[0].Y,m,l)}}fillSnapPoints(){}}e.AngleAnnotation=AngleAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class ArrowAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["Label"]=new Array;this.SnapPoints=new Array;this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=true;this.FactorScale=1}Render(){if(!this.Visible)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=16/o;var u=this.Context.ImageEntity["pixelSpacing"][0];var c;var d;var m;e.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;e.strokeStyle=this.Status===n.EAnnotationStatus.Complete?t.Colors.SunFlower:t.Colors.SunFlower;e.strokeStyle=this.Selected===true?t.Colors.Emerald:e.strokeStyle;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var S=this.Points["EndPoints"];var C=this.Points["Label"];var p=10/o;if(S.length===2)e.drawArrow(e,S[1].X,S[1].Y,S[0].X,S[0].Y,p);if(this.TextLabel!==undefined){c=(S[0].X+S[1].X)/2;d=(S[0].Y+S[1].Y)/2;if(S[1].X!==C[0].X||S[1].Y!==C[0].Y){e.dashedLine(e,c,d,C[0].X,C[0].Y,3/o)}var A=this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,c,d,C[0].X,C[0].Y,this.TextLabel,l);this.TextboxLabel[0]={X0:A.X0,X1:A.X1,Y0:A.Y0,Y1:A.Y1,Text:this.TextLabel};this.fillSnapPoints()}if(this.Selected)this.DrawGrips();if(this.ShowSnaps){this.DrawSnaps()}}DrawIsValid(){var e=false;var t=3;var o=this.Context.CurrentAnnotation.Points["EndPoints"];if(o.length===2){var s=n.Geometry.GetRealDistance(o[0],o[1],this.Context);e=s>t}else e=true;return e}HitTest(e,t){var o=this.Points["EndPoints"];if(n.Geometry.PointToLine(e.X,e.Y,o[0].X,o[0].Y,o[1].X,o[1].Y)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"};return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(e){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],e);return false}DrawGrips(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(e,n,t);this.Context.Viewport.AnnotationManager.DrawGrips(e,[o[0]],t)}DrawSnaps(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);this.Context.Viewport.AnnotationManager.DrawSnapsPoints(e,this.SnapPoints,t)}MeasureAnnotation(){return""}GetTemplate(){var t=e.ResourceBag.ArrowTemplateJson;return t}EvaluatePointDragMoveAndEnd(e,t,n){return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";var t={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,TextLabel:this.TextLabel,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};e=JSON.stringify(t);return e}Deserialize(e){var t=JSON.parse(e);this.Id=t["Id"]||t["id"];this.Author=t["Author"]||t["author"];this.Date=t["Date"]||t["date"];this.Type=t["Type"]||t["type"];this.Plugin=t["Plugin"]||t["plugin"];this.Selected=t["Selected"]||t["selected"];this.Status=t["Status"]||t["status"];this.TextLabel=t["TextLabel"]||t["TextLabel"];this.TextboxLabel=t["TextboxLabel"]||t["textboxLabel"];this.ColsOrigin=parseInt(t["ColsOrigin"]||t["colsOrigin"]);this.RowsOrigin=parseInt(t["RowsOrigin"]||t["rowsOrigin"]);var o=t["Points"]||t["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=t["Name"]||t["name"]}ConvertPointsWithFactororResolution(e){}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null)return;if(this.Status===n.EAnnotationStatus.Complete)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=10/o;e.lineWidth=2/o;e.strokeStyle=this.Selected===true?t.Colors.Emerald:t.Colors.SunFlower;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";var u=this.Points["EndPoints"];if(this.Points[this.TemporalCurrentGroupName].length===1){e.drawArrow(e,this.TemporalPoint.X,this.TemporalPoint.Y,u[0].X,u[0].Y,l)}}fillSnapPoints(){}}e.ArrowAnnotation=ArrowAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class EllipseAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["Label"]=new Array;this.SnapPoints=new Array;this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1}Render(){this.evObject=this.Context.EvObject;if(!this.Visible)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;e.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;e.strokeStyle=this.Status===n.EAnnotationStatus.Complete?t.Colors.SunFlower:t.Colors.SunFlower;e.strokeStyle=this.Selected===true?t.Colors.Emerald:e.strokeStyle;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var l=this.Points["EndPoints"];var u=this.Points["Label"];if(l.length===2)e.drawEllipse(e,l[0].X,l[0].Y,l[1].X,l[1].Y);if(this.Status===n.EAnnotationStatus.Complete){if(u.length===1){var c=this.DrawTextLabel(e,l[0],l[1],u[0]);this.TextboxLabel[0]={X0:c.X0,X1:c.X1,Y0:c.Y0,Y1:c.Y1,Text:c.Text}}}if(this.Selected)this.DrawGrips();if(this.ShowSnaps){this.DrawSnaps()}}HitTest(e,t){var n=this.Points["EndPoints"];var o=(n[1].X-n[0].X)/2;var s=(n[1].Y-n[0].Y)/2;var l=Math.atan2((e.Y-(n[0].Y+s))*Math.abs(o/s),e.X-(n[0].X+o));var u=n[0].X+o+Math.cos(l)*Math.abs(o);var c=n[0].Y+s+Math.sin(l)*Math.abs(s);var d=e.X-u;var m=e.Y-c;if(Math.sqrt(d*d+m*m)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:""};return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(e){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],e);return false}DrawGrips(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(e,n,t);this.Context.Viewport.AnnotationManager.DrawGrips(e,[o[0]],t)}DrawSnaps(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);this.Context.Viewport.AnnotationManager.DrawSnapsPoints(e,this.SnapPoints,t)}DrawIsValid(){var e=false;var t=3;var o=this.Context.CurrentAnnotation.Points["EndPoints"];if(o.length===2){var s=n.Geometry.GetRealDistance(o[0],o[1],this.Context);e=s>t}else e=true;return e}MeasureAnnotation(){var e;var t=this.Context.ImageEntity["pixelSpacing"][0];var n=this.Context.ImageEntity["pixelSpacing"][1];var o=this.Context.ImageEntity["pixelSpacing"][2];var s;var l;var u;var c;var d=this.Points["EndPoints"];try{let C=this.Context.Viewport.Context.ImageEntity["dicomTags"]["0002_0010"];let p=this.Context.Viewport.Context.ImageEntity["dicomTags"]["0008_0060"];if(d.length>=1){s=d[0].X*t;l=d[0].Y*n;u=(d[1]||this.TemporalPoint).X*t;c=(d[1]||this.TemporalPoint).Y*n;var m=Math.abs((u-s)*(c-l)*Math.PI/4);e="Area: "+Math.floor(m)+" "+o+"²";if(this.Context.ImageEntity["buffer"]!==null){if(C==="1.2.840.10008.1.2.1"&&p==="CT"){var S=this.Context.Viewport.CalculateHounsfield(d[0],d[1]||this.TemporalPoint);if(S.count>0)e=`${e} \nMean: ${S.median} HU \nStd. Dev.: ${S.stdDev} HU`}}}}catch(t){e=""}return e}GetTemplate(){var t=e.ResourceBag.EllipseTemplateJson;return t}EvaluatePointDragMoveAndEnd(e,t,n){return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";var t={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};e=JSON.stringify(t);return e}Deserialize(e){var t=JSON.parse(e);this.Id=t["Id"]||t["id"];this.Author=t["Author"]||t["author"];this.Date=t["Date"]||t["date"];this.Type=t["Type"]||t["type"];this.Plugin=t["Plugin"]||t["plugin"];this.Selected=t["Selected"]||t["selected"];this.Status=t["Status"]||t["status"];this.TextboxLabel=t["TextboxLabel"]||t["textboxLabel"];this.ColsOrigin=parseInt(t["ColsOrigin"]||t["colsOrigin"]);this.RowsOrigin=parseInt(t["RowsOrigin"]||t["rowsOrigin"]);var o=t["Points"]||t["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=t["Name"]||t["name"]}ConvertPointsWithFactororResolution(e){}GetpointCtrlProjected(){return this.pointCtrlProjected}SetpointCtrlProjected(e){this.pointCtrlProjected=e}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;e.lineWidth=2/o;e.strokeStyle=this.Selected===true?t.Colors.Emerald:t.Colors.SunFlower;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";var l=this.Points["EndPoints"];if(this.Points["EndPoints"].length===1){if(this.evObject&&(this.evObject.ctrlKey===true||this.evObject.metaKey===true)){if(this.Points["EndPoints"].length===1){var u=new n.AnnotationPoint;u=this.TemporalPoint;var c=new n.Vector2D(this.Points["EndPoints"][0],this.TemporalPoint);var d=c.HorizontalComponent();var m=c.VerticalComponent();var S=Math.min(d.Norm(),m.Norm());var C=new n.Vector2D;C.P1=c.P1;C.X=d.Clone().Normalize().ScalarMult(S).X;C.Y=m.Clone().Normalize().ScalarMult(S).Y;C.Recalculate();u=C.P2;this.pointCtrlProjected=u.Clone();this.TemporalPoint=u}}else{this.SetpointCtrlProjected(null)}e.drawEllipse(e,l[0].X,l[0].Y,this.TemporalPoint.X,this.TemporalPoint.Y);var p=40/o;var A=new n.AnnotationPoint;A.X=this.TemporalPoint.X+p;A.Y=this.TemporalPoint.Y+p;this.DrawTextLabel(e,l[0],this.TemporalPoint,A)}else if(l.length>=2){e.drawEllipse(e,l[0].X,l[0].Y,l[1].X,l[1].Y);this.DrawTextLabel(e,l[0],l[1],this.TemporalPoint)}var f=this.Context.Viewport.AnnotationManager.GetAllAnnotationsNearToPoint(this.TemporalPoint.X,this.TemporalPoint.Y);if(f!==null){f.DrawSnaps()}}DrawTextLabel(e,t,n,o){var s=Math.abs(this.Context.ScaleX);var l=16/s;var u=(n.X-t.X)/2;var c=(n.Y-t.Y)/2;var d=Math.atan2((o.Y-(t.Y+c))*Math.abs(u/c),o.X-(t.X+u));var m=t.X+u+Math.cos(d)*Math.abs(u);var S=t.Y+c+Math.sin(d)*Math.abs(c);var C=this.MeasureAnnotation();var p=this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,m,S,o.X,o.Y,C,l);let A=o.Y;if(o.Y>S)A=p.Y0;else A=p.Y1;if(o.X>m)e.dashedLine(e,m,S,p.X0,A,3/s);else e.dashedLine(e,m,S,p.X1,A,3/s);return p}fillSnapPoints(){var e=this.Points["EndPoints"];this.SnapPoints=new Array;this.SnapPoints.push(e[0]);this.SnapPoints.push(e[1]);this.DrawSnaps()}}e.EllipseAnnotation=EllipseAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class LineAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["Label"]=new Array;this.Points["SnapPoints"]=new Array;this.Points["Polar"]=new Array;this.ExportedPoints=[];this.Vectors={};this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=true;this.FactorScale=1;this.IsLineType=true}GetExportedPoints(){if(this.Points["EndPoints"].length===2){this.ExportedPoints[0]=this.Points["EndPoints"][0];this.ExportedPoints[1]=this.Points["EndPoints"][1]}return this.ExportedPoints}Render(){this.evObject=this.Context.EvObject;if(!this.Visible)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=16/o;var u;var c;e.save();e.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;e.strokeStyle=this.Status===n.EAnnotationStatus.Complete?t.Colors.SunFlower:t.Colors.SunFlower;e.strokeStyle=this.Selected===true?t.Colors.Emerald:e.strokeStyle;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var d=this.Points["EndPoints"];if(d.length===2)this.DrawTextLabel(e,d[0],d[1]);if(this.Status===n.EAnnotationStatus.Complete){u=(d[0].X+d[1].X)/2;c=(d[0].Y+d[1].Y)/2;if(!this.Points["Label"]||this.Points["Label"]&&Array.isArray(this.Points["Label"])&&this.Points["Label"].length===0){n.Geometry.SetLabelOnLine(this.Points,d[0],d[1],0,this.Context)}if(d[1].X!==this.Points["Label"][0].X||d[1].Y!==this.Points["Label"][0].Y){e.dashedLine(e,u,c,this.Points["Label"][0].X,this.Points["Label"][0].Y,3/o)}var m=this.MeasureAnnotation(d[0],d[1]);var S=this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,u,c,this.Points["Label"][0].X,this.Points["Label"][0].Y,m,l);this.TextboxLabel[0]={X0:S.X0,X1:S.X1,Y0:S.Y0,Y1:S.Y1,Text:m};this.fillSnapPoints();if(this.IsReferenced){this.Selected=false}}this.VectorsCalculate();if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}e.restore()}DrawIsValid(){var e=false;var t=3;var o=this.Context.CurrentAnnotation.Points["EndPoints"];if(o.length===2){var s=n.Geometry.GetRealDistance(o[0],o[1],this.Context);e=s>t}else e=true;return e}VectorsCalculate(){if(this.Points["EndPoints"].length===2){var e=new n.AnnotationVector;e.Point1=this.Points["EndPoints"][0];e.Point2=this.Points["EndPoints"][1];e.Calculator();this.Vectors["VectorA"]=e}if(this.Status===n.EAnnotationStatus.Complete){var t=new n.AnnotationVector;t.Point1=this.Points["EndPoints"][1];t.Point2=this.Points["Label"][0];t.Calculator();this.Vectors["VectorB"]=t}}HitTest(e,t){var o=this.Points["EndPoints"];if(n.Geometry.PointToLine(e.X,e.Y,o[0].X,o[0].Y,o[1].X,o[1].Y)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"};return{isFound:false,groupName:null,endRangePoints:""}}DrawGrips(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(e,n,t);this.Context.Viewport.AnnotationManager.DrawGrips(e,[o[0]],t)}DrawSnaps(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(e,n,t)}EvaluateAnnotationTextInCanvas(e){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return Efferent.ClientViews.ImagingStudyView.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],e);return false}MeasureAnnotation(e,t){var n="";var o=this.Context.ImageEntity["pixelSpacing"][0];var s=this.Context.ImageEntity["pixelSpacing"][1];var l=this.Context.ImageEntity["pixelSpacing"][2];var u;var c;var d;var m;var S=this.Points["EndPoints"];if(e===undefined||e===null)e=S[0];if(t===undefined||t===null)t=S[1];u=e.X*o;c=e.Y*s;d=t.X*o;m=t.Y*s;var C=Math.sqrt((d-u)*(d-u)+(m-c)*(m-c));n=parseFloat(C.toFixed(1))+" "+l;return n}GetTemplate(){var t=e.ResourceBag.LineTemplateJson;return t}EvaluatePointDragMoveAndEnd(e,t,n){Efferent.ClientViews.ImagingStudyView.Geometry.CalculateTextWithPoints(this.Points,e,t,n,this.Context);return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";var t={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,Step:this.Step,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};e=JSON.stringify(t);return e}Deserialize(e){var t=JSON.parse(e);this.Id=t["Id"]||t["id"];this.Author=t["Author"]||t["author"];this.Date=t["Date"]||t["date"];this.Type=t["Type"]||t["type"];this.Plugin=t["Plugin"]||t["plugin"];this.Selected=t["Selected"]||t["selected"];this.Status=t["Status"]||t["status"];this.Step=t["Step"]||t["step"];this.TextboxLabel=t["TextboxLabel"]||t["textboxLabel"];this.ColsOrigin=parseInt(t["ColsOrigin"]||t["colsOrigin"]);this.RowsOrigin=parseInt(t["RowsOrigin"]||t["rowsOrigin"]);var o=t["Points"]||t["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=t["Name"]||t["name"]}ConvertPointsWithFactororResolution(e){}GetpointCtrlProjected(){return this.pointCtrlProjected}SetpointCtrlProjected(e){this.pointCtrlProjected=e}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=5/o;var u=16/o;var c=10;var d;var m;e.lineWidth=2/o;e.strokeStyle=this.Selected===true?t.Colors.Emerald:t.Colors.SunFlower;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";var S=this.Points["EndPoints"];if(this.Points[this.TemporalCurrentGroupName].length===1){if(this.evObject&&(this.evObject.ctrlKey===true||this.evObject.metaKey===true)){if(this.Points["EndPoints"].length===1){var C=new n.Vector2D(this.Points["EndPoints"][0],this.TemporalPoint);var p=new n.AnnotationPoint;p=this.TemporalPoint;if(Math.abs(C.AngleDeg()%90)<c){if(Math.abs(C.X)>Math.abs(C.Y)){p.X=C.P2.X;p.Y=C.P1.Y}else{p.X=C.P1.X;p.Y=C.P2.Y}this.pointCtrlProjected=p.Clone();this.TemporalPoint=p}var A=C.Clone().Normalize().ScalarMult(2.2*l);e.dashedLine(e,this.TemporalPoint.X+A.X+l,this.TemporalPoint.Y+A.Y,this.TemporalPoint.X+A.X+l,this.TemporalPoint.Y+A.Y-2*l,0);e.dashedLine(e,this.TemporalPoint.X+A.X,this.TemporalPoint.Y+A.Y,this.TemporalPoint.X+A.X+2*l,this.TemporalPoint.Y+A.Y,0)}}else{this.SetpointCtrlProjected(null)}this.DrawTextLabel(e,S[0],this.TemporalPoint);d=(S[0].X+this.TemporalPoint.X)/2;m=(S[0].Y+this.TemporalPoint.Y)/2;if(this.TemporalPoint.X!==this.Points["Label"][0].X||this.TemporalPoint.Y!==this.Points["Label"][0].Y){e.dashedLine(e,d,m,this.Points["Label"][0].X,this.Points["Label"][0].Y,3/o)}var f=this.MeasureAnnotation(S[0],this.TemporalPoint);this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,d,m,this.Points["Label"][0].X,this.Points["Label"][0].Y,f,u)}}fillSnapPoints(){var e=this.Points["EndPoints"];var t=new n.AnnotationPoint;t.X=(e[0].X+e[1].X)/2;t.Y=(e[0].Y+e[1].Y)/2;this.Points["SnapPoints"]=new Array;this.Points["SnapPoints"].push(e[0]);this.Points["SnapPoints"].push(e[1]);this.Points["SnapPoints"].push(t)}DrawTextLabel(e,t,o){e.dashedLine(e,t.X,t.Y,o.X,o.Y,0);if(this.Status!==n.EAnnotationStatus.Complete){n.Geometry.SetLabelOnLine(this.Points,t,o,0,this.Context)}}}e.LineAnnotation=LineAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;const o={S:1,M:2,L:3,XL:4};class MarkerAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["SnapPoints"]=new Array;this.UnSelectToExecuteClickOnViewport=true;this.isRestore=false;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1}Render(){if(!this.Visible)return;var e;try{e=this.Context.Viewport.ViewportElement.getContext("2d");var s=Math.abs(this.Context.ScaleX);var l=Math.round(11/s*10)/10;var u=16/s;var c;e.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/s:1/s;e.strokeStyle=this.Status===n.EAnnotationStatus.Complete?t.Colors.SunFlower:t.Colors.SunFlower;e.strokeStyle=this.Selected===true?t.Colors.Emerald:e.strokeStyle;e.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";var d=this.Points["EndPoints"];this.isRestore=false;e.save();e.textBaseline="middle";e.fillStyle="#fff";e.font=l+"pt bold Arial";var m=this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,null,null,d[0].X,d[0].Y,this.TextLabel,u,o[this.LabelSize]);this.TextboxLabel[0]={};this.TextboxLabel[0].X0=m.X0-10;this.TextboxLabel[0].X1=m.X1+10;this.TextboxLabel[0].Y0=m.Y0-5;this.TextboxLabel[0].Y1=m.Y1-5;this.TextboxLabel[0].Text=this.TextLabel;c={x0:this.TextboxLabel[0].X0,x1:this.TextboxLabel[0].X1,x2:this.TextboxLabel[0].X1,x3:this.TextboxLabel[0].X0,y0:this.TextboxLabel[0].Y0,y1:this.TextboxLabel[0].Y0,y2:this.TextboxLabel[0].Y1,y3:this.TextboxLabel[0].Y1};e.strokeStyle=t.Colors.FullBlack;e.fillStyle=t.Colors.FullBlack;e.beginPath();e.moveTo(c.x0,c.y0);e.lineTo(c.x1,c.y1);e.lineTo(c.x2,c.y2);e.lineTo(c.x3,c.y3);e.closePath();e.fill();e.stroke();e.strokeStyle="#fff";m=this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,null,null,d[0].X,d[0].Y,this.TextLabel,u,o[this.LabelSize]);e.restore();this.isRestore=true;this.fillSnapPoints();if(this.Selected)this.DrawGrips();if(this.ShowSnaps){this.DrawSnaps()}}catch(n){if(!this.isRestore&&e!==undefined)e.restore();t.Utils.DebugConsoleLog("Error drawing Marker Annotation")}}DrawIsValid(){var e=false;return e}HitTest(e,t){return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(e){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],e);return false}DrawGrips(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];this.Context.Viewport.AnnotationManager.DrawGrips(e,n,t)}DrawSnaps(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(e,n,t)}MeasureAnnotation(){return""}GetTemplate(){var t=e.ResourceBag.MarkerTemplateJson;return t}EvaluatePointDragMoveAndEnd(e,t,n){return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";if(this.TextboxLabel&&this.TextboxLabel.length>0)this.TextboxLabel[0].Text=encodeURIComponent(this.TextboxLabel[0].Text);var t={Author:this.Author,Date:this.Date,TextLabel:encodeURIComponent(this.TextLabel),Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,TextboxLabel:this.TextboxLabel,LabelSize:this.LabelSize,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};e=JSON.stringify(t);return e}Deserialize(e){var t=JSON.parse(e);this.Id=t["Id"]||t["id"];this.Author=t["Author"]||t["author"];this.Date=t["Date"]||t["date"];this.Type=t["Type"]||t["type"];this.Plugin=t["Plugin"]||t["plugin"];this.Selected=t["Selected"]||t["selected"];this.Status=t["Status"]||t["status"];this.TextboxLabel=t["TextboxLabel"]||t["textboxLabel"];this.LabelSize=t["LabelSize"]||t["LabelSize"];if(this.TextboxLabel&&this.TextboxLabel.length>0)this.TextboxLabel[0].Text=decodeURIComponent(this.TextboxLabel[0].Text);this.TextLabel=decodeURIComponent(t["TextLabel"]||t["TextLabel"]);this.ColsOrigin=parseInt(t["ColsOrigin"]||t["colsOrigin"]);this.RowsOrigin=parseInt(t["RowsOrigin"]||t["rowsOrigin"]);var o=t["Points"]||t["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=t["Name"]||t["name"]}ConvertPointsWithFactororResolution(e){}fillSnapPoints(){}}e.MarkerAnnotation=MarkerAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(t){var n;(function(t){class MarkerOptionsPane{static SetMarker(e){this.Plugin=e;this.DataMarker={};this.Init();if(!this.setMarkerResize){window.addEventListener("resize",(e=>{this.resizeForm()}));this.setMarkerResize=true}this.resizeForm()}static resizeForm(){return}static Init(){this.Plugin.Controller.View.MessageBar.style.width=this.Plugin.Controller.View.Platform.Toolbar.Element.parentElement.parentElement.clientWidth+"px";this.Plugin.Controller.View.MessageBar.style.minHeight=this.Plugin.Controller.View.Platform.Toolbar.Element.parentElement.parentElement.clientHeight+"px";this.Plugin.Controller.SelectTool("Pointer","pointerTool");this.Plugin.Controller.SelectTool("DicomAnnotationMarker","markerTool");this.Plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","lengthTool","optionInMenuPressed");this.Plugin.Controller.UnselectViewports(this.Plugin.Controller.ViewportPane);this.Plugin.Controller.View.TextBar.innerHTML="";this.Plugin.Controller.View.ButtonBar.innerHTML=this.Plugin.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","closeText");var t=new Array;var n="";var o="";for(var s=0;s<this.Plugin.Controller.View.Plugins.length;s++){var l=this.Plugin.Controller.View.Plugins[s].GetMarkers();t=t.concat(l)}for(var u=0;u<t.length;u++){if(t[u]!==null){n+=t[u].Name.trim()+",";if(o==="")o=t[u].Name.trim()}}n=n+"Custom";var c=[this.DataMarker];this.DataMarker["actionSelectOption1"]=(e,n)=>{e.currentTarget.parentElement.parentElement.innerHTML="";var o=n.GetField("selectOption2");var s=n.GetField("selectOption3");var l=n.GetField("textboxCustomMarker");var u=this.DataMarker["selectOption1"].trim();n.GetField("selectOption1")["params"]["value"]=u;var c;for(var d=0;d<t.length;d++){if(t[d]!==null&&t[d].Name.toLowerCase()===u.toLowerCase())c=t[d]}const m=e.currentTarget.value;if(m!=="--"){this.Plugin.Controller.View.Platform.SetSetting(40,"selectMarkerOption1",m);this.Plugin.Controller.View.Platform.SetSetting(40,"selectMarkerOption2","--")}if(c!==undefined){var S=Object.keys(c.Groups).join(",");o["params"]["options"]="--,"+S;o["params"]["values"]="--,"+S;o["params"]["value"]="--";n.GetField("selectOption3")["params"]["options"]="--";n.GetField("selectOption3")["params"]["values"]="--";n.GetField("selectOption3")["params"]["value"]="--"}else{n.GetField("selectOption2")["params"]["options"]="--";n.GetField("selectOption2")["params"]["values"]="--";n.GetField("selectOption2")["params"]["value"]="--";n.GetField("selectOption3")["params"]["options"]="--";n.GetField("selectOption3")["params"]["values"]="--";n.GetField("selectOption3")["params"]["value"]="--"}if(u.toLowerCase()==="custom"){o.styles={display:"none"};s.styles={display:"none"};l.styles={display:"block"}}else{o.styles={display:"block"};s.styles={display:"block"};l.styles={display:"none"}}n.Render()};let d="S";if(this.Plugin.Controller.View.Platform.GetSetting("valueMarkerSize"))d=this.Plugin.Controller.View.Platform.GetSetting("valueMarkerSize");this.DataMarker["optionsCheckSizes"]=["S","M","L","XL"];this.DataMarker["optCheckSizeDefault"]=d;this.DataMarker["actionOnchangeCheckSize"]=e=>{const t=e.currentTarget.bbValue;this.Plugin.Controller.View.Platform.SetSetting(40,"valueMarkerSize",t)};let m="--";let S="--";if(this.Plugin.Controller.View.Platform.GetSetting("selectMarkerOption1")){m=this.Plugin.Controller.View.Platform.GetSetting("selectMarkerOption1");if(m==="Custom"){const e=setTimeout((()=>{document.querySelector(".InnerMessageBar").querySelector("select").dispatchEvent(new Event("change"));clearTimeout(e)}),150)}else{const e=t.find((e=>{var t;return((t=e===null||e===void 0?void 0:e.Name)===null||t===void 0?void 0:t.toLowerCase())===(m===null||m===void 0?void 0:m.toLowerCase())}));if(e&&e.Groups)S="--,"+Object.keys(e.Groups).join(",")}}let C="--";let p="--";if(this.Plugin.Controller.View.Platform.GetSetting("selectMarkerOption2")){C=this.Plugin.Controller.View.Platform.GetSetting("selectMarkerOption2");const e=t.find((e=>{var t;return((t=e===null||e===void 0?void 0:e.Name)===null||t===void 0?void 0:t.toLowerCase())===(m===null||m===void 0?void 0:m.toLowerCase())}));const n=e?Object.keys(e===null||e===void 0?void 0:e.Groups).find((e=>(e===null||e===void 0?void 0:e.toLowerCase())===(C===null||C===void 0?void 0:C.toLowerCase()))):"";if(n&&Array.isArray(e===null||e===void 0?void 0:e.Groups[n]))p="--,"+e.Groups[n].join(",")}this.DataMarker["optionsSelectOption1"]="--,"+n;this.DataMarker["valuesSelectOption1"]="--,"+n;this.DataMarker["valueSelectOption1"]=m;this.DataMarker["actionSelectOption2"]=(e,n)=>{e.currentTarget.parentElement.parentElement.innerHTML="";var o=this.DataMarker["selectOption1"].trim();var s=this.DataMarker["selectOption2"].trim();n.GetField("selectOption2")["params"]["value"]=s;var l;for(var u=0;u<t.length;u++){if(t[u]!==null&&t[u].Name.toLowerCase()===o.toLowerCase()){l=t[u].Groups[s]}}const c=e.currentTarget.value;if(c!=="--")this.Plugin.Controller.View.Platform.SetSetting(40,"selectMarkerOption2",c);if(l!==undefined){var d="";var m="";d=l.join(",");n.GetField("selectOption3")["params"]["options"]="--,"+d;n.GetField("selectOption3")["params"]["values"]="--,"+d;n.GetField("selectOption3")["params"]["value"]="--"}n.Render()};this.DataMarker["optionsSelectOption2"]=S;this.DataMarker["valuesSelectOption2"]=S;this.DataMarker["valueSelectOption2"]=C;this.DataMarker["actionSelectOption3"]=(e,t)=>{e.currentTarget.parentElement.parentElement.innerHTML="";var n=this.DataMarker["selectOption1"].trim();var o=this.DataMarker["selectOption2"].trim();var s=this.DataMarker["selectOption3"].trim();t.GetField("selectOption3")["params"]["value"]=s;t.Render()};this.DataMarker["optionsSelectOption3"]=p;this.DataMarker["valuesSelectOption3"]=p;this.DataMarker["valueSelectOption3"]="--";(new e.Products.DicomPlugin.VueMarkerForm).Create(this.Plugin.Controller.View.TextBar,c);this.Plugin.Controller.View.ActionClickBar=()=>{this.Plugin.Controller.View.MessageBar.style.display="none";this.Plugin.Controller.SelectDefaultTool()};this.Plugin.Controller.View.MessageBar.style.display="block"}}MarkerOptionsPane.setMarkerResize=false;t.MarkerOptionsPane=MarkerOptionsPane})(n=t.DicomPlugin||(t.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){class PolygonAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points["SnapPoints"]=new Array;this.Points={};this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1}Render(){if(!this.Visible)return;if(this.Selected)this.DrawGrips();if(this.ShowSnaps){this.DrawSnaps()}}DrawIsValid(){var e=false;return e}HitTest(e,t){return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(e){return false}DrawGrips(){}DrawSnaps(){}MeasureAnnotation(){return""}GetTemplate(){return null}EvaluatePointDragMoveAndEnd(e,t,n){return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";return e}Deserialize(e){}ConvertPointsWithFactororResolution(e){}fillSnapPoints(){}}e.PolygonAnnotation=PolygonAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class PolylineAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["SnapPoints"]=new Array;this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1;this.ThresholdImportant=2.55;this.AcumulatorShowGripsNumber=5}Render(){if(!this.Visible)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;e.save();e.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;e.strokeStyle=this.Status===n.EAnnotationStatus.Complete?t.Colors.SunFlower:t.Colors.SunFlower;e.strokeStyle=this.Selected===true?t.Colors.Emerald:e.strokeStyle;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var l=this.Points["EndPoints"];if(l&&l.length>0){n.Geometry.RenderCurve(e,l)}if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}e.restore()}DrawIsValid(){var e=false;return e}HitTest(e,t){var o=this.Points["EndPoints"];for(let s=0;s<o.length;s++){if(o[s+1]){if(n.Geometry.PointToLine(e.X,e.Y,o[s].X,o[s].Y,o[s+1].X,o[s+1].Y)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:`${s}, ${s} - ${s+1}, ${s+1}`}}}return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(e){return false}DrawGrips(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];let o=[];for(let e=0;e<n.length;e+=this.AcumulatorShowGripsNumber){if(n[e])o.push(n[e])}this.Context.Viewport.AnnotationManager.DrawGrips(e,o,t*2)}DrawSnaps(){}MeasureAnnotation(){return""}GetTemplate(){var t=e.ResourceBag.PolylineTempateJson;return t}EvaluatePointDragMoveAndEnd(e,t,n){return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";var t={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,Step:this.Step,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};e=JSON.stringify(t);return e}Deserialize(e){var t=JSON.parse(e);this.Id=t["Id"]||t["id"];this.Author=t["Author"]||t["author"];this.Date=t["Date"]||t["date"];this.Type=t["Type"]||t["type"];this.Plugin=t["Plugin"]||t["plugin"];this.Selected=t["Selected"]||t["selected"];this.Status=t["Status"]||t["status"];this.Step=t["Step"]||t["step"];this.TextboxLabel=t["TextboxLabel"]||t["textboxLabel"];this.ColsOrigin=parseInt(t["ColsOrigin"]||t["colsOrigin"]);this.RowsOrigin=parseInt(t["RowsOrigin"]||t["rowsOrigin"]);var o=t["Points"]||t["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=t["Name"]||t["name"]}ConvertPointsWithFactororResolution(e){}fillSnapPoints(){}}e.PolylineAnnotation=PolylineAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class RectangleAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["Label"]=new Array;this.Points["SnapPoints"]=new Array;this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=true;this.FactorScale=1}Render(){if(!this.Visible)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=16/o;var u=this.Context.ImageEntity["pixelSpacing"][0];var c;var d;var m;e.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;e.strokeStyle=this.Status===n.EAnnotationStatus.Complete?t.Colors.SunFlower:t.Colors.SunFlower;e.strokeStyle=this.Selected===true?t.Colors.Emerald:e.strokeStyle;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var S=this.Points["EndPoints"];if(S.length===2){m={x0:S[0].X,x1:S[1].X,x2:S[1].X,x3:S[0].X,y0:S[0].Y,y1:S[0].Y,y2:S[1].Y,y3:S[1].Y};e.beginPath();e.moveTo(m.x0,m.y0);e.lineTo(m.x1,m.y1);e.lineTo(m.x2,m.y2);e.lineTo(m.x3,m.y3);e.closePath();e.stroke();this.fillSnapPoints();if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}}}DrawIsValid(){var e=false;var t=3;var o=this.Context.CurrentAnnotation.Points["EndPoints"];if(o.length===2){var s=n.Geometry.GetRealDistance(o[0],o[1],this.Context);e=s>t}else e=true;return e}HitTest(e,t){var o=this.Points["EndPoints"];var s={x0:o[0].X,x1:o[1].X,x2:o[1].X,x3:o[0].X,y0:o[0].Y,y1:o[0].Y,y2:o[1].Y,y3:o[1].Y};if(n.Geometry.PointToLine(e.X,e.Y,s.x0,s.y0,s.x1,s.y1)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,0"};else if(n.Geometry.PointToLine(e.X,e.Y,s.x1,s.y1,s.x2,s.y2)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:"1,0-1,1"};else if(n.Geometry.PointToLine(e.X,e.Y,s.x2,s.y2,s.x3,s.y3)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:"1,1-0,1"};else if(n.Geometry.PointToLine(e.X,e.Y,s.x3,s.y3,s.x0,s.y0)<t)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,1-0,0"};return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(e){return false}DrawGrips(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];this.Context.Viewport.AnnotationManager.DrawGrips(e,n,t)}DrawSnaps(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawGrips(e,n,t)}MeasureAnnotation(){return""}GetTemplate(){var t=e.ResourceBag.RectangleTemplateJson;return t}EvaluatePointDragMoveAndEnd(e,t,n){return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";var t={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};e=JSON.stringify(t);return e}Deserialize(e){var t=JSON.parse(e);this.Id=t["Id"]||t["id"];this.Author=t["Author"]||t["author"];this.Date=t["Date"]||t["date"];this.Type=t["Type"]||t["type"];this.Plugin=t["Plugin"]||t["plugin"];this.Selected=t["Selected"]||t["selected"];this.Status=t["Status"]||t["status"];this.TextboxLabel=t["TextboxLabel"]||t["textboxLabel"];this.ColsOrigin=parseInt(t["ColsOrigin"]||t["colsOrigin"]);this.RowsOrigin=parseInt(t["RowsOrigin"]||t["rowsOrigin"]);var o=t["Points"]||t["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=t["Name"]||t["name"]}ConvertPointsWithFactororResolution(e){}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete){this.fillSnapPoints();return}var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=16/o;var u=this.Context.ImageEntity["pixelSpacing"][0];var c;var d;var m;e.lineWidth=2/o;e.strokeStyle=this.Selected===true?t.Colors.Emerald:t.Colors.SunFlower;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";var S=this.Points["EndPoints"];if(this.Points[this.TemporalCurrentGroupName].length===1){m={x0:S[0].X,x1:this.TemporalPoint.X,x2:this.TemporalPoint.X,x3:S[0].X,y0:S[0].Y,y1:S[0].Y,y2:this.TemporalPoint.Y,y3:this.TemporalPoint.Y};e.beginPath();e.moveTo(m.x0,m.y0);e.lineTo(m.x1,m.y1);e.lineTo(m.x2,m.y2);e.lineTo(m.x3,m.y3);e.closePath();e.stroke()}var C=this.Context.Viewport.AnnotationManager.GetAllAnnotationsNearToPoint(this.TemporalPoint.X,this.TemporalPoint.Y);if(C!==null){C.DrawSnaps()}}fillSnapPoints(){var e=this.Points["EndPoints"];this.Points["SnapPoints"]=new Array;this.Points["SnapPoints"].push(e[0]);this.Points["SnapPoints"].push(e[1])}}e.RectangleAnnotation=RectangleAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class TextAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.DicomPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["SnapPoints"]=new Array;this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1}Render(){if(!this.Visible)return;var e=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var s=Math.round(11/o*10)/10;var l=16/o;e.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;e.strokeStyle=this.Status===n.EAnnotationStatus.Complete?t.Colors.SunFlower:t.Colors.SunFlower;e.strokeStyle=this.Selected===true?t.Colors.Emerald:e.strokeStyle;e.font=s+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=t.Colors.SunFlower;e.textAlign="center";e.textBaseline="bottom";var u=this.Points["EndPoints"];var c=this.Context.Viewport.AnnotationManager.DrawAnnotationText(e,null,null,u[0].X,u[0].Y,this.TextLabel,l);this.TextboxLabel[0]={};this.TextboxLabel[0].X0=c.X0;this.TextboxLabel[0].X1=c.X1;this.TextboxLabel[0].Y0=c.Y0;this.TextboxLabel[0].Y1=c.Y1;this.TextboxLabel[0].Text=this.TextLabel;if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}}DrawIsValid(){var e=true;return e}HitTest(e,t){return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(e){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],e);return false}DrawGrips(){var e=this.Context.Viewport.ViewportElement.getContext("2d");var t=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(e,n,t)}DrawSnaps(){}MeasureAnnotation(){return""}GetTemplate(){var t=e.ResourceBag.TextTemplateJson;return t}EvaluatePointDragMoveAndEnd(e,t,n){return true}DonePointDragMoveAndEnd(e,t,n){}Serialize(){var e="";var t={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,Step:this.Step,TextLabel:this.TextLabel,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};e=JSON.stringify(t);return e}Deserialize(e){var t=JSON.parse(e);this.Id=t["Id"]||t["id"];this.Author=t["Author"]||t["author"];this.Date=t["Date"]||t["date"];this.Type=t["Type"]||t["type"];this.Plugin=t["Plugin"]||t["plugin"];this.Selected=t["Selected"]||t["selected"];this.Status=t["Status"]||t["status"];this.Step=t["Step"]||t["step"];this.TextLabel=t["TextLabel"]||t["TextLabel"];this.TextboxLabel=t["TextboxLabel"]||t["textboxLabel"];this.ColsOrigin=parseInt(t["ColsOrigin"]||t["colsOrigin"]);this.RowsOrigin=parseInt(t["RowsOrigin"]||t["rowsOrigin"]);var o=t["Points"]||t["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=t["Name"]||t["name"]}ConvertPointsWithFactororResolution(e){}fillSnapPoints(){}}e.TextAnnotation=TextAnnotation})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class VueConfigDicomForm{Create(e,o,s){var l=new Array;var u=document.createElement("div");n.AddClass(u,"section");u.setAttribute("id","sectionViewportsLayout");u.style.display="block";n.AddClass(u,"GeneralSection");var c=document.createElement("div");n.AddClass(c,"block");c.setAttribute("id","viewportsBlock");u["viewports"]=c;var d=new t.Form(c,o[0],s);d.AddField(new t.Field(t.EFieldType.Group,"",{text:"Viewport population"},{},[]));d.AddField(new t.Field(t.EFieldType.Checkbox,"chkAutomaticViewportPopulation",{label:"Automatic viewport population",checked:o[0].chkAutomaticPopulation,action:o[0].chkActionAutomaticViewportPopulation,newline:true},{width:"220px"},[]));d.AddField(new t.Field(t.EFieldType.ButtonBar,"buttonBarFirstSeriesPopulate",{options:o[0].optionsFirstSeriesPopul,name:"radiobbseriespop",id:"bbconfigSeriesPopul",optionchecked:o[0].checkedFirstSeriesPopul,onChange:o[0].actionOnchangeFirstSeriesPopul},{display:"inline-block"},[]));d.AddField(new t.Field(t.EFieldType.Label,"textBtBarseriespop",{text:"First series to populate",colon:false,width:110},{width:"auto",display:"inline-block",margin:"0 0 0 10px"},[]));d.Render();u.appendChild(c);e.appendChild(u);l.push(u);var m=document.createElement("div");n.AddClass(m,"section");n.AddClass(m,"GeneralSection");var c=document.createElement("div");n.AddClass(c,"block");m["windowlevel"]=c;var d=new t.Form(c,o[1],s);d.AddField(new t.Field(t.EFieldType.Group,"",{text:"Window-Level"},{},[]));d.AddField(new t.Field(t.EFieldType.Label,"textWindow",{text:"Window",newline:true,colon:false,width:110},{width:"auto"},[]));d.AddField(new t.Field(t.EFieldType.SelectBox,"selectWlWindow",{options:o[1].optionsWl,values:o[1].valuesWl,value:o[1].valueWl,newline:true,action:o[1].actionWlWindow},{width:"160px"},[]));d.AddField(new t.Field(t.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"20px;",width:"-webkit-fill-available"},[]));d.AddField(new t.Field(t.EFieldType.Label,"textLevel",{text:"Level",newline:true,colon:false,width:110},{width:"auto"},[]));d.AddField(new t.Field(t.EFieldType.SelectBox,"selectWlLevel",{options:o[1].optionsWLevel,values:o[1].valuesWLevel,value:o[1].valueWLevel,action:o[1].actionWlLevel},{width:"160px"},[]));d.Render();m.appendChild(c);e.appendChild(m);l.push(m);return l}}e.VueConfigDicomForm=VueConfigDicomForm})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class VueMarkerForm{Create(e,o,s){var l=new Array;var u=document.createElement("div");n.AddClass(u,"section");var c=document.createElement("div");n.AddClass(c,"block");u["markers"]=c;var d=new t.Form(c,o[0],s);d.AddField(new t.Field(t.EFieldType.Group,"",{text:""},{},[]));d.AddField(new t.Field(t.EFieldType.SelectBox,"selectOption1",{action:o[0].actionSelectOption1,options:o[0].optionsSelectOption1,values:o[0].valuesSelectOption1,value:o[0].valueSelectOption1},{},[]));d.AddField(new t.Field(t.EFieldType.SelectBox,"selectOption2",{action:o[0].actionSelectOption2,options:o[0].optionsSelectOption2,values:o[0].valuesSelectOption2,value:o[0].valueSelectOption2},{},[]));d.AddField(new t.Field(t.EFieldType.SelectBox,"selectOption3",{action:o[0].actionSelectOption3,options:o[0].optionsSelectOption3,values:o[0].valuesSelectOption3,value:o[0].valueSelectOption3},{},[]));d.AddField(new t.Field(t.EFieldType.Textbox,"textboxCustomMarker",{id:"textboxCustomMarker",newline:false},{display:"none"},["stringInputType","inputType"]));d.AddField(new t.Field(t.EFieldType.ButtonBar,"buttonBarCheckSize",{options:o[0].optionsCheckSizes,name:"radiobbSizes",id:"bbconfigSizes",optionchecked:o[0].optCheckSizeDefault,onChange:o[0].actionOnchangeCheckSize},{},[]));d.Render();u.appendChild(c);e.appendChild(u);l.push(u);return l}}e.VueMarkerForm=VueMarkerForm})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class CineManager{static OpenUICine(n){this.Plugin=n;this.getSelectedViewport();this.processIDExecute=[];if(this.SelectedCineViewport){if(this.allImagesWereProcessed()){if(this.CineImageNumber>this.SelectedCineViewport.Context.TotalImages-1){this.CineImageNumber=0;this.CineSubImageNumber=0}this.IsReversePlayBack=false;this.cineView=new e.CineView(this.Plugin.Controller.View.Platform.Toolbar.Element.parentElement.parentElement,this.Plugin);this.Plugin.Controller.View.Platform.Toolbar.Element.parentElement.parentElement.style.display="none";this.setCine();setTimeout((()=>{this.cineView.SetCineIcon()}),50);this.Plugin.Controller.View.Platform.ResizeListeners.push(new t.ResizeStructure(this.cineView.constructor.name.toLowerCase(),this.cineView,this.Plugin.Controller.View.ViewName))}else{t.Toaster.ShowToast("The images are still being processed. Please wait.",t.Colors.Alizarin,6)}}else{t.Toaster.ShowToast("Please select a viewport.",t.Colors.Alizarin,6)}}static CloseUICine(){n.RemoveItem(this.cineView.Element);let t=this.Plugin.Controller.View.Platform.ResizeListeners.findIndex((t=>t.ClassInstance instanceof e.CineView));if(t>=0)this.Plugin.Controller.View.Platform.ResizeListeners.splice(t,1);this.cineView.Slider=null;this.cineView=null;this.Plugin.Controller.View.Platform.Toolbar.Element.parentElement.parentElement.style.display="flex";this.Plugin.Controller.View.Platform.Toolbar.ManageButtonMore();if(this.IsCineActive)this.setCine();this.StopCine()}static StopCine(){this.SelectedCineViewport.Context.ImageIndex=0;this.SelectedCineViewport.Context.ImageSubIndex=0;this.PauseCine();this.controlImage()}static PlayCine(){this.setCine()}static PauseCine(){this.IsCineActive=false;this.CineImageNumber=this.SelectedCineViewport.Context.ImageIndex;this.CineSubImageNumber=this.SelectedCineViewport.Context.ImageSubIndex;this.SelectedCineViewport.EnableActionsOnViewport=true;clearTimeout(this.SetCineInterval);try{this.processIDExecute.forEach((e=>clearTimeout(e)));this.processIDExecute=[]}catch(e){}this.Plugin.Controller.SelectTool("Pointer","pointerTool")}static StartCine(){if(this.IsCineActive){if(this.CineFPS>0){this.SetCineInterval=setTimeout((()=>{this.playCine()}),1/this.CineFPS*1e3);this.processIDExecute.push(this.SetCineInterval)}else{this.PauseCine();this.cineView.SetCineIcon()}}}static getSelectedViewport(){var n=this.Plugin.Controller.GetSelectViewport(this.Plugin.Controller.ViewportPane);if(n!==null){if(n instanceof e.DicomViewport&&n.Context.ImageEntity!==null){this.SelectedCineViewport=n}else{t.Toaster.ShowToast("The cine tool was closed because the selected viewport does not contain images.",t.Colors.Alizarin,6)}}}static setCine(e){this.getSelectedViewport();if(!this.SelectedCineViewport)return;if(!this.IsCineActive){this.IsCineActive=true;this.CineImageNumber=this.SelectedCineViewport.Context.ImageIndex;this.CineSubImageNumber=this.SelectedCineViewport.Context.ImageSubIndex;this.StartCine()}else{this.IsCineActive=false;this.StopCine();this.Plugin.Controller.SelectTool("Pointer","pointerTool")}}static playCine(){if(this.SelectedCineViewport!==null){if(this.SelectedCineViewport.Context.ImageEntity!==null){try{this.SelectedCineViewport.EnableActionsOnViewport=false;var n;try{n=this.SelectedCineViewport.Context.ImageEntity["dicomTags"]["0028_0008"]}catch(e){n=1}var o=this.SelectedCineViewport.Context.TotalImages;if(n===undefined||n.toString()==="1"){this.controlImage()}else{n=this.SelectedCineViewport.Context.ImageEntity["bufferArray"];if(n!==undefined&&n.length>0){var s=this.SelectedCineViewport.Context.ImageEntity["dicomTags"]["0018_0040"];if(s!==undefined)this.CineFPS=parseInt(s);if(this.CineSubImageNumber>=0&&this.CineSubImageNumber<n.length){if(this.CineImageNumber>=o)this.CineImageNumber=o-1;this.SelectedCineViewport.SetImageInViewport(this.CineImageNumber,this.CineSubImageNumber);this.SelectedCineViewport.ZoomToFit();if(this.IsReversePlayBack)this.CineSubImageNumber--;else this.CineSubImageNumber++}else{this.CineFPS=this.DefaultFPS;if(this.IsReversePlayBack)this.CineImageNumber--;else this.CineImageNumber++;this.controlImage();this.CineSubImageNumber=0}}}try{clearTimeout(this.SetCineInterval)}catch(e){}this.StartCine()}catch(n){t.Utils.DebugConsoleLog(n);this.StopCine();this.CloseUICine();if(this.SelectedCineViewport instanceof e.DicomViewport)t.Toaster.ShowToast("The cine tool was closed due to an error into the images.",t.Colors.Alizarin,6)}}else{this.StopCine();this.CloseUICine();t.Toaster.ShowToast("The cine tool was closed because the selected viewport does not contain images.",t.Colors.Alizarin,6)}}}static controlImage(){var e=this.SelectedCineViewport.Context.TotalImages;if(this.CineImageNumber>=0&&this.CineImageNumber<e){if(this.imageWasProcessed()){this.SelectedCineViewport.SetImageInViewport(this.CineImageNumber);this.SelectedCineViewport.ZoomToFit()}if(this.IsReversePlayBack)this.CineImageNumber--;else this.CineImageNumber++}else{if(this.IsReversePlayBack)this.CineImageNumber=e-1;else this.CineImageNumber=0;if(this.imageWasProcessed()){this.SelectedCineViewport.SetImageInViewport(this.CineImageNumber);this.SelectedCineViewport.ZoomToFit()}}}static allImagesWereProcessed(){var t=true;var n=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.SelectedCineViewport.Context.StudyGuid];var o=n.Study.Series.StructureData[this.SelectedCineViewport.Context.SeriesGuid];if(this.SelectedCineViewport.Context.IsPseudoSeries){for(let n=0;n<o.KeyImages.IndexData.length;n++){let o=e.KeyImageManager.GetImageReferenceFromKeyImage(this.SelectedCineViewport.Context.StudyGuid,n,this.SelectedCineViewport.Context.SeriesGuid);let s=o[0]["Processed"];if(!s){t=false;break}}}else{for(let e=0;e<o.Images.IndexData.length;e++){let s=n.Study.Series.StructureData[this.SelectedCineViewport.Context.SeriesGuid].Images.StructureData[o.Images.IndexData[e]];let l=s["Processed"];if(!l){t=false;break}}}return t}static imageWasProcessed(){var t=false;try{var n=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.SelectedCineViewport.Context.StudyGuid];var o;if(this.SelectedCineViewport.Context.IsPseudoSeries){var s=e.KeyImageManager.GetImageReferenceFromKeyImage(this.SelectedCineViewport.Context.StudyGuid,this.CineImageNumber,this.SelectedCineViewport.Context.SeriesGuid);t=s[0]["Processed"]}else{o=n.Study.Series.StructureData[this.SelectedCineViewport.Context.SeriesGuid].Images.IndexData[this.CineImageNumber];t=n.Study.Series.StructureData[this.SelectedCineViewport.Context.SeriesGuid].Images.StructureData[o]["Processed"]}return t}catch(e){return t}}}CineManager.IsCineActive=false;CineManager.DefaultFPS=25;CineManager.CineFPS=25;CineManager.CineImageNumber=0;CineManager.CineSubImageNumber=0;CineManager.IsReversePlayBack=false;e.CineManager=CineManager})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class CineView{constructor(o,s){this.parent=o;this.plugin=s;this.Element=document.createElement("div");this.widthSliderControl=200;n.AddClass(this.Element,"headerSection");this.toolbar=new t.Toolbar(this.plugin.Controller.View.Platform.LanguageManager);this.toolbar.Create(this.Element,false);this.Element.style.removeProperty("height");var l=[["cineToolButtonBackward",e.ResourceBag.Icons8Rewind32Png,t=>{e.CineManager.IsReversePlayBack=true;this.toolbar.DeselectButton("subView.1","forward");this.toolbar.SelectButton("subView.1","backward")}]];var u=[["cineToolButtonForward",e.ResourceBag.Icons8FastForward32Png,t=>{e.CineManager.IsReversePlayBack=false;this.toolbar.SelectButton("subView.1","forward");this.toolbar.DeselectButton("subView.1","backward")}]];var c=[["controlCine",e.ResourceBag.Icons8Pause32Png,t=>{if(e.CineManager.IsCineActive)e.CineManager.PauseCine();else e.CineManager.PlayCine();this.SetCineIcon()}]];var d=[["stop",e.ResourceBag.Icons8Stop32Png,t=>{e.CineManager.StopCine();this.SetCineIcon()}]];var m=[["slider",null,null,null,null,null,null,null,n=>{this.Slider=new t.SliderControl("sliderCine",n,this.widthSliderControl,1,30,e.CineManager.CineFPS,1,"FPS",(t=>{e.CineManager.CineFPS=e.CineManager.DefaultFPS=t;if(!e.CineManager.IsCineActive&&t>0){e.CineManager.IsCineActive=true;this.SetCineIcon();e.CineManager.StartCine()}}),true,5);this.Slider.SetSliderSize(22);this.Slider.SetSliderPosition(-10);this.Slider.BuildUI();this.Slider.SetStylesContainerGlobal({marginTop:"20px",marginLeft:"10px"});this.Slider.SetStylesLabelSection({marginTop:"11px"});n.style.display="inline-block";n.style.verticalAlign="top"}]];this.setButtons([l,u,c,m],(()=>{e.CineManager.CloseUICine()}));this.parent.parentElement.insertBefore(this.Element,this.parent);let S=document.documentElement.clientWidth;let C=document.documentElement.clientHeight;this.OnWindowResize(S,C)}SetCineIcon(){this.toolbar.PerformButtonAction("subView.1","controlCine",(t=>{var n=t.Element.getElementsByTagName("img")[0];n.src=!e.CineManager.IsCineActive?e.ResourceBag.Icons8Play32Png:e.ResourceBag.Icons8Pause32Png;var o=t.Element.getElementsByTagName("span")[0];o.innerHTML=!e.CineManager.IsCineActive?this.plugin.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","cineToolButtonPlay"):this.plugin.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","cineToolButtonPause");if(!e.CineManager.IsCineActive)this.toolbar.DeselectButton("subView.1","controlCine");else this.toolbar.SelectButton("subView.1","controlCine");if(e.CineManager.IsReversePlayBack){this.toolbar.DeselectButton("subView.1","forward");this.toolbar.SelectButton("subView.1","backward")}else{this.toolbar.SelectButton("subView.1","forward");this.toolbar.DeselectButton("subView.1","backward")}}))}OnWindowResize(e,t,n){if(this.Slider){let t=this.Slider.GetContainerSlider();if(e<=380){t.style.width="100px"}else{t.style.width=`${this.widthSliderControl}px`}}}setButtons(e,n){var o=[["close",t.ResourceBag.Icons8Delete32Png,e=>{if(n)n()}]];var s=new Array;e.forEach((e=>{s.push(e)}));s.push(o);var l=this.plugin.Controller.View.Platform.Toolbar.CreateButtonsAndMenus(s,"DicomPluginLanguage","subView.1","main");this.toolbar.Groups.push(l);l.Create(this.toolbar.Element)}}e.CineView=CineView})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){class DicomDocument{constructor(e){this.Study=e}}e.DicomDocument=DicomDocument})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(t){var n;(function(t){var n=Efferent.Frontend.WebClient;class DicomImageRenderer{constructor(e){this.Visible=true;this.Context=e;this.iconRotateImages=this.createSvgImage()}Render(e,o){var s,l,u;try{var c;var d;var m;var S=this.Context.Rotation/(180/Math.PI);var C;var p=this.Context.ImageEntity;var A;var f;var I;var D=this.Context.Viewport;if(!this.Context.IsPseudoSeries||this.Context.KeyImageEntity.Images!==null&&this.Context.KeyImageEntity.Images.length===1){if(!this.Context.Viewport.Plugin.MandatoryTagsIsPresents(p))return;var P=this.Context.ImageEntity.TransferSyntax;D.Plugin.Processors.forEach((e=>{if(e instanceof t.WindowLevelProcessor){if(this.Context.CanvasImage===null){if(!D.ProcessWLStart){if(!this.Context.PreserveWindowLevel||!this.Context.Level&&!this.Context.Window){this.Context.Level=this.Context.Level===undefined?parseInt(p["dicomTags"]["0028_1050"]||128):128;this.Context.Window=this.Context.Window===undefined?parseInt(p["dicomTags"]["0028_1051"]||256):256}if(P!=="1.2.840.10008.1.2.4.50"){if(!this.Context.WindowHigh&&!this.Context.LevelHigh){this.Context.LevelHigh=parseInt(p["dicomTags"]["0028_1050"]||128);this.Context.WindowHigh=parseInt(p["dicomTags"]["0028_1051"]||256)}this.Context.Level-=this.Context.LevelHighDelta;this.Context.Window-=this.Context.WindowHighDelta}else{if(!this.Context.WindowLow&&!this.Context.LevelLow){this.Context.LevelLow=parseInt(p["dicomTags"]["0028_1050"]||128);this.Context.WindowLow=parseInt(p["dicomTags"]["0028_1051"]||256)}this.Context.Level-=this.Context.LevelLowDelta;this.Context.Window-=this.Context.WindowLowDelta}}else{if(this.Context.PreserveWindowLevel){if(P!=="1.2.840.10008.1.2.4.50"){this.Context.LevelHigh=this.Context.Level+this.Context.LevelHighDelta;this.Context.WindowHigh=this.Context.Window+this.Context.WindowHighDelta}else{this.Context.LevelLow=this.Context.Level+this.Context.LevelLowDelta;this.Context.WindowLow=this.Context.Window+this.Context.WindowLowDelta}}}if(p["dicomTags"]["invert"])I=!this.Context.InvertImage;else I=this.Context.InvertImage;e.ProcessBuffer(this.Context.ImageEntity,this.Context,I,this.Context.Window,this.Context.Level)}}}));d=parseInt(p["dicomTags"]["0028_0011"]);m=parseInt(p["dicomTags"]["0028_0010"]);C=this.Context.Viewport.ViewportElement.getContext("2d");if(D.TransformsPerImage&&D.TransformsPerImage[P+"_"+D.Context.ImageEntity.ImageGUID]){D.TransformsPerImage[P+"_"+D.Context.ImageEntity.ImageGUID]={ScaleX:this.Context.ScaleX,ScaleY:this.Context.ScaleY,Rotation:this.Context.Rotation,OffsetX:this.Context.OffsetX,OffsetY:this.Context.OffsetY,Window:this.Context.Window,Level:this.Context.Level}}this.Clear(this.Context.ImageEntity["shaperningIsActive"]&&this.Context.ImageEntity["wasShaperning"]===true?Efferent.Frontend.WebClient.Colors.Clouds:null);C.save();C.rotate(S);C.scale(this.Context.ScaleX,this.Context.ScaleY);var v=(this.Context.OffsetX*Math.cos(-S)-this.Context.OffsetY*Math.sin(-S))/this.Context.ScaleX;var T=(this.Context.OffsetX*Math.sin(-S)+this.Context.OffsetY*Math.cos(-S))/this.Context.ScaleY;C.translate(v,T);var V=d/2;var R=m/2;if(this.Context.CanvasImage){C.drawImage(this.Context.CanvasImage,-V,-R)}else{C.restore();return}if(D.Plugin.ShowTriangulations){this.renderTriangulationCross(C,this.Context.Coord3D)}if(!this.Context.HideAllAnnotations){let e=(s=this.Context.PrintFactor)!==null&&s!==void 0?s:1;let t=this.Context.ScaleX;let n=this.Context.ScaleY;this.Context.ScaleX=this.Context.ScaleX*(1/e);this.Context.ScaleY=this.Context.ScaleY*(1/e);for(c=0;c<D.Plugin.Controller.View.Plugins.length;c++){D.Plugin.Controller.View.Plugins[c].RenderAnnotations(this.Context.Viewport)}this.Context.ScaleX=t;this.Context.ScaleY=n}this.renderSpecialAnnotations();if(e!==undefined)e(C);if(this.Context.ScoutLineIsActive)this.getScoutLine(C);C.restore();this.renderKeyIcon()}else if(this.Context.IsPseudoSeries&&this.Context.KeyImageEntity.Images!==null&&this.Context.KeyImageEntity.Images.length>1||this.Context.ImagesStitch!==null){this.Clear();C=this.Context.Viewport.ViewportElement.getContext("2d");C.save();C.rotate(S);this.Context.Annotations=new Array;if(this.Context.ImagesStitch){A=this.Context.OffsetX=((l=this.Context.Viewport.Width)!==null&&l!==void 0?l:this.Context.Viewport.ViewportElement.getAttribute("width"))/2-this.Context.ImagesStitch[0].ImageEntity["dicomTags"]["0028_0011"]*this.Context.ScaleX/2;f=this.Context.OffsetY=((u=this.Context.Viewport.Height)!==null&&u!==void 0?u:this.Context.Viewport.ViewportElement.getAttribute("height"))/24;C.scale(this.Context.ScaleX,this.Context.ScaleY);C.translate(A/this.Context.ScaleX,f/this.Context.ScaleY);for(c=0;c<this.Context.ImagesStitch.length;c++){p=this.Context.ImagesStitch[c].ImageEntity;if(p===null||p["dicomTags"]===undefined)continue;if(p["dicomTags"]["invert"])I=!this.Context.InvertImage;else I=this.Context.InvertImage;D.Plugin.Processors.forEach((e=>{if(e instanceof t.WindowLevelProcessor){if(this.Context.CanvasImages[c]===null){var n=parseInt(p["dicomTags"]["0028_1050"]||128);var o=parseInt(p["dicomTags"]["0028_1051"]||256);e.ProcessBuffer(p,this.Context,I,o,n,c)}}}));var E=this.Context.KeyImageEntity.Images[c];E.Zoom=this.Context.ScaleX;const{width:e,height:s}=this.Context.CanvasImages[c];let l=E.Rotation/(180/Math.PI);let u=E.X+e/2;let d=E.Y+s/2;if(this.Context.CanvasImages[c]){if(o&&E["moved"]===true)C.globalAlpha=.5;else C.globalAlpha=1;C.save();C.translate(u,d);C.rotate(l);C.drawImage(this.Context.CanvasImages[c],-(e/2),-(s/2));C.restore()}else{C.restore();return}if(E["selected"]){C.save();C.strokeStyle=n.Colors.Emerald;C.lineWidth=5;C.translate(u,d);C.rotate(l);C.strokeRect(-(e/2),-(s/2),e,s);const t=100;C.drawImage(this.iconRotateImages[0],-e/2,-s/2,t,t);C.drawImage(this.iconRotateImages[1],-e/2+e-t,-s/2,t,t);C.drawImage(this.iconRotateImages[2],-e/2+e-t,-s/2+s-t,t,t);C.drawImage(this.iconRotateImages[3],-e/2,-s/2+s-t,t,t);C.restore()}}}else{this.Context.CanvasImages=[];var M=this.Context.KeyImageEntity;var G=0;var L=0;for(c=0;c<M.Images.length;c++){var F=M.Images[c].ImageGUID;var B=D.Plugin.GetSeriesGuidFromImageGuid(this.Context.StudyGuid,F);p=D.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[B].Images.StructureData[F];if(p===null||p["dicomTags"]===undefined)continue;var O=parseInt(p["dicomTags"]["0028_0011"]);var N=parseInt(p["dicomTags"]["0028_0010"]);G+=O;L+=N;this.Context.CanvasImages[c]=null}var U=this.Context.Viewport.GetWidth();var k=this.Context.Viewport.GetHeight();var W=G/U;var q=L/k;var X=1;X/=Math.max(W,q);this.Context.Viewport.Context.ScaleX=X;this.Context.Viewport.Context.ScaleY=X;let e=M.Images[0].ImageGUID;let n=D.Plugin.GetSeriesGuidFromImageGuid(this.Context.StudyGuid,e);let o=D.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[n].Images.StructureData[e];A=this.Context.OffsetX=U/2-o["dicomTags"]["0028_0011"]*this.Context.ScaleX/2;f=this.Context.OffsetY=k/24;C.scale(X,X);C.translate(A/X,f/X);for(c=0;c<M.Images.length;c++){var Y=M.Images[c].ImageGUID;var H=D.Plugin.GetSeriesGuidFromImageGuid(this.Context.StudyGuid,Y);p=D.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[H].Images.StructureData[Y];if(p===null||p["dicomTags"]===undefined)continue;D.Plugin.Processors.forEach((e=>{if(e instanceof t.WindowLevelProcessor){if(this.Context.CanvasImages[c]===null){var n=parseInt(p["dicomTags"]["0028_1050"]||128);var o=parseInt(p["dicomTags"]["0028_1051"]||256);var s=p["dicomTags"]["invert"]||this.Context.InvertImage;e.ProcessBuffer(p,this.Context,s,o,n,c)}}}));var z=this.Context.KeyImageEntity.Images[c];if(this.Context.CanvasImages[c]){const{width:e,height:t}=this.Context.CanvasImages[c];let n=z.Rotation/(180/Math.PI);let o=z.X+e/2;let s=z.Y+t/2;C.save();C.translate(o,s);C.rotate(n);C.drawImage(this.Context.CanvasImages[c],-(e/2),-(t/2));C.restore()}else{C.restore();return}}}C.restore();if(!this.Context.ImagesStitch)this.renderKeyIcon()}}catch(e){console.info("render image error.")}}Clear(e){let t=this.Context.Viewport.ViewportElement.constructor.name;if(t==="HTMLCanvasElement"){var n=this.Context.Viewport.ViewportElement.getContext("2d");n.fillStyle=e!==null&&e!==void 0?e:Efferent.Frontend.WebClient.Colors.BgLighter;n.fillRect(0,0,this.Context.Viewport.GetWidth(),this.Context.Viewport.GetHeight())}}renderSpecialAnnotations(){let e=this.Context.Viewport;let t=this.Context.Viewport.ViewerPage;for(const n in t.SpecialAnnotations){if(Object.prototype.hasOwnProperty.call(t.SpecialAnnotations,n)){const o=t.SpecialAnnotations[n];if(o.ImageGuid===e.Context.ImageEntity.ImageGUID){o.ContextReplaceNames.forEach((t=>{o.Annotation[t]=e.Context}));o.Annotation.Render()}}}}renderKeyIcon(){this.iconKeyImage=new Image;this.iconKeyImage.src=t.ResourceBag.Icons8Key32Png;var e=this.Context.Viewport.ViewportElement.getContext("2d");if(this.Context.IsPseudoSeries){e.save();e.translate(0,0);e.drawImage(this.iconKeyImage,0,45,32,32);e.restore()}}renderTriangulationCross(e,t){if(this.Context.ImageEntity["has3DInformation"]&&t!==null){var n=this.Context.Viewport.Plugin.Project3DPoint(this.Context.ImageEntity,t);var o=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"])/2;var s=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"])/2;n.X-=o;n.Y-=s;var l=7/Math.abs(this.Context.ScaleX);e.strokeStyle=Efferent.Frontend.WebClient.Colors.Clouds;e.lineWidth=1/Math.abs(this.Context.ScaleX);e.beginPath();e.moveTo(n.X-l,n.Y);e.lineTo(n.X+l,n.Y);e.moveTo(n.X,n.Y-l);e.lineTo(n.X,n.Y+l);e.stroke()}}getScoutLine(e){var t=this.Context.Viewport.Plugin.Controller.GetSelectViewport(this.Context.Viewport.Plugin.Controller.ViewportPane);if(t!==null&&this.Context.Viewport!==t&&t.Context.ImageEntity&&t.Context.StudyGuid===this.Context.StudyGuid&&t.Context.ImageEntity["has3DInformation"]&&this.Context.ImageEntity["has3DInformation"]){var o=this.Context.ImageEntity["normalVector"];var s=t.Context.ImageEntity["normalVector"];var l=Math.acos(parseFloat((o[0]*s[0]+o[1]*s[1]+o[2]*s[2]).toFixed(2)))*180/Math.PI;if(l>10){e.strokeStyle="Yellow";e.lineWidth=1/Math.abs(this.Context.ScaleX);var u=this.getIntersectionLine(this.Context.ImageEntity,t.Context.ImageEntity);if(u!==null){var c=this.Context.Viewport.Plugin.Project3DPoint(this.Context.ImageEntity,new n.Point3D(u,0));var d=this.Context.Viewport.Plugin.Project3DPoint(this.Context.ImageEntity,new n.Point3D(u,3));var m=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"]);var S=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"]);var C=m/2;var p=S/2;e.beginPath();e.moveTo(c.X-C,c.Y-p);e.lineTo(d.X-C,d.Y-p);e.stroke()}}}}getIntersectionLine(e,t){var n=new Array(2);var o=new Array(2);var s=0;var l=new Array(6);var u;n[0]=e["corners"];n[1]=t["corners"];o[0]=e["normalVector"];o[1]=t["normalVector"];for(var c=0;c<2;c++){var d=c;var m=c===0?1:0;for(var S=0;S<4;S++){var C=S;var p=S===0?1:S===1?3:S===2?0:2;var A=n[m][0][0]-n[d][C][0];var f=n[m][0][1]-n[d][C][1];var I=n[m][0][2]-n[d][C][2];var D=n[d][p][0]-n[d][C][0];var P=n[d][p][1]-n[d][C][1];var v=n[d][p][2]-n[d][C][2];var T=o[m][0]*A+o[m][1]*f+o[m][2]*I;var V=o[m][0]*D+o[m][1]*P+o[m][2]*v;if(V===0)continue;var R=T/V;if(R<0||R>1)continue;var E=(n[m][0][0]-n[m][1][0])*(n[m][0][0]-n[m][1][0])+(n[m][0][1]-n[m][1][1])*(n[m][0][1]-n[m][1][1])+(n[m][0][2]-n[m][1][2])*(n[m][0][2]-n[m][1][2]);var M=(n[m][0][0]-n[m][2][0])*(n[m][0][0]-n[m][2][0])+(n[m][0][1]-n[m][2][1])*(n[m][0][1]-n[m][2][1])+(n[m][0][2]-n[m][2][2])*(n[m][0][2]-n[m][2][2]);var G=n[d][C][0]+R*(n[d][p][0]-n[d][C][0]);var L=n[d][C][1]+R*(n[d][p][1]-n[d][C][1]);var F=n[d][C][2]+R*(n[d][p][2]-n[d][C][2]);var B=(G-n[m][0][0])*(n[m][1][0]-n[m][0][0])+(L-n[m][0][1])*(n[m][1][1]-n[m][0][1])+(F-n[m][0][2])*(n[m][1][2]-n[m][0][2]);var O=(G-n[m][0][0])*(G-n[m][0][0])+(L-n[m][0][1])*(L-n[m][0][1])+(F-n[m][0][2])*(F-n[m][0][2]);u=O-B*B/E;if(u>M)continue;var N=(G-n[m][2][0])*(n[m][3][0]-n[m][2][0])+(L-n[m][2][1])*(n[m][3][1]-n[m][2][1])+(F-n[m][2][2])*(n[m][3][2]-n[m][2][2]);var U=(G-n[m][2][0])*(G-n[m][2][0])+(L-n[m][2][1])*(L-n[m][2][1])+(F-n[m][2][2])*(F-n[m][2][2]);u=U-N*N/E;if(u>M)continue;var k=(G-n[m][0][0])*(n[m][2][0]-n[m][0][0])+(L-n[m][0][1])*(n[m][2][1]-n[m][0][1])+(F-n[m][0][2])*(n[m][2][2]-n[m][0][2]);u=O-k*k/M;if(u>E)continue;var W=(G-n[m][1][0])*(n[m][3][0]-n[m][1][0])+(L-n[m][1][1])*(n[m][3][1]-n[m][1][1])+(F-n[m][1][2])*(n[m][3][2]-n[m][1][2]);var q=(G-n[m][1][0])*(G-n[m][1][0])+(L-n[m][1][1])*(L-n[m][1][1])+(F-n[m][1][2])*(F-n[m][1][2]);u=q-W*W/M;if(u>E)continue;l[3*s+0]=G;l[3*s+1]=L;l[3*s+2]=F;s++;if(s===2)return l}}return null}createSvgImage(){const t=[e.Products.DicomPlugin.ResourceBag.IconRotateArrow1Svg,e.Products.DicomPlugin.ResourceBag.IconRotateArrow2Svg,e.Products.DicomPlugin.ResourceBag.IconRotateArrow3Svg,e.Products.DicomPlugin.ResourceBag.IconRotateArrow4Svg];return t.map((e=>{const t=document.createElement("div");t.innerHTML=e;const n=t.firstElementChild;const o=document.createElement("img");const s=(new XMLSerializer).serializeToString(n);const l=window.btoa(s);const u="data:image/svg+xml;base64,";const c=u+l;o.src=c;return o}))}}t.DicomImageRenderer=DicomImageRenderer})(n=t.DicomPlugin||(t.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient.DOMUtils;var n=Efferent.Frontend.WebClient;class DicomOverlayRenderer{constructor(e){this.Visible=true;this.Context=e;this.Viewport=e.Viewport}Render(e){var o=this.Viewport.Context.ImageEntity;let s=this.Viewport.ViewportElement.constructor.name;if(s==="HTMLCanvasElement"){if(o===null||o["dicomTags"]===undefined){this.renderMinimalInformation();return}if(!this.Context.Viewport.Plugin.MandatoryTagsIsPresents(o))return;var l=this.Viewport.ViewportElement.getContext("2d");var u=0;var c=this.Viewport.Context.SeriesIndex+1;var d=this.Viewport.Context.ImageIndex+1;var m=this.Viewport.Context.TotalImages;var S=this.Viewport.Context.TotalSeriesInStudy;var C=this.getFontSizeForViewports();l.font=C+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";l.fillStyle=n.Colors.Clouds;l.shadowColor=n.Colors.FullBlack;l.shadowOffsetX=1;l.shadowOffsetY=1;l.textAlign="left";l.textBaseline="top";u=this.draw(3,0,this.getFinalText(o["dicomTags"]["0010_0020"],"0010_0020",l));u=this.draw(3,u,this.getFinalText(n.Utils.FormatValue(o["dicomTags"]["0010_0010"]),"0010_0010",l));var p;try{if(o["dicomTags"]["0010_1010"]){this.draw(3,u,o["dicomTags"]["0010_1010"])}else{var A=o["dicomTags"]["0008_0020"];var f=o["dicomTags"]["0008_0022"];var I=A?A:f;var D=I.substr(0,4)+"-"+I.substr(4,2)+"-"+I.substr(6,2);var P=o["dicomTags"]["0010_0030"];var v=P.substr(0,4)+"-"+P.substr(4,2)+"-"+P.substr(6,2);var p=P?n.Utils.GetAgeFromDate(v,D):"";p=P?isNaN(+p)?"0Y":`${p}Y`:"";this.draw(3,u,this.getFinalText(p,"0010_1010",l))}}catch(e){this.draw(3,u,this.getFinalText(o["dicomTags"]["0010_1010"],"0010_1010",l));n.Utils.DebugConsoleLog(e)}l.textAlign="right";l.textBaseline="top";u=this.draw(this.Viewport.ViewportElement.width-3,0,"Series: "+c+"/"+S);if(o["bufferArray"]!==undefined&&o["bufferArray"]!==null&&this.Context.TotalImages>1){u=this.draw(this.Viewport.ViewportElement.width-3,u,"Image: "+d+"/"+m);u=this.draw(this.Viewport.ViewportElement.width-3,u,"Frame: "+(this.Viewport.Context.ImageSubIndex+1)+"/"+o["bufferArray"].length)}else{if(o["bufferArray"]!==undefined&&o["bufferArray"]!==null&&this.Context.TotalImages===1){u=this.draw(this.Viewport.ViewportElement.width-3,u,"Image: "+(this.Viewport.Context.ImageSubIndex+1)+"/"+o["bufferArray"].length)}else{u=this.draw(this.Viewport.ViewportElement.width-3,u,"Image: "+d+"/"+m)}}var T=o["dicomTags"]["0008_0022"];if(T!==null&&T!==undefined&&T!=="")this.draw(this.Viewport.ViewportElement.width-3,u,DicomOverlayRenderer.formatDicomDate(T));else{T=o["dicomTags"]["0008_0020"];this.draw(this.Viewport.ViewportElement.width-3,u,DicomOverlayRenderer.formatDicomDate(T))}l.textAlign="left";l.textBaseline="bottom";u=this.Viewport.ViewportElement.height;u=this.draw(3,u,"Level: "+Math.round(this.Viewport.Context.Level));u=this.draw(3,u,"Width: "+Math.round(this.Viewport.Context.Window));u=this.draw(3,u,"Zoom: "+(this.Context.ZoomNumberShow?Math.round(Math.abs(this.Context.ZoomNumberShow)).toString()+"%":(Math.round(Math.abs(this.Context.ScaleX)*100)/100).toString()));l.textAlign="right";l.textBaseline="bottom";u=this.Viewport.ViewportElement.height;u=this.draw(this.Viewport.ViewportElement.width-3,u,this.getFinalText(n.Utils.FormatValue(o["dicomTags"]["0008_0090"]),"0008_0090",l));if(!this.Viewport.Context.ImageEntity["pixelSpacing"]||this.Viewport.Context.ImageEntity["pixelSpacing"]&&this.Viewport.Context.ImageEntity["pixelSpacing"][2]==="px"){if(o["dicomTags"]["0008_0060"]!=="OT"){l.save();l.fillStyle=n.Colors.Pomegranate;u=this.draw(this.Viewport.ViewportElement.width-3,u,"NOT CALIBRATED");l.restore()}}var V=this.Context.Viewport.ContentElement.getElementsByClassName("sharpeningTag");if(this.Context.ImageEntity["shaperningIsActive"]&&this.Context.ImageEntity["wasShaperning"]===true){if(V.length===0){var R=document.createElement("div");R.innerHTML="SHARPENING";t.AddClass(R,"sharpeningTag");this.Context.Viewport.ContentElement.appendChild(R)}}else{if(V.length>0)t.RemoveItem(V[0])}if(!this.Viewport.Context.ImageEntity["has3DInformation"])return;this.draw3DInformation(l)}}renderMinimalInformation(){try{if(this.Viewport.Context.IsPseudoSeries){var e=this.Viewport.ViewportElement.getContext("2d");var t=0;var o=this.Viewport.Context.SeriesIndex+1;var s=this.Viewport.Context.ImageIndex+1;var l=this.Viewport.Context.TotalImages;var u=this.Viewport.Context.TotalSeriesInStudy;var c=this.getFontSizeForViewports();e.font=c+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";e.fillStyle=n.Colors.Clouds;e.shadowColor=n.Colors.FullBlack;e.shadowOffsetX=1;e.shadowOffsetY=1;e.textAlign="left";e.textBaseline="top";t=this.draw(3,0,this.getFinalText(null,"0010_0020",e));t=this.draw(3,t,this.getFinalText(null,"0010_0010",e));this.draw(3,t,this.getFinalText(null,"0010_1010",e));e.textAlign="right";e.textBaseline="top";t=this.draw(this.Viewport.ViewportElement.width-3,0,"Series: "+o+"/"+u);t=this.draw(this.Viewport.ViewportElement.width-3,t,"Image: "+s+"/"+l);e.textAlign="left";e.textBaseline="bottom";t=this.Viewport.ViewportElement.height;t=this.draw(3,t,"Zoom: "+(this.Context.ZoomNumberShow?Math.round(Math.abs(this.Context.ZoomNumberShow)).toString()+"%":(Math.round(Math.abs(this.Context.ScaleX)*100)/100).toString()));e.textAlign="right";e.textBaseline="bottom";t=this.Viewport.ViewportElement.height;t=this.draw(this.Viewport.ViewportElement.width-3,t,this.getFinalText(null,"0008_0090",e))}}catch(e){n.Utils.DebugConsoleLog(e)}}getFontSizeForViewports(){var e;if(this.Context.PrintFactor){let t=(e=this.Context.PrintFactor)!==null&&e!==void 0?e:1;let n=1*(1/t);this.fontSize=Math.round(11/n*10)/10}else{var n=12;if(t.IsSmallDevice()||this.Viewport.Height<150||this.Viewport.Width<250){n=8.4;if(this.Viewport.Width<150){n=5}}else if(this.Viewport.Width>2e3){n=35}this.fontSize=n}return this.fontSize}getFinalText(e,t,o){var s;var l=e;var u=this.Viewport.ViewerPage.ImagingStudyFhirEntities[this.Viewport.Context.StudyGuid];var c;switch(t){case"0010_0020":try{c=u["subject"]["identifier"][0]["value"]}catch(e){c=""}break;case"0010_0010":try{c=u["subject"]["name"][0]["text"]}catch(e){c=""}break;case"0010_1010":try{c=u["subject"]["birthDate"];c=n.Utils.GetAgeFromDate(c,u["started"]);c=(c!=="0"?"0"+c:c)+"Y"}catch(e){c=""}break;case"0008_0090":try{c=(s=u["referrer"]["display"])!==null&&s!==void 0?s:u["referrer"]["name"][0]["text"]}catch(e){c=""}break}if(!e){l=c}else if(c&&c.toUpperCase()!==e.toUpperCase()){if(c!=="")l=c+"✎";else l=""}return l}draw3DInformation(e){var t=this.Viewport.Context.ImageEntity["dicomTags"]["0020_0037"];var o=this.Viewport.Context.Rotation/180*Math.PI;var s=Math.sin(o);var l=Math.cos(o);var u=this.Viewport.Context.ImageEntity["normalVector"];var c=[u[0]*(u[0]*t[3]+u[1]*t[4]+u[2]*t[5])+(t[3]*(u[1]*u[1]+u[2]*u[2])-u[0]*(u[1]*t[4]+u[2]*t[5]))*l+(-u[2]*t[4]+u[1]*t[5])*s,u[1]*(u[0]*t[3]+u[1]*t[4]+u[2]*t[5])+(t[4]*(u[0]*u[0]+u[2]*u[2])-u[1]*(u[0]*t[3]+u[2]*t[5]))*l+(u[2]*t[3]-u[0]*t[5])*s,u[2]*(u[0]*t[3]+u[1]*t[4]+u[2]*t[5])+(t[5]*(u[0]*u[0]+u[1]*u[1])-u[2]*(u[0]*t[3]+u[1]*t[4]))*l+(-u[1]*t[3]+u[0]*t[4])*s];e.textAlign="center";e.textBaseline="top";var d=this.getOrientation(new n.Point3D(-c[0],-c[1],-c[2]));this.draw(this.Viewport.ViewportElement.width/2-10,0,d);e.textAlign="center";e.textBaseline="bottom";d=this.getOrientation(new n.Point3D(c,0));this.draw(this.Viewport.ViewportElement.width/2,this.Viewport.ViewportElement.height-3,d);c=[u[0]*(u[0]*t[0]+u[1]*t[1]+u[2]*t[2])+(t[0]*(u[1]*u[1]+u[2]*u[2])-u[0]*(u[1]*t[1]+u[2]*t[2]))*l+(-u[2]*t[1]+u[1]*t[2])*s,u[1]*(u[0]*t[0]+u[1]*t[1]+u[2]*t[2])+(t[1]*(u[0]*u[0]+u[2]*u[2])-u[1]*(u[0]*t[0]+u[2]*t[2]))*l+(u[2]*t[0]-u[0]*t[2])*s,u[2]*(u[0]*t[0]+u[1]*t[1]+u[2]*t[2])+(t[2]*(u[0]*u[0]+u[1]*u[1])-u[2]*(u[0]*t[0]+u[1]*t[1]))*l+(-u[1]*t[0]+u[0]*t[1])*s];e.textAlign="left";e.textBaseline="middle";d=this.getOrientation(new n.Point3D(-c[0],-c[1],-c[2]));this.draw(3,this.Viewport.ViewportElement.height/2-10,d);e.textAlign="right";e.textBaseline="middle";d=this.getOrientation(new n.Point3D(c,0));this.draw(this.Viewport.ViewportElement.width-3,this.Viewport.ViewportElement.height/2-10,d)}draw(e,t,n){var o;var s=this.Viewport.ViewportElement.getContext("2d");let l=16/(1/((o=this.Context.PrintFactor)!==null&&o!==void 0?o:1));if(n===undefined||n===""){return t}else{s.fillText(n,e,t);var u=s.textBaseline==="bottom"?-1:1;return t+l*u}}getOrientation(e){var t="";var n=e.X<0?"R":"L";var o=e.Y<0?"A":"P";var s=e.Z<0?"F":"H";var l=Math.abs(e.X);var u=Math.abs(e.Y);var c=Math.abs(e.Z);for(var d=0;d<3;++d){if(l>.1&&l>u&&l>c){t+=n;l=0}else if(u>.1&&u>l&&u>c){t+=o;u=0}else if(c>.1&&c>l&&c>u){t+=s;c=0}else break}return t}static formatDicomDate(e){try{var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(!e)return"";if(e.length!==8)return e;var n=parseInt(e.substr(4,2),10);return t[n-1]+" "+e.substr(6,2)+", "+e.substr(0,4)}catch(e){return""}}static formatDicomTime(e){if(!e)return"";if(e.length<6)return e;return e.substr(0,2)+":"+e.substr(2,2)+":"+e.substr(4,2)}}e.DicomOverlayRenderer=DicomOverlayRenderer})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var DicomPlugin;(function(DicomPlugin_1){var WebClient=Efferent.Frontend.WebClient;var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;var FhirCall=Efferent.Frontend.FhirClient.FhirCall;var ImagingStudyView=Efferent.ClientViews.ImagingStudyView;let ResetWlMode;(function(e){e[e["EVue"]=0]="EVue";e[e["Dicom"]=1]="Dicom"})(ResetWlMode=DicomPlugin_1.ResetWlMode||(DicomPlugin_1.ResetWlMode={}));let EMPRType;(function(e){e[e["Sagittal"]=0]="Sagittal";e[e["Coronal"]=1]="Coronal"})(EMPRType=DicomPlugin_1.EMPRType||(DicomPlugin_1.EMPRType={}));class DicomPlugin{constructor(){this.Processors=new Array;this.IsLinkToolActive=false;this.SeriesIndexTileMode=0;this.ScrollIndexTileMode=0;this.ShowTriangulations=false;this.StitchIndexMove=-1;this.StitchIndexRotate=-1;this.PluginName="DicomPlugin";this.SupportedViewportType=["DicomViewport"]}Initialize(e,t,n,o,s,l){Efferent.Frontend.WebClient.DOMUtils.InjectCSS(Vue.Products.DicomPlugin.ResourceBag.DicomPluginCss,"styleDicomPlugin");this.Controller=e;var u=Efferent.Frontend.WebClient.Loader.Show();this.Controller.View.Platform.LanguageManager.AddDictionary("{Vue.Products.DicomPlugin.ResourceBag.DicomPluginLanguageJson}","DicomPluginLanguage",Vue.Products.DicomPlugin.ResourceBag.DicomPluginLanguageJson[this.Controller.View.Platform.LanguageManager.CurrentLanguage]);if(l)this.LoadPlugin();if(n===t.length-1){if(o!==undefined)o.call(this.Controller.View,s)}else{t[n+1].Initialize(this.Controller,t,n+1,o,s,l)}Efferent.Frontend.WebClient.Loader.Hide(u.getAttribute("id"));DicomPlugin.AcumCtrlUseForAnnotations={DicomAnnotationLine:0,DicomAnnotationEllipse:0}}LoadPlugin(){DicomPlugin_1.KeyImageManager.SetKeyImage(this);DicomPlugin_1.StitchManager.SetStitchKeyImage(this);if(this.Controller.View.Platform.GetSetting("selectMouseBehLeftDoubleClick")===undefined)this.Controller.View.Platform.SetSetting(40,"selectMouseBehLeftDoubleClick","Dicom1x1Layout");if(this.Controller.View.Platform.GetSetting("wheelOperation")===undefined)this.Controller.View.Platform.SetSetting(40,"wheelOperation","scrollImages");if(this.Controller.View.Platform.GetSetting("zoomWheelOrientation")===undefined)this.Controller.View.Platform.SetSetting(40,"zoomWheelOrientation","up");var e=[["imageRender",DicomPlugin_1.ResourceBag.Icons8SpottedPatterns32Png,e=>{}],"windowLevelTitle",["freeWl",DicomPlugin_1.ResourceBag.Icons8Drag32Png,e=>{e.preventDefault();e.srcEvent.stopPropagation();this.Controller.SelectTool("DicomWindowLevel","freeWl");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","imageRender","optionInMenuPressed")}],["invertSelectionTool",DicomPlugin_1.ResourceBag.Icons8InvertSelection32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.SetInvertImage();this.Controller.SelectDefaultTool()}],["evueResetWl",DicomPlugin_1.ResourceBag.Icons8Undo32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){t.SetWindowLevel(undefined,undefined,ResetWlMode.EVue);let e=this.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid];let n=e.Study.Series.StructureData[t.Context.SeriesGuid].Images.StructureData[t.Context.ImageEntity.ImageGUID];if(n["wasShaperning"])t.ActiveSharper(false)}this.Controller.SelectDefaultTool()}],["dicomResetWl",DicomPlugin_1.ResourceBag.Icons8Undo32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){t.SetWindowLevel(undefined,undefined,ResetWlMode.Dicom);let e=this.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid];let n=e.Study.Series.StructureData[t.Context.SeriesGuid].Images.StructureData[t.Context.ImageEntity.ImageGUID];if(n["wasShaperning"])t.ActiveSharper(false)}this.Controller.SelectDefaultTool()}],"titleWlPresets",["brainTool",DicomPlugin_1.ResourceBag.Icons8Brain32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.SetWindowLevelForBrain();this.Controller.SelectDefaultTool()}],["liverTool",DicomPlugin_1.ResourceBag.Icons8Liver32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.SetWindowLevelForLiver();this.Controller.SelectDefaultTool()}],["lungsTool",DicomPlugin_1.ResourceBag.Icons8Lungs32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.SetWindowLevelForLungs();this.Controller.SelectDefaultTool()}],["humanBoneTool",DicomPlugin_1.ResourceBag.Icons8HumanBone32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.SetWindowLevelForHumanBone();this.Controller.SelectDefaultTool()}],["stomachTool",DicomPlugin_1.ResourceBag.Icons8Stomach32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.SetWindowLevelForStomach();this.Controller.SelectDefaultTool()}],"otherTitle"];const t=[["sharpen",DicomPlugin_1.ResourceBag.Icons8VisualyImpaired32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){setTimeout((()=>{t.ActiveSharper(true)}),.15)}this.Controller.SelectDefaultTool()}]];const n=[["mprSagittal",DicomPlugin_1.ResourceBag.Icons8Skull32Png,e=>{this.MPRExecute(EMPRType.Sagittal)}],["mprCoronal",DicomPlugin_1.ResourceBag.Icons8Skull322Png,e=>{this.MPRExecute(EMPRType.Coronal)}]];e=e.concat(t,n);var o=[["ZoomAndRotate",DicomPlugin_1.ResourceBag.Icons8Drag32Png],["zoom",DicomPlugin_1.ResourceBag.Icons8Search32Png,e=>{e.preventDefault();e.srcEvent.stopPropagation();this.Controller.SelectTool("DicomZoom","zoom");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ZoomAndRotate","optionInMenuPressed")}],["magnifierTool",DicomPlugin_1.ResourceBag.Icons8Detective32Png,e=>{e.preventDefault();e.srcEvent.stopPropagation();this.Controller.SelectTool("DicomMagnifier","magnifierTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ZoomAndRotate","optionInMenuPressed")}],["freeRotation",DicomPlugin_1.ResourceBag.Icons8Synchronize32Png,e=>{e.preventDefault();e.srcEvent.stopPropagation();this.Controller.SelectTool("DicomRotate","freeRotation");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ZoomAndRotate","optionInMenuPressed")}],["panTool",DicomPlugin_1.ResourceBag.Icons8Drag32Png,e=>{e.preventDefault();e.srcEvent.stopPropagation();this.Controller.SelectTool("DicomPan","panTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ZoomAndRotate","optionInMenuPressed")}],["resetTransformations",DicomPlugin_1.ResourceBag.Icons8Undo32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.ResetTransformations();this.Controller.SelectDefaultTool()}],"titleZoomPresets",["zoomToFit",DicomPlugin_1.ResourceBag.Icons8ZoomToExtents32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.ZoomToFit(true);this.Controller.SelectDefaultTool()}],["zoomOneToOne",DicomPlugin_1.ResourceBag.Icons8ZoomToActualSize32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null)t.Zoom1x1();this.Controller.SelectDefaultTool()}],"titleRotatePresets",["rotateLeft",DicomPlugin_1.ResourceBag.Icons8RotateLeft32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null&&t.Context.ImageEntity!==null){t.Context.Rotation-=90;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}this.Controller.SelectDefaultTool()}],["rotateRight",DicomPlugin_1.ResourceBag.Icons8RotateRight32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null&&t.Context.ImageEntity!==null){t.Context.Rotation+=90;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}this.Controller.SelectDefaultTool()}],["flipHorizontalTool",DicomPlugin_1.ResourceBag.Icons8FlipVertical32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){t.Context.ScaleX=-t.Context.ScaleX;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}this.Controller.SelectDefaultTool()}],["flipVerticalTool",DicomPlugin_1.ResourceBag.Icons8FlipHorizontal32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){t.Context.ScaleY=-t.Context.ScaleY;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}this.Controller.SelectDefaultTool()}]];var s=[["lengthTool",DicomPlugin_1.ResourceBag.Icons8Length32Png,e=>{var t=[];this.Controller.View.Plugins.forEach((e=>{var n=e.GetButtonsToMenu(["Calibration"],"lengthTool");t.push({dictionary:n.dictionary,buttons:n.buttons})}));if(t.length>0){t.forEach((e=>{if(e.buttons.length>0)this.Controller.View.Platform.Toolbar.AppendMenuButtonItems(e.buttons,e.dictionary,"hideFixedAnnotTool",true,"lengthTool",true)}))}}],["lineTool",DicomPlugin_1.ResourceBag.LineIconsPng,e=>{this.Controller.SelectTool("Pointer","pointerTool");this.Controller.SelectTool("DicomAnnotationLine","lineTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","lengthTool","optionInMenuPressed");this.ActiveToolsActions()}],["polylineTool",DicomPlugin_1.ResourceBag.Icons8SquigglyLine32Png,e=>{this.Controller.SelectTool("Pointer","pointerTool");this.Controller.SelectTool("DicomAnnotationPolyline","polylineTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","lengthTool","optionInMenuPressed")}],["ellipseTool",DicomPlugin_1.ResourceBag.Icons8Oval32Png,e=>{this.Controller.SelectTool("Pointer","pointerTool");this.Controller.SelectTool("DicomAnnotationEllipse","ellipseTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","lengthTool","optionInMenuPressed");this.ActiveToolsActions()}],["angleTool",DicomPlugin_1.ResourceBag.Icons8MeasurementTool32Png,e=>{this.Controller.SelectTool("Pointer","pointerTool");this.Controller.SelectTool("DicomAnnotationAngle","angleTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","lengthTool","optionInMenuPressed")}],["downLeftTool",DicomPlugin_1.ResourceBag.Icons8DownLeft32Png,e=>{this.Controller.SelectTool("Pointer","pointerTool");this.Controller.SelectTool("DicomAnnotationArrow","downLeftTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","lengthTool","optionInMenuPressed")}],["rectangleTool",DicomPlugin_1.ResourceBag.Icons8UncheckedCheckbox32Png,e=>{this.Controller.SelectTool("Pointer","pointerTool");this.Controller.SelectTool("DicomAnnotationRectangle","rectangleTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","lengthTool","optionInMenuPressed")}],["textBoxTool",DicomPlugin_1.ResourceBag.Icons8TextBox32Png,e=>{this.Controller.SelectTool("Pointer","pointerTool");this.Controller.SelectTool("DicomAnnotationText","textBoxTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","lengthTool","optionInMenuPressed")}],["markerTool",DicomPlugin_1.ResourceBag.Icons8TextBoxFilled32Png,e=>{DicomPlugin_1.MarkerOptionsPane.SetMarker(this)}],["hideFixedAnnotTool",DicomPlugin_1.ResourceBag.Icons8Hide32Png,e=>{this.HideFixedAnnotations(e)}]];var l=[["deleteAllAnnotTool",DicomPlugin_1.ResourceBag.Icons8Erase32Png,e=>{this.deleteAnnotations(true)}]];var u=[["deleteAnnotTool",DicomPlugin_1.ResourceBag.Icons8Erase32Png,e=>{this.deleteAnnotations(false)}]];var c=[["quickPrint",DicomPlugin_1.ResourceBag.Icons8Print32Png],["reportCurrentImage",DicomPlugin_1.ResourceBag.IconReportPng,e=>{WebClient.Toolbar.HideAllMenus();var t=new DicomPlugin_1.PrintDialog(this,DicomPlugin_1.EPrintTargetType.CURRENT_IMAGE);t.Show()},null,null,null,null,"MenuTextYellow"],["reportCurrentSeries",DicomPlugin_1.ResourceBag.IconReportPng,e=>{WebClient.Toolbar.HideAllMenus();var t=new DicomPlugin_1.PrintDialog(this,DicomPlugin_1.EPrintTargetType.CURRENT_SERIES);t.Show()},null,null,null,null,"MenuTextYellow"],["reportStudy",DicomPlugin_1.ResourceBag.IconReportPng,e=>{WebClient.Toolbar.HideAllMenus();var t=new DicomPlugin_1.PrintDialog(this,DicomPlugin_1.EPrintTargetType.CURRENT_STUDY);t.Show()},null,null,null,null,"MenuTextYellow"]];var d=[["imageTools",DicomPlugin_1.ResourceBag.Icons8SwissArmyKnife32Png],["addKey",DicomPlugin_1.ResourceBag.Icons8AddKey32Png,e=>{var t=e.target;if(!DOMUtils.HasClass(t,"toolbarButton"))t=t.parentElement;DicomPlugin_1.KeyImageManager.SetKeyImage(this);DicomPlugin_1.KeyImageManager.CreateRemoveKeyImage(DicomPlugin_1.EOptionKeyImageAction.Add)}],["removeKey",DicomPlugin_1.ResourceBag.Icons8RemoveKey32Png,e=>{var t=e.target;if(!DOMUtils.HasClass(t,"toolbarButton"))t=t.parentElement;DicomPlugin_1.KeyImageManager.SetKeyImage(this);var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(n!==null){if(n.Context.IsPseudoSeries&&n.Context.KeyImageEntity!==undefined&&n.Context.KeyImageEntity!==null){try{var o=n.Context.KeyImageEntity.Images.length;if(o===1)DicomPlugin_1.KeyImageManager.CreateRemoveKeyImage(DicomPlugin_1.EOptionKeyImageAction.Remove);else if(o>=2)this.KeyImageCreateRemoveStitch(n)}catch(e){WebClient.Toaster.ShowToast("KeyImage error action.",WebClient.Colors.Orange,3)}}else{WebClient.Toaster.ShowToast("Select a keyimage to delete.",WebClient.Colors.BelizeHole,3)}}else{WebClient.Toaster.ShowToast("Select a viewport.",WebClient.Colors.BelizeHole,3)}WebClient.Toolbar.HideAllMenus()}],["StitchTool",DicomPlugin_1.ResourceBag.Icons8Needle32Png,e=>this.ProcessStitchToolEvent(e)],["caseStudyTool",DicomPlugin_1.ResourceBag.Icons8Business32Png,e=>{var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){if(t.Context.ImageEntity!==null){this.Controller.CaseStudyController=new ImagingStudyView.CaseStudyController(this.Controller.View.Platform.GetMainContainer(),this.Controller.View.Platform,this.Controller);this.SetEventsCaseStudy();this.Controller.CaseStudyController.Pane.Toggle()}else WebClient.Toaster.ShowToast("Please. Select to viewport with an image.",WebClient.Colors.Alizarin,3)}}]];if(!WebClient.Utils.CheckNotAllowTag(["admin"])){const e=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAOdJREFUWAntldEJwzAMRO3SMTpioWt0gK5bXKskIBtZ9ukK/XEgJJbu3tn6SFLa155AN4FSyrPe965ML4Up7CnoEL5/uQmYCRucY4VZYaPaDM1gAIxXnSGlCCjiaUL7BQJEtH2Ou14Br2jckFnTC/B6My7Ut4KsGgRFxTpQv6McSq+Cqa/mhdrFv8zq9PKDkZuaAnQOK9CqQdBVsRfk9Vb5rm4lYEXjhoyaCBjRjvKaegQY8TSh54IBMd5vPg2olDAjbDxHp54wCzaosNGrx7waplutPXLOL6MXKgmrbkK8wt7XnkAzgQ+2xtFqX+VZZgAAAABJRU5ErkJggg==`;d.push(["deleteImage",e,e=>{this.Controller.DeleteImage()}])}var m=[e,o,d,s,l,u];m.push(c);var S=this.Controller.View.Platform.Toolbar.CreateButtonsAndMenus(m,"DicomPluginLanguage","toolbarviewer.2",this);this.Controller.View.Platform.Toolbar.Groups.push(S);S.Create(this.Controller.View.Platform.Toolbar.Element);this.Controller.SelectDefaultTool();if(this.Controller.View.Platform.GetSetting("ViewportsLayout")===undefined)this.Controller.View.Platform.SetSetting(40,"ViewportsLayout","Auto");if(this.Controller.View.Platform.GetSetting("buttonBarFirstSeriesPopulate")===undefined)this.Controller.View.Platform.SetSetting(40,"buttonBarFirstSeriesPopulate","1");if(this.Controller.View.Platform.GetSetting("selectWlWindow")===undefined)this.Controller.View.Platform.SetSetting(40,"selectWlWindow","increasetoleft");if(this.Controller.View.Platform.GetSetting("selectWlLevel")===undefined)this.Controller.View.Platform.SetSetting(40,"selectWlLevel","increaseup");if(WebClient.Utils.CheckNotAllowTag(["patient","guest"])&&sessionStorage["technology"]==="Efferent"){var C=new WebClient.Tab("dicom",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","dicom").toUpperCase());C.ActionTab=e=>{var t=new DicomPlugin_1.DicomSettingsController(this);t.CreateSettingDicom(e)};this.Controller.View.Platform.TemporalSettingsTabs.push(C)}this.Controller.ViewportPane.MaxViewports=16;this.Controller.CreateStudyDownloader=e=>{var t=this.Controller.Downloader.StructureData[e];if(!t){this.Controller.Downloader.IndexData.push(e);this.Controller.Downloader.StructureData[e]=new DicomPlugin_1.WadoDownloaderAdapter(this.Controller,this)}return t};this.Controller.ThumbnailPane.SearchViewportInThumbnailSeries=(e,t)=>{var n=new Array;var o=this.Controller.ViewportPane.ViewportsArray;if(o!==undefined){for(var s=0;s<o.length;s++){var l=o[s];if(l.Context.StudyGuid===e&&l.Context.SeriesGuid===t){if(DOMUtils.IsDisplay(l.ViewportFrameElement))n.push(l.NumberInPanel)}}}return n};this.Controller.GetStudyWithSeriesAndImages=e=>{var t=this.Controller.ImagingStudyFhirEntities[e.StudyGUID];return Efferent.Frontend.FhirClient.FhirParser.GetStudyWithSeriesAndImagesReference(e,t,["Efferent.ClientViews.ImagingStudyView.StudyEntity","Efferent.ClientViews.ImagingStudyView.SeriesEntity","Efferent.ClientViews.ImagingStudyView.ImageEntity"])};this.Controller.ThumbnailPane.ClearImageOfViewport=(e,t,n=null)=>{var o=this.Controller.ViewportPane.ViewportsArray;for(var s=0;s<o.length;s++){var l=o[s];if(l.Context.StudyGuid===e&&l.Context.SeriesGuid===t){if(DOMUtils.IsDisplay(l.ViewportFrameElement)){if(n!==null&&l.NumberInPanel===n){l.Clear();this.Controller.ThumbnailPane.UpdateAllThumnailsPane();break}else if(n===null){l.Clear();this.Controller.ThumbnailPane.UpdateAllThumnailsPane()}}}}};this.Controller.View.SetLayoutMode=e=>{if(e===ImagingStudyView.LayoutMode.Stack){this.SeriesIndexTileMode=0;this.ScrollIndexTileMode=0}else if(e===ImagingStudyView.LayoutMode.Tile){this.Controller.ToogleLinkTool(false)}};this.Controller.ToogleLinkTool=e=>{var t=this.Controller.View.Platform.Toolbar.GetButton("linkTool");if(e&&this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile){WebClient.Toaster.ShowToast("Link tool only available for Stack mode",WebClient.Colors.Orange,3);return}var n=this.Controller.StudyViewerModel.Documents.IndexData;if(e&&n.length===1){var o=this.Controller.StudyViewerModel.Documents.StructureData[n[0]];if(o.Study.Series.IndexData.length===1){WebClient.Toaster.ShowToast("The link tool cannot be used with a study with only one series",WebClient.Colors.Orange,3);return}}this.IsLinkToolActive=e;WebClient.Toolbar.SelectUnSelectFixedButton(t,e);var s=this.Controller.ViewportPane.ViewportsArray;if(s!==undefined){for(var l=0;l<s.length;l++){var u=s[l];if(u instanceof DicomPlugin_1.DicomViewport){if(e&&u.Context.ImageEntity!==null){u.LinkManager.ViewportLayoutGrid.Element.style.display="block"}else{u.LinkManager.ViewportLayoutGrid.Element.style.display="none"}if(!e){u.LinkManager.Init()}}}}};this.Controller.GetInformationStudy=(e,t,n=false)=>{var o=new Array;if(t){var s=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(s!==null){o.push(WebClient.Utils.FormatValue(s.Context.ImageEntity["dicomTags"][e])||"")}}else if(n){var l=this.Controller.StudyViewerModel.Documents;for(var u=0;u<l.IndexData.length;u++){var c=l.IndexData[u];var d=l.StructureData[c].Study.Series.IndexData[0];var m=l.StructureData[c].Study.Series.StructureData[d].Images.IndexData[0];var S=l.StructureData[c].Study.Series.StructureData[d].Images.StructureData[m];if(S["dicomTags"]!==undefined)o.push(WebClient.Utils.FormatValue(S["dicomTags"][e])||"")}}return o};this.Controller.Init=()=>{this.SetViewportNumbers();this.IsLinkToolActive=false;this.SeriesIndexTileMode=0;this.ScrollIndexTileMode=0;var e=this.Controller.View.Platform.Toolbar.GetButton("linkTool");if(e!==null){DOMUtils.RemoveClass(e.Element,"selected");DOMUtils.RemoveClass(e.Element,"fixedSelected")}if(this.Controller.ToolSelect==="DicomPan"){e=this.Controller.View.Platform.Toolbar.GetButton("panTool");if(e!==null){DOMUtils.AddClass(e.Element,"selected")}}};this.Processors.push(new DicomPlugin_1.WindowLevelProcessor);this.MagnifierElement=document.createElement("div");DOMUtils.AddClass(this.MagnifierElement,"magnifierelement");this.MagnifierCanvasElement=document.createElement("canvas");this.MagnifierCanvasElement.style.width="100px";this.MagnifierCanvasElement.style.height="100px";this.MagnifierCanvasElement.width=100;this.MagnifierCanvasElement.height=100;this.MagnifierElement.appendChild(this.MagnifierCanvasElement);this.Controller.View.ContainerElement.appendChild(this.MagnifierElement);var p=this.Controller.View.Platform.Toolbar.GetButton("imageRender");p.Element.addEventListener("click",(e=>{p=this.Controller.View.Platform.Toolbar.GetButton("imageRender");var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){var n=t.Context.ImageEntity;if(n){try{var o=parseInt(n["dicomTags"]["0028_0002"]);var s=n.TransferSyntax;var l=n["dicomTags"]["0008_0060"];if(s==="1.2.840.10008.1.2.4.50"&&o===3||l!=="CT"){this.Controller.View.Platform.Toolbar.HideButton(null,"titleWlPresets");this.Controller.View.Platform.Toolbar.HideButton(null,"brainTool");this.Controller.View.Platform.Toolbar.HideButton(null,"liverTool");this.Controller.View.Platform.Toolbar.HideButton(null,"lungsTool");this.Controller.View.Platform.Toolbar.HideButton(null,"humanBoneTool");this.Controller.View.Platform.Toolbar.HideButton(null,"stomachTool");WebClient.Toolbar.ResizeDropdown(p.Child.Element,0)}else{this.Controller.View.Platform.Toolbar.ShowButton(null,"titleWlPresets");this.Controller.View.Platform.Toolbar.ShowButton(null,"brainTool");this.Controller.View.Platform.Toolbar.ShowButton(null,"liverTool");this.Controller.View.Platform.Toolbar.ShowButton(null,"lungsTool");this.Controller.View.Platform.Toolbar.ShowButton(null,"humanBoneTool");this.Controller.View.Platform.Toolbar.ShowButton(null,"stomachTool");WebClient.Toolbar.ResizeDropdown(p.Child.Element,0)}}catch(e){WebClient.Utils.DebugConsoleLog(e)}}}}));var A=this.Controller.View.Platform.Toolbar.GetButton("hideFixedAnnotTool");if(this.Controller.AnnotationsHide)WebClient.Toolbar.SelectUnSelectFixedButton(A,true)}GetImageEntityForStudyAndSeries(e,t,n,o){var s;let l;var u=this.Controller.StudyViewerModel.Documents.StructureData[e];let c=u.Study.Series.StructureData[t];let d;if(c["pseudoserie"]){let t=c.KeyImages.IndexData[n];let m=this.GetSeriesGuidFromImageGuid(e,c.KeyImages.StructureData[t].Images[0]["ImageGUID"]);let S=u.Study.Series.StructureData[m];let C=!o?c.KeyImages.StructureData[t].Images[0]["ImageGUID"]:o;l=S.Images.StructureData[C];d=(s=c.KeyImages.StructureData[t].Id)!==null&&s!==void 0?s:c.KeyImages.StructureData[t].KeyImageID}else{let e=!o?c.Images.IndexData[n]:o;l=c.Images.StructureData[e];d=e}return{image:l,id:d}}ProcessStitchToolEvent(e){var t;var n=e.target||e;var o=this.Controller.View.Platform.LanguageManager;if(!DOMUtils.HasClass(n,"toolbarButton"))n=n.parentElement;if(DOMUtils.HasClass(n,"selected"))DOMUtils.RemoveClass(n,"selected");else DOMUtils.AddClass(n,"selected");this.Controller.SelectTool("Pointer","pointerTool");this.Controller.SelectTool("DicomStitch","StitchTool");this.Controller.MultipleSelectViewports=true;this.Controller.UnselectViewports(this.Controller.ViewportPane);this.viewportsStitch=new Array;this.Controller.View.TextBar.innerHTML=o.GetValuesFromDict("DicomPluginLanguage","StitchBarPhaseOneText");this.Controller.View.MessageBar.style.display="block";this.Controller.View.ActionClickBar=()=>{var e=this.Controller.ViewportPane;if(WebClient.LocalStorage.Get("ViewportsLayoutTemporal")!==undefined){this.Controller.View.Platform.SetSetting(40,"ViewportsLayout",WebClient.LocalStorage.Get("ViewportsLayoutTemporal"));WebClient.LocalStorage.Delete("ViewportsLayoutTemporal")}if(e.OneByOneContext.IsActive){var n=this.Controller.ViewportPane.ViewportsArray[0];e.HorizontalViewports=e.OneByOneContext.HorizontalViewports;e.VerticalViewports=e.OneByOneContext.VerticalViewports;e.OneByOneContext.IsActive=false;this.Controller.ExtendViewportPane=false;this.Controller.MultipleSelectViewports=false;this.Controller.HasBlockedDoubleClick=false;this.Controller.ThumbnailPane.Show();this.Controller.ViewportPane.RenderViewportPane();this.Controller.ViewportPane.ChangeViewportsNumber();for(t=0;t<this.Controller.View.Plugins.length;t++)this.Controller.View.Plugins[t].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true);for(t=0;t<this.Controller.View.Plugins.length;t++)this.Controller.View.Plugins[t].SetSeriesAutomaticInViewports(n.Context.StudyGuid,true)}var o=this.Controller.ViewportPane.ViewportsArray;var s=false;for(t=0;t<o.length;t++){var l=o[t].ViewportFrameElement;if(!s&&o[t].Context.ImageEntity!==null){o[t].SelectViewport=true;o[t].ViewportFrameElement.style.borderColor=WebClient.Colors.Emerald;DOMUtils.AddClass(o[t].ViewportFrameElement,"SelectedViewport");s=true}else{l.style.borderColor=WebClient.Colors.BgDarker}DOMUtils.RemoveClass(l,"SelectedViewportStitch")}this.viewportsStitch=new Array;this.Controller.ViewportPane.ViewportsArray[0].Context.ImagesStitch=null;this.Controller.View.MessageBar.style.display="none";DOMUtils.RemoveItem(this.buttonBringToFront);DOMUtils.RemoveItem(this.buttonNext);DOMUtils.RemoveItem(this.buttonDone);this.Controller.View.Platform.Toolbar.DeselectButton("toolbarviewer.2","imageTools","fixedSelectedMenu");this.Controller.SelectDefaultTool()};this.buttonNext=document.createElement("button");this.buttonNext.id="BtnNextStitch";this.buttonNext.style.backgroundColor=WebClient.Colors.SunFlower;this.buttonNext.innerHTML=o.GetValuesFromDict("DicomPluginLanguage","StitchButtonNextText");var s=new Hammer(this.buttonNext);s.on("tap",(e=>{if(e.target.id==="BtnNextStitch"){this.viewportsStitch=new Array;var n=this.Controller.ViewportPane.ViewportsArray;for(t=0;t<n.length;t++){var s=n[t].ViewportFrameElement;if(DOMUtils.HasClass(s,"SelectedViewportStitch")){var l=n[t].Context.StudyGuid;var u=n[t].Context.SeriesGuid;var c=n[t].Context.ImageEntity;this.viewportsStitch.push({StudyGuid:l,SeriesGuid:u,ImageEntity:c})}}if(this.viewportsStitch.length<2){WebClient.Toaster.ShowToast(o.GetValuesFromDict("DicomPluginLanguage","StitchBarPhaseOneText"),WebClient.Colors.BelizeHole,3);return}this.Controller.ExtendViewportPane=true;var d=this.Controller.ViewportPane.ViewportsArray[0];d.Context.ImagesStitch=this.viewportsStitch;var m=this.Controller.ViewportPane;this.Controller.ThumbnailPane.Hide();this.Controller.ViewportPane.RenderViewportPane();this.Controller.HasBlockedDoubleClick=true;for(t=0;t<this.Controller.View.Plugins.length;t++)this.Controller.View.Plugins[t].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true);if(!m.OneByOneContext.IsActive){m.OneByOneContext.HorizontalViewports=m.HorizontalViewports;m.OneByOneContext.VerticalViewports=m.VerticalViewports;m.HorizontalViewports=1;m.VerticalViewports=1;m.OneByOneContext.IsActive=true;WebClient.LocalStorage.Set("ViewportsLayoutTemporal",this.Controller.View.Platform.GetSetting("ViewportsLayout"));this.Controller.View.Platform.SetSetting(40,"ViewportsLayout","Temporal");this.Controller.ViewportPane.ChangeViewportsNumber();for(t=0;t<this.Controller.View.Plugins.length;t++)this.Controller.View.Plugins[t].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true);this.Controller.ThumbnailPane.ClearImageOfViewport(d.Context.StudyGuid,d.Context.SeriesGuid);this.FillStitchImagesInViewport(d);e.target.style.display="none";this.buttonDone.style.display="inline-block";this.buttonBringToFront.style.display="inline-block";this.Controller.View.TextBar.innerHTML=o.GetValuesFromDict("DicomPluginLanguage","StitchBarPhaseTwoText")}}}));this.buttonDone=document.createElement("button");this.buttonDone.id="BtnDoneStitch";this.buttonDone.style.display="none";this.buttonDone.style.backgroundColor=WebClient.Colors.SunFlower;this.buttonDone.innerHTML=o.GetValuesFromDict("DicomPluginLanguage","StitchButtonDoneText");var l=new Hammer(this.buttonDone);l.on("tap",(e=>{var t=this.viewportsStitch[0].StudyGuid;var n=this.viewportsStitch.some((e=>e.StudyGuid!==t));if(!n){if(WebClient.LocalStorage.Get("ViewportsLayoutTemporal")!==undefined){this.Controller.View.Platform.SetSetting(40,"ViewportsLayout",WebClient.LocalStorage.Get("ViewportsLayoutTemporal"));WebClient.LocalStorage.Delete("ViewportsLayoutTemporal")}var o=this.Controller.ViewportPane.ViewportsArray[0];o.Context.IsPseudoSeries=false;o.Context.ImagesStitch=this.viewportsStitch;this.KeyImageCreateRemoveStitch(o);this.Controller.View.ActionClickBar()}else{WebClient.Toaster.ShowToast("Select images from the same study",WebClient.Colors.Orange,3)}}));this.buttonBringToFront=document.createElement("button");this.buttonBringToFront.id="BtnBringToFront";this.buttonBringToFront.style.display="none";this.buttonBringToFront.style.backgroundColor=WebClient.Colors.Emerald;this.buttonBringToFront.innerHTML=o.GetValuesFromDict("DicomPluginLanguage","StitchButtonBringToFront");const u=new Hammer(this.buttonBringToFront);u.on("tap",(e=>{const t=this.Controller.ViewportPane.ViewportsArray[0];const n=t.Context.ImagesStitch;const o=t.Context["CanvasImages"];const s=t.Context.KeyImageEntity.Images.findIndex((e=>e["selected"]===true));if(s>-1){let e=t.Context.KeyImageEntity.Images.splice(s,1)[0];t.Context.KeyImageEntity.Images.push(e);let l=n.splice(s,1)[0];n.push(l);t.Context.ImagesStitch=n;let u=o.splice(s,1)[0];o.push(u);t.Context["CanvasImages"]=o;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}}));var c=this.Controller.View.ButtonsContainer;c.insertBefore(this.buttonNext,c.childNodes[0]);c.insertBefore(this.buttonDone,c.childNodes[0]);c.insertBefore(this.buttonBringToFront,c.childNodes[0]);this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","imageTools","fixedSelectedMenu")}Terminate(){const e=document.querySelector("style#styleDicomPlugin");Efferent.Frontend.WebClient.DOMUtils.RemoveItem(e);if(this.callMPR)this.callMPR.abort()}CloseActionsConfig(){this.OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,false)}AssignViewportDrag(e,t,n,o,s,l){if(s!=="dicom")return;var u=this.Controller.GetSelectViewport(this.Controller.ViewportPane);let c=e.Context.IsPseudoSeries;this.Controller.View.ShowToolbarButtonsBySupportViewport(this.Controller.View.Platform.Toolbar,u);if(!(e instanceof DicomPlugin_1.DicomViewport)){e=this.ReCreateViewport(e.IndexNumber)}var d;var m;if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack){d=e;var S=this.Controller.StudyViewerModel.Documents.StructureData[t];var C=S.Study.Series.StructureData[n.SeriesGUID];this.Controller.StudyGuidOpenInTileMode=undefined;this.SeriesIndexTileMode=0;this.Controller.UnselectViewports(this.Controller.ViewportPane);e.SelectViewport=true;e.ViewportFrameElement.style.borderColor=WebClient.Colors.Emerald;DOMUtils.AddClass(e.ViewportFrameElement,"SelectedViewport");d.ViewportFrameElement.setAttribute("data-seriesGuid",n.SeriesGUID);d.ViewportFrameElement.setAttribute("data-studyGuid",t);if(n.SeriesGUID.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||n.SeriesGUID.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase()){m=C.KeyImages.IndexData[l!==null&&l!==void 0?l:0];d.Context.IsPseudoSeries=true}else{m=C.Images.IndexData[0];d.Context.IsPseudoSeries=false}this.SetTransformationsFromSerieInStackMode(d,c,true);if(d.Context.IsPseudoSeries){d.Context.KeyImageEntity=C.KeyImages.StructureData[m];if(d.Context.KeyImageEntity.Images!==undefined&&d.Context.KeyImageEntity.Images.length===1){d.Context.StudyGuid=t;d.Context.SeriesGuid=n.SeriesGUID;d.SetImageInViewport(l?l:0);d=this.Controller.ViewportPane.ViewportsArray[d.IndexNumber]}else{d.Context.ImageEntity=new ImagingStudyView.ImageEntity}d.Context.TotalImages=C.KeyImages.IndexData.length}else{d.Context.StudyGuid=t;d.Context.SeriesGuid=n.SeriesGUID;d.SetImageInViewport(l?l:0);d=this.Controller.ViewportPane.ViewportsArray[d.IndexNumber];d.Context.TotalImages=C.Images.IndexData.length}d.SetAnnotationsInViewport=false;d.TransformsPerImage={};this.initializeViewport(d,t,n.SeriesGUID,o,l?l:0);if(!d.Context.IsPseudoSeries)this.GetImageAnnotations(d.Context.StudyGuid,this.Controller.StudyViewerModel.Documents.StructureData[d.Context.StudyGuid].Study.Series.StructureData[d.Context.SeriesGuid].Images.StructureData[m]);if(this.IsLinkToolActive)d.LinkManager.ViewportLayoutGrid.Element.style.display="block";this.SetTransformationsFromSerieInStackMode(d,c,false,true)}else if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile){var p=0;var A=this.Controller.ViewportPane.ViewportsArray;var f;this.Controller.StudyGuidOpenInTileMode=t;if(n.SeriesGUID.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||n.SeriesGUID.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase()){f=n.KeyImages.IndexData.length}else{f=n.Images.IndexData.length}this.SeriesIndexTileMode=o;this.ScrollIndexTileMode=p;for(let s=0;s<A.length;s++){A[s].Clear();d=A[s];var I=d.ViewportFrameElement.getElementsByClassName("containerTag");if(I.length===1)WebClient.DOMUtils.RemoveItem(I[0]);if(DOMUtils.IsDisplay(d.ViewportFrameElement)){if(!(d instanceof DicomPlugin_1.DicomViewport)){d=this.ReCreateViewport(d.IndexNumber)}d.ViewportFrameElement.setAttribute("data-seriesGuid",n.SeriesGUID);d.ViewportFrameElement.setAttribute("data-studyGuid",this.Controller.StudyViewerModel.Documents.StructureData[t].Study.StudyGUID);if(p<f){if(n.SeriesGUID.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||n.SeriesGUID.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase())d.Context.IsPseudoSeries=true;else d.Context.IsPseudoSeries=false;if(d.Context.IsPseudoSeries){m=n.KeyImages.IndexData[p];d.Context.KeyImageEntity=n.KeyImages.StructureData[m];if(d.Context.KeyImageEntity&&d.Context.KeyImageEntity.Images!==undefined&&d.Context.KeyImageEntity.Images.length===1){var D=this.GetSeriesGuidFromImageGuid(t,d.Context.KeyImageEntity.Images[0].ImageGUID);d.Context.ImageEntity=this.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[D].Images.StructureData[d.Context.KeyImageEntity.Images[0].ImageGUID]}else{d.Context.ImageEntity=new ImagingStudyView.ImageEntity}d.Context.TotalImages=n.KeyImages.IndexData.length}else{m=n.Images.IndexData[p];if(this.IsSRDicom(n.Images.StructureData[m])){d=this.ForceTransformDicomViewport(true,d);if(d.IndexNumber===e.IndexNumber){e=this.Controller.ViewportPane.ViewportsArray[e.IndexNumber]}d.Context.ImageEntity=n.Images.StructureData[m];this.ControlForSrView(d)}else{d.Context.ImageEntity=n.Images.StructureData[m]}d.Context.TotalImages=n.Images.IndexData.length}this.initializeViewport(d,t,n.SeriesGUID,o,p);this.ReRenderImageProcessed(d,s);if(!d.Context.IsPseudoSeries)this.GetImageAnnotations(d.Context.StudyGuid,this.Controller.StudyViewerModel.Documents.StructureData[d.Context.StudyGuid].Study.Series.StructureData[d.Context.SeriesGuid].Images.StructureData[m]);d.LinkManager.ViewportLayoutGrid.Element.style.display="none";p++}}}}if(!this.IsSRDicom(e.Context.ImageEntity)){e.ImageQualityManager.SetTagQuality();e.Indicator3dManager.SetButtonTag3d()}this.Controller.ThumbnailPane.UpdateAllThumnailsPane();e.ContentElement.focus();e.ContentElement.click();WebClient.Toolbar.UnBlockAndBlockButtons(this.Controller.View.Platform.Toolbar.Groups,false);if(DicomPlugin_1.CineManager.IsCineActive&&DicomPlugin_1.CineManager.SelectedCineViewport!==e){DicomPlugin_1.CineManager.CineImageNumber=0;DicomPlugin_1.CineManager.CineSubImageNumber=0;DicomPlugin_1.CineManager.SelectedCineViewport.EnableActionsOnViewport=true;if(e&&e instanceof DicomPlugin_1.DicomViewport&&e.Context.ImageEntity!==null){this.Controller.SetSelectViewport(e,this.Controller.ViewportPane);DicomPlugin_1.CineManager.SelectedCineViewport=e;DicomPlugin_1.CineManager.PauseCine();DicomPlugin_1.CineManager.PlayCine()}else{DicomPlugin_1.CineManager.CloseUICine()}}this.ValidateViewportVoid()}ReRenderImageProcessed(e,t){let n=e;if(e.Context.ImageEntity&&!this.IsSRDicom(e.Context.ImageEntity)){let o=e.Context.ImageEntity["Processed"]?0:900+(t+10)*350;if(o>0){e.DivLoad.style.display="block"}setTimeout((()=>{n.Context.CanvasImage=null;n.Context.Level=undefined;n.Context.Window=undefined;n.InitCanvasData();n.ZoomToFit();n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();WebClient.Toolbar.UnBlockAndBlockButtons(this.Controller.View.Platform.Toolbar.Groups,false);n.RemoveViewportLoader()}),o)}}ValidateViewportVoid(){let e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(e){if(e instanceof DicomPlugin_1.DicomViewport){if(e.Context.ImageEntity===null||e.Context.ImageEntity["dicomTags"]===undefined){if(!e.Context.IsPseudoSeries)WebClient.Toolbar.UnBlockAndBlockButtons(this.Controller.View.Platform.Toolbar.Groups,true,["back","home","refresh","tags","shareTool","thumbnails","relatedStudiesTool","pointerTool"]);else WebClient.Toolbar.UnBlockAndBlockButtons(this.Controller.View.Platform.Toolbar.Groups,false)}else WebClient.Toolbar.UnBlockAndBlockButtons(this.Controller.View.Platform.Toolbar.Groups,false)}}}EscapeAction(){WebClient.Toolbar.DeselectFixed();this.ShowTriangulations=false;this.Controller.SelectDefaultTool()}RefreshAnnotationsOnAllViewports(e){for(var t=0;t<this.Controller.ViewportPane.ViewportsArray.length;t++){var n=this.Controller.ViewportPane.ViewportsArray[t];if(n.Context.ImageEntity!==null&&n instanceof DicomPlugin_1.DicomViewport&&!n.Context.IsPseudoSeries){if(e===n.Context.StudyGuid){n.Context.ImageEntity.LoadAnnotations=false;this.GetImageAnnotations(n.Context.StudyGuid,n.Context.ImageEntity)}}}}GetImageAnnotations(studyGuid,image){try{if(image&&!image.LoadAnnotations){var recentCreatedAnnotations=new Array;if(image.Annotations&&Array.isArray(image.Annotations)){image.Annotations.forEach((e=>{if(e["recentCreatedOnMemory"]===true)recentCreatedAnnotations.push(e)}))}var Annotations=new Array;image.Annotations=Annotations;image.LoadAnnotations=false;var studyId=this.Controller.ImagingStudyFhirEntities[studyGuid]["id"];var retrieveAnnotations=data=>{for(var i=0;i<data.length;i++){var item=data[i];var itemsKeys=Object.keys(item);var funcKy=e=>{if(e.match(/ImageGuid/)!==null)return e};var keysImagesGuid=itemsKeys.map(funcKy).filter((e=>e!==undefined));var imageItsItems=(e,t,n)=>{try{for(var o=0;o<t.length;o++){if(e[t[o]]===n)return true}return false}catch(e){return false}};if(imageItsItems(item,keysImagesGuid,image.ImageGUID)){try{var annotationSample=eval("new "+item.Namespace+"."+item.Name+"()");annotationSample.Deserialize(JSON.stringify(item));annotationSample.Selected=false;annotationSample.Status=ImagingStudyView.EAnnotationStatus.Complete;Annotations.push(annotationSample)}catch(e){WebClient.Utils.DebugConsoleLog("No Annotation.")}}}image.Annotations=[...Annotations,...recentCreatedAnnotations];image.LoadAnnotations=true;var seriesGuid=this.GetSeriesGuidFromImageGuid(studyGuid,image.ImageGUID);var viewport=this.findImageInViewports(studyGuid,seriesGuid,image.ImageGUID);if(viewport!==null){viewport.AnnotationManager.GetAnnotationsToViewport(image);viewport.Context.Renderer.Render();viewport.Context.OverlayRenderer.Render()}};if(this.Controller.LoadAllAnnotationsForStudy[studyGuid]===undefined){var itemReady=this.Controller.RequestReadyAnnotations[studyGuid];if(itemReady===null){this.Controller.RequestReadyAnnotations[studyGuid]=false;this.Controller.AnnotationClient.GetAllAnnotationsForStudy(studyId,((e,t)=>{if(t)this.Controller.RequestReadyAnnotations[studyGuid]=null;else this.Controller.RequestReadyAnnotations[studyGuid]=true;this.Controller.LoadAllAnnotationsForStudy[studyGuid]=e;retrieveAnnotations(e);this.RefreshAnnotationsOnAllViewports(studyGuid)}))}}else{retrieveAnnotations(this.Controller.LoadAllAnnotationsForStudy[studyGuid])}}else{var seriesGuidA=this.GetSeriesGuidFromImageGuid(studyGuid,image.ImageGUID);var viewportA=this.findImageInViewports(studyGuid,seriesGuidA,image.ImageGUID);if(viewportA!==null){viewportA.AnnotationManager.GetAnnotationsToViewport(image);viewportA.Context.Renderer.Render();viewportA.Context.OverlayRenderer.Render()}}}catch(e){WebClient.Utils.DebugConsoleLog(e);WebClient.Toaster.ShowToast("Error getting annotations",WebClient.Colors.Orange,3)}}InitAnnotations(e,t){t.Context.Annotations=new Array;t.Annotations[this.PluginName]=new Array}SetAnnotations(e,t){if(t.Annotations[this.PluginName]!==undefined){t.AnnotationManager.UpdateAnnotationsPerPlugin(t.Annotations[this.PluginName],t);t.Context.Annotations=t.Annotations[this.PluginName]}}RenderAnnotations(e){e.RenderAnnotations()}ActiveToolsActions(){let e="";if(navigator.userAgent.indexOf("Mac")!==-1)e="⌘";else e="Ctrl";switch(this.Controller.ToolSelect){case"DicomAnnotationLine":if(DicomPlugin.AcumCtrlUseForAnnotations[this.Controller.ToolSelect]<=3){WebClient.Toaster.ShowToast(`Press and hold the [${e}] key to draw orthogonal lines.`,WebClient.Colors.PeterRiver,5);DicomPlugin.AcumCtrlUseForAnnotations[this.Controller.ToolSelect]+=1}break;case"DicomAnnotationEllipse":if(DicomPlugin.AcumCtrlUseForAnnotations[this.Controller.ToolSelect]<=3){WebClient.Toaster.ShowToast(`Press and hold the [${e}] key to draw circles.`,WebClient.Colors.PeterRiver,5);DicomPlugin.AcumCtrlUseForAnnotations[this.Controller.ToolSelect]+=1}break}}HideFixedAnnotations(e){var t=this.Controller.View.Platform.Toolbar.GetButton("hideFixedAnnotTool");var n=!this.Controller.AnnotationsHide;this.Controller.AnnotationsHide=n;if(n){try{var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);for(var s=0;s<this.Controller.View.Plugins.length;s++){var l=this.Controller.View.Plugins[s].PluginName;var u=o.Context.Viewport.Annotations[l];if(u){for(var c=0;c<u.length;c++){delete u[c]["recentCreated"]}}}this.Controller.StudyViewerModel.Documents.IndexData.forEach((e=>{this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData.forEach((t=>{this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[t].Images.IndexData.forEach((n=>{var o=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[t].Images.StructureData[n];o.Annotations.forEach((e=>{delete e["recentCreated"]}))}))}))}))}catch(e){WebClient.Utils.DebugConsoleLog(e)}}WebClient.Toolbar.HideAllMenus();this.Controller.View.Platform.SetSetting(40,"annotationsHideValue",n.toString());WebClient.Toolbar.SelectUnSelectFixedButton(t,n);var d=this.Controller.ViewportPane.ViewportsArray;for(var s=0;s<d.length;s++){var m=d[s];if(m instanceof DicomPlugin_1.DicomViewport){m.Context.Renderer.Render();m.Context.OverlayRenderer.Render()}}}PrintViewportContent(e){let t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t&&t.Context.ImageEntity){if(t.ViewportElement instanceof HTMLCanvasElement){let e;let n;const o=[];const s=document.body.children;for(let e=0;e<s.length;e++){if(s[e].tagName==="DIV"){o.push(getComputedStyle(s[e]).display);s[e].style.display="none"}}window.onafterprint=()=>{document.body.removeChild(e);if(document.head.contains(n))document.head.removeChild(n);for(let e=0;e<s.length;e++){if(s[e].tagName==="DIV")s[e].style.display=o[e]}this.CloseActionsConfig()};let l=true;const u=11/17;const c=t.ViewportElement.toDataURL("image/png");e=document.createElement("img");e.src=c;e.onload=()=>{document.body.appendChild(e);const t=e.naturalWidth;const o=e.naturalHeight;const c=t/o;e.classList.add("printable");if(t>o){if(1/c>u){e.style.width="auto";e.style.height="100%"}else{e.style.width="100%";e.style.height="auto"}}else{if(c>u){e.style.width="100%";e.style.height="auto"}else{e.style.width="auto";e.style.height="100%"}}n=DOMUtils.InjectCSS(`@media print{ @page { size: ${t>o?"landscape":"portrait"} } }`);for(let e=0;e<s.length;e++){if(s[e].tagName==="DIV")s[e].style.display="none"}const d=setTimeout((()=>{if(l)window.print();l=false;clearTimeout(d)}),1e3)}}}else{WebClient.Toaster.ShowToast("Select a viewport.",WebClient.Colors.BelizeHole,3)}}ShowPrintDialog(e){var t=new DicomPlugin_1.PrintDialog(this);t.Show()}DeleteSelectedAnnotations(e){if(e.Context.IsPseudoSeries)return;var t=new Array;var n=e.Context.Annotations.filter((e=>e.Selected===true)).length<=3?true:false;for(var o=0;o<e.Context.Annotations.length;o++){if(e.Context.Annotations[o].Selected===true)e.AnnotationManager.DeleteAnnotation(e.Context.Annotations[o],n);else t.push(e.Context.Annotations[o])}if(!n){WebClient.Toaster.ShowToast("The annotations were deleted.",WebClient.Colors.PeterRiver,3)}e.Context.Annotations=t;e.Annotations[this.PluginName]=e.Context.Annotations;e.AnnotationManager.UpdateAnnotationsToImage();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}GetMouseBehaviors(){var e=this.Controller.View.Platform.LanguageManager;var t="DicomPluginLanguage";var n=[new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Drag,"DicomWindowLevel","Dicom",e.GetValuesFromDict(t,"freeWl"),"freeWl"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomInvertWl","Dicom",e.GetValuesFromDict(t,"invertSelectionTool"),"invertSelectionTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"EvueResetWl","Dicom",e.GetValuesFromDict(t,"evueResetWl"),"evueResetWl"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomResetWl","Dicom",e.GetValuesFromDict(t,"dicomResetWl"),"dicomResetWl"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomBrainTool","Dicom",e.GetValuesFromDict(t,"brainTool"),"brainTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomLiverTool","Dicom",e.GetValuesFromDict(t,"liverTool"),"liverTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomLungsTool","Dicom",e.GetValuesFromDict(t,"lungsTool"),"lungsTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomHumanBoneTool","Dicom",e.GetValuesFromDict(t,"humanBoneTool"),"humanBoneTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomStomachTool","Dicom",e.GetValuesFromDict(t,"stomachTool"),"stomachTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Drag,"DicomZoom","Dicom",e.GetValuesFromDict(t,"zoom"),"zoom"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Hover,"DicomMagnifier","Dicom",e.GetValuesFromDict(t,"magnifierTool"),"magnifierTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Drag,"DicomRotate","Dicom",e.GetValuesFromDict(t,"freeRotation"),"freeRotation"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Drag,"DicomPan","Dicom",e.GetValuesFromDict(t,"panTool"),"panTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomResetTransformations","Dicom",e.GetValuesFromDict(t,"resetTransformations"),"resetTransformations"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomZoomToFit","Dicom",e.GetValuesFromDict(t,"zoomToFit"),"zoomToFit"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomZoomOneToOne","Dicom",e.GetValuesFromDict(t,"zoomOneToOne"),"zoomOneToOne"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomRotateLeft","Dicom",e.GetValuesFromDict(t,"rotateLeft"),"rotateLeft"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomRotateRight","Dicom",e.GetValuesFromDict(t,"rotateRight"),"rotateRight"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomFlipHorizontalTool","Dicom",e.GetValuesFromDict(t,"flipHorizontalTool"),"flipHorizontalTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomFlipVerticalTool","Dicom",e.GetValuesFromDict(t,"flipVerticalTool"),"flipVerticalTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomCaseStudyTool","Dicom",e.GetValuesFromDict(t,"caseStudyTool"),"caseStudyTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Drag,"DicomTriangulation","Dicom",e.GetValuesFromDict(t,"triangulationTool"),"triangulationTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"DicomAnnotationLine","Dicom",e.GetValuesFromDict(t,"lineTool"),"lineTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"DicomAnnotationEllipse","Dicom",e.GetValuesFromDict(t,"ellipseTool"),"ellipseTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"DicomAnnotationAngle","Dicom",e.GetValuesFromDict(t,"angleTool"),"angleTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"DicomAnnotationArrow","Dicom",e.GetValuesFromDict(t,"downLeftTool"),"downLeftTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"DicomAnnotationRectangle","Dicom",e.GetValuesFromDict(t,"rectangleTool"),"rectangleTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"DicomAnnotationText","Dicom",e.GetValuesFromDict(t,"textBoxTool"),"textBoxTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomDeleteAnnotTool","Dicom",e.GetValuesFromDict(t,"deleteAnnotTool"),"deleteAnnotTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomCineTool","Dicom",e.GetValuesFromDict(t,"cineTool"),"cineTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomLinkTool","Dicom",e.GetValuesFromDict(t,"linkTool"),"linkTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomAddKey","Dicom",e.GetValuesFromDict(t,"addKey"),"addKey"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomRemoveKey","Dicom",e.GetValuesFromDict(t,"removeKey"),"removeKey"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"Dicom1x1Layout","Dicom",e.GetValuesFromDict(t,"1x1Layout"),"1x1Layout"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.Activate,"DicomStitch","Ortho",e.GetValuesFromDict(t,"StitchTool"),"StitchTool")];return n}SetTransformationsFromSerieInStackMode(e,t,n,o=false){if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack&&!t){if(e.Context.ImageEntity){let t={ScaleX:e.Context.ScaleX,ScaleY:e.Context.ScaleY,Rotation:e.Context.Rotation,OffsetX:e.Context.OffsetX,OffsetY:e.Context.OffsetY};try{if(n){e.Context["SavedEarlyTransformations"]=JSON.stringify(t)}else if(!n&&o){t=JSON.parse(e.Context["SavedEarlyTransformations"]);e.Context.ScaleX=t.ScaleX;e.Context.ScaleY=t.ScaleY;e.Context.OffsetX=t.OffsetX;e.Context.OffsetY=t.OffsetY;e.Context.Rotation=t.Rotation;delete e.Context["SavedEarlyTransformations"];e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}catch(e){WebClient.Utils.DebugConsoleLog(e)}}}}IsSRDicom(e){let t=false;if(e&&e["dicomTags"]&&e["dicomTags"]["0008_0060"]==="SR")t=true;return t}ForceTransformDicomViewport(e,t){let n=t.ViewportElement.constructor.name;if(n==="HTMLCanvasElement"&&e){let e=document.createElement("div");WebClient.Utils.CopyProperties(t.ViewportElement,e);WebClient.DOMUtils.RemoveItem(t.ViewportElement);let n=t.ContentElement.querySelector(".containerTag");if(n)WebClient.DOMUtils.RemoveItem(n);this.Controller.ViewportPane.ViewportsArray[t.IndexNumber].ViewportElement=e;t=this.ReCreateViewport(t.IndexNumber,["StudyGuid","SeriesGuid","SeriesIndex","TotalImages","TotalSeriesInStudy","ImageIndex","ImageEntity"],false,true)}else if(n==="HTMLDivElement"&&!e){let e=document.createElement("canvas");WebClient.Utils.CopyProperties(t.ViewportElement,e);let n=t.IndexNumber;WebClient.DOMUtils.RemoveItem(t.ViewportElement);this.Controller.ViewportPane.ViewportsArray[t.IndexNumber].ViewportElement=e;t=this.ReCreateViewport(n,["StudyGuid","SeriesGuid","SeriesIndex","TotalImages","TotalSeriesInStudy"],false,true)}return t}ControlForSrView(e){let t=document.createElement("img");t.src=DicomPlugin_1.ResourceBag.Icons8MedicalHistory64Png;t.alt="View report";t.style.cursor="pointer";t.style.width="64px";t.style.height="64px";let n=document.createElement("div");n.appendChild(t);n.style.width="100%";n.style.height="100%";n.style.position="relative";n.style.display="flex";n.style.textAlign="center";n.style.flexDirection="column";n.style.alignItems="center";n.className="wlTableContainer";let o=document.createElement("div");o.style.display="flex";o.style.flexDirection="column";o.style.alignItems="center";o.style.margin="auto";t.setAttribute("data-tooltip","View report");t.setAttribute("data-position","center top");let s=new WebClient.Tooltip(t,new WebClient.ToolTipOptions(0,2));let l=[{name:"Tag",field:"tag",width:"10%"},{name:"Value",field:"value",width:"50%",withToolTip:true,maxChars:30},{name:"Description",field:"description",withToolTip:true,width:"40%"}];let u=this.GetHTmlTableTags(e.Context.ImageEntity,l);let c=document.createElement("label");c.innerHTML="Structured Report";c.style.marginTop="10px";o.appendChild(t);o.appendChild(c);n.appendChild(o);t.addEventListener("click",(()=>{n.setAttribute("opened","active");n.style.width=e.GetWidth()+"px";n.style.height=e.GetHeight()+"px";WebClient.Tooltip.RemoveToolTips();var t=document.createElement("h2");t.appendChild(document.createTextNode("Report:"));DOMUtils.AddClass(t,"modalbox_title");var o=document.createElement("div");DOMUtils.AddClass(o,"content");o.appendChild(u);DOMUtils.ScrollElement(o);DOMUtils.CreateModal({content:o,title:t,close:true})}));e.ViewportElement.appendChild(n);this.resizeReportViewports()}MandatoryTagsIsPresents(e){let t=true;if(e&&e["dicomTags"]){let n=["0028_0010","0028_0011"];n.forEach((n=>{if(!e["dicomTags"][n])t=false}))}else{t=false}return t}OnEvent(e,t,n,o){var s=n;if(!(n instanceof DicomPlugin_1.DicomViewport)){if(e==="singletap"&&DicomPlugin_1.CineManager.IsCineActive&&DicomPlugin_1.CineManager.SelectedCineViewport!==n){this.Controller.SetSelectViewport(n,this.Controller.ViewportPane);DicomPlugin_1.CineManager.SelectedCineViewport.EnableActionsOnViewport=true;DicomPlugin_1.CineManager.SelectedCineViewport=s;DicomPlugin_1.CineManager.PauseCine();DicomPlugin_1.CineManager.CloseUICine();WebClient.Toaster.ShowToast("The cine tool was closed because the selected viewport does not contain images.",WebClient.Colors.Alizarin,6)}return}switch(e){case"singletap":case"doubletap":this.preProcessTapEvent(n);if(!n.EnableActionsOnViewport&&!DicomPlugin_1.CineManager.IsCineActive)return;if(e==="singletap"){n.ProcessSingleTap(t,o)}else{n.ProcessDoubleTap(t,o)}break;case"wheel":if(!n.EnableActionsOnViewport)return;var l=this.Controller.View.Platform.GetSetting("zoomWheelOrientation");var u=this.Controller.View.Platform.GetSetting("seriesScrollWheelOrientation")||"up";if(o.deltaY>0){if(!t.match("Annotation")){if(this.Controller.View.Platform.GetSetting("wheelOperation")==="scrollImages"){s.ScrollImages(u==="up")}else if(this.Controller.View.Platform.GetSetting("wheelOperation")==="scrollZoomToCenter"){if(s.PointMove!==null){if(l==="down")s.ZoomToCenter(s.PointMove,o.deltaX*-1,o.deltaY*-1);else if(l==="up")s.ZoomToCenter(s.PointMove,o.deltaX*1,o.deltaY*1)}}}}else if(o.deltaY<0){if(!t.match("Annotation")){if(this.Controller.View.Platform.GetSetting("wheelOperation")==="scrollImages"){s.ScrollImages(u!=="up")}else if(this.Controller.View.Platform.GetSetting("wheelOperation")==="scrollZoomToCenter"){if(s.PointMove!==null){if(l==="up")s.ZoomToCenter(s.PointMove,o.deltaX*1,o.deltaY*1);else if(l==="down")s.ZoomToCenter(s.PointMove,o.deltaX*-1,o.deltaY*-1)}}}}break;case"keydown":n.ProcessKeyDown(t,o);break;case"mouseup":n.ProcessMouseUp(t,o);break;case"mousedown":n.ProcessMouseDown(t,o);break;case"mousemove":n.ProcessMouseMove(t,o);break;case"mouseout":this.MagnifierElement.style.visibility="hidden";this.MagnifierElement.style.display="";break;case"panleft":case"panright":case"panup":case"pandown":case"panstart":case"panmove":case"panend":case"press":case"pressup":case"swipeleft":case"swiperight":case"swipeup":case"swipedown":n.ProcessPanAndSwipe(t,o);break;case"pinch":case"pinchstart":case"pinchmove":case"pinchend":case"rotate":case"rotatestart":case"rotatemove":case"rotateend":n.ProcessPinchAndRotate(t,o);break}}ShouldApplyWLPreset(){var e=true;var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){var n=t.Context.ImageEntity;if(n){try{var o=parseInt(n["dicomTags"]["0028_0002"]);var s=n.TransferSyntax;var l=n["dicomTags"]["0008_0060"];if(s==="1.2.840.10008.1.2.4.50"&&o===3||l!=="CT"){e=false}}catch(e){}}}return e}DetectMoveStitch(e,t){if(t.Context.ImagesStitch!==null&&t.Context.ImagesStitch!==undefined){const n=t.Context.KeyImageEntity;const o=n.Images;const s=this.DetectRotateStitch(o,e,t);if(s.index!==-1&&s.cornerIndex!==-1){this.StitchIndexRotate=s.index;o[this.StitchIndexRotate]["rotateInitial"]=o[this.StitchIndexRotate].Rotation;let n=new WebClient.Point(e.X*t.Context.ScaleX+t.Context.OffsetX,e.Y*t.Context.ScaleY+t.Context.OffsetY);this.MouseRotateStitchPointA=n}else{const n=this.DetectStitchImageSelectedIndex(o,e,t);if(n!==-1)this.StitchIndexMove=n}}}DetectRotateStitch(e,t,n){let o={isRotate:false,index:-1,cornerIndex:-1};let s=new WebClient.Point(t.X*n.Context.ScaleX+n.Context.OffsetX,t.Y*n.Context.ScaleY+n.Context.OffsetY);for(let t=e.length-1;t>=0;t--){const l=parseInt(n.Context.ImagesStitch[t].ImageEntity["dicomTags"]["0028_0011"]);const u=parseInt(n.Context.ImagesStitch[t].ImageEntity["dicomTags"]["0028_0010"]);const c=l*n.Context.ScaleX;const d=u*n.Context.ScaleY;let m=e[t].Rotation/180*Math.PI;for(let l=0;l<=3;l++){let u=100*n.Context.ScaleX;let S=100*n.Context.ScaleY;let C=new WebClient.Point(0,0);let p;let A;let f;let I;switch(l){case 0:C.X=-(c/2);C.Y=-(d/2);p=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X,C.Y),m);A=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X+u,C.Y),m);f=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X+u,C.Y+S),m);I=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X,C.Y+S),m);break;case 1:C.X=c/2;C.Y=-(d/2);p=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X-u,C.Y),m);A=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X,C.Y),m);f=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X,C.Y+S),m);I=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X-u,C.Y+S),m);break;case 2:C.X=c/2;C.Y=d/2;p=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X-u,C.Y-S),m);A=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X,C.Y-S),m);f=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X,C.Y),m);I=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X-u,C.Y),m);break;case 3:C.X=-(c/2);C.Y=d/2;p=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X,C.Y-S),m);A=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X+u,C.Y-S),m);f=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X+u,C.Y),m);I=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(C.X,C.Y),m);break}let D=new WebClient.Point(n.Context.OffsetX+e[t].X*n.Context.ScaleX,n.Context.OffsetY+e[t].Y*n.Context.ScaleY);let P=new WebClient.Point(D.X+p.X+c/2,D.Y+p.Y+d/2);let v=new WebClient.Point(D.X+A.X+c/2,D.Y+A.Y+d/2);let T=new WebClient.Point(D.X+f.X+c/2,D.Y+f.Y+d/2);let V=new WebClient.Point(D.X+I.X+c/2,D.Y+I.Y+d/2);const R=Math.min(...[P.X,v.X,T.X,V.X]);const E=Math.min(...[P.Y,v.Y,T.Y,V.Y]);const M=Math.max(...[P.X,v.X,T.X,V.X]);const G=Math.max(...[P.Y,v.Y,T.Y,V.Y]);if(s.X>=R&&s.X<=M&&(s.Y>=E&&s.Y<=G)){o.isRotate=true;o.index=t;o.cornerIndex=l;t=-1;break}}}return o}DetectStitchImageSelectedIndex(e,t,n){let o=new WebClient.Point(t.X*n.Context.ScaleX+n.Context.OffsetX,t.Y*n.Context.ScaleY+n.Context.OffsetY);for(let t=e.length-1;t>=0;t--){const s=parseInt(n.Context.ImagesStitch[t].ImageEntity["dicomTags"]["0028_0011"]);const l=parseInt(n.Context.ImagesStitch[t].ImageEntity["dicomTags"]["0028_0010"]);const u=s*n.Context.ScaleX;const c=l*n.Context.ScaleY;let d=e[t].Rotation/180*Math.PI;let m=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(-(u/2),-(c/2)),d);let S=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(u/2,-(c/2)),d);let C=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(u/2,c/2),d);let p=ImagingStudyView.Geometry.pointRotated(new WebClient.Point(-(u/2),c/2),d);let A=new WebClient.Point(n.Context.OffsetX+e[t].X*n.Context.ScaleX,n.Context.OffsetY+e[t].Y*n.Context.ScaleY);let f=new WebClient.Point(A.X+m.X+u/2,A.Y+m.Y+c/2);let I=new WebClient.Point(A.X+S.X+u/2,A.Y+S.Y+c/2);let D=new WebClient.Point(A.X+C.X+u/2,A.Y+C.Y+c/2);let P=new WebClient.Point(A.X+p.X+u/2,A.Y+p.Y+c/2);const v=Math.min(...[f.X,I.X,D.X,P.X]);const T=Math.min(...[f.Y,I.Y,D.Y,P.Y]);const V=Math.max(...[f.X,I.X,D.X,P.X]);const R=Math.max(...[f.Y,I.Y,D.Y,P.Y]);if(o.X>=v&&o.X<=V&&(o.Y>=T&&o.Y<=R)){return t}}return-1}Activate1x1(e){var t=this.Controller.ViewportPane;var n=e;let o=e.GetWidth();let s=e.GetHeight();if(!t.OneByOneContext.IsActive){this.ViewportReference1x1=n;t.OneByOneContext.HorizontalViewports=t.HorizontalViewports;t.OneByOneContext.VerticalViewports=t.VerticalViewports;t.HorizontalViewports=1;t.VerticalViewports=1;t.OneByOneContext.IsActive=true;WebClient.LocalStorage.Set("ViewportsLayoutTemporal",this.Controller.View.Platform.GetSetting("ViewportsLayout"));this.Controller.View.Platform.SetSetting(40,"ViewportsLayout","Temporal");var l={studyGuid:n.Context.StudyGuid,seriesGuid:n.Context.SeriesGuid,seriesIndex:n.Context.SeriesIndex,imageIndex:n.Context.ImageIndex};this.Controller.ViewportPane.ShowOnlyViewportId=n.Id;this.Controller.ViewportPane.ChangeViewportsNumber();var u;var c;if(!e.Context.IsPseudoSeries){u=this.Controller.StudyViewerModel.Documents.StructureData[l.studyGuid].Study;c=u.Series.StructureData[l.seriesGuid].Images.IndexData[l.imageIndex]}else{u=this.Controller.StudyViewerModel.Documents.StructureData[l.studyGuid].Study;var d=u.Series.StructureData[l.seriesGuid].KeyImages.IndexData[0];c=d}this.SetSeriesToViewport(l.studyGuid,l.seriesGuid,c,l.seriesIndex,l.imageIndex,true)}else{this.Controller.ViewportPane.ShowOnlyViewportId=undefined;t.HorizontalViewports=t.OneByOneContext.HorizontalViewports;t.VerticalViewports=t.OneByOneContext.VerticalViewports;t.OneByOneContext.IsActive=false;this.Controller.View.Platform.SetSetting(40,"ViewportsLayout",WebClient.LocalStorage.Get("ViewportsLayoutTemporal"));WebClient.LocalStorage.Delete("ViewportsLayoutTemporal");e.SetWindowLevel(undefined,undefined);this.Controller.ViewportPane.ChangeViewportsNumber();if(this.ViewportReference1x1&&e!==this.ViewportReference1x1){this.ViewportReference1x1.ViewportElement.setAttribute("oldWidth",e.ViewportElement.getAttribute("oldWidth"));this.ViewportReference1x1.ViewportElement.setAttribute("oldHeight",e.ViewportElement.getAttribute("oldHeight"))}this.ViewportReference1x1.Context.OffsetX=e.Context.OffsetX;this.ViewportReference1x1.Context.OffsetY=e.Context.OffsetY;this.OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,true);var m=this.Controller.StudyViewerModel.Documents.IndexData;for(var S=0;S<m.length;S++){var C=this.Controller.StudyViewerModel.Documents.StructureData[m[S]];for(var p=0;p<this.Controller.View.Plugins.length;p++){this.Controller.View.Plugins[p].SetSeriesAutomaticInViewports(C.Study.StudyGUID,false)}}this.ViewportReference1x1=null}var A=this.Controller.ViewportPane.ViewportsArray;for(var f=0;f<A.length;f++){var I=A[f];if(DOMUtils.IsDisplay(I.ViewportFrameElement)&&I.Context.ImageEntity!==null){this.Controller.UnselectViewports(this.Controller.ViewportPane);I.SelectViewport=true;I.ViewportFrameElement.style.borderColor=WebClient.Colors.Emerald;DOMUtils.AddClass(I.ViewportFrameElement,"SelectedViewport");I.ZoomToFit(true);break}}}SetViewportNumbers(){var e=this.Controller.View.Platform.GetSetting("ViewportsLayout");if(e==="Auto"&&!this.Controller.ChangeLayoutFromToolbar){var t=0;var n=0;if(this.Controller.ThumbnailPane.ThumbnailPaneSection.style.display!=="none"){if(this.Controller.ThumbnailPane.Position===ImagingStudyView.PanePosition.Left||this.Controller.ThumbnailPane.Position===ImagingStudyView.PanePosition.Right)t=this.Controller.ThumbnailPane.ThumbnailPaneSection.clientWidth;if(this.Controller.ThumbnailPane.Position===ImagingStudyView.PanePosition.Left||this.Controller.ThumbnailPane.Position===ImagingStudyView.PanePosition.Right)n=this.Controller.ThumbnailPane.ThumbnailPaneSection.clientHeight}var o=document.documentElement.clientWidth-t-30;var s=document.documentElement.clientHeight-n-this.Controller.View.Platform.Toolbar.Element.clientHeight-30;var l=o>=500?Math.min(parseInt(Math.round(o/500).toString()),3):1;var u=s>=500?Math.min(parseInt(Math.round(s/500).toString()),3):1;if(parseInt(this.Controller.View.Platform.GetSetting("HorizontalViewport"))!==l){this.Controller.View.Platform.SetSetting(40,"HorizontalViewport",l.toString())}this.Controller.ViewportPane.HorizontalViewports=l;if(parseInt(this.Controller.View.Platform.GetSetting("VerticalViewport"))!==u){this.Controller.View.Platform.SetSetting(40,"VerticalViewport",u.toString())}this.Controller.ViewportPane.VerticalViewports=u}else if(e==="Manual"){this.Controller.ViewportPane.HorizontalViewports=+this.Controller.View.Platform.GetSetting("HorizontalViewport");this.Controller.ViewportPane.VerticalViewports=+this.Controller.View.Platform.GetSetting("VerticalViewport")}}GetThumbnailAndAssign(e,t,n,o,s,l,u=1){if(this.Controller.StudyViewerModel.Documents.StructureData[e]===undefined)return;var c=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[t].Images.StructureData[o].ImageUri;var d=c.match(/^(([a-z]+:)?(\/\/)?[^\/]+\/).*$/)[1];var m=c.substr(d.length);var S=WebClient.PlatformContext.PlatformUri+"/"+m;var C=new ImagingStudyView.WadoClient(S);var p=sessionStorage["token"];var A=1;var f;var I;var D=this.Controller.StudyViewerModel.Documents.StructureData[e].Study["getThumbnailCache"];if(l===undefined||l===""){var P=this.Controller.View.Platform.CacheConnect.ServiceUrlCache;var v="Low";if(this.Controller.View.Platform.CacheConnect.OfflineMode&&P!==undefined&&P!==""&&D===undefined){var T=c.match(/^(([a-z]+:)?(\/\/)?[^\/]+\/).*$/)[1];var V=c.substr(T.length);c=P+"/"+V;S=c;C=new ImagingStudyView.WadoClient(S);if(!this.Controller.View.Platform.CacheConnect.OfflineMode)p=sessionStorage["tokenCache"];v="High"}C.GetImageFile(p,v,A,null,(c=>{try{if(c.data.length===0)throw new Error("Image buffer length is zero");var d=new ImagingStudyView.DicomParser(c.data);var m=d.image;var S=d.transferSyntax;if(S==="1.2.840.10008.1.2.4.50"){var C=window.btoa(WebClient.Utils.Uint8ToString(m));var p="data:image/jpeg;base64,"+C;I=document.createElement("div");I.className="ThumbnailImage";f=new Image;f.setAttribute("data-seriesIndex",n.toString());f.setAttribute("data-imageIndex",s.toString());f.onload=t=>{var n=t.currentTarget;var o=parseInt(n.getAttribute("data-imageIndex"));var s=parseInt(n.getAttribute("data-seriesIndex"));var l=document.createElement("canvas");var u=l.getContext("2d");if(f.width>=f.height){var c=120;l.width=c;l.height=l.width*(f.height/f.width)}else{var d=120;l.height=d;l.width=l.height*(f.width/f.height)}u.drawImage(f,0,0,l.width,l.height);var m=l.toDataURL();var S=this.GetSeriesAndImageGuids(e,s,o);this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[S.seriesGuid].Images.StructureData[S.imageGuid].Thumbnail=m;if(this.Controller.ThumbnailPane.Thumbnails[e][s].SeriesImage===undefined){var C=new Image;C.src=m;C.style.minWidth=C.naturalWidth+"px";this.Controller.ThumbnailPane.Thumbnails[e][s].SeriesImage=C;this.Controller.ThumbnailPane.Thumbnails[e][s].Element.appendChild(I);I.appendChild(C)}};f.src=p}else{var A=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[t].Images.StructureData[o];var D=new DicomPlugin_1.WindowLevelProcessor;var P=parseInt(A["dicomTags"]["0028_1050"]||0);var v=parseInt(A["dicomTags"]["0028_1051"]||1);var T=parseInt(A["dicomTags"]["0028_0011"]);var V=parseInt(A["dicomTags"]["0028_0010"]);var R=D.ProcessBuffer(A,null,A["dicomTags"]["invert"],v,P);var E=document.createElement("canvas");var M=E.getContext("2d");if(T>=V){E.width=120;E.height=E.width*(V/T)}else{E.height=120;E.width=E.height*(T/V)}M.drawImage(R,0,0,E.width,E.height);var G=E.toDataURL();I=document.createElement("div");I.className="ThumbnailImage";f=new Image;f.setAttribute("data-seriesIndex",n.toString());f.setAttribute("data-imageIndex",s.toString());f.onload=t=>{var n=t.currentTarget;var o=parseInt(n.getAttribute("data-imageIndex"));var s=parseInt(n.getAttribute("data-seriesIndex"));var l=this.GetSeriesAndImageGuids(e,s,o);this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid].Thumbnail=G;if(this.Controller.ThumbnailPane.Thumbnails[e][s].SeriesImage===undefined){var u=new Image;u.src=n.src;u.style.minWidth=n.naturalWidth+"px";this.Controller.ThumbnailPane.Thumbnails[e][s].SeriesImage=u;this.Controller.ThumbnailPane.Thumbnails[e][s].Element.appendChild(I);I.appendChild(u)}};f.src=G}DicomPlugin_1.KeyImageManager.PseudoSerieStudy.ControllerKeyImagesLoad(e);DicomPlugin_1.StitchManager.PseudoSerieStudy.ControllerKeyImagesLoad(e)}catch(c){this.Controller.StudyViewerModel.Documents.StructureData[e].Study["getThumbnailCache"]="inactive";if(u<=2)this.GetThumbnailAndAssign(e,t,n,o,s,l,u+1)}}))}else{I=document.createElement("div");I.className="ThumbnailImage";f=new Image;f.setAttribute("data-seriesIndex",n.toString());f.setAttribute("data-imageIndex",s.toString());f.onload=t=>{var n=t.currentTarget;var o=parseInt(n.getAttribute("data-imageIndex"));if(this.Controller.ThumbnailPane.Thumbnails[e][s].SeriesImage===undefined){var s=parseInt(n.getAttribute("data-seriesIndex"));this.Controller.ThumbnailPane.Thumbnails[e][s].SeriesImage=f;f.style.minWidth=n.naturalWidth+"px";this.Controller.ThumbnailPane.Thumbnails[e][s].Element.appendChild(I);I.appendChild(f)}};f.src=l}}SetEventsCaseStudy(){this.Controller.CaseStudyController.GetDataStudySelect=()=>{var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(e!==null){if(e.Context.ImageEntity!==null){return this.Controller.StudyViewerModel.Documents.StructureData[e.Context.StudyGuid].Study}}return null};this.Controller.CaseStudyController.SaveNewCaseStudy=(e,t)=>{var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(n!==null){if(n.Context.ImageEntity!==null){var o=this.Controller.StudyViewerModel.Documents.StructureData[n.Context.StudyGuid];var s=o!==undefined?o["Study"]["IsCase"]:null;if(s!==null&&WebClient.Utils.StrToBool(s)){WebClient.Toaster.ShowToast("You cannot create a case study from another case study.",WebClient.Colors.Orange,5);return}var l=true;var u;try{var c=this.Controller.CaseStudyController.GetDataStudySelect();var d=c.StudyGUID;u=this.Controller.ImagingStudyFhirEntities[d]["modifierExtension"][0]["url"].split("/")[1];if(sessionStorage["organizationId"]!==u){l=false}}catch(e){WebClient.Utils.DebugConsoleLog(e)}var m={resourceType:"Parameters",id:e["id"],parameter:[{id:e["OriginalResourceId"],name:e["resourceType"],resource:{resourceType:e["resourceType"],series:e["series"]}}]};delete e["OriginalResourceId"];if(t){var S={};Object.assign(S,e);delete S["series"];var C=new FhirCall("ImagingStudy"+(t?"":"/"+S["id"]),t?"POST":"PUT");if(!l&&!t){var p={};p["X-Organization-PK"]=u;C.Headers=p}C.BodyData=JSON.stringify(S);C.FuncOk=(e,t)=>{WebClient.Toaster.ShowToast("The case study was successfully created.",WebClient.Colors.BelizeHole,3);this.PostAddInstance(m,"ImagingStudy",(e=>{if(!e)WebClient.Toaster.ShowToast("Error adding the image to case study.",WebClient.Colors.Orange,3)}))};C.FuncError=e=>{WebClient.Toaster.ShowToast("Saving Case Study error.",WebClient.Colors.Orange,3)};C.Send()}else{m.parameter[0].resource.series.splice(0,m.parameter[0].resource.series.length-1);this.PostAddInstance(m,"ImagingStudy",(e=>{if(!e)WebClient.Toaster.ShowToast("Error adding the image to case study.",WebClient.Colors.Orange,3);else WebClient.Toaster.ShowToast("The Image was successfully added to the case study.",WebClient.Colors.BelizeHole,3)}))}}}}}PostAddInstance(e,t,n){var o=new FhirCall(t+"/"+e["id"]+"/$add-instances","POST");o.BodyData=JSON.stringify(e);o.FuncOk=(e,t)=>{n(true)};o.FuncError=e=>{n(false)};o.Send()}GetSeriesAndImageGuids(e,t,n){var o=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData[t];var s=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[o].SeriesGUID;var l=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[s].Images.IndexData[n];var u=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[s].Images.StructureData[l].ImageGUID;return{seriesGuid:s,imageGuid:u}}Evaluate3DAnnotation(e,t){}OpenPaneStlLayout(){}OnWindowResize(e,t,n=false,o=false){if(!this.Controller.GetSelectViewport)return;var s=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(this.Controller.StudyViewerModel.Documents.IndexData.length===0||this.Controller.MultipleSelectViewports)return;if(this.Controller.FullScreen)o=false;if(this.Controller.ExitFullScreen){o=false;this.Controller.ExitFullScreen=false}var l=this.Controller.ViewportPane.ViewportsArray;var u=0;var c=0;if(l===undefined)return;this.Controller.ViewportPane.RenderViewportPane();this.SetViewportNumbers();this.Controller.ViewportPane.ChangeViewportsNumber(false);var d=true;if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack){var m=this.Controller.StudyViewerModel.Documents;if(m.IndexData.length===1){if(d)this.SetSeriesAutomaticInViewports(m.StructureData[m.IndexData[0]].Study.StudyGUID,o)}else{for(var S=0;S<l.length;S++){var C=l[S];C.Clear()}for(var p=0;p<m.IndexData.length;p++){var A=m.IndexData[p];var f=m.StructureData[A].Study.StudyGUID;if(d)this.SetSeriesAutomaticInViewports(f,false)}}}else{var I=this.Controller.StudyGuidOpenInTileMode!==undefined?this.Controller.StudyGuidOpenInTileMode:(s!==null?s.Context.StudyGuid:null)||this.Controller.StudyViewerModel.Documents.IndexData[0];if(d)this.SetSeriesAutomaticInViewports(I,o)}for(var D=0;D<l.length;D++){var P=l[D];if(P instanceof DicomPlugin_1.DicomViewport&&P.Context.ImageEntity!==null){u=P.GetWidth();c=P.GetHeight();const e=P.ViewportFrameElement.clientWidth;const t=P.ViewportFrameElement.clientHeight;P.ViewportElement.setAttribute("width",e);P.ViewportElement.setAttribute("height",t);P.Width=e;P.Height=t;if(DOMUtils.IsDisplay(P.ViewportFrameElement)){let e;try{e=this.Controller.StudyViewerModel.Documents.StructureData[P.Context.StudyGuid].Study.Series.StructureData[P.Context.SeriesGuid].Images.StructureData[P.Context.ImageEntity.ImageGUID]}catch(e){}if(e&&e["isZoomed"]===true){P.RestoreZoomInRescale(u,c)}else if(e&&e["isZoomed"]===false){P.ZoomToFit()}else{P.ZoomToFit()}}P.LinkManager.ViewportLayoutGrid.HorizontalViewports=this.Controller.ViewportPane.HorizontalViewports;P.LinkManager.ViewportLayoutGrid.VerticalViewports=this.Controller.ViewportPane.VerticalViewports;P.LinkManager.UpdateLayoutGrid(P);P.Context.Renderer.Render();P.Context.OverlayRenderer.Render();if(this.IsLinkToolActive&&this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack)P.LinkManager.ViewportLayoutGrid.Element.style.display="block";else P.LinkManager.ViewportLayoutGrid.Element.style.display="none"}}var v=this.Controller.ViewportPane.ViewportsArray;for(var D=0;D<v.length;D++){try{var T=v[D];if(T!==null&&DOMUtils.IsDisplay(T.ViewportFrameElement)&&T.Context.ImageEntity!==null){T.Context.Renderer.Render();T.Context.OverlayRenderer.Render()}}catch(e){}}this.Controller.ThumbnailPane.UpdateAllThumnailsPane();this.ValidateViewportVoid();this.resizeReportViewports()}ReCreateViewport(e,t,n=false,o=false){var s=this.Controller.ViewportPane.ViewportsArray[e];var l=s.NumberInPanel;var u=new DicomPlugin_1.DicomViewport(this.Controller.ViewportPane.ViewportPaneSection,"viewportSection_"+(e+1),(e=>{}),this.Controller,this.Controller.ViewportPane,this);u.CreateWithoutEvents=n;u.Create(e,s.ViewportFrameElement,s.ViewportElement,s.ContentElement,o);if(this.Controller.ViewportPane.ViewportsArray[e]instanceof DicomPlugin_1.DicomViewport){u.Context.ScaleX=this.Controller.ViewportPane.ViewportsArray[e].Context.ScaleX;u.Context.ScaleY=this.Controller.ViewportPane.ViewportsArray[e].Context.ScaleX;u.Context.OffsetX=this.Controller.ViewportPane.ViewportsArray[e].Context.OffsetX;u.Context.OffsetY=this.Controller.ViewportPane.ViewportsArray[e].Context.OffsetY;u.Width=this.Controller.ViewportPane.ViewportsArray[e].Width;u.Height=this.Controller.ViewportPane.ViewportsArray[e].Height;let n=this.Controller.ViewportPane.ViewportsArray[e].ViewportElement.getAttribute("oldwidth");let o=this.Controller.ViewportPane.ViewportsArray[e].ViewportElement.getAttribute("oldheight");if(n)u.ViewportElement.setAttribute("oldwidth",n);if(o)u.ViewportElement.setAttribute("oldheight",o);if(t){t.forEach((t=>{u.Context[t]=this.Controller.ViewportPane.ViewportsArray[e].Context[t]}))}}this.Controller.ViewportPane.ViewportsArray[e]=u;this.Controller.ViewportPane.ViewportsArray[e].NumberInPanel=l;return this.Controller.ViewportPane.ViewportsArray[e]}BuildViewports(){this.Controller.ViewportPane.ViewportPaneSection.innerHTML="";var e=document.createElement("div");e.setAttribute("id","DivViewportDumy");e.setAttribute("tabindex","1");e.style.display="none";this.Controller.ViewportPane.ViewportPaneSection.appendChild(e);this.Controller.ViewportPane.RenderViewportPane();var t=new Array;this.Controller.ViewportPane.ViewportsCollection=new Array;for(var n=0;n<this.Controller.ViewportPane.MaxViewports;n++){this.Controller.ViewportPane.ViewportsCollection.push(new ImagingStudyView.ViewportCollection);var o=new DicomPlugin_1.DicomViewport(this.Controller.ViewportPane.ViewportPaneSection,"viewportSection_"+(n+1),(e=>{}),this.Controller,this.Controller.ViewportPane,this);o.Create(n);t.push(o)}this.Controller.ViewportPane.ViewportsArray=t;this.Controller.ViewportPane.ViewportsArray[0].SelectViewport=true;this.Controller.ViewportPane.ViewportsArray[0].ViewportFrameElement.style.borderColor=WebClient.Colors.Emerald;DOMUtils.AddClass(this.Controller.ViewportPane.ViewportsArray[0].ViewportFrameElement,"SelectedViewport");this.SetViewportNumbers();this.Controller.ViewportPane.ChangeViewportsNumber();this.OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true);this.Controller.ViewportPane.ViewportsArray[0].ViewportFrameElement.focus();this.Controller.ViewportPane.ViewportsArray[0].ViewportFrameElement.click();this.Controller.View.ShowToolbarButtonsBySupportViewport(this.Controller.View.Platform.Toolbar,this.Controller.ViewportPane.ViewportsArray[0])}ConvertJpegImageToCanvasData(e,t,n,o,s,l,u){var c=document.createElement("img");c.setAttribute("data-seriesGuid",t);c.setAttribute("data-seriesIndex",s.toString());c.setAttribute("data-imageGuid",n);c.setAttribute("data-imageIndex",l.toString());c.onload=t=>{var n=t.currentTarget;var o=n.getAttribute("data-seriesGuid");var s=n.getAttribute("data-imageGuid");var l=parseInt(n.getAttribute("data-seriesIndex"));var d=parseInt(n.getAttribute("data-imageIndex"));var m=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[o].Images.StructureData[s];var S=(m["photometric"]||"").toString().trim().toUpperCase();if(m===null||m["dicomTags"]===undefined)return;m["dicomTags"]["0028_0011"]=c.naturalWidth;m["dicomTags"]["0028_0010"]=c.naturalHeight;var C=parseInt(m["dicomTags"]["0028_0011"]);var p=parseInt(m["dicomTags"]["0028_0010"]);var A=document.createElement("canvas");A.width=C;A.height=p;var f=A.getContext("2d");var I=f.createImageData(C,p);var D=document.createElement("canvas");D.width=C;D.height=p;var P=D.getContext("2d");P.drawImage(c,0,0);var v=P.getImageData(0,0,C,p);var T=v.data;var V=0;var R=0;var E=0;var M=0;var G=0;var L=0;var F=0;var B=0;var O;O=new Uint16Array(T.length/4);var G=0;while(G<T.length){V=T[G++];R=T[G++];E=T[G++];M=T[G++];var N=Math.round((V+R+E<<B)/3);O[F]=N;F++;I.data[L++]=V;I.data[L++]=R;I.data[L++]=E;I.data[L++]=255}f.putImageData(I,0,0);var U=m["dicomTags"]["0028_1050"]!==undefined&&m["dicomTags"]["0028_1051"]!==undefined;if(S.indexOf("YBR")!==-1){m["dicomTags"]["0028_0002"]=3;O=I.data}else if(S.indexOf("MONOCHROME")!==-1||U){m["dicomTags"]["0028_0002"]=1}else if(parseInt(m["dicomTags"]["0028_0002"])===3){O=I.data}else{m["dicomTags"]["0028_0002"]=m["dicomTags"]["0028_0002"]||1}m["buffer"]=O;WebClient.DicomBufferRenderer.GetWLFromImage(m);this.Process3DInformation(m);this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[o].Images.StructureData[s]["Processed"]=true;if(u!==undefined){u(e,m)}else{var k=this.Controller.View.Platform.GetSetting("chkAutomaticViewportPopulation")===undefined?true:WebClient.Utils.StrToBool(this.Controller.View.Platform.GetSetting("chkAutomaticViewportPopulation"));if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack){if(k)this.Controller.View.SetSerieResourceToViewport(this.PluginName,e,o,s,l,d);else this.ValidateViewportVoid()}else if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile){if(l===0){if(k)this.Controller.View.SetSerieResourceToViewport(this.PluginName,e,o,s,l,d);else this.ValidateViewportVoid()}}let t=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData.length;let n=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[o].Images.IndexData.length;let u=t-1>=l+1?this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData[l+1]:null;if(u!==null&&u.match(/PseudoSeries/)!==null){DicomPlugin_1.KeyImageManager.PseudoSerieStudy.ControllerKeyImagesLoad(e);DicomPlugin_1.StitchManager.PseudoSerieStudy.ControllerKeyImagesLoad(e)}this.GetImageAnnotations(e,m)}};c.src=o}LinkedImagesOthersViewports(e){if(e.Context.ImageEntity["dicomTags"]===undefined||e.Context.ImageEntity["dicomTags"]["0018_0050"]===undefined)return;var t=parseFloat(e.Context.ImageEntity["dicomTags"]["0018_0050"]);for(var n=0;n<this.Controller.ViewportPane.ViewportsArray.length;n++){var o=this.Controller.ViewportPane.ViewportsArray[n];if(e.Context.SeriesGuid!==o.Context.SeriesGuid){if(e.IsViewportInGroup(o)){var s=this.Controller.StudyViewerModel.Documents.StructureData[o.Context.StudyGuid].Study.Series.StructureData[o.Context.SeriesGuid];if(s!==null){var l=t;var u=-1;for(var c=0;c<s.Images.IndexData.length;c++){var d=s.Images.IndexData[c];var m=s.Images.StructureData[d];if(m!==null&&m["has3DInformation"]){var S=e.Context.ImageEntity["corners"];var C=m["corners"];var p=new ImagingStudyView.Vector2D;var A=p.DistanceToPlane([C[0][0],C[0][1],C[0][2]],[C[1][0],C[1][1],C[1][2]],[C[2][0],C[2][1],C[2][2]],[S[0][0],S[0][1],S[0][2]]);A=Math.abs(A);if(A<=l){l=A;u=c}else if(A>t&&u>=0){break}}}if(u>=0){o.SetImageInViewport(u)}}}}}}Project3DPoint(e,t){var n=e["dicomTags"]["0020_0037"];var o=e["dicomTags"]["0020_0032"];var s=e["pixelSpacing"];if(o===undefined)return null;t.X-=o[0];t.Y-=o[1];t.Z-=o[2];var l=n[3]*t.X+n[4]*t.Y+n[5]*t.Z;var u=n[0]*t.X+n[1]*t.Y+n[2]*t.Z;var c=u/s[0]+.5;var d=l/s[1]+.5;return new WebClient.Point(c,d)}Process3DInformation(e){if(e===null||e["dicomTags"]===undefined)return;var t;var n;var o;var s;var l=parseInt(e["dicomTags"]["0028_0011"]);var u=parseInt(e["dicomTags"]["0028_0010"]);try{if(!e.IsCalibrated()){if(e["dicomTags"]["0028_0030"]){t=e["dicomTags"]["0028_0030"].split("\\")}else if(e["dicomTags"]["0018_1164"]){t=e["dicomTags"]["0018_1164"].split("\\")}if(t){o=parseFloat(t[0]);n=parseFloat(t[1]);e["pixelSpacing"]=[o,n,"mm"]}else{e["pixelSpacing"]=[1,1,"px"];e["has3DInformation"]=false}}}catch(t){if(!e.IsCalibrated()){e["pixelSpacing"]=[1,1,"px"];e["has3DInformation"]=false}else{var c=e.GetCalibration();var d=(c.Value/c.Diameter).toFixed(5);e["pixelSpacing"]=[d,d,"mm"]}return}finally{if(Array.isArray(e["pixelSpacing"])&&(e["pixelSpacing"][0]===0||e["pixelSpacing"][1]===0)){e["pixelSpacing"]=[1,1,"px"];e["has3DInformation"]=false}}try{t=e["dicomTags"]["0020_0032"].split("\\");e["dicomTags"]["0020_0032"]=[parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])];t=e["dicomTags"]["0020_0037"].split("\\");s=e["dicomTags"]["0020_0037"]=[parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]),parseFloat(t[5])];e["normalVector"]=[s[4]*s[2]-s[5]*s[1],s[5]*s[0]-s[3]*s[2],s[3]*s[1]-s[4]*s[0]];e["has3DInformation"]=true;e["centroid"]=ImagingStudyView.Geometry.Calculate3DPosition(e,l/2,u/2);var m=ImagingStudyView.Geometry.Calculate3DPosition(e,0,0);var S=ImagingStudyView.Geometry.Calculate3DPosition(e,l-1,0);var C=ImagingStudyView.Geometry.Calculate3DPosition(e,0,u-1);var p=ImagingStudyView.Geometry.Calculate3DPosition(e,l-1,u-1);e["corners"]=[[m.X,m.Y,m.Z],[S.X,S.Y,S.Z],[C.X,C.Y,C.Z],[p.X,p.Y,p.Z]]}catch(t){e["has3DInformation"]=false}}UpdateImageProperties(e){e.Context.Level=undefined;e.Context.Window=undefined;e.Context.CanvasImage=null;e.Context.Coord3D=null;e.ProcessWLStart=false;this.Controller.ThumbnailPane.UpdateAllThumnailsPane();e.ZoomToFit();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();e.ImageQualityManager.SetTagQuality();e.Indicator3dManager.SetButtonTag3d()}IsSerieFullDownloaded(e,t){let n=true;e.Series.IndexData.forEach((o=>{if(t===o){var s=e.Series.StructureData[o].Images;if(s!==undefined&&s!==null){s.IndexData.forEach((t=>{var s=e.Series.StructureData[o].Images.StructureData[t];if(!s["Load"]){n=false}}))}}}));return n}IsActiveDownloadForceHD(e,t){var n;if(!this.Controller.StudyViewerModel.Documents.StructureData[e])return null;var o=this.Controller.StudyViewerModel.Documents.StructureData[e].Study;var s=this.Controller.ForceHDDownloadForStudyAndSerie;var l=true;if(!s[e])return null;if(s[e]&&!s[e].some((e=>e.seriesGuid===t)))return null;n=s[e].some((e=>e.seriesGuid===t&&e.isActive));if(n){o.Series.IndexData.forEach((e=>{if(t===e){var n=o.Series.StructureData[e].Images;if(n!==undefined&&n!==null){n.IndexData.forEach((t=>{var n=o.Series.StructureData[e].Images.StructureData[t];if(n["Load"]&&!n["HDIsNotAvailable"]&&n["dicomTags"]["0002_0010"]==="1.2.840.10008.1.2.4.50"||!n["Load"]&&!n["NoRetryDownload"])l=false}))}else{l=false}}}));s[e].forEach((e=>{if(e.seriesGuid===t){if(l)e.isActive=false}}));n=s[e].some((e=>e.seriesGuid===t&&e.isActive))}return n}CheckFullDownloadStudy(e,t){var n=true;e.Series.IndexData.forEach((o=>{if(!t||t&&o===t){var s=e.Series.StructureData[o].Images;if(s!==undefined&&s!==null){s.IndexData.forEach((t=>{var s=e.Series.StructureData[o].Images.StructureData[t];if((s["Load"]===undefined||s["Load"]===false)&&s["NoRetryDownload"]!==true){n=false;return false}}))}}}));return n}SerieIsDicom(e){let t=true;if(e.ImageCount===1){if(e.Images){let n=e.Images.IndexData[0];if(e.Images.StructureData[n]["TypeFile"]!=="DICOM")t=false}}return t}SetSeriesAutomaticInViewports(e,t=false){var n,o;if(this.Controller.StudyViewerModel.Documents.IndexData.length===0)return;var s=this.Controller.ViewportPane.ViewportsArray;var l=(o=(n=this.Controller.GetSelectViewport(this.Controller.ViewportPane))===null||n===void 0?void 0:n.Context)===null||o===void 0?void 0:o.SeriesIndex;if(t){this.Controller.View.Plugins.forEach((e=>{e.ClearViewports()}))}var u=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series;var c=this.Controller.View.Platform.GetSetting("buttonBarFirstSeriesPopulate")===undefined?1:parseInt(this.Controller.View.Platform.GetSetting("buttonBarFirstSeriesPopulate"));c=c-1;this.SeriesIndexTileMode=l!==null&&l!==void 0?l:c;for(var d=c;d<u.IndexData.length;d++){var m=u.IndexData[d];var S=u.StructureData[m];var C;var p;var A;if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack&&this.findSeriesInViewports(e,m))continue;if(!this.SerieIsDicom(S))continue;if(t)this.ScrollIndexTileMode=0;var f=this.ScrollIndexTileMode;for(var I=0;I<s.length;I++){var D=s[I];try{if(DOMUtils.IsDisplay(D.ViewportFrameElement)&&D.Context.ImageEntity===null){D=this.ReCreateViewport(D.IndexNumber);if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack){var P=0;if(S.Images!==null&&S.Images!==undefined&&((S.Images.StructureData[S.Images.IndexData[0]]["Load"]===undefined||S.Images.StructureData[S.Images.IndexData[0]]["Load"]===false)&&!S.Images.StructureData[S.Images.IndexData[0]]["buffer"])){return}else if(S["KeyImages"]!==null&&S["KeyImages"]!==undefined){p=this.GetSeriesGuidFromImageGuid(e,S.KeyImages.StructureData[S.KeyImages.IndexData[P]].Images[0].ImageGUID);A=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[p].Images.StructureData[S.KeyImages.StructureData[S.KeyImages.IndexData[P]].Images[0].ImageGUID];if((A["Load"]===undefined||A["Load"]===false)&&!A["buffer"])return}D.ViewportFrameElement.setAttribute("data-seriesGuid",m);D.ViewportFrameElement.setAttribute("data-studyGuid",this.Controller.StudyViewerModel.Documents.StructureData[e].Study.StudyGUID);if(m.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||m.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase())D.Context.IsPseudoSeries=true;else D.Context.IsPseudoSeries=false;if(D.Context.IsPseudoSeries){C=S.KeyImages.IndexData[P];D.Context.KeyImageEntity=S.KeyImages.StructureData[C];if(D.Context.KeyImageEntity.Images!==undefined&&D.Context.KeyImageEntity.Images.length===1){D.Context.StudyGuid=e;D.Context.SeriesGuid=m;D.SetImageInViewport(0);D=this.Controller.ViewportPane.ViewportsArray[D.IndexNumber]}else{D.Context.ImageEntity=new ImagingStudyView.ImageEntity}D.Context.TotalImages=S.KeyImages.IndexData.length}else{D.Context.StudyGuid=e;D.Context.SeriesGuid=m;D.Context.SeriesIndex=d;D.Context.ImageIndex=P;D.SetImageInViewport(P);D=this.Controller.ViewportPane.ViewportsArray[D.IndexNumber];D.Context.TotalImages=S.Images.IndexData.length}D.SetAnnotationsInViewport=false;this.initializeViewport(D,e,m,d,P);if(this.IsLinkToolActive)D.LinkManager.ViewportLayoutGrid.Element.style.display="block";D.ImageQualityManager.SetTagQuality();D.Indicator3dManager.SetButtonTag3d();break}else if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile&&d===this.SeriesIndexTileMode){var v;D.Context.IsPseudoSeries=m.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||m.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase();v=D.Context.IsPseudoSeries?S.KeyImages.IndexData.length:S.Images.IndexData.length;if(f<v){if(m.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||m.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase())C=S.KeyImages.IndexData[f];else C=S.Images.IndexData[f];if(S.Images!==null&&S.Images!==undefined&&((S.Images.StructureData[S.Images.IndexData[f]]["Load"]===undefined||S.Images.StructureData[S.Images.IndexData[f]]["Load"]===false)&&!S.Images.StructureData[S.Images.IndexData[f]]["buffer"])){return}else if(S["KeyImages"]!==null&&S["KeyImages"]!==undefined){p=this.GetSeriesGuidFromImageGuid(e,S.KeyImages.StructureData[C].Images[0].ImageGUID);A=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[p].Images.StructureData[S.KeyImages.StructureData[C].Images[0].ImageGUID];if((A["Load"]===undefined||A["Load"]===false)&&!A["buffer"])return}if(!t){if(m.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||m.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase()){if(this.findImageInViewports(e,m,C,true)!==null)return}else if(this.findImageInViewports(e,m,C)!==null){return}}D.ViewportFrameElement.setAttribute("data-seriesGuid",m);D.ViewportFrameElement.setAttribute("data-studyGuid",e);if(D.Context.IsPseudoSeries){D.Context.KeyImageEntity=S.KeyImages.StructureData[C];if(D.Context.KeyImageEntity.Images!==undefined&&D.Context.KeyImageEntity.Images.length===1){var T=this.GetSeriesGuidFromImageGuid(e,D.Context.KeyImageEntity.Images[0].ImageGUID);D.Context.ImageEntity=this.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[T].Images.StructureData[D.Context.KeyImageEntity.Images[0].ImageGUID]}else{D.Context.ImageEntity=new ImagingStudyView.ImageEntity}D.Context.TotalImages=S.KeyImages.IndexData.length}else{if(this.IsSRDicom(S.Images.StructureData[C])){D=this.ForceTransformDicomViewport(true,D)}D.Context.ImageEntity=S.Images.StructureData[C];D.Context.TotalImages=S.Images.IndexData.length}D.SetAnnotationsInViewport=false;D.LinkManager.ViewportLayoutGrid.Element.style.display="none";if(!this.IsSRDicom(D.Context.ImageEntity)){this.initializeViewport(D,e,m,d,f);if(!D.Context.IsPseudoSeries)this.GetImageAnnotations(D.Context.StudyGuid,this.Controller.StudyViewerModel.Documents.StructureData[D.Context.StudyGuid].Study.Series.StructureData[D.Context.SeriesGuid].Images.StructureData[C]);D.ImageQualityManager.SetTagQuality();D.Indicator3dManager.SetButtonTag3d()}else{this.ControlForSrView(D)}this.ScrollIndexTileMode=f+=1}}else{break}}}catch(e){WebClient.Utils.DebugConsoleLog(e)}}this.ValidateViewportVoid();if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile&&d===this.SeriesIndexTileMode)d=u.IndexData.length}}FillStitchImagesInViewport(e){var t=e;t.InitCanvasData();t.Context.CanvasImage=null;t.ProcessWLStart=false;t.Context.StudyGuid=e.Context.ImagesStitch[0].StudyGuid;t.Context.IsPseudoSeries=true;e.Context.KeyImageEntity=new WebClient.KeyImageEntity;e.Context.KeyImageEntity.KeyImageID=WebClient.Utils.GetGuid();e.Context.KeyImageEntity.Images=new Array;for(var n=0;n<e.Context.ImagesStitch.length;n++){var o=new WebClient.KeyImageElementEntity;o.ImageGUID=e.Context.ImagesStitch[n].ImageEntity.ImageGUID;o.Rotation=0;o.Zoom=1;o.X=0;o.Y=0;o.GeneratedWidthViewport=e.GetWidth();o.GeneratedHeightViewport=e.GetHeight();e.Context.KeyImageEntity.Images[n]=o}var s=0;var l=0;t.Context.CanvasImages=[];for(var u=0;u<e.Context.ImagesStitch.length;u++){if(e.Context.ImagesStitch[u].ImageEntity===null||e.Context.ImagesStitch[u].ImageEntity["dicomTags"]===undefined)continue;var c=parseInt(e.Context.ImagesStitch[u].ImageEntity["dicomTags"]["0028_0011"]);var d=parseInt(e.Context.ImagesStitch[u].ImageEntity["dicomTags"]["0028_0010"]);s+=c;l+=d;t.Context.CanvasImages[u]=null}var m=s/e.Width;var S=l/e.Height;var C=1;C/=Math.max(m,S);e.Context.ScaleX=C;e.Context.ScaleY=C;var p=20;for(var A=0;A<e.Context.ImagesStitch.length;A++){var f=e.Context.KeyImageEntity.Images[A];if(A>0){var I=0;var D=e.Context.ImagesStitch.length;var P=A;while(P>0){I+=parseInt(e.Context.ImagesStitch[A-1].ImageEntity["dicomTags"]["0028_0010"]);P--}f.X=0;f.Y=I+A*p}}t.Context.Renderer.Render()}FillImagesStitchWithKeyImages(e){e.Context.ImagesStitch=new Array;for(var t=0;t<e.Context.KeyImageEntity.Images.length;t++){var n=e.Context.KeyImageEntity.Images[t].ImageGUID;var o=this.GetSeriesGuidFromImageGuid(e.Context.StudyGuid,n);var s={ImageEntity:this.Controller.StudyViewerModel.Documents.StructureData[e.Context.StudyGuid].Study.Series.StructureData[o].Images[n],SeriesGuid:o,StudyGuid:this.Controller.StudyViewerModel.Documents.StructureData[e.Context.StudyGuid].Study.StudyGUID};e.Context.ImagesStitch.push(s)}}SetDefaultTool(e){switch(e){case"DicomWindowLevel":this.Controller.SelectTool(e,"freeWl");break;case"DicomZoom":this.Controller.SelectTool(e,"zoom");break;case"DicomRotate":this.Controller.SelectTool(e,"freeRotation");break;case"DicomPan":this.Controller.SelectTool(e,"panTool");break;case"DicomTriangulation":this.Controller.SelectTool(e,"triangulationTool");break;default:break}}SetImageToViewportLight(studyGuid,seriesGuid,imageGuid,seriesIndex,imageIndex,subImageIndex,viewport,zoom,imageScale,newOffsetPosition,withAnnotations=true,withTextInformation=true,paperOptions,paperOrientation,viewportImageSize,printAreaSize){return new Promise((resolve=>{var item=this.Controller.StudyViewerModel.Documents.StructureData[studyGuid].Study.Series.StructureData[seriesGuid];viewport.SetAnnotationsInViewport=false;viewport.Context.Annotations=new Array;viewport.Context.IsPseudoSeries=seriesGuid.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||seriesGuid.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase();viewport.Context.ScoutLineIsActive=false;let printFactor=1;if(viewport.Context.IsPseudoSeries){viewport.SetAnnotationsInViewport=false;viewport.Context.KeyImageEntity=item.KeyImages.StructureData[item.KeyImages.IndexData[imageIndex]];if(viewport.Context.KeyImageEntity.Images!==undefined&&viewport.Context.KeyImageEntity.Images.length===1){var seriesGuidTemp=this.GetSeriesGuidFromImageGuid(studyGuid,viewport.Context.KeyImageEntity.Images[0].ImageGUID);viewport.Context.ImageEntity=this.Controller.StudyViewerModel.Documents.StructureData[studyGuid].Study.Series.StructureData[seriesGuidTemp].Images.StructureData[viewport.Context.KeyImageEntity.Images[0].ImageGUID];let isZoomed=viewport.Context.ImageEntity["isZoomed"];delete this.Controller.StudyViewerModel.Documents.StructureData[studyGuid].Study.Series.StructureData[seriesGuidTemp].Images.StructureData[viewport.Context.KeyImageEntity.Images[0].ImageGUID]["isZoomed"];this.initializeViewport(viewport,studyGuid,seriesGuid,seriesIndex,imageIndex);if(zoom){viewport.Context.ScaleX=imageScale.Width;viewport.Context.ScaleY=imageScale.Height;viewport.Context.OffsetX=viewport.Context.OffsetX-newOffsetPosition.X;viewport.Context.OffsetY=viewport.Context.OffsetY-newOffsetPosition.Y}if(viewport.Context.KeyImageEntity.Annotations!==null&&viewport.Context.KeyImageEntity.Annotations!==undefined){var annotS=JSON.parse(viewport.Context.KeyImageEntity.Annotations);var fullAnnotations=new Array;for(var jn=0;jn<annotS.length;jn++){var annotI=JSON.parse(annotS[jn]);var annotationSample=eval("new "+annotI.Namespace+"."+annotI.Name+"()");annotationSample.Deserialize(annotS[jn]);fullAnnotations.push(annotationSample)}viewport.AnnotationManager.PropagateAnnotations(fullAnnotations,viewport.Context,viewport);viewport.AnnotationManager.UnselectAllAnnotations()}viewport.Context.TotalImages=item.KeyImages.IndexData.length;if(!withAnnotations)viewport.Context.HideAllAnnotations=true;if(paperOptions){printFactor=this.getFactorPrint(viewport.Context.ImageEntity,paperOptions,paperOrientation,viewportImageSize,printAreaSize);if(zoom){viewport.Context.ZoomNumberShow=zoom*100;viewport.Context.PrintFactor=printFactor>=1.5?printFactor*.3:printFactor}else{let e=viewport.Context.ImageEntity["dicomTags"]["0028_0011"];const t=viewport.Context.ImageEntity?viewport.Context.ImageEntity["pixelSpacing"]?viewport.Context.ImageEntity["pixelSpacing"][0]:1:1;viewport.Context.ZoomNumberShow=viewportImageSize.Width*(25.4/72)/(e*t)*100;viewport.Context.PrintFactor=printFactor}}viewport.Context.Renderer.Render();viewport.Context.PrintFactor=1;if(withTextInformation)viewport.Context.OverlayRenderer.Render();this.Controller.StudyViewerModel.Documents.StructureData[studyGuid].Study.Series.StructureData[seriesGuidTemp].Images.StructureData[viewport.Context.KeyImageEntity.Images[0].ImageGUID]["isZoomed"]=isZoomed}else if(viewport.Context.KeyImageEntity.Images!==undefined&&viewport.Context.KeyImageEntity.Images.length>1){this.initializeViewport(viewport,studyGuid,seriesGuid,seriesIndex,imageIndex);if(zoom){viewport.Context.ScaleX=imageScale.Width;viewport.Context.ScaleY=imageScale.Height;viewport.Context.OffsetX=viewport.Context.OffsetX-newOffsetPosition.X;viewport.Context.OffsetY=viewport.Context.OffsetY-newOffsetPosition.Y}viewport.Context.TotalImages=item.KeyImages.IndexData.length;viewport.Context.Renderer.Render();if(withTextInformation)viewport.Context.OverlayRenderer.Render()}resolve(true)}else{viewport.Context.ImageEntity=item.Images.StructureData[imageGuid];viewport.Context.TotalImages=item.Images.IndexData.length;let e=viewport.Context.ImageEntity["isZoomed"];delete item.Images.StructureData[imageGuid]["isZoomed"];this.initializeViewport(viewport,studyGuid,seriesGuid,seriesIndex,imageIndex);let finalAction=()=>{if(zoom){viewport.Context.ScaleX=imageScale.Width;viewport.Context.ScaleY=imageScale.Height;viewport.Context.OffsetX=viewport.Context.OffsetX-newOffsetPosition.X;viewport.Context.OffsetY=viewport.Context.OffsetY-newOffsetPosition.Y}viewport.AnnotationManager.SetSaveOrRetrieveStatusAnnotations(true);viewport.AnnotationManager.UnselectAllAnnotations();if(!withAnnotations)viewport.Context.HideAllAnnotations=true;if(paperOptions){printFactor=this.getFactorPrint(viewport.Context.ImageEntity,paperOptions,paperOrientation,viewportImageSize,printAreaSize);if(zoom){viewport.Context.ZoomNumberShow=zoom*100;viewport.Context.PrintFactor=printFactor>=1.5?printFactor*.3:printFactor}else{let e=viewport.Context.ImageEntity["dicomTags"]["0028_0011"];const t=viewport.Context.ImageEntity?viewport.Context.ImageEntity["pixelSpacing"]?viewport.Context.ImageEntity["pixelSpacing"][0]:1:1;viewport.Context.ZoomNumberShow=viewportImageSize.Width*(25.4/72)/(e*t)*100;viewport.Context.PrintFactor=printFactor}}viewport.Context.Renderer.Render();if(withTextInformation)viewport.Context.OverlayRenderer.Render();viewport.Context.PrintFactor=1;viewport.AnnotationManager.SetSaveOrRetrieveStatusAnnotations(false);item.Images.StructureData[imageGuid]["isZoomed"]=e;resolve(true)};if(viewport.Context.ImageEntity["bufferArray"]!==null&&viewport.Context.ImageEntity["bufferArray"]!==undefined){viewport.Context.ImageSubIndex=subImageIndex;var bufferContent=viewport.Context.ImageEntity["bufferArray"][subImageIndex];viewport.Context.ImageEntity["buffer"]=bufferContent;if(viewport.Context.ImageEntity.TransferSyntax==="1.2.840.10008.1.2.4.50"){var datImage=window.btoa(WebClient.Utils.Uint8ToString(bufferContent));var imagebase64="data:image/jpeg;base64,"+datImage;this.ConvertJpegImageToCanvasData(viewport.Context.StudyGuid,viewport.Context.SeriesGuid,viewport.Context.ImageEntity.ImageGUID,imagebase64,viewport.Context.SeriesIndex,viewport.Context.ImageIndex,(()=>{finalAction()}))}else if(viewport.Context.ImageEntity.TransferSyntax==="1.2.840.10008.1.2.1"){WebClient.DicomBufferRenderer.GetWLFromImage(this.Controller.StudyViewerModel.Documents.StructureData[viewport.Context.StudyGuid].Study.Series.StructureData[viewport.Context.SeriesGuid].Images.StructureData[imageGuid]);finalAction()}}else{finalAction()}}}))}SetSeriesToViewport(studyGuid,seriesGuid,imageGuid,seriesIndex,imageIndex,force=false,viewportForce){if(this.Controller.ViewportPane.OneByOneContext.IsActive&&this.Controller.MultipleSelectViewports)return;var indexFullSeries=this.Controller.View.Platform.GetSetting("buttonBarFirstSeriesPopulate")===undefined?1:parseInt(this.Controller.View.Platform.GetSetting("buttonBarFirstSeriesPopulate"));indexFullSeries=indexFullSeries-1;if(!force&&seriesIndex<indexFullSeries)return;var item=this.Controller.StudyViewerModel.Documents.StructureData[studyGuid].Study.Series.StructureData[seriesGuid];if(item.SeriesGUID===seriesGuid){if(item.Images!==undefined&&item.Images!==null&&((item.Images.StructureData[item.Images.IndexData[imageIndex]]["Load"]===undefined||item.Images.StructureData[item.Images.IndexData[imageIndex]]["Load"]===false)&&!item.Images.StructureData[item.Images.IndexData[imageIndex]]["buffer"])){return}else if(item.KeyImages!==undefined&&item.KeyImages!==null){var seriesGuidT1=this.GetSeriesGuidFromImageGuid(studyGuid,item.KeyImages.StructureData[imageGuid].Images[0].ImageGUID);var imgEnt=this.Controller.StudyViewerModel.Documents.StructureData[studyGuid].Study.Series.StructureData[seriesGuidT1].Images.StructureData[item.KeyImages.StructureData[imageGuid].Images[0].ImageGUID];if((imgEnt["Load"]===undefined||imgEnt["Load"]===false)&&!imgEnt["buffer"])return}if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack){if(!force&&this.findSeriesInViewports(studyGuid,seriesGuid))return}else if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile){if(this.ScrollIndexTileMode===0){this.ScrollIndexTileMode=imageIndex=0}else{if(!this.Controller.ViewportPane.OneByOneContext.IsActive)imageIndex=this.ScrollIndexTileMode}if(seriesGuid.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||seriesGuid.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase()){if(this.findImageInViewports(studyGuid,seriesGuid,imageGuid,true)!=null)return;else if(this.findImageInViewports(studyGuid,seriesGuid,imageGuid)!=null)return}if(item.Images&&this.ScrollIndexTileMode>=item.Images.IndexData.length)return}var viewports=this.Controller.ViewportPane.ViewportsArray;for(var i=0;i<viewports.length;i++){let viewport=viewports[i];if(!force||force&&viewport===viewportForce){if(!this.Controller.ViewportPane.OneByOneContext.IsActive&&this.Controller.ViewportPane.HorizontalViewports!==1&&this.Controller.ViewportPane.VerticalViewports!==1){if(!(viewports[i]instanceof DicomPlugin_1.DicomViewport))continue}else{if(force)viewport=this.ReCreateViewport(viewports[i].IndexNumber)}if(DOMUtils.IsDisplay(viewport.ViewportFrameElement)&&(viewport.Context.ImageEntity===null||force)){viewport.ViewportFrameElement.setAttribute("data-seriesGuid",seriesGuid);viewport.ViewportFrameElement.setAttribute("data-studyGuid",studyGuid);viewport.Context.IsPseudoSeries=seriesGuid.toLowerCase()===DicomPlugin_1.KeyImageManager.PseudoSeriesGuid.toLowerCase()||seriesGuid.toLowerCase()===DicomPlugin_1.StitchManager.PseudoSeriesGuid.toLowerCase();if(viewport.Context.IsPseudoSeries){viewport.SetAnnotationsInViewport=false;viewport.Context.KeyImageEntity=item.KeyImages.StructureData[imageGuid];if(viewport.Context.KeyImageEntity.Images!==undefined&&viewport.Context.KeyImageEntity.Images.length===1){var seriesGuidTemp=this.GetSeriesGuidFromImageGuid(studyGuid,viewport.Context.KeyImageEntity.Images[0].ImageGUID);viewport.Context.ImageEntity=this.Controller.StudyViewerModel.Documents.StructureData[studyGuid].Study.Series.StructureData[seriesGuidTemp].Images.StructureData[viewport.Context.KeyImageEntity.Images[0].ImageGUID];if(viewport.Context.KeyImageEntity.Annotations!==null&&viewport.Context.KeyImageEntity.Annotations!==undefined){var annotS=JSON.parse(viewport.Context.KeyImageEntity.Annotations);var fullAnnotations=new Array;for(var jn=0;jn<annotS.length;jn++){var annotI=JSON.parse(annotS[jn]);var annotationSample=eval("new "+annotI.Namespace+"."+annotI.Name+"()");annotationSample.Deserialize(annotS[jn]);fullAnnotations.push(annotationSample)}viewport.AnnotationManager.PropagateAnnotations(fullAnnotations,viewport.Context,viewport)}}else{viewport.Context.ImageEntity=new ImagingStudyView.ImageEntity;viewport.Context.Annotations=new Array}viewport.Context.TotalImages=item.KeyImages.IndexData.length}else{if(this.IsSRDicom(item.Images.StructureData[imageGuid])){viewport=this.ForceTransformDicomViewport(true,viewport)}viewport.Context.ImageEntity=item.Images.StructureData[imageGuid];viewport.Context.TotalImages=item.Images.IndexData.length;if(!this.IsSRDicom(viewport.Context.ImageEntity)){viewport.ImageQualityManager.SetTagQuality();viewport.Indicator3dManager.SetButtonTag3d()}else{this.ControlForSrView(viewport)}viewport.SetAnnotationsInViewport=false;viewport.Context.Annotations=new Array}this.initializeViewport(viewport,studyGuid,seriesGuid,seriesIndex,imageIndex);if(!this.IsSRDicom(viewport.Context.ImageEntity)){viewport.Context.Renderer.Render();viewport.Context.OverlayRenderer.Render()}this.ValidateViewportVoid();if(this.IsLinkToolActive&&this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack)viewport.LinkManager.ViewportLayoutGrid.Element.style.display="block";else viewport.LinkManager.ViewportLayoutGrid.Element.style.display="none";if(this.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile)this.ScrollIndexTileMode++;break}}}}}GetSeriesGuidFromImageGuid(e,t){var n=this.Controller.StudyViewerModel.Documents.StructureData[e];if(n!==undefined){for(var o=0;o<n.Study.Series.IndexData.length;o++){var s=n.Study.Series.IndexData[o];var l=n.Study.Series.StructureData[s].Images;if(l){for(var u=0;u<l.IndexData.length;u++){var c=l.IndexData[u];if(c===t){return s}}}}}return null}KeyImageCreateRemoveStitch(e){if(e!==null){var t=e.Context.KeyImageEntity;if(e.Context.IsPseudoSeries){try{WebClient.Loader.Show();DicomPlugin_1.StitchManager.DeleteStitch(e.Context.KeyImageEntity,(t=>{WebClient.Loader.Hide();if(t===200||t===204){DicomPlugin_1.StitchManager.PseudoSerieStudy.DeleteKeyImageFromPseudoSeries(e.Context.KeyImageEntity.KeyImageID);WebClient.Toaster.ShowToast("The Stitch KeyImage was removed.",WebClient.Colors.BelizeHole,3)}else WebClient.Toaster.ShowToast("The stitch keyImage was not deleted due to an error in the server.",WebClient.Colors.BelizeHole,3)}))}catch(e){WebClient.Loader.Hide();WebClient.Toaster.ShowToast("stitch KeyImage error: "+e,WebClient.Colors.Orange,3)}}else{t.Thumbnail=e.Context.ImagesStitch[0].ImageEntity.Thumbnail;try{WebClient.Loader.Show();DicomPlugin_1.StitchManager.SaveStitch(e,t,((n,o)=>{if(n===201){var s=o.getResponseHeader("Location");var l=s.split("Basic/")[1].split("/")[0];t.Id=l;DicomPlugin_1.StitchManager.PseudoSerieStudy.AddKeyImageToPseudoSeries(e.Context.StudyGuid,t);WebClient.Toaster.ShowToast("Stitch KeyImage was added.",WebClient.Colors.BelizeHole,3)}else WebClient.Toaster.ShowToast("The stitch KeyImage could not be added.",WebClient.Colors.BelizeHole,3);WebClient.Loader.Hide()}))}catch(e){WebClient.Toaster.ShowToast("KeyImage error: "+e,WebClient.Colors.Orange,3);WebClient.Loader.Hide()}}}}SelectAnyTool(){if(this.Controller===undefined)return;var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(e===null||!(e instanceof DicomPlugin_1.DicomViewport))return;if(e!==null){if(e.Context.CurrentAnnotation!==null&&e.Context.CurrentAnnotation!==undefined){if(!this.Controller.ToolSelect.match("Annotation")){e.Context.CurrentAnnotation=null}}e.AnnotationManager.DrawAnnotations()}if(DicomPlugin_1.CineManager.IsCineActive){DicomPlugin_1.CineManager.CloseUICine()}}HoldSaveSpecialAnnotationsOnCourse(){}GetAnnotSelectCount(){var e=0;var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null&&t.Context.Annotations){for(var n=0;n<t.Context.Annotations.length;n++){if(t.Context.Annotations[n].Selected){e++}}return e}else{return 0}}GetMarkers(){return null}GetPointsGrips(e,t){var n=null;if(e===this.PluginName){var o=t.GetTemplate();if(o!==undefined){var s=o.Groups;var l=0;var u=Object.keys(s);u.forEach((e=>{if(s[e].IsDraggable)l+=s[e].MaxPoints}));if(l!==0)n=l}}return n}GetRememberToolsPerName(){var e=[];e.push("DicomWL-DicomWindowLevel","DicomZoom","DicomPan","DicomRotate");return e}GetContextMenuOptions(){var e=new Array;var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null&&t!==undefined){var n=new ImagingStudyView.ContextMenuOption("DicomInvertWl",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","invertSelectionTool"),"invertSelectionTool");n.Action=e=>{t.SetInvertImage();this.Controller.SelectDefaultTool()};var o=new ImagingStudyView.ContextMenuOption("DicomFlipHorizontalTool",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","flipHorizontalTool"),"flipHorizontalTool");o.Action=e=>{t.Context.ScaleX=-t.Context.ScaleX;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render();this.Controller.SelectDefaultTool()};var s=new ImagingStudyView.ContextMenuOption("DicomFlipVerticalTool",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","flipVerticalTool"),"flipVerticalTool");s.Action=e=>{t.Context.ScaleY=-t.Context.ScaleY;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render();this.Controller.SelectDefaultTool()};var l=new ImagingStudyView.ContextMenuOption("DicomWL",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","freeWl"),"freeWl");l.Action=e=>{this.Controller.SelectTool("DicomWindowLevel","freeWl");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","imageRender","optionInMenuPressed")};l.Default=true;var u=new ImagingStudyView.ContextMenuOption("EvueResetWl",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","evueResetWl"),"evueResetWl");u.Action=e=>{t.SetWindowLevel(undefined,undefined,ResetWlMode.EVue);this.Controller.SelectDefaultTool()};u.Default=true;var c=new ImagingStudyView.ContextMenuOption("DicomResetWl",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","dicomResetWl"),"dicomResetWl");c.Action=e=>{t.SetWindowLevel(undefined,undefined,ResetWlMode.Dicom);this.Controller.SelectDefaultTool()};c.Default=true;var d=new ImagingStudyView.ContextMenuOption("DicomZoom",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","zoom"),"zoom");d.Action=e=>{this.Controller.SelectTool("DicomZoom","zoom");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ZoomAndRotate","optionInMenuPressed")};d.Default=true;var m=new ImagingStudyView.ContextMenuOption("DicomPan",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","panTool"),"panTool");m.Action=e=>{this.Controller.SelectTool("DicomPan","panTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ZoomAndRotate","optionInMenuPressed")};m.Default=true;var S=new ImagingStudyView.ContextMenuOption("DicomResetTransformations",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","resetTransformations"),"resetTransformations");S.Action=e=>{if(t!==null)t.ResetTransformations();this.Controller.SelectDefaultTool()};S.Default=true;var C=new ImagingStudyView.ContextMenuOption("DicomRotate",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","freeRotation"),"freeRotation");C.Action=e=>{this.Controller.SelectTool("DicomRotate","freeRotation");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ZoomAndRotate","optionInMenuPressed")};C.Default=true;var p=new ImagingStudyView.ContextMenuOption("DicomZoomToFit",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","zoomToFit"),"zoomToFit");p.Action=e=>{t.ZoomToFit(true);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render();this.Controller.SelectDefaultTool()};var A=new ImagingStudyView.ContextMenuOption("DicomZoomOneToOne",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","zoomOneToOne"),"zoomOneToOne");A.Action=e=>{t.Zoom1x1();t.Context.Renderer.Render();t.Context.OverlayRenderer.Render();this.Controller.SelectDefaultTool()};var f=new ImagingStudyView.ContextMenuOption("DicomHumanBoneTool",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","humanBoneTool"),"humanBoneTool");f.Action=e=>{t.SetWindowLevelForHumanBone();this.Controller.SelectDefaultTool()};var I=new ImagingStudyView.ContextMenuOption("DicomProperties",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","dicomProperties"),"dicomProperties");I.Action=e=>{var n=t.Context.ImageEntity;this.createDicomTagsPopup(n)};I.Default=true;var D=new ImagingStudyView.ContextMenuOption("StitchTool",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","StitchTool"),"StitchTool");D.Action=e=>{var t=this.Controller.View.Platform.Toolbar.GetButton("StitchTool");this.ProcessStitchToolEvent(t.Element)};var P=new ImagingStudyView.ContextMenuOption("printImage",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","printImage"),"printImage");P.Action=e=>{this.PrintViewportContent()};var v=new ImagingStudyView.ContextMenuOption("magnifierTool",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("DicomPluginLanguage","magnifierTool"),"magnifierTool");v.Action=e=>{this.Controller.SelectTool("DicomMagnifier","magnifierTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ZoomAndRotate","optionInMenuPressed")};if(WebClient.Utils.CheckNotAllowTag(["patient"])){e.push(n,o,s,m,S,C,l,u,c,d,p,A,D,I,v)}else{e.push(n,o,s,m,S,C,d,p,A,D,I)}}return e}GetButtonsToMenu(e,t){var n=[];n.push(" ");for(var o=0;o<e.length;o++){switch(e[o]){case"Cine":n.push(["cineTool",DicomPlugin_1.ResourceBag.Icons8Play32Png,e=>{var t=e.target;if(!DOMUtils.HasClass(t,"toolbarButton"))t=t.parentElement;DicomPlugin_1.CineManager.OpenUICine(this)}]);break;case"Link":n.push(["linkTool",DicomPlugin_1.ResourceBag.Icons8Link32Png,e=>{var t=e.target;var n;if(!DOMUtils.HasClass(t,"toolbarButton"))t=t.parentElement;if(!DOMUtils.HasClass(t,"selected")){this.Controller.SelectDefaultTool();n=true}else{n=false}this.Controller.ToogleLinkTool(n)}]);break;case"3DCursor":n.push(["triangulationTool",DicomPlugin_1.ResourceBag.Icons8CoordinateSystem32Png,e=>{if(DicomPlugin_1.CineManager.IsCineActive)return;var t=e.target;if(!DOMUtils.HasClass(t,"toolbarButton"))t=t.parentElement;if(!DOMUtils.HasClass(t,"selected")){DOMUtils.AddClass(t,"selected");this.Controller.SelectTool("DicomTriangulation","triangulationTool");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.1","thumbnails","optionInMenuPressed")}else{DOMUtils.RemoveClass(t,"selected");this.Controller.SelectDefaultTool()}this.ShowTriangulations=!this.ShowTriangulations}]);break}}return{dictionary:"DicomPluginLanguage",buttons:n}}GetSettingsPaneNames(){return["DICOM"]}GetSettings(e){}UpdateSettings(e,t){return true}CreateSettingsPane(e,t){switch(e){case"DICOM":if(!this.Controller.View.Platform.TemporalSettingsTabs.some((e=>e.Id==="dicomRouting"))){if(this.Controller.View.Platform.ApplicationTags.hasOwnProperty("admin")&&sessionStorage["technology"]==="Efferent"){var n=new WebClient.Tab("dicomRouting","Dicom routings".toUpperCase());n.ActionTab=e=>{var t=new DicomPlugin_1.DicomSettingsController(this);t.CreateSettingsDicomRules(e)};this.Controller.View.Platform.TemporalSettingsTabs.push(n)}}break}}ClearViewports(){var e=this.Controller.ViewportPane.ViewportsArray;for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof DicomPlugin_1.DicomViewport){n.Clear();var o=n.ViewportFrameElement.getElementsByClassName("containerTag");if(o.length===1){WebClient.DOMUtils.RemoveItem(o[0])}}}}FillDicomTagsData(e,t,n){var o={};o["0010_0020"]=[];switch(true){case Array.isArray(t)&&t.length>0&&t.every((e=>typeof e==="object")):let o={id:WebClient.Utils.GetGuid(),tag:e,value:"",children:[]};n.push(o);t.forEach((e=>{this.FillDicomTagsData(e["tag"],e["value"],o["children"])}));break;case Array.isArray(t)&&t.length>0&&t.every((e=>typeof e!=="object")):t=t.join("/");break;case Array.isArray(t)&&t.length===0:t="";break}if(typeof t!=="object"){var s=e;var l=e===null||e===void 0?void 0:e.match(/[0-9]{4}_[0-9]{4}_/);if(l){if(l[0].substr(0,l[0].length-1)==="0010_0020"){o["0010_0020"].push(t);s=`(0010,1002);(0010.0020)`;t=`${t} PID # ${o["0010_0020"].length+1}`}}var u=e===null||e===void 0?void 0:e.replace("_","");var c=DicomPlugin_1.ResourceBag.DicomDictionaryJson[u];n.push({id:WebClient.Utils.GetGuid(),tag:s!==null&&s!==void 0?s:"---",value:t!==null&&t!==void 0?t:"",description:c!==null&&c!==void 0?c:""})}}GetHTmlTableTags(e,t){var n={};n.idField="DicomTagsTable";n.headers=t;n.actionButtons=null;n.idField="id";n.data=[];for(var o in e["dicomTags"]){if(e["dicomTags"].hasOwnProperty(o)){var s=/([0-9A-Z]{4}_[0-9A-Z]{4})/g;var l=s.test(o);if(l&&o!=="7FE0_0010"){var u=e["dicomTags"][o];this.FillDicomTagsData(o,u,n.data)}}}var c=new WebClient.WLTreeTable(n);var d=c.render();return d}deleteAnnotations(e=true){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t!==null){if(t.Context.IsPseudoSeries)return;if(e){t.SelectedAllAnnotations();for(var n=0;n<this.Controller.View.Plugins.length;n++){this.Controller.View.Plugins[n].DeleteSelectedAnnotations(t)}this.Controller.SelectDefaultTool()}else{if(t.GetSelectedAnnotationsCount()>0){for(var n=0;n<this.Controller.View.Plugins.length;n++){this.Controller.View.Plugins[n].DeleteSelectedAnnotations(t)}this.Controller.SelectDefaultTool()}else{WebClient.Toaster.ShowToast("Select one or more annotations to delete.",WebClient.Colors.BelizeHole,3)}}}}createDicomTagsPopup(e){var t=document.createElement("h2");t.appendChild(document.createTextNode("Dicom Tags"));DOMUtils.AddClass(t,"modalbox_title");var n=document.createElement("div");DOMUtils.AddClass(n,"content");let o=[{name:"Tag",field:"tag",width:"10%"},{name:"Value",field:"value",width:"50%",withToolTip:true,maxChars:90},{name:"Description",field:"description",width:"40%"}];let s=this.GetHTmlTableTags(e,o);n.appendChild(s);DOMUtils.ScrollElement(n);DOMUtils.CreateModal({content:n,title:t,close:true})}organizeLinkedViewports(){var e=this.Controller.ViewportPane.ViewportsArray;for(var t=0;t<e.length;t++){var n=e[t].LinkManager.LinkGroup;var o=new Array;if(n.length>0){o.push(e[t]);for(var s=0;s<n.length;s++){for(var l=0;l<e.length;l++){var u=e[l];if(n[s]!==u){if(u.Context.StudyGuid===n[s].Context.StudyGuid&&u.Context.SeriesGuid===n[s].Context.SeriesGuid){o.push(u);break}}}}e[t].LinkManager.LinkGroup=o}}}getFactorPrint(e,t,n,o,s){let l=1;try{let t=e["dicomTags"]["0028_0011"];let n=e["dicomTags"]["0028_0010"];let u=Math.min(o.Width,s.Width);l=.23*(t/(u/(72/25.4)))}catch(e){WebClient.Utils.DebugConsoleLog(e)}return l}resizeReportViewports(){let e=document.querySelectorAll(".wlTableContainer");if(e){e.forEach((e=>{let t=e.parentElement.parentElement.parentElement.id;let n=this.Controller.ViewportPane.ViewportsArray.filter((e=>e.Id===t))[0];if(n){e.style.width=n.GetWidth()+"px";e.style.height=n.GetHeight()+"px";let t=n.ContentElement.querySelector(".containerTag");if(t)WebClient.DOMUtils.RemoveItem(t)}}))}}initializeViewport(e,t,n,o,s){e.Context.StudyGuid=t;e.Context.SeriesGuid=n;e.Context.SeriesIndex=o;e.Context.ImageIndex=s;var l=this.Controller.StudyViewerModel.Documents.StructureData[t];e.Context.TotalSeriesInStudy=l.Study.Series.IndexData.length||l.Study.SeriesCount;e.Context.Level=undefined;e.Context.Window=undefined;e.Context.LevelHigh=undefined;e.Context.WindowHigh=undefined;e.Context.LevelLow=undefined;e.Context.WindowLow=undefined;e.Context.LevelHighDelta=0;e.Context.LevelLowDelta=0;e.Context.WindowHighDelta=0;e.Context.WindowLowDelta=0;e.Context.CanvasImage=null;e.Context.Coord3D=null;e.ProcessWLStart=false;if(!e.Context.IsPseudoSeries)e.Context.Annotations=new Array;this.Controller.ThumbnailPane.UpdateAllThumnailsPane();if(e.LinkManager){e.LinkManager.ViewportLayoutGrid.HorizontalViewports=this.Controller.ViewportPane.HorizontalViewports;e.LinkManager.ViewportLayoutGrid.VerticalViewports=this.Controller.ViewportPane.VerticalViewports;e.LinkManager.UpdateLayoutGrid(e)}if(e.Context.ImageEntity){if(e.Context.ImageEntity["isZoomed"]&&e.Context.ImageEntity["isZoomed"]===false||!e.Context.ImageEntity["isZoomed"]){e.InitCanvasData();e.ZoomToFit()}}if(!this.IsSRDicom(e.Context.ImageEntity)){e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();e.ImageQualityManager.SetTagQuality();e.Indicator3dManager.SetButtonTag3d()}}preProcessTapEvent(e){this.MagnifierElement.style.visibility="hidden";this.MagnifierElement.style.display="";var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);this.Controller.View.ShowToolbarButtonsBySupportViewport(this.Controller.View.Platform.Toolbar,t);if(DicomPlugin_1.CineManager.IsCineActive&&DicomPlugin_1.CineManager.SelectedCineViewport!==e){DicomPlugin_1.CineManager.CineImageNumber=0;DicomPlugin_1.CineManager.CineSubImageNumber=0;DicomPlugin_1.CineManager.SelectedCineViewport.EnableActionsOnViewport=true;if(e&&e instanceof DicomPlugin_1.DicomViewport&&e.Context.ImageEntity!==null){this.Controller.SetSelectViewport(e,this.Controller.ViewportPane);DicomPlugin_1.CineManager.SelectedCineViewport=e;DicomPlugin_1.CineManager.PauseCine();DicomPlugin_1.CineManager.PlayCine()}else{DicomPlugin_1.CineManager.CloseUICine()}}}findViewport(e,t){var n=this.Controller.ViewportPane.ViewportsArray;for(var o=0;o<n.length;o++){var s=n[o];if(s.Context.StudyGuid===e&&s.Context.SeriesGuid===t&&s.Context.ImageEntity!==null){return s}}return null}findSeriesInViewports(e,t){var n=this.Controller.ViewportPane.ViewportsArray;for(var o=0;o<n.length;o++){var s=n[o];if(s.Context.StudyGuid===e&&s.Context.SeriesGuid===t){return true}}return false}findImageInViewports(e,t,n,o=false){var s=this.Controller.ViewportPane.ViewportsArray;for(var l=0;l<s.length;l++){var u=s[l];if(u instanceof DicomPlugin_1.DicomViewport){if(!o){if(u.Context.StudyGuid===e&&u.Context.SeriesGuid===t&&u.Context.ImageEntity.ImageGUID===n)return u}else{if(u.Context.StudyGuid===e&&u.Context.SeriesGuid===t&&u.Context.KeyImageEntity.KeyImageID===n)return u}}}return null}MPRExecute(e){let t=Efferent.Frontend.WebClient.PlatformContext.PlatformUri;let n=this.Controller.RegionId.split("/")[0];let o=sessionStorage["organizationName"];let s=sessionStorage["organizationId"];let l=sessionStorage["userEmail"];let u=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(u){let c=u.Context.StudyGuid;let d=this.Controller.ImagingStudyFhirEntities[c]["id"];let m=u.Context.SeriesGuid;let S=e===EMPRType.Coronal?"AP":"LR";let C=this.Controller.ImagingStudyFhirEntities[c]["modality"][0]["code"];let p=new DicomPlugin_1.MPRValidator(u,this,e);let A=p.ValidatorSerie();if(A===true){let e=`${t}/mpr/mpr-image?imagingStudy=${d}&organizationName=${o}&region=${n}&series=${m}&study=${c}&axisRotation=${S}&userName=${l}&organizationId=${s}`;let C={Accept:u.Context.ImageEntity.TransferSyntax==="1.2.840.10008.1.2.4.50"?"application/dicom;transfer-syntax=1.2.840.10008.1.2.4.50":"application/dicom"};WebClient.Toolbar.HideAllMenus();WebClient.Toaster.ShowToast("Generating MPR...",WebClient.Colors.Turquoise,3.5);this.callMPR=WebClient.HttpUtils.AjaxCall(e+"&refreshUI=true","POST",C,null,((e,t)=>{if(e.status!==202){WebClient.Toaster.ShowToast("Error generating MPR serie.",WebClient.Colors.Orange,3.5)}}),(e=>{WebClient.Toaster.ShowToast("Error showing MPR serie.",WebClient.Colors.Orange,3.5)}))}else{switch(A){case DicomPlugin_1.EErrorMPR.Modality:WebClient.Toaster.ShowToast("This feature is only available on CT and MR.",WebClient.Colors.Orange,3.5);break;case DicomPlugin_1.EErrorMPR.AllImageNotDownloaded:WebClient.Toaster.ShowToast("The images of the series are not yet available.",WebClient.Colors.Orange,3.5);break;case DicomPlugin_1.EErrorMPR.ImageType:WebClient.Toaster.ShowToast("Only original images are allowed.",WebClient.Colors.Orange,3.5);break;case DicomPlugin_1.EErrorMPR.Orientation:WebClient.Toaster.ShowToast("Unsupported orientation, this feature is currently available on axial view.",WebClient.Colors.Orange,3.5);break;default:WebClient.Toaster.ShowToast("MPR not available.",WebClient.Colors.Orange,3.5);break}}}else{WebClient.Toaster.ShowToast("Please select a viewport.",WebClient.Colors.Alizarin,6)}}showPrintDialog(e,t,n,o){let s="";let l=true;const u=n.naturalWidth;const c=n.naturalHeight;const d=u>c?"landscape":"portrait";if(e)s=`Patient ${e["0010_0010"]}`;let m=`<!DOCTYPE html>\n                <html>\n                    <head>\n                        <title>${s}</title>\n                        <meta charset="utf-8" />\n                        <meta name="apple-mobile-web-app-capable" content="yes">\n                        <meta name="apple-mobile-web-app-status-bar-style" content="black">\n                        <meta name="apple-mobile-web-app-title" content="Viewer">\n                        <meta name="msapplication-tap-highlight" content="no">\n                        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">\n\n                        <style>\n                            @media print {\n                                html,body {\n                                    height:100%;\n                                    width:100%;\n                                    margin:0;\n                                    padding:0;\n                                }\n                                @page {\n                                    size: ${d};\n                                    max-height:100%;\n                                    max-width:100%\n                                }\n                                img {\n                                    width: ${d==="landscape"?"100%":"auto"};\n                                    height: ${d==="landscape"?"auto":"100%"};\n                                    display: block;\n                                }\n                            }\n                        </style>\n\n                    </head>\n                    <body>\n                        <img src='${t}' />\n                    </body>\n                </html>`;const S=window.open("","","width="+screen.availWidth+",height="+screen.availHeight);S.document.open();S.document.write(m);S.document.addEventListener("load",(()=>{if(l){WebClient.Toolbar.HideAllMenus();S.focus();S.print();const e=setTimeout((()=>{S.document.close();S.close();o();clearTimeout(e)}),500)}l=false}),true)}}DicomPlugin.AcumCtrlUseForAnnotations={};DicomPlugin_1.DicomPlugin=DicomPlugin})(DicomPlugin=Products.DicomPlugin||(Products.DicomPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(t){var n;(function(t){var n=Efferent.Frontend.WebClient;var o=Efferent.Frontend.SettingsClient;class DicomSettingsController{constructor(e){this.plugin=e}CreateSettingDicom(t){this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataA={};this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB={};this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataA["chkAutomaticPopulation"]=this.plugin.Controller.View.Platform.GetSetting("chkAutomaticViewportPopulation")||true;this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataA["chkActionAutomaticViewportPopulation"]=(e,t)=>{var n=e.target.checked;this.plugin.Controller.View.Platform.SetSetting(40,"chkAutomaticViewportPopulation",n.toString())};this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataA["optionsFirstSeriesPopul"]=["1","2","3","4"];this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataA["checkedFirstSeriesPopul"]=this.plugin.Controller.View.Platform.GetSetting("buttonBarFirstSeriesPopulate")||"1";this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataA["actionOnchangeFirstSeriesPopul"]=e=>{this.plugin.Controller.View.Platform.SetSetting(40,"buttonBarFirstSeriesPopulate",e.target.bbValue)};this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB["optionsWl"]=["Increase to the left","Increase to the right"];this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB["valuesWl"]=["increasetoleft","increasetoright"];this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB["valueWl"]=this.plugin.Controller.View.Platform.GetSetting("selectWlWindow")||"increasetoright";this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB["actionWlWindow"]=e=>{this.plugin.Controller.View.Platform.SetSetting(40,"selectWlWindow",e.target.value)};this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB["optionsWLevel"]=["Increase upwards","Increase downwards"];this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB["valuesWLevel"]=["increaseup","increasedown"];this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB["valueWLevel"]=this.plugin.Controller.View.Platform.GetSetting("selectWlLevel")||"increasedown";this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB["actionWlLevel"]=e=>{this.plugin.Controller.View.Platform.SetSetting(40,"selectWlLevel",e.target.value)};var o=[this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataA,this.plugin.Controller.View.Platform.SettingsSubView.Pane.DataB];var s=(new e.Products.DicomPlugin.VueConfigDicomForm).Create(t,o);s.forEach((e=>{this.plugin.Controller.View.Platform.SettingsSubView.Pane.SectionsViewer.push(e)}));if(!n.Utils.CheckNotAllowTag("patient")){s[1].style.display="none"}}CreateSettingsDicomRules(e){var t=this.unpackRoutingRulesObject();var s=document.createElement("div");s.classList.add("section");var l=document.createElement("H2");l.innerText="Routing rules";s.appendChild(l);var u=document.createElement("table");u.style.padding="5px 10px";u.style.marginBottom="15px";u.style.textAlign="left";s.appendChild(u);var c=document.createElement("div");this.fillRoutingRulesTable(t,u);s.appendChild(c);var d=document.createElement("div");d.style.marginBottom="15px";var m=document.createElement("div");m.innerText="Physician name:";m.style.width="130px";m.style.display="inline-block";var S=document.createElement("input");S.type="text";S.style.width="250px";S.style.fontSize="15px";S.placeholder="Name";d.appendChild(m);d.appendChild(S);var C=document.createElement("div");C.innerText="Share with:";C.style.width="130px";C.style.display="inline-block";var p=document.createElement("input");p.type="text";p.style.width="250px";p.style.fontSize="15px";p.placeholder="Email";var A=document.createElement("div");A.style.marginBottom="15px";A.appendChild(C);A.appendChild(p);var f=document.createElement("button");f.classList.add("green");f.innerText="Add";f.addEventListener("click",(()=>{n.Loader.Show();var e=true;var s=t[S.value];const l=p.value.split(",");const c=l[0].replace(" ","");const d=["draft","proposed","active","rejected","inactive","entered-in-error"];if(S.value!==""&&n.Utils.ValidateEmail(c)&&(l.length===1||l.length===2&&d.indexOf(l[1].replace(" ",""))>-1)){if(!t.hasOwnProperty(S.value)){t[S.value]=p.value.replace(" ","")}else{if(s.indexOf(p.value)===-1){var m=s;t[S.value]=m+"|"+p.value.replace(" ","")}else{n.Toaster.ShowToast("Rule already exists.",n.Colors.Orange,3);n.Loader.HideAll();e=false}}}else{n.Toaster.ShowToast("Please fill all inputs with valid data.",n.Colors.Orange,3);n.Loader.HideAll();e=false}if(e){var C=window.btoa(JSON.stringify(t));o.SettingsController.SetSetting(Efferent.Frontend.SettingsClient.SettingsController.SETTING_VALUES.ORGANIZATION,"SharingRules",C,(()=>{}),true);o.SettingsController.SetSetting(Efferent.Frontend.SettingsClient.SettingsController.SETTING_VALUES.ORGANIZATION,"SharingRules",C,(()=>{this.fillRoutingRulesTable(t,u);n.Toaster.ShowToast("Routing rule added.",n.Colors.Emerald,3);n.Loader.HideAll()}),true,"SmartLinkOps")}}));c.appendChild(d);c.appendChild(A);c.appendChild(f);e.appendChild(s)}fillRoutingRulesTable(e,t){t.innerHTML="";var o=document.createElement("tr");t.appendChild(o);var s=document.createElement("th");s.innerText="Physician name";s.style.paddingRight="10px";var l=document.createElement("th");l.innerText="Share with";l.style.paddingRight="10px";var u=document.createElement("th");u.style.fontSize="13px";o.appendChild(s);o.appendChild(l);o.appendChild(u);for(var c in e){if(e.hasOwnProperty(c)){var d=e[c].split("|");for(var m=0;m<d.length;m++){var S=document.createElement("tr");var C=document.createElement("td");C.innerText=c;C.style.paddingRight="10px";var p=document.createElement("td");p.innerText=d[m];p.style.paddingRight="10px";var A=document.createElement("td");A.style.backgroundColor=n.Colors.Emerald;A.style.color=n.Colors.Clouds;A.innerText="Delete";A.style.borderRadius="3px";A.style.fontSize="13px";A.style.textAlign="center";A.style.cursor="pointer";A.style.width="75px";S.appendChild(C);S.appendChild(p);S.appendChild(A);t.appendChild(S);this.setDeleteRoutingRule(e,t,c,d[m],A)}}}}unpackRoutingRulesObject(){var e=o.SettingsController.GetSetting("SharingRules");if(e===undefined)return{};try{var t=e.value;var n=JSON.parse(t);return n}catch(e){return{}}}setDeleteRoutingRule(e,t,s,l,u){u.addEventListener("click",(()=>{n.Loader.Show();if(e[s].indexOf("|")===-1){delete e[s]}else{var u=e[s].replace(l+"|","");var c=u.replace("|"+l,"");e[s]=c}var d=window.btoa(JSON.stringify(e));o.SettingsController.SetSetting(Efferent.Frontend.SettingsClient.SettingsController.SETTING_VALUES.ORGANIZATION,"SharingRules",d,(()=>{}),true);o.SettingsController.SetSetting(Efferent.Frontend.SettingsClient.SettingsController.SETTING_VALUES.ORGANIZATION,"SharingRules",d,(()=>{this.fillRoutingRulesTable(e,t);n.Toaster.ShowToast("Routing rule removed.",n.Colors.Orange,3);n.Loader.HideAll()}),true,"SmartLinkOps")}))}}t.DicomSettingsController=DicomSettingsController})(n=t.DicomPlugin||(t.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var DicomPlugin;(function(DicomPlugin){var WebClient=Efferent.Frontend.WebClient;var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;var ImagingStudyView=Efferent.ClientViews.ImagingStudyView;class DicomViewport extends ImagingStudyView.Viewport{constructor(e,t,n,o,s,l){super(e,t,n,o,s);this.ProcessWLStart=false;this.Plugin=l;this.PluginNameAction="DicomViewport";this.Context=new DicomPlugin.DicomViewportContext(this);this.Context.ImageEntity=null;this.TransformsPerImage={}}Create(e,t,n,o,s=false){this.ViewportElement=s===true?n:document.createElement("canvas");if(n){WebClient.Utils.CopyProperties(n,this.ViewportElement);WebClient.DOMUtils.RemoveItem(n)}if(t!==undefined){this.ViewportElement.setAttribute("width",parseFloat(t.style.width));this.ViewportElement.setAttribute("height",parseFloat(t.style.height))}this.ContentElement=o;super.Create(e,t);this.ContentElement.appendChild(this.ViewportElement);if(this.ViewerPage){this.LinkManager=new DicomPlugin.ViewportLinkManager(this,this.ContentElement,this.ViewerPage,this.ViewerPage.ViewportPane.HorizontalViewports,this.ViewerPage.ViewportPane.VerticalViewports);this.ImageQualityManager=new DicomPlugin.ImageQualityManager(this);this.Indicator3dManager=new DicomPlugin.Indicator3dManager(this);this.Plugin.Controller.ViewportPane.ViewportsCollection[e].LoadedViewports[this.constructor.name]=this}}OffsetWindowLevel(e,t){try{if(this.Context.ImageEntity===null)return;this.ProcessWLStart=true;this.Context.CanvasImage=null;var n=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0002"]);var o=this.Context.ImageEntity.TransferSyntax;if(o==="1.2.840.10008.1.2.4.50"&&n===3){if(!(Math.abs(e)<10&&Math.abs(t)<10)){this.Context.Level=this.initLevelProcess+t*.1;this.Context.Window=Math.max(0,this.initWindowProcess+e*.03)}else{this.initLevelProcess=this.Context.Level=this.initLevelProcess+t;this.initWindowProcess=this.Context.Window=Math.max(0,this.initWindowProcess+e);this.initWLInX=this.endWLInX;this.initWLInY=this.endWLInY}}else{if(Math.abs(e)<10&&Math.abs(t)<10){this.initLevelProcess=this.Context.Level=this.initLevelProcess+t;this.initWindowProcess=this.Context.Window=Math.max(0,this.initWindowProcess+e);this.initWLInX=this.endWLInX;this.initWLInY=this.endWLInY}else{var s=Math.max(1,(this.Context.ImageEntity["dicomTags"]["maxValue"]-this.Context.ImageEntity["dicomTags"]["minValue"])/300);this.Context.Level=this.initLevelProcess+t*s;this.Context.Window=Math.max(0,this.initWindowProcess+e*s)}if(o==="1.2.840.10008.1.2.4.50"){this.Context.WindowLowDelta=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1051"])-this.Context.Window;this.Context.LevelLowDelta=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1050"])-this.Context.Level}else{this.Context.WindowHighDelta=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1051"])-this.Context.Window;this.Context.LevelHighDelta=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1050"])-this.Context.Level}}this.Context.Renderer.Render();this.Context.OverlayRenderer.Render()}catch(e){}}MoveOnCanvas(e){var t;var n;if(this.Context.ImageEntity===null||this.Context.ImageEntity["dicomTags"]===undefined)return;if(this.PauseMoveForClickEvent)return;if(this.Context.CurrentAnnotation&&this.ViewerPage.ToolSelect.match("^DicomAnnotation")){if(this.Context.IsPseudoSeries)return;this.UpdateDeltaInMove(e);t=this.PointInElement(this.Context.MouseMoveX,this.Context.MouseMoveY);n=this.Context.CurrentAnnotation;if(n!==undefined&&n!==null&&n.Status!==ImagingStudyView.EAnnotationStatus.Complete){this.Context.EvObject=e;this.AnnotationManager.DrawAnnotations(true);this.Context.EvObject=null;this.Context.CurrentAnnotation.TemporalCurrentGroupName=this.Context.AnnotationController.CurrentGroup?this.Context.AnnotationController.CurrentGroup.GroupName:null;this.Context.CurrentAnnotation.TemporalPoint=new ImagingStudyView.AnnotationPoint(t);this.evaluateOtherAnnotationsType(t)}}else if(this.ViewerPage.ToolSelect==="DicomMagnifier"){this.UpdateDeltaInMove(e);t=this.PointInElement(this.Context.MouseMoveX,this.Context.MouseMoveY);this.Magnifier(e)}else if(this.ViewerPage.ToolSelect==="DicomTriangulation"){this.UpdateDeltaInMove(e);t=this.PointInElement(this.Context.MouseMoveX,this.Context.MouseMoveY);var o=t.X+parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"])/2;var s=t.Y+parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"])/2;this.UpdateCanvasTriangulation(o,s)}try{let n=this.Context.Viewport.Context.ImageEntity["dicomTags"]["0002_0010"];let o=this.Context.Viewport.Context.ImageEntity["dicomTags"]["0008_0060"];if(n==="1.2.840.10008.1.2.1"&&o==="CT"){this.UpdateDeltaInMove(e);t=this.PointInElement(this.Context.MouseMoveX,this.Context.MouseMoveY);var l=this.GetHUValue(t);WebClient.Utils.DebugConsoleLog("HU: "+l)}}catch(e){}}Magnifier(e){var t=this.PointInElement(this.Context.MouseMoveX,this.Context.MouseMoveY);var n=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"]);var o=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"]);var s;if(this.Plugin.Controller.View.Platform.GetSetting("selectGlassSize")===undefined||parseFloat(this.Plugin.Controller.View.Platform.GetSetting("selectGlassSize"))===1)s=1.5;else if(parseFloat(this.Plugin.Controller.View.Platform.GetSetting("selectGlassSize"))===1.5)s=1.75;else if(parseFloat(this.Plugin.Controller.View.Platform.GetSetting("selectGlassSize"))===2)s=3;this.Plugin.MagnifierElement.style.width=100*s+"px";this.Plugin.MagnifierElement.style.height=100*s+"px";this.Plugin.MagnifierElement.style.borderRadius=100*s+"px";this.Plugin.MagnifierCanvasElement.width=100*s;this.Plugin.MagnifierCanvasElement.height=100*s;this.Plugin.MagnifierCanvasElement.style.width=100*s+"px";this.Plugin.MagnifierCanvasElement.style.height=100*s+"px";this.Plugin.MagnifierCanvasElement.style.borderRadius=100*s+"px";var l=100*s;var u=l/2;var c=Math.abs(this.Context.ScaleX);var d=Math.abs(this.Context.ScaleY);if(e.srcEvent!==undefined&&e.pointerType==="mouse"||(e.srcEvent===undefined||e instanceof MouseEvent)){var m=e;this.Plugin.MagnifierElement.style.left=(m.pageX-u).toString()+"px";this.Plugin.MagnifierElement.style.top=(m.pageY-u).toString()+"px"}else if(e.pointerType==="touch"||e.srcEvent.touches){var S=e;this.Plugin.MagnifierElement.style.left=(S.center.x-u).toString()+"px";this.Plugin.MagnifierElement.style.top=(S.center.y-u).toString()+"px"}var C=t.X+n/2;var p=t.Y+o/2;var A=u/c;var f=u/d;var I=Math.round(C-u/2/c);var D=Math.round(p-u/2/d);var P=0;var v=0;if(I<0){A+=I;P=-I*c*2;I=0}if(D<0){f+=D;v=-D*d*2;D=0}if(I+A>=n){A=n-I}if(D+f>=o){f=o-D}var T=A*c*2;var V=f*d*2;var R=this.Plugin.MagnifierCanvasElement;var E=R.getContext("2d");E.fillStyle=this.Context.ImageEntity["shaperningIsActive"]===true?this.Context.InvertImage===true?WebClient.Colors.Silver:WebClient.Colors.FullWhite:WebClient.Colors.FullBlack;E.fillRect(0,0,l,l);this.Plugin.MagnifierElement.style[DOMUtils.GetTransformProperty(this.Plugin.MagnifierElement)]="rotate("+Math.round(this.Context.Rotation)%360+"deg)";if(A>0&&f>0){let e;if(this.Context.ImageEntity["dicomTags"]["invert"])e=!this.Context.InvertImage;else e=this.Context.InvertImage;E.save();E.scale(this.Context.ScaleX>0?1:-1,this.Context.ScaleY>0?1:-1);E.translate(this.Context.ScaleX>0?0:-T,this.Context.ScaleY>0?0:-V);this.Plugin.Processors.forEach((t=>{if(t instanceof DicomPlugin.WindowLevelProcessor){var n=t.ProcessBuffer(this.Context.ImageEntity,null,e,this.Context.Window,this.Context.Level);E.drawImage(n,I,D,A,f,P,v,T,V)}}));E.restore();this.Plugin.MagnifierElement.style.display="block";this.Plugin.MagnifierElement.style.visibility="visible"}}UpdateCanvasTriangulation(e,t){var n=ImagingStudyView.Geometry.Calculate3DPosition(this.Context.ImageEntity,e,t);for(var o=0;o<this.Plugin.Controller.ViewportPane.ViewportsArray.length;o++){var s=this.Plugin.Controller.ViewportPane.ViewportsArray[o];if(s===this){s.Context.Coord3D=null;s.AnnotationManager.DrawAnnotations()}else{s.Context.Coord3D=n;s.AnnotationManager.DrawAnnotations()}}}SwitchImagesInTriangulation(e,t){var n=parseFloat(this.Context.ImageEntity["dicomTags"]["0018_0050"]);for(var o=0;o<this.Plugin.Controller.ViewportPane.ViewportsArray.length;o++){var s=this.Plugin.Controller.ViewportPane.ViewportsArray[o];if(s!==this&&s.Context.ImageEntity!==null&&!s.Context.IsPseudoSeries){var l=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[s.Context.StudyGuid].Study.Series.StructureData[s.Context.SeriesGuid];if(l!==undefined){var u=n;var c=-1;for(var d=0;d<l.Images.IndexData.length;d++){var m=l.Images.IndexData[d];var S=l.Images.StructureData[m];var C=ImagingStudyView.Geometry.Calculate3DPosition(S,e,t);if(S!==null&&S["has3DInformation"]){var p=this.Plugin.Project3DPoint(S,C);var A=ImagingStudyView.Geometry.Calculate3DPosition(S,p.X,p.Y);var f=Math.sqrt(Math.pow(A.X-C.X,2)+Math.pow(A.Y-C.Y,2)+Math.pow(A.Z-C.Z,2));if(f<=u){u=f;c=d;s.SetImageInViewport(c)}else if(f>n&&c>=0){break}}}if(c>=0){s.SetImageInViewport(c)}}}}}SetWindowLevel(e,t,n){if(n===DicomPlugin.ResetWlMode.EVue){this.Context.ImageEntity["dicomTags"]["0028_1050"]=this.Context.ImageEntity["WLEvue"];this.Context.ImageEntity["dicomTags"]["0028_1051"]=this.Context.ImageEntity["WWEvue"];this.Context.PreserveWindowLevel=false;if(this.Context.ImageEntity.TransferSyntax!=="1.2.840.10008.1.2.4.50"){this.Context.WindowHigh=null;this.Context.LevelHigh=null}else{this.Context.WindowLow=null;this.Context.LevelLow=null}}else if(n===DicomPlugin.ResetWlMode.Dicom){if(this.Context.ImageEntity["WLDicomTag"]&&this.Context.ImageEntity["WWDicomTag"]){this.Context.ImageEntity["dicomTags"]["0028_1050"]=this.Context.ImageEntity["WLDicomTag"];this.Context.ImageEntity["dicomTags"]["0028_1051"]=this.Context.ImageEntity["WWDicomTag"];this.Context.PreserveWindowLevel=false;if(this.Context.ImageEntity.TransferSyntax!=="1.2.840.10008.1.2.4.50"){this.Context.WindowHigh=null;this.Context.LevelHigh=null}else{this.Context.WindowLow=null;this.Context.LevelLow=null}}else{WebClient.Toaster.ShowToast("Dicom tags not available.",WebClient.Colors.Alizarin,3);return}}this.ProcessWLStart=true;this.Context.CanvasImage=null;if(e===undefined&&t===undefined)this.Context.InvertImage=false;this.Context.Level=t;this.Context.Window=e;if(e===undefined&&t===undefined){this.ProcessWLStart=false;this.Context.LevelHighDelta=0;this.Context.WindowHighDelta=0;this.Context.LevelLowDelta=0;this.Context.WindowLowDelta=0}this.Context.Renderer.Render();this.Context.OverlayRenderer.Render()}ActiveSharper(e){var t=this.ViewerPage.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid];var n=t.Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID];var o=n["buffer"]["BYTES_PER_ELEMENT"];var postSharpen=()=>{this.Context.CanvasImage=null;this.ProcessWLStart=false;this.Context.Window=undefined;this.Context.Level=undefined;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();var e=this.Plugin.Controller.ViewportPane.ViewportsArray;e.forEach((e=>{if(e!==this){if(e.Context.StudyGuid===this.Context.StudyGuid&&(e.Context.SeriesGuid==="keyPseudoSeries"||e.Context.SeriesGuid===this.Context.SeriesGuid)&&e.Context.ImageEntity.ImageGUID===this.Context.ImageEntity.ImageGUID){e.Context.CanvasImage=null;e.ProcessWLStart=false;e.Context.Window=undefined;e.Context.Level=undefined;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}}))};if(!e){n["buffer"]=n["bufferOriginal"].slice();n["shaperningIsActive"]=false;delete n["wasShaperning"];delete n["bufferSharper"];delete n["bufferOriginal"];postSharpen()}else{if(!n["wasShaperning"]){n["bufferOriginal"]=n["buffer"].slice();var s=new DicomPlugin.Sharpening(n,n.TransferSyntax);WebClient.Loader.Show("Rendering in process...");setTimeout((()=>{n.TransferSyntax==="1.2.840.10008.1.2.4.50"?s.Sharpen(.9):s.Sharpen(.4);n["buffer"]=n["bufferSharper"].slice();n["shaperningIsActive"]=true;postSharpen();WebClient.Loader.Hide()}),0);n["wasShaperning"]=true}else{n["buffer"]=n["bufferSharper"].slice();n["shaperningIsActive"]=true;postSharpen()}}}SetInvertImage(){this.ProcessWLStart=true;this.Context.CanvasImage=null;this.Context.InvertImage=!this.Context.InvertImage;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render()}ResetTransformations(){try{let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID];e["isZoomed"]=false}catch(e){}this.InitCanvasData();this.ZoomToFit();this.Context.Renderer.Render();this.Context.OverlayRenderer.Render()}Pan(e,t){this.Context.OffsetX+=e;this.Context.OffsetY+=t;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render()}ZoomToCenter(e,t,n,o){var s=true;var l=this.getZoomFactor(t,n,o);if(l===-1)return;var u=new WebClient.Point(e.X/this.Context.ScaleX-this.Context.OffsetX/this.Context.ScaleX,e.Y/this.Context.ScaleY-this.Context.OffsetY/this.Context.ScaleY);var c=l;var d=this.Context.ScaleX*c;var m=this.Context.ScaleY*c;this.Context.ScaleX=d;this.Context.ScaleY=m;this.Context.OffsetX=-(u.X-e.X/d)*d;this.Context.OffsetY=-(u.Y-e.Y/m)*m;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();return s}Zoom(e,t,n){var o=this.getZoomFactor(e,t,n);if(o===-1)return;this.Context.ScaleX*=o;this.Context.ScaleY*=o;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render()}Rotate(e,t){if(e<0||t<0)this.Context.Rotation-=2;else if(e>0||t>0)this.Context.Rotation+=2;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render()}ZoomToFit(e=false){if(this.Context.ImageEntity===null||this.Context.ImageEntity["dicomTags"]===undefined)return;if(this.Width===undefined)this.Width=parseFloat(this.ViewportFrameElement.style.width);if(this.Height===undefined)this.Height=parseFloat(this.ViewportFrameElement.style.height);let t;try{t=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID]}catch(e){}var n=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"]);var o=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"]);var s=this.Width;var l=this.Height;if(this.Context.OffsetX===0&&this.Context.OffsetY===0&&this.Context.ScaleX===1&&this.Context.ScaleX===1)e=true;if(t&&t["isZoomed"]===true&&!e)return;var u=n/s;var c=o/l;var d=1;if(u>1||c>1){d/=Math.max(u,c)}else if(u<1||c<1){d/=Math.max(u,c)}this.Context.ScaleX=d*ImagingStudyView.Geometry.Sign(this.Context.ScaleX);this.Context.ScaleY=d*ImagingStudyView.Geometry.Sign(this.Context.ScaleY);this.Context.OffsetX=s/2;this.Context.OffsetY=l/2;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();if(t)t["isZoomed"]=false}RestoreZoomInRescale(e,t){if(this.Context.ImageEntity===null||this.Context.ImageEntity["dicomTags"]===undefined)return;if(this.Plugin["isResize"]===true){this.ViewportElement.removeAttribute("oldWidth");this.ViewportElement.removeAttribute("oldHeight")}if(e===this.Width&&t===this.Height){let n=this.ViewportElement.getAttribute("oldWidth");let o=this.ViewportElement.getAttribute("oldHeight");if(n&&o&&n!=="0"&&o!=="0"){let s=n.split(",");let l=o.split(",");if(s.length>1){let t=+s[s.length-2];if(t!==0)e=t}if(l.length>1){let e=+l[l.length-2];if(e!==0)t=e}}}var n=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"]);var o=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"]);var s=n/e;var l=o/t;var u=1/s;var c=1/l;var d=u*ImagingStudyView.Geometry.Sign(this.Context.ScaleX);var m=c*ImagingStudyView.Geometry.Sign(this.Context.ScaleY);var S=this.Context.ScaleX-d;var C=this.Context.ScaleY-m;var p=n/e;var A=o/t;var f=1/p;var I=1/A;var D=f*ImagingStudyView.Geometry.Sign(this.Context.ScaleX);var P=I*ImagingStudyView.Geometry.Sign(this.Context.ScaleY);var v=D/d;var T=P/m;var V=S*v;var R=C*T;this.Context.ScaleX=D+V;this.Context.ScaleY=this.Context.ScaleX;this.Context.OffsetX-=(e-this.Width)/2;this.Context.OffsetY-=(t-this.Height)/2}Reset(){this.Context.ImageEntity=null;this.Context.ImageIndex=0;this.Context.SeriesIndex=0;this.Context.StudyGuid="";this.Context.SeriesGuid="";this.Context.TotalImages=0;this.Context.TotalSeriesInStudy=0;var e=this.Context;for(var t in e){if(e.hasOwnProperty(t)){var n=e[t];if(typeof n==="number"){e[t]=0}}}}Zoom1x1(){if(this.Context.ImageEntity===null||this.Context.ImageEntity["dicomTags"]===undefined)return;this.Context.ScaleX=ImagingStudyView.Geometry.Sign(this.Context.ScaleX);this.Context.ScaleY=ImagingStudyView.Geometry.Sign(this.Context.ScaleY);if(this.Context.ImageEntity.IsCalibrated()){var e=this.Context.ImageEntity.GetCalibration();var t=(e.Value/e.Diameter).toFixed(5);this.Context.ImageEntity["pixelSpacing"]=[t,t,"mm"]}if(localStorage.getItem("factorCalibrationZoom")!==undefined){var n=parseFloat(this.Context.ImageEntity["pixelSpacing"][0]);var o=parseFloat(this.Context.ImageEntity["pixelSpacing"][1]);var s=0;var l=localStorage.getItem("unitCalibrationZoom");var u=parseFloat(localStorage.getItem("factorCalibrationZoom"));if(!isNaN(u)){if(l===ImagingStudyView.Units.cm.toString()){s=10/(u*.1)}else if(l===ImagingStudyView.Units.inch.toString()){s=10/(.0393701*u)}var c=n*s;c=Math.max(.01,c);var d=o*s;d=Math.max(.01,d);this.Context.ScaleX=c;this.Context.ScaleY=d}else{WebClient.Toaster.ShowToast("Please configure the calibration rule in settings",WebClient.Colors.Alizarin,3)}}this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();try{let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID];e["isZoomed"]=false}catch(e){}}ScrollImages(e,t=0){if(!this.Context.ImageEntity)return;try{var n;var o;var s;var l;var u=this.Context.ImageEntity["bufferArray"];let A=false;let f=false;var c=this.Plugin.Controller.ViewportPane;if(this.Plugin.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack){n=this.Context.ImageIndex;o=this.Context.ImageSubIndex;if(u){e?o-=1:o+=1;if(o<0){n-=1;o=0;if(n<0){n=0}else{s=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.IndexData[n];l=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[s];if(l["bufferArray"]!==undefined&&l["bufferArray"]){o=l["bufferArray"].length-1}}if(t===0)f=true}else if(o>=u.length){n++;if(n>=this.Context.TotalImages){n=this.Context.TotalImages-1;s=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.IndexData[n];l=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[s];o=l["bufferArray"].length-1}else{o=0}if(t===0)A=true}}else{e?n-=1:n+=1;if(n<0){if(+c.VerticalViewports===1&&+c.HorizontalViewports===1){n=0}else{n=this.Context.TotalImages-1}if(t===0)f=true}else if(n>=this.Context.TotalImages){if(+c.VerticalViewports===1&&+c.HorizontalViewports===1){n=this.Context.TotalImages-1}else{n=0}if(t===0)A=true}else{if(e&&!this.Context.IsPseudoSeries){s=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.IndexData[n];l=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[s];if(l["bufferArray"]!==undefined&&l["bufferArray"]){o=l["bufferArray"].length-1}}}}if(c.ViewerPage.LayoutMode===ImagingStudyView.LayoutMode.Stack&&(+c.VerticalViewports===1&&+c.HorizontalViewports===1||this.Context.TotalImages===1)&&(this.Context.ImageEntity["bufferArray"]!==undefined&&this.Context.ImageEntity["bufferArray"]!==null&&this.Context.TotalImages!==1||this.Context.ImageEntity["bufferArray"]===undefined)){let e=this.Plugin.Controller.StudyViewerModel.Documents.IndexData.indexOf(this.Context.StudyGuid);let t=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.IndexData.indexOf(this.Context.SeriesGuid);if(f){if(this.Context.SeriesIndex>0){let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.IndexData[t-1];let o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e];if(o["pseudoserie"]){n=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e].KeyImages.IndexData.length-1;let o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e].KeyImages.IndexData[this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e].KeyImages.IndexData.length-1];this.Plugin.SetSeriesToViewport(this.Context.StudyGuid,e,o,t-1,n,true,this)}else{n=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e].Images.IndexData.length-1;let o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e].Images.IndexData[this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e].Images.IndexData.length-1];this.Plugin.SetSeriesToViewport(this.Context.StudyGuid,e,o,t-1,n,true,this)}this.ViewerPage.SetSelectViewport(this,this.ViewportPane)}else{if(e>0){let t=this.Plugin.Controller.StudyViewerModel.Documents.IndexData[e-1];let o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.IndexData[this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.IndexData.length-1];let s=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o];if(s["pseudoserie"]){n=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o].KeyImages.IndexData.length-1;let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o].KeyImages.IndexData[this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o].KeyImages.IndexData.length-1];this.Plugin.SetSeriesToViewport(t,o,e,this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.IndexData.length-1,n,true);this.ViewerPage.SetSelectViewport(this,this.ViewportPane)}else{n=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o].Images.IndexData.length-1;let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o].Images.IndexData[this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o].Images.IndexData.length-1];this.Plugin.SetSeriesToViewport(t,o,e,this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.IndexData.length-1,n,true);this.ViewerPage.SetSelectViewport(this,this.ViewportPane)}WebClient.Toaster.ShowToast("You are in another study.",WebClient.Colors.PeterRiver,3)}}}else if(A){if(this.Context.SeriesIndex<this.Context.TotalSeriesInStudy-1){let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.IndexData[t+1];let o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e];if(o["pseudoserie"]){n=0;let o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e].KeyImages.IndexData[0];this.Plugin.SetSeriesToViewport(this.Context.StudyGuid,e,o,t+1,n,true,this);this.ViewerPage.SetSelectViewport(this,this.ViewportPane)}else{n=0;let o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[e].Images.IndexData[0];this.Plugin.SetSeriesToViewport(this.Context.StudyGuid,e,o,t+1,n,true,this);this.ViewerPage.SetSelectViewport(this,this.ViewportPane)}}else{if(e<this.Plugin.Controller.StudyViewerModel.Documents.IndexData.length-1){let t=this.Plugin.Controller.StudyViewerModel.Documents.IndexData[e+1];let o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.IndexData[0];let s=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o];if(s["pseudoserie"]){n=0;let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o].KeyImages.IndexData[0];this.Plugin.SetSeriesToViewport(t,o,e,0,n,true,this);this.ViewerPage.SetSelectViewport(this,this.ViewportPane)}else{n=0;let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[o].Images.IndexData[0];this.Plugin.SetSeriesToViewport(t,o,e,0,n,true,this);this.ViewerPage.SetSelectViewport(this,this.ViewportPane)}WebClient.Toaster.ShowToast("You are in another study.",WebClient.Colors.PeterRiver,3)}}}}var d=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid];var m;var S;var C=false;if(d.Images){m=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.IndexData[n];S=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[m]["Processed"];C=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[m]["IsSR"]}else{var p=DicomPlugin.KeyImageManager.GetImageReferenceFromKeyImage(this.Context.StudyGuid,n,this.Context.SeriesGuid);if(p.length>0){p.forEach((e=>{S=e["Processed"]}))}}if(S||C===true){this.SetImageInViewport(n,o)}else{if(t<=this.Context.TotalImages-n){this.Context.ImageIndex=n;this.ScrollImages(e,++t)}}}else if(this.Plugin.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile){n=this.Plugin.ScrollIndexTileMode-1;e?n-=1:n+=1;if(n<=0){n=0}else if(n+1>=this.Context.TotalImages){n=n-1}if(e){n=n-this.Plugin.Controller.ViewportPane.HorizontalViewports*this.Plugin.Controller.ViewportPane.VerticalViewports;if(n<=0)n=0}this.SetImageInViewport(n,0,e)}}catch(e){console.info(e)}}ImageHas3DInformation(e){var t=false;try{var n=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid];if(e<0)return false;var o=n.Images.IndexData.length;if(e>o-1)return false;var s=n.Images.IndexData[e];var l=n.Images.StructureData[s];if(l["has3DInformation"])t=true}catch(e){}return t}SetImageInViewport(e,t=0,n=false){if(this.Context.StudyGuid===null||this.Context.StudyGuid===undefined||this.Context.SeriesGuid===null||this.Context.SeriesGuid===undefined)return;if(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid]===undefined)return;var o;var s;this.SetAnnotationsInViewport=false;this.Context.Coord3D=null;let l=this.Plugin.ForceTransformDicomViewport(false,this);WebClient.Tooltip.RemoveToolTips();if(this.Plugin.Controller.LayoutMode===ImagingStudyView.LayoutMode.Stack){if(l.Context.IsPseudoSeries){o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].KeyImages.IndexData[e];l.ProcessWLStart=false;l.Context.Level=undefined;l.Context.Window=undefined;l.Context.KeyImageEntity=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].KeyImages.StructureData[o];if(l.Context.KeyImageEntity.Images.length===1){var u=this.Plugin.GetSeriesGuidFromImageGuid(l.Context.StudyGuid,l.Context.KeyImageEntity.Images[0].ImageGUID);l.Context.ImageEntity=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[u].Images.StructureData[l.Context.KeyImageEntity.Images[0].ImageGUID]}l.Context.ImageIndex=e;l.Context.CanvasImage=null;l.Context.Level=undefined;l.Context.Window=undefined;l.InitCanvasData();l.ZoomToFit();l.Context.Renderer.Render();l.Context.OverlayRenderer.Render();l.UpdateOthersViewports()}else{o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.IndexData[e];if(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]["TypeFile"]!=="DICOM")return;if(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]["buffer"]!==null&&this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]["buffer"]!==undefined){s=l.Context.ImageIndex;l.ProcessWLStart=false;let n=l.Context.ImageEntity?l.Context.ImageEntity["isZoomed"]:null;l.Context.ImageEntity=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o];if(n)l.Context.ImageEntity["isZoomed"]=true;l.Context.ImageIndex=e;if(l.Context.ImageEntity["bufferArray"]!==null&&l.Context.ImageEntity["bufferArray"]!==undefined){l.Context.ImageSubIndex=t;var c=l.Context.ImageEntity["bufferArray"][t];l.Context.ImageEntity["buffer"]=c;if(l.Context.ImageEntity.TransferSyntax==="1.2.840.10008.1.2.4.50"){var d=window.btoa(WebClient.Utils.Uint8ToString(c));var m="data:image/jpeg;base64,"+d;this.Plugin.ConvertJpegImageToCanvasData(l.Context.StudyGuid,l.Context.SeriesGuid,l.Context.ImageEntity.ImageGUID,m,l.Context.SeriesIndex,l.Context.ImageIndex,(()=>{l.Context.Level=undefined;l.Context.Window=undefined;l.Context.CanvasImage=null;l.Context.Annotations=new Array;if(!this.ImageHas3DInformation(s)&&!this.ImageHas3DInformation(e))this.ZoomToFit();this.Plugin.GetImageAnnotations(l.Context.StudyGuid,this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render();l.UpdateOthersViewports()}))}else if(l.Context.ImageEntity.TransferSyntax==="1.2.840.10008.1.2.1"){WebClient.DicomBufferRenderer.GetWLFromImage(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]);this.Plugin.Process3DInformation(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]);l.Context.Level=undefined;l.Context.Window=undefined;l.Context.CanvasImage=null;l.Context.Annotations=new Array;if(!this.ImageHas3DInformation(s)&&!this.ImageHas3DInformation(e)){l.InitCanvasData();l.ZoomToFit()}this.Plugin.GetImageAnnotations(l.Context.StudyGuid,this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render();l.UpdateOthersViewports()}}else{l.Context.PreserveWindowLevel=true;l.Context.CanvasImage=null;l.Context.Annotations=new Array;if(!l.ImageHas3DInformation(s)&&!l.ImageHas3DInformation(e)){if(l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o]){let e=this.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].Width;let t=this.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].Height;if(this.GetWidth()!==e&&this.GetHeight()!==t){delete this.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o]}}if(!l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o]){l.Context.PreserveWindowLevel=false;l.Context.Level=undefined;l.Context.Window=undefined;if(n&&n===false||!n){l.InitCanvasData();l.ZoomToFit()}l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o]={ScaleX:l.Context.ScaleX,ScaleY:l.Context.ScaleY,Rotation:l.Context.Rotation,OffsetX:l.Context.OffsetX,OffsetY:l.Context.OffsetY,Window:l.Context.Window,Level:l.Context.Level,TransferSyntax:l.Context.ImageEntity.TransferSyntax,Width:l.GetWidth(),Height:l.GetHeight()}}else{l.Context.ScaleX=l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].ScaleX;l.Context.ScaleY=l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].ScaleY;l.Context.Rotation=l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].Rotation;l.Context.OffsetX=l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].OffsetX;l.Context.OffsetY=l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].OffsetY;l.Context.Window=l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].Window;l.Context.Level=l.TransformsPerImage[l.Context.ImageEntity.TransferSyntax+"_"+o].Level}}else{if(l.Context.ImageEntity.TransferSyntax!=="1.2.840.10008.1.2.4.50"){if(l.Context.LevelHigh&&l.Context.WindowHigh){l.Context.Level=l.Context.LevelHigh;l.Context.Window=l.Context.WindowHigh}else{l.Context.Level=undefined;l.Context.Window=undefined}}else{if(l.Context.LevelLow&&l.Context.WindowLow){l.Context.Level=l.Context.LevelLow;l.Context.Window=l.Context.WindowLow}else{l.Context.Level=undefined;l.Context.Window=undefined}}}this.Plugin.GetImageAnnotations(l.Context.StudyGuid,this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render();l.UpdateOthersViewports()}}else if(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o]["IsSR"]===true){l.Context.ImageEntity=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.StructureData[l.Context.SeriesGuid].Images.StructureData[o];l.Context.ImageIndex=e;l.Context.Level=undefined;l.Context.Window=undefined;l.Context.CanvasImage=null;let t=l.Plugin.ForceTransformDicomViewport(true,this);l.Plugin.ControlForSrView(t)}}}else if(this.Plugin.Controller.LayoutMode===ImagingStudyView.LayoutMode.Tile){var S=this.Plugin.Controller.ViewportPane.ViewportsArray;var C=e;var p=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[l.Context.StudyGuid].Study.Series.IndexData[this.Plugin.SeriesIndexTileMode];for(var A=0;A<S.length;A++){var f=S[A];var I=n?f.Context.ImageIndex-1:f.Context.ImageIndex+1;if(n&&f.Context.ImageIndex===0)break;var D=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[f.Context.StudyGuid];if(p.toLowerCase()===DicomPlugin.KeyImageManager.PseudoSeriesGuid.toLowerCase()||p.toLowerCase()===DicomPlugin.StitchManager.PseudoSeriesGuid.toLowerCase()){if(!n&&A===0&&f.Context.ImageIndex+this.Plugin.Controller.ViewportPane.HorizontalViewports*this.Plugin.Controller.ViewportPane.VerticalViewports>=D.Study.Series.StructureData[p].KeyImages.IndexData.length)break}else{if(!n&&A===0&&f.Context.ImageIndex+this.Plugin.Controller.ViewportPane.HorizontalViewports*this.Plugin.Controller.ViewportPane.VerticalViewports>=D.Study.Series.StructureData[p].Images.IndexData.length)break}this.Plugin.ForceTransformDicomViewport(false,f);f.Clear();if(DOMUtils.IsDisplay(f.ViewportFrameElement)&&f.Context.ImageEntity===null){if(p.toLowerCase()===DicomPlugin.KeyImageManager.PseudoSeriesGuid.toLowerCase()||p.toLowerCase()===DicomPlugin.StitchManager.PseudoSeriesGuid.toLowerCase()){if(D&&I<D.Study.Series.StructureData[p].KeyImages.IndexData.length){o=D.Study.Series.StructureData[p].KeyImages.IndexData[I];f.ViewportFrameElement.setAttribute("data-seriesGuid",p);f.ViewportFrameElement.setAttribute("data-studyGuid",D.Study.StudyGUID);f.Context.IsPseudoSeries=true;f.ProcessWLStart=false;f.Context.Level=undefined;f.Context.Window=undefined;f.Context.KeyImageEntity=D.Study.Series.StructureData[p].KeyImages.StructureData[o];if(this.Context.KeyImageEntity.Images.length===1){var P=this.Plugin.GetSeriesGuidFromImageGuid(f.Context.StudyGuid,f.Context.KeyImageEntity.Images[0].ImageGUID);this.Context.ImageEntity=D.Study.Series.StructureData[P].Images.StructureData[f.Context.KeyImageEntity.Images[0].ImageGUID]}f.Context.ImageIndex=I;f.Context.SeriesIndex=this.Plugin.SeriesIndexTileMode;f.Context.StudyGuid=D.Study.StudyGUID;f.Context.SeriesGuid=p;f.Context.TotalImages=D.Study.Series.StructureData[p].KeyImages.IndexData.length;f.Context.TotalSeriesInStudy=D.Study.Series.IndexData.length||D.Study.SeriesCount;f.Context.CanvasImage=null;f.InitCanvasData();f.ZoomToFit();f.Context.Renderer.Render();f.Context.OverlayRenderer.Render();C=I}}else{if(D&&I<D.Study.Series.StructureData[p].Images.IndexData.length){o=D.Study.Series.StructureData[p].Images.IndexData[I];if(D.Study.Series.StructureData[p].Images.StructureData[o]["buffer"]!==null&&D.Study.Series.StructureData[p].Images.StructureData[o]["buffer"]!==undefined){f.ViewportFrameElement.setAttribute("data-seriesGuid",p);f.ViewportFrameElement.setAttribute("data-studyGuid",D.Study.StudyGUID);f.Context.IsPseudoSeries=false;f.ProcessWLStart=false;f.Context.Level=undefined;f.Context.Window=undefined;f.Context.ImageEntity=D.Study.Series.StructureData[p].Images.StructureData[o];f.Context.ImageIndex=I;f.Context.SeriesIndex=this.Plugin.SeriesIndexTileMode;f.Context.StudyGuid=D.Study.StudyGUID;f.Context.SeriesGuid=p;f.Context.TotalImages=D.Study.Series.StructureData[p].Images.IndexData.length;f.Context.TotalSeriesInStudy=D.Study.Series.IndexData.length||D.Study.SeriesCount;f.Context.CanvasImage=null;f.Context.Annotations=new Array;f.InitCanvasData();f.ZoomToFit();this.Plugin.GetImageAnnotations(f.Context.StudyGuid,this.Plugin.Controller.StudyViewerModel.Documents.StructureData[f.Context.StudyGuid].Study.Series.StructureData[f.Context.SeriesGuid].Images.StructureData[o]);f.Context.Renderer.Render();f.Context.OverlayRenderer.Render();C=I}else if(D.Study.Series.StructureData[p].Images.StructureData[o]["IsSR"]===true){f.ViewportFrameElement.setAttribute("data-seriesGuid",p);f.ViewportFrameElement.setAttribute("data-studyGuid",D.Study.StudyGUID);f.Context.IsPseudoSeries=false;f.Context.ImageEntity=D.Study.Series.StructureData[p].Images.StructureData[o];f.Context.ImageIndex=I;f.Context.SeriesIndex=this.Plugin.SeriesIndexTileMode;f.Context.StudyGuid=D.Study.StudyGUID;f.Context.SeriesGuid=p;f.Context.TotalImages=D.Study.Series.StructureData[p].Images.IndexData.length;f.Context.TotalSeriesInStudy=D.Study.Series.IndexData.length||D.Study.SeriesCount;f.Context.Level=undefined;f.Context.Window=undefined;f.Context.CanvasImage=null;C=I;this.Plugin.ForceTransformDicomViewport(true,f);this.Plugin.ControlForSrView(f)}}}}}this.Plugin.Controller.ThumbnailPane.UpdateAllThumnailsPane();this.Plugin.ScrollIndexTileMode=C}if(!this.Plugin.IsSRDicom(l.Context.ImageEntity)){l.ImageQualityManager.SetTagQuality();l.Indicator3dManager.SetButtonTag3d();this.Plugin.ValidateViewportVoid()}}Clear(){this.ViewportFrameElement.setAttribute("data-seriesGuid","");this.ViewportFrameElement.setAttribute("data-studyGuid","");this.ProcessWLStart=false;this.Context.Level=undefined;this.Context.Window=undefined;this.Context.ImageEntity=null;this.Context.ImageIndex=-1;this.Context.CanvasImage=null;this.Context.SeriesIndex=-1;this.Context.StudyGuid="";this.Context.SeriesGuid="";this.Context.TotalImages=0;this.Context.TotalSeriesInStudy=0;this.Context.IsPseudoSeries=false;this.Context.Renderer.Clear();this.LinkManager.ViewportLayoutGrid.Element.style.display="none";var e=this.ViewportFrameElement.getElementsByClassName("containerTag");if(e.length===1)WebClient.DOMUtils.RemoveItem(e[0]);var t=this.ContentElement.getElementsByClassName("container3DTag");if(t.length>0)DOMUtils.RemoveItem(this.Indicator3dManager.Element);this.Plugin.ForceTransformDicomViewport(false,this)}UpdateOthersViewports(){if(this.Context.ImageEntity!==null&&this.Plugin.Controller.GetSelectViewport(this.Plugin.Controller.ViewportPane)===this){this.Plugin.LinkedImagesOthersViewports(this);var e=this.ViewerPage.ViewportPane.ViewportsArray;for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof DicomViewport&&n.Context.ImageEntity!==null){n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}}}}InitCanvasData(){this.Context.ScaleX=1;this.Context.ScaleY=1;this.Context.Rotation=0;this.Context.OffsetX=0;this.Context.OffsetY=0;this.Context.MouseMoveX=0;this.Context.MouseMoveY=0;this.Context.MouseDownX=0;this.Context.MouseDownY=0}GetPixelValueFromImageCoordinate(e){let t;let n=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"]);let o=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"]);let s=Math.round(e.X+n/2);let l=Math.round(e.Y+o/2);s=Math.max(s,0);s=Math.min(s,n-1);l=Math.max(l,0);l=Math.min(l,o-1);t=l*n+s;return t}GetHUValue(e){let t;let n=this.GetPixelValueFromImageCoordinate(e);var o;var s;if(this.Context.ImageEntity["dicomTags"]["0028_1052"]){o=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1052"])}if(this.Context.ImageEntity["dicomTags"]["0028_1053"]){s=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1053"])}if(o!==undefined&&s!==undefined){if(n>=0)t=this.Context.ImageEntity["buffer"][n]*s+o}return t}CalculateHounsfield(e,t){var n={};var o;var s;if(this.Context.ImageEntity["dicomTags"]["0028_1052"]){o=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1052"])}if(this.Context.ImageEntity["dicomTags"]["0028_1053"]){s=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1053"])}if(o===undefined||s===undefined){return null}try{var l=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"]);var u=parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"]);var c=Math.round(Math.min(e.X,t.X)+l/2);var d=Math.round(Math.min(e.Y,t.Y)+u/2);var m=Math.round(Math.max(e.X,t.X)+l/2);var S=Math.round(Math.max(e.Y,t.Y)+u/2);var C=Math.pow((m-c)/2,2);var p=Math.pow((S-d)/2,2);var A=(c+m)/2;var f=(d+S)/2;c=Math.max(c,0);m=Math.min(m,l-1);d=Math.max(d,0);S=Math.min(S,u-1);var I;var D;var P=Number.MAX_VALUE;var v=Number.MIN_VALUE;var T=0;var V=0;var R=0;for(var E=d;E<=S;E++){I=E*l+c;for(var M=c;M<=m;M++){I++;if((M-A)*(M-A)/C+(E-f)*(E-f)/p<1){D=this.Context.ImageEntity["buffer"][I]*s+o;P=Math.min(D,P);v=Math.max(D,v);V+=D;T++}}}for(var E=d;E<=S;E++){I=E*l+c;for(var M=c;M<=m;M++){I++;if((M-A)*(M-A)/C+(E-f)*(E-f)/p<1){let e=this.Context.ImageEntity["buffer"][I]*s+o;R+=Math.pow(e-V/T,2)}}}n.min=P;n.max=v;n.median=Math.round(V/T);n.stdDev=parseFloat(Math.sqrt(R/(T-1)).toFixed(2));n.count=T}catch(e){}return n}ProcessSingleTap(e,t){var n=DOMUtils.GetOffset(t,"x");var o=DOMUtils.GetOffset(t,"y");if(this.ViewerPage.ThumbnailPane.ThumbnailSerieSelect!==null&&this.ViewerPage.ThumbnailPane.ThumbnailSerieSelect!==undefined){if(this.ViewerPage.ThumbnailPane.ThumbnailSerieSelect.Element.getAttribute("data-typeResource")==="dicom"){this.Plugin.AssignViewportDrag(this,this.ViewerPage.ThumbnailPane.ThumbnailSerieSelect.StudyGuid,this.ViewerPage.ThumbnailPane.ThumbnailSerieSelect.SeriesItem,this.ViewerPage.ThumbnailPane.ThumbnailSerieSelect.SeriesNumber-1,this.ViewerPage.ThumbnailPane.ThumbnailSerieSelect.Element.getAttribute("data-typeResource"));this.ViewerPage.View.MessageBar.style.display="none";this.ViewerPage.ThumbnailPane.ThumbnailSerieSelect=null}}else{if((this.Context.ImageEntity===null||this.Context.ImageEntity["dicomTags"]===undefined)&&!this.Context.ImagesStitch){this.Plugin.ValidateViewportVoid();return}else{if(!DicomPlugin.CineManager.IsCineActive)WebClient.Toolbar.UnBlockAndBlockButtons(this.ViewerPage.View.Platform.Toolbar.Groups,false)}this.Context.MouseDownX=this.Context.MouseMoveX=n;this.Context.MouseDownY=this.Context.MouseMoveY=o;var s=this.PointInElement(this.Context.MouseDownX,this.Context.MouseDownY);if(!e.match("Annotation")){var l=this.DetectAnnotation(s);if(l!==null&&!this.Context.IsPseudoSeries){if(l.annotation.Plugin!==this.Plugin.PluginName)return;this.IsAnyAnnotationSelected=true;l.annotation.Selected=!l.annotation.Selected;this.Annotations[this.Plugin.PluginName]=this.Context.Annotations;this.AnnotationManager.DrawAnnotations()}else{this.AnnotationManager.DrawAnnotations()}}if(WebClient.Utils.CheckNotAllowTag(["patient"])){this.ViewerPage.View.Platform.Toolbar.PerformButtonAction("toolbarviewer.2","deleteAnnotTool",(e=>{if(this.Plugin.GetAnnotSelectCount()>=1)e.Element.style.display="inline-block"}))}switch(true){case e.match("^DicomAnnotation")!==null:if(this.Context.ImageEntity===null)return;if(this.Context.IsPseudoSeries)return;this.processAnnotations(e,t,s,ImagingStudyView.EAnnotationEventType.Tap);break;case e==="DicomZoom":case e==="DicomPan":break;case e==="DicomZoomCenterX":var u=this.ViewportFrameElement.clientWidth/2;var c=this.ViewportFrameElement.clientHeight/2;var d=n-this.Context.OffsetX;var m=o-this.Context.OffsetY;this.Context.OffsetX=u-2*d;this.Context.OffsetY=c-2*m;this.Context.ScaleX*=2;this.Context.ScaleY*=2;this.AnnotationManager.DrawAnnotations();break;case e==="DicomTriangulation":var S=s.X+parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"])/2;var C=s.Y+parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"])/2;this.SwitchImagesInTriangulation(S,C);this.UpdateCanvasTriangulation(S,C);break;case e==="DicomStitch":if(this.ViewerPage.MultipleSelectViewports){if(!DOMUtils.HasClass(this.ViewportFrameElement,"SelectedViewportStitch")){this.ViewportFrameElement.style.borderColor=WebClient.Colors.Emerald;DOMUtils.AddClass(this.ViewportFrameElement,"SelectedViewportStitch")}else{this.ViewportFrameElement.style.borderColor=WebClient.Colors.BgDarker;DOMUtils.RemoveClass(this.ViewportFrameElement,"SelectedViewportStitch")}}if(this.Context.ImagesStitch){const e=this.Context.KeyImageEntity.Images;const t=this.Plugin.DetectStitchImageSelectedIndex(e,s,this);if(t!==-1){e===null||e===void 0?void 0:e.forEach((e=>{delete e["selected"]}));e[t]["selected"]=true;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render()}}break}this.UpdateOthersViewports()}}ProcessDoubleTap(e,t){if(this.Context.ImageEntity===null)return;switch(this.Plugin.Controller.View.Platform.GetSetting("selectMouseBehLeftDoubleClick")){case"Dicom1x1Layout":switch(e){case"Pointer":case"DicomZoom":case"DicomRotate":case"DicomPan":case"DicomWindowLevel":if(!this.ViewerPage.FullScreen){this.Plugin.Activate1x1(this)}break}break;case"DicomStitch":var n=this.ViewerPage.View.Platform.Toolbar.GetButton("StitchTool");this.Plugin.ProcessStitchToolEvent(n.Element);break;case"DicomInvertWl":this.SetInvertImage();break;case"EvueResetWl":this.SetWindowLevel(undefined,undefined,DicomPlugin.ResetWlMode.EVue);break;case"DicomResetWl":this.SetWindowLevel(undefined,undefined,DicomPlugin.ResetWlMode.Dicom);break;case"DicomBrainTool":if(this.Plugin.ShouldApplyWLPreset())this.SetWindowLevelForBrain();else WebClient.Toaster.ShowToast("This preset cannot be applied to this image",WebClient.Colors.Alizarin,3);break;case"DicomLiverTool":if(this.Plugin.ShouldApplyWLPreset())this.SetWindowLevelForLiver();else WebClient.Toaster.ShowToast("This preset cannot be applied to this image",WebClient.Colors.Alizarin,3);break;case"DicomLungsTool":if(this.Plugin.ShouldApplyWLPreset())this.SetWindowLevelForLungs();else WebClient.Toaster.ShowToast("This preset cannot be applied to this image",WebClient.Colors.Alizarin,3);break;case"DicomHumanBoneTool":if(this.Plugin.ShouldApplyWLPreset())this.SetWindowLevelForHumanBone();else WebClient.Toaster.ShowToast("This preset cannot be applied to this image",WebClient.Colors.Alizarin,3);break;case"DicomStomachTool":if(this.Plugin.ShouldApplyWLPreset())this.SetWindowLevelForStomach();else WebClient.Toaster.ShowToast("This preset cannot be applied to this image",WebClient.Colors.Alizarin,3);break;case"DicomResetTransformations":this.ResetTransformations();break;case"DicomZoomToFit":this.ZoomToFit(true);this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();break;case"DicomZoomOneToOne":this.Zoom1x1();this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();break;case"DicomRotateLeft":this.Context.Rotation-=90;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();break;case"DicomRotateRight":this.Context.Rotation+=90;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();break;case"DicomFlipHorizontalTool":this.Context.ScaleX=-this.Context.ScaleX;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();break;case"DicomFlipVerticalTool":this.Context.ScaleY=-this.Context.ScaleY;this.Context.Renderer.Render();this.Context.OverlayRenderer.Render();break;case"DicomCaseStudyTool":this.ViewerPage.CaseStudyController=new ImagingStudyView.CaseStudyController(this.ViewerPage.View.Platform.GetMainContainer(),this.ViewerPage.View.Platform,this.ViewerPage);this.Plugin.SetEventsCaseStudy();this.ViewerPage.CaseStudyController.Pane.Toggle();break;case"DicomDeleteAnnotTool":for(var o=0;o<this.Plugin.Controller.View.Plugins.length;o++){this.Plugin.Controller.View.Plugins[o].DeleteSelectedAnnotations(this)}break;case"DicomCineTool":var s=this.Plugin.Controller.View.Platform.Toolbar.GetButton("cineTool");if(!DicomPlugin.CineManager.IsCineActive){DicomPlugin.CineManager.OpenUICine(this.Plugin)}else{DicomPlugin.CineManager.CloseUICine()}break;case"DicomLinkTool":let t=false;if(!this.Plugin.IsLinkToolActive){this.Plugin.Controller.SelectDefaultTool();t=true}else{t=false}this.Plugin.Controller.ToogleLinkTool(t);break;case"DicomAddKey":DicomPlugin.KeyImageManager.CreateRemoveKeyImage(DicomPlugin.EOptionKeyImageAction.Add);break;case"DicomRemoveKey":DicomPlugin.KeyImageManager.CreateRemoveKeyImage(DicomPlugin.EOptionKeyImageAction.Remove);break}this.UpdateOthersViewports()}SetWindowLevelForBrain(){this.SetWindowLevel(80,40)}SetWindowLevelForLiver(){this.SetWindowLevel(400,60)}SetWindowLevelForLungs(){this.SetWindowLevel(1500,-400)}SetWindowLevelForHumanBone(){this.SetWindowLevel(1500,300)}SetWindowLevelForStomach(){this.SetWindowLevel(400,60)}ProcessKeyDown(e,t){WebClient.Utils.DebugConsoleLog(t);if(!this.EnableActionsOnViewport)return;switch(t.which){case 38:case 39:this.ScrollImages(false);break;case 40:case 37:this.ScrollImages(true);break;case 27:if(e.match("^DicomAnnotation")){this.Context.CurrentAnnotation=null}WebClient.Toolbar.DeselectFixed();this.ViewerPage.SelectDefaultTool();break;case 8:case 46:if(t.target.type!=="text"){for(var n=0;n<this.Plugin.Controller.View.Plugins.length;n++){this.Plugin.Controller.View.Plugins[n].DeleteSelectedAnnotations(this)}}break;case 9:var o=this.ViewerPage.GetSelectViewport(this.ViewerPage.ViewportPane);this.ViewerPage.UnselectViewports(this.ViewerPage.ViewportPane);var s=o.NumberInPanel;var l=this.ViewerPage.ViewportPane.TabIndexMaxViewport;if(s===l-1)s=0;var u=this.ViewerPage.ViewportPane.ViewportsArray;for(var n=0;n<u.length;n++){var c=u[n].NumberInPanel;if(c===s+1){var d=u[n].ViewportFrameElement;u[n].SelectViewport=true;d.style.borderColor=WebClient.Colors.Emerald;DOMUtils.AddClass(d,"SelectedViewport");u[n].ContentElement.click();u[n].ContentElement.focus();break}}break}}ProcessMouseUp(e,t){if(this.Context.ImageEntity===null||this.Context.ImageEntity["dicomTags"]===undefined||this.ViewerPage.ActiveContextMenu===false){t.preventDefault();return}var n=this.PointInElement(this.Context.MouseDownX,this.Context.MouseDownY);var o=DOMUtils.GetOffset(t,"x");var s=DOMUtils.GetOffset(t,"y");this.Context.MouseDownX=this.Context.MouseMoveX=o;this.Context.MouseDownY=this.Context.MouseMoveY=s;var n=this.PointInElement(this.Context.MouseDownX,this.Context.MouseDownY);var l=this.DetectAnnotation(n);if(!e.match("Annotation")){if(l!==null){l.annotation.Selected=!l.annotation.Selected;this.Annotations[this.Plugin.PluginName]=this.Context.Annotations;this.AnnotationManager.DrawAnnotations()}}var u;var c=t;if(this.MouseRightDragAcum<=2){if(DOMUtils.IsDisplay(this.ViewerPage.ViewportPane.disabledStudyNotice)){t.preventDefault();return}if(l!==null&&l!==undefined){u=new Array;c.preventDefault();var d=this.Plugin.Controller.View.Platform.LanguageManager;var m=new ImagingStudyView.ContextMenuOption("DicomDeleteAnnotTool",d.GetValuesFromDict("DicomPluginLanguage","deleteAnnotTool"),"deleteAnnotTool");m.Default=true;m.Action=e=>{var t=this.ViewerPage.GetSelectViewport(this.ViewerPage.ViewportPane);if(t!==null){for(var n=0;n<this.Plugin.Controller.View.Plugins.length;n++){this.Plugin.Controller.View.Plugins[n].DeleteSelectedAnnotations(this)}this.ViewerPage.SelectDefaultTool()}};u.push(m);this.CreateContextMenu(u,c);this.MouseRightDragDown=false;this.MouseRightDragAcum=0}else{this.CreateContextMenu([],c);this.MouseRightDragDown=false;this.MouseRightDragAcum=0;this.Plugin.MagnifierElement.style.visibility="hidden";this.Plugin.MagnifierElement.style.display=""}}else{t.preventDefault();return}}ProcessPanAndSwipe(e,t){var n;if(!this.EnableActionsOnViewport)return;var o=DOMUtils.GetOffset(t,"x");var s=DOMUtils.GetOffset(t,"y");var l;var u;var c=t.srcEvent;var d;switch(true){case(t.type==="swipeup"||t.type==="swiperight")&&(t.pointerType!=="mouse"||t.srcEvent.touches):if(!e.match("Annotation")&&!e.match("DicomPan")&&!e.match("DicomZoom")&&!e.match("DicomRotate")&&!e.match("DicomWindowLevel"))this.ScrollImages(false);break;case(t.type==="swipedown"||t.type==="swipeleft")&&(t.pointerType!=="mouse"||t.srcEvent.touches):if(!e.match("Annotation")&&!e.match("DicomPan")&&!e.match("DicomZoom")&&!e.match("DicomRotate")&&!e.match("DicomWindowLevel"))this.ScrollImages(true);break;case t.type==="press":break;case t.type==="panstart":if((this.Context.ImageEntity===null||this.Context.ImageEntity["dicomTags"]===undefined)&&(this.Context.ImagesStitch===null||this.Context.ImagesStitch===undefined))return;this.initWLInX=t.center.x;this.initWLInY=t.center.y;this.Context.MouseDownX=this.Context.MouseMoveX=o;this.Context.MouseDownY=this.Context.MouseMoveY=s;d=this.PointInElement(this.Context.MouseDownX,this.Context.MouseDownY);if(this.Context.ImagesStitch!==null&&this.Context.ImagesStitch!==undefined){this.Plugin.DetectMoveStitch(d,this);return}if(this.initLevelProcess===undefined)this.initLevelProcess=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1050"]);else this.initLevelProcess=this.Context.Level;if(this.initWindowProcess===undefined)this.initWindowProcess=Math.max(0,parseInt(this.Context.ImageEntity["dicomTags"]["0028_1051"]));else this.initWindowProcess=Math.max(0,this.Context.Window);var m=this.AnnotationManager.GetPointInDetectAnnotation(d);if(m!==null&&!e.match("Annotation")&&e.match("Pointer"))this.InitDragMoveAnnotFromGrip=m;if(m!==null&&m.annotation.CanDragPoint!==undefined&&m.annotation.CanDragPoint)this.InitDragMoveAnnotFromGrip=m;if(this.Context.IsPseudoSeries)this.InitDragMoveAnnotFromGrip=null;if(e.match("^DicomAnnotation")){if(this.Context.ImageEntity===null)return;if(this.Context.IsPseudoSeries)return;this.processAnnotations(e,t,d,ImagingStudyView.EAnnotationEventType.Drag)}break;case t.type==="panmove":if(this.Context.ImageEntity===null&&(this.Context.ImagesStitch===null||this.Context.ImagesStitch===undefined))return;if(e.match("^DicomAnnotation")&&(t.pointerType==="touch"||t.pointerType==="pen"||((n=t.srcEvent)===null||n===void 0?void 0:n.touches))){this.MoveOnCanvas(t);return}this.endWLInX=t.center.x;this.endWLInY=t.center.y;var S=this.endWLInX-this.initWLInX;var C=this.endWLInY-this.initWLInY;if(t.srcEvent!==undefined&&t.pointerType==="mouse"){l=o-this.Context.MouseMoveX;u=s-this.Context.MouseMoveY;this.Context.MouseMoveX=o;this.Context.MouseMoveY=s;switch(e){case"DicomPan":this.Pan(l,u);break;case"DicomZoom":var p=new WebClient.Point(this.Context.MouseDownX,this.Context.MouseDownY);try{let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID];e["isZoomed"]=this.ZoomToCenter(p,l,u,t)}catch(e){this.ZoomToCenter(p,l,u,t)}break;case"DicomRotate":this.Rotate(l,u);break}}else if(t.pointerType==="touch"||t.srcEvent.touches){l=o-this.Context.MouseMoveX;u=s-this.Context.MouseMoveY;this.Context.MouseMoveX=o;this.Context.MouseMoveY=s;switch(e){case"DicomPan":this.Pan(l,u);break;case"DicomZoom":var A=new WebClient.Point(this.Context.MouseDownX,this.Context.MouseDownY);try{let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID];e["isZoomed"]=this.ZoomToCenter(A,l,u,t)}catch(e){this.ZoomToCenter(A,l,u,t)}break}}if(e==="Pointer"&&!this.Context.ImagesStitch&&!this.InitDragMoveAnnotFromGrip){try{var f=this.Plugin.Controller.View.Platform.GetSetting("seriesScrollWheelOrientation")||"up";if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(t.deltaX>=0){this.ExecuteActionWheel(t.deltaX,(()=>{this.ScrollImages(f!=="up")}),20)}else{this.ExecuteActionWheel(t.deltaX,(()=>{this.ScrollImages(f==="up")}),20)}}else{if(t.deltaY<0){this.ExecuteActionWheel(t.deltaY,(()=>{this.ScrollImages(f!=="up")}),20)}else{this.ExecuteActionWheel(t.deltaY,(()=>{this.ScrollImages(f==="up")}),20)}}}catch(e){WebClient.Utils.DebugConsoleLog(e)}}if(this.Context.ImagesStitch!==null&&this.Context.ImagesStitch!==undefined){var I;var D=this.Context.KeyImageEntity;if(this.Plugin.StitchIndexMove!==-1){I=D.Images[this.Plugin.StitchIndexMove];I.X=I.X+l*1/this.Context.ScaleX;I.Y=I.Y+u*1/this.Context.ScaleY;I["moved"]=true;this.Context.Renderer.Render(null,true)}else if(this.Plugin.StitchIndexRotate!==-1){let e=this.PointInElement(o,s);I=D.Images[this.Plugin.StitchIndexRotate];const t=parseInt(this.Context.ImagesStitch[this.Plugin.StitchIndexRotate].ImageEntity["dicomTags"]["0028_0011"]);const n=parseInt(this.Context.ImagesStitch[this.Plugin.StitchIndexRotate].ImageEntity["dicomTags"]["0028_0010"]);const l=t*this.Context.ScaleX;const u=n*this.Context.ScaleY;let c=new WebClient.Point(e.X*this.Context.ScaleX+this.Context.OffsetX,e.Y*this.Context.ScaleY+this.Context.OffsetY);this.Plugin.MouseRotateStitchPointB=new WebClient.Point(c.X,c.Y);let d=new WebClient.Point(this.Context.OffsetX+l/2+I.X*this.Context.ScaleX,this.Context.OffsetY+u/2+I.Y*this.Context.ScaleY);let m=ImagingStudyView.Geometry.calculateRotationAngle(d.X,d.Y,this.Plugin.MouseRotateStitchPointA.X,this.Plugin.MouseRotateStitchPointA.Y,this.Plugin.MouseRotateStitchPointB.X,this.Plugin.MouseRotateStitchPointB.Y);I.Rotation=m+I["rotateInitial"];this.Context.Renderer.Render()}else{var A=new WebClient.Point(this.Context.MouseDownX,this.Context.MouseDownY);try{let e=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID];e["isZoomed"]=this.ZoomToCenter(A,l,u)}catch(e){this.ZoomToCenter(A,l,u)}}return}if(this.InitDragMoveAnnotFromGrip!==null&&this.InitDragMoveAnnotFromGrip!==undefined){var P=this.InitDragMoveAnnotFromGrip.annotation;d=this.PointInElement(this.Context.MouseMoveX,this.Context.MouseMoveY);if(P.AnnotationPointBeforeDrag===null||P.AnnotationPointBeforeDrag===undefined)P.AnnotationPointBeforeDrag=P.Points[this.InitDragMoveAnnotFromGrip.group][this.InitDragMoveAnnotFromGrip.coordIndex];P.Points[this.InitDragMoveAnnotFromGrip.group][this.InitDragMoveAnnotFromGrip.coordIndex]=new ImagingStudyView.AnnotationPoint(d);if(!P.EvaluatePointDragMoveAndEnd(P.Points[this.InitDragMoveAnnotFromGrip.group][this.InitDragMoveAnnotFromGrip.coordIndex],this.InitDragMoveAnnotFromGrip.group,this.InitDragMoveAnnotFromGrip.coordIndex))P.Points[this.InitDragMoveAnnotFromGrip.group][this.InitDragMoveAnnotFromGrip.coordIndex]=P.AnnotationPointBeforeDrag;else P.AnnotationPointBeforeDrag=P.Points[this.InitDragMoveAnnotFromGrip.group][this.InitDragMoveAnnotFromGrip.coordIndex];this.updateAnnotationReference(P)}if(e==="DicomWindowLevel"){var v;var T;var V=this.Plugin.Controller.View.Platform.GetSetting("selectWlWindow");var R=this.Plugin.Controller.View.Platform.GetSetting("selectWlLevel");if(V===undefined||V==="increasetoright")v=S;else v=-S;if(R===undefined||R==="increasedown")T=C;else T=-C;this.OffsetWindowLevel(v,T)}else if(e.match("^DicomAnnotation")){this.AnnotationManager.DrawAnnotations()}else if(e==="DicomMagnifier"){if(t.pointerType==="touch"||t.srcEvent.touches)this.Magnifier(t)}else if(e==="DicomTriangulation"){d=this.PointInElement(this.Context.MouseDownX,this.Context.MouseDownY);var E=d.X+parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"])/2;var M=d.Y+parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"])/2;this.SwitchImagesInTriangulation(E,M);this.UpdateCanvasTriangulation(E,M)}break;case t.type==="panend":if(this.InitDragMoveAnnotFromGrip!==null&&this.InitDragMoveAnnotFromGrip!==undefined){this.InitDragMoveAnnotFromGrip.annotation.AnnotationPointBeforeDrag=null;this.InitDragMoveAnnotFromGrip.annotation.DonePointDragMoveAndEnd(this.InitDragMoveAnnotFromGrip.annotation.Points[this.InitDragMoveAnnotFromGrip.group][this.InitDragMoveAnnotFromGrip.coordIndex],this.InitDragMoveAnnotFromGrip.group,this.InitDragMoveAnnotFromGrip.coordIndex);if(this.InitDragMoveAnnotFromGrip.annotation.Status===ImagingStudyView.EAnnotationStatus.Complete)this.AnnotationManager.SaveAnnotation(this.InitDragMoveAnnotFromGrip.annotation);this.InitDragMoveAnnotFromGrip=null}this.Context.MouseDownX=this.Context.MouseMoveX=o;this.Context.MouseDownY=this.Context.MouseMoveY=s;d=this.PointInElement(this.Context.MouseDownX,this.Context.MouseDownY);if(this.Context.ImagesStitch!==null&&this.Context.ImagesStitch!==undefined){var D=this.Context.KeyImageEntity;var I=D.Images[this.Plugin.StitchIndexMove];if(I){if(I["moved"])delete I["moved"];if(I["rotated"])delete I["rotated"]}this.Plugin.StitchIndexMove=-1;this.Plugin.StitchIndexRotate=-1;this.Plugin.MouseRotateStitchPointB=null;this.Context.Renderer.Render();return}if(e.match("^DicomAnnotation")){this.processAnnotations(e,t,d,ImagingStudyView.EAnnotationEventType.Drag)}break}}ProcessPinchAndRotate(e,t){var n;if(!this.EnableActionsOnViewport)return;var o;if(t.pointerType==="touch"||((n=t.srcEvent)===null||n===void 0?void 0:n.touches)){if(t.type==="rotatestart")this.initRotateHammer=t.rotation;else if(t.type==="pinchstart"){this.initPinchHammer=t.scale;var s=DOMUtils.GetOffset(t.pointers[0],"x");var l=DOMUtils.GetOffset(t.pointers[0],"y");this.Context.MouseDownX=s;this.Context.MouseDownY=l}if(t.type==="rotatemove"){if(e==="DicomRotate"){o=t.rotation-this.initRotateHammer;if(Math.abs(o)>=1){this.initRotateHammer=t.rotation;this.Rotate(o,o)}}}else if(t.type==="pinchmove"){if(e==="DicomZoom"){o=t.scale-this.initPinchHammer;if(Math.abs(o)>=.1){let e=new WebClient.Point(this.Context.MouseDownX,this.Context.MouseDownY);let n;try{n=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID]}catch(e){}if(t.scale>this.initPinchHammer){if(n)n["isZoomed"]=this.ZoomToCenter(e,1,-1,t);else this.ZoomToCenter(e,1,-1,t)}else{if(n)n["isZoomed"]=this.ZoomToCenter(e,-1,1,t);else this.ZoomToCenter(e,-1,1,t)}this.initPinchHammer=t.scale}}}}}ProcessMouseDown(e,t){var n=DOMUtils.GetOffset(t,"x");var o=DOMUtils.GetOffset(t,"y");let controlDragActions=e=>{switch(e){case"DicomWindowLevel":this.initWLInX=n;this.initWLInY=o;if(this.initLevelProcess===undefined)this.initLevelProcess=parseInt(this.Context.ImageEntity["dicomTags"]["0028_1050"]);else this.initLevelProcess=this.Context.Level;if(this.initWindowProcess===undefined)this.initWindowProcess=Math.max(0,parseInt(this.Context.ImageEntity["dicomTags"]["0028_1051"]));else this.initWindowProcess=Math.max(0,this.Context.Window);break;case"DicomZoom":case"DicomRotate":case"DicomPan":case"DicomTriangulation":this.Context.MouseDownX=this.Context.MouseMoveX=n;this.Context.MouseDownY=this.Context.MouseMoveY=o;break}};if(t.which===3||t.which===2){this.MouseRightDragDown=true;this.MouseRightDragAcum=0;if(this.Context.ImageEntity===null||this.Context.ImageEntity["dicomTags"]===undefined)return;if(t.which===3){const e=this.Plugin.Controller.View.Platform.GetSetting("selectMouseBehDragRight");controlDragActions(e)}else if(t.which===2){const e=this.Plugin.Controller.View.Platform.GetSetting("selectMouseBehDragMiddle");controlDragActions(e)}}}ProcessMouseMove(e,t){if(!this.EnableActionsOnViewport)return;var n=DOMUtils.GetOffset(t,"x");var o=DOMUtils.GetOffset(t,"y");this.Plugin.MagnifierElement.style.visibility="hidden";this.Plugin.MagnifierElement.style.display="";if(t.srcEvent!==undefined&&t.pointerType==="mouse"||(t.srcEvent===undefined||t instanceof MouseEvent))this.MoveOnCanvas(t);if(t.which===2||t.which===3){if(this.MouseRightDragDown){if(this.Context.ImageEntity===null)return;this.endWLInX=n;this.endWLInY=o;var s=this.endWLInX-this.initWLInX;var l=this.endWLInY-this.initWLInY;var u=n-this.Context.MouseMoveX;var c=o-this.Context.MouseMoveY;this.Context.MouseMoveX=n;this.Context.MouseMoveY=o;let e;if(t.which===3)e=this.Plugin.Controller.View.Platform.GetSetting("selectMouseBehDragRight");else if(t.which===2)e=this.Plugin.Controller.View.Platform.GetSetting("selectMouseBehDragMiddle");switch(e){case"DicomWindowLevel":var d;var m;var S=WebClient.LocalStorage.Get("selectWlWindow");var C=WebClient.LocalStorage.Get("selectWlLevel");if(S===undefined||S==="increasetoright")d=s;else d=-s;if(C===undefined||C==="increasedown")m=l;else m=-l;this.OffsetWindowLevel(d,m);break;case"DicomZoom":let e=new WebClient.Point(this.Context.Viewport.PointMove.X,this.Context.Viewport.PointMove.Y);try{let t=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[this.Context.StudyGuid].Study.Series.StructureData[this.Context.SeriesGuid].Images.StructureData[this.Context.ImageEntity.ImageGUID];t["isZoomed"]=this.ZoomToCenter(e,u,c)}catch(t){this.ZoomToCenter(e,u,c)}break;case"DicomRotate":this.Rotate(u,c);break;case"DicomPan":this.Pan(u,c);break;case"DicomTriangulation":this.Plugin.ShowTriangulations=true;var p=this.PointInElement(this.Context.Viewport.PointMove.X,this.Context.Viewport.PointMove.Y);var A=p.X+parseInt(this.Context.ImageEntity["dicomTags"]["0028_0011"])/2;var f=p.Y+parseInt(this.Context.ImageEntity["dicomTags"]["0028_0010"])/2;this.SwitchImagesInTriangulation(A,f);this.UpdateCanvasTriangulation(A,f);this.Plugin.ShowTriangulations=false;break}}}}RenderAnnotations(){if(this.Context.ImageEntity.LoadAnnotations&&!this.SetAnnotationsInViewport||this.Context.IsPseudoSeries&&!this.SetAnnotationsInViewport)this.AnnotationManager.GetAnnotationsToViewport(this.Context.ImageEntity);var e=this.ViewerPage.AnnotationsHide;for(var t=0;t<this.Context.Annotations.length;t++){try{this.Context.Annotations[t].Context=this.Context;if(!this.Context.Annotations[t]["recentCreated"])this.Context.Annotations[t].Visible=!e;else this.Context.Annotations[t].Visible=true;this.Context.Annotations[t].Render()}catch(e){WebClient.Utils.DebugConsoleLog(e)}}if(this.Context.CurrentAnnotation!==null&&this.Context.CurrentAnnotation!==undefined){try{this.Context.CurrentAnnotation.Render()}catch(e){WebClient.Utils.DebugConsoleLog(e)}}}IsViewportInGroup(e){if(e instanceof DicomViewport){var t=e.LinkManager.LinkGroup;for(var n=0;n<t.length;n++){if(t[n].Context.SeriesGuid===this.Context.SeriesGuid&&t[n].Context.StudyGuid===this.Context.StudyGuid)return true}}return false}getZoomFactor(e,t,n){var o=1;if(n!==null&&n!==undefined){if(n.deltaX!==undefined&&n.deltaY!==undefined){if(n.deltaX<0&&n.deltaY<0){var s=Math.abs(n.angle)-90;if(25<=s&&s<=65)return-1}if(n.deltaX>0&&n.deltaY>0){if(25<=n.angle&&n.angle<=65)return-1}}if(n.additionalEvent!==undefined){switch(n.additionalEvent){case"panup":case"panright":o=1.02;break;case"panleft":case"pandown":o=1/1.02;break;default:return}}}else{if(t<0||e>0)o=1.02;else if(t>0||e<0)o=1/1.02;else return-1}return o}updateAnnotationReference(e){if(e.Plugin===this.Plugin.PluginName){e.MeasureAnnotation();this.InitDragMoveAnnotFromGrip.annotation=e;if(e.Status===ImagingStudyView.EAnnotationStatus.Complete)this.Annotations[e.Plugin]=this.Context.Annotations}else{var t=this.Context.Viewport["RendererPlugins"];var n=Object.keys(t);for(var o=0;o<n.length;o++){var s=t[n[o]].Plugin;if(s.PluginName===e.Plugin){e.MeasureAnnotation();this.InitDragMoveAnnotFromGrip.annotation=e;if(e.Status===ImagingStudyView.EAnnotationStatus.Complete)this.Annotations[e.Plugin]=t[n[o]].Annotations}}}this.AnnotationManager.DrawAnnotations()}evaluateOtherAnnotationsType(e){switch(this.ViewerPage.ToolSelect){case"DicomAnnotationPolyline":if(DicomPlugin.PolylineAnnotation.PointsControl){DicomPlugin.PolylineAnnotation.PointsControl.push(new ImagingStudyView.AnnotationPoint(e));let t=ImagingStudyView.Geometry.GetSimpleDistance(DicomPlugin.PolylineAnnotation.PointsControl[0],DicomPlugin.PolylineAnnotation.PointsControl[DicomPlugin.PolylineAnnotation.PointsControl.length-1]);if(t>=5){this.Context.AnnotationController.RegisterPoint(DicomPlugin.PolylineAnnotation.PointsControl[0]);this.Context.AnnotationController.RegisterPoint(DicomPlugin.PolylineAnnotation.PointsControl[DicomPlugin.PolylineAnnotation.PointsControl.length-1]);DicomPlugin.PolylineAnnotation.PointsControl=[]}}break;default:break}}annotationDone(e=false){if(this.Annotations[this.Plugin.PluginName]===undefined)this.Annotations[this.Plugin.PluginName]=this.Context.Annotations;this.AnnotationManager.DrawAnnotations();if(!e){this.AnnotationManager.SaveAnnotation(this.Context.CurrentAnnotation);this.Context.CurrentAnnotation=null}else{let e;const t=this.Context.CurrentAnnotation["startOperation"];const n=performance.now();const o=2250;let executionFunc=()=>{setTimeout((()=>{if(this.AnnotationManager.AnnotationsStack.length>=1){let e=this.AnnotationManager.AnnotationsStack.length;let t=this.AnnotationManager.AnnotationsStack[e-1];let n=performance.now();let s=n-t.EndTime;if(s>=o){for(let t=0;t<e;t++){this.AnnotationManager.SaveAnnotation(this.AnnotationManager.AnnotationsStack[t].Annotation,null,t===e-1?true:false)}this.AnnotationManager.AnnotationsStack=new Array}else{executionFunc()}}}),o)};e={StartTime:t,EndTime:n,TotalTime:n-t,Annotation:this.Context.CurrentAnnotation};this.AnnotationManager.AnnotationsStack.push(e);executionFunc();this.Context.CurrentAnnotation=null}}processAnnotations(tool,evObject,positionInCanvas,eventName){var text="";var newPoint=new ImagingStudyView.AnnotationPoint(positionInCanvas,eventName);var acceptOnlyTapEvent=["DicomAnnotationLine","DicomAnnotationEllipse","DicomAnnotationAngle","DicomAnnotationRectangle","DicomAnnotationArrow","DicomAnnotationText","DicomAnnotationMarker"];var acceptOnlyDraEvent=["DicomAnnotationPolyline"];var initAnnot=()=>{var subTypeAnnotationName=tool.substr(15);this.Context.CurrentAnnotation=eval("new Vue.Products.DicomPlugin."+subTypeAnnotationName+"Annotation()");this.Context.CurrentAnnotation.Context=this.Context;this.Context.CurrentAnnotation.Id=WebClient.Utils.GetGuid();this.Context.CurrentAnnotation.Selected=false;this.Context.CurrentAnnotation.Author=sessionStorage["userEmail"];this.Context.CurrentAnnotation.Date=new Date;this.Context.CurrentAnnotation.Plugin=this.Plugin.PluginName;this.Context.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.New;this.Context.CurrentAnnotation["new"]=true;this.Context.CurrentAnnotation["startOperation"]=performance.now();this.Context.AnnotationController=new ImagingStudyView.AnnotationController(this.Context.CurrentAnnotation)};if(this.Context.CurrentAnnotation===null||this.Context.CurrentAnnotation===undefined){if(eventName===ImagingStudyView.EAnnotationEventType.Tap&&acceptOnlyTapEvent.some((e=>e===tool))){initAnnot();switch(tool){case"DicomAnnotationLine":case"DicomAnnotationEllipse":case"DicomAnnotationAngle":case"DicomAnnotationRectangle":case"DicomAnnotationArrow":this.Context.AnnotationController.SetFirstGroup();this.Context.AnnotationController.RegisterPoint(newPoint);break;case"DicomAnnotationText":this.Context.AnnotationController.SetFirstGroup();this.Context.AnnotationController.RegisterPoint(newPoint);text=prompt("Annotation text:","");if(text!==null&&text!==""){this.Context.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;this.Context.CurrentAnnotation.TextLabel=text;this.Context.Annotations.push(this.Context.CurrentAnnotation);this.annotationDone()}else this.Context.CurrentAnnotation=null;break;case"DicomAnnotationMarker":this.Context.AnnotationController.SetFirstGroup();this.Context.AnnotationController.RegisterPoint(newPoint);if(DicomPlugin.MarkerOptionsPane.DataMarker["selectOption1"].toLowerCase()==="custom")text=DicomPlugin.MarkerOptionsPane.DataMarker["textboxCustomMarker"];else text=DicomPlugin.MarkerOptionsPane.DataMarker["selectOption3"];if(text!==null&&text!==""&&text!=="--"){const e=DicomPlugin.MarkerOptionsPane.DataMarker["buttonBarCheckSize"];this.Context.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;this.Context.CurrentAnnotation.TextLabel=text;this.Context.CurrentAnnotation.LabelSize=e;this.Context.Annotations.push(this.Context.CurrentAnnotation);this.annotationDone()}else{WebClient.Toaster.ShowToast("Please select a marker",WebClient.Colors.Alizarin,3);this.Context.CurrentAnnotation=null}break}}else if(eventName===ImagingStudyView.EAnnotationEventType.Drag&&acceptOnlyDraEvent.some((e=>e===tool))){initAnnot();switch(tool){case"DicomAnnotationPolyline":DicomPlugin.PolylineAnnotation.PointsControl=[];this.Context.AnnotationController.SetFirstGroup();break}}}else{if(eventName===ImagingStudyView.EAnnotationEventType.Tap&&acceptOnlyTapEvent.some((e=>e===tool))){switch(tool){case"DicomAnnotationLine":case"DicomAnnotationEllipse":case"DicomAnnotationAngle":case"DicomAnnotationRectangle":let e=this.Context.CurrentAnnotation.GetpointCtrlProjected?this.Context.CurrentAnnotation.GetpointCtrlProjected():null;if(e){this.Context.AnnotationController.RegisterPoint(e);this.Context.CurrentAnnotation.SetpointCtrlProjected(null)}else{this.Context.AnnotationController.RegisterPoint(newPoint)}if(this.Context.CurrentAnnotation.DrawIsValid()){if(this.Context.AnnotationController.IsCompleted){this.Context.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;this.Context.CurrentAnnotation.MeasureAnnotation();this.Context.Annotations.push(this.Context.CurrentAnnotation);this.annotationDone()}}else{this.Context.AnnotationController.ReversePointRegister()}this.AnnotationManager.DrawAnnotations();break;case"DicomAnnotationArrow":this.Context.AnnotationController.RegisterPoint(newPoint);if(this.Context.CurrentAnnotation.DrawIsValid()){var annotPointArrow=new ImagingStudyView.AnnotationPoint(positionInCanvas,eventName);text=prompt("Annotation text:","");if(text!==null){this.Context.AnnotationController.RegisterPoint(annotPointArrow);this.Context.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;this.Context.CurrentAnnotation.TextLabel=text;this.Context.Annotations.push(this.Context.CurrentAnnotation);this.annotationDone()}else this.Context.AnnotationController.ReversePointRegister()}else this.Context.AnnotationController.ReversePointRegister();this.AnnotationManager.DrawAnnotations();break}}else if(eventName===ImagingStudyView.EAnnotationEventType.Drag&&acceptOnlyDraEvent.some((e=>e===tool))){switch(tool){case"DicomAnnotationPolyline":DicomPlugin.PolylineAnnotation.PointsControl=[];if(!this.Context.AnnotationController.CurrentGroup)this.Context.AnnotationController.SetFirstGroup();this.Context.AnnotationController.RegisterPoint(positionInCanvas);if(this.Context.AnnotationController.IsCompleted){this.Context.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;this.Context.CurrentAnnotation.MeasureAnnotation();this.Context.Annotations.push(this.Context.CurrentAnnotation);this.annotationDone(true)}else{this.Context.CurrentAnnotation=null}this.AnnotationManager.DrawAnnotations();break}}}}}DicomPlugin.DicomViewport=DicomViewport})(DicomPlugin=Products.DicomPlugin||(Products.DicomPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){class DicomViewportContext{constructor(t){this.ImageSubIndex=0;this.IsPseudoSeries=false;this.InvertImage=false;this.PreserveWindowLevel=false;this.Window=undefined;this.Level=undefined;this.WindowDelta=0;this.LevelDelta=0;this.WindowHighDelta=0;this.LevelHighDelta=0;this.WindowLowDelta=0;this.LevelLowDelta=0;this.ScaleX=1;this.ScaleY=1;this.Rotation=0;this.OffsetX=0;this.OffsetY=0;this.MouseMoveX=0;this.MouseMoveY=0;this.MouseDownX=0;this.MouseDownY=0;this.ScoutLineIsActive=true;this.HideAllAnnotations=false;this.Viewport=t;this.Renderer=new e.DicomImageRenderer(this);this.OverlayRenderer=new e.DicomOverlayRenderer(this)}}e.DicomViewportContext=DicomViewportContext})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;var o=Efferent.ClientViews.ImagingStudyView;class ImageQualityManager{constructor(e){this.viewport=e}SetTagQuality(){this.ParentElement=this.viewport.ContentElement;if(this.viewport.Context.ImageEntity!==null&&this.viewport.Context.ImageEntity!==undefined){try{if(this.viewport.Context.ImageEntity["dicomTags"]){var e=this.viewport.Context.ImageEntity["dicomTags"]["0002_0010"];var o=this.ParentElement.getElementsByClassName("containerTag");if(o.length>0)n.RemoveItem(this.Element);if(this.Element!==undefined){n.HideElement(this.Element);n.RemoveItem(this.Element)}if(e==="1.2.840.10008.1.2.4.50"){this.Element=document.createElement("div");var s=document.createElement("div");s.innerHTML="CL";n.AddClass(s,"qualityTag qualityTagCL");this.Element.appendChild(s);n.AddClass(this.Element,"containerTag");var l=this.viewport.Plugin.IsActiveDownloadForceHD(this.viewport.Context.StudyGuid,this.viewport.Context.SeriesGuid);if(l===null||!l){this.Element.onclick=e=>{if(e.currentTarget.childNodes[0].innerHTML==="CL"){this.viewport.Plugin.Controller.SetSelectViewport(this.viewport);let e=this.viewport.ViewerPage.StudyViewerModel.Documents.StructureData[this.viewport.Context.StudyGuid].Study;let n=this.viewport.Plugin.CheckFullDownloadStudy(e,this.viewport.Context.SeriesGuid);if(n){if(this.viewport.Context.IsPseudoSeries)t.Toaster.ShowToast("Invalid keyimage to be downloaded. Select a no keyimage",t.Colors.PeterRiver,5);else this.DownloadHighImagesInSerie()}else{t.Toaster.ShowToast("The serie is currently downloading",t.Colors.PeterRiver,5)}}}}else{this.Element.innerHTML="Loading HD..."}this.ParentElement.appendChild(this.Element)}else{this.Element=document.createElement("div");var u=document.createElement("div");u.innerHTML="HD";n.AddClass(u,"qualityTag qualityTagHD");this.Element.appendChild(u);n.AddClass(this.Element,"containerTag");this.ParentElement.appendChild(this.Element)}if(parseInt(this.viewport.Context.ImageEntity["dicomTags"]["0028_0008"])>1){let e=this.Element.offsetTop;this.Element.style.top=e+10+"px"}}}catch(e){t.Utils.DebugConsoleLog("SetTagQuality => "+e)}}}DownloadHighImagesInSerie(){var e=this.viewport.Context.StudyGuid;var t=this.viewport.ViewerPage.Downloader.StructureData[e];var n=this.viewport.ViewerPage.StudyViewerModel.Documents.StructureData[e].Study;var o=this.viewport.Plugin.CheckFullDownloadStudy(n);if(!this.viewport.ViewerPage.ForceHDDownloadForStudyAndSerie[e])this.viewport.ViewerPage.ForceHDDownloadForStudyAndSerie[e]=new Array;var s=this.viewport.ViewerPage.ForceHDDownloadForStudyAndSerie[e].findIndex((e=>e.seriesGuid===this.viewport.Context.SeriesGuid));if(s===-1)this.viewport.ViewerPage.ForceHDDownloadForStudyAndSerie[e].push({seriesGuid:this.viewport.Context.SeriesGuid,isActive:true});else this.viewport.ViewerPage.ForceHDDownloadForStudyAndSerie[e][s].isActive=true;t.RemoveLoadAttributeForImage(n,this.viewport.Context.SeriesGuid);this.Element.innerHTML="Loading HD...";if(o)t.Download(n,true,true)}DownloadHighImage(){var s=this.viewport.Context.StudyGuid;var l=this.viewport.Context.SeriesGuid;var u=this.viewport.Context.ImageEntity.ImageGUID;var c=this.viewport.ViewerPage.StudyViewerModel.Documents.StructureData[s].Study.Series.StructureData[l].Images.StructureData[u].ImageUri;var d=c.match(/^(([a-z]+:)?(\/\/)?[^\/]+\/).*$/)[1];var m=c.substr(d.length);var S=t.PlatformContext.PlatformUri+"/"+m;var C=sessionStorage["token"];var p=new o.WadoClient(S);var A=document.createElement("canvas");A.width=50;A.height=30;var f=document.createElement("div");n.AddClass(f,"qualityTagCanvas");f.appendChild(A);this.progressRing=new t.ProgressRing(A);this.progressRing.ShowWatch();this.Element.innerHTML="";this.Element.appendChild(f);p.GetImageFile(C,"High",1,null,(c=>{try{if(c.data.length===0)throw new Error("Image Buffer is zero");var d=new o.DicomParser(c.data);var m=d.image;var S=d.DicomTags;var C=d.transferSyntax;var p=d.photometric;var A=d.isUnsigned;var f=this.viewport.ViewerPage.StudyViewerModel.Documents.StructureData[s];var I=f.Study.Series.StructureData[l].Images.StructureData[u];I.TransferSyntax=C.replace(/([^a-z0-9.]+)/gi,"");I["photometric"]=p;I["isUnsigned"]=A;I["dicomTags"]=S;if(C!=="1.2.840.10008.1.2.4.50"){t.DicomBufferRenderer.GetFramesBuffer(I,m);var D;if(I["buffer"]===null){D=I["bufferArray"][this.viewport.Context.ImageSubIndex];I["buffer"]=D}this.viewport.Context.ImageEntity=I;t.DicomBufferRenderer.GetWLFromImage(f.Study.Series.StructureData[l].Images.StructureData[u]);this.viewport.Plugin.Process3DInformation(f.Study.Series.StructureData[l].Images.StructureData[u]);this.viewport.Plugin.GetImageAnnotations(f.Study.StudyGUID,f.Study.Series.StructureData[l].Images.StructureData[u]);this.viewport.Context.Level=undefined;this.viewport.Context.Window=undefined;this.viewport.Context.CanvasImage=null;this.viewport.Context.Coord3D=null;this.viewport.ProcessWLStart=false;this.viewport.Context.Renderer.Render();this.viewport.Context.OverlayRenderer.Render();this.viewport.UpdateOthersViewports();this.viewport.ZoomToFit();this.viewport.Plugin.OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight);var P=this.viewport.ViewerPage.ViewportPane.ViewportsArray;for(var v=0;v<P.length;v++){var T=P[v];if(n.IsDisplay(T.ViewportFrameElement)&&T.Context.ImageEntity!==null){if(T instanceof e.DicomViewport){this.viewport.Plugin.UpdateImageProperties(T)}}}t.Toaster.ShowToast("The high-resolution image was downloaded correctly",t.Colors.PeterRiver,5)}else{t.Toaster.ShowToast("The high-resolution image could not be downloaded",t.Colors.Orange,5)}}catch(e){switch(c.StatusResponse){case"404":t.Toaster.ShowToast("A high-resolution image is not available",t.Colors.Orange,5);break;case"5xx":t.Toaster.ShowToast("Error while retrieving the high-resolution image",t.Colors.Orange,5);break;default:t.Toaster.ShowToast("There was a problem downloading the high-resolution image",t.Colors.Orange,5)}}finally{this.SetTagQuality()}}),(e=>{var t=parseFloat((e["loaded"]*100/e["total"]).toFixed(2));this.progressRing.ShowPercentage(t)}),(()=>{this.progressRing.ShowWatch()}))}}e.ImageQualityManager=ImageQualityManager})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class Indicator3dManager{constructor(e){this.viewport=e}SetButtonTag3d(){var contextReadyControl=()=>{if(this.setTimeoutTag)clearTimeout(this.setTimeoutTag);this.setTimeoutTag=setTimeout((()=>{if(this.viewport.Context.StudyGuid){var e=this.viewport.Plugin.Controller.LoadAllAnnotationsForStudy[this.viewport.Context.StudyGuid];if(e||Array.isArray(e)){let e=false;for(var t=0;t<this.viewport.Plugin.Controller.View.Plugins.length;t++){var o=this.viewport.Plugin.Controller.View.Plugins[t];o.Evaluate3DAnnotation(this.viewport,(t=>{if(t){e=true;this.renderButtonTag3d()}}),false)}if(!e){var s=this.viewport.ContentElement.getElementsByClassName("container3DTag");if(s.length>0)n.RemoveItem(this.Element)}}else{contextReadyControl()}}else{contextReadyControl()}}),600)};contextReadyControl()}renderButtonTag3d(){this.ParentElement=this.viewport.ContentElement;var e=this.ParentElement.getElementsByClassName("container3DTag");if(this.viewport.Context.ImageEntity!==null&&this.viewport.Context.ImageEntity!==undefined&&e.length===0){try{var e=this.ParentElement.getElementsByClassName("container3DTag");if(e.length>0)n.RemoveItem(this.Element);if(this.Element!==undefined){n.HideElement(this.Element);n.RemoveItem(this.Element)}this.Element=document.createElement("div");var o=document.createElement("div");o.innerHTML="3D";n.AddClass(o,"quality3DTag");this.Element.appendChild(o);n.AddClass(this.Element,"container3DTag");this.Element.onclick=e=>{this.viewport.Plugin.Controller.SetSelectViewport(this.viewport);for(var t=0;t<this.viewport.Plugin.Controller.View.Plugins.length;t++){var n=this.viewport.Plugin.Controller.View.Plugins[t];n.OpenPaneStlLayout()}};this.ParentElement.appendChild(this.Element)}catch(e){t.Utils.DebugConsoleLog("Set3DTag => "+e)}}}}e.Indicator3dManager=Indicator3dManager})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.FhirClient;let o;(function(e){e[e["Add"]=0]="Add";e[e["Remove"]=1]="Remove"})(o=e.EOptionKeyImageAction||(e.EOptionKeyImageAction={}));class KeyImageManager{static SetKeyImage(t){KeyImageManager.Plugin=t;KeyImageManager.PseudoSerieStudy=new e.PseudoSerieStudy(t,KeyImageManager.PseudoSeriesGuid)}static GetImageReferenceFromKeyImage(e,t,n){try{var o=new Array;var s=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[n].KeyImages.IndexData[t];var l=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[n].KeyImages.StructureData[s].Images;l.forEach((t=>{var n=t["ImageGUID"];var s=this.Plugin.GetSeriesGuidFromImageGuid(e,n);var l=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[s].Images.StructureData[n];o.push(l)}));return o}catch(e){return[]}}static CreateRemoveKeyImage(e){var s=KeyImageManager.Plugin.Controller.GetSelectViewport(KeyImageManager.Plugin.Controller.ViewportPane);if(s!==null){if(s.Context.ImageEntity!==null){if(s.Context.IsPseudoSeries){if(e!==null&&e!==undefined&&e===o.Add){t.Toaster.ShowToast("Bad action. Please select a not keyimage.",t.Colors.Orange,3);return}try{t.Loader.Show();n.KeyImageClient.DeleteKeyImage(s.Context.KeyImageEntity,(e=>{t.Loader.Hide();t.Toolbar.HideAllMenus();if(e===200||e===204){KeyImageManager.PseudoSerieStudy.DeleteKeyImageFromPseudoSeries(s.Context.KeyImageEntity.KeyImageID);t.Toaster.ShowToast("The KeyImage was removed.",t.Colors.BelizeHole,3)}else t.Toaster.ShowToast("The keyImage was not deleted due to an error in the server.",t.Colors.Orange,3)}))}catch(e){t.Loader.Hide();t.Toaster.ShowToast("KeyImage error: "+e,t.Colors.Orange,3)}}else{if(e!==null&&e!==undefined&&e===o.Remove){t.Toaster.ShowToast("Bad action. Please select the Add Key Image option.",t.Colors.Orange,3);return}try{var l=new t.KeyImageEntity;l.KeyImageID=t.Utils.GetGuid();l.Author=sessionStorage["userEmail"];l.Images=new Array;var u=new t.KeyImageElementEntity;u.ImageGUID=s.Context.ImageEntity.ImageGUID;u.Rotation=s.Context.Rotation;u.X=s.Context.OffsetX;u.Y=s.Context.OffsetY;u.Zoom=s.Context.ScaleX;l.Images.push(u);l.Thumbnail=s.Context.ImageEntity.Thumbnail;l.CalibrationData=s.Context.ImageEntity.CalibrationData;var c=new Array;for(var d=0;d<s.Context.ImageEntity.Annotations.length;d++){var m=s.Context.ImageEntity.Annotations[d].Serialize();c.push(m)}l.Annotations=JSON.stringify(c);t.Loader.Show();var S=this.Plugin.Controller.ImagingStudyFhirEntities[s.Context.StudyGuid];n.KeyImageClient.SaveKeyImage(S.id,l,((e,n)=>{t.Loader.Hide();t.Toolbar.HideAllMenus();if(e===201||e===200){var o=n.getResponseHeader("Location");var u=o.split("Basic/")[1].split("/")[0];l.Id=u;KeyImageManager.PseudoSerieStudy.AddKeyImageToPseudoSeries(s.Context.StudyGuid,l);t.Toaster.ShowToast("The KeyImage was added.",t.Colors.BelizeHole,3)}else t.Toaster.ShowToast("The keyImage was not saved due to an error in the server.",t.Colors.BelizeHole,3)}))}catch(e){t.Loader.Hide();t.Toaster.ShowToast("KeyImage error: "+e,t.Colors.Orange,3)}}}}else{t.Toaster.ShowToast("Select a viewport",t.Colors.BelizeHole,3)}}}KeyImageManager.PseudoSeriesGuid="keyPseudoSeries";e.KeyImageManager=KeyImageManager})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){let t;(function(e){e[e["Modality"]=0]="Modality";e[e["MinNumberImages"]=1]="MinNumberImages";e[e["ImageType"]=2]="ImageType";e[e["Orientation"]=3]="Orientation";e[e["AllImageNotDownloaded"]=4]="AllImageNotDownloaded"})(t=e.EErrorMPR||(e.EErrorMPR={}));class MPRValidator{constructor(e,t,n){this.viewport=e;this.plugin=t;this.Mprtype=n}ValidatorSerie(){let e;try{let n=this.viewport.ViewerPage.StudyViewerModel.Documents.StructureData[this.viewport.Context.StudyGuid].Study;if(this.plugin.IsSerieFullDownloaded(n,this.viewport.Context.SeriesGuid)){if(n.Series.IndexData.length>3){let o=this.viewport.ViewerPage.ImagingStudyFhirEntities[this.viewport.Context.StudyGuid]["modality"][0]["code"];if(["CT","MR"].some((e=>e===o))){if(this.IsTagValueForAll(n,this.viewport.Context.SeriesGuid,"0008_0008",new RegExp(/^ORIGINAL/gi),true)){if(this.IsTagValueForAll(n,this.viewport.Context.SeriesGuid,"0020_0037",[[1,0,0,0,1,0]])){e=true}else{e=t.Orientation}}else{e=t.ImageType}}else{e=t.Modality}}else{e=t.MinNumberImages}}else{e=t.AllImageNotDownloaded}}catch(t){e=false}return e}IsTagValueForAll(e,t,n,o,s=false){let l=true;e.Series.IndexData.forEach((u=>{if(t===u){var c=e.Series.StructureData[u].Images;if(c!==undefined&&c!==null){c.IndexData.forEach((t=>{var c,d;var m=e.Series.StructureData[u].Images.StructureData[t];if(!m["dicomTags"][n])l=false;if(Array.isArray(o)){let e=o.some((e=>{var t,o;return s?new RegExp(e).test((t=m["dicomTags"][n])===null||t===void 0?void 0:t.toString().trim()):(e===null||e===void 0?void 0:e.toString().trim())===((o=m["dicomTags"][n])===null||o===void 0?void 0:o.toString().trim())}));if(!e)l=false}else{if(s){if(!new RegExp(o).test((c=m["dicomTags"][n])===null||c===void 0?void 0:c.toString().trim()))l=false}else if(((d=m["dicomTags"][n])===null||d===void 0?void 0:d.toString().trim())!==(o===null||o===void 0?void 0:o.toString().trim())){l=false}}}))}}}));return l}}e.MPRValidator=MPRValidator})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(t){var n;(function(t){var n=Efferent.Frontend.WebClient;class PdfReporter{constructor(e,t,n){this.doc=new PDFDocument({size:e,layout:t?"portrait":"landscape",margin:n,permissions:{printing:"highResolution"}});this.previewPages=[];this.createSvgPage()}Download(e){const t=this.doc.pipe(blobStream());this.doc.end();t.on("finish",(()=>{const e=t.toBlob("application/pdf");const o=window.URL.createObjectURL(e);if(n.DOMUtils.IsGoogleChrome()){var s=document.getElementById("printFrame");if(!s){s=document.createElement("iframe");s.id="printFrame";s.style.display="none";document.body.appendChild(s)}s.onload=()=>{setTimeout((()=>{s.focus();s.contentWindow.print()}),1)};s.src=o}else{const e=document.createElement("a");e.setAttribute("id","openPdfLink");e.target="_blank";e.href=o;document.body.appendChild(e);document.getElementById("openPdfLink").click();setTimeout((()=>{document.body.removeChild(e)}),1e3)}}))}AddHeader(e){this.doc.fontSize(10);var t=this.calculateTextArea(e);this.doc.text(e,{width:t.Width,align:"left"});var n=t.Height+this.separator/2;this.PrintAreaOrigin.Y+=n;this.PrintAreaSize.Height-=n}AddHeaderPreview(e){var t=this.calculateTextArea(e);var n='<rect width="'+t.Width+'" height="'+t.Height+'" x="'+this.PrintAreaOrigin.X+'" y="'+this.PrintAreaOrigin.Y+'" fill="#FFF" stroke="#000" />\n';this.previewPages[this.previewPages.length-1]+=n;var o=t.Height+this.separator/2;this.PrintAreaOrigin.Y+=o;this.PrintAreaSize.Height-=o}GetPrintSize(e,t){let o=e.Width*t;let s=e.Height*t;let l;let u;let c;u=Math.min(this.PrintAreaSize.Width,o);c=Math.min(this.PrintAreaSize.Height,s);l=new n.Size(u,c);return l}RenderImageOnBuffer(t,o,s,l,u,c,d,m,S,C,p,A,f){return __awaiter(this,void 0,void 0,(function*(){const I=document.createElement("div");const D=n.Utils.GetGuid();let P;if(C&&!isNaN(C))P=this.GetPrintSize(u,C);else P=c;I.id=D;I.style.width=`${P.Width}px`;I.style.height=`${P.Height}px`;const v=new e.Products.DicomPlugin.DicomViewport(I,D,null,t.Controller,null,t);v.CreateWithoutEvents=true;v.Create(0);v.ViewportElement.setAttribute("height",P.Height+"px");v.ViewportElement.setAttribute("width",P.Width+"px");v.ViewportFrameElement.style.width=`${P.Width}px`;v.ViewportFrameElement.style.height=`${P.Height}px`;var T;var V;if(C&&!isNaN(C)){let e=u.Width/c.Width*C;let t=u.Height/c.Height*C;T=new n.Size(e,t);let o=(P.Width-u.Width*C)/2;let s=(P.Height-u.Height*C)/2;if(p)V=new n.Point(o-p.X,s-p.Y);else V=new n.Point(o,s)}let R=yield t.SetImageToViewportLight(o,s,l,d,m,S,v,isNaN(C)?null:C,T,V,true,true,A,f,u,this.PrintAreaSize);const E=v.ViewportElement;v.Dispose();Efferent.Frontend.WebClient.DOMUtils.RemoveItem(I);return E.toDataURL("image/png",1)}))}GetImageViewportSize(e,t,o,s){const l=e&&e["dicomTags"]?+e["dicomTags"]["0028_0011"]:512;const u=e&&e["dicomTags"]?+e["dicomTags"]["0028_0010"]:512;let c=new n.Size(l,u);if(o){const t=e&&e["pixelSpacing"]&&e["pixelSpacing"][2]==="mm"?e["pixelSpacing"][0]:1;const o=l*t*(72/25.4);const d=u*t*(72/25.4);c=new n.Size(o,d);return{originaImageSize:new n.Size(l,u),renderSize:c,renderOffset:s}}else{var d=(this.PrintAreaSize.Width-this.separator*(t-1))/t;var m=d/c.Width;var S=c.Height*m;return{originaImageSize:new n.Size(l,u),renderSize:new n.Size(d,S),renderOffset:s}}}AddImage(e,t,n,o,s){if(o)this.addImageWithZoom(e,t,o,s);else this.addImageMultiColumn(e,t,n,o,s)}AddImagePreview(e,t,n,o,s){if(o)this.addImageWithZoom(e,t,o,s,true);else this.addImageMultiColumn(null,t,n,o,s,true)}GetPageCount(){return this.previewPages.length}GetPagePreview(e){return this.previewPages[e]+"</svg>"}MakeDraggable(e){var t=null;var n=null;var o=null;var s=1;var l=null;var u=this;var e=e;e.addEventListener("mousedown",startDrag);e.addEventListener("mousemove",drag);e.addEventListener("mouseup",endDrag);e.addEventListener("mouseleave",endDrag);function startDrag(e){if(e.target.classList.contains("draggable")){t=document.getElementById("image-group");l=t.getBBox();s=l.width/20;n=u.ScaledImageOffset;o={X:e.clientX,Y:e.clientY}}}function drag(e){if(t){e.preventDefault();let c;let d;if(u.PrintAreaSize.Width<l.width)c=n.X+(e.clientX-o.X)/s;else c=1;if(u.PrintAreaSize.Height<l.height)d=n.Y+(e.clientY-o.Y)/s;else d=1;if(c>0)c=0;else if(c+l.width+u.PrintAreaOrigin.X<u.PrintAreaSize.Width+u.PrintAreaOrigin.X)c=u.PrintAreaSize.Width-l.width;if(d>0)d=0;else if(d+l.height+u.PrintAreaOrigin.Y<u.PrintAreaSize.Height+u.PrintAreaOrigin.Y)d=u.PrintAreaSize.Height-l.height;u.ScaledImageOffset.X=c;u.ScaledImageOffset.Y=d;t.setAttributeNS(null,"transform","translate("+c+","+d+")")}}function endDrag(e){t=null}}addImageWithZoom(e,t,o,s,l){this.ScaledImageOffset=s?s:new n.Point(0,0);var u=new n.Size(t.Width*o,t.Height*o);var c=new n.Point(this.PrintAreaOrigin.X+this.ScaledImageOffset.X,this.PrintAreaOrigin.Y+this.ScaledImageOffset.Y);var d=new n.Point(c.X+u.Width,c.Y+u.Height);var m=u.Width;var S=u.Height;if(l){var C='<defs><clipPath id="cut-off"><rect x="'+this.PrintAreaOrigin.X+'" y="'+this.PrintAreaOrigin.Y+'" width="'+this.PrintAreaSize.Width+'" height="'+this.PrintAreaSize.Height+'" /></clipPath></defs>\n';C+='<g clip-path="url(#cut-off)">';C+='<g id="image-group" transform="translate('+this.ScaledImageOffset.X+","+this.ScaledImageOffset.Y+')">';C+='<image class="draggable" style="cursor:move" width="'+m+'" height="'+S+'" href="'+e+'" x="'+c.X+'" y="'+c.Y+'"/>\n';C+='<line x1="'+c.X+'" y1="'+c.Y+'" x2="'+d.X+'" y2="'+d.Y+'" stroke="#700"  />\n';C+='<line x1="'+c.X+'" y1="'+d.Y+'" x2="'+d.X+'" y2="'+c.Y+'" stroke="#700" /> </g></g>\n';this.previewPages[this.previewPages.length-1]+=C}else{this.doc.image(e,this.PrintAreaOrigin.X,this.PrintAreaOrigin.Y,{width:u.Width/o,height:u.Height/o})}S+=this.separator;this.lineHeight=0;this.PrintAreaOrigin.Y+=S;this.positionX=0;this.firstImageInPage=false}addImageMultiColumn(e,t,n,o,s,l){var u=(this.PrintAreaSize.Width-this.separator*(n-1))/n;var c=u/t.Width;var d=t.Height*c;if(d>this.PrintAreaSize.Height){if(this.firstImageInPage){c=this.PrintAreaSize.Height/t.Height}else{if(l){this.createSvgPage();this.addImageMultiColumn(null,t,n,o,s,true)}else{this.createPage();this.addImageMultiColumn(e,t,n,o,s)}return}}u=t.Width*c;d=t.Height*c;if(this.positionX+u>this.PrintAreaSize.Width+1){var m=this.lineHeight+this.separator;this.PrintAreaOrigin.Y+=m;this.positionX=0;if(this.PrintAreaOrigin.Y>this.PrintAreaSize.Height-m){if(l){this.createSvgPage();this.addImageMultiColumn(null,t,n,o,s,true)}else{this.createPage();this.addImageMultiColumn(e,t,n,o,s)}return}}var S=this.positionX+this.doc.page.margins.left;var C=this.PrintAreaOrigin.Y;var p=S+u;var A=C+d;if(l){if(!this.firstImageInPage&&C>this.doc.page.margins.top&&C+d>this.PrintAreaSize.Height){this.createSvgPage();C=this.PrintAreaOrigin.Y}var f='<rect width="'+u+'" height="'+d+'" x="'+S+'" y="'+C+'" fill="#777" stroke="#000" />\n';f+='<line x1="'+S+'" y1="'+C+'" x2="'+p+'" y2="'+A+'" stroke="#000" />\n';f+='<line x1="'+S+'" y1="'+A+'" x2="'+p+'" y2="'+C+'" stroke="#000" />\n';this.previewPages[this.previewPages.length-1]+=f}else{if(!this.firstImageInPage&&C>this.doc.page.margins.top&&C+d>this.PrintAreaSize.Height){this.createPage();C=this.PrintAreaOrigin.Y}this.doc.image(e,S,C,{fit:[u,d]})}this.lineHeight=Math.max(this.lineHeight,d);this.positionX+=this.separator+u;this.firstImageInPage=false}calculatePrintArea(){this.pageSize=new n.Size(this.doc.page.width,this.doc.page.height);this.PrintAreaOrigin=new n.Point(this.doc.page.margins.left,this.doc.page.margins.top);this.PrintAreaSize=new n.Size(this.doc.page.width-2*this.doc.page.margins.left,this.doc.page.height-2*this.doc.page.margins.top);this.separator=this.PrintAreaSize.Width*.025}createPage(){this.calculatePrintArea();this.doc.addPage();this.firstImageInPage=true;this.positionX=0;this.lineHeight=0}createSvgPage(){this.calculatePrintArea();let e;let t;if(this.pageSize.Width>this.pageSize.Height){e="100%";t=`${this.pageSize.Height}px`}else{e=`${this.pageSize.Width}px`;t="100%"}var n=`<svg xmlns="http://www.w3.org/2000/svg" width="${e}" height="${t}" viewBox="0 0 ${this.pageSize.Width} ${this.pageSize.Height}">\n`;n+='<rect width="100%" height="100%" fill="#FFF" stroke="#000" />\n';this.previewPages.push(n);this.firstImageInPage=true;this.positionX=0;this.lineHeight=0}calculateTextArea(e){var t=this.PrintAreaSize.Width;var o=this.doc.heightOfString(e);return new n.Size(t,o)}}t.PdfReporter=PdfReporter})(n=t.DicomPlugin||(t.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(t){var n;(function(t){var n=Efferent.Frontend.WebClient;const{div:o,anchor:s,h4:l,ul:u,li:c,input:d,label:m,select:S,option:C,span:p,button:A,p:f,img:I,textNode:D}=n.DOMUtils;const P="0028_0011";const v="0028_0010";const T="0010_0010";const V="0008_0090";const R="0008_1030";const E="0010_0030";const M="0008_0020";const G=256;const L=256;const F=[{value:"A4",label:"A4",width:210,height:297,units:"mm"},{value:"A3",label:"A3",width:297,height:420,units:"mm"},{value:"LEGAL",label:"LEGAL",width:8.5,height:14,units:"inch"},{value:"LETTER",label:"LETTER",width:8.5,height:11,units:"inch"},{value:"TABLOID",label:"TABLOID",width:11,height:17,units:"inch"}];let B;(function(e){e[e["PORTRAIT"]=0]="PORTRAIT";e[e["LANDSCAPE"]=1]="LANDSCAPE"})(B=t.EPaperOrientation||(t.EPaperOrientation={}));let O;(function(e){e[e["SCALE_TO_FIT"]=1]="SCALE_TO_FIT";e[e["SCALE_TO_PERCENT"]=2]="SCALE_TO_PERCENT"})(O=t.EScaleType||(t.EScaleType={}));let N;(function(e){e[e["CURRENT_IMAGE"]=0]="CURRENT_IMAGE";e[e["CURRENT_SERIES"]=1]="CURRENT_SERIES";e[e["CURRENT_STUDY"]=2]="CURRENT_STUDY"})(N=t.EPrintTargetType||(t.EPrintTargetType={}));class PrintDialog{constructor(e,t){const l=n.LocalStorage.Get("dicomPrintPaperOpt");const u=n.LocalStorage.Get("dicomPrintOrientation");const c=+n.LocalStorage.Get("dicomPrintColsNumber");this.plugin=e;this.selectedTargetType=t||N.CURRENT_IMAGE;this.selectedOrientation=B[u]||B.PORTRAIT;this.selectedPaperOpt=F.find((e=>e.label===l))||F[0];this.selectedColsNumber=c||1;this.currentPreviewPage=1;this.selectedScaleType=O.SCALE_TO_FIT;this.Background=o({className:"BackgroundMessageBox",style:{display:"none"},children:[this.Element=o({className:"MessageBox PrintBox",style:{display:"none",overflow:"auto"},children:[o({className:"margin flex-v",style:{height:"100%"},children:[this.titleElement=o({className:"title",style:{cursor:"grab"},innerHTML:"Print options",children:[s({href:"#",innerHTML:"&times;",onclick:()=>{this.Background.parentElement.removeChild(this.Background)}})]}),o({className:"flex-v",style:{height:"100%"},children:[o({className:"flex-h",children:[this.buildTargetSection(),this.buildPaperSection()]}),o({className:"flex-h",style:{height:"100%"},children:[this.scaleSection=this.buildScaleSection(),this.buildPreviewSection()]})]}),o({className:"containerButtonsMessageBox",children:this.buildButtons()})]})]})]});document.body.appendChild(this.Background);const d=setTimeout((()=>{this.makeDraggable();this.addResizeListener();clearTimeout(d)}),50)}Show(){this.Background.style.display="block";this.Element.style.display="flex";const e=this.selectedOrientation===B.PORTRAIT;this.updateSVGPreview(this.selectedPaperOpt.label,e,this.selectedColsNumber)}Hide(){this.Background.style.display="none";this.Element.style.display="none";n.DOMUtils.RemoveItem(this.Background)}makeDraggable(){let e=0;let t=0;let o=0;let s=0;this.titleElement.onmousedown=dragMouseDown;const l=window.getComputedStyle(this.Element);const u=(document.documentElement.clientWidth-Number.parseInt(l.width,10))/2;const c=(document.documentElement.clientHeight-Number.parseInt(l.height,10))/2;n.DOMUtils.SetStyles(this.Element,{margin:"0 0 0 0",left:`${u}px`,top:`${c}px`});const d=this;function dragMouseDown(e){e.preventDefault();d.titleElement.style.cursor="grabbing";o=e.clientX;s=e.clientY;document.onmouseup=closeDragElement;document.onmousemove=elementDrag}function elementDrag(n){n.preventDefault();e=o-n.clientX;t=s-n.clientY;o=n.clientX;s=n.clientY;const l=d.Element;l.style.top=`${Math.max(l.offsetTop-t,0)}px`;l.style.left=`${Math.max(l.offsetLeft-e,0)}px`}function closeDragElement(){d.titleElement.style.cursor="grab";document.onmouseup=null;document.onmousemove=null}}buildButtons(){return[]}updateSVGPreview(e,t,n){switch(this.selectedTargetType){case N.CURRENT_IMAGE:this.updateSVGPreviewCurrentImage(e,t,1);break;case N.CURRENT_SERIES:this.updateSVGPreviewCurrentSeries(e,t,n);break;case N.CURRENT_STUDY:this.updateSVGPreviewCurrentStudy(e,t,n);break}}updateSVGPreviewCurrentImage(e,o,s){this.zoneElement.innerHTML="";this.pdfPreview=new t.PdfReporter(e,o,20);this.currentPreviewPage=1;const l=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);const u=l.Context.ImageEntity;if(!u)return;const{patientName:c,practitioner:d,studyDescription:m,dob:S,studyDate:C}=this.getDicomInfo(u,l.Context.StudyGuid);this.pdfPreview.AddHeaderPreview(`Patient Name: ${c} - DOB: ${S} - Practitioner: ${d}\nStudy description: ${m} (${C})`);this.checkIfAllAvailable(l.Context.StudyGuid,u,"image",(()=>__awaiter(this,void 0,void 0,(function*(){const e=this.isImageEntityCalibrated(u);const t=this.getDicomImageDimensions(u);this.textCalibratedElement.style.visibility=e?"hidden":"visible";let o=1;if(this.selectedScaleType===O.SCALE_TO_FIT){this.pdfPreview.AddImagePreview(null,t,s)}else{o=this.selectedScaleValue/100;const{calibratedWidth:e,calibratedHeight:c}=this.getEntityCalibration(u);let d=yield this.getImageUri(l.Context.StudyGuid,l.Context.SeriesGuid,u.ImageGUID,t,l.Context.SeriesIndex,l.Context.ImageIndex,l.Context.ImageSubIndex);this.pdfPreview.AddImagePreview(d,new n.Size(e,c),s,o)}this.previewPaginationElement.innerHTML=` ${this.currentPreviewPage} / ${this.pdfPreview.GetPageCount()} `;this.zoneElement.innerHTML=this.pdfPreview.GetPagePreview(0);if(this.selectedScaleType!==O.SCALE_TO_FIT){let e=this.zoneElement.firstChild;this.pdfPreview.MakeDraggable(e)}}))),l.Context.IsPseudoSeries)}checkIfAllAvailable(e,t,n,o,s){let l=0;let u=0;switch(n){case"image":u=1;if(s&&Object.keys(t).length===0){let t=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);u=t.Context.KeyImageEntity.Images.length;t.Context.KeyImageEntity.Images.forEach((t=>{var n=this.plugin.GetSeriesGuidFromImageGuid(e,t.ImageGUID);let o=this.plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[n].Images.StructureData[t.ImageGUID];if(o["Processed"]){l++}}))}else{if(t["Processed"]){l++}}break;case"series":u=t.IndexData.length;for(let n=0;n<u;n++){const o=t.IndexData[n];let u=t.StructureData[o];if(s){var c=this.plugin.GetSeriesGuidFromImageGuid(e,u.Images[0].ImageGUID);u=this.plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[c].Images.StructureData[u.Images[0].ImageGUID]}if(u["Processed"]){l++}}break;case"study":if(this.inputSeries.value===""){for(let e=0;e<t.seriesIndexData.length;e++){const n=t.seriesIndexData[e];if(!["stitchNonePseudoSeries"].includes(n)){t.selectedStudy=this.plugin.Controller.StudyViewerModel.Documents.StructureData[t.studyGuid].Study;const e=t.selectedStudy.Series.StructureData[n];const o=e["pseudoserie"]===true?e.KeyImages:e.Images;u+=o.IndexData.length;for(let n=0;n<o.IndexData.length;n++){const s=o.IndexData[n];let u=o.StructureData[s];if(e["pseudoserie"]===true){var c=this.plugin.GetSeriesGuidFromImageGuid(t.studyGuid,u.Images[0].ImageGUID);u=this.plugin.Controller.StudyViewerModel.Documents.StructureData[t.studyGuid].Study.Series.StructureData[c].Images.StructureData[u.Images[0].ImageGUID]}if(u["Processed"])l++}}}}else{for(let e=0;e<t.seriesIndexData.length;e++){const n=t.seriesIndexData[e];if(!["stitchNonePseudoSeries"].includes(n)){if(t.seriesInputIds.includes(e)){const e=t.selectedStudy.Series.StructureData[n];const o=e["pseudoserie"]===true?e.KeyImages:e.Images;u+=o.IndexData.length;for(let n=0;n<o.IndexData.length;n++){const s=o.IndexData[n];let u=o.StructureData[s];if(e["pseudoserie"]===true){var c=this.plugin.GetSeriesGuidFromImageGuid(t.studyGuid,u.Images[0].ImageGUID);u=this.plugin.Controller.StudyViewerModel.Documents.StructureData[t.studyGuid].Study.Series.StructureData[c].Images.StructureData[u.Images[0].ImageGUID]}if(u["Processed"])l++}}}}}break}clearTimeout(this.checkLoadingImages);if(l<u){this.printButton.disabled=true;this.paginationController.style.display="none";this.zoneElement.innerHTML="All required images are still not downloaded ("+l+" out of "+u+"). Please wait until they are available.";this.checkLoadingImages=setTimeout((()=>{this.checkIfAllAvailable(e,t,n,o,s)}),1e3)}else{this.paginationController.style.display="block";this.printButton.disabled=false;clearTimeout(this.checkLoadingImages);o()}}updateSVGPreviewCurrentSeries(e,o,s){this.zoneElement.innerHTML="";this.pdfPreview=new t.PdfReporter(e,o,20);this.currentPreviewPage=1;const l=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(!l.Context.ImageEntity)return;const u=l.Context.StudyGuid;const c=this.plugin.Controller.StudyViewerModel.Documents.StructureData[u].Study;const d=c.Series.StructureData[l.Context.SeriesGuid];const m=d["pseudoserie"]===true?d.KeyImages:d.Images;const S=this.getNumberList(this.inputSeries.value).map((e=>e-1));this.checkIfAllAvailable(u,m,"series",(()=>{var e,t,o,l,c,C,p,A;if(this.inputSeries.value===""){for(let c=0;c<m.IndexData.length;c++){const S=m.IndexData[c];let C=m.StructureData[S];if(C["bufferArray"]!==null&&C["bufferArray"]!==undefined){if(c===0){const{patientName:e,practitioner:t,studyDescription:n,dob:o,studyDate:s}=this.getDicomInfo(C,u);this.pdfPreview.AddHeaderPreview(`Patient Name: ${e} - DOB: ${o} - Practitioner: ${t}\nStudy description: ${n} (${s})`)}let o=C["bufferArray"];for(let l=0;l<o.length;l++){const o=(e=C["dicomTags"][P])!==null&&e!==void 0?e:G;const l=(t=C["dicomTags"][v])!==null&&t!==void 0?t:L;this.pdfPreview.AddImagePreview(null,new n.Size(o,l),s)}}else{if(d["pseudoserie"]===true){var f=this.plugin.GetSeriesGuidFromImageGuid(u,C.Images[0].ImageGUID);C=this.plugin.Controller.StudyViewerModel.Documents.StructureData[u].Study.Series.StructureData[f].Images.StructureData[C.Images[0].ImageGUID]}if(c===0){const{patientName:e,practitioner:t,studyDescription:n,dob:o,studyDate:s}=this.getDicomInfo(C,u);this.pdfPreview.AddHeaderPreview(`Patient Name: ${e} - DOB: ${o} - Practitioner: ${t}\nStudy description: ${n} (${s})`)}const e=(o=C["dicomTags"][P])!==null&&o!==void 0?o:G;const t=(l=C["dicomTags"][v])!==null&&l!==void 0?l:L;this.pdfPreview.AddImagePreview(null,new n.Size(e,t),s)}}}else{let e=0;for(let t=0;t<m.IndexData.length;t++){const o=m.IndexData[t];let l=m.StructureData[o];if(l["bufferArray"]!==null&&l["bufferArray"]!==undefined){if(e++===0){const{patientName:e,practitioner:t,studyDescription:n,dob:o,studyDate:s}=this.getDicomInfo(l,u);this.pdfPreview.AddHeaderPreview(`Patient Name: ${e} - DOB: ${o} - Practitioner: ${t}\nStudy description: ${n} (${s})`)}let t=l["bufferArray"];for(let e=0;e<t.length;e++){if(S.includes(e)){const e=(c=l["dicomTags"][P])!==null&&c!==void 0?c:G;const t=(C=l["dicomTags"][v])!==null&&C!==void 0?C:L;this.pdfPreview.AddImagePreview(null,new n.Size(e,t),s)}}}else{if(S.includes(t)){if(d["pseudoserie"]===true){var f=this.plugin.GetSeriesGuidFromImageGuid(u,l.Images[0].ImageGUID);l=this.plugin.Controller.StudyViewerModel.Documents.StructureData[u].Study.Series.StructureData[f].Images.StructureData[l.Images[0].ImageGUID]}if(e++===0){const{patientName:e,practitioner:t,studyDescription:n,dob:o,studyDate:s}=this.getDicomInfo(l,u);this.pdfPreview.AddHeaderPreview(`Patient Name: ${e} - DOB: ${o} - Practitioner: ${t}\nStudy description: ${n} (${s})`)}const t=(p=l["dicomTags"][P])!==null&&p!==void 0?p:G;const o=(A=l["dicomTags"][v])!==null&&A!==void 0?A:L;this.pdfPreview.AddImagePreview(null,new n.Size(t,o),s)}}}}this.previewPaginationElement.innerHTML=` ${this.currentPreviewPage} / ${this.pdfPreview.GetPageCount()} `;this.zoneElement.innerHTML=this.pdfPreview.GetPagePreview(0)}),d["pseudoserie"])}getFirstAvailableViewport(){for(let e=0;e<this.plugin.Controller.ViewportPane.ViewportsArray.length;e++){const t=this.plugin.Controller.ViewportPane.ViewportsArray[e];if(t===null||t===void 0?void 0:t.Context.ImageEntity)return t}return null}updateSVGPreviewCurrentStudy(e,o,s){this.zoneElement.innerHTML="";this.pdfPreview=new t.PdfReporter(e,o,20);this.currentPreviewPage=1;let l=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(!l.Context.ImageEntity){l=this.getFirstAvailableViewport();if(!l)return}const u=l.Context.StudyGuid;let c=this.plugin.Controller.StudyViewerModel.Documents.StructureData[u].Study;let d;const m=this.getNumberList(this.inputSeries.value).map((e=>e-1));const S=c.Series.IndexData;this.checkIfAllAvailable(u,{seriesIndexData:S,selectedStudy:c,studyGuid:u,seriesInputIds:m},"study",(()=>{var e,t,o,l;if(this.inputSeries.value===""){for(d=0;d<S.length;d++){const o=S[d];if(!["stitchNonePseudoSeries"].includes(o)){const l=c.Series.StructureData[o];const m=l["pseudoserie"]===true?l.KeyImages:l.Images;for(let o=0;o<m.IndexData.length;o++){const c=m.IndexData[o];let S=m.StructureData[c];if(S["bufferArray"]!==null&&S["bufferArray"]!==undefined){if(d===0){const{patientName:e,practitioner:t,studyDescription:n,dob:o,studyDate:s}=this.getDicomInfo(S,u);this.pdfPreview.AddHeaderPreview(`Patient Name: ${e} - DOB: ${o} - Practitioner: ${t}\nStudy description: ${n} (${s})`)}let o=S["bufferArray"];for(let l=0;l<o.length;l++){const o=(e=S["dicomTags"][P])!==null&&e!==void 0?e:G;const l=(t=S["dicomTags"][v])!==null&&t!==void 0?t:L;this.pdfPreview.AddImagePreview(null,new n.Size(o,l),s)}}else{if(l["pseudoserie"]===true){var C=this.plugin.GetSeriesGuidFromImageGuid(u,S.Images[0].ImageGUID);S=this.plugin.Controller.StudyViewerModel.Documents.StructureData[u].Study.Series.StructureData[C].Images.StructureData[S.Images[0].ImageGUID]}if(d===0&&o===0){const{patientName:e,practitioner:t,studyDescription:n,dob:o,studyDate:s}=this.getDicomInfo(S,u);this.pdfPreview.AddHeaderPreview(`Patient Name: ${e} - DOB: ${o} - Practitioner: ${t}\nStudy description: ${n} (${s})`)}const e=this.getDicomImageDimensions(S);this.pdfPreview.AddImagePreview(null,e,s)}}}}}else{let e=0;for(d=0;d<S.length;d++){const t=S[d];if(!["stitchNonePseudoSeries"].includes(t)){if(m.includes(d)){const d=c.Series.StructureData[t];const m=d["pseudoserie"]===true?d.KeyImages:d.Images;for(let t=0;t<m.IndexData.length;t++){const c=m.IndexData[t];let S=m.StructureData[c];if(S["bufferArray"]!==null&&S["bufferArray"]!==undefined){if(e++===0){const{patientName:e,practitioner:t,studyDescription:n,dob:o,studyDate:s}=this.getDicomInfo(S,u);this.pdfPreview.AddHeaderPreview(`Patient Name: ${e} - DOB: ${o} - Practitioner: ${t}\nStudy description: ${n} (${s})`)}let t=S["bufferArray"];for(let e=0;e<t.length;e++){const e=(o=S["dicomTags"][P])!==null&&o!==void 0?o:G;const t=(l=S["dicomTags"][v])!==null&&l!==void 0?l:L;const u=new n.Size(e,t);this.pdfPreview.AddImagePreview(null,u,s)}}else{if(d["pseudoserie"]===true){var C=this.plugin.GetSeriesGuidFromImageGuid(u,S.Images[0].ImageGUID);S=this.plugin.Controller.StudyViewerModel.Documents.StructureData[u].Study.Series.StructureData[C].Images.StructureData[S.Images[0].ImageGUID]}const t=this.getDicomImageDimensions(S);if(e++===0){const{patientName:e,practitioner:t,studyDescription:n,dob:o,studyDate:s}=this.getDicomInfo(S,u);this.pdfPreview.AddHeaderPreview(`Patient Name: ${e} - DOB: ${o} - Practitioner: ${t}\nStudy description: ${n} (${s})`)}this.pdfPreview.AddImagePreview(null,t,s)}}}}}}this.previewPaginationElement.innerHTML=` ${this.currentPreviewPage} / ${this.pdfPreview.GetPageCount()} `;this.zoneElement.innerHTML=this.pdfPreview.GetPagePreview(0)}))}getDicomInfo(e,t){var o,s,l;let u=e?(o=e["dicomTags"]?e["dicomTags"][T]:"")!==null&&o!==void 0?o:"":"";let c=e?(e["dicomTags"]?e["dicomTags"][V]:"")||"":"";let d=e?(s=e["dicomTags"]?e["dicomTags"][R]:"")!==null&&s!==void 0?s:"":"";let m=e?e["dicomTags"]?e["dicomTags"][E]:"":"";let S=e?e["dicomTags"]?e["dicomTags"][M]:"":"";const C=this.plugin.Controller.ImagingStudyFhirEntities[t];if(u===""){try{u=C["subject"]["name"][0]["text"]}catch(e){u=""}}if(m===""){try{m=C["subject"]["birthDate"].split("-").join("")}catch(e){m=""}}if(S===""){try{S=C["started"].split("-").join("")}catch(e){S=""}}if(d===""){try{d=C["description"]}catch(e){d=""}}if(c===""){try{c=(l=C["referrer"]["display"])!==null&&l!==void 0?l:C["referrer"]["name"][0]["text"]}catch(e){c=""}}return{patientName:n.Utils.FormatValue(u),practitioner:n.Utils.FormatValue(c),studyDescription:d?d:"",dob:m?n.Utils.FormatDateFromDicomTag(m):"",studyDate:S?n.Utils.FormatDateFromDicomTag(S):""}}getDicomImageDimensions(e){var t,o;const s=e?(t=e["dicomTags"]?+e["dicomTags"][P]:G)!==null&&t!==void 0?t:G:G;const l=e?(o=e["dicomTags"]?+e["dicomTags"][v]:L)!==null&&o!==void 0?o:L:L;return new n.Size(s,l)}isValidInput(){if(this.inputSeries.value==="")return true;if(this.inputSeries){const e=this.getNumberList(this.inputSeries.value);for(let t=0;t<e.length;t++){if(isNaN(+e[t])){alert("You have entered an invalid series number for this study: "+e[t]);return false}else{const n=this.getSeriesImagesCount();if(+e[t]<=0){alert("You have entered an invalid series number for this study: "+e[t]);return false}else if(+e[t]>n){alert("You have entered an invalid series number for this study: "+e[t]);return false}}}return true}alert("You have entered an invalid series number for this study");return false}isValidInputImages(){if(this.inputSeries.value==="")return true;if(this.inputSeries){const e=this.getNumberList(this.inputSeries.value);for(let t=0;t<e.length;t++){if(isNaN(+e[t])){alert("You have entered an invalid image number for this series: "+e[t]);return false}else{const n=this.getSeriesImagesCountBySeries();if(+e[t]<=0){alert("You have entered an invalid image number for this series: "+e[t]);return false}else if(+e[t]>n){alert("You have entered an invalid image number for this series: "+e[t]);return false}}}return true}alert("You have entered an invalid image number for this study");return false}downloadPDF(){switch(this.selectedTargetType){case N.CURRENT_IMAGE:this.downloadCurrentImage();this.Hide();break;case N.CURRENT_SERIES:if(this.isValidInputImages()){const e=this.getNumberList(this.inputSeries.value).map((e=>e-1));this.downloadSeriesImages(e);this.Hide()}break;case N.CURRENT_STUDY:if(this.isValidInput()){const e=this.getNumberList(this.inputSeries.value).map((e=>e-1));this.downloadImagesStudy(e);this.Hide()}break;default:this.downloadCurrentImage();this.Hide()}n.LocalStorage.Set("dicomPrintPaperOpt",this.selectedPaperOpt.value);n.LocalStorage.Set("dicomPrintOrientation",B[this.selectedOrientation]);n.LocalStorage.Set("dicomPrintColsNumber",this.selectedColsNumber)}downloadCurrentImage(){const e=this.selectedOrientation===B.PORTRAIT;const o=new t.PdfReporter(this.selectedPaperOpt.label,e,20);const s=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);const l=s.Context.ImageEntity;if(!l)return;const u=this.isImageEntityCalibrated(l);const{patientName:c,practitioner:d,studyDescription:m,dob:S,studyDate:C}=this.getDicomInfo(l,s.Context.StudyGuid);const p=this.selectedScaleValue?this.selectedScaleValue/100:null;o.AddHeader(`Patient Name: ${c} - DOB: ${S} - Practitioner: ${d}\nStudy description: ${m} (${C})`);const A=o.GetImageViewportSize(l,1,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);if(s){if(s.Context.ImageEntity&&!this.plugin.IsSRDicom(s.Context.ImageEntity)){const{StudyGuid:e,SeriesGuid:t,SeriesIndex:l,ImageIndex:u,ImageSubIndex:c,ImageEntity:{ImageGUID:d}}=s.Context;const S=o.RenderImageOnBuffer(this.plugin,e,t,d,A.renderSize,A.originaImageSize,l,u,c,p,this.pdfPreview.ScaledImageOffset,this.selectedPaperOpt,this.selectedOrientation);S.then((e=>{if(this.selectedScaleType===O.SCALE_TO_FIT){o.AddImage(e,A.renderSize,1)}else{let t=o.GetPrintSize(A.renderSize,p);o.AddImage(e,t,1,p,this.pdfPreview.ScaledImageOffset)}const t=n.Utils.StringToFilename(`study-${m}`);o.Download(t)}))}else{console.warn("This image belongs to a SR or image not found")}}}downloadSeriesImages(e){return __awaiter(this,void 0,void 0,(function*(){const o=new t.PdfReporter(this.selectedPaperOpt.label,this.selectedOrientation===B.PORTRAIT,20);const s=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);const l=s.Context.StudyGuid;if(!l)return;const u=s.Context.SeriesIndex;const c=this.plugin.Controller.StudyViewerModel.Documents.StructureData[l].Study;const d=c.Series.StructureData[s.Context.SeriesGuid];const m=d["pseudoserie"]===true?d.KeyImages:d.Images;const{patientName:S,practitioner:C,studyDescription:p,dob:A,studyDate:f}=this.getDicomInfo(s.Context.ImageEntity,l);o.AddHeader(`Patient Name: ${S} - DOB: ${A} - Practitioner: ${C}\nStudy description: ${p} (${f})`);if(e&&e.length){for(let t=0;t<m.IndexData.length;t++){const n=m.IndexData[t];let c=m.StructureData[n];if(c["bufferArray"]!==null&&c["bufferArray"]!==undefined){let l=c["bufferArray"];for(let d=0;d<l.length;d++){if(e.includes(d)){const e=this.isImageEntityCalibrated(c);const{StudyGuid:l,SeriesGuid:m}=s.Context;const S=this.selectedScaleValue?e?this.selectedScaleValue/100:1:null;const C=o.GetImageViewportSize(c,this.selectedColsNumber,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);const p=o.RenderImageOnBuffer(this.plugin,l,m,n,C.renderSize,C.originaImageSize,u,t,d,S,undefined,this.selectedPaperOpt,this.selectedOrientation);yield p.then((e=>{let t=o.GetPrintSize(C.renderSize,1);o.AddImage(e,t,this.selectedColsNumber)}))}}}else{if(e.includes(t)){if(d["pseudoserie"]===true){var I=this.plugin.GetSeriesGuidFromImageGuid(l,c.Images[0].ImageGUID);c=this.plugin.Controller.StudyViewerModel.Documents.StructureData[l].Study.Series.StructureData[I].Images.StructureData[c.Images[0].ImageGUID]}if(!this.plugin.IsSRDicom(c)){const e=this.isImageEntityCalibrated(c);const{StudyGuid:l,SeriesGuid:d}=s.Context;const m=this.selectedScaleValue?e?this.selectedScaleValue/100:1:null;const S=o.GetImageViewportSize(c,this.selectedColsNumber,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);const C=o.RenderImageOnBuffer(this.plugin,l,d,n,S.renderSize,S.originaImageSize,u,t,0,m,undefined,this.selectedPaperOpt,this.selectedOrientation);yield C.then((e=>{let t=o.GetPrintSize(S.renderSize,1);o.AddImage(e,t,this.selectedColsNumber)}))}}}}const t=n.Utils.StringToFilename(`study-${p}`);o.Download(t)}else{for(let e=0;e<m.IndexData.length;e++){const t=m.IndexData[e];let n=m.StructureData[t];if(n["bufferArray"]!==null&&n["bufferArray"]!==undefined){let l=n["bufferArray"];for(let c=0;c<l.length;c++){const l=this.isImageEntityCalibrated(n);const{StudyGuid:d,SeriesGuid:m}=s.Context;const S=this.selectedScaleValue?l?this.selectedScaleValue/100:1:null;const C=o.GetImageViewportSize(n,this.selectedColsNumber,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);const p=o.RenderImageOnBuffer(this.plugin,d,m,t,C.renderSize,C.originaImageSize,u,e,c,S,undefined,this.selectedPaperOpt,this.selectedOrientation);yield p.then((e=>{let t=o.GetPrintSize(C.renderSize,1);o.AddImage(e,t,this.selectedColsNumber)}))}}else{if(d["pseudoserie"]===true){var I=this.plugin.GetSeriesGuidFromImageGuid(l,n.Images[0].ImageGUID);n=this.plugin.Controller.StudyViewerModel.Documents.StructureData[l].Study.Series.StructureData[I].Images.StructureData[n.Images[0].ImageGUID]}if(!this.plugin.IsSRDicom(n)){const l=this.isImageEntityCalibrated(n);const{StudyGuid:c,SeriesGuid:d}=s.Context;const m=this.selectedScaleValue?l?this.selectedScaleValue/100:1:null;const S=o.GetImageViewportSize(n,this.selectedColsNumber,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);const C=o.RenderImageOnBuffer(this.plugin,c,d,t,S.renderSize,S.originaImageSize,u,e,0,m,undefined,this.selectedPaperOpt,this.selectedOrientation);yield C.then((e=>{let t=o.GetPrintSize(S.renderSize,1);o.AddImage(e,t,this.selectedColsNumber)}))}}}const e=n.Utils.StringToFilename(`study-${p}`);o.Download(e)}}))}downloadImagesStudy(e){return __awaiter(this,void 0,void 0,(function*(){const o=new t.PdfReporter(this.selectedPaperOpt.label,this.selectedOrientation===B.PORTRAIT,20);let s=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(!s.Context.ImageEntity){s=this.getFirstAvailableViewport();if(!s)return}const l=s.Context.StudyGuid;let u=this.plugin.Controller.StudyViewerModel.Documents.StructureData[l].Study;let c;if(e&&e.length){const t=u.Series.IndexData;const{patientName:m,practitioner:S,studyDescription:C,dob:p,studyDate:A}=this.getDicomInfo(s.Context.ImageEntity,l);o.AddHeader(`Patient Name: ${m} - DOB: ${p} - Practitioner: ${S}\nStudy description: ${C} (${A})`);for(c=0;c<t.length;c++){if(!["stitchNonePseudoSeries"].includes(t[c])){if(e.includes(c)){const e=t[c];u=this.plugin.Controller.StudyViewerModel.Documents.StructureData[l].Study;const n=u.Series.StructureData[e];const s=n["pseudoserie"]===true?n.KeyImages:n.Images;for(let t=0;t<s.IndexData.length;t++){const u=s.IndexData[t];let m=s.StructureData[u];if(m["bufferArray"]!==null&&m["bufferArray"]!==undefined){let n=m["bufferArray"];for(let s=0;s<n.length;s++){const n=this.isImageEntityCalibrated(m);const d=this.selectedScaleValue?n?this.selectedScaleValue/100:1:null;const S=o.GetImageViewportSize(m,this.selectedColsNumber,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);const C=o.RenderImageOnBuffer(this.plugin,l,e,u,S.renderSize,S.originaImageSize,c,t,s,d,undefined,this.selectedPaperOpt,this.selectedOrientation);yield C.then((e=>{let t=o.GetPrintSize(S.renderSize,1);o.AddImage(e,t,this.selectedColsNumber)}))}}else{if(n["pseudoserie"]===true){var d=this.plugin.GetSeriesGuidFromImageGuid(l,m.Images[0].ImageGUID);m=this.plugin.Controller.StudyViewerModel.Documents.StructureData[l].Study.Series.StructureData[d].Images.StructureData[m.Images[0].ImageGUID]}if(!this.plugin.IsSRDicom(m)){const n=this.isImageEntityCalibrated(m);const s=this.selectedScaleValue?n?this.selectedScaleValue/100:1:null;const d=o.GetImageViewportSize(m,this.selectedColsNumber,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);const S=o.RenderImageOnBuffer(this.plugin,l,e,u,d.renderSize,d.originaImageSize,c,t,0,s,undefined,this.selectedPaperOpt,this.selectedOrientation);yield S.then((e=>{let t=o.GetPrintSize(d.renderSize,1);o.AddImage(e,t,this.selectedColsNumber)}))}}}}}}const f=n.Utils.StringToFilename(`study-${C}`);o.Download(f)}else{const e=u.Series.IndexData;const{patientName:t,practitioner:m,studyDescription:S,dob:C,studyDate:p}=this.getDicomInfo(s.Context.ImageEntity,l);o.AddHeader(`Patient Name: ${t} - DOB: ${C} - Practitioner: ${m}\nStudy description: ${S} (${p})`);for(c=0;c<e.length;c++){const t=e[c];if(!["stitchNonePseudoSeries"].includes(t)){u=this.plugin.Controller.StudyViewerModel.Documents.StructureData[l].Study;const e=u.Series.StructureData[t];const n=e["pseudoserie"]===true?e.KeyImages:e.Images;for(let s=0;s<n.IndexData.length;s++){const u=n.IndexData[s];let m=n.StructureData[u];if(m["bufferArray"]!==null&&m["bufferArray"]!==undefined){let e=m["bufferArray"];for(let n=0;n<e.length;n++){const e=this.isImageEntityCalibrated(m);const d=this.selectedScaleValue?e?this.selectedScaleValue/100:1:null;const S=o.GetImageViewportSize(m,this.selectedColsNumber,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);const C=o.RenderImageOnBuffer(this.plugin,l,t,u,S.renderSize,S.originaImageSize,c,s,n,d,undefined,this.selectedPaperOpt,this.selectedOrientation);yield C.then((e=>{let t=o.GetPrintSize(S.renderSize,1);o.AddImage(e,t,this.selectedColsNumber)}))}}else{if(e["pseudoserie"]===true){var d=this.plugin.GetSeriesGuidFromImageGuid(l,m.Images[0].ImageGUID);m=this.plugin.Controller.StudyViewerModel.Documents.StructureData[l].Study.Series.StructureData[d].Images.StructureData[m.Images[0].ImageGUID]}if(!this.plugin.IsSRDicom(m)){const e=this.isImageEntityCalibrated(m);const n=this.selectedScaleValue?e?this.selectedScaleValue/100:1:null;const d=o.GetImageViewportSize(m,this.selectedColsNumber,this.selectedScaleType!==O.SCALE_TO_FIT,this.pdfPreview.ScaledImageOffset);const S=o.RenderImageOnBuffer(this.plugin,l,t,u,d.renderSize,d.originaImageSize,c,s,0,n,undefined,this.selectedPaperOpt,this.selectedOrientation);yield S.then((e=>{let t=o.GetPrintSize(d.renderSize,1);o.AddImage(e,t,this.selectedColsNumber)}))}}}}}const A=n.Utils.StringToFilename(`study-${S}`);o.Download(A)}}))}getSeriesImagesCount(){const e=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);const t=e.Context.StudyGuid;const n=this.plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study;const o=n.Series.IndexData;let s=o.length;return s}getSeriesImagesCountBySeries(){try{const e=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);const t=e.Context.StudyGuid;const n=this.plugin.Controller.StudyViewerModel.Documents.StructureData[t].Study;const o=n.Series.StructureData[e.Context.SeriesGuid].Images;return o.IndexData.length}catch(e){return 0}}checkInputSeries(e){if(!"1234567890-, ".includes(e.key)){const t=e.target;const o=t.value;if(o.length>20){t.value=o.slice(0,20)}e.preventDefault();if(e.key===n.Utils.INPUTKEY_NAMES.ENTER){if(t.value!==""){const e=this.getSeriesImagesCount();const n=t.value.split(",").map((e=>+e));for(let t=0;t<n.length;t++){if(n[t]<1||n[t]>e){alert("You have entered an invalid series number for this study: "+n[t]);return}}}return true}return false}return true}checkInputImages(e){if(!"1234567890-, ".includes(e.key)){const t=e.target;const o=t.value;if(o.length>20)t.value=o.slice(0,20);e.preventDefault();if([n.Utils.INPUTKEY_NAMES.ENTER,n.Utils.INPUTKEY_NAMES.BACKSPACE].includes(e.key)){if(t.value!==""){const e=this.getSeriesImagesCountBySeries();const n=t.value.split(",").map((e=>+e));for(let t=0;t<n.length;t++){if(n[t]<1||n[t]>e){alert("You have entered an invalid image number for this series: "+n[t]);return false}}}return true}return false}return true}getNumberList(e){const t=[];if(e.slice(-1)==="-")e=e.slice(0,-1);const n=e.split(",");for(let e=0;e<n.length;e++){if(n[e].length===0)continue;if(n[e].indexOf("-")>=0){const o=/[ ]*([1-9][0-9]{0,3})[ ]*-[ ]*([1-9][0-9]{0,3})[ ]*/;const s=n[e].match(o);if(!s){return null}const l=parseInt(s[1]);const u=parseInt(s[2]);if(l>u)return null;for(let e=l;e<=u;e++){t.push(e)}}else{t.push(parseInt(n[e]))}}return t}triggerDrawPageSetup(e){const t=e.value;if(+t>=10&&+t<=200){this.selectedScaleValue=+e.value;this.drawPageSetup()}else if(+t>200){e.value="200";this.selectedScaleValue=+e.value;this.drawPageSetup()}}checkInputScale(e){const t=e.target;if(!"1234567890".includes(e.key)){e.preventDefault();if(e.key===n.Utils.INPUTKEY_NAMES.ENTER){this.selectedScaleValue=+t.value;this.drawPageSetup()}if(e.key===n.Utils.INPUTKEY_NAMES.BACKSPACE){this.triggerDrawPageSetup(t)}return false}else{this.triggerDrawPageSetup(t)}}checkInputNumber(e){const t=e.target.value;const n=t.lastIndexOf(",");const o=+t.substring(n+1);if(o===0&&e.key===",")return false;return true}buildTargetSection(){const e=[{id:1,label:"Current Image",value:N.CURRENT_IMAGE,checked:this.selectedTargetType===N.CURRENT_IMAGE},{id:2,label:"Current Series",value:N.CURRENT_SERIES,checked:this.selectedTargetType===N.CURRENT_SERIES},{id:3,label:"Current Study",value:N.CURRENT_STUDY,checked:this.selectedTargetType===N.CURRENT_STUDY}];return o({className:"flex-v panel",style:{width:"35%"},children:[l({innerHTML:"Target"}),u({children:e.map((e=>c({children:[d({type:"radio",name:"target",value:e.id,id:`option-target-${e.id}`,checked:e.checked||false,onchange:t=>{this.selectedTargetType=e.value;if(e.value===0)this.selectedColsNumber=1;this.updateScaleSection(e.value);this.drawPageSetup()}}),m({innerHTML:e.label,htmlFor:`option-target-${e.id}`})]})))})]})}buildScaleSectionElements(){let e;let t;const s=n.Utils.CreateDebouncer();this.printButton=this.buildPrintButton();if(!n.DOMUtils.IsGoogleChrome()){this.printButton.style.marginTop="unset"}return[l({innerHTML:"Scale"}),o({className:"form",children:[u({style:{margin:0,padding:0,listStyle:"none"},children:[c({children:[d({type:"radio",name:"scale",value:"1",id:"option-scale-1",checked:true,onchange:()=>{this.selectedScaleType=1;this.drawPageSetup()}}),m({innerHTML:"Scale to fit",htmlFor:"option-scale-1"})]}),c({children:[d({type:"radio",name:"scale",value:"2",id:"option-scale-2",onchange:()=>{this.selectedScaleType=2;if(this.selectedScaleValue)this.drawPageSetup()}}),e=m({innerHTML:"Scale: ",htmlFor:"option-scale-2",onclick:()=>{t.focus();t.click()}}),t=d({type:"text",style:{marginLeft:"5px",width:"50px"},maxlength:3,onkeyup:e=>{s((()=>{console.log("debounced!");this.checkInputScale(e)}),500)},onfocus:t=>{e.click()},onkeydown:e=>{if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(e.key)){e.stopPropagation()}else{const t=e.target.value;const n=t.lastIndexOf(",");const o=+t.substring(n+1);if(o===0&&e.key===",")e.stopPropagation()}}}),p({innerHTML:" %"})]})]}),this.textCalibratedElement=o({className:"text-red",style:{visibility:"hidden",fontWeight:"bold",marginBottom:"8px",color:"#ff503e"},innerHTML:"Image is not calibrated"}),this.buildInfoForPrint(),this.printButton]})]}buildPrintButton(){return A({type:"button",className:"green inline btn-generate-pdf",innerHTML:n.DOMUtils.IsGoogleChrome()?"Open Print Dialog":"Open Printable PDF",onclick:()=>{this.downloadPDF()}})}buildInfoForPrint(){if(n.DOMUtils.IsGoogleChrome()){return o({})}else{const e=I({className:"hover-info",src:t.ResourceBag.UnlockPopupWindowPng});const n=s({href:"#",innerHTML:"&#9432;",className:"info-link"});n.addEventListener("mouseover",(()=>{e.classList.add("show")}));n.addEventListener("mouseout",(()=>{e.classList.remove("show")}));return o({style:{position:"relative",marginTop:"auto"},children:[f({style:{fontSize:"13px"},children:[D("If you cannot open the printable document, be sure to unblock popup windows in your browser."),n]}),e]})}}buildScaleSectionImagesPerRow(){return c({children:[m({innerHTML:"Images per row:",htmlFor:"txt-images-per-row"}),S({children:[1,2,3,4].map((e=>C({value:e,innerHTML:e,selected:e===this.selectedColsNumber}))),onchange:e=>{this.selectedColsNumber=+e.target.value;this.drawPageSetup()}})]})}buildScaleSectionSeries(){const e=n.Utils.CreateDebouncer();this.inputSeries=d({id:"txt-series",type:"text",placeholder:"Ex: 1, 2, 3",onkeypress:t=>{if(this.checkInputNumber(t)){if(this.checkInputSeries(t))e((()=>{this.drawPageSetup()}),500)}}});const keydownCallback=e=>{if([n.Utils.INPUTKEY_NAMES.ENTER,n.Utils.INPUTKEY_NAMES.BACKSPACE].includes(e.key)){this.drawPageSetup()}};n.DOMUtils.ForcePagesNumeration(this.inputSeries,keydownCallback);return c({children:[m({innerHTML:"Series: ",htmlFor:"txt-series"}),this.inputSeries]})}buildScaleSectionImages(){const e=n.Utils.CreateDebouncer();this.inputSeries=d({id:"txt-images",type:"text",placeholder:"Ex: 1, 2, 3",onkeypress:t=>{if(this.checkInputImages(t))e((()=>{this.drawPageSetup()}),500)}});const keydownCallback=e=>{if([n.Utils.INPUTKEY_NAMES.ENTER,n.Utils.INPUTKEY_NAMES.BACKSPACE].includes(e.key)){this.drawPageSetup()}};n.DOMUtils.ForcePagesNumeration(this.inputSeries,keydownCallback);return c({children:[m({innerHTML:"Images: ",htmlFor:"txt-images"}),this.inputSeries]})}buildScaleSectionLayout(e){this.printButton=this.buildPrintButton();if(!n.DOMUtils.IsGoogleChrome()){this.printButton.style.marginTop="unset"}return[l({innerHTML:"Layout"}),o({className:"form",children:[u({children:e}),this.buildInfoForPrint(),this.printButton]})]}buildScaleSection(){if(this.selectedTargetType===N.CURRENT_IMAGE){return o({style:{width:"35%",height:"100%"},className:"flex-v panel",children:this.buildScaleSectionElements()})}else{const e=[this.buildScaleSectionImagesPerRow()];if(this.selectedTargetType===N.CURRENT_SERIES)e.push(this.buildScaleSectionImages());if(this.selectedTargetType===N.CURRENT_STUDY)e.push(this.buildScaleSectionSeries());return o({style:{width:"35%",height:"100%"},className:"flex-v panel",children:this.buildScaleSectionLayout(e)})}}updateScaleSection(e){this.scaleSection.innerHTML="";this.inputSeries=null;if(e===N.CURRENT_IMAGE){n.DOMUtils.SetOptions(this.scaleSection,{children:this.buildScaleSectionElements()})}else{const t=[this.buildScaleSectionImagesPerRow()];if(e===N.CURRENT_SERIES)t.push(this.buildScaleSectionImages());if(e===N.CURRENT_STUDY)t.push(this.buildScaleSectionSeries());n.DOMUtils.SetOptions(this.scaleSection,{children:this.buildScaleSectionLayout(t)})}}buildPreviewSection(){var e;return o({className:"flex-v panel",style:{width:"65%",height:"100%"},children:[o({className:"paper-preview",children:[this.zoneElement=o({className:"zone"}),this.paginationController=o({className:"pagination",children:[s({innerHTML:"&#9664;",style:{cursor:"pointer"},onclick:()=>{this.goToPreviousPage()}}),this.previewPaginationElement=p({innerHTML:` ${this.currentPreviewPage} / ${((e=this.pdfPreview)===null||e===void 0?void 0:e.GetPageCount())||"?"} `}),s({style:{cursor:"pointer"},innerHTML:"&#9654;",onclick:()=>{this.goToNextPage()}})]})]})]})}goToPreviousPage(){if(this.currentPreviewPage>1)this.currentPreviewPage--;this.previewPaginationElement.innerHTML=` ${this.currentPreviewPage} / ${this.pdfPreview.GetPageCount()} `;this.zoneElement.innerHTML=this.pdfPreview.GetPagePreview(this.currentPreviewPage-1)}goToNextPage(){if(this.currentPreviewPage<this.pdfPreview.GetPageCount())this.currentPreviewPage++;this.previewPaginationElement.innerHTML=` ${this.currentPreviewPage} / ${this.pdfPreview.GetPageCount()} `;this.zoneElement.innerHTML=this.pdfPreview.GetPagePreview(this.currentPreviewPage-1)}buildPaperSection(){return o({className:"flex-v panel",style:{width:"65%"},children:[l({innerHTML:"Paper"}),o({className:"form",children:[u({children:[c({children:[m({innerHTML:"Size: "}),S({children:F.map((e=>C({value:e.value,innerHTML:e.label,selected:e.value===this.selectedPaperOpt.value}))),onchange:e=>{const t=e.target.value;this.selectedPaperOpt=F.find((e=>e.value===t));this.drawPageSetup()}})]}),c({className:"flex-h",children:[m({innerHTML:"Orientation: "}),o({style:{display:"inline-flex",rowGap:"0.5em",flexWrap:"wrap",columnGap:"1em"},children:[d({type:"radio",name:"paperSize",value:B.PORTRAIT,id:"radio-orientation-1",checked:this.selectedOrientation===B.PORTRAIT,onchange:()=>{this.selectedOrientation=B.PORTRAIT;this.drawPageSetup()}}),m({innerHTML:"Portrait",htmlFor:"radio-orientation-1"}),d({type:"radio",name:"paperSize",value:B.LANDSCAPE,id:"radio-orientation-2",checked:this.selectedOrientation===B.LANDSCAPE,onchange:()=>{this.selectedOrientation=B.LANDSCAPE;this.drawPageSetup()}}),m({style:{marginLeft:"1em"},innerHTML:"Landscape",htmlFor:"radio-orientation-2"})]})]})]})]})]})}addResizeListener(){const e="has-print-dialog-resize-listener";if(!document.documentElement.hasAttribute(e)){document.documentElement.setAttribute(e,"true");window.addEventListener("resize",(()=>{const e=(document.documentElement.clientWidth-this.Element.clientWidth)/2;const t=(document.documentElement.clientHeight-this.Element.clientHeight)/2;this.Element.style.left=`${e}px`;this.Element.style.top=`${t}px`}))}}drawPageSetup(){const e=this.selectedOrientation===B.PORTRAIT;this.updateSVGPreview(this.selectedPaperOpt.label,e,this.selectedColsNumber)}isImageEntityCalibrated(e){if(!e||e&&Object.keys(e).length===0)return false;if(e.IsCalibrated())return true;const t=e["pixelSpacing"][2];return t==="mm"}getEntityCalibration(e){const t=this.getDicomImageDimensions(e);const n=e?e["pixelSpacing"]?e["pixelSpacing"][0]:1:1;const o=t.Width*n*(72/25.4);const s=t.Height*n*(72/25.4);return{pixelSpacing:n,calibratedWidth:o,calibratedHeight:s}}getImageUri(t,o,s,l,u,c,d){return __awaiter(this,void 0,void 0,(function*(){const m=document.createElement("div");const S=n.Utils.GetGuid();const C=new e.Products.DicomPlugin.DicomViewport(m,S,null,this.plugin.Controller,null,this.plugin);C.CreateWithoutEvents=true;C.Create(0);C.ViewportElement.setAttribute("height",l.Height+"px");C.ViewportElement.setAttribute("width",l.Width+"px");C.ViewportFrameElement.style.width=`${l.Width}px`;C.ViewportFrameElement.style.height=`${l.Height}px`;let p=yield this.plugin.SetImageToViewportLight(t,o,s,u,c,d,C,null,null,null,false,false);const A=C.ViewportElement;C.Dispose();Efferent.Frontend.WebClient.DOMUtils.RemoveItem(m);return A.toDataURL("image/jpeg",1)}))}}t.PrintDialog=PrintDialog})(n=t.DicomPlugin||(t.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.ClientViews.ImagingStudyView;class PseudoSerieStudy{constructor(e,t){this.keyImagesInStudyLoad={};this.Plugin=e;this.pseudoSeriesGuid=t}GetIndexPseudoSerieKeyImage(e){var t=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series;for(var n=0;n<t.IndexData.length;n++){if(t.IndexData[n]===this.pseudoSeriesGuid)return n}return-1}DeleteKeyImageFromPseudoSeries(e){var t=this.Plugin.Controller.GetSelectViewport(this.Plugin.Controller.ViewportPane);if(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid]!==null){if(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid].KeyImages.IndexData.length===1){this.Plugin.Controller.ThumbnailPane.RemoveThumbnailPseudoSeries(t.Context.StudyGuid,t.Context.SeriesGuid);delete this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid];this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.IndexData.splice(this.GetIndexPseudoSerieKeyImage(t.Context.StudyGuid),1);t.Context.IsPseudoSeries=false;if(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.IndexData.length===1)this.Plugin.Controller.ToogleLinkTool(false);t.Reset();t.Clear();this.Plugin.Controller.View.ShowToolbarButtonsBySupportViewport(this.Plugin.Controller.View.Platform.Toolbar,t);Efferent.Frontend.WebClient.Toolbar.UnBlockAndBlockButtons(this.Plugin.Controller.View.Platform.Toolbar.Groups,true,["back","home"])}else{var n=-1;var o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid].KeyImages;for(var s=0;s<o.IndexData.length;s++){if(o.IndexData[s]===e){n=s;break}}this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid].KeyImages.IndexData.splice(n,1);delete this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid].KeyImages.StructureData[e];this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid].ImageCount=o.IndexData.length;var l=this.GetIndexThumbnailStudy(t.Context.StudyGuid);var u=this.Plugin.Controller.ThumbnailPane.Thumbnails[t.Context.StudyGuid][l-1];u.Element.setAttribute("data-totalImagesLoaded",this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid].ImageCount.toString());u.Element.setAttribute("data-totalImages",this.Plugin.Controller.StudyViewerModel.Documents.StructureData[t.Context.StudyGuid].Study.Series.StructureData[this.pseudoSeriesGuid].ImageCount.toString());u.StartProgressRing();t.SetImageInViewport(0)}}this.UpdateViewportsPseudoSeries();this.Plugin.Controller.ThumbnailPane.HideSubThumbanilPaneFromStudyAndSerieGuid(t.Context.StudyGuid,this.pseudoSeriesGuid);for(var c=0;c<this.Plugin.Controller.View.Plugins.length;c++)this.Plugin.Controller.View.Plugins[c].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,true)}AddKeyImageToPseudoSeries(e,t){if(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid]===null||this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid]===undefined){var n=new Array;n.push(t);this.CreatePseudoSeries(e,n)}else{var o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid];o.ImageCount++;o.KeyImages.StructureData[t.KeyImageID]=t;o.KeyImages.IndexData.push(t.KeyImageID)}var s=this.GetIndexThumbnailStudy(e);var l=this.Plugin.Controller.ThumbnailPane.Thumbnails[e][s-1];l.Element.setAttribute("data-totalImagesLoaded",this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid].ImageCount.toString());l.Element.setAttribute("data-totalImages",this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid].ImageCount.toString());l.StartProgressRing();this.Plugin.SetSeriesToViewport(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.StudyGUID,this.pseudoSeriesGuid,t.KeyImageID,this.GetIndexPseudoSerieKeyImage(e),0);this.UpdateViewportsPseudoSeries();this.Plugin.Controller.ThumbnailPane.HideSubThumbanilPaneFromStudyAndSerieGuid(e,this.pseudoSeriesGuid);var u=this.Plugin.GetSeriesGuidFromImageGuid(e,t.Images[0].ImageGUID);var c=t.Images[0].ImageGUID;var d=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[u].Images.StructureData[c].Thumbnail;if(this.Plugin.Controller.ThumbnailPane.Thumbnails[e][s-1].SeriesImage===undefined){var m=document.createElement("div");m.className="ThumbnailImage";var S=new Image;S.src=d;this.Plugin.Controller.ThumbnailPane.Thumbnails[e][s-1].SeriesImage=S;this.Plugin.Controller.ThumbnailPane.Thumbnails[e][s-1].Element.appendChild(m);m.appendChild(S)}for(var C=0;C<this.Plugin.Controller.View.Plugins.length;C++)this.Plugin.Controller.View.Plugins[C].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,true)}LoadKeyImagesInViewports(e,t){this.Plugin.SetSeriesToViewport(e,this.pseudoSeriesGuid,t,this.GetIndexPseudoSerieKeyImage(e),0);this.UpdateViewportsPseudoSeries()}UpdateThumbnails(e,t){try{var n=this.GetIndexThumbnailStudy(e);this.Plugin.Controller.ThumbnailPane.Thumbnails[e][n-1].Element.setAttribute("data-totalImagesLoaded",this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid].ImageCount.toString());this.Plugin.Controller.ThumbnailPane.Thumbnails[e][n-1].Element.setAttribute("data-totalImages",this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid].ImageCount.toString());this.Plugin.Controller.ThumbnailPane.Thumbnails[e][n-1].StartProgressRing();if(this.Plugin.Controller.ThumbnailPane.Thumbnails[e][n-1].SeriesImage===undefined){var o=document.createElement("div");o.className="ThumbnailImage";var s=new Image;s.src=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid].KeyImages.StructureData[t].Thumbnail;if(s.naturalWidth>s.naturalHeight)s.classList.add("th-landscape");else s.classList.add("th-portrait");this.Plugin.Controller.ThumbnailPane.Thumbnails[e][n-1].SeriesImage=s;this.Plugin.Controller.ThumbnailPane.Thumbnails[e][n-1].Element.appendChild(o);o.appendChild(s)}}catch(e){Efferent.Frontend.WebClient.Utils.DebugConsoleLog(e)}}UpdateViewportsPseudoSeries(){var e=this.Plugin.Controller.ViewportPane.ViewportsArray;for(var t=0;t<e.length;t++){var n=e[t];if(n.Context.KeyImageEntity!==null&&n.Context.IsPseudoSeries&&n.Context.ImageEntity){var o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[n.Context.StudyGuid].Study.Series.StructureData[n.Context.SeriesGuid];if(o){n.Context.Level=undefined;n.Context.Window=undefined;n.Context.TotalImages=o.KeyImages.IndexData.length;n.Context.TotalSeriesInStudy=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[n.Context.StudyGuid].Study.Series.IndexData.length||this.Plugin.Controller.StudyViewerModel.Documents.StructureData[n.Context.StudyGuid].Study.SeriesCount;n.Context.CanvasImage=null;n.ProcessWLStart=false;this.Plugin.Controller.ThumbnailPane.UpdateAllThumnailsPane();n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}else{n.Context.IsPseudoSeries=false;n.Reset();n.Clear()}}}}CreatePseudoSeries(e,n){var o=new t.SeriesEntity;o.SeriesGUID=this.pseudoSeriesGuid;o["pseudoserie"]=true;o.ImageCount=n.length;if(!this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData.some((e=>e===this.pseudoSeriesGuid))){this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid]=o;this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData.push(this.pseudoSeriesGuid)}this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid].KeyImages=new Efferent.Frontend.WebClient.MapStructure;for(var s=0;s<n.length;s++){var l=n[s].KeyImageID;this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid].KeyImages.StructureData[l]=n[s];this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[this.pseudoSeriesGuid].KeyImages.IndexData.push(l)}if(!this.Plugin.Controller.ThumbnailPane.PseudoSeriesExist(e,this.pseudoSeriesGuid+"_KeyImagesContainer"))this.Plugin.Controller.ThumbnailPane.BuildThumbnailPseudoSeries(this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.StudyGUID,this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series,this.pseudoSeriesGuid+"_KeyImagesContainer")}ControllerKeyImagesLoad(e){var t=this.keyImagesInStudyLoad[e];var n=this.Plugin.Controller.ViewportPane.ViewportsArray;var o=this.Plugin.Controller.StudyViewerModel.Documents.StructureData[e].Study.Series;var s=0;for(var l=0;l<o.IndexData.length;l++){for(var u=0;u<n.length;u++){var c=n[u];if(c.Context.ImageEntity!==null){var d=o.IndexData[l];if(o.StructureData[d]["pseudoserie"]===undefined){if(e===c.Context.StudyGuid&&d===c.Context.SeriesGuid)s++}}}}var m=this.Plugin.Controller.ViewportPane.HorizontalViewports*this.Plugin.Controller.ViewportPane.VerticalViewports;if(t!==undefined){var S=JSON.parse(t);this.UpdateThumbnails(e,S[0].keyImageId)}if(t!==undefined&&m<o.IndexData.length){var C=this.GetIndexThumbnailStudy(e);if(this.Plugin.Controller.ThumbnailPane.Thumbnails[e][C-1].SeriesImage===undefined){var p=JSON.parse(t);this.LoadKeyImagesInViewports(e,p[0].keyImageId)}}if(t!==undefined&&s===this.Plugin.Controller.GetSeriesNumberWithoutPseudoSeries(e)){var A=JSON.parse(t);this.LoadKeyImagesInViewports(e,A[0].keyImageId)}}GetIndexThumbnailStudy(t){var n=this.Plugin.Controller.ThumbnailPane.Thumbnails[t];var o=1;for(var s=0;s<n.length;s++){var l=n[s];if(l.ThumbnailName===this.pseudoSeriesGuid+"_KeyImagesContainer"||l.ThumbnailName===e.StitchManager.PseudoSeriesGuid+"_KeyImagesContainer")return o+s}return-1}}e.PseudoSerieStudy=PseudoSerieStudy})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){class ResourceBag{}ResourceBag.AngleTemplateJson={ClassName:"Vue.Products.DicomPlugin.AngleAnnotation",Name:"AngleAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:3,MinPoints:3,PromptMessage:"Click on 3 angle points"},Label:{GroupName:"Label",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click on the label position"}}};ResourceBag.ArrowTemplateJson={ClassName:"Vue.Products.DicomPlugin.ArrowAnnotation",Name:"ArrowAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Click on the arrow's endpoints",NextGroup:"Label"},Label:{GroupName:"Label",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click on the label position"}}};ResourceBag.DicomDictionaryJson={"00000000":"Command Group Length","00000001":"Command Length to End","00000002":"Affected SOP Class UID","00000003":"Requested SOP Class UID","00000010":"Command Recognition Code","00000100":"Command Field","00000110":"Message ID","00000120":"Message ID Being Responded To","00000200":"Initiator","00000300":"Receiver","00000400":"Find Location","00000600":"Move Destination","00000700":"Priority","00000800":"Command Data Set Type","00000850":"Number of Matches","00000860":"Response Sequence Number","00000900":"Status","00000901":"Offending Element","00000902":"Error Comment","00000903":"Error ID","00001000":"Affected SOP Instance UID","00001001":"Requested SOP Instance UID","00001002":"Event Type ID","00001005":"Attribute Identifier List","00001008":"Action Type ID","00001020":"Number of Remaining Suboperations","00001021":"Number of Completed Suboperations","00001022":"Number of Failed Suboperations","00001023":"Number of Warning Suboperations","00001030":"Move Originator Application Entity Title","00001031":"Move Originator Message ID","00004000":"Dialog Receiver","00004010":"Terminal Type","00005010":"Message Set ID","00005020":"End Message ID","00005110":"Display Format","00005120":"Page Position ID","00005130":"Text Format ID","00005140":"Normal Reverse","00005150":"Add Gray Scale","00005160":"Borders","00005170":"Copies","00005180":"Command Magnification Type","00005190":"Erase","000051A0":"Print","000051B0":"Overlays","00020000":"File Meta Information Group Length","00020001":"File Meta Information Version","00020002":"Media Storage SOP Class UID","00020003":"Media Storage SOP Instance UID","00020010":"Transfer Syntax UID","00020012":"Implementation Class UID","00020013":"Implementation Version Name","00020016":"Source Application Entity Title","00020100":"Private Information Creator UID","00020102":"Private Information","00041130":"File-set ID","00041141":"File-set Descriptor File ID","00041142":"Specific Character Set of File-set Descriptor File","00041200":"Offset of The First Directory Record of The Root Directory Entity","00041202":"Offset of The Last Directory Record of The Root Directory Entity","00041212":"File-set Consistency Flag","00041220":"Directory Record Sequence","00041400":"Offset of The Next Directory Record","00041410":"Record in Use Flag","00041420":"Offset of Referenced Lower Level Directory Entity","00041430":"Directory Record Type","00041432":"Private Record UID","00041500":"Referenced File ID","00041504":"MRDR Directory Record Offset","00041510":"Referenced SOP Class UID in File","00041511":"Referenced SOP Instance UID in File","00041512":"Referenced Transfer Syntax UID in File","0004151A":"Referenced Related General SOP Class UID in File","00041600":"Number of References","00080001":"Length to End","00080005":"Specific Character Set","00080006":"Language Code Sequence","00080008":"Image Type","00080010":"Recognition Code","00080012":"Instance Creation Date","00080013":"Instance Creation Time","00080014":"Instance Creator UID","00080016":"SOP Class UID","00080018":"SOP Instance UID","0008001A":"Related General SOP Class UID","0008001B":"Original Specialized SOP Class UID","00080020":"Study Date","00080021":"Series Date","00080022":"Acquisition Date","00080023":"Content Date","00080024":"Overlay Date","00080025":"Curve Date","0008002A":"Acquisition Date Time","00080030":"Study Time","00080031":"Series Time","00080032":"Acquisition Time","00080033":"Content Time","00080034":"Overlay Time","00080035":"Curve Time","00080040":"Data Set Type","00080041":"Data Set Subtype","00080042":"Nuclear Medicine Series Type","00080050":"Accession Number","00080051":"Issuer of Accession Number Sequence","00080052":"Query/Retrieve Level","00080054":"Retrieve AE Title","00080056":"Instance Availability","00080058":"Failed SOP Instance UID List","00080060":"Modality","00080061":"Modalities in Study","00080062":"SOP Classes in Study","00080064":"Conversion Type","00080068":"Presentation Intent Type","00080070":"Manufacturer","00080080":"Institution Name","00080081":"Institution Address","00080082":"Institution Code Sequence","00080090":"Referring Physician Name","00080092":"Referring Physician Address","00080094":"Referring Physician Telephone Numbers","00080096":"Referring Physician Identification Sequence","00080100":"Code Value","00080102":"Coding Scheme Designator","00080103":"Coding Scheme Version","00080104":"Code Meaning","00080105":"Mapping Resource","00080106":"Context Group Version","00080107":"Context Group Local Version","0008010B":"Context Group Extension Flag","0008010C":"Coding Scheme UID","0008010D":"Context Group Extension Creator UID","0008010F":"Context Identifier","00080110":"Coding Scheme Identification Sequence","00080112":"Coding Scheme Registry","00080114":"Coding Scheme External ID","00080115":"Coding Scheme Name","00080116":"Coding Scheme Responsible Organization","00080117":"Context UID","00080201":"Timezone Offset From UTC","00081000":"Network ID","00081010":"Station Name","00081030":"Study Description","00081032":"Procedure Code Sequence","0008103E":"Series Description","0008103F":"Series Description Code Sequence","00081040":"Institutional Department Name","00081048":"Physicians of Record","00081049":"Physicians of Record Identification Sequence","00081050":"Performing Physician Name","00081052":"Performing Physician Identification Sequence","00081060":"Name of Physicians Reading Study","00081062":"Physicians Reading Study Identification Sequence","00081070":"Operators Name","00081072":"Operator Identification Sequence","00081080":"Admitting Diagnoses Description","00081084":"Admitting Diagnoses Code Sequence","00081090":"Manufacturer Model Name","00081100":"Referenced Results Sequence","00081110":"Referenced Study Sequence","00081111":"Referenced Performed Procedure Step Sequence","00081115":"Referenced Series Sequence","00081120":"Referenced Patient Sequence","00081125":"Referenced Visit Sequence","00081130":"Referenced Overlay Sequence","00081134":"Referenced Stereometric Instance Sequence","0008113A":"Referenced Waveform Sequence","00081140":"Referenced Image Sequence","00081145":"Referenced Curve Sequence","0008114A":"Referenced Instance Sequence","0008114B":"Referenced Real World Value Mapping Instance Sequence","00081150":"Referenced SOP Class UID","00081155":"Referenced SOP Instance UID","0008115A":"SOP Classes Supported","00081160":"Referenced Frame Number","00081161":"Simple Frame List","00081162":"Calculated Frame List","00081163":"Time Range","00081164":"Frame Extraction Sequence","00081167":"Multi Frame Source SOP Instance UID","00081195":"Transaction UID","00081197":"Failure Reason","00081198":"Failed SOP Sequence","00081199":"Referenced SOP Sequence","00081200":"Studies Containing Other Referenced Instances Sequence","00081250":"Related Series Sequence","00082110":"Lossy Image Compression (Retired)","00082111":"Derivation Description","00082112":"Source Image Sequence","00082120":"Stage Name","00082122":"Stage Number","00082124":"Number of Stages","00082127":"View Name","00082128":"View Number","00082129":"Number of Event Timers","0008212A":"Number of Views in Stage","00082130":"Event Elapsed Times","00082132":"Event Timer Names","00082133":"Event Timer Sequence","00082134":"Event Time Offset","00082135":"Event Code Sequence","00082142":"Start Trim","00082143":"Stop Trim","00082144":"Recommended Display Frame Rate","00082200":"Transducer Position","00082204":"Transducer Orientation","00082208":"Anatomic Structure","00082218":"Anatomic Region Sequence","00082220":"Anatomic Region Modifier Sequence","00082228":"Primary Anatomic Structure Sequence","00082229":"Anatomic Structure Space or Region Sequence","00082230":"Primary Anatomic Structure Modifier Sequence","00082240":"Transducer Position Sequence","00082242":"Transducer Position Modifier Sequence","00082244":"Transducer Orientation Sequence","00082246":"Transducer Orientation Modifier Sequence","00082251":"Anatomic Structure Space or Region Code Sequence (Trial)","00082253":"Anatomic Portal of Entrance Code Sequence (Trial)","00082255":"Anatomic Approach Direction Code Sequence (Trial)","00082256":"Anatomic Perspective Description (Trial)","00082257":"Anatomic Perspective Code Sequence (Trial)","00082258":"Anatomic Location of Examining Instrument Description (Trial)","00082259":"Anatomic Location of Examining Instrument Code Sequence (Trial)","0008225A":"Anatomic Structure Space or Region Modifier Code Sequence (Trial)","0008225C":"On Axis Background Anatomic Structure Code Sequence (Trial)","00083001":"Alternate Representation Sequence","00083010":"Irradiation Event UID","00084000":"Identifying Comments","00089007":"Frame Type","00089092":"Referenced Image Evidence Sequence","00089121":"Referenced Raw Data Sequence","00089123":"Creator Version UID","00089124":"Derivation Image Sequence","00089154":"Source Image Evidence Sequence","00089205":"Pixel Presentation","00089206":"Volumetric Properties","00089207":"Volume Based Calculation Technique","00089208":"Complex Image Component","00089209":"Acquisition Contrast","00089215":"Derivation Code Sequence","00089237":"Referenced Presentation State Sequence","00089410":"Referenced Other Plane Sequence","00089458":"Frame Display Sequence","00089459":"Recommended Display Frame Rate in Float","00089460":"Skip Frame Range Flag","00091001":"FullFidelity","00091002":"SuiteID","00091004":"ProductID","00091027":"ImageActualDate","00091030":"ServiceID","00091031":"MobileLocationNumber","000910E3":"EquipmentUID","000910E6":"GenesisVersionNow","000910E7":"ExamRecordChecksum","000910E9":"ActualSeriesDataTimeStamp","00100000":"PatientGroupLength","00100010":"Patient Name","00100020":"Patient ID","00100021":"Issuer of Patient ID","00100022":"Type of Patient ID","00100024":"Issuer of Patient ID Qualifiers Sequence","00100030":"Patient Birth Date","00100032":"Patient Birth Time","00100040":"Patient Sex","00100050":"Patient Insurance Plan Code Sequence","00100101":"Patient Primary Language Code Sequence","00100102":"Patient Primary Language Modifier Code Sequence","00101000":"Other Patient IDs","00101001":"Other Patient Names","00101002":"Other Patient IDs Sequence","00101005":"Patient Birth Name","00101010":"Patient Age","00101020":"Patient Size","00101021":"Patient Size Code Sequence","00101030":"Patient Weight","00101040":"Patient Address","00101050":"Insurance Plan Identification","00101060":"Patient Mother Birth Name","00101080":"Military Rank","00101081":"Branch of Service","00101090":"Medical Record Locator","00102000":"Medical Alerts","00102110":"Allergies","00102150":"Country of Residence","00102152":"Region of Residence","00102154":"Patient Telephone Numbers","00102160":"Ethnic Group","00102180":"Occupation","001021A0":"Smoking Status","001021B0":"Additional Patient History","001021C0":"Pregnancy Status","001021D0":"Last Menstrual Date","001021F0":"Patient Religious Preference","00102201":"Patient Species Description","00102202":"Patient Species Code Sequence","00102203":"Patient Sex Neutered","00102210":"Anatomical Orientation Type","00102292":"Patient Breed Description","00102293":"Patient Breed Code Sequence","00102294":"Breed Registration Sequence","00102295":"Breed Registration Number","00102296":"Breed Registry Code Sequence","00102297":"Responsible Person","00102298":"Responsible Person Role","00102299":"Responsible Organization","00104000":"Patient Comments","00109431":"Examined Body Thickness","00120010":"Clinical Trial Sponsor Name","00120020":"Clinical Trial Protocol ID","00120021":"Clinical Trial Protocol Name","00120030":"Clinical Trial Site ID","00120031":"Clinical Trial Site Name","00120040":"Clinical Trial Subject ID","00120042":"Clinical Trial Subject Reading ID","00120050":"Clinical Trial Time Point ID","00120051":"Clinical Trial Time Point Description","00120060":"Clinical Trial Coordinating Center Name","00120062":"Patient Identity Removed","00120063":"Deidentification Method","00120064":"Deidentification Method Code Sequence","00120071":"Clinical Trial Series ID","00120072":"Clinical Trial Series Description","00120081":"Clinical Trial Protocol Ethics Committee Name","00120082":"Clinical Trial Protocol Ethics Committee Approval Number","00120083":"Consent for Clinical Trial Use Sequence","00120084":"Distribution Type","00120085":"Consent for Distribution Flag","00140023":"CAD File Format","00140024":"Component Reference System","00140025":"Component Manufacturing Procedure","00140028":"Component Manufacturer","00140030":"Material Thickness","00140032":"Material Pipe Diameter","00140034":"Material Isolation Diameter","00140042":"Material Grade","00140044":"Material Properties File ID","00140045":"Material Properties File Format","00140046":"Material Notes","00140050":"Component Shape","00140052":"Curvature Type","00140054":"Outer Diameter","00140056":"Inner Diameter","00141010":"Actual Environmental Conditions","00141020":"Expiry Date","00141040":"Environmental Conditions","00142002":"Evaluator Sequence","00142004":"Evaluator Number","00142006":"Evaluator Name","00142008":"Evaluation Attempt","00142012":"Indication Sequence","00142014":"Indication Number ","00142016":"Indication Label","00142018":"Indication Description","0014201A":"Indication Type","0014201C":"Indication Disposition","0014201E":"Indication ROI Sequence","00142030":"Indication Physical Property Sequence","00142032":"Property Label","00142202":"Coordinate System Number of Axes ","00142204":"Coordinate System Axes Sequence","00142206":"Coordinate System Axis Description","00142208":"Coordinate System Data Set Mapping","0014220A":"Coordinate System Axis Number","0014220C":"Coordinate System Axis Type","0014220E":"Coordinate System Axis Units","00142210":"Coordinate System Axis Values","00142220":"Coordinate System Transform Sequence","00142222":"Transform Description","00142224":"Transform Number of Axes","00142226":"Transform Order of Axes","00142228":"Transformed Axis Units","0014222A":"Coordinate System Transform Rotation and Scale Matrix","0014222C":"Coordinate System Transform Translation Matrix","00143011":"Internal Detector Frame Time","00143012":"Number of Frames Integrated","00143020":"Detector Temperature Sequence","00143022":"Sensor Name","00143024":"Horizontal Offset of Sensor","00143026":"Vertical Offset of Sensor","00143028":"Sensor Temperature","00143040":"Dark Current Sequence","00143050":"Dark Current Counts","00143060":"Gain Correction Reference Sequence","00143070":"Air Counts","00143071":"KV Used in Gain Calibration","00143072":"MA Used in Gain Calibration","00143073":"Number of Frames Used for Integration","00143074":"Filter Material Used in Gain Calibration","00143075":"Filter Thickness Used in Gain Calibration","00143076":"Date of Gain Calibration","00143077":"Time of Gain Calibration","00143080":"Bad Pixel Image","00143099":"Calibration Notes","00144002":"Pulser Equipment Sequence","00144004":"Pulser Type","00144006":"Pulser Notes","00144008":"Receiver Equipment Sequence","0014400A":"Amplifier Type","0014400C":"Receiver Notes","0014400E":"Pre Amplifier Equipment Sequence","0014400F":"Pre Amplifier Notes","00144010":"Transmit Transducer Sequence","00144011":"Receive Transducer Sequence","00144012":"Number of Elements","00144013":"Element Shape","00144014":"Element Dimension A","00144015":"Element Dimension B","00144016":"Element Pitch","00144017":"Measured Beam Dimension A","00144018":"Measured Beam Dimension B","00144019":"Location of Measured Beam Diameter","0014401A":"Nominal Frequency","0014401B":"Measured Center Frequency","0014401C":"Measured Bandwidth","00144020":"Pulser Settings Sequence","00144022":"Pulse Width","00144024":"Excitation Frequency","00144026":"Modulation Type","00144028":"Damping","00144030":"Receiver Settings Sequence","00144031":"Acquired Soundpath Length","00144032":"Acquisition Compression Type","00144033":"Acquisition Sample Size","00144034":"Rectifier Smoothing","00144035":"DAC Sequence","00144036":"DAC Type","00144038":"DAC Gain Points","0014403A":"DAC Time Points","0014403C":"DAC Amplitude","00144040":"Pre Amplifier Settings Sequence","00144050":"Transmit Transducer Settings Sequence","00144051":"Receive Transducer Settings Sequence","00144052":"Incident Angle","00144054":"Coupling Technique","00144056":"Coupling Medium","00144057":"Coupling Velocity","00144058":"Crystal Center Location X","00144059":"Crystal Center Location Z","0014405A":"Sound Path Length","0014405C":"Delay Law Identifier","00144060":"Gate Settings Sequence","00144062":"Gate Threshold","00144064":"Velocity of Sound","00144070":"Calibration Settings Sequence","00144072":"Calibration Procedure","00144074":"Procedure Version","00144076":"Procedure Creation Date","00144078":"Procedure Expiration Date","0014407A":"Procedure Last Modified Date","0014407C":"Calibration Time","0014407E":"Calibration Date","00145002":"LINAC Energy","00145004":"LINAC Output","00180010":"Contrast/Bolus Agent","00180012":"Contrast/Bolus Agent Sequence","00180014":"Contrast/Bolus Administration Route Sequence","00180015":"Body Part Examined","00180020":"Scanning Sequence","00180021":"Sequence Variant","00180022":"Scan Options","00180023":"MR Acquisition Type","00180024":"Sequence Name","00180025":"Angio Flag","00180026":"Intervention Drug Information Sequence","00180027":"Intervention Drug Stop Time","00180028":"Intervention Drug Dose","00180029":"Intervention Drug Code Sequence","0018002A":"Additional Drug Sequence","00180030":"Radionuclide","00180031":"Radiopharmaceutical","00180032":"Energy Window Centerline","00180033":"Energy Window Total Width","00180034":"Intervention Drug Name","00180035":"Intervention Drug Start Time","00180036":"Intervention Sequence","00180037":"Therapy Type","00180038":"Intervention Status","00180039":"Therapy Description","0018003A":"Intervention Description","00180040":"Cine Rate","00180042":"Initial Cine Run State","00180050":"Slice Thickness","00180060":"KVP","00180070":"Counts Accumulated","00180071":"Acquisition Termination Condition","00180072":"Effective Duration","00180073":"Acquisition Start Condition","00180074":"Acquisition Start Condition Data","00180075":"Acquisition Termination Condition Data","00180080":"Repetition Time","00180081":"Echo Time","00180082":"Inversion Time","00180083":"Number of Averages","00180084":"Imaging Frequency","00180085":"Imaged Nucleus","00180086":"Echo Numbers","00180087":"Magnetic Field Strength","00180088":"Spacing Between Slices","00180089":"Number of Phase Encoding Steps","00180090":"Data Collection Diameter","00180091":"Echo Train Length","00180093":"Percent Sampling","00180094":"Percent Phase Field of View","00180095":"Pixel Bandwidth","00181000":"Device Serial Number","00181002":"Device UID","00181003":"Device ID","00181004":"Plate ID","00181005":"Generator ID","00181006":"Grid ID","00181007":"Cassette ID","00181008":"Gantry ID","00181010":"Secondary Capture Device ID","00181011":"Hardcopy Creation Device ID","00181012":"Date of Secondary Capture","00181014":"Time of Secondary Capture","00181016":"Secondary Capture Device Manufacturer","00181017":"Hardcopy Device Manufacturer","00181018":"Secondary Capture Device Manufacturer Model Name","00181019":"Secondary Capture Device Software Versions","0018101A":"Hardcopy Device Software Version","0018101B":"Hardcopy Device Manufacturer Model Name","00181020":"Software Versions","00181022":"Video Image Format Acquired","00181023":"Digital Image Format Acquired","00181030":"Protocol Name","00181040":"Contrast/Bolus Route","00181041":"Contrast/Bolus Volume","00181042":"Contrast/Bolus Start Time","00181043":"Contrast/Bolus Stop Time","00181044":"Contrast/Bolus Total Dose","00181045":"Syringe Counts","00181046":"Contrast Flow Rate","00181047":"Contrast Flow Duration","00181048":"Contrast/Bolus Ingredient","00181049":"Contrast/Bolus Ingredient Concentration","00181050":"Spatial Resolution","00181060":"Trigger Time","00181061":"Trigger Source or Type","00181062":"Nominal Interval","00181063":"Frame Time","00181064":"Cardiac Framing Type","00181065":"Frame Time Vector","00181066":"Frame Delay","00181067":"Image Trigger Delay","00181068":"Multiplex Group Time Offset","00181069":"Trigger Time Offset","0018106A":"Synchronization Trigger","0018106C":"Synchronization Channel","0018106E":"Trigger Sample Position","00181070":"Radiopharmaceutical Route","00181071":"Radiopharmaceutical Volume","00181072":"Radiopharmaceutical Start Time","00181073":"Radiopharmaceutical Stop Time","00181074":"Radionuclide Total Dose","00181075":"Radionuclide Half Life","00181076":"Radionuclide Positron Fraction","00181077":"Radiopharmaceutical Specific Activity","00181078":"Radiopharmaceutical Start Date Time","00181079":"Radiopharmaceutical Stop Date Time","00181080":"Beat Rejection Flag","00181081":"Low R-R Value","00181082":"High R-R Value","00181083":"Intervals Acquired","00181084":"Intervals Rejected","00181085":"PVC Rejection","00181086":"Skip Beats","00181088":"Heart Rate","00181090":"Cardiac Number of Images","00181094":"Trigger Window","00181100":"Reconstruction Diameter","00181110":"Distance Source to Detector","00181111":"Distance Source to Patient","00181114":"Estimated Radiographic Magnification Factor","00181120":"Gantry/Detector Tilt","00181121":"Gantry/Detector Slew","00181130":"Table Height","00181131":"Table Traverse","00181134":"Table Motion","00181135":"Table Vertical Increment","00181136":"Table Lateral Increment","00181137":"Table Longitudinal Increment","00181138":"Table Angle","0018113A":"Table Type","00181140":"Rotation Direction","00181141":"Angular Position","00181142":"Radial Position","00181143":"Scan Arc","00181144":"Angular Step","00181145":"Center of Rotation Offset","00181146":"Rotation Offset","00181147":"Field of View Shape","00181149":"Field of View Dimensions","00181150":"Exposure Time","00181151":"X-Ray Tube Current","00181152":"Exposure","00181153":"Exposure in µAs","00181154":"Average Pulse Width","00181155":"Radiation Setting","00181156":"Rectification Type","0018115A":"Radiation Mode","0018115E":"Image and Fluoroscopy Area Dose Product","00181160":"Filter Type","00181161":"Type of Filters","00181162":"Intensifier Size","00181164":"Imager Pixel Spacing","00181166":"Grid","00181170":"Generator Power","00181180":"Collimator/Grid Name","00181181":"Collimator Type","00181182":"Focal Distance","00181183":"X Focus Center","00181184":"Y Focus Center","00181190":"Focal Spots","00181191":"Anode Target Material","001811A0":"Body Part Thickness","001811A2":"Compression Force","00181200":"Date of Last Calibration","00181201":"Time of Last Calibration","00181210":"Convolution Kernel","00181240":"Upper Lower Pixel Values","00181242":"Actual Frame Duration","00181243":"Count Rate","00181244":"Preferred Playback Sequencing","00181250":"Receive Coil Name","00181251":"Transmit Coil Name","00181260":"Plate Type","00181261":"Phosphor Type","00181300":"Scan Velocity","00181301":"Whole Body Technique","00181302":"Scan Length","00181310":"Acquisition Matrix","00181312":"In Plane Phase Encoding Direction","00181314":"Flip Angle","00181315":"Variable Flip Angle Flag","00181316":"SAR","00181318":"dB/dt","00181400":"Acquisition Device Processing Description","00181401":"Acquisition Device Processing Code","00181402":"Cassette Orientation","00181403":"Cassette Size","00181404":"Exposures On Plate","00181405":"Relative X-Ray Exposure","00181411":"Exposure Index","00181412":"Target Exposure Index","00181413":"Deviation Index","00181450":"Column Angulation","00181460":"Tomo Layer Height","00181470":"Tomo Angle","00181480":"Tomo Time","00181490":"Tomo Type","00181491":"Tomo Class","00181495":"Number of Tomosynthesis Source Images","00181500":"Positioner Motion","00181508":"Positioner Type","00181510":"Positioner Primary Angle","00181511":"Positioner Secondary Angle","00181520":"Positioner Primary Angle Increment","00181521":"Positioner Secondary Angle Increment","00181530":"Detector Primary Angle","00181531":"Detector Secondary Angle","00181600":"Shutter Shape","00181602":"Shutter Left Vertical Edge","00181604":"Shutter Right Vertical Edge","00181606":"Shutter Upper Horizontal Edge","00181608":"Shutter Lower Horizontal Edge","00181610":"Center of Circular Shutter","00181612":"Radius of Circular Shutter","00181620":"Vertices of The Polygonal Shutter","00181622":"Shutter Presentation Value","00181623":"Shutter Overlay Group","00181624":"Shutter Presentation Color CIELab Value","00181700":"Collimator Shape","00181702":"Collimator Left Vertical Edge","00181704":"Collimator Right Vertical Edge","00181706":"Collimator Upper Horizontal Edge","00181708":"Collimator Lower Horizontal Edge","00181710":"Center of Circular Collimator","00181712":"Radius of Circular Collimator","00181720":"Vertices of The Polygonal Collimator","00181800":"Acquisition Time Synchronized","00181801":"Time Source","00181802":"Time Distribution Protocol","00181803":"NTP Source Address","00182001":"Page Number Vector","00182002":"Frame Label Vector","00182003":"Frame Primary Angle Vector","00182004":"Frame Secondary Angle Vector","00182005":"Slice Location Vector","00182006":"Display Window Label Vector","00182010":"Nominal Scanned Pixel Spacing","00182020":"Digitizing Device Transport Direction","00182030":"Rotation of Scanned Film","00183100":"IVUS Acquisition","00183101":"IVUS Pullback Rate","00183102":"IVUS Gated Rate","00183103":"IVUS Pullback Start Frame Number","00183104":"IVUS Pullback Stop Frame Number","00183105":"Lesion Number","00184000":"Acquisition Comments","00185000":"Output Power","00185010":"Transducer Data","00185012":"Focus Depth","00185020":"Processing Function","00185021":"Postprocessing Function","00185022":"Mechanical Index","00185024":"Bone Thermal Index","00185026":"Cranial Thermal Index","00185027":"Soft Tissue Thermal Index","00185028":"Soft Tissue-focus Thermal Index","00185029":"Soft Tissue-surface Thermal Index","00185030":"Dynamic Range","00185040":"Total Gain","00185050":"Depth of Scan Field","00185100":"Patient Position","00185101":"View Position","00185104":"Projection Eponymous Name Code Sequence","00185210":"Image Transformation Matrix","00185212":"Image Translation Vector","00186000":"Sensitivity","00186011":"Sequence of Ultrasound Regions","00186012":"Region Spatial Format","00186014":"Region Data Type","00186016":"Region Flags","00186018":"Region Location Min X0","0018601A":"Region Location Min Y0","0018601C":"Region Location Max X1","0018601E":"Region Location Max Y1","00186020":"Reference Pixel X0","00186022":"Reference Pixel Y0","00186024":"Physical Units X Direction","00186026":"Physical Units Y Direction","00186028":"Reference Pixel Physical Value X","0018602A":"Reference Pixel Physical Value Y","0018602C":"Physical Delta X","0018602E":"Physical Delta Y","00186030":"Transducer Frequency","00186031":"Transducer Type","00186032":"Pulse Repetition Frequency","00186034":"Doppler Correction Angle","00186036":"Steering Angle","00186038":"Doppler Sample Volume X Position (Retired)","00186039":"Doppler Sample Volume X Position","0018603A":"Doppler Sample Volume Y Position (Retired)","0018603B":"Doppler Sample Volume Y Position","0018603C":"TM-Line Position X0 (Retired)","0018603D":"TM-Line Position X0","0018603E":"TM-Line Position Y0 (Retired)","0018603F":"TM-Line Position Y0","00186040":"TM-Line Position X1 (Retired)","00186041":"TM-Line Position X1","00186042":"TM-Line Position Y1 (Retired)","00186043":"TM-Line Position Y1","00186044":"Pixel Component Organization","00186046":"Pixel Component Mask","00186048":"Pixel Component Range Start","0018604A":"Pixel Component Range Stop","0018604C":"Pixel Component Physical Units","0018604E":"Pixel Component Data Type","00186050":"Number of Table Break Points","00186052":"Table of X Break Points","00186054":"Table of Y Break Points","00186056":"Number of Table Entries","00186058":"Table of Pixel Values","0018605A":"Table of Parameter Values","00186060":"R Wave Time Vector","00187000":"Detector Conditions Nominal Flag","00187001":"Detector Temperature","00187004":"Detector Type","00187005":"Detector Configuration","00187006":"Detector Description","00187008":"Detector Mode","0018700A":"Detector ID","0018700C":"Date of Last Detector Calibration","0018700E":"Time of Last Detector Calibration","00187010":"Exposures On Detector Since Last Calibration","00187011":"Exposures On Detector Since Manufactured","00187012":"Detector Time Since Last Exposure","00187014":"Detector Active Time","00187016":"Detector Activation Offset From Exposure","0018701A":"Detector Binning","00187020":"Detector Element Physical Size","00187022":"Detector Element Spacing","00187024":"Detector Active Shape","00187026":"Detector Active Dimensions","00187028":"Detector Active Origin","0018702A":"Detector Manufacturer Name","0018702B":"Detector Manufacturer Model Name","00187030":"Field of View Origin","00187032":"Field of View Rotation","00187034":"Field of View Horizontal Flip","00187036":"Pixel Data Area Origin Relative to FOV","00187038":"Pixel Data Area Rotation Angle Relative to FOV","00187040":"Grid Absorbing Material","00187041":"Grid Spacing Material","00187042":"Grid Thickness","00187044":"Grid Pitch","00187046":"Grid Aspect Ratio","00187048":"Grid Period","0018704C":"Grid Focal Distance","00187050":"Filter Material","00187052":"Filter Thickness Minimum","00187054":"Filter Thickness Maximum","00187056":"Filter Beam Path Length Minimum","00187058":"Filter Beam Path Length Maximum","00187060":"Exposure Control Mode","00187062":"Exposure Control Mode Description","00187064":"Exposure Status","00187065":"Phototimer Setting","00188150":"Exposure Time In ÂµS","00188151":"X-Ray Tube Current in µA","00189004":"Content Qualification","00189005":"Pulse Sequence Name","00189006":"MR Imaging Modifier Sequence","00189008":"Echo Pulse Sequence","00189009":"Inversion Recovery","00189010":"Flow Compensation","00189011":"Multiple Spin Echo","00189012":"Multi Planar Excitation","00189014":"Phase Contrast","00189015":"Time of Flight Contrast","00189016":"Spoiling","00189017":"Steady State Pulse Sequence","00189018":"Echo Planar Pulse Sequence","00189019":"Tag Angle First Axis","00189020":"Magnetization Transfer","00189021":"T2 Preparation","00189022":"Blood Signal Nulling","00189024":"Saturation Recovery","00189025":"Spectrally Selected Suppression","00189026":"Spectrally Selected Excitation","00189027":"Spatial Presaturation","00189028":"Tagging","00189029":"Oversampling Phase","00189030":"Tag Spacing First Dimension","00189032":"Geometry of k-space Traversal","00189033":"Segmented k-space Traversal","00189034":"Rectilinear Phase Encode Reordering","00189035":"Tag Thickness","00189036":"Partial Fourier Direction","00189037":"Cardiac Synchronization Technique","00189041":"Receive Coil Manufacturer Name","00189042":"MR Receive Coil Sequence","00189043":"Receive Coil Type","00189044":"Quadrature Receive Coil","00189045":"Multi-Coil Definition Sequence","00189046":"Multi-Coil Configuration","00189047":"Multi-Coil Element Name","00189048":"Multi-Coil Element Used","00189049":"MR Transmit Coil Sequence","00189050":"Transmit Coil Manufacturer Name","00189051":"Transmit Coil Type","00189052":"Spectral Width","00189053":"Chemical Shift Reference","00189054":"Volume Localization Technique","00189058":"MR Acquisition Frequency Encoding Steps","00189059":"De-coupling","00189060":"De-coupled Nucleus","00189061":"De-coupling Frequency","00189062":"De-coupling Method","00189063":"De-coupling Chemical Shift Reference","00189064":"k-space Filtering","00189065":"Time Domain Filtering","00189066":"Number of Zero Fills","00189067":"Baseline Correction","00189069":"Parallel Reduction Factor in Plane","00189070":"Cardiac R-R Interval Specified","00189073":"Acquisition Duration","00189074":"Frame Acquisition Date Time","00189075":"Diffusion Directionality","00189076":"Diffusion Gradient Direction Sequence","00189077":"Parallel Acquisition","00189078":"Parallel Acquisition Technique","00189079":"Inversion Times","00189080":"Metabolite Map Description","00189081":"Partial Fourier","00189082":"Effective Echo Time","00189083":"Metabolite Map Code Sequence","00189084":"Chemical Shift Sequence","00189085":"Cardiac Signal Source","00189087":"Diffusion b-value","00189089":"Diffusion Gradient Orientation","00189090":"Velocity Encoding Direction","00189091":"Velocity Encoding Minimum Value","00189092":"Velocity Encoding Acquisition Sequence","00189093":"Number of k-space Trajectories","00189094":"Coverage of k-space","00189095":"Spectroscopy Acquisition Phase Rows","00189096":"Parallel Reduction Factor in Plane (Retired)","00189098":"Transmitter Frequency","00189100":"Resonant Nucleus","00189101":"Frequency Correction","00189103":"MR Spectroscopy FOV Geometry Sequence","00189104":"Slab Thickness","00189105":"Slab Orientation","00189106":"Mid Slab Position","00189107":"MR Spatial Saturation Sequence","00189112":"MR Timing and Related Parameters Sequence","00189114":"MR Echo Sequence","00189115":"MR Modifier Sequence","00189117":"MR Diffusion Sequence","00189118":"Cardiac Synchronization Sequence","00189119":"MR Averages Sequence","00189125":"MRFOV Geometry Sequence","00189126":"Volume Localization Sequence","00189127":"Spectroscopy Acquisition Data Columns","00189147":"Diffusion Anisotropy Type","00189151":"Frame Reference Date Time","00189152":"MR Metabolite Map Sequence","00189155":"Parallel Reduction Factor Out of Plane","00189159":"Spectroscopy Acquisition Out of Plane Phase Steps","00189166":"Bulk Motion Status","00189168":"Parallel Reduction Factor Second in Plane","00189169":"Cardiac Beat Rejection Technique","00189170":"Respiratory Motion Compensation Technique","00189171":"Respiratory Signal Source","00189172":"Bulk Motion Compensation Technique","00189173":"Bulk Motion Signal Source","00189174":"Applicable Safety Standard Agency","00189175":"Applicable Safety Standard Description","00189176":"Operating Mode Sequence","00189177":"Operating Mode Type","00189178":"Operating Mode","00189179":"Specific Absorption Rate Definition","00189180":"Gradient Output Type","00189181":"Specific Absorption Rate Value","00189182":"Gradient Output","00189183":"Flow Compensation Direction","00189184":"Tagging Delay","00189185":"Respiratory Motion Compensation Technique Description","00189186":"Respiratory Signal Source ID","00189195":"Chemical Shift Minimum Integration Limit in Hz","00189196":"Chemical Shift Maximum Integration Limit in Hz","00189197":"MR Velocity Encoding Sequence","00189198":"First Order Phase Correction","00189199":"Water Referenced Phase Correction","00189200":"MR Spectroscopy Acquisition Type","00189214":"Respiratory Cycle Position","00189217":"Velocity Encoding Maximum Value","00189218":"Tag Spacing Second Dimension","00189219":"Tag Angle Second Axis","00189220":"Frame Acquisition Duration","00189226":"MR Image Frame Type Sequence","00189227":"MR Spectroscopy Frame Type Sequence","00189231":"MR Acquisition Phase Encoding Steps in Plane","00189232":"MR Acquisition Phase Encoding Steps out of Plane","00189234":"Spectroscopy Acquisition Phase Columns","00189236":"Cardiac Cycle Position","00189239":"Specific Absorption Rate Sequence","00189240":"RF Echo Train Length","00189241":"Gradient Echo Train Length","00189250":"Arterial Spin Labeling Contrast","00189251":"MR Arterial Spin Labeling Sequence","00189252":"ASL Technique Description","00189253":"ASL Slab Number","00189254":"ASL Slab Thickness","00189255":"ASL Slab Orientation","00189256":"ASL Mid Slab Position","00189257":"ASL Context","00189258":"ASL Pulse Train Duration","00189259":"ASL Crusher Flag","0018925A":"ASL Crusher Flow","0018925B":"ASL Crusher Description","0018925C":"ASL Bolus Cutoff Flag","0018925D":"ASL Bolus Cutoff Timing Sequence","0018925E":"ASL Bolus Cutoff Technique","0018925F":"ASL Bolus Cutoff Delay Time","00189260":"ASL Slab Sequence","00189295":"Chemical Shift Minimum Integration Limit in ppm","00189296":"Chemical Shift Maximum Integration Limit in ppm","00189301":"CT Acquisition Type Sequence","00189302":"Acquisition Type","00189303":"Tube Angle","00189304":"CT Acquisition Details Sequence","00189305":"Revolution Time","00189306":"Single Collimation Width","00189307":"Total Collimation Width","00189308":"CT Table Dynamics Sequence","00189309":"Table Speed","00189310":"Table Feed Per Rotation","00189311":"Spiral Pitch Factor","00189312":"CT Geometry Sequence","00189313":"Data Collection Center Patient","00189314":"CT Reconstruction Sequence","00189315":"Reconstruction Algorithm","00189316":"Convolution Kernel Group","00189317":"Reconstruction Field of View","00189318":"Reconstruction Target Center Patient","00189319":"Reconstruction Angle","00189320":"Image Filter","00189321":"CT Exposure Sequence","00189322":"Reconstruction Pixel Spacing","00189323":"Exposure Modulation Type","00189324":"Estimated Dose Saving","00189325":"CT X-Ray Details Sequence","00189326":"CT Position Sequence","00189327":"Table Position","00189328":"Exposure Time in ms","00189329":"CT Image Frame Type Sequence","00189330":"X-Ray Tube Current in mA","00189332":"Exposure In mAs","00189333":"Constant Volume Flag","00189334":"Fluoroscopy Flag","00189335":"Distance Source to Data Collection Center","00189337":"Contrast/Bolus Agent Number","00189338":"Contrast/Bolus Ingredient Code Sequence","00189340":"Contrast Administration Profile Sequence","00189341":"Contrast/Bolus Usage Sequence","00189342":"Contrast/Bolus Agent Administered","00189343":"Contrast/Bolus Agent Detected","00189344":"Contrast/Bolus Agent Phase","00189345":"CTDIvol","00189346":"CTDI Phantom Type Code Sequence","00189351":"Calcium Scoring Mass Factor Patient","00189352":"Calcium Scoring Mass Factor Device","00189353":"Energy Weighting Factor","00189360":"CT Additional X-Ray Source Sequence","00189401":"Projection Pixel Calibration Sequence","00189402":"Distance Source to Isocenter","00189403":"Distance Object to Table Top","00189404":"Object Pixel Spacing in Center of Beam","00189405":"Positioner Position Sequence","00189406":"Table Position Sequence","00189407":"Collimator Shape Sequence","00189410":"Planes in Acquisition","00189412":"XA/XRF Frame Characteristics Sequence","00189417":"Frame Acquisition Sequence","00189420":"X-Ray Receptor Type","00189423":"Acquisition Protocol Name","00189424":"Acquisition Protocol Description","00189425":"Contrast/Bolus Ingredient Opaque","00189426":"Distance Receptor Plane to Detector Housing","00189427":"Intensifier Active Shape","00189428":"Intensifier Active Dimensions","00189429":"Physical Detector Size","00189430":"Position of Isocenter Projection","00189432":"Field of View Sequence","00189433":"Field of View Description","00189434":"Exposure Control Sensing Regions Sequence","00189435":"Exposure Control Sensing Region Shape","00189436":"Exposure Control Sensing Region Left Vertical Edge","00189437":"Exposure Control Sensing Region Right Vertical Edge","00189438":"Exposure Control Sensing Region Upper Horizontal Edge","00189439":"Exposure Control Sensing Region Lower Horizontal Edge","00189440":"Center of Circular Exposure Control Sensing Region","00189441":"Radius of Circular Exposure Control Sensing Region","00189442":"Vertices of The Polygonal Exposure Control Sensing Region","00189447":"Column Angulation Patient","00189449":"Beam Angle","00189451":"Frame Detector Parameters Sequence","00189452":"Calculated Anatomy Thickness","00189455":"Calibration Sequence","00189456":"Object Thickness Sequence","00189457":"Plane Identification","00189461":"Field of View Dimensions in Float","00189462":"Isocenter Reference System Sequence","00189463":"Positioner Isocenter Primary Angle","00189464":"Positioner Isocenter Secondary Angle","00189465":"Positioner Isocenter Detector Rotation Angle","00189466":"Table X Position to Isocenter","00189467":"Table Y Position to Isocenter","00189468":"Table Z Position to Isocenter","00189469":"Table Horizontal Rotation Angle","00189470":"Table Head Tilt Angle","00189471":"Table Cradle Tilt Angle","00189472":"Frame Display Shutter Sequence","00189473":"Acquired Image Area Dose Product","00189474":"C-Arm Positioner Tabletop Relationship","00189476":"X-Ray Geometry Sequence","00189477":"Irradiation Event Identification Sequence","00189504":"X-Ray 3D Frame Type Sequence","00189506":"Contributing Sources Sequence","00189507":"X-Ray 3D Acquisition Sequence","00189508":"Primary Positioner Scan Arc","00189509":"Secondary Positioner Scan Arc","00189510":"Primary Positioner Scan Start Angle","00189511":"Secondary Positioner Scan Start Angle","00189514":"Primary Positioner Increment","00189515":"Secondary Positioner Increment","00189516":"Start Acquisition Date Time","00189517":"End Acquisition Date Time","00189524":"Application Name","00189525":"Application Version","00189526":"Application Manufacturer","00189527":"Algorithm Type","00189528":"Algorithm Description","00189530":"X-Ray 3D Reconstruction Sequence","00189531":"Reconstruction Description","00189538":"Per Projection Acquisition Sequence","00189601":"Diffusion b-matrix Sequence","00189602":"Diffusion b-value XX","00189603":"Diffusion b-value XY","00189604":"Diffusion b-value XZ","00189605":"Diffusion b-value YY","00189606":"Diffusion b-value YZ","00189607":"Diffusion b-value ZZ","00189701":"Decay Correction Date Time","00189715":"Start Density Threshold","00189716":"Start Relative Density Difference Threshold","00189717":"Start Cardiac Trigger Count Threshold","00189718":"Start Respiratory Trigger Count Threshold","00189719":"Termination Counts Threshold","00189720":"Termination Density Threshold","00189721":"Termination Relative Density Threshold","00189722":"Termination Time Threshold","00189723":"Termination Cardiac Trigger Count Threshold","00189724":"Termination Respiratory Trigger Count Threshold","00189725":"Detector Geometry","00189726":"Transverse Detector Separation","00189727":"Axial Detector Dimension","00189729":"Radiopharmaceutical Agent Number","00189732":"PET Frame Acquisition Sequence","00189733":"PET Detector Motion Details Sequence","00189734":"PET Table Dynamics Sequence","00189735":"PET Position Sequence","00189736":"PET Frame Correction Factors Sequence","00189737":"Radiopharmaceutical Usage Sequence","00189738":"Attenuation Correction Source","00189739":"Number of Iterations","00189740":"Number of Subsets","00189749":"PET Reconstruction Sequence","00189751":"PET Frame Type Sequence","00189755":"Time of Flight Information Used","00189756":"Reconstruction Type","00189758":"Decay Corrected","00189759":"Attenuation Corrected","00189760":"Scatter Corrected","00189761":"Dead Time Corrected","00189762":"Gantry Motion Corrected","00189763":"Patient Motion Corrected","00189764":"Count Loss Normalization Corrected","00189765":"Randoms Corrected","00189766":"Non Uniform Radial Sampling Corrected","00189767":"Sensitivity Calibrated","00189768":"Detector Normalization Correction","00189769":"Iterative Reconstruction Method","00189770":"Attenuation Correction Temporal Relationship","00189771":"Patient Physiological State Sequence","00189772":"Patient Physiological State Code Sequence","00189801":"Depths of Focus","00189803":"Excluded Intervals Sequence","00189804":"Exclusion Start Datetime","00189805":"Exclusion Duration","00189806":"US Image Description Sequence","00189807":"Image Data Type Sequence","00189808":"Data Type","00189809":"Transducer Scan Pattern Code Sequence","0018980B":"Aliased Data Type","0018980C":"Position Measuring Device Used","0018980D":"Transducer Geometry Code Sequence","0018980E":"Transducer Beam Steering Code Sequence","0018980F":"Transducer Application Code Sequence","0018A001":"Contributing Equipment Sequence","0018A002":"Contribution Date Time","0018A003":"Contribution Description","001910BB":"UserData21","001910BC":"UserData22","001910BD":"UserData23","001910BE":"ProjectionAngle","001910C0":"SaturationPlanes","001910C1":"SurfaceCoilIntensity","001910C2":"SATLocationR","001910C3":"SATLocationL","001910C4":"SATLocationA","001910C5":"SATLocationP","001910C6":"SATLocationH","001910C7":"SATLocationF","001910C8":"SATThicknessR-L","001910C9":"SATThicknessA-P","001910CA":"SATThicknessH-F","001910CB":"PrescribedFlowAxis","001910CC":"VelocityEncoding","001910CD":"ThicknessDisclaimer","001910CE":"PrescanType","001910CF":"PrescanStatus","001910D0":"RawDataType","001910D2":"ProjectionAlgorithm","001910D3":"ProjectionAlgorithm","001910D5":"FractionalEcho","001910D6":"PrepPulse","001910D7":"CardiacPhases","001910D8":"VariableEchoflag","001910D9":"ConcatenatedSAT","001910DA":"ReferenceChannelUsed","001910DB":"BackProjectorCoefficient","001910DC":"PrimarySpeedCorrectionUsed","001910DD":"OverrangeCorrectionUsed","001910DE":"DynamicZAlphaValue","001910DF":"UserData","001910E0":"UserData","001910E2":"VelocityEncodeScale","001910F2":"FastPhases","001910F9":"TransmissionGain","0020000D":"Study Instance UID","0020000E":"Series Instance UID","00200010":"Study ID","00200011":"Series Number","00200012":"Acquisition Number","00200013":"Instance Number","00200014":"Isotope Number","00200015":"Phase Number","00200016":"Interval Number","00200017":"Time Slot Number","00200018":"Angle Number","00200019":"Item Number","00200020":"Patient Orientation","00200022":"Overlay Number","00200024":"Curve Number","00200026":"LUT Number","00200030":"Image Position","00200032":"Image Position Patient","00200035":"Image Orientation","00200037":"Image Orientation Patient","00200050":"Location","00200052":"Frame of Reference UID","00200060":"Laterality","00200062":"Image Laterality","00200070":"Image Geometry Type","00200080":"Masking Image","002000AA":"Report Number","00200100":"Temporal Position Identifier","00200105":"Number of Temporal Positions","00200110":"Temporal Resolution","00200200":"Synchronization Frame of Reference UID","00200242":"SOP Instance UID of Concatenation Source","00201000":"Series in Study","00201001":"Acquisitions in Series","00201002":"Images in Acquisition","00201003":"Images in Series","00201004":"Acquisitions in Study","00201005":"Images in Study","00201020":"Reference","00201040":"Position Reference Indicator","00201041":"Slice Location","00201070":"Other Study Numbers","00201200":"Number of Patient Related Studies","00201202":"Number of Patient Related Series","00201204":"Number of Patient Related Instances","00201206":"Number of Study Related Series","00201208":"Number of Study Related Instances","00201209":"Number of Series Related Instances","002031XX":"Source Image IDs","00203401":"Modifying Device ID","00203402":"Modified Image ID","00203403":"Modified Image Date","00203404":"Modifying Device Manufacturer","00203405":"Modified Image Time","00203406":"Modified Image Description","00204000":"Image Comments","00205000":"Original Image Identification","00205002":"Original Image Identification Nomenclature","00209056":"Stack ID","00209057":"In Stack Position Number","00209071":"Frame Anatomy Sequence","00209072":"Frame Laterality","00209111":"Frame Content Sequence","00209113":"Plane Position Sequence","00209116":"Plane Orientation Sequence","00209128":"Temporal Position Index","00209153":"Nominal Cardiac Trigger Delay Time","00209154":"Nominal Cardiac Trigger Time Prior to R-Peak","00209155":"Actual Cardiac Trigger Time Prior to R-Peak","00209156":"Frame Acquisition Number","00209157":"Dimension Index Values","00209158":"Frame Comments","00209161":"Concatenation UID","00209162":"In Concatenation Number","00209163":"In Concatenation Total Number","00209164":"Dimension Organization UID","00209165":"Dimension Index Pointer","00209167":"Functional Group Pointer","00209213":"Dimension Index Private Creator","00209221":"Dimension Organization Sequence","00209222":"Dimension Index Sequence","00209228":"Concatenation Frame Offset Number","00209238":"Functional Group Private Creator","00209241":"Nominal Percentage of Cardiac Phase","00209245":"Nominal Percentage of Respiratory Phase","00209246":"Starting Respiratory Amplitude","00209247":"Starting Respiratory Phase","00209248":"Ending Respiratory Amplitude","00209249":"Ending Respiratory Phase","00209250":"Respiratory Trigger Type","00209251":"R-R Interval Time Nominal","00209252":"Actual Cardiac Trigger Delay Time","00209253":"Respiratory Synchronization Sequence","00209254":"Respiratory Interval Time","00209255":"Nominal Respiratory Trigger Delay Time","00209256":"Respiratory Trigger Delay Threshold","00209257":"Actual Respiratory Trigger Delay Time","00209301":"Image Position Volume","00209302":"Image Orientation Volume","00209307":"Ultrasound Acquisition Geometry","00209308":"Apex Position","00209309":"Volume to Transducer Mapping Matrix","0020930A":"Volume to Table Mapping Matrix","0020930C":"Patient Frame of Reference Source","0020930D":"Temporal Position Time Offset","0020930E":"Plane Position Volume Sequence","0020930F":"Plane Orientation Volume Sequence","00209310":"Temporal Position Sequence","00209311":"Dimension Organization Type","00209312":"Volume Frame of Reference UID","00209313":"Table Frame of Reference UID","00209421":"Dimension Description Label","00209450":"Patient Orientation in Frame Sequence","00209453":"Frame Label","00209518":"Acquisition Index","00209529":"Contributing SOP Instances Reference Sequence","00209536":"Reconstruction Index","00220001":"Light Path Filter Pass-Through Wavelength","00220002":"Light Path Filter Pass Band","00220003":"Image Path Filter Pass-Through Wavelength","00220004":"Image Path Filter Pass Band","00220005":"Patient Eye Movement Commanded","00220006":"Patient Eye Movement Command Code Sequence","00220007":"Spherical Lens Power","00220008":"Cylinder Lens Power","00220009":"Cylinder Axis","0022000A":"Emmetropic Magnification","0022000B":"Intra Ocular Pressure","0022000C":"Horizontal Field of View","0022000D":"Pupil Dilated","0022000E":"Degree of Dilation","00220010":"Stereo Baseline Angle","00220011":"Stereo Baseline Displacement","00220012":"Stereo Horizontal Pixel Offset","00220013":"Stereo Vertical Pixel Offset","00220014":"Stereo Rotation","00220015":"Acquisition Device Type Code Sequence","00220016":"Illumination Type Code Sequence","00220017":"Light Path Filter Type Stack Code Sequence","00220018":"Image Path Filter Type Stack Code Sequence","00220019":"Lenses Code Sequence","0022001A":"Channel Description Code Sequence","0022001B":"Refractive State Sequence","0022001C":"Mydriatic Agent Code Sequence","0022001D":"Relative Image Position Code Sequence","0022001E":"Camera Angle of View","00220020":"Stereo Pairs Sequence","00220021":"Left Image Sequence","00220022":"Right Image Sequence","00220030":"Axial Length of The Eye","00220031":"Ophthalmic Frame Location Sequence","00220032":"Reference Coordinates","00220035":"Depth Spatial Resolution","00220036":"Maximum Depth Distortion","00220037":"Along-scan Spatial Resolution","00220038":"Maximum Along-scan Distortion","00220039":"Ophthalmic Image Orientation","00220041":"Depth of Transverse Image","00220042":"Mydriatic Agent Concentration Units Sequence","00220048":"Across Scan Spatial Resolution","00220049":"Maximum Across Scan Distortion","0022004E":"Mydriatic Agent Concentration","00220055":"Illumination Wave Length","00220056":"Illumination Power","00220057":"Illumination Bandwidth","00220058":"Mydriatic Agent Sequence","00221007":"Ophthalmic Axial Measurements Right Eye Sequence","00221008":"Ophthalmic Axial Measurements Left Eye Sequence","00221010":"Ophthalmic Axial Length Measurements Type","00221019":"Ophthalmic Axial Length","00221024":"Lens Status Code Sequence","00221025":"Vitreous Status Code Sequence","00221028":"IOL Formula Code Sequence","00221029":"IOL Formula Detail","00221033":"Keratometer Index","00221035":"Source of Ophthalmic Axial Length Code Sequence","00221037":"Target Refraction","00221039":"Refractive Procedure Occurred","00221040":"Refractive Surgery Type Code Sequence","00221044":"Ophthalmic Ultrasound Axial Measurements Type Code Sequence","00221050":"Ophthalmic Axial Length Measurements Sequence","00221053":"IOL Power","00221054":"Predicted Refractive Error","00221059":"Ophthalmic Axial Length Velocity","00221065":"Lens Status Description","00221066":"Vitreous Status Description","00221090":"IOL Power Sequence","00221092":"Lens Constant Sequence","00221093":"IOL Manufacturer","00221094":"Lens Constant Description","00221096":"Keratometry Measurement Type Code Sequence","00221100":"Referenced Ophthalmic Axial Measurements Sequence","00221101":"Ophthalmic Axial Length Measurements Segment Name Code Sequence","00221103":"Refractive Error Before Refractive Surgery Code Sequence","00221121":"IOL Power for Exact Emmetropia","00221122":"IOL Power for Exact Target Refraction","00221125":"Anterior Chamber Depth Definition Code Sequence","00221130":"Lens Thickness","00221131":"Anterior Chamber Depth","00221132":"Source of Lens Thickness Data Code Sequence","00221133":"Source of Anterior Chamber Depth Data Code Sequence","00221135":"Source of Refractive Error Data Code Sequence","00221140":"Ophthalmic Axial Length Measurement Modified","00221150":"Ophthalmic Axial Length Data Source Code Sequence","00221153":"Ophthalmic Axial Length Acquisition Method Code Sequence","00221155":"Signal to Noise Ratio","00221159":"Ophthalmic Axial Length Data Source Description","00221210":"Ophthalmic Axial Length Measurements Total Length Sequence","00221211":"Ophthalmic Axial Length Measurements Segmental Length Sequence","00221212":"Ophthalmic Axial Length Measurements Length Summation Sequence","00221220":"Ultrasound Ophthalmic Axial Length Measurements Sequence","00221225":"Optical Ophthalmic Axial Length Measurements Sequence","00221230":"Ultrasound Selected Ophthalmic Axial Length Sequence","00221250":"Ophthalmic Axial Length Selection Method Code Sequence","00221255":"Optical Selected Ophthalmic Axial Length Sequence","00221257":"Selected Segmental Ophthalmic Axial Length Sequence","00221260":"Selected Total Ophthalmic Axial Length Sequence","00221262":"Ophthalmic Axial Length Quality Metric Sequence","00221273":"Ophthalmic Axial Length Quality Metric Type Description","00221300":"Intraocular Lens Calculations Right Eye Sequence","00221310":"Intraocular Lens Calculations Left Eye Sequence","00221330":"Referenced Ophthalmic Axial Length Measurement QC Image Sequence","00240010":"Visual Field Horizontal Extent","00240011":"Visual Field Vertical Extent","00240012":"Visual Field Shape","00240016":"Screening Test Mode Code Sequence","00240018":"Maximum Stimulus Luminance","00240020":"Background Luminance","00240021":"Stimulus Color Code Sequence","00240024":"Background Illumination Color Code Sequence","00240025":"Stimulus Area","00240028":"Stimulus Presentation Time","00240032":"Fixation Sequence","00240033":"Fixation Monitoring Code Sequence","00240034":"Visual Field Catch Trial Sequence","00240035":"Fixation Checked Quantity","00240036":"Patient Not Properly Fixated Quantity","00240037":"Presented Visual Stimuli Data Flag","00240038":"Number of Visual Stimuli","00240039":"Excessive Fixation Losses Data Flag","00240040":"Excessive Fixation Losses","00240042":"Stimuli Retesting Quantity","00240044":"Comments On Patient Performance of Visual Field","00240045":"False Negatives Estimate Flag","00240046":"False Negatives Estimate","00240048":"Negative Catch Trials Quantity","00240050":"False Negatives Quantity","00240051":"Excessive False Negatives Data Flag","00240052":"Excessive False Negatives","00240053":"False Positives Estimate Flag","00240054":"False Positives Estimate","00240055":"Catch Trials Data Flag","00240056":"Positive Catch Trials Quantity","00240057":"Test Point Normals Data Flag","00240058":"Test Point Normals Sequence","00240059":"Global Deviation Probability Normals Flag","00240060":"False Positives Quantity","00240061":"Excessive False Positives Data Flag","00240062":"Excessive False Positives","00240063":"Visual Field Test Normals Flag","00240064":"Results Normals Sequence","00240065":"Age Corrected Sensitivity Deviation Algorithm Sequence","00240066":"Global Deviation From Normal","00240067":"Generalized Defect Sensitivity Deviation Algorithm Sequence","00240068":"Localized Deviationfrom Normal","00240069":"Patient Reliability Indicator","00240070":"Visual Field Mean Sensitivity","00240071":"Global Deviation Probability","00240072":"Local Deviation Probability Normals Flag","00240073":"Localized Deviation Probability","00240074":"Short Term Fluctuation Calculated","00240075":"Short Term Fluctuation","00240076":"Short Term Fluctuation Probability Calculated","00240077":"Short Term Fluctuation Probability","00240078":"Corrected Localized Deviation From Normal Calculated","00240079":"Corrected Localized Deviation From Normal","00240080":"Corrected Localized Deviation From Normal Probability Calculated","00240081":"Corrected Localized Deviation From Normal Probability","00240083":"Global Deviation Probability Sequence","00240085":"Localized Deviation Probability Sequence","00240086":"Foveal Sensitivity Measured","00240087":"Foveal Sensitivity","00240088":"Visual Field Test Duration","00240089":"Visual Field Test Point Sequence","00240090":"Visual Field Test Point X Coordinate","00240091":"Visual Field Test Point Y Coordinate","00240092":"Age Corrected Sensitivity Deviation Value","00240093":"Stimulus Results","00240094":"Sensitivity Value","00240095":"Retest Stimulus Seen","00240096":"Retest Sensitivity Value","00240097":"Visual Field Test Point Normals Sequence","00240098":"Quantified Defect","00240100":"Age Corrected Sensitivity Deviation Probability Value","00240102":"Generalized Defect Corrected Sensitivity Deviation Flag ","00240103":"Generalized Defect Corrected Sensitivity Deviation Value ","00240104":"Generalized Defect Corrected Sensitivity Deviation Probability Value","00240105":"Minimum Sensitivity Value","00240106":"Blind Spot Localized","00240107":"Blind Spot X Coordinate","00240108":"Blind Spot Y Coordinate ","00240110":"Visual Acuity Measurement Sequence","00240112":"Refractive Parameters Used On Patient Sequence","00240113":"Measurement Laterality","00240114":"Ophthalmic Patient Clinical Information Left Eye Sequence","00240115":"Ophthalmic Patient Clinical Information Right Eye Sequence","00240117":"Foveal Point Normative Data Flag","00240118":"Foveal Point Probability Value","00240120":"Screening Baseline Measured","00240122":"Screening Baseline Measured Sequence","00240124":"Screening Baseline Type","00240126":"Screening Baseline Value","00240202":"Algorithm Source","00240306":"Data Set Name","00240307":"Data Set Version","00240308":"Data Set Source","00240309":"Data Set Description","00240317":"Visual Field Test Reliability Global Index Sequence","00240320":"Visual Field Global Results Index Sequence","00240325":"Data Observation Sequence","00240338":"Index Normals Flag","00240341":"Index Probability","00240344":"Index Probability Sequence","00271006":"ImageArchiveFlag","00271010":"ScoutType","0027101C":"VmaMamp","0027101D":"VmaPhase","0027101E":"VmaMod","0027101F":"VmaClip","00271020":"SmartScanOnOffFlag","00271030":"ForeignImageRevision","00271031":"ImagingMode","00271032":"PulseSequence","00271033":"ImagingOptions","00271035":"PlaneType","00271036":"ObliquePlane","00271040":"RASLetterOfImageLocation","00271041":"ImageLocation","00271042":"CenterRCoordOfPlaneImage","00271043":"CenterACoordOfPlaneImage","00271044":"CenterSCoordOfPlaneImage","00271045":"NormalRCoord","00271046":"NormalACoord","00271047":"NormalSCoord","00271048":"RCoordOfTopRightCorner","00271049":"ACoordOfTopRightCorner","0027104A":"SCoordOfTopRightCorner","0027104B":"RCoordOfBottomRightCorner","0027104C":"ACoordOfBottomRightCorner","0027104D":"SCoordOfBottomRightCorner","00271050":"TableStartLocation","00271051":"TableEndLocation","00271052":"RASLetterForSideOfImage","00271053":"RASLetterForAnteriorPosterior","00271054":"RASLetterForScoutStartLoc","00271055":"RASLetterForScoutEndLoc","00271060":"ImageDimensionX","00271061":"ImageDimensionY","00271062":"NumberOfExcitations","00280002":"Samples Per Pixel","00280003":"Samples Per Pixel Used","00280004":"Photometric Interpretation","00280005":"Image Dimensions","00280006":"Planar Configuration","00280008":"Number of Frames","00280009":"Frame Increment Pointer","0028000A":"Frame Dimension Pointer","00280010":"Rows","00280011":"Columns","00280012":"Planes","00280014":"Ultrasound Color Data Present","00280030":"Pixel Spacing","00280031":"Zoom Factor","00280032":"Zoom Center","00280034":"Pixel Aspect Ratio","00280040":"Image Format","00280050":"Manipulated Image","00280051":"Corrected Image","0028005F":"Compression Recognition Code","00280060":"Compression Code","00280061":"Compression Originator","00280062":"Compression Label","00280063":"Compression Description","00280065":"Compression Sequence","00280066":"Compression Step Pointers","00280068":"Repeat Interval","00280069":"Bits Grouped","00280070":"Perimeter Table","00280071":"Perimeter Value","00280080":"Predictor Rows","00280081":"Predictor Columns","00280082":"Predictor Constants","00280090":"Blocked Pixels","00280091":"Block Rows","00280092":"Block Columns","00280093":"Row Overlap","00280094":"Column Overlap","00280100":"Bits Allocated","00280101":"Bits Stored","00280102":"High Bit","00280103":"Pixel Representation","00280104":"Smallest Valid Pixel Value","00280105":"Largest Valid Pixel Value","00280106":"Smallest Image Pixel Value","00280107":"Largest Image Pixel Value","00280108":"Smallest Pixel Value in Series","00280109":"Largest Pixel Value in Series","00280110":"Smallest Image Pixel Value in Plane","00280111":"Largest Image Pixel Value in Plane","00280120":"Pixel Padding Value","00280121":"Pixel Padding Range Limit","00280200":"Image Location","00280300":"Quality Control Image","00280301":"Burned in Annotation","00280302":"Recognizable Visual Features","00280303":"Longitudinal Temporal Information Modified","00280400":"Transform Label","00280401":"Transform Version Number","00280402":"Number of Transform Steps","00280403":"Sequence of Compressed Data","00280404":"Details of Coefficients","002804x0":"Rows for Nth Order Coefficients","002804x1":"Columns for Nth Order Coefficients","002804x2":"Coefficient Coding","002804x3":"Coefficient Coding Pointers","00280700":"DCT Label","00280701":"Data Block Description","00280702":"Data Block","00280710":"Normalization Factor Format","00280720":"Zonal Map Number Format","00280721":"Zonal Map Location","00280722":"Zonal Map Format","00280730":"Adaptive Map Format","00280740":"Code Number Format","002808x0":"Code Label","002808x2":"Number of Tables","002808x3":"Code Table Location","002808x4":"Bits for Code Word","002808x8":"Image Data Location","00280A02":"Pixel Spacing Calibration Type","00280A04":"Pixel Spacing Calibration Description","00281040":"Pixel Intensity Relationship","00281041":"Pixel Intensity Relationship Sign","00281050":"Window Center","00281051":"Window Width","00281052":"Rescale Intercept","00281053":"Rescale Slope","00281054":"Rescale Type","00281055":"Window Center Width Explanation","00281056":"VOI LUT Function","00281080":"Gray Scale","00281090":"Recommended Viewing Mode","00281100":"Gray Lookup Table Descriptor","00281101":"Red Palette Color Lookup Table Descriptor","00281102":"Green Palette Color Lookup Table Descriptor","00281103":"Blue Palette Color Lookup Table Descriptor","00281104":"Alpha Palette Color Lookup Table Descriptor","00281111":"Large Red Palette Color Lookup Table Descriptor","00281112":"Large Green Palette Color Lookup Table Descriptor","00281113":"Large Blue Palette Color Lookup Table Descriptor","00281199":"Palette Color Lookup Table UID","00281200":"Gray Lookup Table Data","00281201":"Red Palette Color Lookup Table Data","00281202":"Green Palette Color Lookup Table Data","00281203":"Blue Palette Color Lookup Table Data","00281204":"Alpha Palette Color Lookup Table Data","00281211":"Large Red Palette Color Lookup Table Data","00281212":"Large Green Palette Color Lookup Table Data","00281213":"Large Blue Palette Color Lookup Table Data","00281214":"Large Palette Color Lookup Table UID","00281221":"Segmented Red Palette Color Lookup Table Data","00281222":"Segmented Green Palette Color Lookup Table Data","00281223":"Segmented Blue Palette Color Lookup Table Data","00281300":"Breast Implant Present","00281350":"Partial View","00281351":"Partial View Description","00281352":"Partial View Code Sequence","0028135A":"Spatial Locations Preserved","00281401":"Data Frame Assignment Sequence","00281402":"Data Path Assignment","00281403":"Bits Mapped to Color Lookup Table","00281404":"Blending LUT 1 Sequence","00281405":"Blending LUT 1 Transfer Function","00281406":"Blending Weight Constant","00281407":"Blending Lookup Table Descriptor","00281408":"Blending Lookup Table Data","0028140B":"Enhanced Palette Color Lookup Table Sequence","0028140C":"Blending LUT 2 Sequence","0028140D":"Blending LUT 2 Transfer Function","0028140E":"Data Path ID","0028140F":"RGB LUT Transfer Function","00281410":"Alpha LUT Transfer Function","00282000":"ICC Profile","00282110":"Lossy Image Compression","00282112":"Lossy Image Compression Ratio","00282114":"Lossy Image Compression Method","00283000":"Modality LUT Sequence","00283002":"LUT Descriptor","00283003":"LUT Explanation","00283004":"Modality LUT Type","00283006":"LUT Data","00283010":"VOI LUT Sequence","00283110":"Softcopy VOI LUT Sequence","00284000":"Image Presentation Comments","00285000":"Bi Plane Acquisition Sequence","00286010":"Representative Frame Number","00286020":"Frame Numbers of Interest","00286022":"Frame of Interest Description","00286023":"Frame of Interest Type","00286030":"Mask Pointers","00286040":"R Wave Pointer","00286100":"Mask Subtraction Sequence","00286101":"Mask Operation","00286102":"Applicable Frame Range","00286110":"Mask Frame Numbers","00286112":"Contrast Frame Averaging","00286114":"Mask Sub Pixel Shift","00286120":"TID Offset","00286190":"Mask Operation Explanation","00287FE0":"Pixel Data Provider URL","00289001":"Data Point Rows","00289002":"Data Point Columns","00289003":"Signal Domain Columns","00289099":"Largest Monochrome Pixel Value","00289108":"Data Representation","00289110":"Pixel Measures Sequence","00289132":"Frame VOI LUT Sequence","00289145":"Pixel Value Transformation Sequence","00289235":"Signal Domain Rows","00289411":"Display Filter Percentage","00289415":"Frame Pixel Shift Sequence","00289416":"Subtraction Item ID","00289422":"Pixel Intensity Relationship LUT Sequence","00289443":"Frame Pixel Data Properties Sequence","00289444":"Geometrical Properties","00289445":"Geometric Maximum Distortion","00289446":"Image Processing Applied","00289454":"Mask Selection Mode","00289474":"LUT Function","00289478":"Mask Visibility Percentage","00289501":"Pixel Shift Sequence","00289502":"Region Pixel Shift Sequence","00289503":"Vertices of The Region","00289505":"Multi Frame Presentation Sequence","00289506":"Pixel Shift Frame Range","00289507":"LUT Frame Range","00289520":"Image to Equipment Mapping Matrix","00289537":"Equipment Coordinate System Identification","0032000A":"Study Status ID","0032000C":"Study Priority ID","00320012":"Study ID Issuer","00320032":"Study Verified Date","00320033":"Study Verified Time","00320034":"Study Read Date","00320035":"Study Read Time","00321000":"Scheduled Study Start Date","00321001":"Scheduled Study Start Time","00321010":"Scheduled Study Stop Date","00321011":"Scheduled Study Stop Time","00321020":"Scheduled Study Location","00321021":"Scheduled Study Location AE Title","00321030":"Reason for Study","00321031":"Requesting Physician Identification Sequence","00321032":"Requesting Physician","00321033":"Requesting Service","00321034":"Requesting Service Code Sequence","00321040":"Study Arrival Date","00321041":"Study Arrival Time","00321050":"Study Completion Date","00321051":"Study Completion Time","00321055":"Study Component Status ID","00321060":"Requested Procedure Description","00321064":"Requested Procedure Code Sequence","00321070":"Requested Contrast Agent","00324000":"Study Comments","00380004":"Referenced Patient Alias Sequence","00380008":"Visit Status ID","00380010":"Admission ID","00380011":"Issuer of Admission ID","00380014":"Issuer of Admission ID Sequence","00380016":"Route of Admissions","0038001A":"Scheduled Admission Date","0038001B":"Scheduled Admission Time","0038001C":"Scheduled Discharge Date","0038001D":"Scheduled Discharge Time","0038001E":"Scheduled Patient Institution Residence","00380020":"Admitting Date","00380021":"Admitting Time","00380030":"Discharge Date","00380032":"Discharge Time","00380040":"Discharge Diagnosis Description","00380044":"Discharge Diagnosis Code Sequence","00380050":"Special Needs","00380060":"Service Episode ID","00380061":"Issuer of Service Episode ID","00380062":"Service Episode Description","00380064":"Issuer of Service Episode ID Sequence","00380100":"Pertinent Documents Sequence","00380300":"Current Patient Location","00380400":"Patient Institution Residence","00380500":"Patient State","00380502":"Patient Clinical Trial Participation Sequence","00384000":"Visit Comments","003A0004":"Waveform Originality","003A0005":"Number of Waveform Channels","003A0010":"Number of Waveform Samples","003A001A":"Sampling Frequency","003A0020":"Multiplex Group Label","003A0200":"Channel Definition Sequence","003A0202":"Waveform Channel Number","003A0203":"Channel Label","003A0205":"Channel Status","003A0208":"Channel Source Sequence","003A0209":"Channel Source Modifiers Sequence","003A020A":"Source Waveform Sequence","003A020C":"Channel Derivation Description","003A0210":"Channel Sensitivity","003A0211":"Channel Sensitivity Units Sequence","003A0212":"Channel Sensitivity Correction Factor","003A0213":"Channel Baseline","003A0214":"Channel Time Skew","003A0215":"Channel Sample Skew","003A0218":"Channel Offset","003A021A":"Waveform Bits Stored","003A0220":"Filter Low Frequency","003A0221":"Filter High Frequency","003A0222":"Notch Filter Frequency","003A0223":"Notch Filter Bandwidth","003A0230":"Waveform Data Display Scale","003A0231":"Waveform Display Background CIELab Value","003A0240":"Waveform Presentation Group Sequence","003A0241":"Presentation Group Number","003A0242":"Channel Display Sequence","003A0244":"Channel Recommended Display CIELab Value","003A0245":"Channel Position","003A0246":"Display Shading Flag","003A0247":"Fractional Channel Display Scale","003A0248":"Absolute Channel Display Scale","003A0300":"Multiplexed Audio Channels Description Code Sequence","003A0301":"Channel Identification Code","003A0302":"Channel Mode","00400001":"Scheduled Station AE Title","00400002":"Scheduled Procedure Step Start Date","00400003":"Scheduled Procedure Step Start Time","00400004":"Scheduled Procedure Step End Date","00400005":"Scheduled Procedure Step End Time","00400006":"Scheduled Performing Physician's Name","00400007":"Scheduled Procedure Step Description","00400008":"Scheduled Protocol Code Sequence","00400009":"Scheduled Procedure Step ID","0040000A":"Stage Code Sequence","0040000B":"Scheduled Performing Physician Identification Sequence","00400010":"Scheduled Station Name","00400011":"Scheduled Procedure Step Location","00400012":"Pre Medication","00400020":"Scheduled Procedure Step Status","00400026":"Order Placer Identifier Sequence","00400027":"Order Filler Identifier Sequence","00400031":"Local Namespace Entity ID","00400032":"Universal Entity ID","00400033":"Universal Entity ID Type","00400035":"Identifier Type Code","00400036":"Assigning Facility Sequence","00400039":"Assigning Jurisdiction Code Sequence","0040003A":"Assigning Agency or Department Code Sequence","00400100":"Scheduled Procedure Step Sequence","00400220":"Referenced Non-Image Composite SOP Instance Sequence","00400241":"Performed Station AE Title","00400242":"Performed Station Name","00400243":"Performed Location","00400244":"Performed Procedure Step Start Date","00400245":"Performed Procedure Step Start Time","00400250":"Performed Procedure Step End Date","00400251":"Performed Procedure Step End Time","00400252":"Performed Procedure Step Status","00400253":"Performed Procedure Step ID","00400254":"Performed Procedure Step Description","00400255":"Performed Procedure Type Description","00400260":"Performed Protocol Code Sequence","00400261":"Performed Protocol Type","00400270":"Scheduled Step Attributes Sequence","00400275":"Request Attributes Sequence","00400280":"Comments On The Performed Procedure Step","00400281":"Performed Procedure Step Discontinuation Reason Code Sequence","00400293":"Quantity Sequence","00400294":"Quantity","00400295":"Measuring Units Sequence","00400296":"Billing Item Sequence","00400300":"Total Time of Fluoroscopy","00400301":"Total Number of Exposures","00400302":"Entrance Dose","00400303":"Exposed Area","00400306":"Distance Source to Entrance","00400307":"Distance Source to Support","0040030E":"Exposure Dose Sequence","00400310":"Comments On Radiation Dose","00400312":"X-Ray Output","00400314":"Half Value Layer","00400316":"Organ Dose","00400318":"Organ Exposed","00400320":"Billing Procedure Step Sequence","00400321":"Film Consumption Sequence","00400324":"Billing Supplies and Devices Sequence","00400330":"Referenced Procedure Step Sequence","00400340":"Performed Series Sequence","00400400":"Comments On The Scheduled Procedure Step","00400440":"Protocol Context Sequence","00400441":"Content Item Modifier Sequence","00400500":"Scheduled Specimen Sequence","0040050A":"Specimen Accession Number","00400512":"Container Identifier","00400513":"Issuer of The Container Identifier Sequence","00400515":"Alternate Container Identifier Sequence","00400518":"Container Type Code Sequence","0040051A":"Container Description","00400520":"Container Component Sequence","00400550":"Specimen Sequence","00400551":"Specimen Identifier","00400552":"Specimen Description Sequence (Trial)","00400553":"Specimen Description (Trial)","00400554":"Specimen UID","00400555":"Acquisition Context Sequence","00400556":"Acquisition Context Description","00400560":"Specimen Description Sequence","00400562":"Issuer of The Specimen Identifier Sequence","0040059A":"Specimen Type Code Sequence","00400600":"Specimen Short Description","00400602":"Specimen Detailed Description","00400610":"Specimen Preparation Sequence","00400612":"Specimen Preparation Step Content Item Sequence","00400620":"Specimen Localization Content Item Sequence","004006FA":"Slide Identifier","0040071A":"Image Center Point Coordinates Sequence","0040072A":"X Offset in Slide Coordinate System","0040073A":"Y Offset in Slide Coordinate System","0040074A":"Z Offset in Slide Coordinate System","004008D8":"Pixel Spacing Sequence","004008DA":"Coordinate System Axis Code Sequence","004008EA":"Measurement Units Code Sequence","004009F8":"Vital Stain Code Sequence (Trial)","00401001":"Requested Procedure ID","00401002":"Reason for The Requested Procedure","00401003":"Requested Procedure Priority","00401004":"Patient Transport Arrangements","00401005":"Requested Procedure Location","00401006":"Placer Order Number Procedure","00401007":"Filler Order Number Procedure","00401008":"Confidentiality Code","00401009":"Reporting Priority","0040100A":"Reason for Requested Procedure Code Sequence","00401010":"Names of Intended Recipients of Results","00401011":"Intended Recipients of Results Identification Sequence","00401012":"Reason for Performed Procedure Code Sequence","00401060":"Requested Procedure Description (Trial)","00401101":"Person's Identification Code Sequence","00401102":"Person's Address","00401103":"Person's Telephone Numbers","00401400":"Requested Procedure Comments","00402001":"Reason for The Imaging Service Request","00402004":"Issue Date of Imaging Service Request","00402005":"Issue Time of Imaging Service Request","00402006":"Placer Order Number Imaging Service Request (Retired)","00402007":"Filler Order Number Imaging Service Request (Retired)","00402008":"Order Entered By","00402009":"Order Enterer Location","00402010":"Order Callback Phone Number","00402016":"Placer Order Number Imaging Service Request","00402017":"Filler Order Number Imaging Service Request","00402400":"Imaging Service Request Comments","00403001":"Confidentiality Constraint On Patient Data Description","00404001":"General Purpose Scheduled Procedure Step Status","00404002":"General Purpose Performed Procedure Step Status","00404003":"General Purpose Scheduled Procedure Step Priority","00404004":"Scheduled Processing Applications Code Sequence","00404005":"Scheduled Procedure Step Start Date Time","00404006":"Multiple Copies Flag","00404007":"Performed Processing Applications Code Sequence","00404009":"Human Performer Code Sequence","00404010":"Scheduled Procedure Step Modification Date Time","00404011":"Expected Completion Date Time","00404015":"Resulting General Purpose Performed Procedure Steps Sequence","00404016":"Referenced General Purpose Scheduled Procedure Step Sequence","00404018":"Scheduled Workitem Code Sequence","00404019":"Performed Workitem Code Sequence","00404020":"Input Availability Flag","00404021":"Input Information Sequence","00404022":"Relevant Information Sequence","00404023":"Referenced General Purpose Scheduled Procedure Step Transaction UID","00404025":"Scheduled Station Name Code Sequence","00404026":"Scheduled Station Class Code Sequence","00404027":"Scheduled Station Geographic Location Code Sequence","00404028":"Performed Station Name Code Sequence","00404029":"Performed Station Class Code Sequence","00404030":"Performed Station Geographic Location Code Sequence","00404031":"Requested Subsequent Workitem Code Sequence","00404032":"Non-DICOM Output Code Sequence","00404033":"Output Information Sequence","00404034":"Scheduled Human Performers Sequence","00404035":"Actual Human Performers Sequence","00404036":"Human Performer Organization","00404037":"Human Performer Name","00404040":"Raw Data Handling","00404041":"Input Readiness State","00404050":"Performed Procedure Step Start Date Time","00404051":"Performed Procedure Step End Date Time","00404052":"Procedure Step Cancellation Date Time","00408302":"Entrance Dose In mGy","00409094":"Referenced Image Real World Value Mapping Sequence","00409096":"Real World Value Mapping Sequence","00409098":"Pixel Value Mapping Code Sequence","00409210":"LUT Label","00409211":"Real World Value Last Value Mapped","00409212":"Real World Value LUT Data","00409216":"Real World Value First Value Mapped","00409224":"Real World Value Intercept","00409225":"Real World Value Slope","0040A007":"Findings Flag (Trial)","0040A010":"Relationship Type","0040A020":"Findings Sequence (Trial)","0040A021":"Findings Group UID (Trial)","0040A022":"Referenced Findings Group UID (Trial)","0040A023":"Findings Group Recording Date (Trial)","0040A024":"Findings Group Recording Time (Trial)","0040A026":"Findings Source Category Code Sequence (Trial)","0040A027":"Verifying Organization","0040A028":"Documenting Organization Identifier Code Sequence (Trial)","0040A030":"Verification Date Time","0040A032":"Observation Date Time","0040A040":"Value Type","0040A043":"Concept Name Code Sequence","0040A047":"Measurement Precision Description (Trial)","0040A050":"Continuity of Content","0040A057":"Urgency or Priority Alerts (Trial)","0040A060":"Sequencing Indicator (Trial)","0040A066":"Document Identifier Code Sequence (Trial)","0040A067":"Document Author (Trial)","0040A068":"Document Author Identifier Code Sequence (Trial)","0040A070":"Identifier Code Sequence (Trial)","0040A073":"Verifying Observer Sequence","0040A074":"Object Binary Identifier (Trial)","0040A075":"Verifying Observer Name","0040A076":"Documenting Observer Identifier Code Sequence (Trial)","0040A078":"Author Observer Sequence","0040A07A":"Participant Sequence","0040A07C":"Custodial Organization Sequence","0040A080":"Participation Type","0040A082":"Participation Date Time","0040A084":"Observer Type","0040A085":"Procedure Identifier Code Sequence (Trial)","0040A088":"Verifying Observer Identification Code Sequence","0040A089":"Object Directory Binary Identifier (Trial)","0040A090":"Equivalent CDA Document Sequence","0040A0B0":"Referenced Waveform Channels","0040A110":"Date of Document or Verbal Transaction (Trial)","0040A112":"Time of Document Creation or Verbal Transaction (Trial)","0040A120":"Date Time","0040A121":"Date","0040A122":"Time","0040A123":"Person's Name","0040A124":"UID","0040A125":"Report Status ID (Trial)","0040A130":"Temporal Range Type","0040A132":"Referenced Sample Positions","0040A136":"Referenced Frame Numbers","0040A138":"Referenced Time Offsets","0040A13A":"Referenced Date Time","0040A160":"Text Value","0040A167":"Observation Category Code Sequence (Trial)","0040A168":"Concept Code Sequence","0040A16A":"Bibliographic Citation (Trial)","0040A170":"Purpose of Reference Code Sequence","0040A171":"Observation UID (Trial)","0040A172":"Referenced Observation UID (Trial)","0040A173":"Referenced Observation Class (Trial)","0040A174":"Referenced Object Observation Class (Trial)","0040A180":"Annotation Group Number","0040A192":"Observation Date (Trial)","0040A193":"Observation Time (Trial)","0040A194":"Measurement Automation (Trial)","0040A195":"Modifier Code Sequence","0040A224":"Identification Description (Trial)","0040A290":"Coordinates Set Geometric Type (Trial)","0040A296":"Algorithm Code Sequence (Trial)","0040A297":"Algorithm Description (Trial)","0040A29A":"Pixel Coordinates Set (Trial)","0040A300":"Measured Value Sequence","0040A301":"Numeric Value Qualifier Code Sequence","0040A307":"Current Observer (Trial)","0040A30A":"Numeric Value","0040A313":"Referenced Accession Sequence (Trial)","0040A33A":"Report Status Comment (Trial)","0040A340":"Procedure Context Sequence (Trial)","0040A352":"Verbal Source (Trial)","0040A353":"Address (Trial)","0040A354":"Telephone Number (Trial)","0040A358":"Verbal Source Identifier Code Sequence (Trial)","0040A360":"Predecessor Documents Sequence","0040A370":"Referenced Request Sequence","0040A372":"Performed Procedure Code Sequence","0040A375":"Current Requested Procedure Evidence Sequence","0040A380":"Report Detail Sequence (Trial)","0040A385":"Pertinent Other Evidence Sequence","0040A390":"HL7 Structured Document Reference Sequence","0040A402":"Observation Subject UID (Trial)","0040A403":"Observation Subject Class (Trial)","0040A404":"Observation Subject Type Code Sequence (Trial)","0040A491":"Completion Flag","0040A492":"Completion Flag Description","0040A493":"Verification Flag","0040A494":"Archive Requested","0040A496":"Preliminary Flag","0040A504":"Content Template Sequence","0040A525":"Identical Documents Sequence","0040A600":"Observation Subject Context Flag (Trial)","0040A601":"Observer Context Flag (Trial)","0040A603":"Procedure Context Flag (Trial)","0040A730":"Content Sequence","0040A731":"Relationship Sequence (Trial)","0040A732":"Relationship Type Code Sequence (Trial)","0040A744":"Language Code Sequence (Trial)","0040A992":"Uniform Resource Locator (Trial)","0040B020":"Waveform Annotation Sequence","0040DB00":"Template Identifier","0040DB06":"Template Version","0040DB07":"Template Local Version","0040DB0B":"Template Extension Flag","0040DB0C":"Template Extension Organization UID","0040DB0D":"Template Extension Creator UID","0040DB73":"Referenced Content Item Identifier","0040E001":"HL7 Instance Identifier","0040E004":"HL7 Document Effective Time","0040E006":"HL7 Document Type Code Sequence","0040E008":"Document Class Code Sequence","0040E010":"Retrieve URI","0040E011":"Retrieve Location UID","0040E020":"Type of Instances","0040E021":"DICOM Retrieval Sequence","0040E022":"DICOM Media Retrieval Sequence","0040E023":"WADO Retrieval Sequence","0040E024":"XDS Retrieval Sequence","0040E030":"Repository Unique ID","0040E031":"Home Community ID","00420010":"Document Title","00420011":"Encapsulated Document","00420012":"MIME Type of Encapsulated Document","00420013":"Source Instance Sequence","00420014":"List of MIME Types","00440001":"Product Package Identifier","00440002":"Substance Administration Approval","00440003":"Approval Status Further Description","00440004":"Approval Status Date Time","00440007":"Product Type Code Sequence","00440008":"Product Name","00440009":"Product Description","0044000A":"Product Lot Identifier","0044000B":"Product Expiration Date Time","00440010":"Substance Administration Date Time","00440011":"Substance Administration Notes","00440012":"Substance Administration Device ID","00440013":"Product Parameter Sequence","00440019":"Substance Administration Parameter Sequence","00460012":"Lens Description","00460014":"Right Lens Sequence","00460015":"Left Lens Sequence","00460016":"Unspecified Laterality Lens Sequence","00460018":"Cylinder Sequence","00460028":"Prism Sequence","00460030":"Horizontal Prism Power","00460032":"Horizontal Prism Base","00460034":"Vertical Prism Power","00460036":"Vertical Prism Base","00460038":"Lens Segment Type","00460040":"Optical Transmittance","00460042":"Channel Width","00460044":"Pupil Size","00460046":"Corneal Size","00460050":"Autorefraction Right Eye Sequence","00460052":"Autorefraction Left Eye Sequence","00460060":"Distance Pupillary Distance","00460062":"Near Pupillary Distance","00460063":"Intermediate Pupillary Distance","00460064":"Other Pupillary Distance","00460070":"Keratometry Right Eye Sequence","00460071":"Keratometry Left Eye Sequence","00460074":"Steep Keratometric Axis Sequence","00460075":"Radius of Curvature","00460076":"Keratometric Power","00460077":"Keratometric Axis","00460080":"Flat Keratometric Axis Sequence","00460092":"Background Color","00460094":"Optotype","00460095":"Optotype Presentation","00460097":"Subjective Refraction Right Eye Sequence","00460098":"Subjective Refraction Left Eye Sequence","00460100":"Add Near Sequence","00460101":"Add Intermediate Sequence","00460102":"Add Other Sequence","00460104":"Add Power","00460106":"Viewing Distance","00460121":"Visual Acuity Type Code Sequence","00460122":"Visual Acuity Right Eye Sequence","00460123":"Visual Acuity Left Eye Sequence","00460124":"Visual Acuity Both Eyes Open Sequence","00460125":"Viewing Distance Type","00460135":"Visual Acuity Modifiers","00460137":"Decimal Visual Acuity","00460139":"Optotype Detailed Definition","00460145":"Referenced Refractive Measurements Sequence","00460146":"Sphere Power","00460147":"Cylinder Power","00480001":"Imaged Volume Width","00480002":"Imaged Volume Height","00480003":"Imaged Volume Depth","00480006":"Total Pixel Matrix Columns","00480007":"Total Pixel Matrix Rows","00480008":"Total Pixel Matrix Origin Sequence","00480010":"Specimen Label in Image","00480011":"Focus Method","00480012":"Extended Depth of Field","00480013":"Number of Focal Planes","00480014":"Distance Between Focal Planes","00480015":"Recommended Absent Pixel CIELab Value","00480100":"Illuminator Type Code Sequence","00480102":"Image Orientation Slide","00480105":"Optical Path Sequence","00480106":"Optical Path Identifier","00480107":"Optical Path Description","00480108":"Illumination Color Code Sequence","00480110":"Specimen Reference Sequence","00480111":"Condenser Lens Power","00480112":"Objective Lens Power","00480113":"Objective Lens Numerical Aperture","00480120":"Palette Color Lookup Table Sequence","00480200":"Referenced Image Navigation Sequence","00480201":"Top Left Hand Corner of Localizer Area","00480202":"Bottom Right Hand Corner of Localizer Area","00480207":"Optical Path Identification Sequence","0048021A":"Plane Position Slide Sequence","0048021E":"Row Position in Total Image Pixel Matrix","0048021F":"Column Position in Total Image Pixel Matrix","00480301":"Pixel Origin Interpretation","00500004":"Calibration Image","00500010":"Device Sequence","00500012":"Container Component Type Code Sequence","00500013":"Container Component Thickness","00500014":"Device Length","00500015":"Container Component Width","00500016":"Device Diameter","00500017":"Device Diameter Units","00500018":"Device Volume","00500019":"Inter Marker Distance","0050001A":"Container Component Material","0050001B":"Container Component ID","0050001C":"Container Component Length","0050001D":"Container Component Diameter","0050001E":"Container Component Description","00500020":"Device Description","00520001":"Contrast/Bolus Ingredient Percent by Volume","00520002":"OCT Focal Distance","00520003":"Beam Spot Size","00520004":"Effective Refractive Index","00520006":"OCT Acquisition Domain","00520007":"OCT Optical Center Wavelength","00520008":"Axial Resolution","00520009":"Ranging Depth","00520011":"A-Line Rate","00520012":"A-Lines Per Frame","00520013":"Catheter Rotational Rate","00520014":"A-Line Pixel Spacing","00520016":"Mode of Percutaneous Access Sequence","00520025":"Intravascular OCT Frame Type Sequence","00520026":"OCT Z Offset Applied","00520027":"Intravascular Frame Content Sequence","00520028":"Intravascular Longitudinal Distance","00520029":"Intravascular OCT Frame Content Sequence","00520030":"OCT Z Offset Correction","00520031":"Catheter Direction of Rotation","00520033":"Seam Line Location","00520034":"First A-Line Location","00520036":"Seam Line Index","00520038":"Number of Padded A-Lines","00520039":"Interpolation Type","0052003A":"Refractive Index Applied","00540011":"Number of Energy Windows","00540012":"Energy Window Information Sequence","00540013":"Energy Window Range Sequence","00540014":"Energy Window Lower Limit","00540015":"Energy Window Upper Limit","00540016":"Radiopharmaceutical Information Sequence","00540017":"Residual Syringe Counts","00540018":"Energy Window Name","00540020":"Detector Vector","00540021":"Number of Detectors","00540022":"Detector Information Sequence","00540030":"Phase Vector","00540031":"Number of Phases","00540032":"Phase Information Sequence","00540033":"Number of Frames in Phase","00540036":"Phase Delay","00540038":"Pause Between Frames","00540039":"Phase Description","00540050":"Rotation Vector","00540051":"Number of Rotations","00540052":"Rotation Information Sequence","00540053":"Number of Frames in Rotation","00540060":"R-R Interval Vector","00540061":"Number of R-R Intervals","00540062":"Gated Information Sequence","00540063":"Data Information Sequence","00540070":"Time Slot Vector","00540071":"Number of Time Slots","00540072":"Time Slot Information Sequence","00540073":"Time Slot Time","00540080":"Slice Vector","00540081":"Number of Slices","00540090":"Angular View Vector","00540100":"Time Slice Vector","00540101":"Number of Time Slices","00540200":"Start Angle","00540202":"Type of Detector Motion","00540210":"Trigger Vector","00540211":"Number of Triggers in Phase","00540220":"View Code Sequence","00540222":"View Modifier Code Sequence","00540300":"Radionuclide Code Sequence","00540302":"Administration Route Code Sequence","00540304":"Radiopharmaceutical Code Sequence","00540306":"Calibration Data Sequence","00540308":"Energy Window Number","00540400":"Image ID","00540410":"Patient Orientation Code Sequence","00540412":"Patient Orientation Modifier Code Sequence","00540414":"Patient Gantry Relationship Code Sequence","00540500":"Slice Progression Direction","00541000":"Series Type","00541001":"Units","00541002":"Counts Source","00541004":"Reprojection Method","00541006":"SUV Type","00541100":"Randoms Correction Method","00541101":"Attenuation Correction Method","00541102":"Decay Correction","00541103":"Reconstruction Method","00541104":"Detector Lines of Response Used","00541105":"Scatter Correction Method","00541200":"Axial Acceptance","00541201":"Axial Mash","00541202":"Transverse Mash","00541203":"Detector Element Size","00541210":"Coincidence Window Width","00541220":"Secondary Counts Type","00541300":"Frame Reference Time","00541310":"Primary Prompts Counts Accumulated","00541311":"Secondary Counts Accumulated","00541320":"Slice Sensitivity Factor","00541321":"Decay Factor","00541322":"Dose Calibration Factor","00541323":"Scatter Fraction Factor","00541324":"Dead Time Factor","00541330":"Image Index","00541400":"Counts Included","00541401":"Dead Time Correction Flag","00603000":"Histogram Sequence","00603002":"Histogram Number of Bins","00603004":"Histogram First Bin Value","00603006":"Histogram Last Bin Value","00603008":"Histogram Bin Width","00603010":"Histogram Explanation","00603020":"Histogram Data","00620001":"Segmentation Type","00620002":"Segment Sequence","00620003":"Segmented Property Category Code Sequence","00620004":"Segment Number","00620005":"Segment Label","00620006":"Segment Description","00620008":"Segment Algorithm Type","00620009":"Segment Algorithm Name","0062000A":"Segment Identification Sequence","0062000B":"Referenced Segment Number","0062000C":"Recommended Display Grayscale Value","0062000D":"Recommended Display CIELab Value","0062000E":"Maximum Fractional Value","0062000F":"Segmented Property Type Code Sequence","00620010":"Segmentation Fractional Type","00640002":"Deformable Registration Sequence","00640003":"Source Frame of Reference UID","00640005":"Deformable Registration Grid Sequence","00640007":"Grid Dimensions","00640008":"Grid Resolution","00640009":"Vector Grid Data","0064000F":"Pre Deformation Matrix Registration Sequence","00640010":"Post Deformation Matrix Registration Sequence","00660001":"Number of Surfaces","00660002":"Surface Sequence","00660003":"Surface Number","00660004":"Surface Comments","00660009":"Surface Processing","0066000A":"Surface Processing Ratio","0066000B":"Surface Processing Description","0066000C":"Recommended Presentation Opacity","0066000D":"Recommended Presentation Type","0066000E":"Finite Volume","00660010":"Manifold","00660011":"Surface Points Sequence","00660012":"Surface Points Normals Sequence","00660013":"Surface Mesh Primitives Sequence","00660015":"Number of Surface Points","00660016":"Point Coordinates Data","00660017":"Point Position Accuracy","00660018":"Mean Point Distance","00660019":"Maximum Point Distance","0066001A":"Points Bounding Box Coordinates","0066001B":"Axis of Rotation","0066001C":"Center of Rotation","0066001E":"Number of Vectors","0066001F":"Vector Dimensionality","00660020":"Vector Accuracy","00660021":"Vector Coordinate Data","00660023":"Triangle Point Index List","00660024":"Edge Point Index List","00660025":"Vertex Point Index List","00660026":"Triangle Strip Sequence","00660027":"Triangle Fan Sequence","00660028":"Line Sequence","00660029":"Primitive Point Index List","0066002A":"Surface Count","0066002B":"Referenced Surface Sequence","0066002C":"Referenced Surface Number","0066002D":"Segment Surface Generation Algorithm Identification Sequence","0066002E":"Segment Surface Source Instance Sequence","0066002F":"Algorithm Family Code Sequence","00660030":"Algorithm Name Code Sequence","00660031":"Algorithm Version","00660032":"Algorithm Parameters","00660034":"Facet Sequence","00660035":"Surface Processing Algorithm Identification Sequence","00660036":"Algorithm Name","00686210":"Implant Size","00686221":"Implant Template Version","00686222":"Replaced Implant Template Sequence","00686223":"Implant Type","00686224":"Derivation Implant Template Sequence","00686225":"Original Implant Template Sequence","00686226":"Effective Date Time","00686230":"Implant Target Anatomy Sequence","00686260":"Information From Manufacturer Sequence","00686265":"Notification From Manufacturer Sequence","00686270":"Information Issue Date Time","00686280":"Information Summary","006862A0":"Implant Regulatory Disapproval Code Sequence","006862A5":"Overall Template Spatial Tolerance","006862C0":"HPGL Document Sequence","006862D0":"HPGL Document ID","006862D5":"HPGL Document Label","006862E0":"View Orientation Code Sequence","006862F0":"View Orientation Modifier","006862F2":"HPGL Document Scaling","00686300":"HPGL Document","00686310":"HPGL Contour Pen Number","00686320":"HPGL Pen Sequence","00686330":"HPGL Pen Number","00686340":"HPGL Pen Label","00686345":"HPGL Pen Description","00686346":"Recommended Rotation Point","00686347":"Bounding Rectangle","00686350":"Implant Template 3D Model Surface Number","00686360":"Surface Model Description Sequence","00686380":"Surface Model Label","00686390":"Surface Model Scaling Factor","006863A0":"Materials Code Sequence","006863A4":"Coating Materials Code Sequence","006863A8":"Implant Type Code Sequence","006863AC":"Fixation Method Code Sequence","006863B0":"Mating Feature Sets Sequence","006863C0":"Mating Feature Set ID","006863D0":"Mating Feature Set Label","006863E0":"Mating Feature Sequence","006863F0":"Mating Feature ID","00686400":"Mating Feature Degree of Freedom Sequence","00686410":"Degree of Freedom ID","00686420":"Degree of Freedom Type","00686430":"2D Mating Feature Coordinates Sequence","00686440":"Referenced HPGL Document ID","00686450":"2D Mating Point","00686460":"2D Mating Axes","00686470":"2D Degree of Freedom Sequence","00686490":"3D Degree of Freedom Axis","006864A0":"Range of Freedom","006864C0":"3D Mating Point","006864D0":"3D Mating Axes","006864F0":"2D Degree of Freedom Axis","00686500":"Planning Landmark Point Sequence","00686510":"Planning Landmark Line Sequence","00686520":"Planning Landmark Plane Sequence","00686530":"Planning Landmark ID","00686540":"Planning Landmark Description","00686545":"Planning Landmark Identification Code Sequence","00686550":"2D Point Coordinates Sequence","00686560":"2D Point Coordinates","00686590":"3D Point Coordinates","006865A0":"2D Line Coordinates Sequence","006865B0":"2D Line Coordinates","006865D0":"3D Line Coordinates","006865E0":"2D Plane Coordinates Sequence","006865F0":"2D Plane Intersection","00686610":"3D Plane Origin","00686620":"3D Plane Normal","00700001":"Graphic Annotation Sequence","00700002":"Graphic Layer","00700003":"Bounding Box Annotation Units","00700004":"Anchor Point Annotation Units","00700005":"Graphic Annotation Units","00700006":"Unformatted Text Value","00700008":"Text Object Sequence","00700009":"Graphic Object Sequence","00700010":"Bounding Box Top Left Hand Corner","00700011":"Bounding Box Bottom Right Hand Corner","00700012":"Bounding Box Text Horizontal Justification","00700014":"Anchor Point","00700015":"Anchor Point Visibility","00700020":"Graphic Dimensions","00700021":"Number of Graphic Points","00700022":"Graphic Data","00700023":"Graphic Type","00700024":"Graphic Filled","00700040":"Image Rotation (Retired)","00700041":"Image Horizontal Flip","00700042":"Image Rotation","00700050":"Displayed Area Top Left Hand Corner (Trial)","00700051":"Displayed Area Bottom Right Hand Corner (Trial)","00700052":"Displayed Area Top Left Hand Corner","00700053":"Displayed Area Bottom Right Hand Corner","0070005A":"Displayed Area Selection Sequence","00700060":"Graphic Layer Sequence","00700062":"Graphic Layer Order","00700066":"Graphic Layer Recommended Display Grayscale Value","00700067":"Graphic Layer Recommended Display RGB Value","00700068":"Graphic Layer Description","00700080":"Content Label","00700081":"Content Description","00700082":"Presentation Creation Date","00700083":"Presentation Creation Time","00700084":"Content Creator Name","00700086":"Content Creator Identification Code Sequence","00700087":"Alternate Content Description Sequence","00700100":"Presentation Size Mode","00700101":"Presentation Pixel Spacing","00700102":"Presentation Pixel Aspect Ratio","00700103":"Presentation Pixel Magnification Ratio","00700207":"Graphic Group Label","00700208":"Graphic Group Description","00700209":"Compound Graphic Sequence","00700226":"Compound Graphic Instance ID","00700227":"Font Name","00700228":"Font Name Type","00700229":"CSS Font Name","00700230":"Rotation Angle","00700231":"Text Style Sequence","00700232":"Line Style Sequence","00700233":"Fill Style Sequence","00700234":"Graphic Group Sequence","00700241":"Text Color CIELab Value","00700242":"Horizontal Alignment","00700243":"Vertical Alignment","00700244":"Shadow Style","00700245":"Shadow Offset X","00700246":"Shadow Offset Y","00700247":"Shadow Color CIELab Value","00700248":"Underlined","00700249":"Bold","00700250":"Italic","00700251":"Pattern On Color CIELab Value","00700252":"Pattern Off Color CIELab Value","00700253":"Line Thickness","00700254":"Line Dashing Style","00700255":"Line Pattern","00700256":"Fill Pattern","00700257":"Fill Mode","00700258":"Shadow Opacity","00700261":"Gap Length","00700262":"Diameter of Visibility","00700273":"Rotation Point","00700274":"Tick Alignment","00700278":"Show Tick Label","00700279":"Tick Label Alignment","00700282":"Compound Graphic Units","00700284":"Pattern On Opacity","00700285":"Pattern Off Opacity","00700287":"Major Ticks Sequence","00700288":"Tick Position","00700289":"Tick Label","00700294":"Compound Graphic Type","00700295":"Graphic Group ID","00700306":"Shape Type","00700308":"Registration Sequence","00700309":"Matrix Registration Sequence","0070030A":"Matrix Sequence","0070030C":"Frame of Reference Transformation Matrix Type","0070030D":"Registration Type Code Sequence","0070030F":"Fiducial Description","00700310":"Fiducial Identifier","00700311":"Fiducial Identifier Code Sequence","00700312":"Contour Uncertainty Radius","00700314":"Used Fiducials Sequence","00700318":"Graphic Coordinates Data Sequence","0070031A":"Fiducial UID","0070031C":"Fiducial Set Sequence","0070031E":"Fiducial Sequence","00700401":"Graphic Layer Recommended Display CIELab Value","00700402":"Blending Sequence","00700403":"Relative Opacity","00700404":"Referenced Spatial Registration Sequence","00700405":"Blending Position","00720002":"Hanging Protocol Name","00720004":"Hanging Protocol Description","00720006":"Hanging Protocol Level","00720008":"Hanging Protocol Creator","0072000A":"Hanging Protocol Creation Date Time","0072000C":"Hanging Protocol Definition Sequence","0072000E":"Hanging Protocol User Identification Code Sequence","00720010":"Hanging Protocol User Group Name","00720012":"Source Hanging Protocol Sequence","00720014":"Number of Priors Referenced","00720020":"Image Sets Sequence","00720022":"Image Set Selector Sequence","00720024":"Image Set Selector Usage Flag","00720026":"Selector Attribute","00720028":"Selector Value Number","00720030":"Time Based Image Sets Sequence","00720032":"Image Set Number","00720034":"Image Set Selector Category","00720038":"Relative Time","0072003A":"Relative Time Units","0072003C":"Abstract Prior Value","0072003E":"Abstract Prior Code Sequence","00720040":"Image Set Label","00720050":"Selector Attribute VR","00720052":"Selector Sequence Pointer","00720054":"Selector Sequence Pointer Private Creator","00720056":"Selector Attribute Private Creator","00720060":"Selector AT Value","00720062":"Selector CS Value","00720064":"Selector IS Value","00720066":"Selector LO Value","00720068":"Selector LT Value","0072006A":"Selector PN Value","0072006C":"Selector SH Value","0072006E":"Selector ST Value","00720070":"Selector UT Value","00720072":"Selector DS Value","00720074":"Selector FD Value","00720076":"Selector FL Value","00720078":"Selector UL Value","0072007A":"Selector US Value","0072007C":"Selector SL Value","0072007E":"Selector SS Value","00720080":"Selector Code Sequence Value","00720100":"Number of Screens","00720102":"Nominal Screen Definition Sequence","00720104":"Number of Vertical Pixels","00720106":"Number of Horizontal Pixels","00720108":"Display Environment Spatial Position","0072010A":"Screen Minimum Grayscale Bit Depth","0072010C":"Screen Minimum Color Bit Depth","0072010E":"Application Maximum Repaint Time","00720200":"Display Sets Sequence","00720202":"Display Set Number","00720203":"Display Set Label","00720204":"Display Set Presentation Group","00720206":"Display Set Presentation Group Description","00720208":"Partial Data Display Handling","00720210":"Synchronized Scrolling Sequence","00720212":"Display Set Scrolling Group","00720214":"Navigation Indicator Sequence","00720216":"Navigation Display Set","00720218":"Reference Display Sets","00720300":"Image Boxes Sequence","00720302":"Image Box Number","00720304":"Image Box Layout Type","00720306":"Image Box Tile Horizontal Dimension","00720308":"Image Box Tile Vertical Dimension","00720310":"Image Box Scroll Direction","00720312":"Image Box Small Scroll Type","00720314":"Image Box Small Scroll Amount","00720316":"Image Box Large Scroll Type","00720318":"Image Box Large Scroll Amount","00720320":"Image Box Overlap Priority","00720330":"Cine Relative to Real Time","00720400":"Filter Operations Sequence","00720402":"Filter by Category","00720404":"Filter by Attribute Presence","00720406":"Filter by Operator","00720420":"Structured Display Background CIELab Value","00720421":"Empty Image Box CIELab Value","00720422":"Structured Display Image Box Sequence","00720424":"Structured Display Text Box Sequence","00720427":"Referenced First Frame Sequence","00720430":"Image Box Synchronization Sequence","00720432":"Synchronized Image Box List","00720434":"Type of Synchronization","00720500":"Blending Operation Type","00720510":"Reformatting Operation Type","00720512":"Reformatting Thickness","00720514":"Reformatting Interval","00720516":"Reformatting Operation Initial View Direction","00720520":"3D Rendering Type","00720600":"Sorting Operations Sequence","00720602":"Sort-by Category","00720604":"Sorting Direction","00720700":"Display Set Patient Orientation","00720702":"VOI Type","00720704":"Pseudo-color Type","00720705":"Pseudo-color Palette Instance Reference Sequence","00720706":"Show Grayscale Inverted","00720710":"Show Image True Size Flag","00720712":"Show Graphic Annotation Flag","00720714":"Show Patient Demographics Flag","00720716":"Show Acquisition Techniques Flag","00720717":"Display Set Horizontal Justification","00720718":"Display Set Vertical Justification","00740120":"Continuation Start Meterset","00740121":"Continuation End Meterset","00741000":"Procedure Step State","00741002":"Procedure Step Progress Information Sequence","00741004":"Procedure Step Progress","00741006":"Procedure Step Progress Description","00741008":"Procedure Step Communications URI Sequence","0074100a":"Contact URI","0074100c":"Contact Display Name","0074100e":"Procedure Step Discontinuation Reason Code Sequence","00741020":"Beam Task Sequence","00741022":"Beam Task Type","00741024":"Beam Order Index (Trial)","00741026":"Table Top Vertical Adjusted Position","00741027":"Table Top Longitudinal Adjusted Position","00741028":"Table Top Lateral Adjusted Position","0074102A":"Patient Support Adjusted Angle","0074102B":"Table Top Eccentric Adjusted Angle","0074102C":"Table Top Pitch Adjusted Angle","0074102D":"Table Top Roll Adjusted Angle","00741030":"Delivery Verification Image Sequence","00741032":"Verification Image Timing","00741034":"Double Exposure Flag","00741036":"Double Exposure Ordering","00741038":"Double Exposure Meterset (Trial)","0074103A":"Double Exposure Field Delta (Trial)","00741040":"Related Reference RT Image Sequence","00741042":"General Machine Verification Sequence","00741044":"Conventional Machine Verification Sequence","00741046":"Ion Machine Verification Sequence","00741048":"Failed Attributes Sequence","0074104A":"Overridden Attributes Sequence","0074104C":"Conventional Control Point Verification Sequence","0074104E":"Ion Control Point Verification Sequence","00741050":"Attribute Occurrence Sequence","00741052":"Attribute Occurrence Pointer","00741054":"Attribute Item Selector","00741056":"Attribute Occurrence Private Creator","00741057":"Selector Sequence Pointer Items","00741200":"Scheduled Procedure Step Priority","00741202":"Worklist Label","00741204":"Procedure Step Label","00741210":"Scheduled Processing Parameters Sequence","00741212":"Performed Processing Parameters Sequence","00741216":"Unified Procedure Step Performed Procedure Sequence","00741220":"Related Procedure Step Sequence","00741222":"Procedure Step Relationship Type","00741224":"Replaced Procedure Step Sequence","00741230":"Deletion Lock","00741234":"Receiving AE","00741236":"Requesting AE","00741238":"Reason for Cancellation","00741242":"SCP Status","00741244":"Subscription List Status","00741246":"Unified Procedure Step List Status","00741324":"Beam Order Index","00741338":"Double Exposure Meterset","0074133A":"Double Exposure Field Delta","00760001":"Implant Assembly Template Name","00760003":"Implant Assembly Template Issuer","00760006":"Implant Assembly Template Version","00760008":"Replaced Implant Assembly Template Sequence","0076000A":"Implant Assembly Template Type","0076000C":"Original Implant Assembly Template Sequence","0076000E":"Derivation Implant Assembly Template Sequence","00760010":"Implant Assembly Template Target Anatomy Sequence","00760020":"Procedure Type Code Sequence","00760030":"Surgical Technique","00760032":"Component Types Sequence","00760034":"Component Type Code Sequence","00760036":"Exclusive Component Type","00760038":"Mandatory Component Type","00760040":"Component Sequence","00760055":"Component ID","00760060":"Component Assembly Sequence","00760070":"Component 1 Referenced ID","00760080":"Component 1 Referenced Mating Feature Set ID","00760090":"Component 1 Referenced Mating Feature ID","007600A0":"Component 2 Referenced ID","007600B0":"Component 2 Referenced Mating Feature Set ID","007600C0":"Component 2 Referenced Mating Feature ID","00780001":"Implant Template Group Name","00780010":"Implant Template Group Description","00780020":"Implant Template Group Issuer","00780024":"Implant Template Group Version","00780026":"Replaced Implant Template Group Sequence","00780028":"Implant Template Group Target Anatomy Sequence","0078002A":"Implant Template Group Members Sequence","0078002E":"Implant Template Group Member ID","00780050":"3D Implant Template Group Member Matching Point","00780060":"3D Implant Template Group Member Matching Axes","00780070":"Implant Template Group Member Matching 2D Coordinates Sequence","00780090":"2D Implant Template Group Member Matching Point","007800A0":"2D Implant Template Group Member Matching Axes","007800B0":"Implant Template Group Variation Dimension Sequence","007800B2":"Implant Template Group Variation Dimension Name","007800B4":"Implant Template Group Variation Dimension Rank Sequence","007800B6":"Referenced Implant Template Group Member ID","007800B8":"Implant Template Group Variation Dimension Rank","00880130":"Storage Media File-set ID","00880140":"Storage Media File-set UID","00880200":"Icon Image Sequence","00880904":"Topic Title","00880906":"Topic Subject","00880910":"Topic Author","00880912":"Topic Keywords","01000410":"SOP Instance Status","01000420":"SOP Authorization Date Time","01000424":"SOP Authorization Comment","01000426":"Authorization Equipment Certification Number","04000005":"MAC ID Number","04000010":"MAC Calculation Transfer Syntax UID","04000015":"MAC Algorithm","04000020":"Data Elements Signed","04000100":"Digital Signature UID","04000105":"Digital Signature Date Time","04000110":"Certificate Type","04000115":"Certificate of Signer","04000120":"Signature","04000305":"Certified Timestamp Type","04000310":"Certified Timestamp","04000401":"Digital Signature Purpose Code Sequence","04000402":"Referenced Digital Signature Sequence","04000403":"Referenced SOP Instance MAC Sequence","04000404":"MAC","04000500":"Encrypted Attributes Sequence","04000510":"Encrypted Content Transfer Syntax UID","04000520":"Encrypted Content","04000550":"Modified Attributes Sequence","04000561":"Original Attributes Sequence","04000562":"Attribute Modification Date Time","04000563":"Modifying System","04000564":"Source of Previous Values","04000565":"Reason for The Attribute Modification","1000XXx0":"Escape Triplet","1000XXx1":"Run Length Triplet","1000XXx2":"Huffman Table Size","1000XXx3":"Huffman Table Triplet","1000XXx4":"Shift Table Size","1000XXx5":"Shift Table Triplet","1010XXXX":"Zonal Map",20000010:"Number of Copies","2000001E":"Printer Configuration Sequence",20000020:"Print Priority",20000030:"Medium Type",20000040:"Film Destination",20000050:"Film Session Label",20000060:"Memory Allocation",20000061:"Maximum Memory Allocation",20000062:"Color Image Printing Flag",20000063:"Collation Flag",20000065:"Annotation Flag",20000067:"Image Overlay Flag",20000069:"Presentation LUT Flag","2000006A":"Image Box Presentation LUT Flag","200000A0":"Memory Bit Depth","200000A1":"Printing Bit Depth","200000A2":"Media Installed Sequence","200000A4":"Other Media Available Sequence","200000A8":"Supported Image Display Formats Sequence",20000500:"Referenced Film Box Sequence",20000510:"Referenced Stored Print Sequence",20100010:"Image Display Format",20100030:"Annotation Display Format ID",20100040:"Film Orientation",20100050:"Film Size ID",20100052:"Printer Resolution ID",20100054:"Default Printer Resolution ID",20100060:"Magnification Type",20100080:"Smoothing Type","201000A6":"Default Magnification Type","201000A7":"Other Magnification Types Available","201000A8":"Default Smoothing Type","201000A9":"Other Smoothing Types Available",20100100:"Border Density",20100110:"Empty Image Density",20100120:"Min Density",20100130:"Max Density",20100140:"Trim",20100150:"Configuration Information",20100152:"Configuration Information Description",20100154:"Maximum Collated Films","2010015E":"Illumination",20100160:"Reflected Ambient Light",20100376:"Printer Pixel Spacing",20100500:"Referenced Film Session Sequence",20100510:"Referenced Image Box Sequence",20100520:"Referenced Basic Annotation Box Sequence",20200010:"Image Box Position",20200020:"Polarity",20200030:"Requested Image Size",20200040:"Requested Decimate Crop Behavior",20200050:"Requested Resolution ID","202000A0":"Requested Image Size Flag","202000A2":"Decimate Crop Result",20200110:"Basic Grayscale Image Sequence",20200111:"Basic Color Image Sequence",20200130:"Referenced Image Overlay Box Sequence",20200140:"Referenced VOI LUT Box Sequence",20300010:"Annotation Position",20300020:"Text String",20400010:"Referenced Overlay Plane Sequence",20400011:"Referenced Overlay Plane Groups",20400020:"Overlay Pixel Data Sequence",20400060:"Overlay Magnification Type",20400070:"Overlay Smoothing Type",20400072:"Overlay or Image Magnification",20400074:"Magnify to Number of Columns",20400080:"Overlay Foreground Density",20400082:"Overlay Background Density",20400090:"Overlay Mode",20400100:"Threshold Density",20400500:"Referenced Image Box Sequence (Retired)",20500010:"Presentation LUT Sequence",20500020:"Presentation LUT Shape",20500500:"Referenced Presentation LUT Sequence",21000010:"Print Job ID",21000020:"Execution Status",21000030:"Execution Status Info",21000040:"Creation Date",21000050:"Creation Time",21000070:"Originator",21000140:"Destination AE",21000160:"Owner ID",21000170:"Number of Films",21000500:"Referenced Print Job Sequence (Pull Stored Print)",21100010:"Printer Status",21100020:"Printer Status Info",21100030:"Printer Name",21100099:"Print Queue ID",21200010:"Queue Status",21200050:"Print Job Description Sequence",21200070:"Referenced Print Job Sequence",21300010:"Print Management Capabilities Sequence",21300015:"Printer Characteristics Sequence",21300030:"Film Box Content Sequence",21300040:"Image Box Content Sequence",21300050:"Annotation Content Sequence",21300060:"Image Overlay Box Content Sequence",21300080:"Presentation LUT Content Sequence","213000A0":"Proposed Study Sequence","213000C0":"Original Image Sequence",22000001:"Label Using Information Extracted From Instances",22000002:"Label Text",22000003:"Label Style Selection",22000004:"Media Disposition",22000005:"Barcode Value",22000006:"Barcode Symbology",22000007:"Allow Media Splitting",22000008:"Include Non-DICOM Objects",22000009:"Include Display Application","2200000A":"Preserve Composite Instances After Media Creation","2200000B":"Total Number of Pieces of Media Created","2200000C":"Requested Media Application Profile","2200000D":"Referenced Storage Media Sequence","2200000E":"Failure Attributes","2200000F":"Allow Lossy Compression",22000020:"Request Priority",30020002:"RT Image Label",30020003:"RT Image Name",30020004:"RT Image Description","3002000A":"Reported Values Origin","3002000C":"RT Image Plane","3002000D":"X-Ray Image Receptor Translation","3002000E":"X-Ray Image Receptor Angle",30020010:"RT Image Orientation",30020011:"Image Plane Pixel Spacing",30020012:"RT Image Position",30020020:"Radiation Machine Name",30020022:"Radiation Machine SAD",30020024:"Radiation Machine SSD",30020026:"RT Image SID",30020028:"Source to Reference Object Distance",30020029:"Fraction Number",30020030:"Exposure Sequence",30020032:"Meterset Exposure",30020034:"Diaphragm Position",30020040:"Fluence Map Sequence",30020041:"Fluence Data Source",30020042:"Fluence Data Scale",30020050:"Primary Fluence Mode Sequence",30020051:"Fluence Mode",30020052:"Fluence Mode ID",30040001:"DVH Type",30040002:"Dose Units",30040004:"Dose Type",30040006:"Dose Comment",30040008:"Normalization Point","3004000A":"Dose Summation Type","3004000C":"Grid Frame Offset Vector","3004000E":"Dose Grid Scaling",30040010:"RT Dose ROI Sequence",30040012:"Dose Value",30040014:"Tissue Heterogeneity Correction",30040040:"DVH Normalization Point",30040042:"DVH Normalization Dose Value",30040050:"DVH Sequence",30040052:"DVH Dose Scaling",30040054:"DVH Volume Units",30040056:"DVH Number of Bins",30040058:"DVH Data",30040060:"DVH Referenced ROI Sequence",30040062:"DVH ROI Contribution Type",30040070:"DVH Minimum Dose",30040072:"DVH Maximum Dose",30040074:"DVH Mean Dose",30060002:"Structure Set Label",30060004:"Structure Set Name",30060006:"Structure Set Description",30060008:"Structure Set Date",30060009:"Structure Set Time",30060010:"Referenced Frame of Reference Sequence",30060012:"RT Referenced Study Sequence",30060014:"RT Referenced Series Sequence",30060016:"Contour Image Sequence",30060020:"Structure Set ROI Sequence",30060022:"ROI Number",30060024:"Referenced Frame of Reference UID",30060026:"ROI Name",30060028:"ROI Description","3006002A":"ROI Display Color","3006002C":"ROI Volume",30060030:"RT Related ROI Sequence",30060033:"RT ROI Relationship",30060036:"ROI Generation Algorithm",30060038:"ROI Generation Description",30060039:"ROI Contour Sequence",30060040:"Contour Sequence",30060042:"Contour Geometric Type",30060044:"Contour Slab Thickness",30060045:"Contour Offset Vector",30060046:"Number of Contour Points",30060048:"Contour Number",30060049:"Attached Contours",30060050:"Contour Data",30060080:"RT ROI Observations Sequence",30060082:"Observation Number",30060084:"Referenced ROI Number",30060085:"ROI Observation Label",30060086:"RT ROI Identification Code Sequence",30060088:"ROI Observation Description","300600A0":"Related RT ROI Observations Sequence","300600A4":"RT ROI Interpreted Type","300600A6":"ROI Interpreter","300600B0":"ROI Physical Properties Sequence","300600B2":"ROI Physical Property","300600B4":"ROI Physical Property Value","300600B6":"ROI Elemental Composition Sequence","300600B7":"ROI Elemental Composition Atomic Number","300600B8":"ROI Elemental Composition Atomic Mass Fraction","300600C0":"Frame of Reference Relationship Sequence","300600C2":"Related Frame of Reference UID","300600C4":"Frame of Reference Transformation Type","300600C6":"Frame of Reference Transformation Matrix","300600C8":"Frame of Reference Transformation Comment",30080010:"Measured Dose Reference Sequence",30080012:"Measured Dose Description",30080014:"Measured Dose Type",30080016:"Measured Dose Value",30080020:"Treatment Session Beam Sequence",30080021:"Treatment Session Ion Beam Sequence",30080022:"Current Fraction Number",30080024:"Treatment Control Point Date",30080025:"Treatment Control Point Time","3008002A":"Treatment Termination Status","3008002B":"Treatment Termination Code","3008002C":"Treatment Verification Status",30080030:"Referenced Treatment Record Sequence",30080032:"Specified Primary Meterset",30080033:"Specified Secondary Meterset",30080036:"Delivered Primary Meterset",30080037:"Delivered Secondary Meterset","3008003A":"Specified Treatment Time","3008003B":"Delivered Treatment Time",30080040:"Control Point Delivery Sequence",30080041:"Ion Control Point Delivery Sequence",30080042:"Specified Meterset",30080044:"Delivered Meterset",30080045:"Meterset Rate Set",30080046:"Meterset Rate Delivered",30080047:"Scan Spot Metersets Delivered",30080048:"Dose Rate Delivered",30080050:"Treatment Summary Calculated Dose Reference Sequence",30080052:"Cumulative Dose to Dose Reference",30080054:"First Treatment Date",30080056:"Most Recent Treatment Date","3008005A":"Number of Fractions Delivered",30080060:"Override Sequence",30080061:"Parameter Sequence Pointer",30080062:"Override Parameter Pointer",30080063:"Parameter Item Index",30080064:"Measured Dose Reference Number",30080065:"Parameter Pointer",30080066:"Override Reason",30080068:"Corrected Parameter Sequence","3008006A":"Correction Value",30080070:"Calculated Dose Reference Sequence",30080072:"Calculated Dose Reference Number",30080074:"Calculated Dose Reference Description",30080076:"Calculated Dose Reference Dose Value",30080078:"Start Meterset","3008007A":"End Meterset",30080080:"Referenced Measured Dose Reference Sequence",30080082:"Referenced Measured Dose Reference Number",30080090:"Referenced Calculated Dose Reference Sequence",30080092:"Referenced Calculated Dose Reference Number","300800A0":"Beam Limiting Device Leaf Pairs Sequence","300800B0":"Recorded Wedge Sequence","300800C0":"Recorded Compensator Sequence","300800D0":"Recorded Block Sequence","300800E0":"Treatment Summary Measured Dose Reference Sequence","300800F0":"Recorded Snout Sequence","300800F2":"Recorded Range Shifter Sequence","300800F4":"Recorded Lateral Spreading Device Sequence","300800F6":"Recorded Range Modulator Sequence",30080100:"Recorded Source Sequence",30080105:"Source Serial Number",30080110:"Treatment Session Application Setup Sequence",30080116:"Application Setup Check",30080120:"Recorded Brachy Accessory Device Sequence",30080122:"Referenced Brachy Accessory Device Number",30080130:"Recorded Channel Sequence",30080132:"Specified Channel Total Time",30080134:"Delivered Channel Total Time",30080136:"Specified Number of Pulses",30080138:"Delivered Number of Pulses","3008013A":"Specified Pulse Repetition Interval","3008013C":"Delivered Pulse Repetition Interval",30080140:"Recorded Source Applicator Sequence",30080142:"Referenced Source Applicator Number",30080150:"Recorded Channel Shield Sequence",30080152:"Referenced Channel Shield Number",30080160:"Brachy Control Point Delivered Sequence",30080162:"Safe Position Exit Date",30080164:"Safe Position Exit Time",30080166:"Safe Position Return Date",30080168:"Safe Position Return Time",30080200:"Current Treatment Status",30080202:"Treatment Status Comment",30080220:"Fraction Group Summary Sequence",30080223:"Referenced Fraction Number",30080224:"Fraction Group Type",30080230:"Beam Stopper Position",30080240:"Fraction Status Summary Sequence",30080250:"Treatment Date",30080251:"Treatment Time","300A0002":"RT Plan Label","300A0003":"RT Plan Name","300A0004":"RT Plan Description","300A0006":"RT Plan Date","300A0007":"RT Plan Time","300A0009":"Treatment Protocols","300A000A":"Plan Intent","300A000B":"Treatment Sites","300A000C":"RT Plan Geometry","300A000E":"Prescription Description","300A0010":"Dose Reference Sequence","300A0012":"Dose Reference Number","300A0013":"Dose Reference UID","300A0014":"Dose Reference Structure Type","300A0015":"Nominal Beam Energy Unit","300A0016":"Dose Reference Description","300A0018":"Dose Reference Point Coordinates","300A001A":"Nominal Prior Dose","300A0020":"Dose Reference Type","300A0021":"Constraint Weight","300A0022":"Delivery Warning Dose","300A0023":"Delivery Maximum Dose","300A0025":"Target Minimum Dose","300A0026":"Target Prescription Dose","300A0027":"Target Maximum Dose","300A0028":"Target Underdose Volume Fraction","300A002A":"Organ at Risk Full Volume Dose","300A002B":"Organ at Risk Limit Dose","300A002C":"Organ at Risk Maximum Dose","300A002D":"Organ at Risk Overdose Volume Fraction","300A0040":"Tolerance Table Sequence","300A0042":"Tolerance Table Number","300A0043":"Tolerance Table Label","300A0044":"Gantry Angle Tolerance","300A0046":"Beam Limiting Device Angle Tolerance","300A0048":"Beam Limiting Device Tolerance Sequence","300A004A":"Beam Limiting Device Position Tolerance","300A004B":"Snout Position Tolerance","300A004C":"Patient Support Angle Tolerance","300A004E":"Table Top Eccentric Angle Tolerance","300A004F":"Table Top Pitch Angle Tolerance","300A0050":"Table Top Roll Angle Tolerance","300A0051":"Table Top Vertical Position Tolerance","300A0052":"Table Top Longitudinal Position Tolerance","300A0053":"Table Top Lateral Position Tolerance","300A0055":"RT Plan Relationship","300A0070":"Fraction Group Sequence","300A0071":"Fraction Group Number","300A0072":"Fraction Group Description","300A0078":"Number of Fractions Planned","300A0079":"Number of Fraction Pattern Digits Per Day","300A007A":"Repeat Fraction Cycle Length","300A007B":"Fraction Pattern","300A0080":"Number of Beams","300A0082":"Beam Dose Specification Point","300A0084":"Beam Dose","300A0086":"Beam Meterset","300A0088":"Beam Dose Point Depth","300A0089":"Beam Dose Point Equivalent Depth","300A008A":"Beam Dose Point SSD","300A00A0":"Number of Brachy Application Setups","300A00A2":"Brachy Application Setup Dose Specification Point","300A00A4":"Brachy Application Setup Dose","300A00B0":"Beam Sequence","300A00B2":"Treatment Machine Name","300A00B3":"Primary Dosimeter Unit","300A00B4":"Source Axis Distance","300A00B6":"Beam Limiting Device Sequence","300A00B8":"RT Beam Limiting Device Type","300A00BA":"Source to Beam Limiting Device Distance","300A00BB":"Isocenter to Beam Limiting Device Distance","300A00BC":"Number of Leaf/Jaw Pairs","300A00BE":"Leaf Position Boundaries","300A00C0":"Beam Number","300A00C2":"Beam Name","300A00C3":"Beam Description","300A00C4":"Beam Type","300A00C6":"Radiation Type","300A00C7":"High-Dose Technique Type","300A00C8":"Reference Image Number","300A00CA":"Planned Verification Image Sequence","300A00CC":"Imaging Device Specific Acquisition Parameters","300A00CE":"Treatment Delivery Type","300A00D0":"Number of Wedges","300A00D1":"Wedge Sequence","300A00D2":"Wedge Number","300A00D3":"Wedge Type","300A00D4":"Wedge ID","300A00D5":"Wedge Angle","300A00D6":"Wedge Factor","300A00D7":"Total Wedge Tray Water-Equivalent Thickness","300A00D8":"Wedge Orientation","300A00D9":"Isocenter to Wedge Tray Distance","300A00DA":"Source to Wedge Tray Distance","300A00DB":"Wedge Thin Edge Position","300A00DC":"Bolus ID","300A00DD":"Bolus Description","300A00E0":"Number of Compensators","300A00E1":"Material ID","300A00E2":"Total Compensator Tray Factor","300A00E3":"Compensator Sequence","300A00E4":"Compensator Number","300A00E5":"Compensator ID","300A00E6":"Source to Compensator Tray Distance","300A00E7":"Compensator Rows","300A00E8":"Compensator Columns","300A00E9":"Compensator Pixel Spacing","300A00EA":"Compensator Position","300A00EB":"Compensator Transmission Data","300A00EC":"Compensator Thickness Data","300A00ED":"Number of Boli","300A00EE":"Compensator Type","300A00F0":"Number of Blocks","300A00F2":"Total Block Tray Factor","300A00F3":"Total Block Tray Water-Equivalent Thickness","300A00F4":"Block Sequence","300A00F5":"Block Tray ID","300A00F6":"Source to Block Tray Distance","300A00F7":"Isocenter to Block Tray Distance","300A00F8":"Block Type","300A00F9":"Accessory Code","300A00FA":"Block Divergence","300A00FB":"Block Mounting Position","300A00FC":"Block Number","300A00FE":"Block Name","300A0100":"Block Thickness","300A0102":"Block Transmission","300A0104":"Block Number of Points","300A0106":"Block Data","300A0107":"Applicator Sequence","300A0108":"Applicator ID","300A0109":"Applicator Type","300A010A":"Applicator Description","300A010C":"Cumulative Dose Reference Coefficient","300A010E":"Final Cumulative Meterset Weight","300A0110":"Number of Control Points","300A0111":"Control Point Sequence","300A0112":"Control Point Index","300A0114":"Nominal Beam Energy","300A0115":"Dose Rate Set","300A0116":"Wedge Position Sequence","300A0118":"Wedge Position","300A011A":"Beam Limiting Device Position Sequence","300A011C":"Leaf/Jaw Positions","300A011E":"Gantry Angle","300A011F":"Gantry Rotation Direction","300A0120":"Beam Limiting Device Angle","300A0121":"Beam Limiting Device Rotation Direction","300A0122":"Patient Support Angle","300A0123":"Patient Support Rotation Direction","300A0124":"Table Top Eccentric Axis Distance","300A0125":"Table Top Eccentric Angle","300A0126":"Table Top Eccentric Rotation Direction","300A0128":"Table Top Vertical Position","300A0129":"Table Top Longitudinal Position","300A012A":"Table Top Lateral Position","300A012C":"Isocenter Position","300A012E":"Surface Entry Point","300A0130":"Source to Surface Distance","300A0134":"Cumulative Meterset Weight","300A0140":"Table Top Pitch Angle","300A0142":"Table Top Pitch Rotation Direction","300A0144":"Table Top Roll Angle","300A0146":"Table Top Roll Rotation Direction","300A0148":"Head Fixation Angle","300A014A":"Gantry Pitch Angle","300A014C":"Gantry Pitch Rotation Direction","300A014E":"Gantry Pitch Angle Tolerance","300A0180":"Patient Setup Sequence","300A0182":"Patient Setup Number","300A0183":"Patient Setup Label","300A0184":"Patient Additional Position","300A0190":"Fixation Device Sequence","300A0192":"Fixation Device Type","300A0194":"Fixation Device Label","300A0196":"Fixation Device Description","300A0198":"Fixation Device Position","300A0199":"Fixation Device Pitch Angle","300A019A":"Fixation Device Roll Angle","300A01A0":"Shielding Device Sequence","300A01A2":"Shielding Device Type","300A01A4":"Shielding Device Label","300A01A6":"Shielding Device Description","300A01A8":"Shielding Device Position","300A01B0":"Setup Technique","300A01B2":"Setup Technique Description","300A01B4":"Setup Device Sequence","300A01B6":"Setup Device Type","300A01B8":"Setup Device Label","300A01BA":"Setup Device Description","300A01BC":"Setup Device Parameter","300A01D0":"Setup Reference Description","300A01D2":"Table Top Vertical Setup Displacement","300A01D4":"Table Top Longitudinal Setup Displacement","300A01D6":"Table Top Lateral Setup Displacement","300A0200":"Brachy Treatment Technique","300A0202":"Brachy Treatment Type","300A0206":"Treatment Machine Sequence","300A0210":"Source Sequence","300A0212":"Source Number","300A0214":"Source Type","300A0216":"Source Manufacturer","300A0218":"Active Source Diameter","300A021A":"Active Source Length","300A0222":"Source Encapsulation Nominal Thickness","300A0224":"Source Encapsulation Nominal Transmission","300A0226":"Source Isotope Name","300A0228":"Source Isotope Half Life","300A0229":"Source Strength Units","300A022A":"Reference Air Kerma Rate","300A022B":"Source Strength","300A022C":"Source Strength Reference Date","300A022E":"Source Strength Reference Time","300A0230":"Application Setup Sequence","300A0232":"Application Setup Type","300A0234":"Application Setup Number","300A0236":"Application Setup Name","300A0238":"Application Setup Manufacturer","300A0240":"Template Number","300A0242":"Template Type","300A0244":"Template Name","300A0250":"Total Reference Air Kerma","300A0260":"Brachy Accessory Device Sequence","300A0262":"Brachy Accessory Device Number","300A0263":"Brachy Accessory Device ID","300A0264":"Brachy Accessory Device Type","300A0266":"Brachy Accessory Device Name","300A026A":"Brachy Accessory Device Nominal Thickness","300A026C":"Brachy Accessory Device Nominal Transmission","300A0280":"Channel Sequence","300A0282":"Channel Number","300A0284":"Channel Length","300A0286":"Channel Total Time","300A0288":"Source Movement Type","300A028A":"Number of Pulses","300A028C":"Pulse Repetition Interval","300A0290":"Source Applicator Number","300A0291":"Source Applicator ID","300A0292":"Source Applicator Type","300A0294":"Source Applicator Name","300A0296":"Source Applicator Length","300A0298":"Source Applicator Manufacturer","300A029C":"Source Applicator Wall Nominal Thickness","300A029E":"Source Applicator Wall Nominal Transmission","300A02A0":"Source Applicator Step Size","300A02A2":"Transfer Tube Number","300A02A4":"Transfer Tube Length","300A02B0":"Channel Shield Sequence","300A02B2":"Channel Shield Number","300A02B3":"Channel Shield ID","300A02B4":"Channel Shield Name","300A02B8":"Channel Shield Nominal Thickness","300A02BA":"Channel Shield Nominal Transmission","300A02C8":"Final Cumulative Time Weight","300A02D0":"Brachy Control Point Sequence","300A02D2":"Control Point Relative Position","300A02D4":"Control Point 3D Position","300A02D6":"Cumulative Time Weight","300A02E0":"Compensator Divergence","300A02E1":"Compensator Mounting Position","300A02E2":"Source to Compensator Distance","300A02E3":"Total Compensator Tray Water-Equivalent Thickness","300A02E4":"Isocenter to Compensator Tray Distance","300A02E5":"Compensator Column Offset","300A02E6":"Isocenter to Compensator Distances","300A02E7":"Compensator Relative Stopping Power Ratio","300A02E8":"Compensator Milling Tool Diameter","300A02EA":"Ion Range Compensator Sequence","300A02EB":"Compensator Description","300A0302":"Radiation Mass Number","300A0304":"Radiation Atomic Number","300A0306":"Radiation Charge State","300A0308":"Scan Mode","300A030A":"Virtual Source Axis Distances","300A030C":"Snout Sequence","300A030D":"Snout Position","300A030F":"Snout ID","300A0312":"Number of Range Shifters","300A0314":"Range Shifter Sequence","300A0316":"Range Shifter Number","300A0318":"Range Shifter ID","300A0320":"Range Shifter Type","300A0322":"Range Shifter Description","300A0330":"Number of Lateral Spreading Devices","300A0332":"Lateral Spreading Device Sequence","300A0334":"Lateral Spreading Device Number","300A0336":"Lateral Spreading Device ID","300A0338":"Lateral Spreading Device Type","300A033A":"Lateral Spreading Device Description","300A033C":"Lateral Spreading Device Water Equivalent Thickness","300A0340":"Number of Range Modulators","300A0342":"Range Modulator Sequence","300A0344":"Range Modulator Number","300A0346":"Range Modulator ID","300A0348":"Range Modulator Type","300A034A":"Range Modulator Description","300A034C":"Beam Current Modulation ID","300A0350":"Patient Support Type","300A0352":"Patient Support ID","300A0354":"Patient Support Accessory Code","300A0356":"Fixation Light Azimuthal Angle","300A0358":"Fixation Light Polar Angle","300A035A":"Meterset Rate","300A0360":"Range Shifter Settings Sequence","300A0362":"Range Shifter Setting","300A0364":"Isocenter to Range Shifter Distance","300A0366":"Range Shifter Water Equivalent Thickness","300A0370":"Lateral Spreading Device Settings Sequence","300A0372":"Lateral Spreading Device Setting","300A0374":"Isocenter to Lateral Spreading Device Distance","300A0380":"Range Modulator Settings Sequence","300A0382":"Range Modulator Gating Start Value","300A0384":"Range Modulator Gating Stop Value","300A0386":"Range Modulator Gating Start Water Equivalent Thickness","300A0388":"Range Modulator Gating Stop Water Equivalent Thickness","300A038A":"Isocenter to Range Modulator Distance","300A0390":"Scan Spot Tune ID","300A0392":"Number of Scan Spot Positions","300A0394":"Scan Spot Position Map","300A0396":"Scan Spot Meterset Weights","300A0398":"Scanning Spot Size","300A039A":"Number of Paintings","300A03A0":"Ion Tolerance Table Sequence","300A03A2":"Ion Beam Sequence","300A03A4":"Ion Beam Limiting Device Sequence","300A03A6":"Ion Block Sequence","300A03A8":"Ion Control Point Sequence","300A03AA":"Ion Wedge Sequence","300A03AC":"Ion Wedge Position Sequence","300A0401":"Referenced Setup Image Sequence","300A0402":"Setup Image Comment","300A0410":"Motion Synchronization Sequence","300A0412":"Control Point Orientation","300A0420":"General Accessory Sequence","300A0421":"General Accessory ID","300A0422":"General Accessory Description","300A0423":"General Accessory Type","300A0424":"General Accessory Number","300A0431":"Applicator Geometry Sequence","300A0432":"Applicator Aperture Shape","300A0433":"Applicator Opening","300A0434":"Applicator Opening X","300A0435":"Applicator Opening Y","300A0436":"Source to Applicator Mounting Position Distance","300C0002":"Referenced RT Plan Sequence","300C0004":"Referenced Beam Sequence","300C0006":"Referenced Beam Number","300C0007":"Referenced Reference Image Number","300C0008":"Start Cumulative Meterset Weight","300C0009":"End Cumulative Meterset Weight","300C000A":"Referenced Brachy Application Setup Sequence","300C000C":"Referenced Brachy Application Setup Number","300C000E":"Referenced Source Number","300C0020":"Referenced Fraction Group Sequence","300C0022":"Referenced Fraction Group Number","300C0040":"Referenced Verification Image Sequence","300C0042":"Referenced Reference Image Sequence","300C0050":"Referenced Dose Reference Sequence","300C0051":"Referenced Dose Reference Number","300C0055":"Brachy Referenced Dose Reference Sequence","300C0060":"Referenced Structure Set Sequence","300C006A":"Referenced Patient Setup Number","300C0080":"Referenced Dose Sequence","300C00A0":"Referenced Tolerance Table Number","300C00B0":"Referenced Bolus Sequence","300C00C0":"Referenced Wedge Number","300C00D0":"Referenced Compensator Number","300C00E0":"Referenced Block Number","300C00F0":"Referenced Control Point Index","300C00F2":"Referenced Control Point Sequence","300C00F4":"Referenced Start Control Point Index","300C00F6":"Referenced Stop Control Point Index","300C0100":"Referenced Range Shifter Number","300C0102":"Referenced Lateral Spreading Device Number","300C0104":"Referenced Range Modulator Number","300E0002":"Approval Status","300E0004":"Review Date","300E0005":"Review Time","300E0008":"Reviewer Name",40000010:"Arbitrary",40004e3:"Text Comments",40080040:"Results ID",40080042:"Results ID Issuer",40080050:"Referenced Interpretation Sequence","400800FF":"Report Production Status (Trial)",40080100:"Interpretation Recorded Date",40080101:"Interpretation Recorded Time",40080102:"Interpretation Recorder",40080103:"Reference to Recorded Sound",40080108:"Interpretation Transcription Date",40080109:"Interpretation Transcription Time","4008010A":"Interpretation Transcriber","4008010B":"Interpretation Text","4008010C":"Interpretation Author",40080111:"Interpretation Approver Sequence",40080112:"Interpretation Approval Date",40080113:"Interpretation Approval Time",40080114:"Physician Approving Interpretation",40080115:"Interpretation Diagnosis Description",40080117:"Interpretation Diagnosis Code Sequence",40080118:"Results Distribution List Sequence",40080119:"Distribution Name","4008011A":"Distribution Address",40080200:"Interpretation ID",40080202:"Interpretation ID Issuer",40080210:"Interpretation Type ID",40080212:"Interpretation Status ID",40080300:"Impressions",40084e3:"Results Comments",40100001:"Low Energy Detectors",40100002:"High Energy Detectors",40100004:"Detector Geometry Sequence",40101001:"Threat ROI Voxel Sequence",40101004:"Threat ROI Base",40101005:"Threat ROI Extents",40101006:"Threat ROI Bitmap",40101007:"Route Segment ID",40101008:"Gantry Type",40101009:"OOI Owner Type","4010100A":"Route Segment Sequence",40101010:"Potential Threat Object ID",40101011:"Threat Sequence",40101012:"Threat Category",40101013:"Threat Category Description",40101014:"ATD Ability Assessment",40101015:"ATD Assessment Flag",40101016:"ATD Assessment Probability",40101017:"Mass",40101018:"Density",40101019:"Z Effective","4010101A":"Boarding Pass ID","4010101B":"Center of Mass","4010101C":"Center of PTO","4010101D":"Bounding Polygon","4010101E":"Route Segment Start Location ID","4010101F":"Route Segment End Location ID",40101020:"Route Segment Location ID Type",40101021:"Abort Reason",40101023:"Volume of PTO",40101024:"Abort Flag",40101025:"Route Segment Start Time",40101026:"Route Segment End Time",40101027:"TDR Type",40101028:"International Route Segment",40101029:"Threat Detection Algorithmand Version","4010102A":"Assigned Location","4010102B":"Alarm Decision Time",40101031:"Alarm Decision",40101033:"Number of Total Objects",40101034:"Number of Alarm Objects",40101037:"PTO Representation Sequence",40101038:"ATD Assessment Sequence",40101039:"TIP Type","4010103A":"DICOS Version",40101041:"OOI Owner Creation Time",40101042:"OOI Type",40101043:"OOI Size",40101044:"Acquisition Status",40101045:"Basis Materials Code Sequence",40101046:"Phantom Type",40101047:"OOI Owner Sequence",40101048:"Scan Type",40101051:"Itinerary ID",40101052:"Itinerary ID Type",40101053:"Itinerary ID Assigning Authority",40101054:"Route ID",40101055:"Route ID Assigning Authority",40101056:"Inbound Arrival Type",40101058:"Carrier ID",40101059:"Carrier ID Assigning Authority",40101060:"Source Orientation",40101061:"Source Position",40101062:"Belt Height",40101064:"Algorithm Routing Code Sequence",40101067:"Transport Classification",40101068:"OOI Type Descriptor",40101069:"Total Processing Time","4010106C":"Detector Calibration Data","4FFE0001":"MAC Parameters Sequence","50XX0005":"Curve Dimensions","50XX0010":"Number of Points","50XX0020":"Type of Data","50XX0022":"Curve Description","50XX0030":"Axis Units","50XX0040":"Axis Labels","50XX0103":"Data Value Representation","50XX0104":"Minimum Coordinate Value","50XX0105":"Maximum Coordinate Value","50XX0106":"Curve Range","50XX0110":"Curve Data Descriptor","50XX0112":"Coordinate Start Value","50XX0114":"Coordinate Step Value","50XX1001":"Curve Activation Layer","50XX2000":"Audio Type","50XX2002":"Audio Sample Format","50XX2004":"Number of Channels","50XX2006":"Number of Samples","50XX2008":"Sample Rate","50XX200A":"Total Time","50XX200C":"Audio Sample Data","50XX200E":"Audio Comments","50XX2500":"Curve Label","50XX2600":"Curve Referenced Overlay Sequence","50XX2610":"Curve Referenced Overlay Group","50XX3000":"Curve Data",52009229:"Shared Functional Groups Sequence",52009230:"Per Frame Functional Groups Sequence",54000100:"Waveform Sequence",54000110:"Channel Minimum Value",54000112:"Channel Maximum Value",54001004:"Waveform Bits Allocated",54001006:"Waveform Sample Interpretation","5400100A":"Waveform Padding Value",54001010:"Waveform Data",56000010:"First Order Phase Correction Angle",56000020:"Spectroscopy Data","60XX0010":"Overlay Rows","60XX0011":"Overlay Columns","60XX0012":"Overlay Planes","60XX0015":"Number of Frames in Overlay","60XX0022":"Overlay Description","60XX0040":"Overlay Type","60XX0045":"Overlay Subtype","60XX0050":"Overlay Origin","60XX0051":"Image Frame Origin","60XX0052":"Overlay Plane Origin","60XX0060":"Overlay Compression Code","60XX0061":"Overlay Compression Originator","60XX0062":"Overlay Compression Label","60XX0063":"Overlay Compression Description","60XX0066":"Overlay Compression Step Pointers","60XX0068":"Overlay Repeat Interval","60XX0069":"Overlay Bits Grouped","60XX0100":"Overlay Bits Allocated","60XX0102":"Overlay Bit Position","60XX0110":"Overlay Format","60XX0200":"Overlay Location","60XX0800":"Overlay Code Label","60XX0802":"Overlay Number of Tables","60XX0803":"Overlay Code Table Location","60XX0804":"Overlay Bits for Code Word","60XX1001":"Overlay Activation Layer","60XX1100":"Overlay Descriptor - Gray","60XX1101":"Overlay Descriptor - Red","60XX1102":"Overlay Descriptor - Green","60XX1103":"Overlay Descriptor - Blue","60XX1200":"Overlays - Gray","60XX1201":"Overlays - Red","60XX1202":"Overlays - Green","60XX1203":"Overlays - Blue","60XX1301":"ROI Area","60XX1302":"ROI Mean","60XX1303":"ROI Standard Deviation","60XX1500":"Overlay Label","60XX3000":"Overlay Data","60XX4000":"Overlay Comments","7FE00010":"Pixel Data","7FE00020":"Coefficients SDVN","7FE00030":"Coefficients SDHN","7FE00040":"Coefficients SDDN","7FXX0010":"Variable Pixel Data","7FXX0011":"Variable Next Data Group","7FXX0020":"Variable Coefficients SDVN","7FXX0030":"Variable Coefficients SDHN","7FXX0040":"Variable Coefficients SDDN",FFFAFFFA:"Digital Signatures Sequence",FFFCFFFC:"Data Set Trailing Padding",FFFEE000:"Item",FFFEE00D:"Item Delimitation Item",FFFEE0DD:"Sequence Delimitation Item"};ResourceBag.DicomPluginCss=`.container3DTag{position:absolute;font-size:10px;top:65px;right:2px;width:50px;height:30px;text-align:center;display:flex;align-items:center}.quality3DTag{border-radius:3px;padding:0 6px;opacity:.85;font-family:Open Sans,Helvetica,sans-serif;width:20px;text-align:center;position:relative;margin:0 auto;display:inline-table;background-color:#2980b9;cursor:pointer}@keyframes showing{0%{width:1px}50%{opacity:0;transform:scale(2)}100%{width:20px}}.containerTag{position:absolute;font-size:10px;top:45px;right:2px;width:50px;height:30px;text-align:center;display:flex;align-items:center}.qualityTag{border-radius:3px;padding:0 6px;opacity:.85;font-family:Open Sans,Helvetica,sans-serif;width:20px;text-align:center;position:relative;margin:0 auto;display:inline-table}.qualityTagCL{background-color:#f39c12;cursor:pointer}.qualityTagHD{background-color:#16a085}.qualityTagCanvas{width:50px;height:30px;font-family:Open Sans,Helvetica,sans-serif;display:flex}.qualityTagCanvas canvas{width:100%;height:auto}.sharpeningTag{position:absolute;font-size:10px;bottom:35px;right:5px;width:fit-content;height:20px;text-align:center;display:flex;align-items:center;background-color:#f39c12;border-radius:3px;padding:0 5px}`;ResourceBag.EllipseTemplateJson={ClassName:"Vue.Products.DicomPlugin.EllipseAnnotation",Name:"EllipseAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Click on the ellipse's endpoints",NextGroup:"Label"},Label:{GroupName:"Label",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click on the label position"}}};ResourceBag.LineTemplateJson={ClassName:"Vue.Products.DicomPlugin.LineAnnotation",Name:"LineAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Click on the line's endpoints"},Label:{GroupName:"Label",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click on the label position"}}};ResourceBag.MarkerTemplateJson={ClassName:"Vue.Products.DicomPlugin.MarkerAnnotation",Name:"MarkerAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click on the marker position"}}};ResourceBag.PolylineTempateJson={ClassName:"Vue.Products.DicomPlugin.PolylineAnnotation",Name:"PolylineAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:5e3,MinPoints:2,PromptMessage:"Click on the line's endpoints"}}};ResourceBag.RectangleTemplateJson={ClassName:"Vue.Products.DicomPlugin.RectangleAnnotation",Name:"RectangleAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Click on the rectangle's corners"}}};ResourceBag.TextTemplateJson={ClassName:"Vue.Products.DicomPlugin.TextAnnotation",Name:"TextAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click on the text position"}}};ResourceBag.IconReportPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAACO0lEQVRYheWWPWgUURSFv7tsQPwD7YxFKgvBJoKiEBeNCEGwEhsb0XJdbS1sLLRUEEVlwRh/uqCNIogK/qcJiGAhBLERIxFi1GxiInIs9o55jsNkd/AlhQeGe+ftZc65c+57s0g6IGlc8TEp6QQpmKRxYAC4m/7xH2MDcAboNLOPv1ddXV9kciR1Odf6cL0Um3g+lD0elLQ9MtfKPAHrgNWRBSzJXP3vZ2DRBZTTC5I2Ad1+2+/xUMHnvzOz+20JACpA1fPrHo8VFHAPyBWw6EOYZUEnsMZvX3rsTte1iAkze5tXkGVBFTju+TKPwwUF3AL2tivgFHDa82mPRQ+pH0E+BtwA3v9RsVAzkOLsSPK/zgFJJ4Nv+FK/iuJm6tk7JY0A3yU9ltSVZcEV4JHnMx53FWx2LCDvBe4w902oAPUFsUBSr6SGpHN+JZjM2oZV5k6+Ho/P2uTcY2ajCTlwm+abPRrU1IBXWRa8BgY9/+lxMKMuD40M8iNmJknmNVNALZoFkrZJ+iapnpBKMreg4eLibENJlZbIYwjIIT/v5DvC+mQGlktaVYBvysySrRp6PgDUAs8vAfuBPjN7mlY8Xfyc0WhI7h1eCDov+Zv4KqmHDJSBjcDaAt0DpLfaVeCwd14C6sA+7/xFQY58qHlUf0l5XpJ02de3RiEOBOx2O55IWuEDd1HShKQtUcldwNlgJp5Luibps6TN0cldwJvUYH5S849tS7D5S3LJO4APwAjwEHgADJnZbKvP+AU22L/Q9Bx7LwAAAABJRU5ErkJggg==";ResourceBag.IconRotateArrow1Svg=`<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M12.1972 1L16 2.89873L12.1972 4.79747" stroke="white"/>\n<path d="M5.22535 12.5823L3.11267 16L0.999999 12.5823" stroke="white"/>\n<path d="M2.90141 15.0506C2.90141 5.17721 6.49296 2.89873 15.1549 2.89873" stroke="white"/>\n</svg>`;ResourceBag.IconRotateArrow2Svg=`<svg width="17" height="18" viewBox="0 0 17 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M16 12.1972L14.1013 16L12.2025 12.1972" stroke="white"/>\n<path d="M4.41772 5.22536L0.999999 3.11268L4.41772 1" stroke="white"/>\n<path d="M1.94937 2.90141C11.8228 2.90141 14.1013 6.49296 14.1013 15.1549" stroke="white"/>\n</svg>`;ResourceBag.IconRotateArrow3Svg=`<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5.80281 16L2 14.1013L5.80281 12.2025" stroke="white"/>\n<path d="M12.7747 4.41772L14.8873 1L17 4.41772" stroke="white"/>\n<path d="M15.0986 1.94937C15.0986 11.8228 11.507 14.1013 2.84507 14.1013" stroke="white"/>\n</svg>`;ResourceBag.IconRotateArrow4Svg=`<svg width="17" height="18" viewBox="0 0 17 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M1 5.80281L2.89873 1.99999L4.79747 5.80281" stroke="white"/>\n<path d="M12.5823 12.7746L16 14.8873L12.5823 17" stroke="white"/>\n<path d="M15.0506 15.0986C5.17721 15.0986 2.89873 11.507 2.89873 2.84507" stroke="white"/>\n</svg>`;ResourceBag.Icons8AddKey32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAQ5SURBVFhHrZdpiE5RGMcHY0bGEiamUAwJ8YGaLI2y+yDxwTJkSdQkEj6YLGUpGcZOKBKKiJkPYowM8wEfLJGyk+z7nmUYZvz+x3Nf73Lnfe8w//p1nvM8zznPuefe997zJtWGKisrO8ICOANP4Ac8hwuwEnpYau2KiZvDVqiA27AKpsBwmAhL4CJIRVVVVe1s6P+LCbvAPbgFI8ztK+K9QbvzFgaa+9/FJG3gFRzhqhqZry0shBJ8l2hPg7a/m+L46mFvhO/QW75/EhMlM8FlKMNOgTrYuv/f4DFsgzxYZQv5BdshVeNpd8BLYuluwpqKwdPhExNkWH8FdhXtMpr6LilM+AfBUyglngwp2HdgvaXUTAzUfV9uXfVb24RnobG5I4S/Pbyi+FLrj4Vy+k1dQlAxqDuDdLUdzeVEP8gi9Ov4rKK0qfAJciwcTAzIhQfWjRD+uIvAF1GU9ihscsGg0hYy6Ix1Y0Qs0SLOaw6z9bAWukBQMUAvmhPW9RXxahdB/xwLyDd7HZS4QFAxYC5csW61IidmERSuCx/oz7Ccg7BXdmAxYADotZtmrmpFTsQiKD6KVupg8QcwzyUHFQPS4CdMNldckRe+iLtQZP4sFqRfUyeXGETk6wWiJ1e6ST/ZQnFFrrcIfR3bmE/zlLqEIAor/gy7P+07CL2MEolcfTvcJ5lWX0ntYpYLJlJY8efYneXDHg16x+e6pIAifwh8gfnmii8rfgxCxT3hmwF6IHUe8H37ebJ59MFSfoG54yu6OGRgF4J7iiXsYfAIXhPPp+0DTSymB7YnLIaHoNsW6OH1iheDHhwdPFrBDbgCoaslT59i7YC2VcevX/j0dFeoDRe++7AWM9OG+4sEr/gLiC7eQjm0aeQ1o90MKj7IxsrXF66CpB2cCeMgj7jOB19hmvJjREAfjLjFJex9TKarUvEh5nair0Vpu93Ri7T62P3M1o5pQXoWJskXEg6/4tchorhNcgoOYUccMvHp6vXrCC0KW+dB+UJvT2wd3T4yvpnnCC/eFWKKqxjoQSsCbeMANzhMxHfjL7auE75skEKHD2zd5mcw2yt+HLziLcHvyt1E+MogYts94dcJeSZpbttpB9POsXEjre9eQLR74YAMFX8J8Ypr23Ww/ILd0NwxIv4GcqAfuF9EtPBr9xrDGijR5NIYOjHF5bfYTtDAoa5SNSJ+DfKs68T4mFsgkad3yi63AIypNjj6yhXTMUo7FLe4RM4GuMiwOubyXQA5+kf1EcZ7RfRzitl2xVC2uRKK3EzmKIdZ5lKxHvCVWANzyaf7fw9fircAbX30Pd8C2vbg32xEvg6u+totcgX++LzXs658D+hPTC/55NT91Q4UMCBfYHs/tYTb7ifG6ZP7HvRT09UWwGHQ7dTB5O9fM7va1XAyCt+fWlAxbzpz6K23H0pgF0zwduWPkpJ+A4iupKFlOKRcAAAAAElFTkSuQmCC";ResourceBag.Icons8Brain32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAQ1SURBVFhHpZdriFVVGIbHUVIpR7FByIgcLymUWj/EH1Jqpg2agjRoSf6IavzVj5JCjAyMyCvOgM2oaaBiXkFFcBzJEK+JpJGIZkQg3kgNFbWLOdPzrnlnH9fsfYZznBce9v7eb621v3322muvU1KImpqaBsMSOAk34S4ch3HwAfwK9+Bqc3Pzfo6zOfZy946JwT7x4D/BPKiCSbAa/oH/4COYCDOgFi7DVZjgYR5ODLAQ7sAMW4nwuoJ+jUZbifC6w2L4F6bYLk50HAW6u3G2UiJ3CmodpkTuc7hU1OOgw3g4ALr4RtuZIn8QvnSYEhd+hPwFuMP5Fo4DncqWBgM97zoYqQGcyhRt2i1AYoyetKmEBvgLJjoVi4bVbvCqrZSUg+kOCyrgQdF2PmjiPmerRRhlcI0i5thKiVwn2hyFeluZBRAPpW0/hymRbxQOW4TxJtykYzdbQb7o06B5oZ9Qb8Qgp/MV8DWsd5gSOU3u+9DHVjBXwk6HifBeo4hmjpqQ+2CEU0HEqQJoXg038J+yFYlcqfOv2woDbYLlDhO5cX9y3W1Fws8qoBvez3ACnrEdCf8M7aodhk56ReocFiz6ZE5CvL6MqSVZv9wh+AYqnVb+F3jXYTC+gAaHBYs+mQW0itxo5WEDzJRHYaWc3+U4JjSSMKowboAWjh4wC7TWr4K5MNRNI+G3W0CWaD8S7nOtclvBfBRuwyLQyvUn7ILNcILGmog7ITdzEfHDFLAU9jnMCfNbX6iOQ7R24w1XJ6iyFURcVAGMO4T29zjmJqCE8RgJ3fl8WwWpmAK4ht6m06Av5C7bLcJ4By7SqIutgkSfvAXgPwFaut+GdfA3fA8vgZRbjgk02bY6LFj0aa+A7aDX8CJsg6ncYCfnzkP0Gn4F0UpIrLdAC8pcOkZLdKvI5S2APp19mhJ9rsB7DoMxDbS7SWY559oHfgaX4CQD9nQqEX5Rk1Ci/cugb0HyTQnVYmjFOgYVtoOIe4Mmz1pbifCKKoC2Y0F3X2MrJ90hCb3rmqWricPzkogngzYqZbaCiKMCsn4lCb8X7Q5rDM4XQKlTadHoN/jYYRCxNpmp3QxxVADnepUzd8L4KmCFw2xRWTloMYoeg4R3DmY5DCJuW4C27h86jIQ/G045zBYNHncBqbUf70UV6DAIr20B+uodcRgJ/3046zC/NADs4GJ5X6NW0a5tAc+CFpxl9E82tJyPwdPjWWQrv2g0DK7DDzAVnoSuTkfCjwqQiCeA/hXpgrqZP0DSJzlzY5MSDbUP1PJ5i+r1SJY4FQlfm9SFDhPhvQCSvnxvwACnihPX1ubhLbjO+fO2g4jL8W/BQc4ffGVV/I/wna2Oi8HWgNaBPaB/yTXwO2jfdw30Uy+D3aB1ZC/0dveOS3fIgPpHrH++2tfrQp+CNjIVsNxePW1fgfwLTaSSkv8BCUd7UpetGq8AAAAASUVORK5CYII=";ResourceBag.Icons8Business32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGKSURBVFhH7ZfNK0RRGMYnX2UhGyUbH3+AlZVslKzYSJq9laVs/AEWWChL7CY7KcXCxjSJ3bBQ1MjSgtRYGZK61+/hnRtjao5pnFLnqd+c03ufc85zPzr3TurfKY7j1iiKpmEDDmCP2grtiFn+TiwyCNfwCllQiAzkCRHTHtJ0mr2xYuJ+FngAnXGvlRNRH4YrOOV4i5UbJybeAp1ps5V+iOM9UIK0lWoL8zhcwmMN3uClolYNF18RctCnALewzZnN+IL10pCHjO6tHp4JuyDexJrLcBIChAAhQAhQVwD8A7AAi8YcdNhhJ+H/FmDS6jWFvQu/9vMb+meC/j3kzOIk/KuQBDiHTUf0EfLMsDabS5ONgaQ3ZrUxlch3B0mALM2OC3iPoUS/ydbXHKOgeXblcQHvBfz+GcCrd/6TBn+ZrAB5szgJf/0PIUOGGLMG5Uu6BN122En4wz4QAoQAnwH40Wf0lNW9iTXX4UidfShyIT72dR+wnrZ+/b2bV4B2mIXym80X3m97FaVS7zsGjrUUMWbgAAAAAElFTkSuQmCC";ResourceBag.Icons8Checked32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAADA0lEQVRYhcWXS4iWZRiGr0cHig7aaabpZEjgjBGhLqSyA7aYTU5REJGrSgqiTbQJ2hRtpMNsgqYQ0toEWYJEQW0icuaHloGmI0FakWJpWmNBOlwtvkf7Hb75Dn9/+O7+/72f+77f73kPzwPneUQbsDoA3A2sA1YAS4BTwM/AYWAamI6I0301oI4CzwP3A0uB3cBPKSowDCwDbgH+AHYCmyNipqmRhYSH1C3qKXWXukkdrME/pn6tnlbfVa/oVXyN+qP6rTreQ/wGdb96QF3bNnhcPaluVy9qK97Fs0T9UN2sXqB+rt5XF7QmxV9VW23SCs5F6nvqEXV5FXAoP/v2fokn7wvqX+oddcAtmfOeP3sJ58PqnLpRHVZfXgg4mru99YarEF+r/qm+lL/H0sytZeBt6q4+ii9TD6nvd6dTnVbfmQ8eUI+qT/RJ/FL1G7WjXjhv7nH193PSrK7Pi2OoD+KL1U/U78v41KWpdS/Aovz/LmB3RBz5rwaAieTbUMYXESeAvcBt3QZuorjbS0emqPZKVZ8GngEeiYg9FdC9wPJuA5cBhyoCXgQ66g0V4mPAG8CzEfFZjddjwJXdBurGBHAUmFJHSsRXAh8AkxHxZgO+gTPaZwwcB65dCB0Rx4ExYAb4Sl3VJT4IfAp0gOearCa1fus28B1wXVVERJwExoEp4Ev1zjxiO4FZ4NGImGto4PrUPLuK9XlD1R7DPGZb88H6Qj2s3thQmLyO59R75pP+om5qSBLqa/nA3N5UPGOfUn/N8u6ciW3qVEuy0Tb4jOmoW8smVqh/qw+0JW0h/lA+eCsXAryt7lMv/h/EL1Fn1Mkq0JB6UP2ozwVJqDss6sOr6sCr1Vn19X6YSPGJ5FxVH8HZinbWoqDsOR352XckV3UxWhK8OtOxr5eNqT6YOT/QeOUlJIPqW7lzp9Un1asr8MOJ6eSJmqzLedPWbIR/W7PLgT3ADxStGcA1FK3ZzRR3/MfAK01as7bN6WKKYmMdMELRnAKcAPZTvBNTLd6E8z/+AZ9owaOJ8ea4AAAAAElFTkSuQmCC";ResourceBag.Icons8CoordinateSystem32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHKSURBVFhH5ZbBLgNRFIaHbpCU1MLCwoJNI4iFhdgIz+AFbGqtiRdgIx5AQiQWDRoPQCQSIWFh4wksbKwRCzYd35meSYvemumcKxJ/8uXee87c+/+ddtoGf0JhGHZDAXK1Wq0X8toKZE69R5d+hMEIhJhNwiLTJygwH4JXmNNL/ag5gKwZr2ADtuAsusinWgSI7gKj/1cv+hpAxPwGznXpV44AB7Cty8TimD44juGMdW25xYVmAdgjT9GO8gCn2nLLEWCCUlGXqcX+KXiDWS251SpAFnGUfJ/cQrI7aB2Ac8rwyJEDWmovywCcIZ8BeXzvQD4Ha9pyK2sAtuagS+c2T0FSsU3e7wrjppbSq9MATebyrTmj5fTqJICZuShtAFNzUZoA5uaipAG8mIuSBPBmLvopQBZzrs9DFcZ0vQKrUTNWuwBZzGOxT35Z92EQXmBeW3W5AliYi9hfZP87HMKFlhvigm8BWJq+55xxox7LWmqI+qcATK3Nx0HuQAUutdxQcwBrcxHnHMEeZ8pf/WdY0FZdNKIAaJqmtXk/VDlzVNaMJdblqBmLYnwHrhnMzBMrDiDCfJeh5BM8ltS6LgrDcP+LnKj1v1cQfAAtDdcN5gOHKgAAAABJRU5ErkJggg==";ResourceBag.Icons8Detective32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAM6SURBVFhH1ZZpaM9xHMe32eVsjokH5KEZo9DKsVwhR44VzU0Unkge4MEURXkoZ5GIlMYTIrKVlUIxUiiGscQkx4YxO7zev97/f3/G/jv/eNer7/dzfI//73v94/47NTQ0JEGazY4Xg6XW19cvgQJ4DfX4Gii+wiPYgznO6e0rOl8Ez6ESjsMyyGHAkZTTYBNcAekSDHXTtokBkujsENTADujh0G9FfAhchiqYb3frxODxdHIK3kK23VGldrCFNnVtmgSNt8InyLKrRXL7z9Dy5aDRAKiGVXbplyVja733QxE8hAq4C+chH4Y7PfQFL0KhXc0XjQ7CHTpJoEyHnfAeSmEvLIaJMApmwFo4Dcp5AMtpm0ipPVFHfYK7ji6SO9HoDayHzaANpaUoVsxpykuFQRBvlyaeAV+c/xgmQSEccEp0kZxNpzrfTyluUY6FCurhM46tX1ztPH2V8D6hriXSydkI+iIvoMzh6CJ5AWj9t9O/juEweEc9wfFMqNXgIWGXBI0R9elwX3VCA6kXg5YhMUiIJpI3wD2b6mRKqEMJewU0EjmdFacMJhwkI+qZjve3q2mRuBLKbWpA3XYVNhUPlihS+J45rLg2Z6lN2WOc092upkWijloNbZJtp0Al9oggAWHr3g9E/SNMdUixXXDCpuw8qLIZXfTZkwa6eiM73QdnbAbC1l6YBel2ydcXtPFy7JLvKFyw2TzRoIiJHLOpSfXBVw75djUSOWnEr0W2w+4KusrX2dU80UCXy3fIsEs+XSplcA60rsGpoOyGrWf6CZyFYDNK1LeBbsuwr9mikZ7XGwzQxa7Qr9wNr0BHVZ3r0bkNecQjL6XRoLdgjV0tE531o7E+ewH1VLsDYSeAzngW9LY7LHy6EcvJuWpX60Qn2miaxE06G2z3H0WOHqCFlB9AJ+Qb5DrcOtGPvoTuc+2JwzAZ30+3Gr5esBSugwY9qbLdJiHRyUzQtVoLWn89NiXw0j49Qkcg2LiUuRA5ibb9QwqJ/nQkdf71IOm1XA3jIcUpYeHrmEm0RBr0l0nMcyh20qCRk6CY61Ds9E9MQoNGTgLmOBQ7aVAPLmbbHVt5En9n8H9UcXE/AMo7kg60g1foAAAAAElFTkSuQmCC";ResourceBag.Icons8DownLeft32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADBSURBVFhH7ZI9CgIxEIUjC7aCnb3Vgp33sPIC3sZzeADP4xG2EU+Q+A1MYFGjos40zgfDJC9k3tufFPwNpZRJznmhW18w7zA/UCeV/Kjm9At9rbIPYR7mKvsQ5mGu8ncwbMqwnW6bmD05w1YMFWYq3cGZ3Wt/FQDd9ps/C4Bm/8O1ArC3NxceBWDtYy7cBqD7mQvjAJSvuVAD0Ofu5sIowNHdXKgBBNZ72rZVnG/onV79DQztqfObNVBLvRoEH5LSFeVD5w2yvog+AAAAAElFTkSuQmCC";ResourceBag.Icons8Drag32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGwSURBVFhHvZW9SgQxFIXHQu1FKxtt1/fwAbTYfRdlW61cC9/FQrCxEMR3EFwErawUBZnxu8O9o/NnknGSA4f83c35mE1INlRFUazkeX6OpzqVThp+QVvQfuGZLsWXheN3/IIfcRqIRvg+vsEneI7jQjTDZY62BNB+XAg2roWL6FcAIvoGMe7BZMMNvMRVuIhxDUDE+Ahf6zCuugCSKioAG29pt1e+ABzgTe269eu0P+tUr3wAWJ9gv9vRddX+EjVeX4Aa9xUNDRdR530GqOuHGBIuojboEFLbhhgaLqI+CEBEfR2CzgIIedWe8FWgX/FDY87Hb1ggDgVgqoMlHKchlt/g2661PlO/wJ9YXtKJfYUZFoh5OeEp6kPPwDq+xD/hJiaCIagNuQX94SYWgiCo8wKgxh1uosAgjnWqV9Q4AfjfV6nxCzdRKAfT+aRS4wRgfReIe1q/8BD5AERVUgCC9rRbqQuAz72Gd3Q4jgjZxq3b0QSgb6f9TqfGE5u2rij9CoDW/6oNFRvXIGhLABw/3ERABYEF4AynCTcRZBAfuP6wpBKBBpE+3ETwwf/Cs+wbb1Wj/Vz1yqoAAAAASUVORK5CYII=";ResourceBag.Icons8Erase32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMcSURBVFhH7ZZbaM5hHMenOS4zO9kYcspysSTtwoWNkjmMxFwNRZYhp6iVSArFjRJSLrhT48alQ2JOS4ZF5nwaSS5IjZbZ6/N9+77/Iu+7/7u9c8O3Pj3/3+H5PYf/8z7/N+2/UqnOzs4CqIXpdv09MWgxvIePINU51PtisInwDs7DAjgMHbDVKb0nBpkAb+FSJBLJoF0B82El/IAtTk29KD4eWhn4Mu1CqHJIsVVwFKTNdqdOFB0Lb+CKV14OlQ4rXg1ToAa0Exsc6rkYcAwFX8FVqITgXfO8GhbblL0XtBOaxHq7uy8GH02hl3ANMkFnYI7DGrAMJtuUXQUjYB1oEmsdSl50HgXP4TpUwDGHFFsOwbvmeR/Ms6mJ12MfAk2ixu7wotNIeAY3KZZFm0s7w2HFtRMlNmVPgyKbsivI11nZBJpEqUNdS4XgCQUitHehwSHFtMVHbMreDbU2Yysv83M6z/doP9OGO5Qk6v09hiYoBb1/vYZ8x3OgOJqMKK4DWmBT8RJ8GXqm7YOts/OF53HRhEQiqZDkFrgDOfLRakIPQFfuxWgi4nkb7Lcp+xQssym7mXq6L9qg628FSfqwPARtWZ7dUeHTqhuhFSbBIBgC8g8gP12Th4GQAVr5WdDg5S4TXyTlg1bZrGe7fxFFBxO7ALrzT9utvvoObLcpuwFUR4PPtDu+SNLg980fB4+JSfQn5wx8Ap3ybNCq+2FrB7UzJ6AN3yx3iy+S8kjWbLX6hIPHRB+d7OO00km7tRCdgdfwFWbbHV8k5YJ+Ynrvw+wOJQbWOz4A32Gj+sNB+AYVTkssiuiEttAW2pW06F8H0gdoh7kOJRaJmdq/0B0SiBrnPHhwDYcSHfSzCn7v3RF9df9r8OCzHFp0Gg6PoInNyLY7tOi3B9rpu8iu5EWB6LVLkdsw1O4uRR/d/1p58D+g26KIPjxP4RaTyLI7rsjbBTr9S+zquSgW+/Q2JpoE8Z3QQc5Su1InCsf+fNyAIgbRLReAbwdIa36PxaGvS4cXnfT36wVtKlTvssmJjlkwtaewkKRu139FaWk/AXYPZV8WWQg1AAAAAElFTkSuQmCC";ResourceBag.Icons8FastForward32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAABlklEQVRYhe3WPWhUQRTF8bNRYqH4gYLGKoIggo2oYBs7C7EKiIWVaJ3KVrtYKgoGrNxWxDbahIiVEFBIl0bESgU1iKLIzyKz8FjM5r2N+FLsqd7cd8+dP1xm5iYjjbQVhD24jk5D3xUc/hcAB6zpBY418HXxGdeawvc01reeSLKEGWyrWWM1yd0k85jcLMClJDNJbiV5hZM1aiwkOZFkPMkybjSAX1OlBafKehLz+IlZjK/j66JbvsdKK1bxEseHBqjEp/ERb3BmEEAldgTP8R0314OvBVD+HcRj/MId7BwEUOKdckI+4fXf6tYGqORcwHusYGoQQMUzgScFfhY7hgYoefvLpr9xD08HAVR8l/EByzg7NEAl/zzeFs+GAMWzD3MFfg67hgYont14gEd1PcV3sdLKc/33QDtqswXbG4LuTXI7ydUkD5McqumbTnI/yZckU51OZ7E/Yesew1YvIm1dxVp8jE6XIl+xZIPnuAeAo1jAN5t8jldKkVoDSdn8HX7gmSEGkn6A/z6S9Qq1O5SONFKb+gNRFg57wTLEYQAAAABJRU5ErkJggg==";ResourceBag.Icons8FlipHorizontal32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJ7SURBVFhH7ZZNSJRRFIZHMRMrMlyIkDIQQqUSESkILqQIdCGYqBXSZnBhsxERDPrZuFBQQaSCNkGLEgIVNyourI0bEQqEVlEEYQbanyAaOuPzDudz08g4P/db+cLDuec7555zvrnMnQkcyS9Fo9HzkUik0Vz/RNNKGINd+GmP3Ys3vkLDSYiwfod5gv1tYXeiUQ1M0yyKfQu19rzL6QA0qIN5kKZgDlotrPh7JwNQuB4WYJcGb7Bt2FILK16Nfxp7J2MDUCiLgo3YJewOTMAFi91nHYolItYvQceS/gAUyIYWin3A6oyX4Zxi2AqoiiUi1nWkBM3V3gFIbQA25lCwHT7CFjyDmzBsKWp4C8Lmyn8E18yVP5P0AGzIZWMIPsEmjMAl6LQUFb4IzebKvwHV5sq/S50g9vBHQGIeG8LwFf7CKyhWDFsC/bFExFrne89c+behwVz5D0DHk3gAkk5AN6yQrDOehkLFcAtYD2GzzdfV2q21xFpv3mau/A64aq781+xJOMAsSc5E/e/WKr7ICcJ1VzBAmbWKLxKaoNch+0cUVyQ8Bf146OPaxCxlCup9hl/W6mCRdBnGQT+fumLrLZSWqJPcTciGctDXT1ftIujqzbJw0mJ/alcxG8vgBfwDXcEtEPsqJqOUB/DEZt1mz2EbdCW38yzHwgmV9gCeKHQWRkFXs67oEIVzLXygyMvMAJ4oWASDsAG6ssM0yLPwfyKe2QE8UbgQ+lQcuwL665Vv4X05G8ATxfWv5yGswQ/QxXPKwu4H8ESTkzTrgVVYh8c8O+PbAJ5olk/TLvgGf2De1wE80fg4dMIXWLXH/ou3P8YAJeYeyRQI7AGrfjRykenEkgAAAABJRU5ErkJggg==";ResourceBag.Icons8FlipVertical32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAK0SURBVFhH7ZZNSFRRFMfH8BvDicCQjMoiIkMQghb2QasihFpUEhQRUUgupM1QYC6ilYsoFHLlTmjRx0JoEUWg7iIoKCqIojIr0AwkwayZfv/LUZs379rMOCNE/uHHveeec8858+57815kSf+kEolEeTwevws10ATd5locUfAcTUg74Dy21GDu/IqCpRQbceWtAU1Yu2Uh+RWFzsKkiqI/G/gFWy0sP6JOMUXeQZeKopkjGIGn0Geh+REFTsEERWtd+bkGBmEv/IRNFp5bUaiQ5K+hk3mlqqPZBhTD+Al63YZci8THYBJWUTTYwGPGQjjIfBrW27bciMTLSPoCrpmd1IAm+JoYChifwHW3MVci4RGYgtWyKRS8AkMWVwdHLbZGawsWBfSrdIfP/irWfPfAADTAc3BXa8Ei0QGYptA6Wwpr4BXjCnNrTze4+8WWshdJHkHSnU2xYAPfYZf5dMUewnvodBuyFQn2QcqzTRHfETRjR21+EiZgpeysxOYhSPl3o4ivgR7YaDEVzD/CZdkZi417IPT/neTBBoYZa82tvTFsNdAC48zdVclIbHwAN81MEgmDDXwB1yi27oErjFHGEhiGi25jumJDI0ih73iS+47gEqy1GL22uyAGo9gVWk9LbNDXTr+ZKSKZr4FWqLIYvTsuwHLQFYpp/a8icJsyM263pRThDjYwrn3m0xH0gWuEsRo+wGco09q8IugO3DMzVBQJNvAGqs2tHMdZL7V5GeiRHIM2F+ATAfUg7bSlUJHcdwS3YYvF6CkYZCw3XwfohiyRHSqcN2DATK9I6mtgN7jLzLqOYr/mEnYUvrHWYkvJwrkZp577q8wPzwcxJxilmQZ+QDtz+fTmfAmnZcMZ5s/Mdx/eMi+ysnPCcQh0Tl/TRN+BG6AZMtmnr6Y1VnZJ/70ikd/R8G9Vp+vj+QAAAABJRU5ErkJggg==";ResourceBag.Icons8Hide32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAACfUlEQVRYhe3WS2tVVxQH8HWMxidEEIxQEAVfjTQfwc4KIiItgs46MgiagNZCosWKqMOC4KggPugHqKWjdtCRiOKggji39TVRUBRrTe6vg7OOnJ5cc6+PazJwTc5h7bX2/7/Xa++IjzKXBD9gz2wS2Isp7J9NEiNJYmwukBjtNdb8dsqiKH5Ef0SchqIozjQILouIoYhYERFFRDyKiFtFUTx5r+ywPyOxDysxiiupk99W7f8yDmJ1L0i8TKB7OIRhFFiAdQn8d9q8xFmsfRfg/tx0IEm0cB0DM/gsxoUk8QL/4gQWvin4Z/gTD/EVltci0bFFcRH3MYFHuInhbsF34Tl+xao8waVc64oEluBO+g7iNzzF7k7gE5jE95nfeXmSIzWbisQExvEtVrXZ65v0rfY5nmmceB34sQT/uqbbnPn8tGFb1UQlDzDYsNnY9FXOl0mcbIKPZtHsbOi3JtCiNoSbJA411hdkpL5o6Hcl1lhExLzUF/nta+C0IkJETDY2+TwifoqIsVyPmD7UxMzSap7oVIZnpKarUrC+YTuIX2rdMS232JC+m2q66rIbb0spC6uVBdOXBfQAB9rYrsSW/J/WHcoZcjf36MsDTuHgjHHJHD3D78o2PIm/sLiD3ysSyja8jaP4BH/gMbbPCF7bbBg3lEPkcLbTORQd/CoS15Rj+bsEvl5PRbck+pWD5HlWLZxX3oSdSLTS55lyHjSL+42IrE7g6jK6rbyMNikHzKIs1iP42f/vjhNvDdyGyCAO4Cr+STLN6/gqvqxFojfPO8zHELZhR9bM0jZ2vSPRrZhjb8xZJVGlY6Sub/so7YUURXEGLyJizYfC/ChdyX/Xs93p8prFxgAAAABJRU5ErkJggg==";ResourceBag.Icons8HumanBone32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKlSURBVFhH3ZZNSFRRHMUnKysr7YNICFr4kS5aBLVoZ4hTG8HaREFGRUWiNgTVpk22cyUWIrQqgog2SguNQBCCtkGfhODCRUQOGZGQaTP9zuXMkOlK73PhgR/33vPu/M9779735qVWvXK53FbogkHI5PP5Eh9aGRH4lOAJuA8/oMuH4ovirfAcumED4RtpZ+Goj7fDN/nhBzFF4QaH9cIn+OLxHIEHPaccpuFk+FFMUfQGfFSfwCr61yBN/wBtJkxC9B/BkIfxRNHzhEmVtoLwD4FU7XEjzMGeMCGGKFYDk9BnS3ehBJrwbsFvuFPw6X+mPRcmLlcUqqDgBxihv9a2/Ad4f+AtvAQ9CeX422mz0OqpS5cCKTQMY/S32dYduQ4zcNjjzfAOFDwFb5hfFiYvRxTqodB32n225DWD1visrSDGOonTcAo22V66KHIRFJS2JW+/T6jbVjIiQM+8bnGnLXm7YAyeaWlsxxcB2vFfod+W9kIp4xHQ2lbYji8VJ0S7Wju+1LZOqh90UuFZT0S6rQSEHQ87bCu8A2Y4fsRWMiLkLiH/7/g0aCNespWMCGhzUKMt3ZF6n1CPrWSkUNC/WpsteTtBSzGspbEdXwTU+ir/fccXdvx7+vF3PEXXULya9jitrvIF/eJVMi7s+BpbcUTBOngMkwTmafWiGaBbvErGV+0X90IUUbAWsoSN0uqzSndgnQ8H4R0Dfd1cthVPFO6DVxRfdEPhb+G4bvs9W3FF4QGdhIcLxAk0gZZlt624onAG9EVzgpwF/9P4ZyDrYXwRup4ALcMvmGY8b53xbsJrD5MTIfpkuk07S7vXtvyH8MTDZEWwPhrHIewJxlWgl9GFMGElRFgLaDn0IvrJCYzCvMcycRGsd8MV0MYs/vevMqVSfwGxJyBcjSYMfwAAAABJRU5ErkJggg==";ResourceBag.Icons8InvertSelection32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAPPSURBVFhH7ZZJSFVRGMe1EDUEiZLMgqABKQsMRcpqUdZCAs20adNCbLBokRDWyhauWlWUy1qk2UwYFRS2KLIWRTZQaUGQGEWDkZUtTPv9D9+93feez3ch2/nBj288073nnHuTxiVahoaGFkIt1I8xW2G6DTOyWOEgdA8PDz9AS16Y/Qw9jH5o/hsYkG3+e/gU8L9BT8AfRH9Fl9hwkUJCK9fglRZSrJxGabLRKfgVLoHgT8X3O8OeB4vNlb8MZsqmdiL2I/gNvfgTXFFQSOyC12ZfoajA7FToxM80Pw9uyJZgV8JRczXYQfwd5ip/Hu5BH1SS11Ocb+m/Qnw/iSdmF2CnuwSCv9xMb0JF5sqfAn6H1M7GzzFbK28HDV6InwkSvz9fCGoCknILqfNXMNfsHOhVHk5DNwwYz0GrbHINEexmeAlucMUYI+EEXqPT0KmKoefgJ6PT0fnoL/ATzsI2WAtlUAe3QHKR2mz0ZfAHlxBPOAH3CtCPYYXZ6fADfkErxD1K9KFXp7Z6KhGDS8gnnEAXOgW8DTcDWyvX4A2ucBShVu+8Ga2Npr4yLOUEf/QJKEPDKgtpAj3wGVotFFdoqsFPoXXWV4L2j386JOQSPoGnstELQLtdG06P3+3qeEJbf3BYh50F60EXVbaVhZqAtwduQhG0Ej/nCuII+eDKC6ER9uBPQOvU1FhpqAm8hSwLaSK6krebGyPkgivfgJ1nKeW0IW/DCQuFmoB27xoLaQLafKXmRgj10SuvhnpLq+0h6AL/1qQ29CvQ9aobThMqcwUBoTY4+Eb0akup7RJYZPZhaHMJhLrQEzgG2oi6yepcgQl10SsvgQOWVlt9yt1JQl+D4y6B0CbhBD5CroXUwX1oNzd68CqotpRqi8F/XdiboJ/adRYKNYE+dL6F1EkTDBErgOiV6wnts1LVlsJmc+WfgQ/UT7JQqAl4r6ABvI/QBcWhhRrvnDcqJ8FeCjvNlb8F9oLuj1oLO6Ft6AnsBHfnE9eHRadBsgp0yexWToKtH5ng7VmnEdCXUMkWdoKfcAL9UGwhddYC3ldNV6uooFavQ6/hkJWqve4BPXatXIP7j94TYgkn8A6Cv1E6x97PRAb6COhoqu4OKK+jdhW+wwfYRW3Eyj0hHvoV6Huv73vMJxV/GtTASbgObaBjWwH+X9RIwhiJJ4DWyjsgZvB/FfqOPwEG03+7/oo7/8fgEvrM0+ho95ojhHg26IxL9Pc6eSyhT/1N6+PUYUPGCkldq/pv/y9C33dhlg03slCn73guWrffmEGfsY99XJKSkv4AGrdA1EysJPAAAAAASUVORK5CYII=";ResourceBag.Icons8Key32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANbSURBVFhHtZZJSFZRFMetvhSyuShBgyKJioIKIgsXmVhQBC0qWkQRBOIqokUUQQNEfgVFAxXktkWELsLmwYW1aCA3zbWw0VSKkGxy+Pr9L+d9fOPzqc8//LjnnnvuOffdd9+QE4Z6e3uLYQ80wif4By3wCI7AQgsNVySeCGehC15DFLbCGtgM++ExSHWxWGy6TR28SDgH3sErWGvujGK8BLQ732CFuQcukhRBG1zhqkabbxrshRv4ntDeA23/PI3jG4F9Ev5CiXwDEokiJHgKDdi5MAxb9/83fIRzsBuitpAeOA95mk97AVoZm+wS9ldM3g4dJCiw/mHsGO1BmpEuKEH4y+Ez3GE8ArnYb+CEhfRPTNR9P2Rd9Qst4X0YY+4k4Z8BbRQ/YP2N8If+OBcQVEyazyRdbbG5nOgHWYSejp8qSpsHHbDJhoOJCZXQbN0k4fddBL6korT1cMoNBpW2kEmN1k0TY30t4qFymK3DWusGgooJetHctG5GMZ51EfQfsIBqs49DvRsIKibshCbrZhUxaYug8HD4Qb/KYi5BjezAYkIZ6LWbb66sIiZpERRfRyvNtPFm2OGCg4oJ+dANW8zlK+ISF/EW6sy/mAXpaXKLCSTi9QLRyZVe0o/YkK+I9Rahr2OR+ZTnlgsIooTiX7CX036H+MuoLxGrb4f7JNPqK9lNngVusC8lFG/Bni0f9nrQO77SBQUU8RXQCbvM5S8rfhXixT3hqwIdSP0PZHz7ebI8+mApPmpuf6UWhwLsWogfHOxV8AHaGa+mXQpjbUwHdhHsg/fQDoEOr1f8Gujg6MdjKryAJohfLXH6FGsHtK36/erBp9PdpVbCfg76Uo63af4i0Cv+FVKLT1IMbT5xE2hPg4qX21z5lsBqWAaF8gcWE/TB8C0uYV+kmK5OxSvMPTiRKFNxbV9Scepq2+/CZexwfjJJllh8LqQVVzHQQauDX1DmJg9WJFLx6+AVnwKZrrwUtO0NEM62SyRT8VbwK65t149lJ/Yoc4cjXRXaQPK04vLbWA1o21e6SWFK1Um8DZ5B6pVrTL9R2qHwi0tWRI9T2rZrDJWaa2ikChTW1qfe8zOgbZ9l7qERBXR/tQPHKFwtsL1HbWi2PVF2tUfhdgrhPWpZlZPzHw3VJFm5lO2ZAAAAAElFTkSuQmCC";ResourceBag.Icons8Length32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALlSURBVFhHvZZNSBVhFIY1S8NAKVBBC4qMhIQyg5A0gggKhKBVqwha1cagRYG7kqBokS2yFhZFEC0qFy5cSbmohUhFQUYQZL/2T/ZLqT3vx2uIOvcycx1feJiZ95w558zMnTtfXpoaHx9fPjY2NgjHbc2daLoKhhgiiP0TDqUv+tXQ8BX0QDv8NukPQZNaeAt9UGSvAnZCukNQvA7ew3MY4U40OhSEl94QFN0An+AqFMFFGIFNTgniePaHoFgDV/uF7SjbenlsCzg+B50haZLwwhDkHLGVXBRqgq9wHrpg0KFIkbMDdBdabCUTBbbCd7jA1eTDfPZXOjyjiG+Dn3DMVjJRYDv8gNfwAqodihQDbiFPA5+ylUwUaIZfKgSL4DZkHILmjcS/wWlbyUSBXaDn9xkq5VG8mP1eaA9JU4S/kRz9SDvY5tuOLwrshj/QBgMUu+WQhtBvYJ4P/wuvHtS8Uzm244sCe+AvHNUxxUrZrwvBCBFfCx/gMvkFtuOLAvtAzYdhAJY4FCly1sA7uJZr8/0wCi1QCU8g4xDEVsMbuE7zBbbjiwIHQRqkULG9iSFmfI/xq0FvRDfnFNqOLwocBt32Vhe84pCe/8KZiuNpATIE+gyHL2EicXIrxaS9Pl4KDSEYIec8g17OC3crkSigV0zv+UfooljW20ieHstT6Mu1+UlQ82YKrWOrb/vNTEMQL4fHcBdKbMcTDfI5+Qxbrd162ITXhu3EEAdC4hThl8FD6Ce31HY8caKanwX9Tx8CLSLaHA5XSM6024q3mNg9uA9Z/xcixckdoO95k4/Xw+YQjJCulpx+0NWX2U4mF9LavdxWRpFXAnd8ToXt5KKInuMDeAQZh9CjIEerXf3iq2znLoplHcLN9cnVu77M9uyJopFDcKxVrv7d9I+4wvbsi+LThuDKC9nvhpeQddmVs2gyeYgquAHDDFLjlPRFw4khtOjUN73WobmTh7jEla+zlYLy8v4BTaW9lbYInL8AAAAASUVORK5CYII=";ResourceBag.Icons8Link32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJySURBVFhH7ZaxThRRGIUXUFgNZqOFK1k1ATRq1Nj4CKwVJmuiJmohj0DQRAorfQIoiD0tloqJ2AkvoJWtoo0SGzUq2fU7kzNkB3aYce7QcZKTO/+5d85/Z+7cf25lH3uBdrs9Au/BaXgH1t21tyDRIbgA/8Jv8D3ccDzf6XSqHlo+MK+RZBV+hJPE/dYHiG/AdbhCPBjdUCa6kn+ApywngD4OvzJ21lI5cPI1Jz9puSfofwjXuafPUhgwOtyVvGE5FYw5xz0d2lFLYcBoDmrNd33yGIw77glctFQcmByDv+FtS5lgbBNuMoeapeLA6Dr8BYcsZYKxL+ELh2HgKaYw++ww3m4zcMRSAuiP4U94xVIYMLqm9QQ1qOSLtN/hmIdsAW2W/k2Ye7kygWkVwyfdyWmvunsLpSTH5CgGWvP7XE/AqKTSpiZH60PTay+eXIm4WVtNX7s+uC9o2kZPaRLJ4Vmor/wCWov2NdSa37Td/wETVbi38JNMiKMaLh0mkjtepo3AtSb7HBbb73ikllf6tic/4C71DcPT6Lm35g5g0J08UV7p2/7az8BX7g4Hxqrt8V9tR3lFm4mTO24S65UfiQaEAqNnMLW2ozfguEPF+uA0gVz/gl2BzwmMdHKZtJQJxuqgoS+9+JrHwERnuA0mEp1kssA47fMVuGQpDBg9gO8cZoKxKjI/4CVLYcDoLk+lWj5gKRWMicor7S1L4cCwDv9g2rLUE3FyWN6PJQam8Qmn55EJPay2ZwHjIfgG6kyvPX+etk47QbsMVWKL1fa8INlBkjyCOr1G4FrbUxMo5zCRB+TVNhuFl7kOP8PtoycqlX+RfyXGCm0MqwAAAABJRU5ErkJggg==";ResourceBag.Icons8Liver32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMDSURBVFhH3ZfLS1RhGManC5mVlZUQQlOEhi0SoVUXIohIMqIgLSEqcxNuhBJs0SqQ2rSIFt2ITCoSjIyE8g9wE0E0QUlBFFISBRFW3mqm33t4HD2dmfFcpo0P/PjO+3zv+37nzDlzLrEZr2QyWQQ7oBWuQje0pFKp2UrJn2g6l+br4agWewm/hW3fh4vwE+pUFlwsNIsG5XAI2qAT7xnjMGOKcRDsSFsJtzMWqdQRcQL/tEJ/siYU1TJ2wFct9B362GxnfApfoFwlWUXOK2hSmFs0XwnnKfgGP8B+xga8CkifR7xSsB1qlpVV5AxSe0xhZpFUCOdgBF5DI0XzNZ1R5JyBT+TNk+UR8wVg2ibLKxqsJSEBH6Fu6pHmEnlLyR+G/bI8IqcK7PSVynKLiXXwGZ6QVyzbt6jroa5doUfMn4D3Ct1iYhl8gC6azJEdSNQ2Q79Cj5h7BDcUusXEPXgOBbICi9pqsP+9pwfeKhiFXbImhbkJ/kClrFCivkzneLWstPCuQz/T3muKiYdwR2Fo0TyuHdggyxFxJYwzVStrUpjFTNpPs1NWaE3sAKqSZYsvh7fwQJZbJO9jcogx1IU3VfRYY6vTr8xixhLoA3sWLHaS/hUTZy1JYSSx9lbbAbSInlvgHbwgjivFKxJuQYfCSKLPYRgHu+Dsor5tO6PpzCLJnlyXFEYSfdrs8BntnFfLzi0Se+CCwtBi3Qr6DFkvtrM+DzyioBOuKAwlFlxAD7vQetkOdjFTdBm6FQYWC9oLij2mB6BEtn9R1AIJhYFFrT227V3BdfPxLQprYJQjyfm8zyTqTlkt7JUVXBTbncq0WZYvkd8E9perlxVeNLH3tJMKc0rn3F5G7al3XHY00chuHNNeiOTYe/5dsL9bjezoolk9/IJCWR5x5PaKbbfWAbY3ys6PaLiExvYCukdWWszF8a+B6ablaiq/ovljcN4JWGQF2wegC8bgDex2Ev+XWOCIFpv48LCLrBcOEkZ+VE8rFloI9hHZCPZB6fqkmoGKxf4CSSppaOMCdqoAAAAASUVORK5CYII=";ResourceBag.Icons8Lungs32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAARWSURBVFhH5ZZpiFdVGIfH3EXUkIkMIdJRklDLBiUV00xTxgSVFltoUfsgoraoJEjpB01hRCyFFCEqExw1C8PQBGvMpSgMQyotVCw0qdy1spme5/jeO38dR2w+2If5wcN5t3vuufee5RbVR9XV1c2qqqqO0SZhr4rU9RH3bBs3ngUroTJS10fZADL9bwPgxgtgXYN+Aw1gDtB5m3jK8/A13MU9rzgHaB+Dn4OXKWmUOqmv6OBGOtoN+2EMfACHoE0MwBv9AZVQChdgLkyF05S8Ve9BcGErOtkJP8BNxmjb2zE8AX9BGcyHj70Z7efpYoTdD87Awgj9N3Hhu3AYOkYoiRttJbaY9jjtaHgDNsC3xF6NsiRiw8G3Mi5C1yYumAJ+8z4RykXsTXgP1GCYA5vhGDweZbmIPQ9/Qu8IXV0U9oDzPM1z4feGUSmJsJfCd+TV7diTYQ+2b+ThKLNuHLQMexXso6Z1StYliprDHlgXIWPlMCvczP8HfqPDRrR94W84B2VRZt02GKxNXTvsA7A8JesSBa/Ar9A+QsY+hWHh6s+jQ1eAb+I2TFfK0YgVDsC58VK4DmIgvgMfEKFLRaIEfIqnIpSE/yVc/gms6wM+1XqYFgO4L8qsWw6zw03Cfxv8XE0jVCMSa6CSZFq3tJ3wh4KbkK+zJYwEZ7Wz/kfwc/iG3AdcMXuhGLqAy3QSPAKl0efN4FyZqJ+LQHdQ90I3qICj8Bk4gTaBNzxLBz6p3zy9KdwW2EuMK2wH4bXrcVcL9hHwjbiPuGoOEW+Wbq4IeJNsO/VNTKegVUqGiPnUn0A5ueMRTsLvD97cJfcTvBipJFJOwtfhWXAQp2B8YdJ1OiYFCkTOPd9J9gAcDruM9ooDQG3J3wO/gG/Vc8Pc5Q/jYHZkzjNwgqIW+rT+780ER+nAThLz6cqj/qoD0KfmK3CueI58AX6S2VCc1WOrWy1+H1bGhb1gH3jolERsERc4cZaF/6C+diZiPqnKBmAfJ6zVJ+6GtQLmhn8DtgfZJIsPwgwTtM7eIVHkm3gUfJ0vQDbI8XBAOxN+iXen7Ry+k+5JcGWUkqp1IhLfCCs03HYfingSsWHgMevyGwTzYEHknM0fpcIQ1zcl5icbq0/r3uESngiepq6gW1JxCH8JbPRiR57vYI4W/xvIJyX2LuLuZK5x58vTkcpF/B3IVpJLbX5KIGx3xcXhJuH7UFs0XNOFW+gI2O1AImSsK35jWv9+9mI3iVQuYn5nJ+0U7Na0+RNrw++QJqHCdgAbNDxGC0+xDtAl3CQ6dPmthZPQI8K1RG4COPv9HbtkkMT6Ess3H3y39AqND0n4k9GLtlOGPrj1LgQH6czuGdfXKWr8W3I+uCO6od1P272w74ilye0FncFvXEvEPXS2g2d+OtuvRdR24PLXaL+HCxd7qxExP7tnTE2fxD0o7iTomvYNFNM2jnS9RT/+Y/hZXap3095B2y7SDV5FRf8C6DmiBA+84/QAAAAASUVORK5CYII=";ResourceBag.Icons8MeasurementTool32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANqSURBVFhHvZZdaI5hGMdnrGytEbYjUsjGe6Z8FM5YPkpMMQcKB5oVNmzjYAeMUeJkWu3AAWckUj4L0SSZ5KOVj4hoRj5aPhpm/P6P63nt2fM+H3u99q9fz3v9r+u+r/u53/t9nycrjnp7eydBNZyDdngP3fASbkETLIJcG5IZMeFcaP2FuD6HZtgM5bAY1kI9XIJv8JbS7ZBvU6QnJhoFp0E6AdMsFShqCqASOuANlJpfCK2wyymMEoVT4Ak8gulmxxZ3n8e4PdDD531c78Ez0A41WllqUTAVPsIFBo80Oy0xRxl8Ap2ZIouDF0FC2647V/OhZntEbjSshB3QAJtgJvXZVuIRuXFQYKG7qNSLwDwFj5lshFlJ4RfjH+faAx/gBlyGh/g6oK+ggo85NiRQ1PkXwcA5GNIMs5LCWwVfqbkK88CzO+TGw0HQpFfIj7GUR+R0SN2D6S6izk3qlJ50gj7CU/MfUGtWoKgpBemAWR7hzwbtYA0sAy2gVomJrFrb6PmpERfDF9hmVqCo0dm4A/eh0GyfyK0GLUI3tds1t8ALJ+gjvGNwzcJAUROruUTe3fo/zSWCM9BsoSNi/SK0Uuc7CxL5yOb4GyDBJi/l6m0uYTyAKgsdEeu772JQ4KkmH3fbj4CeHf7mEqb+eFZY6IhYv/O7FvpELrA5i/b8J5AvtzPmby6R6IIlFjoibmDMbQs9Ihd653iH4SzkMkfqbe8rkk9hnYWOiDdCp4VJ4UVuO01LyOmB1AbhzSUKbkK9hY6I9feqbUuYFau5K/LVNj68uUTRfrhooSPGZuPpZaNJMdfQ5tQPgQn6TH45fIfo5hKFC6CbCTzPALwKm0j50DvHnww/oQXiN5doPJwBr6HSLEf4OXj6b9dWxtn2FquN39wVg2qhg/F5ZjlSU9CDxtOcumF4h7iWKOaz/x9uIGKifAZ3xp2Aep2R86Cdq4L0m7tigvmgh0SZWaFiEfrq2rimt+2pxER74TOMNStQ1AzstEeJifR96wWynZvyvRVJ+OvJHwW9lmeuucRk10Fvr0Vm+UQuAe8yuu2umHAn6DAlz4B2gniWhar5t9MeJSZutAbOIrguBL3fr4HoB0smRIP+i9gKejnJ7HceJholFwE67X/f4QZLNHQXMXh33l80roMaC/+DsrJ+AzeJ4VSSRqivAAAAAElFTkSuQmCC";ResourceBag.Icons8MedicalHistory64Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAAC6UlEQVR4nO2bu2sUURjFf0eNxqhoEMEiFipBMZXif2AsRLHSdBaClaUpjIVdAgkYAxa2vrpop0WIxkJrBfEBPogWBgSFRGISMI9jkQnZIo+d7N17Izu/amb2zDdnz8w3986wCwW1jVYT2K4DrkTwUg1uSppeSVBOAA3ARDBLcdkmaXIlwYZYTtYrm3LqbwO91TASkHbgcrnivAGMShrOuU9UbI/m0dd8CxQBpDaQmpoPIO9NMBi29wNt2Wq/pK8pfCQLADgEdGfLb4AkAdR8C0QJwHaL7Xbbm8vQbs60LTG8xboCeoEbwDvb55cT2W4FXmfaWzGMVT0A23uBI9lqM9BvewA4XCI7nG17Ciyc+eZs37TYbvAinWussdX2VdvjXp1J2922t6/xWJ0ltRpW00dpAUlTknqYP+sPAC8jfQIckdQh6U8Mb1FHAUkjwF1gZImPvwN9kr7F9BQtANv7bN8HhoCmJSRNwJDtx7YPxPIV4ybYYLsL+ARcyDb/BQZLZIPZNoAzwHvbXeX0cKXEuAI2AheB+mz9GXAU6CvR9DF/93+YrdcDl4C6apuregCSxoHrwEfgtKSTkj4sofsiqQ04AbwFrkn6XW1/sZ4F7gD3JM2sJpT03PYxYK76tiIFIGmOHF+onKBCkfJpcBIYLllOQrIAJL0ADqY6/gLF43BqA6kpAkhtIDU1H0CQUcD2TuBRiFo5OBdiphhqGKwDWgPVynPMigkVwCyLk5pYzIYoEiQASaOsg0nNWqj5m2ARQGoDqQk1DArYFaJWDsYkLfd2uWxCjQK7gZ+BapXLHuBXpUWKFghUZwroCVQrzzErJtQ8YALoCFErNjXfAkUAqQ2kJtQ8YAtwtoISLyX9COElL6FGgR1AfwX7nwIGAnnJRdECgeqMAccr2P9zIB+5CTUPmAFehagVm5pvgSKA1AZSUwSQ2kBq8o4CjTF/wbVGGvOIi/8NxnKyXimnBab5T192MO+9oGAF/gFeYwfvm3BUugAAAABJRU5ErkJggg==";ResourceBag.Icons8Needle32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANkSURBVFhHtZdraI5hGMdnG5PaAdFopWWjfDCTT5gmyiGH+DK+rE0kpmyyJIqV8kFKo33whUxKSaakFEo5ljSHEiKJGDLnw7b39fs//an1zOx9nnf/+vXc93Vd93W/u8/LiKtEIrERfsFbeAinYQeUOSQjmUxmUq+FW/AV7sNyu+OJ5PkkWwiroB4OwwPsSX1hLZyDL7AfFsE+6CJkttOkX3RQ6g4T/jFVfAphpP2noDUIHizRgYZd03MBfkA3tNunkWoLAgdDJJ8AH2GnyhoFifIVyIFXsNXh6RX9aNFdguuUs6CQ8lO4BiXQAh3YC9wkvSJ5A2jRldoUiHoeHANNx1yb0ysSl8F3qLMpEPU58Ay+wQfIsSt9Yki1JR/DGcpDbBtOXduuh/JRvsWgLVgZNEqXSDiCxJfhEeV82ShPB50Fb2BZEIgoaz2sczW+6HAYCc/CCyiyrYaypkIn49gg0KKuk7DB1XiioyySHYcOmCQb3z3QBVvwB1PxR9i0BbVAV9gUXUpOoha+nXzLXT8EWmhLHNZL2KvlJzY4EWOJRHtBl0sFCbP5aiQ+Ue5zgWHXOtH8H7QpukiyDX7CYhJrpWsNvIMZDgkJ3wl4DqNsiiYSrAfNsW7AXNCp9xKmOCQkfuRu/BqtcpuiiQTqVJ3rR4wG3fFPoNghIeHTfRCMlk3RpAROpOEfD9pO92CcQ0LCtx3UJt4DhAQVoCHUwpsIWkw34Z/zia8O1PlKm6KJ+ZsG2mq6xaaCrtKLkOuQkPDNA93/1TZFEwl0feqQ0QqeCe+hTSvfISHhKyDmNRywKZpIUAQ6XvWm07vvM7TSQbZD+hQxWnQ6//NsSl00HgN65eoFsxp0hzfTea+jtS8Rdxd2uZq66ETX6m24A5tA267J7n6lH0is5n6BTamJBLrZtMB0rzdBD9Tb/V/Rfijo7Zf6i8e/Xue55v0IdGOrsXvAop1OxTWuDlw00h7XVXkDdJf/fUSkItrp3Xfe1YGJBhs8dLpKtdVm2ZWyaKuzQuugyqb+Rb/z1cA/QCfcZLsiixyNygmbSZtpc1gElBDQ6c6vQq/nUxyRS/+4akS1LfUQCR/bGPXPgzpvhbQ/lcmpS0uvJD3FtZ3b4SQ0w1IFaLXXOn7QxN+o7VlJX7pJ1ScPmETjb26tULarxJL9AAAAAElFTkSuQmCC";ResourceBag.Icons8Oval32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJZSURBVFhH7ZZNSFRRFMdnVAyxwDaGDTiBSFgIIha0CGqTLUSwNo0oTAgtEnPAkdkEoYuojUhDq4qixQyoEUSG1kInFy4qbBG1mE05lVBMiSgk6oy/8zyzGMbG+XoPhPnDj3vv/9x7zvu67z1bUftS8Xi8LBaLHYETUM/4sIbMEUUawAMT8IOCKcLfgs/wCK5CtS7PTeSUs+yEt1ogTPOEtof2HG0jOMAJzXABBuA5/IZ/EISzmjJzsegULMAqPIAWDWUkDrCUNe3wCrYYj9HWaPj/YqKdiUNZLdpD5DgNC+Rbpm1TO1V61A9hDS6pXRCRW27nbdig71Y7WQRHIApn1Cq4yN0H8rAmXwmMixpoVcs0cQXuUOcX7NxejHIGizBiGCZL6sF76gUMg043rEN++zYLUesybIJDBs8gqDFLxBWQh/In9MoBRMCrMctEzUl4LB25/AXddpmImn6Yko7s+071LRM15Q37Qjpf4Kb6lomaM+BPHElIfUvEQ1hFTfnOXJEDOI8hX7uTGjdd1LpByWU4mDDm4DWG3TBMFHXkR2YJhtQyzDpYAZ9apogTlA/eNHygX672jjBdIN8Dj1oFFXkPwDj8geNqJ4uA/AHJe+EeVKqdt8jl5IxnaeXt16j27mKC/Fp9h6/QwcISDWUt1leAD+RdM0+uYxpKLyYfglHYgDAMglPDaSUHDE26/i9EGV/L6URYfBRuQYQEslW/QQCGoR+6sN20XrgLLxnL9pK576AH8r+V5CshkfwFX4enEIJPINtJPmYf4Q3cBxfza3VpUUXtIZttGyREykZzCd/eAAAAAElFTkSuQmCC";ResourceBag.Icons8Pause32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACuSURBVFhH7Y4xCsJAEEX3BjaWktojWFinsbYW7DyJZ7DSJo0X8DpaCyLY7/pmHWEJ2wSbIP/BJ8zMz/KCEKMmxrglj0quXskwL3r3MjOvDYefd+SeUlp/w7zn+/RKhnlJEreNdSz2r+2g8dpwXODmY4Z5xaNVAZj4ynbNZyUBCUhAAhKQgAQk8AcCL3IocuHRqgC3Y9HrbAc/CbQ8cK7k5JUM87x3LzP1mhBjJIQ3mLBMg7WH4VgAAAAASUVORK5CYII=";ResourceBag.Icons8Play32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHLSURBVFhH7ZYhSANRGMdPGYOBoILBFUUwDQRhZZgsilFZsokYLKaBzaAYBYNoUjBosBhsBlkUgytisYgGQQwioiDqnb/v+M7gmLt79+5Y2A9+HO++9973v9321GnTsnieN429Okwf13UP8QkXCdKpt9NDA9zgG9ZwTEvpoAF2ePoBrkcoHGBepyQLjfwAOpTvxDjjK3zFZcZZLSXD3wACTTPcW8JnlNczpSX7sHldgACC9FHbxW88wWEt2YNNGwYIIEiROef4geuMu7QUnzABBJp24BxzH/AeZ+Wels0JGyCApt3M30D5NKqMR7VkRtQAAawp4Cl+4jZBzE5TFhsFCGDtDN6i2WnKolgBBNbncAW/sEaIopaawwIbAUawivI6NgnQo6XmsMA4gDRi7ZY2PsOClsLDosgB5D2zZgHlvd9hWUvRYXGkAMwt4SW+4yrmtGQGG4QKwJw8T77PVTjGQS3Fg43+DUDTLPUKvuA1TmjJDmzYMAD3J7Wp/FWsECajJXuwcV0AxkMoH7OwR+N+LdmHBr8BuMqBsobyBbvAkj8pSWjiB8Ayyk/qEeflp6ZTkoVmEkCeOPopZgMNYHaK2YDG9v/NatN6OM4PBcg1QyhJ5zMAAAAASUVORK5CYII=";ResourceBag.Icons8Polyline32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIGSURBVFhHxZc9SJtRFIaTocWUFIODIIUMDkUlXVSwSkEdnBza2UlQDB26NCpqpVBEcJCCS/APwVFCoVsHMdJOCoI4CC0taAaHVnRRMARNfW54UxAV/PKlxxceDue9955z702+/ATuQ/l8PgGnEJdlKxqv/UXElCw70TQGWZhjD1HZNqLhQxpvw2dZ3kSBCIvfQbMsT2LdJPyGalnexML3eu3+QL+XQsxtg3N4Kcu7WNwKR3AIx+AKfoME+6rVtGtiLMycn7Akq3RRZAgyFH1A7IIkHOhmduADNGp6QeSzsAePZZUuijxTs5gsd8Ig+XPiFPGHxvdhBj6Bu6l2TfcvimUgofSaGGuAMfiuzWQ1VB5RcB7SSm8Vc57AFxiWVR5xqFcUzRLDsmzlGrOBnNuILHuxgTQkldqL5oOQUWovmhcfx3pZ9nI3ALc+jv9dNJ+DdS4iKMu/KFgFExTtgEqIkrvrfkHshh54TT5C/Ep0L8O0lvsXxcZd0ZvEWA7cF9Ev0i1i8ZNuWcv9i2J9cAHuC6SF+nXEGuIjTfknvArGOiEky78otgorSm1F46eQ52QdsmxF74+wywbK966+q2gcAvcr540sW3HqXpqfECOybEXzTVhQaitO3QTueb7yW85MNF6EDaW2ovFbOOMCBmTZiubujeeuf1SWrWgchxR7sP2jWFAgcAlSNzwn3/uqrgAAAABJRU5ErkJggg==";ResourceBag.Icons8Print32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAByklEQVRYhe2Xv2sUURSFv5tdCBgQUVsTq1iKjVhqITYWEtDKWFrb2NhZWfsHKAjaB1YEEbTQShECmsYiECGCjUYkioX7WeyMGcfsztuX/dHkwIM3756558ybO7w7MGXEoKD6GJjdo8aviLiYa2AbeAp8yBRfBC5ExFzW3eq2upQpjrpUPERfzOQmHxX2DewbaJcT9TRwkn8/zTZwXj2amf8U0FavV9YEViPiDaWYugw8AD4CvzPFUtEC5oFrEfGQwsCKem/Mwn+h3ldXYKcGZoFvYxScU49XlrYKzYkV4WtgXb1UD4zdgDoDHKZXb0fq8fZ/d4wYEdFVzwAngGcTN1CY2AA2dosNNKAeouHIToARsdUv2LQDm8CBPRr4AfTtB1JewU3gRab4OeD2IEKKgfWIeJujri40cZKLUL0L9O3tauhExI0U4jBfwSNgLZG7mpq0NPAJOKteoXdalWhV5t+BrwNy/QSeRES3tt5SL1eug15t7LxWdUF9pX6pjW7ZlBYHSD1eHZ/VY1Xloint7sJ9qc43bs8kuuJhivAWva1LwfOIuJNCHKYI3wEHE7nvU5MmG4iIDtBJ5Y/SwNWiX8zBYhNh6j+nU8cfihz3xax7jSAAAAAASUVORK5CYII=";ResourceBag.Icons8RemoveKey32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAQTSURBVFhHrZdpiE5RGMcHs5SxNAiFsiXEB2qyRNl9kPLBniVR00SKDyZLWUqGsROKhCJi5oMsryzzAR8smZSdZJ0xdrIvM37/47njXe5734v5169zzrOc59xz73vvedNqQ1VVVR1hPpyFJ/ANKuAirIAeFlq7YuImsAW+w21YCVNhBEyCxXAJpJLq6uq2lvr/YsIucA9uwUgz+wp/b9DuvIJBZv53MUlreA6HuaoGZmsDCyCC7TLtGdD2d5MfWz36G+Ar9Jbtn8RE6UxwBUrpZ0Id+rr/n+ExbIUCWGkL+QnbIEv5tNuhEl8zN+HfiuQZ8J4JWtp4Of1q2qU0GS4oStgHw1M4hT8dMunfgXUW8nciUfd9mQ01bmUTnoOGZo4R9nbwnOJLbDwWvjBu7ALCiqTuJOlqO5rJiXGYRejX8UFFabPgPYw3dziRkAcPbBgj7IGLwBZTlPYIbHTOsNIWknTWhgnCl2oRFzSH9fWwFjtHWJGgF80JG/oKf9JFMD7PAgqtvxYizhFWJMyBMhsmFTEJi6BwXXjLON9iDsAe9UOLhIGg1262mZKKmJhFUHwUrdTB/A9grgsOKxKy4QdMMVOgiItexF0oMXsuC9KvqZMLDCPi9QLRkyvdZJxurkAR6y1CX8fWZtM8p1xAGEUVL6c/gPY11LyMUolYfTvcJ5lWX0ntYq5zplJU8Qr6nWWjPxr0js9zQSFF/FD4CPPMFCwrfhRqinvClg96IHUe8H37ebJ59MFSfJGZgxVfHFrSLwb3FEv0h8MjeIG/kLYPNDKfHtiesAgegm5bqIfXK34M9ODo4NECbkAZ1FwtcfoUawe0rTp+/cSmp/u72mhhuw9r6La3dH8R4BV/BvHFmyqGNpu4HNpNoOKDLVe2vnAVJO3gTBgHBfh1PvgE0xWfIBz6YAQWl+jvZTJdlYoPNbMTYy1K251w9CJFO6YF6VmYbObfwuBX/DrEFLdJTsNB+jGHTGy6ev06YhYVL/w6ur0jP8czRBfvCgnFVQz0oJWAtnGgS44S/l3Yj9kwqYjTbS6H2V7x4+AVbw5+V94PtO2l4HuF2HVCnklYBm1/2iHxYHcvINo9sF8dFa+EoOLadh0sP9Kvb+YE4X8J46E/uF9EvLBr9xrCaohocmkMg4TisptvByhxmKuURPivQYENA0Wc3ik73QLoTLPk+CuXT8co7VBgcYmY9XCJtDpm8hUx+kf1DiZ4RfRzSth2+VA/M6UUse2Z4wvMMpOv8Ov+3yM+01uAtj7+nm8GbXv4bzYiXgdXfe0WugJRwqYr3w36E9PLM+r+ageKSCgU9L2fWspt9xN5+uS+Af3UdLVFcAh0O3Uw+fPXzK52FZyMI/BlkkrM24w59NbbBxHYCRNjdyUt7RcNcmdjtNGTJQAAAABJRU5ErkJggg==";ResourceBag.Icons8Rewind32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAABqklEQVRYhe3Wz4uNcRTH8c91R7HAgixEzSQWJilSsvQPsLFgYTmWmpWtZOEPsLB2d0pZyGKUkJqSlchmdqJEQn5nelnMl555Zube584dXeqe3fOc8znn/f2e53uebzKykf3Phh0406emhbPYMmjxk3iLTh+aCdyxYNuSZN0qCo9jJkknydeGmjamkzxNMlH1NQYoWzeV5EmSTUkOJrnXQDeZ5GGSS0kuJjnVtGY1yW7cxRecR7u876zUAoyV2G+4jz3l/aFqC3oVHsM5fMID7K35lwXAATzGe0yhVfE1A8B+PMKHArGkXXUAbMAF/MAt7FxG0x0A68vWfcdt7OoC+QcAR/Ecr7sdza4AOIJneIPTKyWpAdzEFcyX5609NEsBsBGX8RPXsb1X8QoAvMKJhprFADiGObzE8SZJKsmu4So296FZBND3IPorNtQW1Jy/P8J3FqZeE4AbBX6+wHc93//2MawFDmcQ1YKHN4prCYfzM6olbJXVfMQs9nUDqOgmS/znAnR4VQCVhOOYKSt70QugaNqYLhBzAwFUkq7JlWxQiOFdSkc2srWyXz9pNPFKiyJhAAAAAElFTkSuQmCC";ResourceBag.Icons8RotateLeft32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJfSURBVFhHzZc/SFZRGMY/y4wy0sEsSqGgRRC0QUQnKZCioUEchEAM0zC0qQxtCm3MpIgaGkNpiTBsaBFxqCVRcHCwBvHfkBqikNb39Xuvj5JcP733ft+99cCPc97nnPe8x/vH79zYf6V4PP4AKhS6lEgkchmvgW7oh0G8N7S90A4VxAc03b9YYJwF7ivcFv5FeAcbsAIj8Aoew0sYgDEwzcJTOKN07yJpxwaIz8EH+A1v4TIc1rBLjJ2GZhiFNbArla3h/cXk7Q3Qv0Z/mdb+2gvOBI+y20DOdZiGL1Coob3FRGcDtDfgF3QRH9Swb5F/AoZhHkpkJxeTbANDtFa8VXZKYr0s1rIHdpr+Kdm7SxtIqG36G7xyTfMt8o+S/8mgnynbLSYMwlQSXmhaIJFfAD/glqzoRfFOmAPvb0Y6pVuxALdlRS+KP4ePCqMXxathnauRIyta2W0Ae9MuyYpeFF+Emwodow2uKAxd1JqAuwod4z08URi6qDUO9xQ6RiPUKQxd1JqBBoXRi+JfeQ5LFW4KowoC//KlLHa1BPUKQxM18tXdKQbsePVMYShifTsfrIL73MnlD36Y9CgK98AUtXb/SWYgjwmvaXNlpU2smcPadqitkeUWg9kwCQMkpP2BZN1idZPLJtkm2MBZWSmJtU7CHdbLkOVdJB43FPoWuWXwDT4H3cBD+A4tfm8JOfmwDn3kHpPtTyQeYoEOsH+d582jtVfJ9XGCZ1frKjzaKki/yBlMp1jUPjbsabZPsSPy7CPE9BPsezG8wwaL26taTVsra+uvr4R/c9gMrljsD00Bov8IS5x8AAAAAElFTkSuQmCC";ResourceBag.Icons8RotateRight32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJTSURBVFhH3ZY7SBxRFIbXaMRHYiASFARREmJhJQpKlAj2RnxASrHQIgQ7QQQRtFZBo7EVLQSTGCGQJo2INoKvwioWWgpCCAZJort+Z/h1ldV1ZndnQH/4mPnPPfeeOzN3Ljd0pxQOh7OhEQbgIyyKmUgk0su1gWum0mNEeyc0yroXnWrgM/yBY1iVH4NxmIUNOIHfMAHP1f1CxL7BpOztIrkU5uEUvkIb5Ko5RrQ9hQ5Yg78wwhvJUbO3CZDYAIewDDUKuxZ9mmEfduClYu4mQJI9xX8Y5QnSFfYs+ufDdzhgnEqut0+ABHvyf9CtUFKi8EPGmoMD2IabJ0ByCQn22kcVSkj0b2WsrnPw77n+gkjcCdBoC26ZvIRfu/VlDPsjdm9gUKlXRUM12Gr3vOBSIgp/gQXZYEVh2+GOoFWhYEXhN3DM93ukULCiuO3tq7LBi+JT8Ek2eFF8AcZkfRe1+qBe1gnYFjks67uoZTtij6wTmIZZWd9FrSGolnUC72BO9n6LX72Qh62QjYqgbUZ5sr6JGva552WjItgPK7K+iRqb0CIbFcEysEOI90OjB/EJ0nQbK4p/gDXZlIpxq2BC9noxOzu9OOe3VIoxn8EezCgUXyTaWa6bCWUolJQY6y0sMd7FCTmuSCymgx3NfkCBwp5F36KEH4LOL2AdthRyLfrkwQjYon6tsHcx+0wGKLV7ruVgv+orizsJl0TsiWH35Nix/ic0OY2pEIPZKrbDpskOL8WX4nt4O/G6W2TJiCK2omup90D+MbTj6yDLSbo7CoXOAF5klsgZoKlvAAAAAElFTkSuQmCC";ResourceBag.Icons8Search32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAI6SURBVFhH1ZbLS1RhGMbHa2YEGYG6aN/QMDsRLCFJFLxQOmAUhQgKuSpwEUG26w9wo4EiLcKNa1FxBmpVbmbZQjfKIFTMQpDSSmf6vfEUk9Ccy6eTPvDj833O917O58ycEzl1yufzVXBB4fGLZjW5XO4+zMNHyOHlWfZgDSYIr2v70Yri92CTBtusczAIbdAE3TAGb+EAliCmVDfRsIpiL8Hu8gVx0SNnTxyWYQf6ZYcTzcooYnf7Ca7J9pTyxsFOI/wQJD+FLxCXFUjkPVN+8H8HSZdhFwZlBZZOYhGSsvyLpClIU6RcVihRIwb71Lkhy1tsriDpMwzLchJ1UjCp0FtsbmYI+37Xy3ISdR7DhkJvsXkAsgqdxb20U++AtVJWcbH5EXxQ6CxqxXWijbKKi41DkFHoLGq1aIDzsoqLjZ3wnZxqWU6i1l3YUegtGtfZANAhy0nUmYUFhf5EQopBXikMLeqcgyyMyvInErrgB0RlhRL5z8GeJWdl+RdJK/Cek6iVFUjk2qPangUjsoKJxg0kZ2Cev2tk+xI5Ucsl742scKLIVQ2xSrErsv8p9tgD6A7rNthX7xskdDmcqGMnkQT7TEzDTby/ftXwLsIDeAfW9LWtRzaEiSL26mWvXftgj+p1SMOWvK8wA78+uKwJKBzC7Q3pt6h3iWI98BCewDC0whlt+SO84xkiiKzpoSH6dKl0sqaFQ7Dc1qXS6UQMYU0Lh4BbulQ6WVM1N3pll1Ya4v80P6GKRH4C/8u771lmJOcAAAAASUVORK5CYII=";ResourceBag.Icons8Skull322Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAADT0lEQVRYha2WS2hdVRSGvxVuIkWKRhongkXJQMUOogOfoKCoffio1YoIHYiKCBZ1pJPGtjhQQUc6s6BUqYo0AR0IScmgLYpWwULVVm0G1irFVIX0RkP7OTir3NvmnnvPvckPm7P2Xq9/v85eQUWoFwDrgLuBEeAKYHmq/wGOAt8CnwOfRcS/VWN3Shzq0+rv6oS6Wb1BHVIHsg2pN6ZuUj2uPqXGYpNfqk6p+9Rru/Bbpe5X96hDvSZfoR5Ut6t9Pfj3qa+o36kreiHwvvpG144L47yp7u7WqZbsly0BgQvV39RrWunLlvYWYCIi6oslEBGzwB7gtlb6WolfrQ25XvAL0PIwlhFYmjvcwBlKJlRG4E4AFYCI2NtLVvXWTjZlBM4hAvREoMm/FEu5zz2hEgF1df7Z5tU/1Wdb2GxWZ9Jmv3pPldidtmAEOA1sAl4APgWuBKbUqYg4mMlXAS8CNwE/Uzxab1E8Tv357YrAT8Ba4C5gO3AyIsZSd1jdBWxSf82xy4BdEfFj9sfU+4AjwJYc+7jDZBvIF65mgZW57CPqxep69Wi24+of6nT216fNdbkdl2eMl9SLKhNIEuvUesoPqcfUv/JJfizlV9XX1b9zbCLHj6kb0ndOXdtV8ibH1SW6DZns5WyT6oMltmvUubI87W7BKYo9bIWrgK+b+l8BV5fYHs5YXRPYCuwoqQUEguIQ11I+s8Co8H0nY7VEacmUzlMUV+8AMAzsiIh59WbgQ2AuySwDHo6IL9R+4HGK6zgC3AvcHhELCHaEOpyn+IR6QH2+SfeAulF9RL2/afy5tD2RvsPtcnQsGi1epBngbeB6YJJiJU6eZzdIMfM7KFbsGeCSiFh0Yar6jTqe8t78zqinss2cpxtPHzvFr/oYTQLTKdcpDtUg8Fq2wRw7W0FNp09HdHoLzmI2GxQHbjTl0SabUWBfyudsTztUWYE6jXLqB2AlsDP7W2lcsZ2p+z77QzRWpHeoo+ppdZu6PP9sn6iH1Hq2Qzm2Jm22pc+WzhmqkXhS/VIdqGDbn7ZPLEnyDNqXMxxrRyKT707bSge88h3NP9xH6fMoMEBReEDxt/wP+CD7GyNivmrsysgZvmdRds3mfR9PeV59N4lWxv/mKui9xRquBAAAAABJRU5ErkJggg==";ResourceBag.Icons8Skull32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAADwklEQVRYhbWXW4iVVRiGn7Wd0pnKyUwboZIBuxhpIispJq2oLIusm4hyOlARMWVmYSe8aATrRrQjRNGJIjRM7ECJ2IHSyFJzqGRKKRLTLGOyslExe7r4vy2bf/Zs94y7BT9r/d/6Du86vd9aiSqK2gJcCkwETgdGxCfwO9ADbAI+Az4F1qSUrMZ3qhC0ALQDM4ATgTeBz4ENwE5gV9gXwbQCZwMXA/XAy8DTKaVd1QDJBz9DXauuUaeqQwZof6b6grpDvSsGU7XxdPVX9Ua13xmq0td49RN1hTq6GoOb1B/V1sMJnPM5RJ2nblLHVlKcHFPWUoXTEepc9Sv1b3W32qUuUE/tx2aG+n3ZmVCHBsIrqgjepm5Xn4m1blCPUicGqG3qEvWkMrYL1FVqXb7jfnXZoYKH7mx1SoX+evXhANmW66tTF6vjS4UFdUst1z38XhYgmsv03aeOASgAbcAvKaWvawkgpbQceAqYW6a7GbgeIKlHAnUppd5aAgBQm4CulFKTOhRYAqwERgbIzgLwAVB259agjAH+ivYrZAz5LTANWF9EOWRATDWAoj4a37Xq+tig09QvD5Kcur/PsagdgO/UCeoG9YKQTQq+GVdU2q02/E8A/o16r3p0ifx2tVs9lmCnkwfh/EH11WDQPjOojlT3Rnuzel4s9+yQPaG+h/qheskgABynzor13G/fsk+dF7rt6lZ1kbo6ZFeq61AfUOcPAsC+CN4RZHZ+AOpQTyijP1m9Wz3eLN13q/egnhKMNaB9oHaqS83S7Tb1G/V1dY/6s3pdBdu3g/5TIaW0GVgOzKky8DD1VuBcoBu4CPgD6AJGAS8CzwOvqTP7cXMWcCHZLerghtmktlcBYKn6jrowRtqsjjZLtzerR5hlvWfVn9QbyvgYHrwwvVQ4Ls7t4+qoCgD2mdFq8SS8lesfWzznamsMTLUzp7ddnZB33qg+qfaW7OatMaKm0LFE/5jQLZTI7ojdPkudWmEgc9RF/fXnR/SY2c1H9bdcf4/aWPJ/mxnxrA793vh6cu0D6o5DAqgC4A+W3H7Ulgj8T9Qr48QYdWl7cy0AfGzuhqQuU+dHoHX2XxbWIgt+BEzKyTqAq4EDwGlkDxqiLrbfB/48rHs/ZI8Q4F1gXEppd4m8mew1tRPYAqwChgN7gAbgEWB6H4eDBPGc+oV6iyWJzYwTZppRdn3OZoX6UK0AJPUa9Q2z9L5WvdfKfNKsbqsJgJzjYerl6ktx3BarU8zlGvUqdWPNAeSCNKp3mj1GijxSLBvVc/4DE9x4iWDIi3sAAAAASUVORK5CYII=";ResourceBag.Icons8SpottedPatterns32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAADeklEQVRYheWXu09VQRDGvxELasDEICpCJLwEFRTBGBUfJALGR8BEC7GQSCjFDuyAElpo9T/RaGKi+IQLsVFKCI9GoiCfxfk27l32XIOUnOTmnt3f7Ozs7sycWWC3PxZ2kDwHoALAezN7G7AWAFUAPpnZm4A1AagFMGNmrwLWCKAewJyZvUi1huRzkusk50lukBz22GTAxjw2rr55yUx4bCRgz9MmvyCBk2pfJ/mbZBnJU3pvEbtMcpNkNclaJs8lt0tijSTLNa5TrEHGnI8Z0Evym9feq8FtJO+RXAjkf5C8qd+PgC1qTJt05HnsO8nemAFulZ2avI/kT5IHSNaIdYv1aCVlWuUGyfti3ZKtJlkiHX1iblcb045hRNu3SfIXyX6PDWnwpiYc8NiA+jYlM+ixfulyeofDeUMjDpG8QnJ/hJWIFUdYsVhJhO0XOxSyPREb9gEoAlAQYUXiMVYoVhhhBRpbFGFZlk5qmxb072/luLzdsRGPjXqMJMc9NhTonEyb/JzOsVntLrUPkzypwRfF2tWuJFml93axVrVPkDwiHV1iLWqfjRkQhmGeHOoq08PwBtPD8C7Tw/BhzIBmCbuE8oBJYjpIsk6r6hC7I9mjJCv03i3WKdljcuh1kj1ilyXblHYM7pzXtFWPPeZCdC0SakMeC/3DheiadI+F84ZGVDJJGKURViFWHmHlYkcjrFSsMmSxMHR9W76UXt92WS6df5/IEfjZbjTY5iGPPQ3YqMcGdGTuCMbDeZ1g6IQ9nhPWB07o8n3MCTskWxdxwkuSPRMzIC0Mc30NdxyGvg9MAzhAJSIAtwEQQAbADIBCkq1ulQDy1Z8BkE8vESFJvdMAZqXjllgLgGKx6DFM6pwW+e9U7FdLLkRdKvarpUGxRbEJf85YTXgCQCWAKTPLBKwOSd33wcy+BKwGSd332cw+BqwKwHEAGTOb8lksDJcALAJYjbBlAAsAViJsRWw5wlalcynCsix1obbdguQJswsSP0T7FQlO70g4rxPMVZLVinWJ3ef2SrJH/FdJ9p9huOOi1PeBOQDFVFkOoN3rnwNQQK8sRxKGs2L5/JvAziIJwwyAr9JxTawBSRhmObdvuX8x+c2tFxN3wch1Mdlg9sVkWLrcxeSZP2euq9mUmb0LWK6r2WkAxwBMm9nrgDUgCcNZM3sZXf2uff4AjUU2qpuUsDQAAAAASUVORK5CYII=";ResourceBag.Icons8SquigglyLine32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAABf0lEQVRYheWWvUtbURiHn9fiR1BUEhNKJ6EiOLkoiFNBRDp1c+3Sof9Sly4iSCmdHUScRAQR3UR06tAKgthCbZQ8DrmpzRK9cG8umN94Dud9fpz34xzoRan9RcJfq7/UYYC+AjyMAyNAqSgDU0AduOo6Wa2ox+paay1yAg0A74FZoFVwY8AS8AN4ExGXuRhQXwKbwCSwB1wnW3VgH/gUEX+z5v5v4Jt6oFZzg3SAl9WGuvLUM1l3QY1mWk+KMtCqKXvWwDRwB1xmHPdxqVX1SN1Icy71HFAHgQ/AHDCcLJeAReA7sBwRF7kYUGvAFvAK2AVukq3fNIfM54iop4mZSuoX9VCt5AbpAB9R79R3WcZN0wVl4AVwWpSB1D3+7AzMAA3gZ5YGniS1llT/16xjt80BdQj4CMzz8JMZBRaAc+BtRGR6A/8MqBPADlAFtmn/yRwCaxFxmyW8Tep6MsvLuUE6wPvVurrabXarC8Zo5vysKAM3wB8e8t59Jc9s7+keGhKrPvFEjAcAAAAASUVORK5CYII=";ResourceBag.Icons8Stomach32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMySURBVFhHvZdLSJZBFIZNTcOilAoFRZM2hVkYQRQWGWYtWgVthVCikrAgLLpBBEUhQmCCgZVlKa0qgiiQogsUtCikAnFjhSZWdBOMSnve+Q9eQG3++dUXHmbOOXPOfNeZ74sL0cDAQM3gCGF/gbkWnnoxWSM8YO5i2tLIYQxmW3jqxaTn4Y76mlizYy91wekQk52Gx+ozd6odQL4LToeY7Ai8VJ+5U3QAqNAFEf1s4kW0ukV5tEkWmhxRdA+8M1P2Z9gBu6BDRzNSFj9Hd4GlxCaKbYmUHpxn9m34YRyHZcQSLZZJfyftW/hIv1j+mESRDNCZrZdNewB+QoEbMIaIJYMe3j5Ybe5wUaQdqjiOGbSv4aSFxpXGwmXGfqBNMXeYKHIW2ii0BHQ1FltoQjFuNuhWHDJXmCiSA/0UekjbbW4vMX4/dJkZLorstbN3a4KvSFlkeXnmChdFroBbFaMROR1QYWa4KFIHzWZ6i5xWqDEzXBS5CtfM9BY5t6DOzHBRpBkumekty5uUA7gH1WZ6i5xHcMLMcFFED9NuM71FznsoNTNMvElpFPkL68zlJfJmkSO5pTxYFNDX0FeYaS4vkVcEOvCF5opeTJpIgTaoN5e3yKmGZ2YOC2cm1FL8Be1TaKGvrTTLhjjpjPE1wDf6Geb2EuO1eWkjO2auiHAsh254Atpeta9rleslScumHprnoAVE4z7hjnpvJ28b/IIcczmndih9MFynaIK5nbDj8a+CMjgMp6Acf5oN8RY52o51dS+YKyIcOuNugu4LZ6rEHJWgD5Jccw09TJ1w1FwamAsrINlcMYtaK0GXvsxcEXEA23H20abKpl9J34l+L5S7gTGIGgXQA43mGhbOu9Bk/XTQJdLXrT44DsJv0K9YvEuIUuRuBv26NVHDfaiOEoEuaIEsqICekZNhl8B3uAnzzf1fMVYncxG04JwZ9wQIbGBAJ60T/QYLDQlfPmjR0WXcB+kWGiX8eps2gV7fflDOGguPL+ZNYOBa2Ahj/uUyJomYboke2D/wBlrx36C9D69At0toh9xKLOi2TSiK6l0uZIIqqIV60NKqV7mE2Bwb6qG4uH8Ajdymw1my/wAAAABJRU5ErkJggg==";ResourceBag.Icons8Stop32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABxSURBVFhH7Y6xCYAwFAWzpI1DuIuNoJWNjRtYOIa9EwQnSHzC74P4iwh3cIQU/3EBoEpSSqeMzk42XybnfOmg19t4qK1NLjZfRkdPQGvfz2hrIIAAAggggAACCPhlwC5HJw/5KmCWq6cK6GweoCZCuAGQ40OUYGjcAAAAAABJRU5ErkJggg==";ResourceBag.Icons8Sun32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIzSURBVFhH7ZZNaxNRFIYjVYsiBAo2FRrEVVASuyitXbiwBgQRsQsRBDUlEFFoF4V2mWVtcVHatelC6EJ/gYI73btQEKT4B1RUFN2YD59zeSMz+egknUnoIi883Hvee+49J9OZzsQGCqNqtToLZxT2XxR/DasK+y+Kv4E1hf1XTxvg4GW4o7Clghqo1WpDrD+GK7I6F5tyUIGCrCYp54JCn1T8KXyHtOzuxMYC7NlEK3mLM5+UvT95mjgnywocgUt4DxjnGSe05ES8AOGL18VhGQ4bgkPMl+Ar/Ib38BGswXeQVf4InHabo5KK78A3KBAf15KtjeFtwF9bkx2tOHiFQj8Y295QrN1VE1OyohGFT1hxuC+rrSj+HF4qjEYceB3+wDFZbUXOZSjTbFxWZ2LTDXjVwD2t2Y33wSUGiLxRitcY3ZPBWALvmS/gpEv2CjMNj9i7Xod4WmsPYdclBoi8pBpIKc43nFmEwCvpExsvssketYSstiLnNvyCYVnhRQP2n+0TbMhqKeW9hZKs6MShdo/YVcjJ8onih1nbhs8wLjtacfAilOEZZCEBSbDLbr/8i/25lB6NdFnz4G4cxhmwu9keNSfmP+EJuF/OmIKrNg8lzva+Uk/JdmItjpeBs8yPynbCuwZdv0V98hZn3vVbzYqHaoKNm0HFWd+CWwqbZMWhwhlzsjoXG2/CeYUtxXrgN6EVJ8f3vRCZOmmgpzoIDdjjWFTYf1Hc3nz/v4wG6l6x2D9Bm6hKE5SWYAAAAABJRU5ErkJggg==";ResourceBag.Icons8SwissArmyKnife32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAADjElEQVRYhb3XW4iVVRQH8HXGMcOIqMC0lJEewgLNoNIQs56UoJqgEiorkwwfIgqxzAiS6GIUVJBSSKYQeaECIyqwCLpo9zCLIsmiNKMbUal5+fWw18GPzzMz54zWevrWf6+99n/vvS77C3yKVTgDXTGAYDLW4Efsxhbcj5MGmtuXw734TZFdmNmP7ULsx3rMRi9ux5fYicmDIfAPZmECfsc9OKqF3dVJ9soWY91Yjl8wslMCOzA3v7flSbzRYoEfsLgfP934EC9jSCcEXsMT+d3ASnyGSRWbqXn0IyrYRCzACRXs2tzAkk4ILMr7Ozr1W/JUYGzF8Y7avC/S5pEKdpaDMqtdAiMyCO+tYNPTyd0YjbnYVpu3NLPg8gp2es5bmgE9KdoRXIV9mJb6GKzOBe5oRSDtGjW9SWAsnsN2jGqXxDP4rnanf+MDJe8PIdDCR5NAD4bjI7yFoe0QOBZfY10Fu17JcZ0SSL0n4+uxAQnkhHOVunBjBVs1WAKJTVPqxzXtkliIvzAu9ePxYocEptXw+enzzHYIdGEDNjuYmi2DsB8C23FKBW9grVLoTqzOOaT5NBqNAxFxXUSMioj7BmTcWvZGxDoMS58iYk5E7ImIlapNT6lo7+OS2m4uU6rfjEGcwFSlWz5dGx+fV3FDFXwzJ92Ziy3FhTm2LB3dNYg0nII9uK1ms0Spol1N4E+lCz6Fx9PBflyq5PLnadMRgdTnKAVuesXm5CTW2wR2YYXSSqfigFJ8Nub4RKUidkwgsUfxKyZUsOV4u6l8ggexEd/kHb2D3ZUJiw+DQDdewE+4ILFxecpTuiJiRUTcFBGzI2JtRKyPiGURMQzHpJ/vB1q8L2k0GvsiYmZEvBQRG7AyIsZHxOaIWBAYquT887K5YGTu5JzUO82Cnj7GL8a7uXv4uDlwdgZatbe/jlcw5EgRqNgNx3F18CKlDyxRKtdpGTyvKq/eI0agPwe9GYSrk+W4zAj/C4F0Mkl5km1RKlcXHqgTyPRcc7gEWvWCTRExISK2RsSmiLg1Ir6tLXRelKy5IuNjTLsLti0ZB/PySv7AzsrYIgcfrltxfuLNR+ng/pL6INKTheQARlfwGVCznaWU9QF/8Tol0aX0hIcq2HCcWtGH4D21DngkSfQqjWV2i7FuPKk87wefAW2QmJckNuDmJDU/M+bnZiz8p5Kp9qzyTtiDr/CwTn9KU/4FEBmLVicvN4YAAAAASUVORK5CYII=";ResourceBag.Icons8Synchronize32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJMSURBVFhH7ZZNSFRhFIbHiqKUQijCbXsX/SxCLKiEFq0SxcBlSRMl4krIIHfhTlBJWkeMBkGULWwpKIpY0bbapUSb/EX7mel5Ly+D6dyZe4fpRuALD3fO+c75zrm/c1K7+q+Uy+UOZbPZZhiC5zANs/AS+uEyHHD4H8J/nPwqm/FEch2MwDqswSsYhHvQC2poEr7DF7hPsRqnB7L/os3oIukOrMB7Nm3VVfDSDrFWS1w3fDYXvKS1b9hXbJYWCftJeAQbkMbe46WSIraGnGH4Cbfsi9cAwSr+FRrsii1yO0BN3IjVAIG67Jtw1q6yxR6d3usHlG6AID1wq5C2K5Y400Zye7axiD/HMVIDetr1wEW+51tFbje5cyE0OqywSK6GdQJb7UpWFL/qBkJftb8qiuuDMm4zeVH8mZqwmbwoPgO9Nisu9tbr3WJzp1hs5v6fsFlxsf8k+/fZTF408AFu2kxWnPkRiutreMmuZEXhNliCgvNCXgQcpNva7eA/7JCyRP44ZGyGi6AHFAxTWV9I9jwH0im7wkVQ0ADHCQ6nt4Kv+OUrIPI0xr2Dx3YVlxqABdD/eIfdZYniVezxFD7CMbuLi0A1oCEzDXpqu7wUS+RV08AYaBCpt7u0CA4a8O/roJFsFOqCgAgi9jy8hU8QvbhEQr4Bid9n4A1oGn4IDZzVXi/nhU/v+TV4Ab/gCb6jXo4uEm/DgM1AbLQPXztMgaRm5uE1aBzXPdZIvgwZOOnUyovNNbK1wF3op7k+jpqamzjGfkt29Y+VSv0GBUbcYubks/4AAAAASUVORK5CYII=";ResourceBag.Icons8TextBox32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGVSURBVFhH7ZOxSsNgFIUrKLagVF9AZ8XJjhaEIrgLIriIgw9QF10dRDefwMHJ0UUHcSjooK4K4iaCDyAodbLxu8nJH6wh0NhoxRz4uM09//3voU0LuXKFarVaE57n7WYNe7agpLWRMDcxXuAsQxrs8agzWhtJAW70mInYUbYAqKpWJJq9GYB+kf4RxH2lSWzrCifuShVgzCbw9imxL1Y7nD2FR13hhPetAEuUSgjPU+ZTB2G6zduBrgUYod/0x77KltX1+ZPoX+sKJ9rpXkL6JfzREJ7HqaYq2Nwl1fliQONO9NIFaBdn3UVgcxeyEsXZ+ABccCDD9AxFWbHC7zgAZ2rwHoz5P9GKLN88hkNYk1+WFSvzg2MdBViGV87PUW9tTpYL0IA9uxVlFeANNuDB5mT5Zh2eoAknmP2yYoWfJsAkXNkQ9Q5mZQXSRb/zEppo5gH+TgDODdst1Huwl/dcVqIY6U4AE2dXwf5SRk3tRLGjewHSiB09HIDl6zJ/QhWtjURziBAL1MUsYcc8tU9rc/17FQofT1P5tVWp8pIAAAAASUVORK5CYII=";ResourceBag.Icons8TextBoxFilled32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFZSURBVFhH7ZKxSsRAFEUjKLqgrP6Adha2lgqKjb1gYyN+gjZua7HsfsV+gpVWFoIWamthL/gBgrCdiWdm7kxAhmDCRrOYA5dh3n1v3iUkaWnxpGm6jgZZlg3rFDsuUEdrczB7GB/opkbdsifj3NLaHAV41rUW2NE1AWBbpRyKzQxAbR5dotgnLVJfTwTYUT4A9VU7UhLeetUTAcrTGWCZ+tiOlYCZJz0RoFztJ6TewV/x4r7GGeD+wBF8aU7jAWrVAnyHXv+Qhbl7WYXQGg/AAyMZhne0ICsKfukAtO3S9+km7MyxLBvgSnVPV1YU47s2x08C0HOkdk9PVjMCnKI3NEbXmLOyouBXCbCBHtX/gnZkOaj/3U9ooNgGmJ4A9C25dxzc72QVQutkAhjoPUHn0p7KhbBjcgGqwI4GB2D5mczfYFNrcyguEuKA87BOsWOfc0ZrW/49SfIFDoodfbPssq0AAAAASUVORK5CYII=";ResourceBag.Icons8UncheckedCheckbox32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEYSURBVFhH7ZaxSgNBFEWXTS2ibWJatTIQCEQlv6Kg1foBCVvkdwIB/0QE/QObhKTcSpvV8+DCoM5WO1vlHTgMe2f2vbchxWROjLqur7DAeSLvcKDyzXDoCJ+/gXXL8tJW6rxihV9YqlUcXlhz6AOvFSWBujk1H/ETC8W/4dAI7ctvFCWH2kvc06anKGCT4UaPnUD9S33kuaIA+YKNdz12Aj2ObQC4VRQg9AF8AB/AB/ABfAAf4MAHoLndXrse4MS602eqKEB+z0bFmitKDvUnNgAMFQXY7KNdnR8UJYfaK2z+ldks0a7Odnu1C6T9ZK2kzilO0JrbB87ULg4HnnDHy0mh5hvL/z9fDA728ALHKaT5mUo7f8iyH4vrPM7bT803AAAAAElFTkSuQmCC";ResourceBag.Icons8Undo32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGBSURBVFhH7Za9SsNgFIbj4F9RB0FQKQ5VoUbdnRwcumkRJ0G8AEcdvAGvwMFBvAknMRcg4lCQrh1EBRUcBH/AJfH54K04FMyXlBMEH3hovtO+3zlN2qbBnyFJkh4d2kPzShzHN7iqkh00ncZbPGeQkso2/GgeFdX8rqjmM0U2ny26+T1e4wIDVH5xnNf1K54fNmuwqTfk3rGJx7iFg9rSD4Lz+IRX7FvFTu/6W163iMu4hvt4Sv2Fx2c84HhAW6eHYHsIt1mfyqkhM0R2Bx+wybqqp9JDMNcQDrJjGKH7QJdVTg+hEHMNQa5E/hIvOPa/l2iIx5xDuM/KJ66r5Ec3hiB7gmda+kN4TkNsquQFuTp+YLavp8OFM11HIDtB1v1ehCrZQu9eDbCikj00d9S0tIXGwzoDSyrZQuPQDQBTKtnCABv4xgDF/LGl+RFGWtpD8xbuaWkLjdvX3/+u2A0Y4BAbWtpC41F8xW2VbKHxLrY4/ZluYrmh+QhOavlPB4LgC+v3IICml9ZoAAAAAElFTkSuQmCC";ResourceBag.Icons8VisualyImpaired32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAACaklEQVRYhe3WzWuVVxDH8TlJVAStRFBcuSqChih0WUSrIAm2hYpdmxqIVLBaKS4kuCqBICIYfEFp/oCWQKG6bFeWlmBL19JNW0oJFV+wTWjE+OnimQu3yb03L1oimIHLc5nnPGe+5zdnzpyIFUvDVvQuJ8C7mMGJ5YQ4lhAnXwaIj14JiI5GzlLKDayOiEtQSrk8C3BLRGyLiPXpehwRP5dSJl4oHU6kEqfQgyv4TXP7FVfxdi7guQHaEuJZ/n7CMA6iCxvRie04gE/xfUL/jjN4bamBB/AL9tQpsaASxeu4gId4gONoW2jw7lzF3/gmn4uGyLk24iKmcQdd833Qh6nM52AqMZoQe+shUvIv8C2uo7vFvF0YxyQGGg1ozw02g49xOv/3N4F41mAD/oNDLSDaMZTfXkNH7cUqfI5HKdVQ+ptBvNUC4j4651H5vVT5JtZEyvgHdqn6QSOIo4uAONwyz9W8bybslx0RMZ3+mVLKTbwfEWOIUsogIiI+yzG1/N2KiHci4mREjEREqZt/w3wAEXEvIv6KiLZaCsZU5dKbhI2UeIoP6pSYxL4GSrwxz+r34k98hbU1ZztGMsjZDLIUiPEWgYvqRH2iqpq5bSBzPakqrW1LhJhzTqguO1/n/ulrmRzsUNXslOpoPdIEom8WxP7ZEFiHc3iMH7C9ZfA6iDZ8mDv1EX7M/C4GYhQTqgrrt9CjeBbIenyiaiw1u5yBhhPiCLbgdkLUl+h3WLfowA1AVqs64BVVg2pmd3Hef7voi79jYjN2J1QPdmJTg3H/H8RCzUt20V2BqO2JnuWE6FHdqlcsIiL+BXKNwmSzAl4UAAAAAElFTkSuQmCC";ResourceBag.Icons8ZoomToActualSize32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKmSURBVFhH1ZY5aFRRFIbHJRoVcUFQCztBg8l0origoii4oDHiLkGIYCpFCxXUTrC1ccEFC7FJLRpMQCuXIliIhSIoQVBJEQhuMZnx+y+/j5khmTfvJRnjDx/3nf/dc+55d+Ytmf9O+Xy+BmY7HHuxWG0ulzsMbfAZcnh5hp/wFq4QrvH00RXFD8JHFuhlvA/NsAGWwzY4DU9hEB5BvVNHJhasodh10FVeIi675czJQjv0wW7b6cRiEyiiq/0Cq23HynkXQLuRvgmSz8E3yNpKJPLOOz/5z0HSIvgBzbYSyzvxEDpsVS6SrkEXRSbaSiVq1MMAddbbiheTJ5H0FVpsBRHPhZew2FaRfMW6RffYCiLuhKsO48XkFRTT/T3flrxT8Np+g+1IeI3Q7vOttoOIT8IHh/Fi8l7ocRhE3bN4twsbYGxVjGZxvJ/xMqNu16IG8DfhDTJOtlVeTD4BbxxGwmvQahodr9SiUBsmII71oCrdgazzFtoqLyYehW6HkfCKGhhKwzSwynkzbZUXE7dAPzlTbAXhle7AOrgB08IExOmhGjgAfQ7jRZE5JPTDZltBxEvgvUbHhxxHV8bxK/kOg4jvwAOHlYmEThq56zC1qDMDeqBoV2JFwlb4DXW2Uon8i6B3SfQzVSySHsNzdmK6rUQiV69qvQuO2UomFl5Acje0cRzdapWInDrlkvfEVjpRZJmbeEGxpbaHFXP0ON7H2Au6Y35Bk0+nE3W0Ex2g/8RN2IhX9FTD03viCDwDLXpP46g1IVFEn1767BoAvarfQRd8svcdbkH44zI2QWETI/tC+ivqzaPYdjgOZ6AF1sJUT4mENzZNJJEWLWmi0aeqJy1a2ATDLp+qnsZFE1q0sAnY6VPVkxb14mKH7erKTfybxcepMpk/Tmx3IV1/qj0AAAAASUVORK5CYII=";ResourceBag.Icons8ZoomToExtents32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALkSURBVFhH1ZZLSFRhGIani2VFUNEd2kaWDLSIIAuKwqB7GYZRSGlRq9IWEVSLJAhatakgiRbRxnV3hcJFBeEiKLpsCikqXEjSzXSm5z28Z5iZprmpk73w8P/f+//f939n5pw5E/nvFI/Hy2Caw5EXh5XHYrE90AYfIYYXZ/gBr+EC4UpvH15RfDe844BexhtQD2tgGWyEY/AQBuEOVDp1aOLAMopdBl3lWeKsHzl7onAX+mCH7eLEYWMooqv9BFW2c8p5p0CfRvFNkHwCvkLUVkEi76TzC/86SFoA36HelrwtXN1BwbxOV2p/Vuh7bbF8rTO/De2KCxJJl6CLImNtyesk1l3/BVK+EuIWrUnMD9uWXwkD2Ktt5Rabx5H0GRptBSIOG/gAC20HIm7QmsQ80YBE3AEXHeYWm5e70BxbgYhvQTW0w3sImmBsAKkZWiC9gaPw1mFusbkWehwmhDdfI71NZh42cRqk5mATYp7SOPvX4Q0yjreVXWw+Ai8cZpSbeMYonbOdUeyLahPjPFvZxcZ90O0wo1jfD9IrSHwdmcTaCjcw1VZ2sXE99JMzwVYgvDN4uvLw8CbHiXsClkKtUwIR10Gfw9yi6HQS+qHaViDiTngOUpPt9HuiB9Jvwqtw02F+IqGDwtccBsILH8OXOtR2ILwqrUnMk38HpsAfTeUUCRvgF1TYktdK/aeC+XnG8JdwNtxLWtsZJCDmekr0LplkK3+RdB8eUzTlavMVuXpV611wwFZh4uC5JHdDG/Ny23mJnArlkvfAVnGiyBI38YRii2z/VezRC2gXYy/ofvgJNV4uTtTRJ6G7XPfEFViLl/KrhjcD9sIj0KHXNQ5bExJF9NdLf7sGQK/qN9AFevzkfYNWCG5cxhpIbmJo/5BCUW8mxTbBITgOjbAKJnpLQngj00Qh0qFpTWz3UumkQ5ObYNjmpdJpVDShQ5ObgK1eKp10qA8Xm22XVm7i3xw+ShWJ/Aawgf33TMuxGgAAAABJRU5ErkJggg==";ResourceBag.LineIconsPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TxSItHSwi4pChOlkQFXGUKhbBQmkrtOpgcukXNGlIUlwcBdeCgx+LVQcXZ10dXAVB8APE0clJ0UVK/F9SaBHjwXE/3t173L0DhGaVqWbPBKBqlpFOxMVcflXse0UAgwgjhJjETD2ZWczCc3zdw8fXuxjP8j735wgpBZMBPpF4jumGRbxBPLNp6Zz3iSOsLCnE58TjBl2Q+JHrsstvnEsOCzwzYmTT88QRYrHUxXIXs7KhEk8TRxVVo3wh57LCeYuzWq2z9j35C4MFbSXDdZojSGAJSaQgQkYdFVRhIUarRoqJNO3HPfzDjj9FLplcFTByLKAGFZLjB/+D392axalJNykYB3pfbPtjFOjbBVoN2/4+tu3WCeB/Bq60jr/WBGY/SW90tOgREN4GLq47mrwHXO4AQ0+6ZEiO5KcpFIvA+xl9Ux4YuAX619ze2vs4fQCy1NXyDXBwCIyVKHvd492B7t7+PdPu7weQo3KzsaYxlgAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAAd0SU1FB+YIFg8tHHa8UCAAAAC1SURBVFjD7dZLEoIwEITh7qiH8RTe/yBcg3ajpYiGPKaDVTrLsPj+DAsAfmkknSVpL/wiadJt7uccGPBASQ4N+IQPCcjh9oAt3BpQgtsCSnFLQA0eHlCLhwa04GEBrXhIQA/eHdCLdwVE4M0BUXhTQCReHRCNVwU48OIAF14U4MQB4JiBCWB+Ojo4vpwp82yBk5wdAdxaO4BE0vYrzT3x1St4wU9ufLGB0Td/t4E08ub/+Zq5AnYmfWa6JCTFAAAAAElFTkSuQmCC";ResourceBag.UnlockPopupWindowPng="data:image/png;base64,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";ResourceBag.DicomPluginLanguageJson={en:{wl:"W-L",imageTools:"Image Tools",freeWl:"Free W-L",evueResetWl:"Reset to eVue defaults",dicomResetWl:"Reset to Dicom defaults",invertSelectionTool:"Invert",titleWlPresets:"W-L PRESETS",resetTransformations:"Reset transform",brainTool:"Brain",liverTool:"Liver",lungsTool:"Lungs",humanBoneTool:"Bone",dicomProperties:"Dicom Tags",imageRender:"Image Render",mprSagittal:"MPR: Sagittal",mprCoronal:"MPR: Coronal",stomachTool:"Stomach",ZoomAndRotate:"Transform",zoom:"Free zoom",freeRotation:"Free rotation",panTool:"Free pan",titleZoomPresets:"ZOOM PRESETS",zoomToFit:"Zoom to fit",zoomOneToOne:"Zoom 1:1",titleRotatePresets:"ROTATE PRESETS",rotateLeft:"Rotate left 90º",rotateRight:"Rotate right 90º",flipHorizontalTool:"Flip H",flipVerticalTool:"Flip V",lengthTool:"Measure",lineTool:"Line",polygonTool:"Polygon",polylineTool:"Scribble",ellipseTool:"Ellipse",angleTool:"Angle",magnifierTool:"Magnifier",downLeftTool:"Arrow",textBoxTool:"Text Box",linkTool:"Link",LinkButtonSelect:"Select",LinkButtonLink:"Link",LinkButtonUnselect:"Unselect",LinkButtonUnlink:"Unlink",dicomTab:"Dicom",orthoTab:"Ortho",autoViewportPopulate:"Automatic viewport population",seriesPopulate:"First series to populate",wlConfigTitle:"Window-level",windowTitle:"Window",windowOptions:"increase to the left, increase to the right",levelTitle:"Level",caseStudyTool:"Case",levelOptions:"increase upwards, increase downwards",cineTool:"Cine",cineToolButtonBackward:"Backward",cineToolButtonForward:"Forward",cineToolButtonPlay:"Play",cineToolButtonPause:"Pause",rectangleTool:"Rectangle",keyImage:"Key Image",addKey:"Add key",removeKey:"Remove key",deleteAnnotTool:"Delete",deleteAllAnnotTool:"Delete All",triangulationTool:"3D cursor","1x1Layout":"1x1 layout",markerTool:"Marker",closeText:"Close",zoomcenter:"Zoom/Center",StitchTool:"Stitch",StitchBarPhaseOneText:"Select 2 or more viewports to participate in the Stitch process",StitchButtonNextText:"Next",StitchButtonCancelText:"Cancel",StitchBarPhaseTwoText:"Drag the images to the proper places. You can zoom in/out the Stitch view",StitchButtonDoneText:"Done",StitchButtonBringToFront:"Bring to front",windowLevelTitle:"WINDOW-LEVEL",otherTitle:"OTHERS",hideFixedAnnotTool:"Hide Annotations",quickPrint:"Quick Print",print:"Print",printLabelDirect:"Direct",printLabelAsPDF:"As PDF",printImage:"Print Image",printImages:"Print Images",deleteImage:"Delete Image",printViewportTool:"Print Viewport",report:"Report",reportLabelRadiology:"Radiology",reportLabelImages:"Images",reportCurrentImage:"Current Image",reportCurrentSeries:"Current Series",reportStudy:"Current Study"},es:{wl:"W-L",imageTools:"Image Tools",freeWl:"W-L libre",evueResetWl:"Restablecer Evue W-L",dicomResetWl:"Restablecer Dicom W-L",invertSelectionTool:"Invertir",titleWlPresets:"Preajustes de W-L",resetTransformations:"Reestablecer Transform",brainTool:"Cerebro",liverTool:"Hígado",lungsTool:"Pulmones",humanBoneTool:"Huesos",dicomProperties:"Etiquetas Dicom",imageRender:"Image Render",mprSagittal:"MPR: Sagital",mprCoronal:"MPR: Coronal",stomachTool:"Estómago",ZoomAndRotate:"Transf.",zoom:"Zoom libre",freeRotation:"Rotación libre",panTool:"Desplazamiento libre",titleZoomPresets:"PREAJUSTES DE ENFOQUE",zoomToFit:"Zoom para encajar",zoomOneToOne:"Zoom 1:1",titleRotatePresets:"PREAJUSTES DE ROTACION",rotateLeft:"Rotar izquierda 90º",rotateRight:"Rotar derecha 90º",flipHorizontalTool:"Voltear horizontal",flipVerticalTool:"Voltear vertical",lengthTool:"Medida",lineTool:"Línea",polygonTool:"Polígono",polylineTool:"Garabato",ellipseTool:"Elipse",angleTool:"Angulo",magnifierTool:"Magnificar",downLeftTool:"Flecha",textBoxTool:"Caja de texto",linkTool:"Enlazar",LinkButtonSelect:"Seleccionar",LinkButtonLink:"Enlazar",LinkButtonUnselect:"Soltar",LinkButtonUnlink:"Desenlazar",dicomTab:"Dicom",orthoTab:"Orto.",autoViewportPopulate:"Llenado automático de ventanas",seriesPopulate:"Llenar desde la primera serie",wlConfigTitle:"Window-level",windowTitle:"Window",windowOptions:"incrementar a la izquierda, incrementar a la derecha",levelTitle:"Level",caseStudyTool:"Casos",levelOptions:"incrementar hacia arriba, incrementar hacia abajo",cineTool:"Cine",cineToolButtonBackward:"Backward",cineToolButtonForward:"Forward",cineToolButtonPlay:"Play",cineToolButtonPause:"Pause",rectangleTool:"Rectángulo",keyImage:"Img. Clave",addKey:"Agregar llave",removeKey:"Remover llave",deleteAnnotTool:"Borrar",deleteAllAnnotTool:"Borra todo",triangulationTool:"Cursor 3D","1x1Layout":"Diseño 1x1",markerTool:"Marcador",closeText:"Cerrar",zoomcenter:"Zoom/Centrar",StitchTool:"Puntada",StitchBarPhaseOneText:"Seleccione 2 o mas viewports para participar en el proceso de puntada",StitchButtonNextText:"Siguiente",StitchButtonCancelText:"Cancelar",StitchBarPhaseTwoText:"Arrastre las imagenes a los lugares adecuados. Puedes hacer un zoom in/out en la vista de puntada",StitchButtonDoneText:"Finalizar",StitchButtonBringToFront:"Traer al frente",windowLevelTitle:"WINDOW-LEVEL",otherTitle:"OTROS",hideFixedAnnotTool:"Ocultar anots",quickPrint:"Impresión Rápida",print:"Impresión",printLabelDirect:"Direct",printLabelAsPDF:"As PDF",printImage:"Imprimir Imagen",printImages:"Print Images",deleteImage:"Eliminar Imagen",printViewportTool:"Imprimir Viewport",report:"Reporte",reportLabelRadiology:"Radiología",reportLabelImages:"Imágenes",reportCurrentImage:"Imagen actual",reportCurrentSeries:"Serie actual",reportStudy:"Estudio actual"}};e.ResourceBag=ResourceBag})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var DicomPlugin;(function(DicomPlugin){var WebClient=Efferent.Frontend.WebClient;class Sharpening{constructor(e,t){this.image=e;this.image["bufferSharper"]=this.image["buffer"].slice();this.transferSyntax=t;this.imageWidth=parseInt(e["dicomTags"]["0028_0011"]);this.imageHeight=parseInt(e["dicomTags"]["0028_0010"]);this.bytesPerElement=this.image["buffer"]["BYTES_PER_ELEMENT"];this.bitsStored=parseInt(e["dicomTags"]["0028_0101"])}Sharpen(mix){if(WebClient.Utils.IsDebugActive())console.time("CLAHE");if(this.transferSyntax==="1.2.840.10008.1.2.4.50")this.clahe();if(WebClient.Utils.IsDebugActive())console.timeEnd("CLAHE");if(WebClient.Utils.IsDebugActive())console.time("SHARPER1");var w=this.imageWidth;var h=this.imageHeight;var x;var sx;var sy;var r;var g;var b;var a;var dstOff;var srcOff;var wt;var cx;var cy;var scy;var scx;var weights=[0,-1,0,-1,5,-1,0,-1,0];var katet=Math.round(Math.sqrt(weights.length));var half=katet*.5|0;var dstBuff=eval("new "+this.image["bufferSharper"].constructor.name+"("+this.image["bufferSharper"].length+")");var srcBuff=this.image["bufferSharper"];var y=h;var factor=4;var dcy;var dcx;var cKatet;var sw;if(this.transferSyntax==="1.2.840.10008.1.2.4.50"){while(y--){x=w;while(x--){sy=y;sx=x;dstOff=(y*w+x)*factor;r=0;g=0;b=0;a=0;dcy=sy-half;dcx=sx-half;scx=dcx;for(cy=0;cy<katet;cy++){scy=dcy+cy;cKatet=cy*katet;sw=scy*w;for(cx=0;cx<katet;cx++,scx++){if(scx>=0&&scx<w&&scy>=0&&scy<h){srcOff=(sw+scx)*factor;wt=weights[cKatet+cx];r+=srcBuff[srcOff]*wt;g+=srcBuff[srcOff+1]*wt;b+=srcBuff[srcOff+2]*wt;a+=srcBuff[srcOff+3]*wt}}}dstBuff[dstOff]=r*mix+srcBuff[dstOff]*(1-mix);dstBuff[dstOff+1]=g*mix+srcBuff[dstOff+1]*(1-mix);dstBuff[dstOff+2]=b*mix+srcBuff[dstOff+2]*(1-mix);dstBuff[dstOff+3]=srcBuff[dstOff+3]}}this.image["bufferSharper"]=dstBuff}else if(this.transferSyntax==="1.2.840.10008.1.2.1"){while(y--){x=w;while(x--){sy=y;sx=x;dstOff=y*w+x;r=0;g=0;b=0;a=0;dcy=sy-half;dcx=sx-half;scx=dcx;for(cy=0;cy<katet;cy++){scy=dcy+cy;cKatet=cy*katet;sw=scy*w;for(cx=0;cx<katet;cx++,scx++){if(scx>=0&&scx<w&&scy>=0&&scy<h){srcOff=sw+scx;wt=weights[cKatet+cx];r+=srcBuff[srcOff]*wt}}}dstBuff[dstOff]=r*mix+srcBuff[dstOff]*(1-mix)}}this.image["bufferSharper"]=dstBuff}if(WebClient.Utils.IsDebugActive())console.timeEnd("SHARPER1")}buildcdf(e,t,n,o){var s=0;for(var l=0;l<t;++l){e[l]=e[l]/n;if(e[l]>o){s=s+e[l]-o;e[l]=o}}var u=s/t;var c=[];c[0]=e[0]+u;for(var l=1;l<t;++l)c[l]=c[l-1]+e[l]+u;return c}histogram(e,t,n,o,s,l,u,c){var d=[];var m=this.bitsStored-8;var S=2**m;var C;var p;for(var A=0;A<l;++A)d[A]=0;for(var f=n;f<s;++f){for(var I=t;I<o;++I){if(I>=c&&f<u){C=f*c+(c-1)}else if(f>=u&&I<c){C=(u-1)*c+I}else if(f>=u&&I>=c){C=u*c-1}else{C=f*c+I}p=Math.floor(e[C]/S);d[p]++}}return d}clahe(){var e=2**this.bitsStored-1;var t=this.image["bufferSharper"];var n=[];var o=0;var s;var l;if(this.transferSyntax==="1.2.840.10008.1.2.1"){for(var u=0;u<t.length;u++){n[o]=t[u];o++}}else{for(var u=0;u<t.length;u+=4){n[o]=(t[u]+t[u+1]+t[u+2])/3;o++}}s=this.bitsStored===8?[32,32]:[256,256];l=this.bitsStored===8?.02:.01;var c=256;var d=this.imageHeight;var m=this.imageWidth;var S=Math.ceil(m/s[0]);var C=Math.ceil(d/s[1]);var p=new Array(C);for(var u=0;u<C;u++)p[u]=new Array(S);var A=[1/s[0],1/s[1]];for(var u=0;u<C;u++){var f=u*s[1];var I=f+s[1];for(var o=0;o<S;o++){var D=o*s[0];var P=D+s[0];var v=this.histogram(n,D,f,P,I,c,d,m);p[u][o]=this.buildcdf(v,c,s[0]*s[1],l)}}var T=[];var V=0;var R=this.bitsStored-8;for(var E=0;E<d;++E){var M=E*A[1]-.5;var G=Math.max(Math.floor(M),0);var L=Math.min(G+1,C-1);var F=M-G;for(var B=0;B<m;++B,V++){var O=Math.floor(n[E*m+B]/2**R);var N=B*A[0]-.5;var U=Math.max(Math.floor(N),0);var k=Math.min(U+1,S-1);var W=N-U;var q=p[G][U][O]*e;var X=p[L][U][O]*e;var Y=p[G][k][O]*e;var H=p[L][k][O]*e;var z=(1-W)*(1-F)*q+(1-W)*F*X+W*(1-F)*Y+W*F*H;T[V]=Math.floor(z)}}var K=d*m;if(this.transferSyntax==="1.2.840.10008.1.2.1"){for(var Q=0;Q<K;Q++){var Z=T[Q];t[Q]=Z}}else{for(var Q=0,J=3;Q<K;Q++,J+=4){var Z=T[Q];t[J-3]=0;t[J-2]=0;t[J-1]=0;t[J]=255-Z}}}}DicomPlugin.Sharpening=Sharpening})(DicomPlugin=Products.DicomPlugin||(Products.DicomPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.FhirClient;let o;(function(e){e[e["Add"]=0]="Add";e[e["Remove"]=1]="Remove"})(o=e.EOptionKeyStitchImageAction||(e.EOptionKeyStitchImageAction={}));class StitchManager{static SetStitchKeyImage(t){StitchManager.Plugin=t;StitchManager.PseudoSerieStudy=new e.PseudoSerieStudy(t,StitchManager.PseudoSeriesGuid)}static SaveStitch(e,o,s){var l=this.Plugin.Controller.ImagingStudyFhirEntities[e.Context.StudyGuid];var u=new Date;var c={resourceType:"Basic",id:o.KeyImageID,subject:{reference:"ImagingStudy/"+l.id},code:{coding:[{system:"http://efferenthealth.com/schemas/keyImageValue",code:"stitch"}]},author:{reference:sessionStorage["practitionerId"]},created:t.Utils.FormatDateTime(u.getFullYear()+"-"+(u.getMonth()+1)+"-"+u.getDate()),extension:[{url:"stitch",valueString:t.Utils.EncodeBase64(JSON.stringify(o))}]};var d=t.PlatformContext.PlatformUri+"/fhir/Basic";var m=new n.FhirCall(d,"POST");m.BodyData=JSON.stringify(c);var S={};S["Content-Type"]="application/json; charset=utf-8";m.Headers=S;m.FuncOk=(e,t,n)=>{s(t,n)};m.FuncError=e=>{s(e,null)};m.Send()}static GetStitch(e,o){var s=new Array;var callKeyImages=e=>{var l=new n.FhirCall(e,"GET");l.FuncOk=(e,n)=>{if(e!==""){var l=JSON.parse(e);var u=l["entry"];if(u!==undefined){for(var c=0;c<u.length;c++){var d=u[c];if(d["resource"]["extension"]!==undefined&&d["resource"]["extension"][0]["url"].toString().match("stitch")){var m=t.Utils.DecodeBase64(d["resource"]["extension"][0]["valueString"]);var S=JSON.parse(m);S.Id=d["resource"]["id"];s.push(S)}}}var C=false;var p;var A=l["link"];for(var f=0;f<A.length;f++){var I=A[f];if(I["relation"]==="next"&&I["url"]!==""&&I["url"]!==undefined){C=true;p=I["url"];break}}if(!C)o(s);else{var D=t.PlatformContext.PlatformUri+"/"+p;callKeyImages(D)}}else o(s)};l.FuncError=e=>{o(s);var n=sessionStorage["applicationTags"];if(n!==undefined)n=JSON.parse(n);if(n===undefined||n["guest"]===undefined||n["guest"]!==undefined&&!n["guest"])t.Toaster.ShowToast("Error getting keyImages from server.",t.Colors.Orange,3)};l.Send()};var l=t.PlatformContext.PlatformUri+"/fhir/Basic?subject="+e+"&code=stitch";callKeyImages(l)}static DeleteStitch(e,o){var s=t.PlatformContext.PlatformUri+"/fhir/Basic/"+e.Id;var l=new n.FhirCall(s,"DELETE");l.FuncOk=(e,t)=>{o(t)};l.FuncError=e=>{o(e)};l.Send()}}StitchManager.PseudoSeriesGuid="stitchPseudoSeries";e.StitchManager=StitchManager})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;let o;(function(e){e[e["Select"]=0]="Select";e[e["Unselect"]=1]="Unselect";e[e["Link"]=2]="Link";e[e["Unlink"]=3]="Unlink"})(o=e.ActionButton||(e.ActionButton={}));class ViewportLinkManager{constructor(e,s,l,u,c){this.isLinked=false;this.viewport=e;this.actionButton=o.Select;this.container=s;this.viewerPage=l;this.allViewports=l.ViewportPane.ViewportsArray;this.LinkGroup=new Array;var d=this.viewerPage.View.Platform.LanguageManager;this.buttonNameSelect=d.GetValuesFromDict("DicomPluginLanguage","LinkButtonSelect");this.buttonNameUnselect=d.GetValuesFromDict("DicomPluginLanguage","LinkButtonUnselect");this.buttonNameLink=d.GetValuesFromDict("DicomPluginLanguage","LinkButtonLink");this.buttonNameUnlink=d.GetValuesFromDict("DicomPluginLanguage","LinkButtonUnlink");this.ViewportLayoutGrid=new t.ViewportLayoutGrid(this.container,u,c,{width:10,height:10},t.PositionLayoutGrid.topRight,t.Colors.BelizeHole,t.Colors.PeterRiver);this.ViewportLayoutGrid.Element.style.display="none";this.ViewportLayoutGrid.Render(this.viewport.NumberInPanel);var m=u<=2?40:30;this.ViewportLayoutGrid.Element.style.left=parseInt(this.ViewportLayoutGrid.Element.style.left)-m+"px";this.linkButton=document.createElement("button");this.linkButton.innerHTML=this.buttonNameSelect;this.linkButton.style.marginTop="10px";this.linkButton.style.width="70px";n.AddClass(this.linkButton,"linkButton");var S=new Hammer(this.linkButton);S.on("tap",(e=>{this.allViewports=l.ViewportPane.ViewportsArray;switch(this.actionButton){case o.Select:if(this.viewport.Context.IsPseudoSeries){t.Toaster.ShowToast("It is not possible select a keyimage",t.Colors.BelizeHole,3);return}this.viewerPage.UnselectViewports(this.viewerPage.ViewportPane);this.viewport.SelectViewport=true;this.viewport.ViewportFrameElement.style.borderColor=t.Colors.PeterRiver;this.linkButton.innerHTML=this.buttonNameUnselect;this.actionButton=o.Unselect;for(var n=0;n<this.allViewports.length;n++){var s=this.allViewports[n].LinkManager;if(s&&s.actionButton!==o.Unselect){if(!s.isLinked){s.linkButton.innerHTML=this.buttonNameLink;s.actionButton=o.Link}else{s.linkButton.innerHTML=this.buttonNameUnlink;s.actionButton=o.Unlink}}}break;case o.Unselect:this.viewerPage.UnselectViewports(this.viewerPage.ViewportPane);this.viewport.SelectViewport=true;this.viewport.ViewportFrameElement.style.borderColor=t.Colors.Nephritis;this.linkButton.innerHTML=this.buttonNameSelect;this.actionButton=o.Select;this.removeAllViewportsFromLink(this.viewport);for(var u=0;u<this.allViewports.length;u++){var c=this.allViewports[u].LinkManager;if(c&&c.actionButton!==o.Select){c.linkButton.innerHTML=this.buttonNameSelect;c.actionButton=o.Select}}break;case o.Link:var d=this.addViewportToLink();if(d){this.linkButton.innerHTML=this.buttonNameUnlink;this.actionButton=o.Unlink}break;case o.Unlink:this.removeViewportFromLink(this.viewport);var m=this.getViewportInitial();if(m===null){this.linkButton.innerHTML=this.buttonNameSelect;this.actionButton=o.Select}else{this.linkButton.innerHTML=this.buttonNameLink;this.actionButton=o.Link}break}}));this.ViewportLayoutGrid.Element.appendChild(this.linkButton)}Init(){this.removeViewportFromLink(this.viewport);this.linkButton.innerHTML=this.buttonNameSelect;this.actionButton=o.Select}UpdateLayoutGrid(e,t=0){var o=e.LinkManager.LinkGroup;var s=0;if(this.ViewportLayoutGrid.HorizontalViewports<=2)s=40;else s=30;if(o.length>0){for(var l=0;l<o.length;l++){var u=new Array;for(var c=0;c<o.length;c++){if(n.IsDisplay(o[c].ViewportFrameElement))u.push(o[c].NumberInPanel)}o[l].LinkManager.ViewportLayoutGrid.Render(t,u);o[l].LinkManager.ViewportLayoutGrid.Element.style.left=parseInt(o[l].LinkManager.ViewportLayoutGrid.Element.style.left)-s+"px"}}else{e.LinkManager.ViewportLayoutGrid.Render(e.NumberInPanel);e.LinkManager.ViewportLayoutGrid.Element.style.left=parseInt(e.LinkManager.ViewportLayoutGrid.Element.style.left)-s+"px"}}getViewportInitial(){for(var t=0;t<this.allViewports.length;t++){if(this.allViewports[t]instanceof e.DicomViewport){if(this.allViewports[t].LinkManager.actionButton===o.Unselect){return this.allViewports[t]}}}return null}addViewportToLink(){var e=this.getViewportInitial();if(e!==null){if(this.searchInLinks(e)===-1){e.LinkManager.isLinked=true;e.LinkManager.LinkGroup.push(e)}if(e.LinkManager.searchInLinks(this.viewport)===-1){if(!this.viewport.Context.IsPseudoSeries){if(this.allowLink(e,this.viewport)){this.isLinked=true;e.LinkManager.LinkGroup.push(this.viewport);for(var n=1;n<e.LinkManager.LinkGroup.length;n++){e.LinkManager.LinkGroup[n].LinkManager.LinkGroup=new Array;for(var o=0;o<e.LinkManager.LinkGroup.length;o++){e.LinkManager.LinkGroup[n].LinkManager.LinkGroup.push(e.LinkManager.LinkGroup[o])}}this.UpdateLayoutGrid(this.viewport);return true}else{t.Toaster.ShowToast("It has not been possible to make a link",t.Colors.BelizeHole,3);if(e.LinkManager.LinkGroup.length===1)this.removeViewportFromLink(e)}}else{t.Toaster.ShowToast("It is not possible to link on a keyimage",t.Colors.BelizeHole,3)}}}this.UpdateLayoutGrid(this.viewport);return false}removeAllViewportsFromLink(e){try{var t=this.searchInLinks(e);if(t!==-1){for(var n=0;n<e.LinkManager.LinkGroup.length;n++){if(t!==n){var o=e.LinkManager.LinkGroup[n];o.LinkManager.isLinked=false;o.LinkManager.LinkGroup=new Array;this.UpdateLayoutGrid(o)}}e.LinkManager.LinkGroup[t].LinkManager.isLinked=false;e.LinkManager.LinkGroup[t].LinkManager.LinkGroup=new Array;this.UpdateLayoutGrid(e)}}catch(e){}}removeViewportFromLink(e){try{var t=this.searchInLinks(e);if(t!==-1){e.LinkManager.isLinked=false;for(var n=0;n<e.LinkManager.LinkGroup.length;n++){if(t!==n){e.LinkManager.LinkGroup[n].LinkManager.isLinked=false;e.LinkManager.LinkGroup[n].LinkManager.LinkGroup.splice(t,1);this.UpdateLayoutGrid(e.LinkManager.LinkGroup[n].LinkManager.viewport)}}}e.LinkManager.LinkGroup[t].LinkManager.LinkGroup=new Array;this.UpdateLayoutGrid(this.viewport)}catch(e){}}searchInLinks(e){var t=e.LinkManager.LinkGroup;for(var n=0;n<t.length;n++){if(t[n].Context.SeriesGuid===e.Context.SeriesGuid&&t[n].Context.StudyGuid===e.Context.StudyGuid)return n}return-1}allowLink(e,t){var n=e.Context.ImageEntity["normalVector"];var o=t.Context.ImageEntity["normalVector"];if(e.Context.SeriesGuid!==t.Context.SeriesGuid){if(n!==null&&o!==null&&n!==undefined&&o!==undefined){var s=Math.acos(parseFloat((n[0]*o[0]+n[1]*o[1]+n[2]*o[2]).toFixed(2)))*180/Math.PI;var l=10;if(s<l){return true}}}return false}}e.ViewportLinkManager=ViewportLinkManager})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){var t=Efferent.Frontend.WebClient;var n=Efferent.Frontend.FhirClient;var o=t.Utils;var s=Efferent.ClientViews.ImagingStudyView;class WadoDownloaderAdapter{constructor(e,t){this.controller=e;this.plugin=t;this.keyImagesLoad=[]}Download(o,s=false,l=false){this.seriesIndex=0;this.imageIndex=0;this.phase=1;e.KeyImageManager.PseudoSerieStudy.keyImagesInStudyLoad={};e.StitchManager.PseudoSerieStudy.keyImagesInStudyLoad={};this.keyImagesLoad=[];this.indexKeyImagesLoad=0;this.indexSeriesLoadThumbnail=0;if(!l&&!s)this.plugin.BuildViewports();this.refreshForceOneTime=false;var u;var c=this.controller.StudyViewerModel.Documents.StructureData[o.StudyGUID];if(this.controller.StudyViewerModel.Documents!==undefined){if(this.controller.StudyViewerModel.Documents.StructureData[o.StudyGUID]===undefined){this.controller.StudyViewerModel.Documents.IndexData.push(o.StudyGUID);this.controller.StudyViewerModel.Documents.StructureData[o.StudyGUID]=new e.DicomDocument(o)}else{if(!s){return}else{this.mergeSeriesAndImagesInRefresh(o.StudyGUID,o);for(var d=0;d<this.controller.View.Plugins.length;d++)this.controller.View.Plugins[d].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,!l)}}}var m=sessionStorage["Downloader"]||"WadoPlugin.min.js";this.downloadWorker=new Worker("out/"+m);if(!l)t.Loader.Show("Loading first resource.");this.downloadWorker.addEventListener("message",(n=>{var u=n.data;var c=this.plugin.Controller.View.Platform.Configuration.QualityMode.toLowerCase();if(u.tokenCacheRenew!==undefined&&u.tokenCacheRenew!==null){this.controller.View.Platform.CacheConnect.TokenCache=u.tokenCacheRenew;sessionStorage["tokenCache"]=u.tokenCacheRenew}if(u.action==="imageRaw"){t.Loader.Hide();this.processRawImage(o,u,s,l);if(this.controller.ForceHDDownloadForStudyAndSerie[o.StudyGUID]){try{this.controller.ForceHDDownloadForStudyAndSerie[o.StudyGUID].forEach((e=>{if(e.seriesGuid===u.seriesGuid&&e.isActive)this.RemoveLoadAttributeForImage(o,e.seriesGuid,true)}))}catch(e){t.Utils.DebugConsoleLog(e)}}try{var d=this.controller.ViewportPane.ViewportsArray;for(var m=0;m<d.length;m++){var S=d[m];if(t.DOMUtils.IsDisplay(S.ViewportFrameElement)&&S.Context.ImageEntity!==null){if(S instanceof e.DicomViewport){var C=this.plugin.IsActiveDownloadForceHD(S.Context.StudyGuid,S.Context.SeriesGuid);if(C!==null&&!C){if(S.Context.ImageEntity.ImageGUID===u.imageGuid)this.plugin.UpdateImageProperties(S)}else if(l){if(S.Context.ImageEntity.ImageGUID===u.imageGuid)this.plugin.UpdateImageProperties(S)}if(c==="mixed"&&this.GetPhase()===2&&this.plugin.CheckFullDownloadStudy(o,S.Context.SeriesGuid))this.plugin.UpdateImageProperties(S)}}}}catch(e){t.Utils.DebugConsoleLog(e)}}else if(u.action==="videoMp4"){t.Loader.Hide();this.processMP4(o,u,s)}if(this.plugin.CheckFullDownloadStudy(o)){if(c!=="mixed"||c==="mixed"&&this.GetPhase()===2&&this.plugin.CheckFullDownloadStudy(o))this.StopWorker()}}),false);var S=this.controller.GetTypeStudyForSeries(o.Series.StructureData[o.Series.IndexData[this.seriesIndex]].Description);c=this.controller.StudyViewerModel.Documents.StructureData[o.StudyGUID];u=this.GetSeriesAndImageGuids(o.StudyGUID);var C={action:"downloadImage",baseUri:t.PlatformContext.PlatformUri,dictionaryStudy:this.getStudyEntityForWorker(c.Study),imageGuid:u.imageGuid,imageIndex:this.imageIndex,localRepositoryActive:this.controller.View.Platform.GetSetting("localRepoActive")===undefined?"false":this.controller.View.Platform.GetSetting("localRepoActive"),offlineMode:this.controller.View.Platform.CacheConnect.OfflineMode,phase:this.phase,qualityMode:this.controller.View.Platform.Configuration.QualityMode,seriesGuid:u.seriesGuid,seriesIndex:this.seriesIndex,urlLocalRepository:this.controller.View.Platform.CacheConnect.ServiceUrlCache,xToken:sessionStorage["token"],xTokenCache:sessionStorage["tokenCache"],xUserEmail:sessionStorage["userEmail"],xUserPassword:sessionStorage["passwordUser"],xVersionSignature:Efferent.Frontend.WebClient.AssemblyInfo.Version,organizationId:sessionStorage["organizationId"],applicationName:sessionStorage["application"],blockTokenRequest:this.controller.View.Platform.CacheConnect.BlockTokenRequest,refresh:s,forceHD:this.plugin.IsActiveDownloadForceHD(o.StudyGUID,u.seriesGuid)};if(S==="MP4"){C.seriesType=S;this.downloadWorker.postMessage(C)}else{var p=this.plugin.Controller.ImagingStudyFhirEntities[o.StudyGUID];t.Loader.Show();n.KeyImageClient.GetKeyImages(p["id"],(n=>{t.Loader.Hide();if(n.length>0){var s=[];for(var l=0;l<n.length;l++){var u=n[l];var c=u.Images;for(var d=0;d<c.length;d++){var m=c[d].ImageGUID;var S=this.plugin.GetSeriesGuidFromImageGuid(o.StudyGUID,m);if(S!==null){var A=this.getIndexesInSeries(o.StudyGUID,S,m);s.push({keyImageId:u.KeyImageID,seriesIndex:A.seriesIndex,imageIndex:A.imageIndex});this.keyImagesLoad.push({keyImageId:u.KeyImageID,seriesIndex:A.seriesIndex,imageIndex:A.imageIndex})}}}if(s.length>0){e.KeyImageManager.PseudoSerieStudy.keyImagesInStudyLoad[o.StudyGUID]=JSON.stringify(s);e.KeyImageManager.PseudoSerieStudy.CreatePseudoSeries(o.StudyGUID,n)}}t.Loader.Show();e.StitchManager.GetStitch(p["id"],(n=>{t.Loader.Hide();if(n.length>0){var s=[];for(var l=0;l<n.length;l++){var u=n[l];var c=u.Images;for(var d=0;d<c.length;d++){var m=c[d].ImageGUID;var S=this.plugin.GetSeriesGuidFromImageGuid(o.StudyGUID,m);var p=this.getIndexesInSeries(o.StudyGUID,S,m);s.push({keyImageId:u.KeyImageID,seriesIndex:p.seriesIndex,imageIndex:p.imageIndex});this.keyImagesLoad.push({keyImageId:u.KeyImageID,seriesIndex:p.seriesIndex,imageIndex:p.imageIndex})}}e.StitchManager.PseudoSerieStudy.keyImagesInStudyLoad[o.StudyGUID]=JSON.stringify(s);e.StitchManager.PseudoSerieStudy.CreatePseudoSeries(o.StudyGUID,n)}this.downloadWorker.postMessage(C)}))}))}}SetSeriesToViewport(e,t,n,o,s,l){}GetImageEntityForStudyAndSeries(e,t,n,o){return null}GetImagesLoadedBySeries(t,n){var o=0;if(n===e.KeyImageManager.PseudoSeriesGuid||n===e.StitchManager.PseudoSeriesGuid){o=this.controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[n].KeyImages.IndexData.length}else{for(var s=0;s<this.controller.StudyViewerModel.Documents.StructureData[t].Study.Series.IndexData.length;s++){var l=this.controller.StudyViewerModel.Documents.StructureData[t].Study.Series.IndexData[s];if(l===n){var u=this.controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[l].Images;for(var c=0;c<u.IndexData.length;c++){var d=u.IndexData[c];var m=this.controller.StudyViewerModel.Documents.StructureData[t].Study.Series.StructureData[l].Images.StructureData[d];if(m["Load"]||m["NoRetryDownload"])o++}}}}return o}GetSeriesAndImageGuids(e,t,n){var o=this.controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData[t===undefined?this.seriesIndex:t];var s=this.controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[o].SeriesGUID;var l=this.controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[s].Images.IndexData[n===undefined?this.imageIndex:n];var u=this.controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[s].Images.StructureData[l].ImageGUID;return{seriesGuid:s,imageGuid:u}}RemoveLoadAttributeForImage(e,t,n=false){e.Series.IndexData.forEach((o=>{if(t===o){var s=e.Series.StructureData[o].Images;if(s!==undefined&&s!==null){s.IndexData.forEach((t=>{var s=e.Series.StructureData[o].Images.StructureData[t];if(!n){delete s["Load"];delete s["NoRetryDownload"]}else{if(s["Load"]){var l=s["dicomTags"]["0002_0010"];if(l==="1.2.840.10008.1.2.4.50"&&!s["HDIsNotAvailable"]){delete s["Load"];delete s["NoRetryDownload"]}}}}))}}}))}GetPhase(){return this.phase}StopWorker(){if(this.downloadWorker!==undefined)this.downloadWorker.terminate()}getIndexesInSeries(e,t,n){var o={seriesIndex:-1,imageIndex:-1};for(var s=0;s<this.controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData.length;s++){var l=this.controller.StudyViewerModel.Documents.StructureData[e].Study.Series.IndexData[s];var u=this.controller.StudyViewerModel.Documents.StructureData[e].Study.Series.StructureData[l].Images;if(t===l){for(var c=0;c<u.IndexData.length;c++){var d=u.IndexData[c];if(n===d){o.seriesIndex=s;o.imageIndex=c;break}}}}return o}getNextSeriesNotFullyLoaded(t){var n=this.controller.StudyViewerModel.Documents.StructureData[t.StudyGUID];var o=null;for(var s=0;s<n.Study.Series.IndexData.length;s++){var l=n.Study.Series.IndexData[s];if(l!==e.KeyImageManager.PseudoSeriesGuid&&l!==e.StitchManager.PseudoSeriesGuid&&this.GetImagesLoadedBySeries(t.StudyGUID,l)!==n.Study.Series.StructureData[l].Images.IndexData.length){o=s;break}}return o}getStudyEntityForWorker(e){var n=new s.StudyEntity;n.StudyGUID=e["StudyGUID"];n.Series=new t.MapStructure;for(var o=0;o<e.Series.IndexData.length;o++){var l=e.Series.IndexData[o];var u=e.Series.StructureData[l].Images;n.Series.IndexData[o]=l;n.Series.StructureData[l]=new s.SeriesEntity;n.Series.StructureData[l]["Images"]=new t.MapStructure;n.Series.StructureData[l]["SeriesGUID"]=e.Series.StructureData[l].SeriesGUID;n.Series.StructureData[l]["Description"]=e.Series.StructureData[l].Description;n.Series.StructureData[l]["ImageCount"]=e.Series.StructureData[l].ImageCount;if(u!==undefined&&u!==null){for(var c=0;c<u.IndexData.length;c++){var d=u.IndexData[c];n.Series.StructureData[l]["Images"].IndexData[c]=d;n.Series.StructureData[l]["Images"].StructureData[d]=new s.ImageEntity;n.Series.StructureData[l]["Images"].StructureData[d]["ImageGUID"]=u.StructureData[d].ImageGUID;n.Series.StructureData[l]["Images"].StructureData[d]["ImageUri"]=u.StructureData[d].ImageUri;n.Series.StructureData[l]["Images"].StructureData[d]["InstanceNumber"]=u.StructureData[d].InstanceNumber;n.Series.StructureData[l]["Images"].StructureData[d]["Load"]=u.StructureData[d]["Load"];n.Series.StructureData[l]["Images"].StructureData[d]["LoadAnnotations"]=u.StructureData[d]["LoadAnnotations"];n.Series.StructureData[l]["Images"].StructureData[d]["dicomTags"]=u.StructureData[d]["dicomTags"];n.Series.StructureData[l]["Images"].StructureData[d]["has3DInformation"]=u.StructureData[d]["has3DInformation"];n.Series.StructureData[l]["Images"].StructureData[d]["isUnsigned"]=u.StructureData[d]["isUnsigned"];n.Series.StructureData[l]["Images"].StructureData[d]["photometric"]=u.StructureData[d]["photometric"];n.Series.StructureData[l]["Images"].StructureData[d]["pixelSpacing"]=u.StructureData[d]["pixelSpacing"];n.Series.StructureData[l]["Images"].StructureData[d]["TransferSyntax"]=u.StructureData[d]["TransferSyntax"]}}}return n}processRawImage(n,l,u,c){this.imageIndex=parseInt(l.imageIndex);this.seriesIndex=parseInt(l.seriesIndex);var d;var m=this.controller.StudyViewerModel.Documents.StructureData[n.StudyGUID];if(!l.refresh){if(l["downloaded"]===true){d=this.controller.StudyViewerModel.Documents.StructureData[n.StudyGUID]["Study"]["Series"].StructureData[l.seriesGuid]["Images"].StructureData[l.imageGuid]["buffer"]}else{d=l.imageBuffer}if(!d)l.error=true;var S=l.dicomTags;var C;var p;var A;if(l.dicomTags){if(l["dicomTags"]["0008_0060"]==="SR"){m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["Load"]=true;m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["TypeFile"]="DICOM";C=m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid];C.TransferSyntax=l.transferSyntax.replace(/([^a-z0-9.]+)/gi,"");C["photometric"]=l.photometric;C["isUnsigned"]=l.isUnsigned;C["dicomTags"]=S;C["IsSR"]=true}}if(!l.error){if(l.transferSyntax==="1.2.840.10008.1.2.4.50"){var f=document.createElement("div");f.className="ThumbnailImage";var I=new Image;I.setAttribute("data-seriesIndex",this.seriesIndex.toString());I.setAttribute("data-imageIndex",this.imageIndex.toString());I.onload=e=>{var t=e.currentTarget;var o=parseInt(t.getAttribute("data-imageIndex"));var s=parseInt(t.getAttribute("data-seriesIndex"));if(l.downloaded===undefined){var u=document.createElement("canvas");var c=u.getContext("2d");if(I.width>=I.height){var d=120;u.width=d;u.height=u.width*(I.height/I.width)}else{var S=120;u.height=S;u.width=u.height*(I.width/I.height)}c.drawImage(I,0,0,u.width,u.height);if(e.target.getAttribute("invertThumb")==="true"){var C=c.getImageData(0,0,u.width,u.height);for(let e=0;e<C.data.length;e+=4){C.data[e]=255-C.data[e];C.data[e+1]=255-C.data[e+1];C.data[e+2]=255-C.data[e+2];C.data[e+3]=255}c.putImageData(C,0,0)}var p=u.toDataURL();var A=this.GetSeriesAndImageGuids(n.StudyGUID,s,o);m.Study.Series.StructureData[A.seriesGuid].Images.StructureData[A.imageGuid].Thumbnail=p;if(this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][s].SeriesImage===undefined){var D=new Image;D.onload=e=>{const t=e.target;if(t.naturalWidth>t.naturalHeight)t.classList.add("th-landscape");else t.classList.add("th-portrait")};D.src=p;this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][s].SeriesImage=D;this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][s].Element.appendChild(f);f.appendChild(D)}}};m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["Load"]=true;m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["TypeFile"]="DICOM";p=this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][this.seriesIndex];p.Element.setAttribute("data-totalImagesLoaded",this.GetImagesLoadedBySeries(n.StudyGUID,l.seriesGuid).toString());p.Element.setAttribute("data-totalImages",m.Study.Series.StructureData[l.seriesGuid].Images.IndexData.length.toString());p.Element.setAttribute("data-typeResource","dicom");p.Element.setAttribute("data-seriesDescription",S["0008_103E"]||"NO DESCRIPTION");p.Element.setAttribute("tooltip",S["0008_103E"]||"NO DESCRIPTION");p.StartProgressRing();if(l.downloaded===undefined){C=m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid];C.TransferSyntax=l.transferSyntax.replace(/([^a-z0-9.]+)/gi,"");C["photometric"]=l.photometric;C["isUnsigned"]=l.isUnsigned;C["dicomTags"]=S;C["bufferOriginalBase"]=d.slice();t.DicomBufferRenderer.GetFramesBuffer(C,d);C.LoadAnnotations=false;C["wasShaperning"]=false;var D;if(C["buffer"]){D=d}else{D=C["bufferArray"][0];C["buffer"]=D}var P=window.btoa(o.Uint8ToString(D));var v="data:image/jpeg;base64,"+P;const e=t.SequenceLUT.InvertImageForLut(C);if(e){I.setAttribute("invertThumb","true")}I.src=v;if(u){this.plugin.ConvertJpegImageToCanvasData(l.studyGuid,l.seriesGuid,l.imageGuid,v,l.seriesIndex,l.imageIndex,((e,t)=>{this.plugin.GetImageAnnotations(e,t);if(!this.refreshForceOneTime&&!c){for(var n=0;n<this.controller.View.Plugins.length;n++)this.controller.View.Plugins[n].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,true);this.refreshForceOneTime=true}for(var o=0;o<this.controller.View.Plugins.length;o++)this.controller.View.Plugins[o].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,false)}))}else{this.plugin.ConvertJpegImageToCanvasData(l.studyGuid,l.seriesGuid,l.imageGuid,v,l.seriesIndex,l.imageIndex)}}}else{m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["Load"]=true;m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["TypeFile"]="DICOM";p=this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][this.seriesIndex];p.Element.setAttribute("data-totalImagesLoaded",this.GetImagesLoadedBySeries(n.StudyGUID,l.seriesGuid).toString());p.Element.setAttribute("data-totalImages",m.Study.Series.StructureData[l.seriesGuid].Images.IndexData.length.toString());p.Element.setAttribute("data-typeResource","dicom");p.StartProgressRing();if(l.downloaded===undefined){this.plugin.GetThumbnailAndAssign(n.StudyGUID,l.seriesGuid,this.seriesIndex,l.imageGuid,this.imageIndex);C=m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid];C.TransferSyntax=l.transferSyntax.replace(/([^a-z0-9.]+)/gi,"");C["photometric"]=l.photometric;C["isUnsigned"]=l.isUnsigned;C["dicomTags"]=S;C["bufferOriginalBase"]=d.slice();t.DicomBufferRenderer.GetFramesBuffer(C,d);C["wasShaperning"]=false;var D;if(C["buffer"]===null){D=C["bufferArray"][0];C["buffer"]=D}t.DicomBufferRenderer.GetWLFromImage(m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]);this.plugin.Process3DInformation(m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]);m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["Processed"]=true;m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid].LoadAnnotations=false;this.plugin.GetImageAnnotations(n.StudyGUID,m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]);var T=this.controller.View.Platform.GetSetting("chkAutomaticViewportPopulation")===undefined?true:t.Utils.StrToBool(this.controller.View.Platform.GetSetting("chkAutomaticViewportPopulation"));if(this.plugin.Controller.LayoutMode===s.LayoutMode.Stack){if(T)this.plugin.Controller.View.SetSerieResourceToViewport(this.plugin.PluginName,l.studyGuid,l.seriesGuid,l.imageGuid,l.seriesIndex,l.imageIndex);else this.plugin.ValidateViewportVoid()}else if(this.plugin.Controller.LayoutMode===s.LayoutMode.Tile){if(parseInt(l.seriesIndex)===0){if(T)this.plugin.Controller.View.SetSerieResourceToViewport(this.plugin.PluginName,l.studyGuid,l.seriesGuid,l.imageGuid,l.seriesIndex,l.imageIndex);else this.plugin.ValidateViewportVoid()}}if(u){if(!this.refreshForceOneTime&&!c){for(var V=0;V<this.controller.View.Plugins.length;V++)this.controller.View.Plugins[V].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,true);this.refreshForceOneTime=true}for(var V=0;V<this.controller.View.Plugins.length;V++)this.controller.View.Plugins[V].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,false)}}}}else{if(l.isForceHDNotAvailable===true){m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["HDIsNotAvailable"]=true;m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["Load"]=true}m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]["NoRetryDownload"]=true;p=this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][this.seriesIndex];p.Element.setAttribute("data-totalImagesLoaded",this.GetImagesLoadedBySeries(n.StudyGUID,l.seriesGuid).toString());p.Element.setAttribute("data-totalImages",m.Study.Series.StructureData[l.seriesGuid].Images.IndexData.length.toString());p.StartProgressRing();if(C&&C["IsSR"]){var T=this.controller.View.Platform.GetSetting("chkAutomaticViewportPopulation")===undefined?true:t.Utils.StrToBool(this.controller.View.Platform.GetSetting("chkAutomaticViewportPopulation"));p.Element.setAttribute("data-typeResource","dicom");if(T)this.plugin.Controller.View.SetSerieResourceToViewport(this.plugin.PluginName,l.studyGuid,l.seriesGuid,l.imageGuid,l.seriesIndex,l.imageIndex);else this.plugin.ValidateViewportVoid()}else{let e=this.plugin.Controller.GetViewportBySerieAndStudy(l.studyGuid,l.seriesGuid);if(this.plugin.CheckFullDownloadStudy(m.Study,l.seriesGuid)||l.imageIndex===0){let t=m.Study.Series.StructureData[l.seriesGuid].Images.IndexData[0];let n=0;this.plugin.Controller.View.SetSerieResourceToViewport(this.plugin.PluginName,l.studyGuid,l.seriesGuid,t,l.seriesIndex,n,true,e)}}}}else{p=this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][this.seriesIndex];let o=parseInt(p.Element.getAttribute("data-totalImagesLoaded"));let s=parseInt(p.Element.getAttribute("data-totalImages"));if(o===s){e.KeyImageManager.PseudoSerieStudy.ControllerKeyImagesLoad(n.StudyGUID);e.StitchManager.PseudoSerieStudy.ControllerKeyImagesLoad(n.StudyGUID)}this.plugin.GetImageAnnotations(n.StudyGUID,m.Study.Series.StructureData[l.seriesGuid].Images.StructureData[l.imageGuid]);t.Utils.DebugConsoleLog("refresh image");t.Utils.DebugConsoleLog(l)}this.indexSeriesLoadThumbnail++;if(this.indexSeriesLoadThumbnail<m.Study.Series.IndexData.length&&m.Study.Series.IndexData[this.indexSeriesLoadThumbnail]!==e.KeyImageManager.PseudoSeriesGuid&&m.Study.Series.IndexData[this.indexSeriesLoadThumbnail]!==e.StitchManager.PseudoSeriesGuid){this.seriesIndex++;this.imageIndex=0}else{var R=m.Study.Series.IndexData[this.indexSeriesLoadThumbnail]===e.KeyImageManager.PseudoSeriesGuid||m.Study.Series.IndexData[this.indexSeriesLoadThumbnail]===e.StitchManager.PseudoSeriesGuid?1:0;if(this.indexSeriesLoadThumbnail===m.Study.Series.IndexData.length-R){this.seriesIndex=0;this.imageIndex=0;A=this.GetSeriesAndImageGuids(n.StudyGUID);l.seriesGuid=A.seriesGuid}if(this.imageIndex===m.Study.Series.StructureData[l.seriesGuid].Images.IndexData.length-1){this.seriesIndex++;this.imageIndex=0}else{this.imageIndex++}this.indexKeyImagesLoad++;if(this.keyImagesLoad.length>=this.indexKeyImagesLoad){this.seriesIndex=this.keyImagesLoad[this.indexKeyImagesLoad-1].seriesIndex;this.imageIndex=this.keyImagesLoad[this.indexKeyImagesLoad-1].imageIndex;A=this.GetSeriesAndImageGuids(n.StudyGUID);l.seriesGuid=A.seriesGuid}else{if(this.keyImagesLoad.length!==0&&this.keyImagesLoad.length===this.indexKeyImagesLoad-1){this.seriesIndex=0;this.imageIndex=0;A=this.GetSeriesAndImageGuids(n.StudyGUID);l.seriesGuid=A.seriesGuid}}var E=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(E!=null&&(this.keyImagesLoad.length===0||this.keyImagesLoad.length<=this.indexKeyImagesLoad-1)){if(E.Context.StudyGuid===m.Study.StudyGUID&&E.Context.StudyGuid!==undefined&&E.Context.SeriesGuid!==undefined&&E.Context.SeriesGuid!==e.KeyImageManager.PseudoSeriesGuid&&E.Context.SeriesGuid!==e.StitchManager.PseudoSeriesGuid){if(this.GetImagesLoadedBySeries(E.Context.StudyGuid,E.Context.SeriesGuid)<m.Study.Series.StructureData[E.Context.SeriesGuid].Images.IndexData.length){var M=E.Context.StudyGuid;var G=E.Context.SeriesGuid;for(var L=0;L<m.Study.Series.IndexData.length;L++){if(M===m.Study.StudyGUID&&m.Study.Series.StructureData[m.Study.Series.IndexData[L]].SeriesGUID===G){this.seriesIndex=L;for(var F=0;F<m.Study.Series.StructureData[m.Study.Series.IndexData[L]].Images.IndexData.length;F++){var B=m.Study.Series.StructureData[G].Images.IndexData[F];var O=m.Study.Series.StructureData[m.Study.Series.IndexData[L]].Images.StructureData[B];if(O["Load"]!==true){if(O["NoRetryDownload"]!==true){this.imageIndex=F;break}}}A=this.GetSeriesAndImageGuids(n.StudyGUID);l.seriesGuid=A.seriesGuid;break}}}}}}if(l.seriesGuid!==e.KeyImageManager.PseudoSeriesGuid&&l.seriesGuid!==e.StitchManager.PseudoSeriesGuid&&this.GetImagesLoadedBySeries(n.StudyGUID,l.seriesGuid)===m.Study.Series.StructureData[l.seriesGuid].Images.IndexData.length){var N=this.getNextSeriesNotFullyLoaded(n);if(N!==null&&this.indexSeriesLoadThumbnail>=m.Study.Series.IndexData.length){this.seriesIndex=N;this.imageIndex=0;A=this.GetSeriesAndImageGuids(n.StudyGUID);l.seriesGuid=A.seriesGuid}}if(m.Study.Series.IndexData[this.seriesIndex]!==e.KeyImageManager.PseudoSeriesGuid&&m.Study.Series.IndexData[this.seriesIndex]!==e.StitchManager.PseudoSeriesGuid&&this.seriesIndex<m.Study.Series.IndexData.length&&this.imageIndex<m.Study.Series.StructureData[l.seriesGuid].Images.IndexData.length){A=this.GetSeriesAndImageGuids(n.StudyGUID);this.downloadWorker.postMessage({action:"downloadImage",baseUri:t.PlatformContext.PlatformUri,dictionaryStudy:this.getStudyEntityForWorker(m.Study),error:l.error,imageGuid:A.imageGuid,imageIndex:this.imageIndex,index:this.imageIndex,localRepositoryActive:this.controller.View.Platform.GetSetting("localRepoActive")===undefined?"false":this.controller.View.Platform.GetSetting("localRepoActive"),offlineMode:this.controller.View.Platform.CacheConnect.OfflineMode,seriesGuid:A.seriesGuid,seriesIndex:this.seriesIndex,urlLocalRepository:this.controller.View.Platform.CacheConnect.ServiceUrlCache,xToken:sessionStorage["token"],xTokenCache:sessionStorage["tokenCache"],organizationId:sessionStorage["organizationId"],applicationName:sessionStorage["application"],forceHD:this.plugin.IsActiveDownloadForceHD(n.StudyGUID,A.seriesGuid)})}else if(this.controller.View.Platform.Configuration.QualityMode.toLowerCase()==="mixed"&&this.plugin.CheckFullDownloadStudy(n)){try{if(this.phase===1){this.seriesIndex=0;this.imageIndex=0;this.indexKeyImagesLoad=0;this.indexSeriesLoadThumbnail=0;if(this.plugin.Controller.LayoutMode===s.LayoutMode.Tile){this.plugin.SeriesIndexTileMode=0;this.plugin.ScrollIndexTileMode=0}for(var U=0;U<m.Study.Series.IndexData.length;U++){var k=m.Study.Series.IndexData[U];var W=m.Study.Series.StructureData[k].Images;if(W){for(var q=0;q<W.IndexData.length;q++){var X=W.IndexData[q];m.Study.Series.StructureData[k].Images.StructureData[X]["Load"]=false}}}this.phase=2}A=this.GetSeriesAndImageGuids(n.StudyGUID);this.downloadWorker.postMessage({action:"downloadImage",baseUri:t.PlatformContext.PlatformUri,dictionaryStudy:this.getStudyEntityForWorker(m.Study),error:l.error,imageGuid:A.imageGuid,imageIndex:this.imageIndex,index:this.imageIndex,localRepositoryActive:this.controller.View.Platform.GetSetting("localRepoActive")===undefined?"false":this.controller.View.Platform.GetSetting("localRepoActive"),offlineMode:this.controller.View.Platform.CacheConnect.OfflineMode,phase:this.phase,seriesGuid:A.seriesGuid,seriesIndex:this.seriesIndex,urlLocalRepository:this.controller.View.Platform.CacheConnect.ServiceUrlCache,xToken:sessionStorage["token"],xTokenCache:sessionStorage["tokenCache"],organizationId:sessionStorage["organizationId"],applicationName:sessionStorage["application"],forceHD:this.plugin.IsActiveDownloadForceHD(n.StudyGUID,A.seriesGuid)})}catch(e){t.Utils.DebugConsoleLog(e)}}}processMP4(n,o,s){this.imageIndex=parseInt(o.imageIndex);this.seriesIndex=parseInt(o.seriesIndex);var l=this.controller.StudyViewerModel.Documents.StructureData[n.StudyGUID];if(!o.refresh){var u=o.videoBuffer;var c=o.fps;var d=o.urlFileShared;var m=this.controller.View.Platform.GetSetting("chkAutomaticViewportPopulation")===undefined?true:t.Utils.StrToBool(this.controller.View.Platform.GetSetting("chkAutomaticViewportPopulation"));var S="data:image/png;base64,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";var C=document.createElement("div");C.className="ThumbnailImage";var p=new Image;p.setAttribute("data-seriesIndex",this.seriesIndex.toString());p.setAttribute("data-imageIndex",this.imageIndex.toString());p.setAttribute("data-studyGUID",o.studyGuid);p.setAttribute("data-serieGUID",o.seriesGuid);p.setAttribute("data-imageGUID",o.imageGuid);p.onload=e=>{var o=e.currentTarget;var u=parseInt(o.getAttribute("data-imageIndex"));var c=parseInt(o.getAttribute("data-seriesIndex"));var d=o.getAttribute("data-studyGUID");var S=o.getAttribute("data-serieGUID");var A=o.getAttribute("data-imageGUID");var f=document.createElement("canvas");var I=f.getContext("2d");if(p.width>=p.height){var D=120;f.width=D;f.height=f.width*(p.height/p.width)}else{var P=120;f.height=P;f.width=f.height*(p.width/p.height)}I.drawImage(p,0,0,f.width,f.height);var v=f.toDataURL();var T=this.GetSeriesAndImageGuids(n.StudyGUID,c,u);l.Study.Series.StructureData[T.seriesGuid].Images.StructureData[T.imageGuid].Thumbnail=v;if(this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][c].SeriesImage===undefined){var V=new Image;V.src=v;this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][c].SeriesImage=V;this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][c].Element.appendChild(C);C.appendChild(V)}if(m){var R=this.controller.ViewportPane.ViewportsArray;for(var E=0;E<R.length;E++){var M=R[E];if(t.DOMUtils.IsDisplay(M.ViewportFrameElement)&&M.Context.ImageEntity===null){for(var G=0;G<this.controller.View.Plugins.length;G++){var L=this.controller.View.Plugins[G];if(L.PluginName==="Mp4Plugin"){L.ReCreateViewport(M.IndexNumber);E=R.length;break}}}}this.plugin.Controller.View.SetSerieResourceToViewport("Mp4Plugin",d,S,A,c,u)}else{this.plugin.ValidateViewportVoid()}if(s){if(!this.refreshForceOneTime){for(var G=0;G<this.controller.View.Plugins.length;G++)this.controller.View.Plugins[G].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,true);this.refreshForceOneTime=true}for(var G=0;G<this.controller.View.Plugins.length;G++)this.controller.View.Plugins[G].OnWindowResize(document.documentElement.clientWidth,document.documentElement.clientHeight,true,false)}};p.src=S;if(!o.error){var A=this.controller.ThumbnailPane.Thumbnails[n.StudyGUID][this.seriesIndex];l.Study.Series.StructureData[o.seriesGuid].Images.StructureData[o.imageGuid]["Load"]=true;l.Study.Series.StructureData[o.seriesGuid].Images.StructureData[o.imageGuid]["TypeFile"]="MP4";A.Element.setAttribute("data-totalImagesLoaded",this.GetImagesLoadedBySeries(n.StudyGUID,o.seriesGuid).toString());A.Element.setAttribute("data-totalImages",l.Study.Series.StructureData[o.seriesGuid].Images.IndexData.length.toString());A.Element.setAttribute("data-typeResource","mp4");A.StartProgressRing();l.Study.Series.StructureData[o.seriesGuid].Images.StructureData[o.imageGuid]["buffer"]=u;l.Study.Series.StructureData[o.seriesGuid].Images.StructureData[o.imageGuid]["fps"]=c;l.Study.Series.StructureData[o.seriesGuid].Images.StructureData[o.imageGuid]["ImageUriShared"]=d}}else{t.Utils.DebugConsoleLog("refresh mp4");t.Utils.DebugConsoleLog(o)}this.indexSeriesLoadThumbnail++;if(this.indexSeriesLoadThumbnail<l.Study.Series.IndexData.length){this.seriesIndex++;this.imageIndex=0}else{var f=l.Study.Series.IndexData[this.indexSeriesLoadThumbnail]===e.KeyImageManager.PseudoSeriesGuid||l.Study.Series.IndexData[this.indexSeriesLoadThumbnail]===e.StitchManager.PseudoSeriesGuid?1:0;if(this.indexSeriesLoadThumbnail===l.Study.Series.IndexData.length-f){this.seriesIndex=0;this.imageIndex=0;I=this.GetSeriesAndImageGuids(n.StudyGUID);o.seriesGuid=I.seriesGuid}if(this.imageIndex===l.Study.Series.StructureData[o.seriesGuid].Images.IndexData.length-1){this.seriesIndex++;this.imageIndex=0}else{this.imageIndex++}}if(this.seriesIndex<l.Study.Series.IndexData.length&&this.imageIndex<l.Study.Series.StructureData[o.seriesGuid].Images.IndexData.length){var I=this.GetSeriesAndImageGuids(n.StudyGUID);var D=this.controller.GetTypeStudyForSeries(n.Series.StructureData[n.Series.IndexData[this.seriesIndex]].Description);this.downloadWorker.postMessage({action:"downloadImage",baseUri:t.PlatformContext.PlatformUri,dictionaryStudy:this.getStudyEntityForWorker(l.Study),error:o.error,imageGuid:I.imageGuid,imageIndex:this.imageIndex,index:this.imageIndex,localRepositoryActive:this.controller.View.Platform.GetSetting("localRepoActive")===undefined?"false":this.controller.View.Platform.GetSetting("localRepoActive"),offlineMode:this.controller.View.Platform.CacheConnect.OfflineMode,seriesGuid:I.seriesGuid,seriesIndex:this.seriesIndex,seriesType:D,urlLocalRepository:this.controller.View.Platform.CacheConnect.ServiceUrlCache,xToken:sessionStorage["token"],xTokenCache:sessionStorage["tokenCache"],organizationId:sessionStorage["organizationId"],applicationName:sessionStorage["application"]})}}mergeSeriesAndImagesInRefresh(e,t){if(this.controller.StudyViewerModel.Documents.StructureData[e]){let n=this.controller.StudyViewerModel.Documents.StructureData[e]["Study"];let o=t.Series.IndexData;o.forEach((o=>{if(!n.Series.IndexData.some((e=>e===o))){this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.IndexData.push(o);this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o]=t.Series.StructureData[o]}else{if(!t.Series.StructureData[o]["pseudoserie"]){var s=t.Series.StructureData[o].Images.IndexData;s.forEach((s=>{if(!n.Series.StructureData[o].Images.IndexData.some((e=>e===s))){this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].ImageCount=t.Series.StructureData[o].ImageCount;this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].Images.IndexData.push(s);this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].Images.StructureData[s]=t.Series.StructureData[o].Images.StructureData[s]}}));n.Series.StructureData[o].Images.IndexData.forEach((l=>{if(!s.some((e=>e===l))){this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].ImageCount=t.Series.StructureData[o].ImageCount;let s=n.Series.StructureData[o].Images.IndexData.findIndex((e=>e===l));this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].Images.IndexData.splice(s,1);delete this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].Images.StructureData[l]}}))}else{var l=t.Series.StructureData[o].KeyImages.IndexData;l.forEach((s=>{if(!n.Series.StructureData[o].KeyImages.IndexData.some((e=>e===s))){this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].ImageCount=t.Series.StructureData[o].ImageCount;this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].KeyImages.IndexData.push(s);this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[o].KeyImages.StructureData[s]=t.Series.StructureData[o].KeyImages.StructureData[s]}}))}}}));let s=n.Series.IndexData.filter((e=>!t.Series.IndexData.includes(e)));if(s.length>0){s.forEach((t=>{delete this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.StructureData[t];let n=this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.IndexData.findIndex((e=>e===t));if(n>-1)this.controller.StudyViewerModel.Documents.StructureData[e]["Study"].Series.IndexData.splice(n,1)}))}}}}e.WadoDownloaderAdapter=WadoDownloaderAdapter})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));var Vue;(function(e){var t;(function(e){var t;(function(e){class WindowLevelProcessor{ProcessBuffer(e,t,n,o,s,l=-1){var u=Efferent.Frontend.WebClient.DicomBufferRenderer.ProcessBuffer(e,n,o,s,l,e["shaperningIsActive"]&&e["wasShaperning"]===true);if(t!==null){if(u&&u.contextFilled){if(l===-1)t.CanvasImage=u.canvasObject;else t.CanvasImages[l]=u.canvasObject}}else{return u.canvasObject}}}e.WindowLevelProcessor=WindowLevelProcessor})(t=e.DicomPlugin||(e.DicomPlugin={}))})(t=e.Products||(e.Products={}))})(Vue||(Vue={}));