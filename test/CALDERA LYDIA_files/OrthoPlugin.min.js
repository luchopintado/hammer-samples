var __awaiter=this&&this.__awaiter||function(t,e,n,o){function adopt(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,l){function fulfilled(t){try{step(o.next(t))}catch(t){l(t)}}function rejected(t){try{step(o["throw"](t))}catch(t){l(t)}}function step(t){t.done?n(t.value):adopt(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;let o;(function(t){t[t["Valgus"]=0]="Valgus";t[t["Varus"]=1]="Varus";t[t["Neutral"]=2]="Neutral"})(o=t.AlignmentTypeEval||(t.AlignmentTypeEval={}));class AlignmentToolAnnotation{constructor(){this.UnSelectToExecuteClickOnViewport=false;this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Selected=false;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.SnapPoints=new Array;this.Points["FemoralPoints"]=new Array;this.Points["TibialPoints"]=new Array;this.Points["TKAFemoralPoints"]=new Array;this.Points["TKATibialPoints"]=new Array;this.Points["TKAFemoralTeePoints"]=new Array;this.Points["TKATibialTeePoints"]=new Array;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.UnSelectToExecuteClickOnViewport=false;this.CanDragPoint=false;this.IsEditionMode=false;this.IsEdition=false;this.TkaFemoralEdit=false;this.TkaTibialEdit=false;this.TkaFemoralTeeEdit=false;this.TkaTibialTeeEdit=false;this.IndexPointDrag=0;this.FactorScale=1;this.InitialTee=true;this.VectorTeeF1=new n.Vector2D;this.VectorTeeF2=new n.Vector2D;this.VectorTeeT1=new n.Vector2D;this.VectorTeeT2=new n.Vector2D;this.TeeScale=.3}Render(){if(!this.Visible)return;var o=this.Context.Viewport.ViewportElement.getContext("2d");var l=Math.abs(this.Context.ScaleX);var a=Math.round(11/l*10)/10;o.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/l:1/l;o.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;o.strokeStyle=this.Selected===true?e.Colors.Emerald:o.strokeStyle;o.font=a+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";o.fillStyle=e.Colors.SunFlower;o.textAlign="center";o.textBaseline="bottom";this.renderIncomplete();var r=this.Status===n.EAnnotationStatus.Complete;var s=this.GetFemoralPoints();var h=this.GetTibialPoints();var m=this.Leg===t.EAlignmentLeg.Left?"L":"R";var d=new n.AnnotationPoint;var u;if(s!==null&&h!==null){if(s.length===3&&h.length===2){this.drawComponentLine(s[0],s[1]);this.drawComponentLine(s[2],s[1]);this.drawComponentLine(h[1],h[0]);d.X=h[1].X-30;d.Y=h[1].Y+40;u=this.Leg===t.EAlignmentLeg.Right?e.Colors.Pomegranate:e.Colors.BelizeHole;this.drawTextWithBackground(o,m,d,u,"#fff")}this.calculateAngles(s,h);var p=new n.AnnotationPoint(new e.Point((s[0].X+s[1].X)/2,(s[0].Y+s[1].Y)/2));var c=new n.AnnotationPoint(new e.Point((h[0].X+h[1].X)/2,(h[0].Y+h[1].Y)/2));var A=new n.AnnotationPoint(new e.Point((s[1].X+s[2].X)/2,(s[1].Y+s[2].Y)/2));var C=new n.Vector2D(this.CenterOfKnee,p);var S=new n.Vector2D(this.CenterOfKnee,A);var g=new n.Vector2D(this.CenterOfKnee,c);var I=.5*Math.min(S.Norm(),g.Norm());var P=.5*Math.min(C.Norm(),g.Norm());var f=S.Clone().Add(g);f.Calculate();var w=C.Clone().Add(g);w.Calculate();this.drawCircle(o,this.CenterOfKnee,6);o.setLineDash([40,2]);if(this.Leg===t.EAlignmentLeg.Right){this.drawArc(o,this.CenterOfKnee,P,C.AngleRad(),g.AngleRad());this.drawArc(o,this.CenterOfKnee,I,g.AngleRad(),S.AngleRad())}else{this.drawArc(o,this.CenterOfKnee,P,g.AngleRad(),C.AngleRad());this.drawArc(o,this.CenterOfKnee,I,S.AngleRad(),g.AngleRad())}this.drawText(o,this.AngleAKAA.toFixed(1).toString(),f.Normalize().ScalarMult(I*1.2).P2,e.Colors.SunFlower);this.drawText(o,this.AngleMKAA.toFixed(1).toString(),w.Normalize().ScalarMult(P*1.2).P2,e.Colors.SunFlower);var b=C.Clone().ScalarMult(2.1);var v=S.Clone().ScalarMult(2.1);this.drawText(o,"HC",b.P2,e.Colors.SunFlower);this.drawText(o,"FS",v.P2,e.Colors.SunFlower)}else{if(this.Points["FemoralPoints"]){this.Points["FemoralPoints"].forEach(((t,e,n)=>{this.drawEndPointCircle(o,t,8);if(n.length>=2){this.drawSegment(o,n[0],n[1]);if(n.length===3)this.drawSegment(o,n[1],n[2])}}))}if(this.Points["TibialPoints"]){this.Points["TibialPoints"].forEach(((l,a,r)=>{this.drawEndPointCircle(o,l,8);if(r.length===2){this.drawSegment(o,r[0],r[1]);d=new n.AnnotationPoint;d.X=r[1].X-25;d.Y=r[1].Y+40;u=this.Leg===t.EAlignmentLeg.Right?e.Colors.Pomegranate:e.Colors.BelizeHole;this.drawTextWithBackground(o,m,d,u,"#fff")}}))}}var T=this.GetTKAFemoralPoints();var F=this.GetTKATibialPoints();var O=new n.Vector2D;var L=new n.Vector2D;if(T!==null&&F!==null){if(T.length===2&&F.length===2){if(this.InitialTee===true){O=this.calculateTee(T[1],T[0]);L=this.calculateTee(F[0],F[1]);this.Points["TKAFemoralTeePoints"][0]=O.P1;this.Points["TKAFemoralTeePoints"][1]=O.P2;this.Points["TKATibialTeePoints"][0]=L.P1;this.Points["TKATibialTeePoints"][1]=L.P2;this.InitialTee=false}else{O.P1=this.Points["TKAFemoralTeePoints"][0];O.P2=this.Points["TKAFemoralTeePoints"][1];L.P1=this.Points["TKATibialTeePoints"][0];L.P2=this.Points["TKATibialTeePoints"][1];var E=new n.AnnotationPoint;if(this.TkaFemoralTeeEdit===true){E=this.calculateOppositeTee(T[1],this.Points["TKAFemoralTeePoints"][this.IndexPointDrag]);if(this.IndexPointDrag===0){O.P2=E;this.Points["TKAFemoralTeePoints"][1]=O.P2}else{O.P1=E;this.Points["TKAFemoralTeePoints"][0]=O.P1}this.TkaFemoralEdit=false}if(this.TkaTibialTeeEdit===true){E=this.calculateOppositeTee(F[0],this.Points["TKATibialTeePoints"][this.IndexPointDrag]);if(this.IndexPointDrag===0){L.P2=E;this.Points["TKATibialTeePoints"][1]=L.P2}else{L.P1=E;this.Points["TKATibialTeePoints"][0]=L.P1}this.TkaTibialEdit=false}if(this.TkaFemoralEdit===true){if(this.IndexPointDrag===1){O.P1=this.VectorTeeT1.AddVectorToAnnotationPoint(this.Points["TKAFemoralPoints"][1]);O.P2=this.VectorTeeT2.AddVectorToAnnotationPoint(this.Points["TKAFemoralPoints"][1]);O.Calculate();this.Points["TKAFemoralTeePoints"][1]=O.P1;this.Points["TKAFemoralTeePoints"][0]=O.P2}this.TkaFemoralEdit=false}if(this.TkaTibialEdit===true){if(this.IndexPointDrag===0){L.P1=this.VectorTeeT1.AddVectorToAnnotationPoint(this.Points["TKATibialPoints"][0]);L.P2=this.VectorTeeT2.AddVectorToAnnotationPoint(this.Points["TKATibialPoints"][0]);L.Calculate();this.Points["TKATibialTeePoints"][0]=L.P1;this.Points["TKATibialTeePoints"][1]=L.P2}this.TkaTibialEdit=false}}this.drawComponentLine(T[0],T[1]);this.drawComponentLine(F[0],F[1]);this.drawComponentLineEndp(O.P1,T[1]);this.drawComponentLineEndp(T[1],O.P2);this.drawComponentLineEndp(L.P1,F[0]);this.drawComponentLineEndp(F[0],L.P2);d.X=F[1].X-30;d.Y=F[1].Y+40;u=this.Leg===t.EAlignmentLeg.Right?e.Colors.Pomegranate:e.Colors.BelizeHole;this.drawTextWithBackground(o,m,d,u,"#fff");this.VectorTeeF1=new n.Vector2D(T[1],this.Points["TKAFemoralTeePoints"][0]);this.VectorTeeF2=new n.Vector2D(T[1],this.Points["TKAFemoralTeePoints"][1]);this.VectorTeeT1=new n.Vector2D(F[0],this.Points["TKATibialTeePoints"][0]);this.VectorTeeT2=new n.Vector2D(F[0],this.Points["TKATibialTeePoints"][1]);var x=new n.Vector2D(T[1],T[0]);var y=new n.Vector2D(F[0],F[1]);var M=Math.min(x.Norm()/2,this.VectorTeeF1.Norm()/2);var D=Math.min(y.Norm()/2,this.VectorTeeT1.Norm()/2);var R=x.Clone().Add(this.VectorTeeF1);R.Calculate();var V=y.Clone().Add(this.VectorTeeT1);V.Calculate();if(this.Leg===t.EAlignmentLeg.Right){this.drawArc(o,T[1],M,this.VectorTeeF2.AngleRad(),x.AngleRad());this.drawArc(o,F[0],D,y.AngleRad(),this.VectorTeeT1.AngleRad())}else{this.drawArc(o,T[1],M,x.AngleRad(),this.VectorTeeF1.AngleRad());this.drawArc(o,F[0],D,this.VectorTeeT2.AngleRad(),y.AngleRad())}}this.calculateTKAangles(T,F);this.drawCircle(o,this.TKACenterOfKnee,6);this.drawText(o,this.TKAangleFemoral.toFixed(1).toString(),R.Normalize().ScalarMult(M*1.2).P2,e.Colors.SunFlower);this.drawText(o,this.TKAangleTibial.toFixed(1).toString(),V.Normalize().ScalarMult(D*1.2).P2,e.Colors.SunFlower)}else{if(this.Points["TKAFemoralPoints"]){this.Points["TKAFemoralPoints"].forEach(((t,e,n)=>{this.drawEndPointCircle(o,t,8);if(n.length>=2){this.drawSegment(o,n[0],n[1])}}))}if(this.Points["TKATibialPoints"]){this.Points["TKATibialPoints"].forEach(((l,a,r)=>{this.drawEndPointCircle(o,l,8);if(r.length>=2){this.drawSegment(o,r[0],r[1]);d=new n.AnnotationPoint;d.X=r[1].X-25;d.Y=r[1].Y+40;u=this.Leg===t.EAlignmentLeg.Right?e.Colors.Pomegranate:e.Colors.BelizeHole;this.drawTextWithBackground(o,m,d,u,"#fff")}}))}}if(this.Points["FemoralPoints"]){this.Points["FemoralPoints"].forEach(((t,e,n)=>{this.drawEndPointCircle(o,t,8)}))}if(this.Points["TibialPoints"]){this.Points["TibialPoints"].forEach(((t,e,n)=>{this.drawEndPointCircle(o,t,8)}))}if(this.Points["TKAFemoralPoints"]){this.Points["TKAFemoralPoints"].forEach(((t,e,n)=>{this.drawEndPointCircle(o,t,8)}))}if(this.Points["TKATibialPoints"]){this.Points["TKATibialPoints"].forEach(((t,e,n)=>{this.drawEndPointCircle(o,t,8)}))}if(r&&this.Selected){this.DrawGrips()}}GetFemoralPoints(){if(this.Points["FemoralPoints"]!==undefined&&this.Points["FemoralPoints"].length===3){return this.Points["FemoralPoints"]}else{return null}}GetTibialPoints(){if(this.Points["TibialPoints"]!==undefined&&this.Points["TibialPoints"].length===2){return this.Points["TibialPoints"]}else{return null}}GetTKAFemoralPoints(){if(this.Points["TKAFemoralPoints"]!==undefined&&this.Points["TKAFemoralPoints"].length===2){return this.Points["TKAFemoralPoints"]}else{return null}}GetTKATibialPoints(){if(this.Points["TKATibialPoints"]!==undefined&&this.Points["TKATibialPoints"].length===2){return this.Points["TKATibialPoints"]}else{return null}}HitTest(t,o){try{for(const e in this.Points){if(this.Points.hasOwnProperty(e)){const a=this.Points[e];for(var l=0;l<a.length;l++){if(l+1<a.length){if(n.Geometry.PointToLine(t.X,t.Y,a[l].X,a[l].Y,a[l+1].X,a[l+1].Y)<o){return{isFound:true,groupName:e,endRangePoints:l+","+l+"-"+(l+1)+","+(l+1)}}}}}}}catch(t){e.Utils.DebugConsoleLog("Alignmenttool HitTest error.")}return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(t){return false}MeasureAnnotation(t,e,n){}DrawGrips(t){var e=this.Points["FemoralPoints"];var n=this.Points["TibialPoints"];var o=this.Points["TKAFemoralPoints"];var l=this.Points["TKATibialPoints"];var a=this.Context.Viewport.ViewportElement.getContext("2d");var r=Math.abs(this.Context.ScaleX);if(e!==undefined)this.Context.Viewport.AnnotationManager.DrawGrips(a,e,r);if(n!==undefined)this.Context.Viewport.AnnotationManager.DrawGrips(a,n,r);if(o!==undefined)this.Context.Viewport.AnnotationManager.DrawGrips(a,o,r);if(l!==undefined)this.Context.Viewport.AnnotationManager.DrawGrips(a,l,r)}DrawSnaps(){}Serialize(){var t={Id:this.Id,Author:this.Author,Date:this.Date,Points:this.Points,Type:this.Type,Status:this.Status,TextboxLabel:this.TextboxLabel,Name:this.Name,Plugin:this.Plugin,ImageGuid:this.Context.ImageEntity.ImageGUID,MCTEval:this.MCTEval,ACTEval:this.ACTEval,AngleMKAA:this.AngleMKAA,AngleAKAA:this.AngleAKAA,AngleMCT:this.AngleMCT,AngleACT:this.AngleACT,TKAangleFemoral:this.TKAangleFemoral,TKAangleTibial:this.TKAangleTibial,TKAFemoralEval:this.TKAFemoralEval,TKATibialEval:this.TKATibialEval,LegSide:this.Leg,Namespace:this.Namespace,InitialTee:this.InitialTee,AnnotationIDBilateral:this.AnnotationIDBilateral,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};var e=JSON.stringify(t);return e}Deserialize(t){var e;var o=JSON.parse(t);this.Id=o["Id"]||o["id"];this.Author=o["Author"]||o["author"];this.Date=o["Date"]||o["date"];this.Plugin=o["Plugin"]||o["plugin"];var l=o["Points"]||o["points"];this.Points=n.AnnotationController.ConvertSamplePoints(l);this.Type=o["Type"]||o["type"];this.Status=o["Status"]||o["status"];this.TextboxLabel=o["TextboxLabel"]||o["TextboxLabel"];this.Name=o["Name"]||o["name"];this.ColsOrigin=parseInt(o["ColsOrigin"]||o["colsOrigin"]);this.RowsOrigin=parseInt(o["RowsOrigin"]||o["rowsOrigin"]);this.MCTEval=o["MCTEval"]||o["mCTEval"];this.ACTEval=o["ACTEval"]||o["aCTEval"];this.AngleMKAA=o["AngleMKAA"]||o["angleMKAA"];this.AngleAKAA=o["AngleAKAA"]||o["angleAKAA"];this.AngleMCT=o["AngleMCT"]||o["angleMCT"];this.AngleACT=o["AngleACT"]||o["angleACT"];this.TKAangleFemoral=o["TKAangleFemoral"]||o["TKAangleFemoral"];this.TKAangleTibial=o["TKAangleTibial"]||o["TKAangleTibial"];this.TKAFemoralEval=o["TKAFemoralEval"]||o["TKAFemoralEval"];this.TKATibialEval=o["TKATibialEval"]||o["TKATibialEval"];this.Leg=o["LegSide"];this.InitialTee=o["InitialTee"]||o["InitialTee"];this.AnnotationIDBilateral=(e=o["AnnotationIDBilateral"])!==null&&e!==void 0?e:o["annotationIDBilateral"];this.Selected=o["Selected"]||o["selected"];this.Plugin=o["Plugin"]||o["plugin"]}ConvertPointsWithFactororResolution(t){}GetTemplate(){var e=t.ResourceBag.AlignmentToolTemplateJson;return e}DrawIsValid(){return true}EvaluatePointDragMoveAndEnd(t,e,n){this.TkaFemoralTeeEdit=false;this.TkaTibialTeeEdit=false;this.TkaFemoralEdit=false;this.TkaTibialEdit=false;if(e==="TKAFemoralTeePoints"){this.TkaFemoralTeeEdit=true}if(e==="TKATibialTeePoints"){this.TkaTibialTeeEdit=true}if(e==="TKAFemoralPoints"){this.TkaFemoralEdit=true}if(e==="TKATibialPoints"){this.TkaTibialEdit=true}this.IsEditionMode=true;this.IndexPointDrag=n;this.TemporalCurrentGroupName=e;return this.IsEditionMode}DonePointDragMoveAndEnd(t,e,n){}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;t.textAlign="center";t.textBaseline="bottom";t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Alizarin;if(this.TemporalCurrentGroupName==="FemoralPoints"){var a=this.Points["FemoralPoints"];if(a.length===1)this.drawComponentLine(a[0],this.TemporalPoint);else if(a.length===2)this.drawComponentLine(a[1],this.TemporalPoint)}else if(this.TemporalCurrentGroupName==="TibialPoints"){var r=this.Points["TibialPoints"];if(r.length===1)this.drawComponentLine(r[0],this.TemporalPoint)}if(this.TemporalCurrentGroupName==="TKAFemoralPoints"){var s=this.Points["TKAFemoralPoints"];if(s.length===1)this.drawComponentLine(s[0],this.TemporalPoint);else if(s.length===2)this.drawComponentLine(s[1],this.TemporalPoint)}else if(this.TemporalCurrentGroupName==="TKATibialPoints"){var h=this.Points["TKATibialPoints"];if(h.length===1)this.drawComponentLine(h[0],this.TemporalPoint)}}drawComponentLine(t,n){try{var o=this.Context.Viewport.ViewportElement.getContext("2d");this.drawSegment(o,t,n);this.drawEndPointCircle(o,t,8)}catch(t){e.Utils.DebugConsoleLog("error on view")}}drawComponentLineEndp(t,n){try{var o=this.Context.Viewport.ViewportElement.getContext("2d");this.drawSegment(o,t,n);this.drawEndPointCircle(o,t,8);this.drawEndPointCircle(o,n,8)}catch(t){e.Utils.DebugConsoleLog("error on view")}}drawArc(t,n,o,l,a){t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.SunFlower;t.beginPath();t.setLineDash([]);t.arc(n.X,n.Y,o,l,a,false);t.stroke();t.closePath()}calculateAngles(o,l){this.CenterOfKnee=new n.AnnotationPoint(new e.Point((o[1].X+l[0].X)/2,(o[1].Y+l[0].Y)/2));var a=new n.Vector2D(this.CenterOfKnee,o[0]);var r=new n.Vector2D(this.CenterOfKnee,o[2]);var s=new n.Vector2D(this.CenterOfKnee,l[1]);if(this.Leg===t.EAlignmentLeg.Right){if(s.EvaluateSideOfPoint(a.P2)===-1){this.AngleMKAA=a.Angle2VectorsDeg(s)}else{this.AngleMKAA=360-a.Angle2VectorsDeg(s)}if(s.EvaluateSideOfPoint(r.P2)===-1){this.AngleAKAA=r.Angle2VectorsDeg(s)}else{this.AngleAKAA=r.Angle2VectorsDeg(s)}}else{if(s.EvaluateSideOfPoint(a.P2)===-1){this.AngleMKAA=360-a.Angle2VectorsDeg(s)}else{this.AngleMKAA=a.Angle2VectorsDeg(s)}if(s.EvaluateSideOfPoint(r.P2)===-1){this.AngleAKAA=r.Angle2VectorsDeg(s)}else{this.AngleAKAA=r.Angle2VectorsDeg(s)}}this.AngleMCT=180-this.AngleMKAA;this.AngleACT=180-this.AngleAKAA;this.MCTEval=this.evalAngleMTC();this.ACTEval=this.evalAngleATC()}calculateTKAangles(o,l){this.TKACenterOfKnee=new n.AnnotationPoint(new e.Point((o[1].X+l[0].X)/2,(o[1].Y+l[0].Y)/2));if(o!==null&&l!==null){if(o.length===2&&l.length===2){if(this.Points["TKAFemoralTeePoints"].length===2){var a=new n.Vector2D(o[0],o[1]);var r=new n.Vector2D(this.Points["TKAFemoralTeePoints"][0],this.Points["TKAFemoralTeePoints"][1]);if(this.Leg===t.EAlignmentLeg.Right){this.TKAangleFemoral=180-a.Angle2VectorsDeg(r)}else{this.TKAangleFemoral=a.Angle2VectorsDeg(r)}this.TKAFemoralEval=this.evalTKAfemoral();this.TKACa=90-this.TKAangleFemoral}if(this.Points["TKATibialTeePoints"].length===2){var s=new n.Vector2D(l[1],l[0]);var h=new n.Vector2D(this.Points["TKATibialTeePoints"][0],this.Points["TKATibialTeePoints"][1]);if(this.Leg===t.EAlignmentLeg.Right){this.TKAangleTibial=s.Angle2VectorsDeg(h)}else{this.TKAangleTibial=180-s.Angle2VectorsDeg(h)}this.TKATibialEval=this.evalTKAtibial();this.TKACb=90-this.TKAangleTibial}}}}calculateOppositeTee(t,e){var o=new n.Vector2D(e,t);return o.Clone().AddVectorToAnnotationPoint(t)}calculateTee(t,e){var o=new n.Vector2D(t,e);var l=o.Clone().Orthogonal().ScalarMult(this.TeeScale);var a=this.calculateOppositeTee(t,l.P2);return new n.Vector2D(l.P2,a)}evalAngleTKA(t){var e;if(Math.abs(t-90)<=1){e=o.Neutral}else if(t<90){e=o.Valgus}else{e=o.Varus}return e}evalAngle(t){var e;if(Math.abs(t-180)<=1){e=o.Neutral}else if(t>180){e=o.Valgus}else{e=o.Varus}return e}evalAngleMTC(){return this.evalAngle(this.AngleMKAA)}evalAngleATC(){return this.evalAngle(this.AngleAKAA)}evalTKAfemoral(){return this.evalAngleTKA(this.TKAangleFemoral)}evalTKAtibial(){return this.evalAngleTKA(this.TKAangleTibial)}drawSegment(n,o,l){try{n.strokeStyle=this.Selected?e.Colors.Emerald:this.Leg===t.EAlignmentLeg.Right?e.Colors.Pomegranate:e.Colors.BelizeHole;n.beginPath();n.dashedLine(n,o.X,o.Y,l.X,l.Y,0);n.stroke();n.closePath()}catch(t){e.Utils.DebugConsoleLog("error on view")}}drawText(t,e,n,o){var l=Math.abs(this.Context.ScaleX);var a=16/l;t.save();t.beginPath();t.strokeStyle=o;this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,0,0,n.X+30,n.Y+20,e,a);t.restore()}drawTextWithBackground(t,e,n,o,l){var a=Math.abs(this.Context.ScaleX);var r=16/a;t.save();t.fillStyle=o;t.beginPath();t.rect(n.X,n.Y,60,40);t.fill();t.strokeStyle=l;this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,0,0,n.X+30,n.Y+20,e,r);t.restore()}drawCircle(t,n,o){try{t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.SunFlower;t.beginPath();t.arc(n.X,n.Y,o,0,2*Math.PI,false);t.stroke();t.closePath()}catch(t){e.Utils.DebugConsoleLog("error on view")}}drawEndPointCircle(n,o,l){try{n.strokeStyle=this.Selected?e.Colors.Emerald:this.Leg===t.EAlignmentLeg.Right?e.Colors.Pomegranate:e.Colors.BelizeHole;n.beginPath();n.arc(o.X,o.Y,l,0,2*Math.PI,false);n.stroke();n.closePath()}catch(t){e.Utils.DebugConsoleLog("error on view")}}}t.AlignmentToolAnnotation=AlignmentToolAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class AngleToolAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Vectors={};this.IsEditionMode=false;this.ShowSnaps=false;this.FirstTime=false;this.EntitiesSelected=0;this.LinesSelected=[];this.referenceAnnotationId=[]}Render(){var t=this.Context.Viewport.ViewportElement.getContext("2d");if(!this.Visible)return;if(this.Status===n.EAnnotationStatus.Complete){this.fillReferenceObject()}if(this.LinesSelected.length===2||this.FirstTime){this.referenceAnnotationId[0]=this.LinesSelected[0].Id;this.referenceAnnotationId[1]=this.LinesSelected[1].Id;var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r=5/o;t.save();t.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;t.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;t.strokeStyle=this.Selected===true?e.Colors.Emerald:t.strokeStyle;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";var s=this.LinesSelected[0];var h=this.LinesSelected[1];var m=new n.Vector2D(s.Points["EndPoints"][0],s.Points["EndPoints"][1]);var d=new n.Vector2D(h.Points["EndPoints"][0],h.Points["EndPoints"][1]);var u=new n.Line2D(m.P1,m);var p=new n.Line2D(d.P1,d);var c=new n.AnnotationPoint(u.Intersection(p));m=n.Geometry.ReorientedVector(c,m.Clone());d=n.Geometry.ReorientedVector(c,d.Clone());var A=n.Geometry.CalculateProjectionPoint(m.P1,d.P1,c);var C=n.Geometry.CalculateProjectionPoint(c,d.P1,m.P1);var S=new n.Line2D(c,new n.Vector2D(c,A));var g=new n.Line2D(m.P1,new n.Vector2D(m.P1,C));var I=new n.AnnotationPoint(S.Intersection(g));var P=m.Angle2VectorsDeg(d);if(!this.IsEditionMode){this.Points["LabelPoint"]=[];this.Points["LabelPoint"][0]=I;this.IsEditionMode=true}this.drawCircle(t,c,r/2);this.drawCircle(t,this.Points["LabelPoint"][0],r);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawDashedLine(t,c,this.Points["LabelPoint"][0]);this.drawDashedLine(t,c,m.P1);this.drawDashedLine(t,c,d.P1);var f=parseFloat(P.toFixed(1))+"°";var w=10/o;var b=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,this.Points["LabelPoint"][0].X-w,this.Points["LabelPoint"][0].Y-w,this.Points["LabelPoint"][0].X+w,this.Points["LabelPoint"][0].Y+w,f,a);this.TextboxLabel[0]={X0:b.X0,X1:b.X1,Y0:b.Y0,Y1:b.Y1,Text:f};this.FirstTime=true;t.restore()}}DrawIsValid(){var t=true;return t}HitTest(t,e){return{isFound:false,groupName:null,endRangePoints:""}}DrawGrips(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["OffsetPoint"];var o=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(t,n,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,o,e)}DrawSnaps(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(t,n,e)}EvaluateAnnotationTextInCanvas(t){if(this.TextboxLabel&&this.TextboxLabel.length>=1){return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],t)}return false}MeasureAnnotation(t,e){var n;return n}SearchSelected(){var t;t=this.Context.Viewport.CountingSelectedLinesAnnotations();let e=this.ValidateAngleBetweenLines(t);let n=0;if(e>0&&!isNaN(e)){if(t.length>=2){this.LinesSelected=t;n=t.length}}return{linesCount:n,arrayAnnots:t}}ValidateAngleBetweenLines(t){var e=t[0];var o=t[1];var l=new n.Vector2D(e.Points["EndPoints"][0],e.Points["EndPoints"][1]);var a=new n.Vector2D(o.Points["EndPoints"][0],o.Points["EndPoints"][1]);var r=new n.Line2D(l.P1,l);var s=new n.Line2D(a.P1,a);var h=new n.AnnotationPoint(r.Intersection(s));l=n.Geometry.ReorientedVector(h,l.Clone());a=n.Geometry.ReorientedVector(h,a.Clone());var m=l.Angle2VectorsDeg(a);return m}GetTemplate(){var e=t.ResourceBag.AngleToolTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){if(e==="EndPoints"||e==="OffsetPoint"){}return true}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"],ReferenceAnnotationId:this.referenceAnnotationId};t=JSON.stringify(e);return t}Deserialize(t){var e;var o=JSON.parse(t);this.Id=o["Id"]||o["id"];this.Author=o["Author"]||o["author"];this.Date=o["Date"]||o["date"];this.Type=o["Type"]||o["type"];this.Plugin=o["Plugin"]||o["plugin"];this.Selected=o["Selected"]||o["selected"];this.Status=o["Status"]||o["status"];this.TextboxLabel=o["TextboxLabel"]||o["textboxLabel"];var l=o["Points"]||o["points"];this.Points=n.AnnotationController.ConvertSamplePoints(l);this.referenceAnnotationId=(e=o["ReferenceAnnotationId"])!==null&&e!==void 0?e:o["referenceAnnotationId"];this.Name=o["Name"]||o["name"];this.ColsOrigin=parseInt(o["ColsOrigin"]||o["colsOrigin"]);this.RowsOrigin=parseInt(o["RowsOrigin"]||o["rowsOrigin"])}ConvertPointsWithFactororResolution(t){}drawCircle(t,e,n){t.beginPath();t.setLineDash([]);t.arc(e.X,e.Y,n,0,2*Math.PI,true);t.stroke();t.closePath()}drawDashedLine(t,e,n){t.beginPath();t.setLineDash([5,15]);t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}fillSnapPoints(){var t=this.Points["OffsetPoint"];this.Points["SnapPoints"]=new Array;this.Points["SnapPoints"].push(t[0]);this.DrawSnaps()}fillReferenceObject(){if(this.LinesSelected.length===0){if(this.referenceAnnotationId){this.referenceAnnotationId.forEach((t=>{var e=this.Context.Viewport.AnnotationManager.GetAnnotationPerId(t);if(e){this.LinesSelected.push(e)}}))}}}}t.AngleToolAnnotation=AngleToolAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class AngularLineAnnotation{constructor(){this.TextboxLabel=new Array;this.TextboxAngleLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["ReferencePoints"]=new Array;this.Points["IntersectionPoint"]=new Array;this.Points["Label"]=new Array;this.Points["LabelAngle"]=new Array;this.SnapPoints=new Array;this.Vectors={};this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsEditionMode=false;this.IsEditionReferenceMode=false;this.IndexPointDrag=0;this.INeedOtherPoint=false;this.IsReferable=false;this.FactorScale=1;this.isRestore=false}Render(){if(!this.Visible)return;var t;try{t=this.Context.Viewport.ViewportElement.getContext("2d");this.isRestore=false;t.save();var o=Math.abs(this.Context.ScaleX);var l=16/o;var a=5/o;var r=Math.round(11/o*10)/10;t.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;t.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;t.strokeStyle=this.Selected===true?e.Colors.Emerald:t.strokeStyle;t.font=r+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var s=this.Points["EndPoints"];var h=new n.AnnotationPoint;var m=this.Points["Label"];var d=this.Points["LabelAngle"];if(this.Status===n.EAnnotationStatus.Complete){if(this.ReferenceAnnotation===undefined){this.fillReferenceObject()}}if(s.length===2){this.INeedOtherPoint=false}if(this.ReferenceAnnotation!==null&&this.ReferenceAnnotation!==undefined){this.Points["ReferencePoints"]=this.ReferenceAnnotation.annotation.Points["EndPoints"];var u=new n.Vector2D(this.Points["ReferencePoints"][0],this.Points["ReferencePoints"][1]);var p=new n.Line2D(this.Points["ReferencePoints"][0],u);h=new n.AnnotationPoint;if(s.length>=2){this.INeedOtherPoint=false;var c=new n.Vector2D(s[0],s[1]);var A=new n.Line2D(s[0],c);h=new n.AnnotationPoint(A.Intersection(p));var C=c.Angle2VectorsDeg90(u);var S=new n.Vector2D;var g=new n.Vector2D;var I=new n.Vector2D;if(this.IsEditionMode){var P=0;if(this.IndexPointDrag===0){P=1}var f=s[this.IndexPointDrag];c=new n.Vector2D(f,s[P]);if(this.IsEditionReferenceMode){u=new n.Vector2D(this.Points["ReferencePoints"][this.IndexPointDrag],this.Points["ReferencePoints"][P])}p=new n.Line2D(this.Points["ReferencePoints"][this.IndexPointDrag],u);if(this.IsEditionMode){c=new n.Vector2D(f,s[P])}A=new n.Line2D(s[this.IndexPointDrag],c);h=new n.AnnotationPoint(A.Intersection(p))}var w=new n.Vector2D(h,u.P1);var b=new n.Vector2D(h,u.P2);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;if(w.Norm()>=u.Norm()||b.Norm()>=u.Norm()){if(w.Norm()>=u.Norm()){this.drawDashedLine(t,h,u.P2)}if(b.Norm()>=u.Norm()){this.drawDashedLine(t,h,u.P2)}}this.drawLine(t,s[0],s[1]);var v=new n.Vector2D(h,c.P1);var T=new n.Vector2D(h,c.P2);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;if(v.Norm()<T.Norm()){this.drawDashedLine(t,h,v.P2)}else{this.drawDashedLine(t,h,T.P2)}t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Amethyst;this.drawCircle(t,c.P1,a);this.drawCircle(t,c.P2,a);S=new n.Vector2D(h,u.P1);g=new n.Vector2D(h,u.P2);I=new n.Vector2D(h,s[0]);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;if(S.EvaluateSideOfPoint(I.P2)===-1&&I.EvaluateSideOfPoint(S.P2)===1){if(S.Angle2Vectors(I)>Math.PI/2){this.drawArc(t,h,5*a,g.Clone().AngleRad(),I.Clone().AngleRad())}else{this.drawArc(t,h,5*a,I.Clone().AngleRad(),S.AngleRad())}}if(S.EvaluateSideOfPoint(I.P2)===1&&I.EvaluateSideOfPoint(S.P2)===-1){if(S.Angle2Vectors(I)>Math.PI/2){this.drawArc(t,h,5*a,I.Clone().AngleRad(),g.Clone().AngleRad())}else{this.drawArc(t,h,5*a,S.AngleRad(),I.Clone().AngleRad())}}this.drawCircle(t,h,a);if(this.Status===n.EAnnotationStatus.Complete){if(s.length===2){this.DrawTextLabel(t,s[0],s[1]);var F=u.Clone().Normalize().ScalarMult(25).AddVectorToAnnotationPoint(h);this.DrawAngTextLabel(t,h,F)}if(m.length>0){var O=(s[0].X+s[1].X)/2;var L=(s[0].Y+s[1].Y)/2;if(s[1].X!==m[0].X||s[1].Y!==m[0].Y){t.dashedLine(t,O,L,m[0].X,m[0].Y,3/o)}var E=this.MeasureAnnotation(this.Points["EndPoints"][0],this.Points["EndPoints"][1]);var x=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,O,L,m[0].X,m[0].Y,E,l);this.TextboxLabel[0]={X0:x.X0,X1:x.X1,Y0:x.Y0,Y1:x.Y1,Text:E};this.fillSnapPoints()}if(d.length>0){var O=(s[0].X+s[1].X)/2;var L=(s[0].Y+s[1].Y)/2;if(s[1].X!==d[0].X||s[1].Y!==d[0].Y){t.dashedLine(t,h.X,h.Y,d[0].X,d[0].Y,3/o)}var y=parseFloat(C.toFixed(1))+"º";var M=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,h.X,h.Y,d[0].X,d[0].Y,y,l);this.TextboxAngleLabel[0]={X0:M.X0,X1:M.X1,Y0:M.Y0,Y1:M.Y1,Text:y};this.fillSnapPoints()}}}if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}}t.restore();this.isRestore=true}catch(n){if(!this.isRestore&&t!==undefined)t.restore();e.Utils.DebugConsoleLog("Error drawing AngularLayout Annotation")}}DrawIsValid(){var t=this.Points["EndPoints"];return t.length===2}HitTest(t,e){var o=this.Points["EndPoints"];if(this.ReferenceAnnotation!==null&&this.ReferenceAnnotation!==undefined){if(n.Geometry.PointToLine(t.X,t.Y,o[0].X,o[0].Y,o[1].X,o[1].Y)<e)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"}}return{isFound:false,groupName:null,endRangePoints:""}}DrawGrips(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["IntersectionPoint"];var l=this.Points["Label"];var a=this.Points["LabelAngle"];this.Context.Viewport.AnnotationManager.DrawGrips(t,n,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,o,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,l,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,a,e)}DrawSnaps(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(t,n,e)}EvaluateAnnotationTextInCanvas(t){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],t);return false}MeasureAnnotation(t,e){var n=this.Context.ImageEntity["pixelSpacing"][0];var o=this.Context.ImageEntity["pixelSpacing"][1];var l=this.Context.ImageEntity["pixelSpacing"][2];var a=this.Points["EndPoints"];if(t===undefined||t===null)t=a[0];if(e===undefined||e===null)e=a[1];var r=t.X*n;var s=t.Y*o;var h=e.X*n;var m=e.Y*o;var d=Math.sqrt((h-r)*(h-r)+(m-s)*(m-s));var u=parseFloat(d.toFixed(1))+" "+l;return u}GetTemplate(){var e=t.ResourceBag.AngularLineTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){var o;if(e==="EndPoints"){this.IsEditionMode=true}if(e==="IntersectionPoint"){this.IsEditionMode=true}if(e==="ReferencePoints"){this.IsEditionReferenceMode=true}this.IndexPointDrag=n;return this.IsEditionMode}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,TextboxLabel:this.TextboxLabel,TextboxAngleLabel:this.TextboxAngleLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,IsEditionMode:this.IsEditionMode,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"],ReferenceId:this.ReferenceAnnotation.annotation.Id,ReferenceAnnotationGroupName:this.ReferenceAnnotation.groupName};t=JSON.stringify(e);return t}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Date=e["Date"]||e["date"];this.Type=e["Type"]||e["type"];this.Plugin=e["Plugin"]||e["plugin"];this.Selected=e["Selected"]||e["selected"];this.Status=e["Status"]||e["status"];this.TextboxLabel=e["TextboxLabel"]||e["textboxLabel"];this.TextboxAngleLabel=e["TextboxAngleLabel"]||e["textboxAngleLabel"];this.IsEditionMode=e["IsEditionMode"]||e["IsEditionMode"];var o=e["Points"]||e["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=e["Name"]||e["name"];this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"]);this.referenceAnnotationId=e["ReferenceId"]||e["referenceId"];this.referenceAnnotationGroupName=e["ReferenceAnnotationGroupName"]||e["referenceAnnotationGroupName"]}ConvertPointsWithFactororResolution(t){}DrawTextLabel(t,e,o){var l=this.Points["Label"];var a=Math.abs(this.Context.ScaleX);t.dashedLine(t,e.X,e.Y,o.X,o.Y,0);var r=(e.X+o.X)/2;var s=(e.Y+o.Y)/2;var h=40/a;var m=(o.Y-e.Y)/(o.X-e.X);var d=-1/m;var u=s-d*r;var p=Math.floor(Math.abs(m));if(l===undefined||l===null||l!==undefined&&l!==null&&l.length===0){this.Points["Label"][0]=new n.AnnotationPoint;if(p===0){h=40/a;if(m!==0){this.Points["Label"][0].Y=s+(d<0?-h:h);this.Points["Label"][0].X=(this.Points["Label"][0].Y-u)/d}else{this.Points["Label"][0].Y=s-h;this.Points["Label"][0].X=r}}else{this.Points["Label"][0].X=r+(d<0?-h:h);this.Points["Label"][0].Y=d*this.Points["Label"][0].X+u}}}DrawAngTextLabel(t,e,o){var l=this.Points["LabelAngle"];var a=Math.abs(this.Context.ScaleX);t.dashedLine(t,e.X,e.Y,o.X,o.Y,0);var r=(e.X+o.X)/2;var s=(e.Y+o.Y)/2;var h=40/a;var m=(o.Y-e.Y)/(o.X-e.X);var d=-1/m;var u=s-d*r;var p=Math.floor(Math.abs(m));if(l===undefined||l===null||l!==undefined&&l!==null&&l.length===0){this.Points["LabelAngle"][0]=new n.AnnotationPoint;if(p===0){h=40/a;if(m!==0){this.Points["LabelAngle"][0].Y=s+(d<0?-h:h);this.Points["LabelAngle"][0].X=(this.Points["LabelAngle"][0].Y-u)/d}else{this.Points["LabelAngle"][0].Y=s-h;this.Points["LabelAngle"][0].X=r}}else{this.Points["LabelAngle"][0].X=r+(d<0?-h:h);this.Points["LabelAngle"][0].Y=d*this.Points["LabelAngle"][0].X+u}}}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=5/o;var a=this.Points["EndPoints"];var r=this.Points["IntersectionPoint"][0];if(a.length===1){t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Amethyst;this.drawCircle(t,a[0],l)}if(a.length>2){var s=new n.Vector2D(a[0],a[1]);var h=new n.Vector2D(this.Points["ReferencePoints"][0],this.Points["ReferencePoints"][1]);var m=new n.Line2D(a[0],s);var d=new n.Line2D(this.Points["ReferencePoints"][0],h);r=new n.AnnotationPoint(m.Intersection(d));var u=a[this.IndexPointDrag];var p=0;this.Points["EndPoints"]=new Array;t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.PeterRiver;if(this.IsEditionMode){if(this.IndexPointDrag===0)p=1;s=new n.Vector2D(u,a[p]);var c=new n.Line2D(a[0],s);r=new n.AnnotationPoint(c.Intersection(d));this.drawLine(t,a[p],this.TemporalPoint);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawDashedLine(t,r,a[p])}else{t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;var A=new n.Vector2D(r,h.P1);var C=new n.Vector2D(r,this.TemporalPoint);this.drawLine(t,s.P1,this.TemporalPoint);if(A.Norm()>=h.Norm()||C.Norm()>=h.Norm()){if(A.Norm()>=h.Norm()){this.drawDashedLine(t,r,h.P2)}if(C.Norm()>=h.Norm()){this.drawDashedLine(t,r,h.P2)}}this.drawLine(t,a[0],a[1])}t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Amethyst;this.drawCircle(t,r,l);this.drawCircle(t,s.P1,l);this.drawCircle(t,s.P2,l);var S=new n.Vector2D(r,h.P1);var g=new n.Vector2D(r,h.P2);var I=new n.Vector2D(r,a[0]);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;if(S.Norm()<g.Norm()){this.drawDashedLine(t,r,S.P2)}else{this.drawDashedLine(t,r,g.P2)}this.drawLine(t,a[0],a[1]);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;if(S.EvaluateSideOfPoint(I.P2)===-1&&I.EvaluateSideOfPoint(S.P2)===1){if(S.Angle2Vectors(I)>Math.PI/2){this.drawArc(t,r,5*l,g.Clone().AngleRad(),I.Clone().AngleRad())}else{this.drawArc(t,r,5*l,I.Clone().AngleRad(),S.AngleRad())}}if(S.EvaluateSideOfPoint(I.P2)===1&&I.EvaluateSideOfPoint(S.P2)===-1){if(S.Angle2Vectors(I)>Math.PI/2){this.drawArc(t,r,5*l,I.Clone().AngleRad(),g.Clone().AngleRad())}else{this.drawArc(t,r,5*l,S.AngleRad(),I.Clone().AngleRad())}}}var P=this.Context.Viewport.AnnotationManager.GetAllAnnotationsNearToPoint(this.TemporalPoint.X,this.TemporalPoint.Y);if(P!==null){P.DrawSnaps()}}drawPreviewLine(t,e,n,o){this.drawDashedLine(t,n.Clone().ScalarMult(o).AddVectorToAnnotationPoint(e),n.Clone().ScalarMult(-o).AddVectorToAnnotationPoint(e))}drawArc(t,e,n,o,l){t.beginPath();t.setLineDash([]);t.arc(e.X,e.Y,n,o,l,false);t.stroke();t.closePath()}drawCircle(t,e,n){t.beginPath();t.setLineDash([]);t.arc(e.X,e.Y,n,0,2*Math.PI,true);t.stroke();t.closePath()}drawDashedLine(t,e,n){t.beginPath();t.setLineDash([5,15]);t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}drawLine(t,e,n){t.beginPath();t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}calculateProjectionPoint(t,e,o){var l=new n.Vector2D(t,e);return l.CalculateProjectionOrthogonal(o)}fillSnapPoints(){var t=this.Points["EndPoints"];this.SnapPoints=new Array;this.SnapPoints.push(t[1]);this.SnapPoints.push(t[0])}fillReferenceObject(){if(this.Points["ReferencePoints"]!==undefined){if(this.referenceAnnotationId){var t=this.Context.Viewport.AnnotationManager.GetAnnotationPerId(this.referenceAnnotationId);if(t){this.ReferenceAnnotation={annotation:t,groupName:this.referenceAnnotationGroupName}}}else{for(var e=0;e<this.Points["ReferencePoints"].length;e++){var n=this.Points["ReferencePoints"][e];var o=this.Context.Viewport.AnnotationManager.GetPointInDetectAnnotation(n,true);if(o!==null){this.ReferenceAnnotation={annotation:o.annotation,groupName:o.group};break}}}}}}t.AngularLineAnnotation=AngularLineAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class CalibrationAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Selected=false;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["SnapPoints"]=new Array;this.UnSelectToExecuteClickOnViewport=true;this.isHighCalibrate=false;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1}Render(){if(!this.Visible)return;var t=this.Context.Viewport;var o=t.ViewportElement.getContext("2d");var l=Math.abs(this.Context.ScaleX);var a=Math.round(11/l*10)/10;o.textAlign="center";o.textBaseline="bottom";o.font=a+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";o.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Alizarin;var r=t.Context.ImageEntity["dicomTags"]["0002_0010"];this.FactorScale=t.GetFactorScaleImageLowOnHigh(this,this.Context.ImageEntity["dicomTags"]["0028_0011"],this.Context.ImageEntity["dicomTags"]["0028_0010"]);if(r!=="1.2.840.10008.1.2.4.50"&&this.HqRatio!==undefined&&!this.isHighCalibrate&&this.Status===n.EAnnotationStatus.Complete){this.XCentroid=this.XCentroid/this.HqRatio;this.YCentroid=this.YCentroid/this.HqRatio;this.Diameter=this.Diameter/this.HqRatio;this.isHighCalibrate=true;this.FactorScale=1}this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;this.MeasureAnnotation();if(this.Value!==null&&this.Value!==undefined){o.lineWidth=1/l;o.beginPath();o.arc(this.XCentroid*this.FactorScale,this.YCentroid*this.FactorScale,this.Diameter*this.FactorScale/2,0,Math.PI/180*360,true);o.stroke();if(this.Value===25.4)t.AnnotationManager.DrawTextUntransformed(o,"1 inch",this.XCentroid*this.FactorScale,this.YCentroid*this.FactorScale);else t.AnnotationManager.DrawTextUntransformed(o,this.Value+"mm",this.XCentroid*this.FactorScale,this.YCentroid*this.FactorScale)}else{if(this.Diameter!==0){o.lineWidth=1/l;o.beginPath();o.arc(this.XCentroid*this.FactorScale,this.YCentroid*this.FactorScale,this.Diameter*this.FactorScale/2,0,Math.PI/180*360,true);o.stroke()}}}HitTest(t,e){return{isFound:this.evalueCalibrationInCanvas(t),groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(t){return false}DrawGrips(){}DrawSnaps(){}DrawIsValid(){var t=false;var e=0;var o=Math.max(this.Context.Viewport.Width,this.Context.Viewport.Height);if(this.Points["EndPoints"].length===3){var l=n.Geometry.CircumCircleThreePoints(this.Points["EndPoints"][0].Clone(),this.Points["EndPoints"][1].Clone(),this.Points["EndPoints"][2].Clone(),o/2);if(l!==null){var a=l.X;var r=l.Y;var e=l.Radius*2;t=e>=1}else t=false}else{if(this.Points["EndPoints"].length===1&&this.Diameter){this.Context.AnnotationController.IsCompleted=true}t=true}return t}MeasureAnnotation(){var t=Math.max(this.Context.Viewport.Width,this.Context.Viewport.Height);try{if(this.Points["EndPoints"].length===3&&(!this.Diameter||this.Diameter<=0)){var o=n.Geometry.CircumCircleThreePoints(this.Points["EndPoints"][0].Clone(),this.Points["EndPoints"][1].Clone(),this.Points["EndPoints"][2].Clone(),t/2);this.Diameter=o.Radius*2;this.XCentroid=o.X;this.YCentroid=o.Y}else if(this.Points["EndPoints"].length===1&&this.Diameter!==0){this.XCentroid=this.Points["EndPoints"][0].Clone().X;this.YCentroid=this.Points["EndPoints"][0].Clone().Y}}catch(t){e.Utils.DebugConsoleLog(t)}}GetTemplate(){var e=t.ResourceBag.CalibrationTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){return true}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Diameter:this.Diameter,Plugin:this.Plugin,Status:this.Status,Id:this.Id,ImageGuid:this.ImageGuid,Name:this.Name,SeriesGuid:this.SeriesGuid,StudyGuid:this.StudyGuid,Value:this.Value,Visible:this.Visible,XCentroid:this.XCentroid,YCentroid:this.YCentroid,Namespace:this.Namespace,ColsOrigin:this.ColsOrigin||this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.RowsOrigin||this.Context.ImageEntity["dicomTags"]["0028_0010"]};t=JSON.stringify(e);return t}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Date=e["Date"]||e["date"];this.Plugin=e["Plugin"]||e["plugin"];this.Status=e["Status"]||e["status"];this.StudyGuid=e["StudyGuid"]||e["studyGuid"];this.SeriesGuid=e["SeriesGuid"]||e["seriesGuid"];this.ImageGuid=e["ImageGuid"]||e["imageGuid"];this.XCentroid=parseFloat(e["XCentroid"]||e["xCentroid"]);this.YCentroid=parseFloat(e["YCentroid"]||e["yCentroid"]);this.Diameter=parseFloat(e["Diameter"]||e["diameter"]);this.Value=parseFloat(e["Value"]||e["value"]);this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"]);var n=e["HqRatio"||e["hqRatio"]];this.HqRatio=n!==undefined?parseFloat(n):undefined;this.Name=e["Name"]||e["name"]}ConvertPointsWithFactororResolution(t){}evalueCalibrationInCanvas(t){var e=n.Viewport.AnnotationThreshold/Math.abs(this.Context.ScaleX);var o=this.Diameter*this.FactorScale/2;var l=Math.abs(this.Context.ScaleX*this.Context.ScaleX);var a=Math.round(11/l*10)/10;var r=this.XCentroid*this.FactorScale-o;var s=this.XCentroid*this.FactorScale+o;var h=this.YCentroid*this.FactorScale-a;var m=this.YCentroid*this.FactorScale;if(t.X>=r&&t.X<=s&&t.Y>=h&&t.Y<=m)return true;var d=this.Diameter*this.FactorScale/2;var u=d;var p=Math.atan2((t.Y-this.YCentroid*this.FactorScale)*Math.abs(d/u),t.X-this.XCentroid*this.FactorScale);var c=this.XCentroid*this.FactorScale+Math.cos(p)*Math.abs(d);var A=this.YCentroid*this.FactorScale+Math.sin(p)*Math.abs(u);var C=t.X-c;var S=t.Y-A;if(Math.sqrt(C*C+S*S)<e)return true;return false}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;t.textAlign="center";t.textBaseline="bottom";t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Alizarin;t.lineWidth=2/o;if(this.Points["EndPoints"].length===1){var a=this.Points["EndPoints"][0].X;var r=this.Points["EndPoints"][0].Y;var s=this.TemporalPoint.X;var h=this.TemporalPoint.Y;t.dashedLine(t,a,r,s,h,0)}else if(this.Points["EndPoints"].length===2){var m=Math.max(this.Context.Viewport.Width,this.Context.Viewport.Height);var d=n.Geometry.CircumCircleThreePoints(this.Points["EndPoints"][0].Clone(),this.Points["EndPoints"][1].Clone(),this.TemporalPoint.Clone(),m/2);if(d!==null&&d.Radius!==0){t.lineWidth=1/o;t.beginPath();t.arc(d.X,d.Y,d.Radius,0,Math.PI/180*360,true);t.stroke()}}}fillSnapPoints(){}}t.CalibrationAnnotation=CalibrationAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class CalibrationLinearAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Selected=false;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["SnapPoints"]=new Array;this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1}Render(){if(!this.Visible)return;var t=this.Context.Viewport;var n=t.ViewportElement.getContext("2d");n.save();var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;n.textAlign="center";n.textBaseline="bottom";n.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";n.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Alizarin;var a=t.Context.ImageEntity["dicomTags"]["0002_0010"];this.FactorScale=t.GetFactorScaleImageLowOnHigh(this,this.Context.ImageEntity["dicomTags"]["0028_0011"],this.Context.ImageEntity["dicomTags"]["0028_0010"]);this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var r=this.Points["EndPoints"];this.MeasureAnnotation();if(this.Value&&r.length===2){n.lineWidth=1/o;n.beginPath();n.dashedLine(n,r[0].X,r[0].Y,r[1].X,r[1].Y,0);n.stroke();var s=(r[0].X+r[1].X)/2;var h=(r[0].Y+r[1].Y)/2;if(this.Value===25.4)t.AnnotationManager.DrawTextUntransformed(n,"1 inch",s,h);else t.AnnotationManager.DrawTextUntransformed(n,this.Value+"mm",s,h)}else{if(this.Diameter!==0&&r.length===2){n.lineWidth=1/o;n.beginPath();n.dashedLine(n,r[0].X,r[0].Y,r[1].X,r[1].Y,0);n.stroke()}}if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}n.restore()}HitTest(t,e){var o=this.Points["EndPoints"];if(n.Geometry.PointToLine(t.X,t.Y,o[0].X,o[0].Y,o[1].X,o[1].Y)<e)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"};return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(t){return false}DrawGrips(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];this.Context.Viewport.AnnotationManager.DrawGrips(t,n,e)}DrawSnaps(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(t,n,e)}DrawIsValid(){var t=false;var e=3;var o=this.Points["EndPoints"];if(o.length===2){var l=n.Geometry.GetRealDistance(o[0],o[1],this.Context);t=l>e}else t=true;return t}MeasureAnnotation(){try{if(this.Points["EndPoints"].length===2&&(!this.Diameter||this.Diameter<=0)){var t;var n;var o;var l;var a=this.Points["EndPoints"];var r=a[0];var s=a[1];t=r.X;n=r.Y;o=s.X;l=s.Y;this.Diameter=Math.sqrt((o-t)*(o-t)+(l-n)*(l-n))}}catch(t){e.Utils.DebugConsoleLog(t)}}GetTemplate(){var e=t.ResourceBag.CalibrationLinearTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){return true}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Diameter:this.Diameter,Plugin:this.Plugin,Points:this.Points,Status:this.Status,Id:this.Id,ImageGuid:this.ImageGuid,Name:this.Name,SeriesGuid:this.SeriesGuid,StudyGuid:this.StudyGuid,Value:this.Value,Visible:this.Visible,Namespace:this.Namespace,ColsOrigin:this.ColsOrigin||this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.RowsOrigin||this.Context.ImageEntity["dicomTags"]["0028_0010"]};t=JSON.stringify(e);return t}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Date=e["Date"]||e["date"];this.Plugin=e["Plugin"]||e["plugin"];this.Status=e["Status"]||e["status"];this.StudyGuid=e["StudyGuid"]||e["studyGuid"];this.SeriesGuid=e["SeriesGuid"]||e["seriesGuid"];this.ImageGuid=e["ImageGuid"]||e["imageGuid"];this.Diameter=parseFloat(e["Diameter"]||e["diameter"]);this.Value=parseFloat(e["Value"]||e["value"]);this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"]);var o=e["Points"]||e["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=e["Name"]||e["name"]}ConvertPointsWithFactororResolution(t){}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r;var s;t.lineWidth=2/o;t.strokeStyle=this.Selected===true?e.Colors.Emerald:e.Colors.SunFlower;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";var h=this.Points["EndPoints"];if(this.Points[this.TemporalCurrentGroupName].length===1){r=(h[0].X+this.TemporalPoint.X)/2;s=(h[0].Y+this.TemporalPoint.Y)/2;t.dashedLine(t,h[0].X,h[0].Y,this.TemporalPoint.X,this.TemporalPoint.Y,0);t.stroke();if(this.Value===25.4)this.Context.Viewport.AnnotationManager.DrawTextUntransformed(t,"1 inch",r,s);else this.Context.Viewport.AnnotationManager.DrawTextUntransformed(t,this.Value+"mm",r,s)}}}t.CalibrationLinearAnnotation=CalibrationLinearAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class CircleAnnotation{constructor(){this.TextboxLabel=new Array;this.TextboxRadiusLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["ReferencePoints"]=new Array;this.Points["IntersectionPoint"]=new Array;this.Points["Label"]=new Array;this.Points["LabelDistance"]=new Array;this.SnapPoints=new Array;this.VectorOldRadius=new n.Vector2D;this.Vectors={};this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsEditionMode=false;this.IsEditionReferenceMode=false;this.IndexPointDrag=0;this.INeedOtherPoint=false;this.IsReferable=false;this.IsLocked=false;this.FactorScale=1;this.isRestore=false}Render(){if(!this.Visible)return;var t;try{t=this.Context.Viewport.ViewportElement.getContext("2d");this.isRestore=false;t.save();var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r=5/o;t.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;t.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;t.strokeStyle=this.Selected===true?e.Colors.Emerald:t.strokeStyle;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var s=this.Points["Label"];var h=this.Points["LabelDistance"];var m=this.Points["EndPoints"];var d=new n.AnnotationPoint;var u=new n.AnnotationPoint;var p=new n.AnnotationPoint;var c=new n.Vector2D;var A=new n.Vector2D;var C=new n.AnnotationPoint;var S=0;if(this.Status===n.EAnnotationStatus.Complete){if(this.ReferenceAnnotation===undefined){this.fillReferenceObject()}}if(m.length===2){this.INeedOtherPoint=false}if(this.ReferenceAnnotation!==null&&this.ReferenceAnnotation!==undefined){this.Points["ReferencePoints"]=this.ReferenceAnnotation.annotation.Points["EndPoints"];c=new n.Vector2D(this.Points["ReferencePoints"][0],this.Points["ReferencePoints"][1]);if(m.length===1){u=m[0];this.drawCircle(t,u,r)}if(m.length>=2){if(this.Points["IntersectionPoint"]===undefined){this.Points["IntersectionPoint"]=new Array}if(this.IsEditionMode){if(!this.IsLocked){A=new n.Vector2D(m[0],m[1]);this.VectorOldRadius=A.Clone()}if(this.IndexPointDrag===0){u=this.Points["EndPoints"][this.IndexPointDrag];p=this.VectorOldRadius.AddVectorToAnnotationPoint(u);this.Points["EndPoints"][1]=p;m=this.Points["EndPoints"];this.INeedOtherPoint=false;this.Points["IntersectionPoint"][0]=c.Clone().CalculateProjectionOrthogonal(u);A=new n.Vector2D(u,p);S=n.Geometry.GetDistanceCalibrate(A.P1,A.P2,this.Context);d=this.VectorOldRadius.Clone().Normalize().ScalarMult(25).AddVectorToAnnotationPoint(p);this.IsLocked=true}else{u=this.Points["EndPoints"][0];p=this.Points["EndPoints"][1];A=new n.Vector2D(u,p);this.VectorOldRadius=A.Clone();this.Points["IntersectionPoint"][0]=c.Clone().CalculateProjectionOrthogonal(u);S=n.Geometry.GetDistanceCalibrate(A.P1,A.P2,this.Context);d=A.Clone().Normalize().ScalarMult(25).AddVectorToAnnotationPoint(p)}}else if(this.IsEditionReferenceMode){var g=0;if(this.IndexPointDrag===0)g=1;var I=new n.Vector2D(this.Points["ReferencePoints"][this.IndexPointDrag],this.Points["ReferencePoints"][g]);var P=new n.Vector2D(I.P1,this.Points["IntersectionPoint"][0]);this.drawCircle(t,P.P2,2*r);this.INeedOtherPoint=false;u=this.Points["EndPoints"][0];p=this.Points["EndPoints"][1];A=new n.Vector2D(u,p);this.Points["IntersectionPoint"][0]=c.Clone().CalculateProjectionOrthogonal(u);S=n.Geometry.GetDistanceCalibrate(A.P1,A.P2,this.Context);d=A.Clone().Normalize().ScalarMult(25).AddVectorToAnnotationPoint(p)}else{this.INeedOtherPoint=false;u=this.Points["EndPoints"][0];p=this.Points["EndPoints"][1];A=new n.Vector2D(u,p);this.Points["IntersectionPoint"][0]=c.Clone().CalculateProjectionOrthogonal(u);S=n.Geometry.GetDistanceCalibrate(A.P1,A.P2,this.Context);d=A.Clone().Normalize().ScalarMult(25).AddVectorToAnnotationPoint(p)}t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawCircle(t,u,r);this.drawCircle(t,p,r);this.drawDashedLine(t,u,this.Points["IntersectionPoint"][0]);var f=new n.Vector2D(this.Points["ReferencePoints"][0],this.Points["IntersectionPoint"][0]);var w=new n.Vector2D(this.Points["ReferencePoints"][1],this.Points["IntersectionPoint"][0]);if(f.Norm()>c.Norm()&&w.Norm()<c.Norm()||(w.Norm()>c.Norm()||f.Norm()<c.Norm())){t.beginPath();t.setLineDash([5,5]);if(f.Norm()+w.Norm()-c.Norm()>.5){if(f.Norm()>w.Norm()){this.drawLine(t,w.P1,this.Points["IntersectionPoint"][0])}else{this.drawLine(t,f.P1,this.Points["IntersectionPoint"][0])}}}this.drawCircle(t,this.Points["IntersectionPoint"][0],r);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.SunFlower;this.drawCircle(t,u,A.Norm());if(this.Status===n.EAnnotationStatus.Complete){if(m.length===2){this.DrawDistanceLabel(t,m[0],this.Points["IntersectionPoint"][0]);this.DrawRadiusLabel(t,m[1],d)}if(s.length>0){C.X=(m[0].X+this.Points["IntersectionPoint"][0].X)/2;C.Y=(m[0].Y+this.Points["IntersectionPoint"][0].Y)/2;if(m[1].X!==s[0].X||m[1].Y!==s[0].Y){t.dashedLine(t,C.X,C.Y,s[0].X,s[0].Y,3/o)}var b=this.measureDistanceToIntersection(m[0],this.Points["IntersectionPoint"][0]);var v=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,C.X,C.Y,s[0].X,s[0].Y,b,a);this.TextboxLabel[0]={X0:v.X0,X1:v.X1,Y0:v.Y0,Y1:v.Y1,Text:b};this.fillSnapPoints()}if(h.length>0){C.X=d.X;C.Y=d.Y;if(m[1].X!==h[0].X||m[1].Y!==h[0].Y){t.dashedLine(t,d.X,d.Y,h[0].X,h[0].Y,3/o)}var T=this.MeasureAnnotation(m[0],m[1]);var F=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,m[1].X,m[1].Y,h[0].X,h[0].Y,T,a);this.TextboxRadiusLabel[0]={X0:F.X0,X1:F.X1,Y0:F.Y0,Y1:F.Y1,Text:T};this.fillSnapPoints()}}}if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}}t.restore();this.isRestore=true}catch(n){if(!this.isRestore&&t!==undefined)t.restore();e.Utils.DebugConsoleLog("Error drawing CircleLayout Annotation")}}DrawIsValid(){var t=this.Points["EndPoints"];return t.length===2}HitTest(t,e){var o=this.Points["EndPoints"];var l=new n.Vector2D(o[0],o[1]);var a=new n.Vector2D(o[0],new n.AnnotationPoint(t));if(this.ReferenceAnnotation!==null&&this.ReferenceAnnotation!==undefined){if(Math.abs(l.Norm()-a.Norm())<e){return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"}}}return{isFound:false,groupName:null,endRangePoints:""}}DrawGrips(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["Label"];var l=this.Points["LabelDistance"];this.Context.Viewport.AnnotationManager.DrawGrips(t,n,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,o,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,l,e)}DrawSnaps(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(t,n,e)}EvaluateAnnotationTextInCanvas(t){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],t);return false}MeasureAnnotation(t,e){var o=this.Context.ImageEntity["pixelSpacing"][0];var l=this.Context.ImageEntity["pixelSpacing"][1];var a=this.Context.ImageEntity["pixelSpacing"][2];var r=this.Points["EndPoints"];var s=new n.AnnotationPoint;if(t===undefined||t===null)t=r[0];if(e===undefined||e===null)e=r[1];var h=t.X*o;var m=t.Y*l;var d=e.X*o;var u=e.Y*l;var p=2*Math.sqrt((d-h)*(d-h)+(u-m)*(u-m));var c=parseFloat(p.toFixed(1))+" "+a;return c}GetTemplate(){var e=t.ResourceBag.CircleTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){if(e==="EndPoints"){this.IsEditionMode=true;this.IndexPointDrag=n}if(e==="ReferencePoints"){this.IsEditionReferenceMode=true}return this.IsEditionMode}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,TextboxLabel:this.TextboxLabel,TextboxRadiusLabel:this.TextboxRadiusLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,IsEditionMode:this.IsEditionMode,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"],ReferenceId:this.ReferenceAnnotation.annotation.Id,ReferenceAnnotationGroupName:this.ReferenceAnnotation.groupName};t=JSON.stringify(e);return t}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Date=e["Date"]||e["date"];this.Type=e["Type"]||e["type"];this.Plugin=e["Plugin"]||e["plugin"];this.Selected=e["Selected"]||e["selected"];this.Status=e["Status"]||e["status"];this.TextboxLabel=e["TextboxLabel"]||e["textboxLabel"];this.TextboxRadiusLabel=e["TextboxRadiusLabel"]||e["textboxRadiusLabel"];this.IsEditionMode=e["IsEditionMode"]||e["IsEditionMode"];var o=e["Points"]||e["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=e["Name"]||e["name"];this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"]);this.referenceAnnotationId=e["ReferenceId"]||e["referenceId"];this.referenceAnnotationGroupName=e["ReferenceAnnotationGroupName"]||e["referenceAnnotationGroupName"]}ConvertPointsWithFactororResolution(t){}DrawDistanceLabel(t,o,l){var a=this.Points["Label"];var r=Math.abs(this.Context.ScaleX);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;t.dashedLine(t,o.X,o.Y,l.X,l.Y,0);var s=(o.X+l.X)/2;var h=(o.Y+l.Y)/2;var m=40/r;var d=(l.Y-o.Y)/(l.X-o.X);var u=-1/d;var p=h-u*s;var c=Math.floor(Math.abs(d));if(a===undefined||a===null||a!==undefined&&a!==null&&a.length===0){this.Points["Label"][0]=new n.AnnotationPoint;if(c===0){m=40/r;if(d!==0){this.Points["Label"][0].Y=h+(u<0?-m:m);this.Points["Label"][0].X=(this.Points["Label"][0].Y-p)/u}else{this.Points["Label"][0].Y=h-m;this.Points["Label"][0].X=s}}else{this.Points["Label"][0].X=s+(u<0?-m:m);this.Points["Label"][0].Y=u*this.Points["Label"][0].X+p}}}DrawRadiusLabel(t,o,l){var a=this.Points["LabelDistance"];var r=Math.abs(this.Context.ScaleX);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;t.dashedLine(t,o.X,o.Y,l.X,l.Y,0);var s=l.X;var h=l.Y;var m=40/r;var d=(l.Y-o.Y)/(l.X-o.X);var u=-1/d;var p=h-u*s;var c=Math.floor(Math.abs(d));if(a===undefined||a===null||a!==undefined&&a!==null&&a.length===0){this.Points["LabelDistance"][0]=new n.AnnotationPoint;if(c===0){m=40/r;if(d!==0){this.Points["LabelDistance"][0].Y=h+(u<0?-m:m);this.Points["LabelDistance"][0].X=(this.Points["LabelDistance"][0].Y-p)/u}else{this.Points["LabelDistance"][0].Y=h-m;this.Points["LabelDistance"][0].X=s}}else{this.Points["LabelDistance"][0].X=s+(u<0?-m:m);this.Points["LabelDistance"][0].Y=u*this.Points["LabelDistance"][0].X+p}}}measureDistanceToIntersection(t,e){var o=this.Context.ImageEntity["pixelSpacing"][0];var l=this.Context.ImageEntity["pixelSpacing"][1];var a=this.Context.ImageEntity["pixelSpacing"][2];var r=this.Points["EndPoints"];var s=new n.AnnotationPoint;if(t===undefined||t===null)t=r[0];if(e===undefined||e===null)e=r[1];var h=t.X*o;var m=t.Y*l;var d=e.X*o;var u=e.Y*l;var p=Math.sqrt((d-h)*(d-h)+(u-m)*(u-m));var c=parseFloat(p.toFixed(1))+" "+a;return c}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=5/o;var a=this.Points["EndPoints"];this.Points["ReferencePoints"]=this.ReferenceAnnotation.annotation.Points["EndPoints"];var r=new n.Vector2D(this.Points["ReferencePoints"][0],this.Points["ReferencePoints"][1]);var s=new n.Line2D(r.P1,r);var h=new n.AnnotationPoint;var m=new n.AnnotationPoint;var d=new n.Vector2D;if(a.length===1){h=this.Points["EndPoints"][0];var u=new n.Vector2D(h,this.TemporalPoint);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Carrot;this.drawCircle(t,a[0],u.Norm())}if(a.length===2){m=this.Points["EndPoints"][1];var p=new n.Vector2D(h,m);t.arc(h.X,h.Y,p.Norm(),0,2*Math.PI,true);if(this.IsEditionMode){}}var c=this.Context.Viewport.AnnotationManager.GetAllAnnotationsNearToPoint(this.TemporalPoint.X,this.TemporalPoint.Y);if(c!==null){c.DrawSnaps()}}drawPreviewLine(t,e,n,o){this.drawDashedLine(t,n.Clone().ScalarMult(o).AddVectorToAnnotationPoint(e),n.Clone().ScalarMult(-o).AddVectorToAnnotationPoint(e))}drawArc(t,e,n,o,l){t.beginPath();t.setLineDash([]);t.arc(e.X,e.Y,n,o,l,false);t.stroke();t.closePath()}drawCircle(t,e,n){t.beginPath();t.setLineDash([]);t.arc(e.X,e.Y,n,0,2*Math.PI,true);t.stroke();t.closePath()}drawDashedLine(t,e,n){t.beginPath();t.setLineDash([5,5]);t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}drawLine(t,e,n){t.beginPath();t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}calculateProjectionPoint(t,e,o){var l=new n.Vector2D(t,e);return l.CalculateProjectionOrthogonal(o)}fillSnapPoints(){var t=this.Points["EndPoints"];this.SnapPoints=new Array;this.SnapPoints.push(t[1]);this.SnapPoints.push(t[0])}fillReferenceObject(){if(this.Points["ReferencePoints"]!==undefined){if(this.referenceAnnotationId){var t=this.Context.Viewport.AnnotationManager.GetAnnotationPerId(this.referenceAnnotationId);if(t){this.ReferenceAnnotation={annotation:t,groupName:this.referenceAnnotationGroupName}}}else{for(var e=0;e<this.Points["ReferencePoints"].length;e++){var n=this.Points["ReferencePoints"][e];var o=this.Context.Viewport.AnnotationManager.GetPointInDetectAnnotation(n,true);if(o!==null){this.ReferenceAnnotation={annotation:o.annotation,groupName:o.group};break}}}}}}t.CircleAnnotation=CircleAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class CobbAngleAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["CalculatePoints"]=new Array;this.SnapPoints=new Array;this.Data=new t.CobbAngle;this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=true;this.FactorScale=1}Render(){if(!this.Visible)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r=parseFloat(this.Context.ImageEntity["pixelSpacing"][0]);t.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected?2/o:1/o;t.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;t.strokeStyle=this.Selected?e.Colors.Emerald:t.strokeStyle;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var s=this.Points["EndPoints"];if(this.Points["EndPoints"].length===2){t.dashedLine(t,s[0].X,s[0].Y,s[1].X,s[1].Y,0)}else if(this.Points["EndPoints"].length===4){t.dashedLine(t,s[0].X,s[0].Y,s[1].X,s[1].Y,0);t.dashedLine(t,s[2].X,s[2].Y,s[3].X,s[3].Y,0);if(this.Status===n.EAnnotationStatus.Complete){this.MeasureAnnotation();t.dashedLine(t,this.Data.PS1X,this.Data.PS1Y,this.Data.IX,this.Data.IY,0);t.dashedLine(t,this.Data.PS2X,this.Data.PS2Y,this.Data.IX,this.Data.IY,0);t.dashedLine(t,this.Data.IX,this.Data.IY,this.Data.IP1X,this.Data.IP1Y,0);t.dashedLine(t,this.Data.IX,this.Data.IY,this.Data.IP2X,this.Data.IP2Y,0);t.dashedLine(t,s[2].X,s[2].Y,this.Data.PS2X,this.Data.PS2Y,5);if(this.Points["CalculatePoints"]!==undefined&&this.Points["CalculatePoints"].length===0){this.Points["CalculatePoints"].push(new n.AnnotationPoint(new e.Point(this.Data.PS1X,this.Data.PS1Y)));this.Points["CalculatePoints"].push(new n.AnnotationPoint(new e.Point(this.Data.IP1X,this.Data.IP1Y)));this.Points["CalculatePoints"].push(new n.AnnotationPoint(new e.Point(this.Data.PS2X,this.Data.PS2Y)));this.Points["CalculatePoints"].push(new n.AnnotationPoint(new e.Point(this.Data.IP2X,this.Data.IP2Y)))}var h=Math.round(this.Data.Angle)+"°";var m=this.Context.Viewport;var d=m.AnnotationManager.DrawAnnotationText(t,null,null,this.Data.IX-100*r/o,this.Data.IY,h,a);this.TextboxLabel[0]={X0:d.X0,X1:d.X1,Y0:d.Y0,Y1:d.Y1,Text:h}}this.fillSnapPoints()}if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}}HitTest(t,e){var o=this.Points["EndPoints"];if(n.Geometry.PointToLine(t.X,t.Y,o[0].X,o[0].Y,o[1].X,o[1].Y)<e)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"};else if(n.Geometry.PointToLine(t.X,t.Y,o[2].X,o[2].Y,o[3].X,o[3].Y)<e)return{isFound:true,groupName:"EndPoints",endRangePoints:"2,2-3,3"};else if(n.Geometry.PointToLine(t.X,t.Y,this.Data.PS1X,this.Data.PS1Y,this.Data.IP1X,this.Data.IP1Y)<e)return{isFound:true,groupName:"CalculatePoints",endRangePoints:"0,0-1,1"};else if(n.Geometry.PointToLine(t.X,t.Y,this.Data.PS2X,this.Data.PS2Y,this.Data.IP2X,this.Data.IP2Y)<e)return{isFound:true,groupName:"CalculatePoints",endRangePoints:"2,2-3,3"};return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(t){return false}DrawGrips(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];this.Context.Viewport.AnnotationManager.DrawGrips(t,n,e)}DrawSnaps(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Context.Viewport;n.AnnotationManager.DrawGrips(t,this.SnapPoints,e)}DrawIsValid(){var t=false;var e;var o=3;var l=this.Points["EndPoints"];if(l.length===2){e=n.Geometry.GetRealDistance(l[0],l[1],this.Context);t=!(e<=o)}else if(l.length===4){this.MeasureAnnotation();e=n.Geometry.GetRealDistance(l[2],l[3],this.Context);t=o<=e&&this.Data.IX!==undefined&&this.Data.IX!==null}else t=true;return t}MeasureAnnotation(){var e=this.Context.ImageEntity["pixelSpacing"][0];var n=this.Context.ImageEntity["pixelSpacing"][1];var o=this.Points["EndPoints"];if(o.length===4){this.Data.Angle=0;var l=o[0];var a=o[1];var r=o[2];var s=o[3];var h={pointA:l,pointB:a};var m={pointA:r,pointB:s};var d=(new t.CobbAngleCalculator).CalculateCobbAngle(h,m,e,n);if(d!==null){l.X=d.R1P1X;l.Y=d.R1P1Y;a.X=d.R1P2X;a.Y=d.R1P2Y;r.X=d.R2P1X;r.Y=d.R2P1Y;s.X=d.R2P2X;s.Y=d.R2P2Y;this.Data.PAX=d.PAX;this.Data.PAY=d.PAY;this.Data.Angle=d.Angle;this.Data.PS1X=d.PS1X;this.Data.PS1Y=d.PS1Y;this.Data.PS2X=d.PS2X;this.Data.PS2Y=d.PS2Y;this.Data.IX=d.IX;this.Data.IY=d.IY;this.Data.IP1X=d.IP1X;this.Data.IP1Y=d.IP1Y;this.Data.IP2X=d.IP2X;this.Data.IP2Y=d.IP2Y}}return this.Data.Angle.toString()}GetTemplate(){var e=t.ResourceBag.CobbAngleTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){return true}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t={Angle:this.Data.Angle,Author:this.Author,Date:this.Date,Plugin:this.Plugin,Selected:this.Selected,Status:this.Status,Id:this.Id,Name:this.Name,Points:this.Points,TextboxLabel:this.TextboxLabel,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};var e=JSON.stringify(t);return e}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Plugin=e["Plugin"]||e["plugin"];this.Selected=e["Selected"]||e["selected"];this.Status=e["Status"]||e["status"];this.Date=e["Date"]||e["date"];this.TextboxLabel=e["TextboxLabel"]||e["textboxLabel"];this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"]);var o=e["Points"]||e["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=e["Name"]||e["name"]}ConvertPointsWithFactororResolution(t){}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var o=this.Context.Viewport.ViewportElement.getContext("2d");var l=Math.abs(this.Context.ScaleX);var a=Math.round(11/l*10)/10;var r=16/l;var s=this.Context.ImageEntity["pixelSpacing"][0];var h=this.Context.ImageEntity["pixelSpacing"][1];var m=this.Points["EndPoints"];o.lineWidth=2/l;o.strokeStyle=e.Colors.SunFlower;o.strokeStyle=this.Selected?e.Colors.Emerald:o.strokeStyle;o.font=a+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";o.fillStyle=e.Colors.SunFlower;o.textAlign="center";o.textBaseline="bottom";if(this.Points[this.TemporalCurrentGroupName].length===1){o.dashedLine(o,m[0].X,m[0].Y,this.TemporalPoint.X,this.TemporalPoint.Y,0)}else if(this.Points[this.TemporalCurrentGroupName].length===3){o.dashedLine(o,m[0].X,m[0].Y,m[1].X,m[1].Y,0);o.dashedLine(o,m[2].X,m[2].Y,this.TemporalPoint.X,this.TemporalPoint.Y,0);var d=m[0];var u=m[1];var p=m[2];var c=this.TemporalPoint;var A={pointA:d,pointB:u};var C={pointA:p,pointB:c};var S=(new t.CobbAngleCalculator).CalculateCobbAngle(A,C,s,h);if(S!==null){o.dashedLine(o,S.PS1X,S.PS1Y,S.IX,S.IY,0);o.dashedLine(o,S.PS2X,S.PS2Y,S.IX,S.IY,0);o.dashedLine(o,S.IX,S.IY,S.IP1X,S.IP1Y,0);o.dashedLine(o,S.IX,S.IY,S.IP2X,S.IP2Y,0);o.dashedLine(o,S.PS2X,S.PS2Y,S.R2P2X,S.R2P2Y,0);var g=Math.round(S.Angle)+"°";this.Context.Viewport.AnnotationManager.DrawAnnotationText(o,null,null,S.IX-100*s/l,S.IY,g,r)}if(S==null){var g="0"+"°";this.Context.Viewport.AnnotationManager.DrawAnnotationText(o,null,null,this.TemporalPoint.X,this.TemporalPoint.Y-100*s/l,g,r)}}}fillSnapPoints(){}}t.CobbAngleAnnotation=CobbAngleAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;let o;(function(t){t[t["Left"]=0]="Left";t[t["Right"]=1]="Right"})(o=t.EHipTemplateSide||(t.EHipTemplateSide={}));class StructureAcetabulum{constructor(){this.Diameter=0;this.Centroid=new e.Point(0,0);this.ImplantInsertPoint=new e.Point(0,0);this.CranealPoint=new e.Point(0,0);this.CaudalPoint=new e.Point(0,0);this.AcetabularInclination=t.HIPCONSTANTS.AbductionAngle;this.Complete=false}}t.StructureAcetabulum=StructureAcetabulum;class StructureFemoralHead{constructor(){this.Centroid=new e.Point(0,0);this.Diameter=0}}t.StructureFemoralHead=StructureFemoralHead;class StructureStem{constructor(){this.ImplantInsertPoint=new e.Point(0,0);this.RotationAngle=0;this.VectorCenterLine=new n.Vector2D;this.VectorNAL=new n.Vector2D;this.VectorDistal=new n.Vector2D;this.VectorMedial=new n.Vector2D;this.ShaftAngle=t.HIPCONSTANTS.ShaftAngle;this.ShaftAngleWasCalculated=false}}t.StructureStem=StructureStem;class StructureTransischialLine{constructor(){this.AbductionLine=new Array;this.AbductionVector=new n.Vector2D;this.AbductionAngle=t.HIPCONSTANTS.AbductionAngle;this.VectorLLDL=new n.Vector2D;this.VectorLLDR=new n.Vector2D;this.VectorCentralAxis=new n.Vector2D;this.RightOffset=0;this.LeftOffset=0;this.RightLength=0;this.LeftLength=0;this.Complete=false}}t.StructureTransischialLine=StructureTransischialLine;class HipImplantAnnotation{constructor(){this.radiusMax=0;this.keyAcetabulum=true;this.calibFactor=1;this.UnSelectToExecuteClickOnViewport=false;this.TextboxLabel=new Array;this.Textlabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Selected=false;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.SnapPoints=new Array;this.Points["Acetabulum"]=new Array;this.Points["FemoralHead"]=new Array;this.Points["CurveDistal"]=new Array;this.Points["CurveMedial"]=new Array;this.Points["AbductionLine"]=new Array;this.Points["LegLengthDiscrepancy"]=new Array;this.Points["LegLengthDiscrepancyLabel"]=new Array;this.Points["Label"]=new Array;this.Points["Polar"]=new Array;this.hipSide=o.Right;this.drawingStatus=t.EFitStates.Process;this.Dash=t.HIPCONSTANTS.DashLine;this.FactorScale=t.HIPCONSTANTS.FactorScale;this.radius=t.HIPCONSTANTS.Radius;this.ReadyForRender=false;this.stem=new StructureStem;this.acetabulum=new StructureAcetabulum;this.femoralHead=new StructureFemoralHead;this.transischialLine=new StructureTransischialLine;this.OrthoStemImplant=new t.OrthoTemplate(this,t.EHipImplant[t.EHipImplant.Stem]);this.OrthoAcetabularCupImplant=new t.OrthoTemplate(this,t.EHipImplant[t.EHipImplant.Cup]);this.isRestore=false;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.IsInitPositionLegPoint=true;this.CanDragPoint=false;this.ViewDirection=t.EViewCiss.AP;this.StatusSetAbductionAngle=false;this.ShaftAngleWasUpdated=false;this.CanSavedInSpecialStructure=true}SettingLineTypes(){t.LINETYPES.scaleLineThin=1/Math.abs(this.Scale);t.LINETYPES.scaleLineMedium=2/Math.abs(this.Scale);t.LINETYPES.scaleLineThick=3/Math.abs(this.Scale)}SettingEntitiesColors(){var o=this.Status===n.EAnnotationStatus.Complete;this.SetColorDrawing(t.EFitStates.Process);if(this.Selected){t.COLORS.colorEntities=e.Colors.Emerald;t.COLORS.colorAccesories=e.Colors.Emerald;t.COLORS.colorAxis=e.Colors.Emerald;t.COLORS.colorDraft=e.Colors.Emerald;t.COLORS.colorTransischial=e.Colors.Emerald;t.COLORS.colorImplants=e.Colors.Emerald}else{if(o){t.COLORS.colorEntities=e.Colors.PeterRiver;t.COLORS.colorAccesories=e.Colors.Carrot;t.COLORS.colorAxis=e.Colors.Carrot;t.COLORS.colorDraft=e.Colors.Concrete;t.COLORS.colorTransischial=e.Colors.Amethyst;t.COLORS.colorImplants=e.Colors.SunFlower}else{t.COLORS.colorEntities=e.Colors.PeterRiver;t.COLORS.colorAccesories=e.Colors.PeterRiver;t.COLORS.colorAxis=e.Colors.Alizarin;t.COLORS.colorDraft=e.Colors.Alizarin;t.COLORS.colorTransischial=e.Colors.Carrot;t.COLORS.colorImplants=e.Colors.PeterRiver}}}SetColorDrawing(n){switch(n){case t.EFitStates.Process:t.COLORS.colorEntities=e.Colors.PeterRiver;t.COLORS.colorAccesories=e.Colors.PeterRiver;t.COLORS.colorAxis=e.Colors.Alizarin;t.COLORS.colorDraft=e.Colors.Alizarin;t.COLORS.colorTransischial=e.Colors.Carrot;t.COLORS.colorImplants=e.Colors.PeterRiver;break;case t.EFitStates.CompletedCiss:t.COLORS.colorEntities=e.Colors.PeterRiver;t.COLORS.colorAccesories=e.Colors.Carrot;t.COLORS.colorAxis=e.Colors.Carrot;t.COLORS.colorDraft=e.Colors.Concrete;t.COLORS.colorTransischial=e.Colors.Amethyst;t.COLORS.colorImplants=e.Colors.SunFlower;break;case t.EFitStates.CompletedImplant:t.COLORS.colorEntities=e.Colors.PeterRiver;t.COLORS.colorAccesories=e.Colors.Carrot;t.COLORS.colorAxis=e.Colors.Carrot;t.COLORS.colorDraft=e.Colors.Concrete;t.COLORS.colorTransischial=e.Colors.Amethyst;t.COLORS.colorImplants=e.Colors.SunFlower;break;case t.EFitStates.Selected:t.COLORS.colorEntities=e.Colors.Emerald;t.COLORS.colorAccesories=e.Colors.Emerald;t.COLORS.colorAxis=e.Colors.Emerald;t.COLORS.colorDraft=e.Colors.Emerald;t.COLORS.colorTransischial=e.Colors.Emerald;t.COLORS.colorImplants=e.Colors.Emerald;break;default:t.COLORS.colorEntities=e.Colors.PeterRiver;t.COLORS.colorAccesories=e.Colors.PeterRiver;t.COLORS.colorAxis=e.Colors.Alizarin;t.COLORS.colorDraft=e.Colors.Alizarin;t.COLORS.colorTransischial=e.Colors.Carrot;t.COLORS.colorImplants=e.Colors.PeterRiver;break}}Render(){this.CanvasContext=this.Context.Viewport.ViewportElement.getContext("2d");this.Scale=Math.abs(this.Context.ScaleX);this.radius=t.HIPCONSTANTS.Radius/this.Scale;this.SetColorDrawing(this.drawingStatus);this.SettingLineTypes();try{if(!this.Visible){this.CanvasContext.globalAlpha=0}this.isRestore=false;this.CanvasContext.save();this.Scale=Math.abs(this.Context.ScaleX);var o=Math.round(11/this.Scale*10)/10;var l=this.Status===n.EAnnotationStatus.Complete;var a=this.Context.Viewport.Context.ImageEntity["pixelSpacing"][0];var r=this.Context.Viewport.Context.ImageEntity["pixelSpacing"][1];var o=Math.round(t.HIPCONSTANTS.SizeText/this.Scale*10)/10;this.calibFactor=a||r;if(this.Status===n.EAnnotationStatus.Complete){this.drawingStatus=t.EFitStates.CompletedCiss}if(this.Selected===undefined){this.Selected=false}if(this.Points["FemoralHead"]&&this.Points["FemoralHead"].length===0){this.keyAcetabulum=true}this.CanvasContext.textAlign="center";this.CanvasContext.textBaseline="bottom";this.CanvasContext.font=o+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";this.CanvasContext.strokeStyle=t.COLORS.colorEntities;this.CanvasContext.lineWidth=t.LINETYPES.scaleLineThin;this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;this.MeasureAnnotation();this.acetabularCalculation(this.drawingStatus);this.femoralHeadCalculation(this.drawingStatus);this.CanvasContext.lineWidth=t.LINETYPES.scaleLineThin;this.curveCalculation(this.drawingStatus,"CurveDistal");this.curveCalculation(this.drawingStatus,"CurveMedial");this.transischialLineCalculation();if(l||this.ReadyForRender){this.calculateStemImplantPosition();if(this.insertImplantPoint&&this.femoralHead.Diameter){this.drawAxes(this.drawingStatus);this.acetabularPointsCalculation(this.drawingStatus);this.fillSnapPoints()}}this.evalDrawwingState();if(l&&this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}this.CanvasContext.restore();this.isRestore=true;if(!this.Visible)this.CanvasContext.globalAlpha=1;this.renderImplants(o)}catch(t){if(!this.isRestore&&this.CanvasContext!==undefined)this.CanvasContext.restore();e.Utils.DebugConsoleLog("Error drawing HipImplant Annotation")}}AbductionLineActive(){if(this.Points["AbductionLine"]!==undefined)return this.Points["AbductionLine"].length===2;else return false}CissComplete(){if(this.Points["Acetabulum"]!==undefined&&this.Points["FemoralHead"]!==undefined)return this.Points["Acetabulum"].length===3&&this.Points["FemoralHead"].length===3;else return false}HitTest(t,n){var o=null;var l=false;try{for(const e in this.Points){if(this.Points.hasOwnProperty(e)){var a=this.Points[e];for(var r=0;r<a.length;r++){if(this.evaluateCircumference(t,n,a[r],10/this.Scale)){o=e;l=true;break}}}}if(!l){}}catch(t){e.Utils.DebugConsoleLog("Hip HitTest error.")}return{isFound:l,groupName:o,endRangePoints:""}}EvaluateAnnotationTextInCanvas(t){return false}MeasureAnnotation(){this.radiusMax=Math.max(this.Context.Viewport.GetWidth(),this.Context.Viewport.GetHeight());if(this.Points["Acetabulum"]&&this.Points["Acetabulum"].length===3){var t=n.Geometry.CircumCircleThreePoints(this.Points["Acetabulum"][0],this.Points["Acetabulum"][1],this.Points["Acetabulum"][2],this.radiusMax/2);if(t!==null){this.acetabulum.Diameter=t.Radius*2;this.acetabulum.Centroid.X=t.X;this.acetabulum.Centroid.Y=t.Y}}else{this.acetabulum.Diameter=0}if(this.Points["FemoralHead"]&&this.Points["FemoralHead"].length===3){var e=n.Geometry.CircumCircleThreePoints(this.Points["FemoralHead"][0],this.Points["FemoralHead"][1],this.Points["FemoralHead"][2],this.radiusMax/2);if(e!==null){this.femoralHead.Diameter=e.Radius*2;this.femoralHead.Centroid.X=e.X;this.femoralHead.Centroid.Y=e.Y;this.CISSActive=true}}else{this.femoralHead.Diameter=0}}DrawGrips(){var t=this.Points["FemoralHead"];var e=this.Points["Acetabulum"];var n=this.Points["CurveDistal"];var o=this.Points["CurveMedial"];var l=this.Points["AbductionLine"];var a=this.Points["LegLengthDiscrepancy"];this.Context.Viewport.AnnotationManager.DrawGrips(this.CanvasContext,e,this.Scale);this.Context.Viewport.AnnotationManager.DrawGrips(this.CanvasContext,t,this.Scale);this.Context.Viewport.AnnotationManager.DrawGrips(this.CanvasContext,n,this.Scale);this.Context.Viewport.AnnotationManager.DrawGrips(this.CanvasContext,o,this.Scale);this.Context.Viewport.AnnotationManager.DrawGrips(this.CanvasContext,l,this.Scale);this.Context.Viewport.AnnotationManager.DrawGrips(this.CanvasContext,a,this.Scale)}DrawSnaps(){var t=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(this.CanvasContext,t,this.Scale)}DrawIsValid(t,e){var n=true;if((t==="Acetabulum"||t==="FemoralHead")&&this.Points[t].length>2)n=this.validateDistance(t,e);return n}DonePointDragMoveAndEnd(t,e,n){this.renderImplantInformationInPanel(e)}SetHipSide(t){this.hipSide=t}SetInitialStemImplantPosition(t){this.stem.ImplantInsertPoint=t}SetInitialAcetabularCupImplantPosition(t){this.acetabulum.ImplantInsertPoint=t}GetTemplate(){var e=t.ResourceBag.HipImplantTemplateJson;return e}GetInitialStemImplantRotationAngle(){let t;t=this.stem.RotationAngle===0?0:(2*Math.PI-(3*Math.PI/2-this.stem.RotationAngle))%(2*Math.PI);return t}GetInitialAcetabularImplantRotationAngle(){let t=new n.AnnotationPoint(this.OrthoAcetabularCupImplant.CranialRefPoint);let e=new n.AnnotationPoint(this.OrthoAcetabularCupImplant.CaudalRefPoint);let o=new n.Vector2D(t,e);return this.GetHipSideNumeric()*(this.transischialLine.AbductionAngle*Math.PI/180-o.AngleRad())%(2*Math.PI)}GetCurrentAcetabularImplantRotationAngle(){return this.GetAbductionAngle()}GetInitialStemImplantPosition(){this.calculateStemImplantPosition();return this.stem.ImplantInsertPoint}GetInitialAcetabularCupImplantPosition(){return this.acetabulum.ImplantInsertPoint}GetHipSideNumeric(){return this.hipSide===o.Left?-1:1}GetRightDistanceToTransischialLine(){var t=0;if(this.transischialLine.VectorLLDR!==undefined){t=this.transischialLine.VectorLLDR.Norm()*this.transischialLine.VectorLLDR.DirectionV()}return t}GetLeftDistanceToTransischialLine(){var t=0;if(this.transischialLine.VectorLLDL!==undefined){t=this.transischialLine.VectorLLDL.Norm()*this.transischialLine.VectorLLDL.DirectionV()}return t}GetLengthLegDiscrepancy(){var t=0;try{var e=this.Context.Viewport.Context.ImageEntity["pixelSpacing"][0];var o=this.Context.Viewport.Context.ImageEntity["pixelSpacing"][1];var l=e||o;if(this.transischialLine.VectorLLDR!==undefined&&this.transischialLine.VectorLLDL!==undefined){t=this.GetHipSideNumeric()*(this.GetRightDistanceToTransischialLine()-this.GetLeftDistanceToTransischialLine())*l}else{this.transischialLine.VectorLLDR=new n.Vector2D;this.transischialLine.VectorLLDL=new n.Vector2D}}catch(t){}return t}GetHipSide(){return this.hipSide}GetAcetabularCupActualDiameter(){return n.Geometry.distance(this.OrthoAcetabularCupImplant.CaudalRefPoint,this.OrthoAcetabularCupImplant.CranialRefPoint)}GetAcetabulumDiameter(){this.MeasureAnnotation();return this.acetabulum.Diameter}GetFemoralHeadDiameter(){this.MeasureAnnotation();return this.femoralHead.Diameter}GetShaftAngleFromLandmarks(){if(this.OrthoStemImplant.Landmarks["HEAD_ROTATION+0"]){var t=this.OrthoStemImplant.Landmarks["HEAD_ROTATION+0"];var n=new e.Point(0,0);t.X=Math.abs(parseFloat(t.X.toString()));t.Y=parseFloat(t.Y.toString());n.X=parseFloat(n.X.toString());n.Y=parseFloat(n.Y.toString());return(.5*Math.PI-Math.atan2(t.Y-n.Y,t.X-n.X))*180/Math.PI}return null}GetAbductionAngle(){return this.transischialLine.AbductionAngle}SetAbductionAngle(t){this.transischialLine.AbductionAngle=t}GetShaftAngle(){return this.stem.ShaftAngle}SetShaftAngle(t){this.stem.ShaftAngle=t}GetLegAbductionAngleLeftDiscrepancy(){return this.transischialLine.RightLength}GetLegAbductionAngleRightDiscrepancy(){return this.transischialLine.LeftLength}GetLeftOffset(){return this.transischialLine.LeftOffset}GetRightOffset(){return this.transischialLine.RightOffset}GetLegLengthDifference(){return this.GetLegAbductionAngleRightDiscrepancy()-this.GetLegAbductionAngleLeftDiscrepancy()}GetLegOffsetDifference(){return this.GetHipSideNumeric()*(this.GetRightOffset()-this.GetLeftOffset())}ConvertPointsWithFactororResolution(t){this.OrthoStemImplant.PositionX*=t;this.OrthoStemImplant.PositionY*=t;this.OrthoAcetabularCupImplant.PositionX*=t;this.OrthoAcetabularCupImplant.PositionY*=t}EvaluatePointDragMoveAndEnd(t,e,o){if(!this.Visible)return false;var l=true;if(e==="CurveMedial")l=n.Geometry.validateCurves(t,this.Points.CurveMedial,o);if(e==="CurveDistal")l=n.Geometry.validateCurves(t,this.Points.CurveDistal,o);this.renderImplantInformationInPanel(e);return l}EvalHooked(){return true}Serialize(){var t={Id:this.Id,Author:this.Author,Date:this.Date,Points:this.Points,Type:this.Type,Status:this.Status,TextboxLabel:this.TextboxLabel,Name:this.Name,Plugin:this.Plugin,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,HipSide:this.hipSide,InitPositionLegPoint:this.IsInitPositionLegPoint,StatusSetAbductionAngle:this.StatusSetAbductionAngle,ShaftAngleWasUpdated:this.ShaftAngleWasUpdated,implantStemManufacturer:encodeURI(this.OrthoStemImplant.ImplantManufacturer),ImplantStemProductLine:encodeURI(this.OrthoStemImplant.ImplantProductLine),ImplantStemComponentFamily:encodeURI(this.OrthoStemImplant.ImplantComponentFamily),ImplantsStemPatientSide:encodeURI(this.OrthoStemImplant.ImplantPatientSide),ImplantStemSize:this.OrthoStemImplant.ImplantSize,ImplantStemPositionX:this.OrthoStemImplant.PositionX,ImplantStemPositionY:this.OrthoStemImplant.PositionY,ImplantStemOffsetX:this.OrthoStemImplant.OffsetX,ImplantStemOffsetY:this.OrthoStemImplant.OffsetY,ImplantStemRotation:this.OrthoStemImplant.Rotation,ImplantStemSvgPath:this.OrthoStemImplant.ImplantSvgUrl,FemoralHeadDiameter:this.OrthoStemImplant.AFemoralHeadDiameter,FemoralHeadOffset:this.OrthoStemImplant.AFemoralHeadOffset,ImplantStemComponentName:this.OrthoStemImplant.ComponentName,ImplantStemWasRotated:this.OrthoStemImplant.WasRotated,ImplantAcetabularCupManufacturer:encodeURI(this.OrthoAcetabularCupImplant.ImplantManufacturer),ImplantAcetabularCupProductLine:encodeURI(this.OrthoAcetabularCupImplant.ImplantProductLine),ImplantAcetabularCupComponentFamily:encodeURI(this.OrthoAcetabularCupImplant.ImplantComponentFamily),ImplantAcetabularCupSize:this.OrthoAcetabularCupImplant.ImplantSize,ImplantAcetabularCupPositionX:this.OrthoAcetabularCupImplant.PositionX,ImplantAcetabularCupPositionY:this.OrthoAcetabularCupImplant.PositionY,ImplantAcetabularCupOffsetX:this.OrthoAcetabularCupImplant.OffsetX,ImplantAcetabularCupOffsetY:this.OrthoAcetabularCupImplant.OffsetY,ImplantAcetabularCupRotation:this.OrthoAcetabularCupImplant.Rotation,ImplantAcetabularCupSvgPath:this.OrthoAcetabularCupImplant.ImplantSvgUrl,ImplantAcetabularComponentName:this.OrthoAcetabularCupImplant.ComponentName,ImplantAcetabularWasRotated:this.OrthoAcetabularCupImplant.WasRotated,ViewDirection:this.ViewDirection,ShaftAngle:this.stem.ShaftAngle,AbductionAngle:this.transischialLine.AbductionAngle,Centroid:this.acetabulum.Centroid,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};var e=JSON.stringify(t);return e}Deserialize(o){var l,a,r,s,h,m,d,u,p,c,A,C,S,g,I,P,f,w,b,v,T,F,O,L,E,x,y,M,D,R,V,G,B,H,N,k,W,U,K,X,Y,z,j,J,Q,q,Z,_,$,tt,et,nt,it,ot,lt,at,rt;var st=JSON.parse(o);this.Id=(l=st["Id"])!==null&&l!==void 0?l:st["id"];this.Author=(a=st["Author"])!==null&&a!==void 0?a:st["author"];this.Date=(r=st["Date"])!==null&&r!==void 0?r:st["date"];this.Plugin=(s=st["Plugin"])!==null&&s!==void 0?s:st["plugin"];var ht=(h=st["Points"])!==null&&h!==void 0?h:st["points"];this.Points=n.AnnotationController.ConvertSamplePoints(ht);this.Type=(m=st["Type"])!==null&&m!==void 0?m:st["type"];this.Status=(d=st["Status"])!==null&&d!==void 0?d:st["status"];this.TextboxLabel=(u=st["TextboxLabel"])!==null&&u!==void 0?u:st["TextboxLabel"];this.Name=(p=st["Name"])!==null&&p!==void 0?p:st["name"];this.stem.ShaftAngle=(c=st["ShaftAngle"])!==null&&c!==void 0?c:st["shaftAngle"];this.transischialLine.AbductionAngle=(A=st["AbductionAngle"])!==null&&A!==void 0?A:st["abductionAngle"];var mt=(C=st["Centroid"])!==null&&C!==void 0?C:st["Centroid"];if(mt)this.acetabulum.Centroid=new e.Point(mt.X,mt.Y);this.Selected=(S=st["Selected"])!==null&&S!==void 0?S:st["selected"];this.Plugin=(g=st["Plugin"])!==null&&g!==void 0?g:st["plugin"];this.ColsOrigin=parseInt((I=st["ColsOrigin"])!==null&&I!==void 0?I:st["colsOrigin"]);this.RowsOrigin=parseInt((P=st["RowsOrigin"])!==null&&P!==void 0?P:st["rowsOrigin"]);this.ViewDirection=(f=st["ViewDirection"])!==null&&f!==void 0?f:st["viewDirection"];this.hipSide=(w=st["HipSide"])!==null&&w!==void 0?w:st["hipSide"];this.IsInitPositionLegPoint=(b=st["InitPositionLegPoint"])!==null&&b!==void 0?b:st["initPositionLegPoint"];this.StatusSetAbductionAngle=(v=st["StatusSetAbductionAngle"])!==null&&v!==void 0?v:st["statusSetAbductionAngle"];this.ShaftAngleWasUpdated=st["ShaftAngleWasUpdated"]||st["shaftAngleWasUpdated"];let dt=(T=st["ImplantStemComponentName"])!==null&&T!==void 0?T:st["implantStemComponentName"];this.OrthoStemImplant=new t.OrthoTemplate(this,dt!==null&&dt!==void 0?dt:t.EHipImplant[t.EHipImplant.Stem]);this.OrthoStemImplant.ImplantManufacturer=e.Utils.EvaluateNullAndUndefined(decodeURI((F=st["ImplantStemManufacturer"])!==null&&F!==void 0?F:st["implantStemManufacturer"]));this.OrthoStemImplant.ImplantProductLine=e.Utils.EvaluateNullAndUndefined(decodeURI((O=st["ImplantStemProductLine"])!==null&&O!==void 0?O:st["implantStemProductLine"]));this.OrthoStemImplant.ImplantComponentFamily=e.Utils.EvaluateNullAndUndefined(decodeURI((L=st["ImplantStemComponentFamily"])!==null&&L!==void 0?L:st["implantStemComponentFamily"]));this.OrthoStemImplant.ImplantPatientSide=e.Utils.EvaluateNullAndUndefined(decodeURI((E=st["ImplantsStemPatientSide"])!==null&&E!==void 0?E:st["implantsStemPatientSide"]));this.OrthoStemImplant.ImplantSize=(x=st["ImplantStemSize"])!==null&&x!==void 0?x:st["implantStemSize"];this.OrthoStemImplant.PositionX=(M=(y=st["ImplantStemPositionX"])!==null&&y!==void 0?y:st["implantStemPositionX"])!==null&&M!==void 0?M:0;this.OrthoStemImplant.PositionY=(R=(D=st["ImplantStemPositionY"])!==null&&D!==void 0?D:st["implantStemPositionY"])!==null&&R!==void 0?R:0;this.OrthoStemImplant.OffsetX=(G=(V=st["ImplantStemOffsetX"])!==null&&V!==void 0?V:st["implantStemOffsetX"])!==null&&G!==void 0?G:0;this.OrthoStemImplant.OffsetY=(H=(B=st["ImplantStemOffsetY"])!==null&&B!==void 0?B:st["ImplantStemOffsetY"])!==null&&H!==void 0?H:0;this.OrthoStemImplant.Rotation=(k=(N=st["ImplantStemRotation"])!==null&&N!==void 0?N:st["implantStemRotation"])!==null&&k!==void 0?k:0;this.OrthoStemImplant.ImplantSvgUrl=(U=(W=st["ImplantStemSvgPath"])!==null&&W!==void 0?W:st["implantStemSvgPath"])!==null&&U!==void 0?U:null;this.OrthoStemImplant.AFemoralHeadDiameter=(K=st["FemoralHeadDiameter"])!==null&&K!==void 0?K:st["femoralHeadDiameter"];this.OrthoStemImplant.AFemoralHeadOffset=(X=st["FemoralHeadOffset"])!==null&&X!==void 0?X:st["femoralHeadOffset"];this.OrthoStemImplant.ComponentName=dt;this.OrthoStemImplant.WasRotated=st["ImplantStemWasRotated"];let ut=(Y=st["ImplantAcetabularComponentName"])!==null&&Y!==void 0?Y:st["implantAcetabularComponentName"];this.OrthoAcetabularCupImplant=new t.OrthoTemplate(this,ut!==null&&ut!==void 0?ut:t.EHipImplant[t.EHipImplant.Cup]);this.OrthoAcetabularCupImplant.ImplantManufacturer=e.Utils.EvaluateNullAndUndefined(decodeURI((z=st["ImplantAcetabularCupManufacturer"])!==null&&z!==void 0?z:st["implantAcetabularCupManufacturer"]));this.OrthoAcetabularCupImplant.ImplantProductLine=e.Utils.EvaluateNullAndUndefined(decodeURI((j=st["ImplantAcetabularCupProductLine"])!==null&&j!==void 0?j:st["implantAcetabularCupProductLine"]));this.OrthoAcetabularCupImplant.ImplantComponentFamily=e.Utils.EvaluateNullAndUndefined(decodeURI((J=st["ImplantAcetabularCupComponentFamily"])!==null&&J!==void 0?J:st["implantAcetabularCupComponentFamily"]));this.OrthoAcetabularCupImplant.ImplantSize=(Q=st["ImplantAcetabularCupSize"])!==null&&Q!==void 0?Q:st["implantAcetabularCupSize"];this.OrthoAcetabularCupImplant.PositionX=(Z=(q=st["ImplantAcetabularCupPositionX"])!==null&&q!==void 0?q:st["implantAcetabularCupPositionX"])!==null&&Z!==void 0?Z:0;this.OrthoAcetabularCupImplant.PositionY=($=(_=st["ImplantAcetabularCupPositionY"])!==null&&_!==void 0?_:st["implantAcetabularCupPositionY"])!==null&&$!==void 0?$:0;this.OrthoAcetabularCupImplant.OffsetX=(et=(tt=st["ImplantAcetabularCupOffsetX"])!==null&&tt!==void 0?tt:st["implantAcetabularCupOffsetX"])!==null&&et!==void 0?et:0;this.OrthoAcetabularCupImplant.OffsetY=(it=(nt=st["ImplantAcetabularCupOffsetY"])!==null&&nt!==void 0?nt:st["implantAcetabularCupOffsetY"])!==null&&it!==void 0?it:0;this.OrthoAcetabularCupImplant.Rotation=(lt=(ot=st["ImplantAcetabularCupRotation"])!==null&&ot!==void 0?ot:st["implantAcetabularCupRotation"])!==null&&lt!==void 0?lt:0;this.OrthoAcetabularCupImplant.ImplantSvgUrl=(rt=(at=st["ImplantAcetabularCupSvgPath"])!==null&&at!==void 0?at:st["implantAcetabularCupSvgPath"])!==null&&rt!==void 0?rt:null;this.OrthoAcetabularCupImplant.ComponentName=ut;this.OrthoAcetabularCupImplant.WasRotated=st["ImplantAcetabularWasRotated"]}CalculatePointLabel(e){var o=new n.Vector2D;o.X=t.HIPCONSTANTS.OffsetLabel;o.Y=0;o.Recalculate();return o.AddVectorToAnnotationPoint(e)}AddTextLabel(t,e,n,o,l,a,r,s){this.drawTextLabel(t,e,n,s);var h=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,o.X,o.Y,l.X,l.Y,a,r);this.TextboxLabel[s]={X0:h.X0,X1:h.X1,Y0:h.Y0,Y1:h.Y1,Text:a}}renderIncomplete(){this.SettingLineTypes();let e=t.OrthoPlugin.GetHipImplatControllerInstance();var o=t.COLORS.colorAxis;if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete&&e.Edition)return;var l=this.Context.Viewport.ViewportElement.getContext("2d");this.radius=t.HIPCONSTANTS.Radius/this.Scale;var a=Math.round(11/this.Scale*10)/10;l.textAlign="center";l.textBaseline="bottom";l.font=a+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";l.strokeStyle=o;this.radiusMax=Math.max(this.Context.Viewport.GetWidth(),this.Context.Viewport.GetHeight());if(this.TemporalCurrentGroupName==="Acetabulum"){var r=this.Points["Acetabulum"];this.drawAcetabulumOrFemoralCircle(l,r,2/this.Scale)}else if(this.TemporalCurrentGroupName==="FemoralHead"){var s=this.Points["FemoralHead"];this.drawAcetabulumOrFemoralCircle(l,s,2/this.Scale)}else if(this.TemporalCurrentGroupName==="AbductionLine"&&this.Points[this.TemporalCurrentGroupName].length===1){this.drawAbductionLine(l,this.Points["AbductionLine"][0],this.TemporalPoint,o)}}renderImplantInformationInPanel(e){if(e==="LegLengthDiscrepancy"||e==="AbductionLine"){let e=t.OrthoPlugin.GetHipImplatControllerInstance();if(e){e.SetLegDiscrepaceAbductionAngle();e.SetLegOffsetDifference();e.ShowSummary()}if(e.StatusAfterOkHipAbductionAngle){e.ShowTextDiscrepancyAbductionAngle()}}}renderViewport(t){if(t!==undefined){t.Renderer.Render();t.OverlayRenderer.Render()}}renderImplants(e){if(this.OrthoStemImplant.ImplantReadyForDraw){var n=this.GetHipSideNumeric();if(n>0){if(this.OrthoStemImplant.FemRotHeadStem.X<0&&this.hipSide!==o.Left){this.OrthoStemImplant.RenderImplant(this.Context,this.CanvasContext,n*-1)}else{this.OrthoStemImplant.RenderImplant(this.Context,this.CanvasContext,n)}}if(n<0){var l=this.OrthoStemImplant.FemRotHeadStem.X>0&&this.hipSide===o.Left;if(l){this.OrthoStemImplant.RenderImplant(this.Context,this.CanvasContext,n)}else{this.OrthoStemImplant.RenderImplant(this.Context,this.CanvasContext,n*-1)}}}else{this.OrthoStemImplant.LoadImplantFromSVG((()=>{this.renderViewport(this.Context)}))}if(this.OrthoAcetabularCupImplant.ImplantReadyForDraw){var n=this.GetHipSideNumeric();this.OrthoAcetabularCupImplant.RenderImplant(this.Context,this.CanvasContext,n)}else{this.OrthoAcetabularCupImplant.LoadImplantFromSVG((()=>{this.renderViewport(this.Context)}))}t.OrthoPlugin.RenderViewCiss(this.Context.Viewport,this.ViewDirection,this.hipSide===o.Left,true,e)}evaluateCircumference(t,e,o,l){var e=n.Viewport.AnnotationThreshold/Math.abs(this.Context.ScaleX);var a=l/2;var r=Math.abs(this.Context.ScaleX*this.Context.ScaleX);var s=Math.round(11/r*10)/10;var h=o.X-a;var m=o.X+a;var d=o.Y-s;var u=o.Y;if(t.X>=h&&t.X<=m&&t.Y>=d&&t.Y<=u)return true;var p=l/2;var c=p;var A=Math.atan2((t.Y-o.Y)*Math.abs(p/c),t.X-o.X);var C=o.X+Math.cos(A)*Math.abs(p);var S=o.Y+Math.sin(A)*Math.abs(c);var g=t.X-C;var I=t.Y-S;return Math.sqrt(g*g+I*I)<e}calculatePointForLengthLegDiscrepancy(t,o,l,a,r){var s=n.Geometry.CalculateProjectionPoint(t.P1,t.P2,o);var h=n.Geometry.CalculateProjectionPoint(t.P1,t.P2,l);var m=n.Geometry.CalculateProjectionPoint(t.P1,t.P2,a);var d=n.Geometry.CalculateProjectionPoint(t.P1,t.P2,a);this.transischialLine.VectorLLDL=new n.Vector2D(s,o);this.transischialLine.VectorLLDR=new n.Vector2D(h,l);this.transischialLine.VectorCentralAxis=new n.Vector2D(d,a);this.transischialLine.LeftLength=this.transischialLine.VectorLLDL.Norm();this.transischialLine.RightLength=this.transischialLine.VectorLLDR.Norm();var u=new n.Vector2D(m,l);this.transischialLine.LeftOffset=u.Norm();var p=new n.Vector2D(m,o);this.transischialLine.RightOffset=p.Norm();if(n.Geometry.GetSimpleDistance(o,t.P1)<n.Geometry.GetSimpleDistance(o,t.P2)){this.drawPointForLengthLegDiscrepancy(this.CanvasContext,this.transischialLine.VectorLLDL,t.P1,this.radius,r)}else{this.drawPointForLengthLegDiscrepancy(this.CanvasContext,this.transischialLine.VectorLLDL,t.P2,this.radius,r)}if(n.Geometry.GetSimpleDistance(l,t.P1)<n.Geometry.GetSimpleDistance(l,t.P2)){this.drawPointForLengthLegDiscrepancy(this.CanvasContext,this.transischialLine.VectorLLDR,t.P1,this.radius,r)}else{this.drawPointForLengthLegDiscrepancy(this.CanvasContext,this.transischialLine.VectorLLDR,t.P2,this.radius,r)}this.drawPointForLengthLegDiscrepancy(this.CanvasContext,this.transischialLine.VectorCentralAxis,a,this.radius,e.Colors.Concrete);return this.transischialLine.VectorCentralAxis}validateDistance(t,e){var o=n.Geometry.CircumCircleThreePoints(this.Points[t][0],this.Points[t][1],this.Points[t][2],this.radiusMax/2);if(o){return true}else{return false}}evalView(){if(this.hipSide===o.Right&&this.ViewDirection===t.EViewCiss.AP||this.hipSide===o.Left&&this.ViewDirection===t.EViewCiss.PA){return 1}else{return-1}}determineHipSide(t,e){if(t.EvaluateSideOfPoint(new n.AnnotationPoint(e))>0){return o.Right}else{return o.Left}}drawCircle(t,e,n,o){t.beginPath();t.setLineDash([o,o]);t.arc(e.X,e.Y,n,0,2*Math.PI,true);t.stroke();t.closePath()}drawCircleFill(t,e,n,o,l){t.beginPath();t.setLineDash([l,l]);t.arc(e.X,e.Y,n,0,2*Math.PI,true);t.strokeStyle=o;t.fillStyle=o;t.stroke();t.closePath()}drawDashedLine(t,e,n,o){t.beginPath();t.setLineDash([o,o]);t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}drawLine(t,e,n){t.beginPath();t.setLineDash([]);t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}drawRectangle(t,e,n,o){t.beginPath();t.setLineDash([]);t.strokeStyle=o;t.fillStyle=o;t.rect(e.X-n/2,e.Y-n/2,n,n);t.fill();t.stroke();t.closePath()}drawTextLabel(t,e,o,l){t.dashedLine(t,e.X,e.Y,o.X,o.Y,0);n.Geometry.SetLabelOnLine(this.Points,e,o,l,this.Context)}fillSnapPoints(){}evalDrawwingState(){let e=this.Points["Acetabulum"]&&this.Points["Acetabulum"].length===3;let n=this.Points["FemoralHead"]&&this.Points["FemoralHead"].length===3;let o=this.Points["CurveDistal"]&&this.Points["CurveDistal"].length===4;let l=this.Points["CurveMedial"]&&this.Points["CurveMedial"].length===4;let a=this.Points["AbductionLine"]&&this.Points["AbductionLine"].length===2;if(e&&n&&o&&l&&a){this.drawingStatus=t.EFitStates.CompletedCiss}}drawAcetabulumOrFemoralCircle(t,o,l){if(this.Points[this.TemporalCurrentGroupName]&&this.Points[this.TemporalCurrentGroupName].length===2){var a=n.Geometry.CircumCircleThreePoints(this.Points[this.TemporalCurrentGroupName][0],this.Points[this.TemporalCurrentGroupName][1],this.TemporalPoint.Clone(),this.radiusMax/2);if(a!==null){let n=new e.Point(a.X,a.Y);t.beginPath();t.lineWidth=l;this.drawCircle(t,n,this.radius,0);t.fillStyle=e.Colors.PeterRiver;t.fill();t.beginPath();t.lineWidth=l;this.drawCircle(t,n,a.Radius,this.Dash);t.setLineDash([2*this.Dash,2*this.Dash]);t.stroke()}else{t.beginPath();t.lineWidth=l;this.drawCircle(t,o[0],this.radius,0);this.drawCircle(t,o[1],this.radius,0);t.fillStyle=e.Colors.PeterRiver;t.fill()}}else if(this.Points[this.TemporalCurrentGroupName]&&this.Points[this.TemporalCurrentGroupName].length===1){t.beginPath();t.lineWidth=l;this.drawCircle(t,o[0],this.radius,0);t.fillStyle=e.Colors.PeterRiver;t.fill()}}drawAbductionLine(e,o,l,a){e.beginPath();e.lineWidth=1/this.Scale;this.drawCircleFill(e,o,this.radius,a,0);this.drawCircleFill(e,l,this.radius,a,0);e.fill();var r=new n.Vector2D(new n.AnnotationPoint(o),new n.AnnotationPoint(l));e.beginPath();e.strokeStyle=a;e.dashedLine(e,o.X-t.HIPCONSTANTS.FactorExtension*r.X,o.Y-t.HIPCONSTANTS.FactorExtension*r.Y,l.X+t.HIPCONSTANTS.FactorExtension*r.X,l.Y+t.HIPCONSTANTS.FactorExtension*r.Y,0);e.stroke()}drawAxes(e){if(e===t.EFitStates.Process){this.CanvasContext.strokeStyle=t.COLORS.colorEntities;this.drawCircle(this.CanvasContext,this.stem.VectorCenterLine.P1,this.radius,0);this.drawCircle(this.CanvasContext,this.stem.VectorCenterLine.P2,this.radius,0);this.drawCircle(this.CanvasContext,this.referenceImplantPoint,this.radius,0);this.drawCircle(this.CanvasContext,this.insertImplantPoint,this.radius,0);this.CanvasContext.setLineDash([4*this.Dash,this.Dash]);this.CanvasContext.strokeStyle=t.COLORS.colorAxis;this.CanvasContext.dashedLine(this.CanvasContext,this.stem.VectorCenterLine.P1.X-50*this.stem.VectorCenterLine.Normalize().X,this.stem.VectorCenterLine.P1.Y-50*this.stem.VectorCenterLine.Normalize().Y,this.insertImplantPoint.X+50*this.stem.VectorCenterLine.Normalize().X,this.insertImplantPoint.Y+50*this.stem.VectorCenterLine.Normalize().Y,0);this.CanvasContext.strokeStyle=t.COLORS.colorAxis;this.CanvasContext.dashedLine(this.CanvasContext,this.stem.VectorDistal.P1.X-50*this.stem.VectorDistal.Normalize().X,this.stem.VectorDistal.P1.Y-50*this.stem.VectorDistal.Normalize().Y,this.referenceImplantPoint.X+50*this.stem.VectorDistal.Normalize().X,this.referenceImplantPoint.Y+50*this.stem.VectorDistal.Normalize().Y,0);this.CanvasContext.strokeStyle=t.COLORS.colorAxis;this.CanvasContext.dashedLine(this.CanvasContext,this.referenceImplantPoint.X+50*this.stem.VectorNAL.Normalize().X,this.referenceImplantPoint.Y+50*this.stem.VectorNAL.Normalize().Y,this.femoralHead.Centroid.X-50*this.stem.VectorNAL.Normalize().X,this.femoralHead.Centroid.Y-50*this.stem.VectorNAL.Normalize().Y,0);this.CanvasContext.stroke()}else if(e===t.EFitStates.CompletedCiss){this.CanvasContext.strokeStyle=t.COLORS.colorEntities;this.CanvasContext.setLineDash([4*this.Dash,this.Dash]);this.drawLine(this.CanvasContext,this.stem.VectorCenterLine.P1,this.insertImplantPoint);this.drawLine(this.CanvasContext,this.insertImplantPoint,this.femoralHead.Centroid);this.drawRectangle(this.CanvasContext,this.insertImplantPoint,2*this.radius,t.COLORS.colorEntities);this.drawRectangle(this.CanvasContext,this.stem.VectorCenterLine.P1,2*this.radius,t.COLORS.colorEntities);this.drawCircleFill(this.CanvasContext,this.femoralHead.Centroid,this.radius,t.COLORS.colorEntities,0);this.CanvasContext.strokeStyle=t.COLORS.colorAxis;this.drawCircle(this.CanvasContext,this.stem.VectorCenterLine.P1,this.radius,0);this.drawCircle(this.CanvasContext,this.stem.VectorCenterLine.P2,this.radius,0)}}drawPointForLengthLegDiscrepancy(e,n,o,l,a){e.beginPath();e.lineWidth=2/this.Scale;this.drawCircleFill(e,n.P2,l,a,0);this.drawDashedLine(e,n.P1,n.P2,t.HIPCONSTANTS.DashLine);this.drawDashedLine(e,n.P1,o,t.HIPCONSTANTS.DashLine);e.fill();e.strokeStyle=a;e.closePath()}acetabularCalculation(e){this.SetColorDrawing(e);if(this.CissComplete()===true){if(this.Points["Acetabulum"]!==undefined){if(this.acetabulum.Diameter!==0){this.drawCircleFill(this.CanvasContext,this.acetabulum.Centroid,this.radius,t.COLORS.colorEntities,0);if(this.keyAcetabulum===true){this.drawCircle(this.CanvasContext,this.acetabulum.Centroid,this.acetabulum.Diameter/2,this.Dash)}}else if(this.Points["Acetabulum"].length>=2){this.drawCircleFill(this.CanvasContext,this.Points["Acetabulum"][0],this.radius,t.COLORS.colorEntities,0);this.drawCircleFill(this.CanvasContext,this.Points["Acetabulum"][1],this.radius,t.COLORS.colorEntities,0)}this.SetInitialAcetabularCupImplantPosition(this.acetabulum.Centroid)}}else{if(!(this.AbductionLineActive()&&this.CissComplete())){if(this.keyAcetabulum===true){this.drawCircle(this.CanvasContext,this.acetabulum.Centroid,this.acetabulum.Diameter/2,this.Dash)}}}}femoralHeadCalculation(e){this.SetColorDrawing(e);if(this.Points["FemoralHead"]!==undefined){if(this.femoralHead.Diameter!==0){this.drawCircleFill(this.CanvasContext,this.femoralHead.Centroid,this.radius,t.COLORS.colorEntities,0);this.drawCircle(this.CanvasContext,this.femoralHead.Centroid,this.femoralHead.Diameter/2,this.Dash)}else if(this.Points["FemoralHead"].length>=2){this.drawCircleFill(this.CanvasContext,this.Points["FemoralHead"][0],this.radius,t.COLORS.colorEntities,0);this.drawCircleFill(this.CanvasContext,this.Points["FemoralHead"][1],this.radius,t.COLORS.colorEntities,0)}}}curveCalculation(e,o){if(this.Points[o]!==undefined){if(this.Points[o].length>=1){for(var l=0;l<this.Points[o].length;l++){this.drawCircleFill(this.CanvasContext,this.Points[o][l],this.radius,t.COLORS.colorAccesories,0)}if(e===t.EFitStates.Process){this.CanvasContext.setLineDash([this.Dash,this.Dash]);if(this.Points[o].length===4){n.Geometry.RenderCurve(this.CanvasContext,this.Points[o])}else if(this.Points[o].length>=2){this.CanvasContext.setLineDash([2*this.Dash,2*this.Dash]);n.Geometry.RenderCurve(this.CanvasContext,this.Points[o])}}}}}acetabularPointsCalculation(l){this.CanvasContext.setLineDash([]);this.SetColorDrawing(l);var a=0;var r=0;var s=new n.Vector2D(new n.AnnotationPoint(this.insertImplantPoint),new n.AnnotationPoint(this.femoralHead.Centroid));var h=this.stem.VectorNAL.Clone().OrthoNorm();var m;if(this.AbductionLineActive()&&this.CissComplete()){var d=0;this.keyAcetabulum=false;var u=this.transischialLine.AbductionVector.Clone();if(this.hipSide===o.Left){d=360-this.transischialLine.AbductionAngle;u.RotateDeg(d);this.acetabulum.CranealPoint=this.acetabulum.Centroid.Clone().AddXY(this.acetabulum.Diameter/2*u.Normalize().X,this.acetabulum.Diameter/2*u.Normalize().Y);this.acetabulum.CaudalPoint=this.acetabulum.Centroid.Clone().AddXY(-this.acetabulum.Diameter/2*u.Normalize().X,-this.acetabulum.Diameter/2*u.Normalize().Y);u.RotateDeg(90);a=u.AngleRad()-Math.PI/2;r=u.AngleRad()+Math.PI/2}else{d=180+this.transischialLine.AbductionAngle;u.RotateDeg(d);this.acetabulum.CranealPoint=this.acetabulum.Centroid.Clone().AddXY(this.acetabulum.Diameter/2*u.Normalize().X,this.acetabulum.Diameter/2*u.Normalize().Y);this.acetabulum.CaudalPoint=this.acetabulum.Centroid.Clone().AddXY(-this.acetabulum.Diameter/2*u.Normalize().X,-this.acetabulum.Diameter/2*u.Normalize().Y);u.RotateDeg(-90);a=u.AngleRad()+Math.PI/2;r=u.AngleRad()-Math.PI/2}var p=new n.Vector2D(new n.AnnotationPoint(this.acetabulum.CaudalPoint),new n.AnnotationPoint(this.acetabulum.CranealPoint));var c=new n.Line2D(new n.AnnotationPoint(this.acetabulum.Centroid),p.Normalize());var A=new n.Line2D(this.transischialLine.AbductionLine[0],this.transischialLine.AbductionVector);m=c.Intersection(A);this.CanvasContext.lineWidth=t.LINETYPES.scaleLineThin;this.CanvasContext.beginPath();this.CanvasContext.strokeStyle=t.COLORS.colorDraft;this.drawDashedLine(this.CanvasContext,this.acetabulum.CaudalPoint,m,t.HIPCONSTANTS.DashLine);this.CanvasContext.stroke()}else{this.acetabulum.CranealPoint=new e.Point(this.acetabulum.Centroid.X+this.acetabulum.Diameter/2*h.X,this.acetabulum.Centroid.Y+this.acetabulum.Diameter/2*h.Y);this.acetabulum.CaudalPoint=new e.Point(this.acetabulum.Centroid.X-this.acetabulum.Diameter/2*h.X,this.acetabulum.Centroid.Y-this.acetabulum.Diameter/2*h.Y);a=s.AngleRad()+Math.PI/2;r=s.AngleRad()-Math.PI/2;this.CanvasContext.beginPath();this.CanvasContext.lineWidth=t.LINETYPES.scaleLineMedium;this.CanvasContext.strokeStyle=t.COLORS.colorEntities;this.CanvasContext.arc(this.acetabulum.Centroid.X,this.acetabulum.Centroid.Y,this.acetabulum.Diameter/2,0,360,true);this.CanvasContext.stroke()}this.CanvasContext.setLineDash([0]);if(this.keyAcetabulum===false){this.CanvasContext.beginPath();this.CanvasContext.lineWidth=t.LINETYPES.scaleLineMedium;this.CanvasContext.strokeStyle=t.COLORS.colorEntities;this.CanvasContext.arc(this.acetabulum.Centroid.X,this.acetabulum.Centroid.Y,this.acetabulum.Diameter/2,a,r,true);this.CanvasContext.stroke()}this.drawDashedLine(this.CanvasContext,this.acetabulum.CranealPoint,this.acetabulum.CaudalPoint,t.HIPCONSTANTS.SolidLine);this.CanvasContext.stroke()}transischialLineCalculation(){if(this.Points["AbductionLine"]!==undefined&&this.Points["AbductionLine"].length===2){this.transischialLine.AbductionLine=this.Points["AbductionLine"];this.transischialLine.AbductionVector=new n.Vector2D(this.transischialLine.AbductionLine[0],this.transischialLine.AbductionLine[1]);var e=new n.Vector2D;e.SetXY(t.HIPCONSTANTS.FactorExtension*this.transischialLine.AbductionVector.Norm(),-t.HIPCONSTANTS.FactorHeight*this.transischialLine.AbductionVector.Norm());var o=new n.AnnotationPoint;var l=new n.AnnotationPoint;let r=new n.AnnotationPoint;let s=new n.AnnotationPoint;if(this.IsInitPositionLegPoint){if(this.transischialLine.AbductionVector.P1.X<this.transischialLine.AbductionVector.P2.X){o=e.SubstractVectorToPointOnlyX(this.transischialLine.AbductionVector.P1);l=e.AddVectorToAnnotationPoint(this.transischialLine.AbductionVector.P2)}else{o=e.SubstractVectorToPointOnlyX(this.transischialLine.AbductionVector.P2);l=e.AddVectorToAnnotationPoint(this.transischialLine.AbductionVector.P1)}r=this.transischialLine.AbductionVector.MidPoint();s=this.transischialLine.AbductionVector.Clone().Orthogonal().Opposite().AlwaysPointsUpwards().ScalarMult(t.HIPCONSTANTS.AxisSize).SubstractVectorToPointOnlyX(r);this.Points["LegLengthDiscrepancy"][0]=o;this.Points["LegLengthDiscrepancy"][1]=l;this.Points["LegLengthDiscrepancy"][2]=r;this.Points["LegLengthDiscrepancy"][3]=s;this.IsInitPositionLegPoint=false}else{o=this.Points["LegLengthDiscrepancy"][0];l=this.Points["LegLengthDiscrepancy"][1];r=this.Points["LegLengthDiscrepancy"][2];s=this.Points["LegLengthDiscrepancy"][3]}this.drawAbductionLine(this.CanvasContext,this.Points["AbductionLine"][0],this.Points["AbductionLine"][1],t.COLORS.colorTransischial);this.calculatePointForLengthLegDiscrepancy(this.transischialLine.AbductionVector,this.Points["LegLengthDiscrepancy"][0],this.Points["LegLengthDiscrepancy"][1],this.Points["LegLengthDiscrepancy"][3],t.COLORS.colorTransischial);var a=t.HIPCONSTANTS.SizeText/this.Scale;this.CanvasContext.strokeStyle=t.COLORS.colorTransischial;this.Points["Label"][0]=this.CalculatePointLabel(this.transischialLine.VectorLLDR.MidPoint());this.Points["Label"][0].X+=10;this.Textlabel[0]=Math.round(this.transischialLine.VectorLLDR.Norm()*this.calibFactor).toString();this.AddTextLabel(this.CanvasContext,this.transischialLine.VectorLLDR.P1,this.transischialLine.VectorLLDR.P2,this.transischialLine.VectorLLDR.MidPoint(),this.Points["Label"][0],this.Textlabel[0],a,0);this.Points["Label"][1]=this.CalculatePointLabel(this.transischialLine.VectorLLDL.MidPoint());this.Points["Label"][1].X+=10;this.Textlabel[1]=Math.round(this.transischialLine.VectorLLDL.Norm()*this.calibFactor).toString();this.AddTextLabel(this.CanvasContext,this.transischialLine.VectorLLDL.P1,this.transischialLine.VectorLLDL.P2,this.transischialLine.VectorLLDL.MidPoint(),this.Points["Label"][1],this.Textlabel[1],a,1);this.Points["Label"][2]=this.CalculatePointLabel(this.transischialLine.VectorCentralAxis.MidPoint());this.Textlabel[2]="Offset "+Math.round(this.GetLegOffsetDifference()*this.calibFactor).toString();this.AddTextLabel(this.CanvasContext,this.transischialLine.VectorCentralAxis.P1,this.transischialLine.VectorCentralAxis.P2,this.transischialLine.VectorCentralAxis.MidPoint(),this.Points["Label"][2],this.Textlabel[2],a,2);this.transischialLine.Complete=true}else{}}calculateStemImplantPosition(){try{var t=this.Points["CurveDistal"].map((t=>t.Clone()));var e=this.Points["CurveMedial"].map((t=>t.Clone()));if(this.AbductionLineActive()){var l=this.Points["AbductionLine"].map((t=>t.Clone()));this.transischialLine.AbductionVector=new n.Vector2D(l[0],l[1])}this.stem.VectorDistal=n.Geometry.LeastMeanSquaresMethod(t);var a=new n.Line2D(this.stem.VectorDistal.P1,this.stem.VectorDistal);this.stem.VectorMedial=n.Geometry.LeastMeanSquaresMethod(e);var r=new n.Line2D(this.stem.VectorMedial.P1,this.stem.VectorMedial);var s=new n.AnnotationPoint(a.Intersection(r));var h=a.Bisector(r);var m=new n.Line2D(s,h);var d=new n.AnnotationPoint;d.Y=(this.stem.VectorDistal.P1.Y+this.stem.VectorMedial.P1.Y)/2;var u=(this.stem.VectorDistal.P2.Y+this.stem.VectorMedial.P2.Y)/2;this.stem.VectorCenterLine=m.EvalLine(d.Y,u);var m=new n.Line2D(s,h);if(this.AbductionLineActive()){if(this.transischialLine.AbductionVector.IsXPositive()===(this.hipSide===o.Right)){this.transischialLine.AbductionVector.Opposite()}}this.stem.VectorNAL=this.stem.VectorCenterLine.Clone();this.stem.VectorNAL.RotateDeg(-1*this.evalView()*this.stem.ShaftAngle);var p=new n.Line2D(new n.AnnotationPoint(this.femoralHead.Centroid),this.stem.VectorNAL);this.stem.RotationAngle=this.stem.VectorCenterLine.AngleRad();this.insertImplantPoint=p.Intersection(m);this.referenceImplantPoint=p.Intersection(a);this.stem.ImplantInsertPoint=this.insertImplantPoint}catch(t){}}}t.HipImplantAnnotation=HipImplantAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var OrthoPlugin;(function(OrthoPlugin){var WebClient=Efferent.Frontend.WebClient;var ImagingStudyView=Efferent.ClientViews.ImagingStudyView;let EKneeTemplateSide;(function(t){t[t["Left"]=0]="Left";t[t["Right"]=1]="Right"})(EKneeTemplateSide=OrthoPlugin.EKneeTemplateSide||(OrthoPlugin.EKneeTemplateSide={}));let SectionLeg;(function(t){t[t["Femoral"]=0]="Femoral";t[t["Tibial"]=1]="Tibial"})(SectionLeg=OrthoPlugin.SectionLeg||(OrthoPlugin.SectionLeg={}));class StructureFemoral{constructor(){this.vectorWidth=new ImagingStudyView.Vector2D;this.mlVectorAnterioCortical=new ImagingStudyView.Vector2D;this.mlMostDistalCondylarPoint=new Array;this.apImplantInsertPoint=new WebClient.Point(0,0);this.mlImplantInsertPoint=new WebClient.Point(0,0);this.apImplantInsertAngle=0;this.mlImplantInsertAngle=0;this.InitialTee=false;this.FemoralPointTeeProjectionDrag=new ImagingStudyView.AnnotationPoint;this.FemoralPointTeeProjection=new ImagingStudyView.AnnotationPoint;this.DistanceWidth=0;this.DistalJointLineShaftAngle=90;this.LateralResectionDepth=0;this.MedialResectionDepth=0}}OrthoPlugin.StructureFemoral=StructureFemoral;class StructureTibial{constructor(){this.vectorWidth=new ImagingStudyView.Vector2D;this.apImplantInsertPoint=new WebClient.Point(0,0);this.mlImplantInsertPoint=new WebClient.Point(0,0);this.apImplantInsertAngle=0;this.mlImplantInsertAngle=0;this.InitialTee=false;this.PointTeeProjection=new ImagingStudyView.AnnotationPoint;this.PointTeeProjectionDrag=new ImagingStudyView.AnnotationPoint;this.DistanceWidth=0;this.DistalJointLineShaftAngle=90;this.LateralResectionDepth=0;this.MedialResectionDepth=0;this.MLSlopeAngle=0;this.DistanceDepthResection=0;this.IndexTee=0}}OrthoPlugin.StructureTibial=StructureTibial;class KneeImplantAnnotation{constructor(){this.apRadiusMax=0;this.mlRadiusMax=0;this.femoral=new StructureFemoral;this.tibial=new StructureTibial;this.UnSelectToExecuteClickOnViewport=false;this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Selected=false;this.CanDragPoint=false;this.Namespace="Vue.Products.OrthoPlugin";this.IsReferenced=false;this.radius=OrthoPlugin.KNEECONSTANTS.Radius;this.Points={};this.Points["AP_WidthFemoralComponent"]=new Array;this.Points["AP_FemoralResection"]=new Array;this.Points["AP_WidthTibialComponent"]=new Array;this.Points["AP_TibialResection"]=new Array;this.Points["ML_AnteriorFemoralCorticalLine"]=new Array;this.Points["ML_MostDistalCondylarPoint"]=new Array;this.Points["ML_TibialImplantDimension"]=new Array;this.Points["SnapPoints"]=new Array;this.ReadyForRender=false;this.IsEdition=false;this.IsEditionTeeFemoral=false;this.IsEditionTeePointFemoral=false;this.IsEditionTeeTibial=false;this.IsEditionTeePointTibial=false;this.IsDragPointEdition=false;this.apIsRestore=false;this.mlIsRestore=false;this.ShowSnaps=false;this.IsReferable=false;this.kneeSide=EKneeTemplateSide.Left;this.FactorScale=1;this.IndexResection=0;this.APViewDirection=OrthoPlugin.EViewCiss.AP;this.MLViewDirection=OrthoPlugin.EViewCiss.ML;this.CanSavedInSpecialStructure=true;this.APOrthoImplantFemoral=new OrthoPlugin.OrthoTemplate(this,"Femoral");this.MLOrthoImplantFemoral=new OrthoPlugin.OrthoTemplate(this,"Femoral");this.APOrthoImplantTibial=new OrthoPlugin.OrthoTemplate(this,"Tibial");this.MLOrthoImplantTibial=new OrthoPlugin.OrthoTemplate(this,"Tibial")}Render(){try{if(this.Status===ImagingStudyView.EAnnotationStatus.Complete){this.APContext=undefined;this.MLContext=undefined;if(this.APImageGuid===this.Context.ImageEntity.ImageGUID){if(this.APContext===undefined)this.APContext=this.Context}if(this.MLImageGuid===this.Context.ImageEntity.ImageGUID){if(this.MLContext===undefined)this.MLContext=this.Context}}if(this.Selected===undefined)this.Selected=false;var t=this.Status===ImagingStudyView.EAnnotationStatus.Complete;if(this.APContext!==undefined&&this.Context===this.APContext){this.CanvasContextAp=this.APContext.Viewport.ViewportElement.getContext("2d");if(!this.Visible)this.CanvasContextAp.globalAlpha=0;this.apIsRestore=false;this.CanvasContextAp.save();var e=Math.abs(this.APContext.ScaleX);var n=Math.round(11/e*10)/10;this.CanvasContextAp.textAlign="center";this.CanvasContextAp.textBaseline="bottom";this.CanvasContextAp.font=n+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";this.CanvasContextAp.strokeStyle=this.Selected?WebClient.Colors.Emerald:WebClient.Colors.Alizarin;this.renderIncomplete(OrthoPlugin.ETemplateView.AP);this.drawApFemoralComponent("AP_WidthFemoralComponent");this.drawResectionPoints("AP_WidthFemoralComponent","AP_FemoralResection",SectionLeg.Femoral);this.calculateDepths("AP_WidthFemoralComponent","AP_FemoralResection",SectionLeg.Femoral);this.drawApTibialComponent("AP_WidthTibialComponent");this.drawResectionPoints("AP_WidthTibialComponent","AP_TibialResection",SectionLeg.Tibial);this.calculateDepths("AP_WidthTibialComponent","AP_TibialResection",SectionLeg.Tibial);this.DrawGrips(OrthoPlugin.ETemplateView.AP);if(this.ShowSnaps){this.DrawSnaps()}this.CanvasContextAp.restore();this.apIsRestore=true;if(!this.Visible)this.CanvasContextAp.globalAlpha=1;if(this.APOrthoImplantFemoral.ImplantReadyForDraw){if(this.APOrthoImplantFemoral.FemoralCotoInsertPoint&&this.APOrthoImplantFemoral.FemoralCotoStemPoint){var o=this.getFemoralImplantPosition(-this.evalAPVIew(),this.APOrthoImplantFemoral.FemoralCotoInsertPoint,this.APOrthoImplantFemoral.FemoralCotoStemPoint,this.APOrthoImplantFemoral.lateralPoint);this.APOrthoImplantFemoral.RenderImplant(this.APContext,this.CanvasContextAp,this.evalAPVIew(),o[0],o[1])}else{this.APOrthoImplantFemoral.RenderImplant(this.APContext,this.CanvasContextAp,this.evalAPVIew())}}else{this.APOrthoImplantFemoral.LoadImplantFromSVG((()=>{this.renderViewport(this.APContext)}))}if(this.APOrthoImplantTibial.ImplantReadyForDraw){if(this.APOrthoImplantTibial.TibialBptoInsertPoint&&this.APOrthoImplantTibial.TibialBptoStemPoint){var l=this.getTibialImplantPosition(-this.evalAPVIew(),this.APOrthoImplantTibial.TibialBptoInsertPoint,this.APOrthoImplantTibial.TibialBptoStemPoint,this.APOrthoImplantTibial.lateralPoint);this.APOrthoImplantTibial.RenderImplant(this.APContext,this.CanvasContextAp,this.evalAPVIew(),l[0],l[1])}else{this.APOrthoImplantTibial.RenderImplant(this.APContext,this.CanvasContextAp,this.evalAPVIew())}}else{this.APOrthoImplantTibial.LoadImplantFromSVG((()=>{this.renderViewport(this.APContext)}))}OrthoPlugin.OrthoPlugin.RenderViewCiss(this.APContext.Viewport,this.APViewDirection,this.kneeSide===EKneeTemplateSide.Left,false,n)}if(this.MLContext!==undefined&&this.Context===this.MLContext){this.CanvasContextMl=this.MLContext.Viewport.ViewportElement.getContext("2d");if(!this.CanvasContextMl)return;if(!this.Visible)this.CanvasContextMl.globalAlpha=0;this.mlIsRestore=false;this.CanvasContextMl.save();var a=Math.abs(this.MLContext.ScaleX);var r=Math.round(11/a*10)/10;this.CanvasContextMl.textAlign="center";this.CanvasContextMl.textBaseline="bottom";this.CanvasContextMl.font=r+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";this.CanvasContextMl.strokeStyle=this.Selected?WebClient.Colors.Emerald:WebClient.Colors.Alizarin;this.renderIncomplete(OrthoPlugin.ETemplateView.ML);this.TemporalCurrentGroupName=null;this.TemporalPoint=null;this.drawCorticalLine("ML_AnteriorFemoralCorticalLine","ML_MostDistalCondylarPoint");if(this.Points["ML_MostDistalCondylarPoint"]&&this.Points["ML_MostDistalCondylarPoint"].length===1){this.drawPointMoveA(OrthoPlugin.ETemplateView.ML,this.Points["ML_MostDistalCondylarPoint"][0])}this.drawMlTibialAnteriorCortexLine(OrthoPlugin.ETemplateView.ML,"ML_TibialImplantDimension",OrthoPlugin.KNEECONSTANTS.RadiusMl/a);this.CanvasContextMl.restore();this.mlIsRestore=true;if(!this.Visible)this.CanvasContextMl.globalAlpha=1;if(this.MLOrthoImplantFemoral.ImplantReadyForDraw){if(this.MLOrthoImplantFemoral.FemoralCotoInsertPoint&&this.MLOrthoImplantFemoral.FemoralCotoStemPoint){if(this.MLOrthoImplantFemoral.ProximalRefPoint){var s=this.getFemoralImplantPosition(this.evalMLVIew(),this.MLOrthoImplantFemoral.FemoralCotoInsertPoint,this.MLOrthoImplantFemoral.FemoralCotoStemPoint,this.MLOrthoImplantFemoral.lateralPoint,this.MLOrthoImplantFemoral.ProximalRefPoint);this.MLOrthoImplantFemoral.RenderImplant(this.MLContext,this.CanvasContextMl,this.evalMLVIew(),s[0],s[1],true)}}else{this.MLOrthoImplantFemoral.RenderImplant(this.MLContext,this.CanvasContextMl,this.evalMLVIew())}}else{this.MLOrthoImplantFemoral.LoadImplantFromSVG((()=>{this.renderViewport(this.MLContext)}))}if(this.MLOrthoImplantTibial.ImplantReadyForDraw){if(this.MLOrthoImplantTibial.TibialBptoInsertPoint&&this.MLOrthoImplantTibial.TibialBptoStemPoint){var h=this.getTibialImplantPosition(this.evalMLVIew(),this.MLOrthoImplantTibial.TibialBptoInsertPoint,this.MLOrthoImplantTibial.TibialBptoStemPoint,this.MLOrthoImplantTibial.lateralPoint,this.MLOrthoImplantTibial.anteriorPoint);this.MLOrthoImplantTibial.RenderImplant(this.MLContext,this.CanvasContextMl,this.evalMLVIew(),h[0],h[1])}else{this.MLOrthoImplantTibial.RenderImplant(this.MLContext,this.CanvasContextMl,this.evalMLVIew())}}else{this.MLOrthoImplantTibial.LoadImplantFromSVG((()=>{this.renderViewport(this.MLContext)}))}OrthoPlugin.OrthoPlugin.RenderViewCiss(this.MLContext.Viewport,this.MLViewDirection,this.kneeSide===EKneeTemplateSide.Left,false,r)}}catch(t){if(!this.apIsRestore&&this.CanvasContextAp!==undefined)this.CanvasContextAp.restore();if(!this.mlIsRestore&&this.CanvasContextMl!==undefined)this.CanvasContextMl.restore();WebClient.Utils.DebugConsoleLog("Error drawing KneeImplant Annotation")}}getFemoralImplantPosition(t,e,n,o,l){var a=1;var r=0;var s=1;if(l){var h=this.setkneeImplantDirection(1,e,n,o,l)}else{var h=this.setkneeImplantDirection(1,e,n,o)}if(t===1){switch(h){case 2:a=1;s=1;break;case 1:a=1;s=-1;break;case 3:a=2;s=1;break;case 4:a=3;s=1;break;case 5:a=4;s=-1;break;case 6:a=4;s=1;break;case 7:a=3;s=-1;break;case 8:a=2;s=-1;break}}if(t===-1){switch(h){case 1:a=1;s=1;break;case 2:a=1;s=-1;break;case 3:a=3;s=1;break;case 4:a=2;s=-1;break;case 5:a=4;s=1;break;case 6:a=4;s=-1;break;case 7:a=2;s=1;break;case 8:a=3;s=-1;break}}switch(a){case 1:r=0;break;case 2:r=-Math.PI/2;break;case 3:r=Math.PI/2;break;case 4:r=Math.PI;break}return[r,s]}getTibialImplantPosition(t,e,n,o,l){var a=1;var r=0;var s=1;if(l){var h=this.setkneeImplantDirection(2,e,n,o,l)}else{var h=this.setkneeImplantDirection(2,e,n,o)}if(t===1){switch(h){case 2:a=1;s=1;break;case 1:a=1;s=-1;break;case 3:a=2;s=1;break;case 4:a=3;s=1;break;case 5:a=4;s=-1;break;case 6:a=4;s=1;break;case 7:a=3;s=-1;break;case 8:a=2;s=-1;break}}if(t===-1){switch(h){case 1:a=1;s=1;break;case 2:a=1;s=-1;break;case 3:a=3;s=1;break;case 4:a=2;s=-1;break;case 5:a=4;s=1;break;case 6:a=4;s=-1;break;case 7:a=2;s=1;break;case 8:a=3;s=-1;break}}switch(a){case 1:r=0;break;case 2:r=-Math.PI/2;break;case 3:r=Math.PI/2;break;case 4:r=Math.PI;break}return[r,s]}setkneeImplantDirection(t,e,n,o,l){var a=Math.abs(e.X-n.X);var r=Math.abs(e.Y-n.Y);if(l){if(t===1){if(e.Y>n.Y&&a<5&&l.X>0)return 1;if(e.Y>n.Y&&a<5&&l.X<0)return 2;if(e.X>n.X&&r<5&&l.X>0)return 3;if(e.X>n.X&&r<5&&l.X<0)return 4;if(e.Y<n.Y&&a<5&&l.X<0)return 5;if(e.Y<n.Y&&a<5&&l.X>0)return 6;if(e.X<n.X&&r<5&&l.X>0)return 7;if(e.X<n.X&&r<5&&l.X<0)return 8}if(t===2){if(e.Y<n.Y&&a<5&&l.X>0)return 1;if(e.Y<n.Y&&a<5&&l.X<0)return 2;if(e.X<n.X&&r<5&&l.X>0)return 3;if(e.X<n.X&&r<5&&l.X<0)return 4;if(e.Y>n.Y&&a<5&&l.X<0)return 5;if(e.Y>n.Y&&a<5&&l.X>0)return 6;if(e.X>n.X&&r<5&&l.X>0)return 7;if(e.X>n.X&&r<5&&l.X<0)return 8}}else{if(t===1){if(e.Y>n.Y&&a<5&&o.X>0)return 1;if(e.Y>n.Y&&a<5&&o.X<0)return 2;if(e.X>n.X&&r<5&&o.Y<0)return 3;if(e.X>n.X&&r<5&&o.Y>0)return 4;if(e.Y<n.Y&&a<5&&o.X<0)return 5;if(e.Y<n.Y&&a<5&&o.X>0)return 6;if(e.X<n.X&&r<5&&o.Y<0)return 7;if(e.X<n.X&&r<5&&o.Y>0)return 8}if(t===2){if(e.Y<n.Y&&a<5&&o.X>0)return 1;if(e.Y<n.Y&&a<5&&o.X<0)return 2;if(e.X<n.X&&r<5&&o.Y<0)return 3;if(e.X<n.X&&r<5&&o.Y>0)return 4;if(e.Y>n.Y&&a<5&&o.X<0)return 5;if(e.Y>n.Y&&a<5&&o.X>0)return 6;if(e.X>n.X&&r<5&&o.Y<0)return 7;if(e.X>n.X&&r<5&&o.Y>0)return 8}}}SetInitialFemoralImplantRotationAngleAP(t){this.femoral.apImplantInsertAngle=t}GetInitialFemoralImplantRotationAngleAP(){return(360+this.femoral.apImplantInsertAngle)%360}SetInitialFemoralImplantRotationAngleML(t){this.femoral.mlImplantInsertAngle=t}GetInitialFemoralImplantRotationAngleML(){return(360+this.femoral.mlImplantInsertAngle)%360}SetInitialFemoralImplantPositionAP(t){this.femoral.apImplantInsertPoint=t}GetInitialFemoralImplantPositionAP(){return this.femoral.apImplantInsertPoint}SetInitialFemoralImplantPositionML(t){this.femoral.mlImplantInsertPoint=t}GetInitialFemoralImplantPositionML(){return this.femoral.mlImplantInsertPoint}SetInitialTibialImplantRotationAngleAP(t){this.tibial.apImplantInsertAngle=t}GetInitialTibialImplantRotationAngleAP(){return(360+this.tibial.apImplantInsertAngle)%360}SetInitialTibialImplantRotationAngleML(t){this.tibial.mlImplantInsertAngle=t}GetInitialTibialImplantRotationAngleML(){return this.tibial.mlImplantInsertAngle}SetInitialTibialImplantPositionAP(t){this.tibial.apImplantInsertPoint=t}GetInitialTibialImplantPositionAP(){return this.tibial.apImplantInsertPoint}SetInitialTibialImplantPositionML(t){this.tibial.mlImplantInsertPoint=t}GetInitialTibialImplantPositionML(){return this.tibial.mlImplantInsertPoint}SetDistalTibialJointLineShaftAngle(t){this.tibial.DistalJointLineShaftAngle=t}GetDistalTibialJointLineShaftAngle(){return this.tibial.DistalJointLineShaftAngle}SetDistalFemoralJointLineShaftAngle(t){this.femoral.DistalJointLineShaftAngle=t}GetDistalFemoralJointLineShaftAngle(){return this.femoral.DistalJointLineShaftAngle}SetMLTibialSlopeAngle(t){this.tibial.MLSlopeAngle=t}GetMLTibialSlopeAngle(){return this.tibial.MLSlopeAngle}SetFemoralLateralResectionDepth(t){this.femoral.LateralResectionDepth=t}GetFemoralLateralResectionDepth(){return this.femoral.LateralResectionDepth}SetFemoralMedialResectionDepth(t){this.femoral.MedialResectionDepth=t}GetFemoralMedialResectionDepth(){return this.femoral.MedialResectionDepth}SetTibialLateralResectionDepth(t){this.tibial.LateralResectionDepth=t}GetTibialLateralResectionDepth(){return this.tibial.LateralResectionDepth}SetTibialMedialResectionDepth(t){this.tibial.MedialResectionDepth=t}GetTibialMedialResectionDepth(){return this.tibial.MedialResectionDepth}SetDistanceWidthFemoralComponent(t){this.femoral.DistanceWidth=t}GetDistanceWidthFemoralComponent(){return this.femoral.DistanceWidth}SetDistanceWidthTibialComponent(t){this.tibial.DistanceWidth=t}GetDistanceWidthTibialComponent(){return this.tibial.DistanceWidth}HitTest(point,threshold){var hitTestOk=false;var groupName=null;try{var scaleAp=this.APContext!==undefined?Math.abs(this.APContext.ScaleX):null;var scaleMl=this.MLContext!==undefined?Math.abs(this.MLContext.ScaleX):null;for(const key in this.Points){if(this.Points.hasOwnProperty(key)){var view=key.split("_")[0];var element=this.Points[key];groupName=key;var evalContextView=eval("this."+view+"Context");if(evalContextView){for(var i=0;i<element.length;i++){if(scaleAp!==null&&this.evaluateCircumference(OrthoPlugin.ETemplateView.AP,point,threshold,element[i],10/scaleAp)){hitTestOk=true;break}else if(scaleMl!==null&&this.evaluateCircumference(OrthoPlugin.ETemplateView.ML,point,threshold,element[i],10/scaleMl)){hitTestOk=true;break}}}}}}catch(t){WebClient.Utils.DebugConsoleLog("Knee HitTest error.")}return{isFound:hitTestOk,groupName:groupName,endRangePoints:""}}EvaluateAnnotationTextInCanvas(t){return false}MeasureAnnotation(t,e,n){}DrawGrips(t){try{var e=this.Status===ImagingStudyView.EAnnotationStatus.Complete;var n=this.Points["AP_WidthFemoralComponent"];var o=this.Points["AP_WidthTibialComponent"];var l=t===OrthoPlugin.ETemplateView.AP?this.CanvasContextAp:this.CanvasContextMl;var a=Math.abs(t===OrthoPlugin.ETemplateView.AP?this.APContext.ScaleX:this.MLContext.ScaleX);var r=t===OrthoPlugin.ETemplateView.AP?this.APContext.Viewport:this.MLContext.Viewport;if(this.Selected&&e){r.AnnotationManager.DrawGrips(l,n,a);r.AnnotationManager.DrawGrips(l,o,a)}}catch(e){WebClient.Utils.DebugConsoleLog("Knee DrawGrips error on view :"+OrthoPlugin.ETemplateView[t])}}DrawSnaps(){}Serialize(){var t={Id:this.Id,Author:this.Author,Date:this.Date,Points:this.Points,Type:this.Type,Status:this.Status,TextboxLabel:this.TextboxLabel,Name:this.Name,Plugin:this.Plugin,ImageGuid:this.Context.ImageEntity.ImageGUID,APImageGuid:this.APImageGuid,MLImageGuid:this.MLImageGuid,Namespace:this.Namespace,KneeSide:this.kneeSide,ImplantFemoralAPManufacturer:encodeURI(this.APOrthoImplantFemoral.ImplantManufacturer),ImplantFemoralAPProductLine:encodeURI(this.APOrthoImplantFemoral.ImplantProductLine),ImplantFemoralAPComponentFamily:encodeURI(this.APOrthoImplantFemoral.ImplantComponentFamily),ImplantFemoralAPSize:this.APOrthoImplantFemoral.ImplantSize,ImplantFemoralAPPositionX:this.APOrthoImplantFemoral.PositionX,ImplantFemoralAPPositionY:this.APOrthoImplantFemoral.PositionY,ImplantFemoralAPOffsetX:this.APOrthoImplantFemoral.OffsetX,ImplantFemoralAPOffsetY:this.APOrthoImplantFemoral.OffsetY,ImplantFemoralAPRotation:this.APOrthoImplantFemoral.Rotation,ImplantFemoralAPSvgPath:this.APOrthoImplantFemoral.ImplantSvgUrl,ImplantFemoralAPWasRotated:this.APOrthoImplantFemoral.WasRotated,ImplantTibialAPManufacturer:encodeURI(this.APOrthoImplantTibial.ImplantManufacturer),ImplantTibialAPProductLine:encodeURI(this.APOrthoImplantTibial.ImplantProductLine),ImplantTibialAPComponentFamily:encodeURI(this.APOrthoImplantTibial.ImplantComponentFamily),ImplantTibialAPSize:this.APOrthoImplantTibial.ImplantSize,ImplantTibialAPPositionX:this.APOrthoImplantTibial.PositionX,ImplantTibialAPPositionY:this.APOrthoImplantTibial.PositionY,ImplantTibialAPOffsetX:this.APOrthoImplantTibial.OffsetX,ImplantTibialAPOffsetY:this.APOrthoImplantTibial.OffsetY,ImplantTibialAPRotation:this.APOrthoImplantTibial.Rotation,ImplantTibialAPSvgPath:this.APOrthoImplantTibial.ImplantSvgUrl,ImplantTibialAPWasRotated:this.APOrthoImplantTibial.WasRotated,ImplantFemoralMLManufacturer:encodeURI(this.MLOrthoImplantFemoral.ImplantManufacturer),ImplantFemoralMLProductLine:encodeURI(this.MLOrthoImplantFemoral.ImplantProductLine),ImplantFemoralMLComponentFamily:encodeURI(this.MLOrthoImplantFemoral.ImplantComponentFamily),ImplantFemoralMLSize:this.MLOrthoImplantFemoral.ImplantSize,ImplantFemoralMLPositionX:this.MLOrthoImplantFemoral.PositionX,ImplantFemoralMLPositionY:this.MLOrthoImplantFemoral.PositionY,ImplantFemoralMLOffsetX:this.MLOrthoImplantFemoral.OffsetX,ImplantFemoralMLOffsetY:this.MLOrthoImplantFemoral.OffsetY,ImplantFemoralMLRotation:this.MLOrthoImplantFemoral.Rotation,ImplantFemoralMLSvgPath:this.MLOrthoImplantFemoral.ImplantSvgUrl,ImplantFemoralMLWasRotated:this.MLOrthoImplantFemoral.WasRotated,ImplantTibialMLManufacturer:encodeURI(this.MLOrthoImplantTibial.ImplantManufacturer),ImplantTibialMLProductLine:encodeURI(this.MLOrthoImplantTibial.ImplantProductLine),ImplantTibialMLComponentFamily:encodeURI(this.MLOrthoImplantTibial.ImplantComponentFamily),ImplantTibialMLSize:this.MLOrthoImplantTibial.ImplantSize,ImplantTibialMLPositionX:this.MLOrthoImplantTibial.PositionX,ImplantTibialMLPositionY:this.MLOrthoImplantTibial.PositionY,ImplantTibialMLOffsetX:this.MLOrthoImplantTibial.OffsetX,ImplantTibialMLOffsetY:this.MLOrthoImplantTibial.OffsetY,ImplantTibialMLRotation:this.MLOrthoImplantTibial.Rotation,ImplantTibialMLSvgPath:this.MLOrthoImplantTibial.ImplantSvgUrl,ImplantTibialMLWasRotated:this.MLOrthoImplantTibial.WasRotated,DistanceWidthFemoralComponent:this.femoral.DistanceWidth,DistanceTibialDepthResection:this.tibial.DistanceDepthResection,DistanceAPDimensionPoints:this.DistanceAPDimensionPoints,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"],APColsOrigin:this.APColsOrigin,APRowsOrigin:this.APRowsOrigin,MLColsOrigin:this.MLColsOrigin,MLRowsOrigin:this.MLRowsOrigin,APViewDirection:this.APViewDirection,MLViewDirection:this.MLViewDirection};var e=JSON.stringify(t);return e}Deserialize(t){var e,n,o,l,a,r,s,h,m,d,u,p,c,A,C,S,g,I,P,f,w,b,v,T,F,O,L,E,x,y,M,D,R,V,G,B,H,N,k,W,U,K,X,Y,z,j,J,Q,q,Z,_,$,tt,et,nt,it,ot,lt,at,rt,st,ht,mt,dt,ut,pt,ct,At,Ct,St;var gt=JSON.parse(t);this.Id=(e=gt["Id"])!==null&&e!==void 0?e:gt["id"];this.Author=(n=gt["Author"])!==null&&n!==void 0?n:gt["author"];this.Date=(o=gt["Date"])!==null&&o!==void 0?o:gt["date"];this.Plugin=(l=gt["Plugin"])!==null&&l!==void 0?l:gt["plugin"];this.kneeSide=gt["KneeSide"];var It=(a=gt["Points"])!==null&&a!==void 0?a:gt["points"];this.Points=ImagingStudyView.AnnotationController.ConvertSamplePoints(It);this.Type=(r=gt["Type"])!==null&&r!==void 0?r:gt["type"];this.Status=(s=gt["Status"])!==null&&s!==void 0?s:gt["status"];this.TextboxLabel=(h=gt["TextboxLabel"])!==null&&h!==void 0?h:gt["TextboxLabel"];this.Name=(m=gt["Name"])!==null&&m!==void 0?m:gt["name"];this.ColsOrigin=parseInt((d=gt["ColsOrigin"])!==null&&d!==void 0?d:gt["colsOrigin"]);this.RowsOrigin=parseInt((u=gt["RowsOrigin"])!==null&&u!==void 0?u:gt["rowsOrigin"]);this.APColsOrigin=parseInt((p=gt["APColsOrigin"])!==null&&p!==void 0?p:gt["aPColsOrigin"]);this.APRowsOrigin=parseInt((c=gt["APRowsOrigin"])!==null&&c!==void 0?c:gt["aPRowsOrigin"]);this.MLColsOrigin=parseInt((A=gt["MLColsOrigin"])!==null&&A!==void 0?A:gt["mLColsOrigin"]);this.MLRowsOrigin=parseInt((C=gt["MLRowsOrigin"])!==null&&C!==void 0?C:gt["mLRowsOrigin"]);this.APViewDirection=gt["APViewDirection"];this.MLViewDirection=gt["MLViewDirection"];this.APImageGuid=(S=gt["APImageGuid"])!==null&&S!==void 0?S:gt["APImageGuid"];this.MLImageGuid=(g=gt["MLImageGuid"])!==null&&g!==void 0?g:gt["MLImageGuid"];this.APOrthoImplantFemoral=new OrthoPlugin.OrthoTemplate(this,"Femoral");this.APOrthoImplantFemoral.ImplantManufacturer=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((I=gt["ImplantFemoralAPManufacturer"])!==null&&I!==void 0?I:gt["implantFemoralAPManufacturer"]));this.APOrthoImplantFemoral.ImplantProductLine=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((P=gt["ImplantFemoralAPProductLine"])!==null&&P!==void 0?P:gt["implantFemoralAPProductLine"]));this.APOrthoImplantFemoral.ImplantComponentFamily=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((f=gt["ImplantFemoralAPComponentFamily"])!==null&&f!==void 0?f:gt["implantFemoralAPComponentFamily"]));this.APOrthoImplantFemoral.ImplantSize=(w=gt["ImplantFemoralAPSize"])!==null&&w!==void 0?w:gt["implantFemoralAPSize"];this.APOrthoImplantFemoral.PositionX=(b=gt["ImplantFemoralAPPositionX"])!==null&&b!==void 0?b:gt["implantFemoralAPPositionX"];this.APOrthoImplantFemoral.PositionY=(v=gt["ImplantFemoralAPPositionY"])!==null&&v!==void 0?v:gt["implantFemoralAPPositionY"];this.APOrthoImplantFemoral.OffsetX=(F=(T=gt["ImplantFemoralAPOffsetX"])!==null&&T!==void 0?T:gt["implantFemoralAPOffsetX"])!==null&&F!==void 0?F:0;this.APOrthoImplantFemoral.OffsetY=(L=(O=gt["ImplantFemoralAPOffsetY"])!==null&&O!==void 0?O:gt["implantFemoralAPOffsetY"])!==null&&L!==void 0?L:0;this.APOrthoImplantFemoral.Rotation=(E=gt["ImplantFemoralAPRotation"])!==null&&E!==void 0?E:gt["implantFemoralAPRotation"];this.APOrthoImplantFemoral.ImplantSvgUrl=(y=(x=gt["ImplantFemoralAPSvgPath"])!==null&&x!==void 0?x:gt["implantFemoralAPSvgPath"])!==null&&y!==void 0?y:null;this.APOrthoImplantFemoral.WasRotated=gt["ImplantFemoralAPWasRotated"];this.APOrthoImplantTibial=new OrthoPlugin.OrthoTemplate(this,"Tibial");this.APOrthoImplantTibial.ImplantManufacturer=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((M=gt["ImplantTibialAPManufacturer"])!==null&&M!==void 0?M:gt["implantTibialAPManufacturer"]));this.APOrthoImplantTibial.ImplantProductLine=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((D=gt["ImplantTibialAPProductLine"])!==null&&D!==void 0?D:gt["implantTibialAPProductLine"]));this.APOrthoImplantTibial.ImplantComponentFamily=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((R=gt["ImplantTibialAPComponentFamily"])!==null&&R!==void 0?R:gt["implantTibialAPComponentFamily"]));this.APOrthoImplantTibial.ImplantSize=(V=gt["ImplantTibialAPSize"])!==null&&V!==void 0?V:gt["implantTibialAPSize"];this.APOrthoImplantTibial.PositionX=(G=gt["ImplantTibialAPPositionX"])!==null&&G!==void 0?G:gt["implantTibialAPPositionX"];this.APOrthoImplantTibial.PositionY=(B=gt["ImplantTibialAPPositionY"])!==null&&B!==void 0?B:gt["implantTibialAPPositionY"];this.APOrthoImplantTibial.OffsetX=(N=(H=gt["ImplantTibialAPOffsetX"])!==null&&H!==void 0?H:gt["implantTibialAPOffsetX"])!==null&&N!==void 0?N:0;this.APOrthoImplantTibial.OffsetY=(W=(k=gt["ImplantTibialAPOffsetY"])!==null&&k!==void 0?k:gt["implantTibialAPOffsetY"])!==null&&W!==void 0?W:0;this.APOrthoImplantTibial.Rotation=(U=gt["ImplantTibialAPRotation"])!==null&&U!==void 0?U:gt["implantTibialAPRotation"];this.APOrthoImplantTibial.ImplantSvgUrl=(X=(K=gt["ImplantTibialAPSvgPath"])!==null&&K!==void 0?K:gt["implantTibialAPSvgPath"])!==null&&X!==void 0?X:null;this.APOrthoImplantTibial.WasRotated=gt["ImplantTibialAPWasRotated"];this.MLOrthoImplantFemoral=new OrthoPlugin.OrthoTemplate(this,"Femoral");this.MLOrthoImplantFemoral.ImplantManufacturer=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((Y=gt["ImplantFemoralMLManufacturer"])!==null&&Y!==void 0?Y:gt["implantFemoralMLManufacturer"]));this.MLOrthoImplantFemoral.ImplantProductLine=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((z=gt["ImplantFemoralMLProductLine"])!==null&&z!==void 0?z:gt["implantFemoralMLProductLine"]));this.MLOrthoImplantFemoral.ImplantComponentFamily=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((j=gt["ImplantFemoralMLComponentFamily"])!==null&&j!==void 0?j:gt["implantFemoralMLComponentFamily"]));this.MLOrthoImplantFemoral.ImplantSize=(J=gt["ImplantFemoralMLSize"])!==null&&J!==void 0?J:gt["implantFemoralMLSize"];this.MLOrthoImplantFemoral.PositionX=(Q=gt["ImplantFemoralMLPositionX"])!==null&&Q!==void 0?Q:gt["implantFemoralMLPositionX"];this.MLOrthoImplantFemoral.PositionY=(q=gt["ImplantFemoralMLPositionY"])!==null&&q!==void 0?q:gt["implantFemoralMLPositionY"];this.MLOrthoImplantFemoral.OffsetX=(_=(Z=gt["ImplantFemoralMLOffsetX"])!==null&&Z!==void 0?Z:gt["implantFemoralMLOffsetX"])!==null&&_!==void 0?_:0;this.MLOrthoImplantFemoral.OffsetY=(tt=($=gt["ImplantFemoralMLOffsetY"])!==null&&$!==void 0?$:gt["implantFemoralMLOffsetY"])!==null&&tt!==void 0?tt:0;this.MLOrthoImplantFemoral.Rotation=(et=gt["ImplantFemoralMLRotation"])!==null&&et!==void 0?et:gt["implantFemoralMLRotation"];this.MLOrthoImplantFemoral.ImplantSvgUrl=(nt=gt["ImplantFemoralMLSvgPath"])!==null&&nt!==void 0?nt:gt["implantFemoralMLSvgPath"];this.MLOrthoImplantFemoral.WasRotated=gt["ImplantFemoralMLWasRotated"];this.MLOrthoImplantTibial=new OrthoPlugin.OrthoTemplate(this,"Tibial");this.MLOrthoImplantTibial.ImplantManufacturer=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((it=gt["ImplantTibialMLManufacturer"])!==null&&it!==void 0?it:gt["implantTibialMLManufacturer"]));this.MLOrthoImplantTibial.ImplantProductLine=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((ot=gt["ImplantTibialMLProductLine"])!==null&&ot!==void 0?ot:gt["implantTibialMLProductLine"]));this.MLOrthoImplantTibial.ImplantComponentFamily=WebClient.Utils.EvaluateNullAndUndefined(decodeURI((lt=gt["ImplantTibialMLComponentFamily"])!==null&&lt!==void 0?lt:gt["implantTibialMLComponentFamily"]));this.MLOrthoImplantTibial.ImplantSize=(at=gt["ImplantTibialMLSize"])!==null&&at!==void 0?at:gt["implantTibialMLSize"];this.MLOrthoImplantTibial.PositionX=(rt=gt["ImplantTibialMLPositionX"])!==null&&rt!==void 0?rt:gt["implantTibialMLPositionX"];this.MLOrthoImplantTibial.PositionY=(st=gt["ImplantTibialMLPositionY"])!==null&&st!==void 0?st:gt["implantTibialMLPositionY"];this.MLOrthoImplantTibial.OffsetX=(mt=(ht=gt["ImplantTibialMLOffsetX"])!==null&&ht!==void 0?ht:gt["implantTibialMLOffsetX"])!==null&&mt!==void 0?mt:0;this.MLOrthoImplantTibial.OffsetY=(ut=(dt=gt["ImplantTibialMLOffsetY"])!==null&&dt!==void 0?dt:gt["implantTibialMLOffsetY"])!==null&&ut!==void 0?ut:0;this.MLOrthoImplantTibial.Rotation=(pt=gt["ImplantTibialMLRotation"])!==null&&pt!==void 0?pt:gt["implantTibialMLRotation"];this.MLOrthoImplantTibial.ImplantSvgUrl=(ct=gt["ImplantTibialMLSvgPath"])!==null&&ct!==void 0?ct:gt["implantTibialMLSvgPath"];this.MLOrthoImplantTibial.WasRotated=gt["ImplantTibialMLWasRotated"];this.femoral.DistanceWidth=(At=gt["DistanceWidthFemoralComponent"])!==null&&At!==void 0?At:gt["distanceWidthFemoralComponent"];this.tibial.DistanceDepthResection=(Ct=gt["DistanceTibialDepthResection"])!==null&&Ct!==void 0?Ct:gt["distanceTibialDepthResection"];this.DistanceAPDimensionPoints=(St=gt["DistanceAPDimensionPoints"])!==null&&St!==void 0?St:gt["distanceAPDimensionPoints"]}SetRowsAndColsForSpecialAnnotationWithDifferentContexts(){if(this.APContext===this.Context){this.ColsOrigin=this.APColsOrigin;this.RowsOrigin=this.APRowsOrigin}else if(this.MLContext===this.Context){this.ColsOrigin=this.MLColsOrigin;this.RowsOrigin=this.MLRowsOrigin}}ConvertPointsWithFactororResolution(t){if(this.APContext===this.Context){this.APOrthoImplantFemoral.PositionX*=t;this.APOrthoImplantFemoral.PositionY*=t;this.APOrthoImplantTibial.PositionX*=t;this.APOrthoImplantTibial.PositionY*=t;this.APColsOrigin=parseInt(this.APContext.ImageEntity["dicomTags"]["0028_0011"]);this.APRowsOrigin=parseInt(this.APContext.ImageEntity["dicomTags"]["0028_0010"])}else if(this.MLContext===this.Context){this.MLOrthoImplantFemoral.PositionX*=t;this.MLOrthoImplantFemoral.PositionY*=t;this.MLOrthoImplantTibial.PositionX*=t;this.MLOrthoImplantTibial.PositionY*=t;this.MLColsOrigin=parseInt(this.MLContext.ImageEntity["dicomTags"]["0028_0011"]);this.MLRowsOrigin=parseInt(this.MLContext.ImageEntity["dicomTags"]["0028_0010"])}}GetTemplate(){var t=OrthoPlugin.ResourceBag.KneeImplantTemplateJson;return t}DrawIsValid(){return true}GetKneeSide(){return this.kneeSide}SetKneeSide(t){this.kneeSide=t}EvaluatePointDragMoveAndEnd(t,e,n){if(!this.Visible)return false;if(this.IsEdition){try{var o=this.GetInitialFemoralImplantPositionAP();var l=this.GetInitialFemoralImplantRotationAngleAP();var a=this.GetInitialFemoralImplantPositionML();var r=this.GetInitialFemoralImplantRotationAngleML();var s=this.GetInitialTibialImplantPositionAP();var h=this.GetInitialTibialImplantRotationAngleAP();var m=this.GetInitialTibialImplantPositionML();var d=this.GetInitialTibialImplantRotationAngleML();if(e==="AP_WidthFemoralComponent"){this.APOrthoImplantFemoral.PositionX=parseFloat(o.X.toString());this.APOrthoImplantFemoral.PositionY=parseFloat(o.Y.toString());this.APOrthoImplantFemoral.Rotation=parseFloat(l.toString())}if(e==="AP_WidthTibialComponent"){this.APOrthoImplantTibial.PositionX=parseFloat(s.X.toString());this.APOrthoImplantTibial.PositionY=parseFloat(s.Y.toString());this.APOrthoImplantTibial.Rotation=parseFloat(h.toString())}if(e==="ML_AnteriorFemoralCorticalLine"||e==="ML_MostDistalCondylarPoint"){this.MLOrthoImplantFemoral.PositionX=parseFloat(a.X.toString());this.MLOrthoImplantFemoral.PositionY=parseFloat(a.Y.toString());this.MLOrthoImplantFemoral.Rotation=parseFloat(r.toString())}if(e==="ML_TibialImplantDimension"){this.MLOrthoImplantTibial.PositionX=parseFloat(m.X.toString());this.MLOrthoImplantTibial.PositionY=parseFloat(m.Y.toString());this.MLOrthoImplantTibial.Rotation=parseFloat(d.toString())}this.Render()}catch(t){WebClient.Utils.DebugConsoleLog(t)}}if(e==="AP_WidthFemoralComponent"){if(n===3){this.IsEditionTeePointFemoral=true}if(n===0||n===1){this.IsEditionTeeFemoral=true}}if(e==="AP_WidthTibialComponent"){this.tibial.PointTeeProjectionDrag=new ImagingStudyView.AnnotationPoint(t);this.tibial.IndexTee=n;this.IsEditionTeeTibial=true}if(e==="AP_FemoralResection"||e==="AP_TibialResection"){this.IndexResection=n;this.IsDragPointEdition=true}try{OrthoPlugin.OrthoPlugin.GetKneeImplantControlerInstance().WriteActionSummaryDataForEdition()}catch(t){}this.IsEdition=true;return true}DonePointDragMoveAndEnd(t,e,n){try{OrthoPlugin.OrthoPlugin.GetKneeImplantControlerInstance().WriteActionSummaryDataForEdition()}catch(t){}}GetAPDimension(){return this.DistanceAPDimensionPoints}calculateOposite(t,e){var n=new ImagingStudyView.Vector2D(e,t.CalculateProjectionOrthogonal(e));return new ImagingStudyView.Vector2D(n.P2,n.AddVectorToAnnotationPoint(n.P2))}renderViewport(t){if(t!==undefined){t.Renderer.Render();t.OverlayRenderer.Render()}}setAPDimension(t){this.DistanceAPDimensionPoints=t}flipDirectionOfAPImplant(){var t=true;if(this.kneeSide===EKneeTemplateSide.Right){t=false}return t}EvaluateConflictML(){return this.evaluateGeometryML()===true&&this.evalMLVIew()===1}evaluateGeometryML(){if(this.femoral.mlVectorAnterioCortical!==undefined||this.femoral.mlVectorAnterioCortical!==null){if(this.femoral.mlMostDistalCondylarPoint!==undefined||this.femoral.mlMostDistalCondylarPoint!==null){if(this.femoral.mlVectorAnterioCortical.P1.Y<this.femoral.mlVectorAnterioCortical.P2.Y){this.femoral.mlVectorAnterioCortical=this.femoral.mlVectorAnterioCortical.Clone().Opposite()}if(this.femoral.mlVectorAnterioCortical.EvaluateSideOfPoint(this.femoral.mlMostDistalCondylarPoint[0])===-1){return false}}}return true}drawApFemoralComponent(t){if(this.Points[t]!==undefined&&this.Points[t].length>=2){var e=this.Points[t];this.drawPointsOnView(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,e[0],e[1]);this.drawSegment(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,e[0],e[1]);var n=new ImagingStudyView.Vector2D(e[0],e[1]);if(this.Points[t].length===3){this.drawPointMove(OrthoPlugin.ETemplateView.AP,e[2])}if(this.Points[t].length>=4){this.femoral.vectorWidth=new ImagingStudyView.Vector2D(e[2],e[3]);var o=this.xorFlip(this.APViewDirection,this.kneeSide,OrthoPlugin.EViewCiss.AP);if(this.femoral.vectorWidth.EvalXDirection()!==o){this.femoral.vectorWidth.Opposite()}var l=this.femoral.vectorWidth.VectorForLabels(20);this.drawText(OrthoPlugin.ETemplateView.AP,"M",l.P1,WebClient.Colors.Carrot);this.drawText(OrthoPlugin.ETemplateView.AP,"L",l.P2,WebClient.Colors.Carrot);var a=new ImagingStudyView.Line2D(n.P1,n);var r=new ImagingStudyView.Line2D(this.femoral.vectorWidth.P1,this.femoral.vectorWidth);var s=a.IntersectionAP(r);this.Points[t][4]=s;var h=new ImagingStudyView.Vector2D(s,e[0]);this.drawSegment(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,e[2],e[3]);this.drawPointMove(OrthoPlugin.ETemplateView.AP,e[2]);this.drawPointMove(OrthoPlugin.ETemplateView.AP,e[3]);this.drawPointMove(OrthoPlugin.ETemplateView.AP,e[4],false);this.drawSegment(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,e[2],e[3]);this.drawSegmentA(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,e[1],s,5);this.drawInsertionTriangle(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,this.femoral.vectorWidth.MidPoint(),this.femoral.vectorWidth);this.SetDistalFemoralJointLineShaftAngle(this.calculateAngle(n,this.femoral.vectorWidth));this.drawArcDim(OrthoPlugin.ETemplateView.AP,this.CanvasContextMl,h,this.femoral.vectorWidth,s,this.GetDistalFemoralJointLineShaftAngle().toFixed(1).toString());this.SetDistanceWidthFemoralComponent(ImagingStudyView.Geometry.GetDistanceCalibrate(this.Points[t][2],this.Points[t][3],this.APContext))}}}drawApTibialComponent(t){if(this.Points[t]!==undefined&&this.Points[t].length>=2){var e=this.Points[t];this.drawPointsOnView(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,e[0],e[1]);this.drawSegment(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,e[0],e[1]);var n=new ImagingStudyView.Vector2D(e[0],e[1]);var o=new ImagingStudyView.Vector2D;if(this.Points[t].length>=3){if(this.Points[t].length<4){this.Points[t][3]=n.CalculateProjectionOrthogonal(this.Points[t][2]);o=new ImagingStudyView.Vector2D(this.Points[t][2],this.Points[t][3]);this.Points[t][4]=o.Clone().AddVectorToAnnotationPoint(this.Points[t][3]);this.tibial.InitialTee=false}else{if(this.IsEditionTeeTibial){var l=new ImagingStudyView.Vector2D(this.Points[t][1],this.Points[t][3]);var a=new ImagingStudyView.Vector2D(this.Points[t][3],this.Points[t][2]);var r=new ImagingStudyView.Vector2D(this.Points[t][3],this.Points[t][4]);var s=n.Clone().Normalize();switch(this.tibial.IndexTee){case 0:case 1:var h=new ImagingStudyView.Vector2D(this.Points[t][0],this.Points[t][1]);var m=n.EvaluateSideOfPoint(this.Points[t][2]);var d=n.EvaluateSideOfPoint(this.Points[t][4]);this.Points[t][3]=s.ScalarMult(l.Norm()).AddVectorToAnnotationPoint(this.Points[t][1]);this.Points[t][2]=h.Clone().OrthoNorm().ScalarMult(m*a.Norm()).AddVectorToAnnotationPoint(this.Points[t][3]);this.Points[t][4]=h.Clone().OrthoNorm().ScalarMult(d*r.Norm()).AddVectorToAnnotationPoint(this.Points[t][3]);break;case 2:this.Points[t][3]=n.CalculateProjectionOrthogonal(this.Points[t][2]);this.Points[t][4]=r.AddVectorToAnnotationPoint(this.Points[t][3]);break;case 3:this.Points[t][2]=a.AddVectorToAnnotationPoint(this.Points[t][3]);this.Points[t][4]=r.AddVectorToAnnotationPoint(this.Points[t][3]);break;case 4:this.Points[t][3]=n.CalculateProjectionOrthogonal(this.Points[t][4]);this.Points[t][2]=a.AddVectorToAnnotationPoint(this.Points[t][3]);break}}}this.tibial.vectorWidth=new ImagingStudyView.Vector2D(this.Points[t][2],this.Points[t][4]);var u=new ImagingStudyView.Vector2D(this.Points[t][3],e[0]);var p;if(this.tibial.vectorWidth.EvalXDirection()){p=this.tibial.vectorWidth.AngleDeg()}else{p=this.tibial.vectorWidth.Clone().Opposite().AngleDeg()}this.drawPointMove(OrthoPlugin.ETemplateView.AP,this.Points[t][2]);this.drawPointMove(OrthoPlugin.ETemplateView.AP,this.Points[t][4],false);this.drawSegment(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,this.Points[t][2],this.Points[t][4]);this.drawSegmentA(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,this.Points[t][1],this.Points[t][3],5);this.SetInitialTibialImplantPositionAP(this.Points[t][3]);this.SetInitialTibialImplantRotationAngleAP(p);this.SetDistalTibialJointLineShaftAngle(this.calculateAngle(this.tibial.vectorWidth,n));this.drawArcDim(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,this.tibial.vectorWidth,u,this.Points[t][3],this.GetDistalTibialJointLineShaftAngle().toFixed(1).toString());this.SetDistanceWidthTibialComponent(ImagingStudyView.Geometry.GetDistanceCalibrate(this.Points[t][2],this.Points[t][4],this.APContext))}}}drawResectionPoints(t,e,n){if(this.Points[e]!==undefined&&this.Points[e].length>0&&this.Points[t]!==undefined){if(this.Points[e].length===1){this.drawPointMoveA(OrthoPlugin.ETemplateView.AP,this.Points[e][0])}else{this.drawPointMoveA(OrthoPlugin.ETemplateView.AP,this.Points[e][0]);this.drawPointMoveA(OrthoPlugin.ETemplateView.AP,this.Points[e][1])}}if(this.IsDragPointEdition===true){if(this.Points[t].length===5){var o=new ImagingStudyView.Vector2D(this.Points[t][4],this.Points[t][5]).CalculateProjectionOrthogonal(this.Points[e][this.IndexResection]);this.drawSegmentA(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,this.Points[e][this.IndexResection],o,5);this.IsDragPointEdition=false}}}evalAPVIew(){if(this.xorFlip(this.APViewDirection,this.kneeSide,OrthoPlugin.EViewCiss.AP)){return 1}else{return-1}}evalMLVIew(){if(this.xorFlip(this.MLViewDirection,this.kneeSide,OrthoPlugin.EViewCiss.ML)){return-1}else{return 1}}setMLfemoralImplantAngles(t){var e=t.Clone().AlwaysPointsUpwards();this.SetInitialFemoralImplantRotationAngleML(e.AngleDeg())}drawInsertionTriangle(t,e,n,o){var l=OrthoPlugin.KNEECONSTANTS.TriangleScale;var a=o.Clone().Normalize().ScalarMult(l).AddVectorToPoint(n);var r=o.Clone().Normalize().ScalarMult(-l).AddVectorToPoint(n);var s=o.Clone().OrthoNorm().ScalarMult(-l).AddVectorToPoint(n);this.drawSegment(OrthoPlugin.ETemplateView.AP,e,a,r);this.drawSegment(OrthoPlugin.ETemplateView.AP,e,a,s);this.drawSegment(OrthoPlugin.ETemplateView.AP,e,r,s)}drawPointsOnView(t,e,n,o){try{var l=Math.abs(t===OrthoPlugin.ETemplateView.AP?this.APContext.ScaleX:this.MLContext.ScaleX);this.drawPoint(e,n,l,WebClient.Colors.Pomegranate);this.drawPoint(e,o,l,WebClient.Colors.Pomegranate)}catch(e){WebClient.Utils.DebugConsoleLog("Knee draw two points error on view :"+OrthoPlugin.ETemplateView[t])}}drawPoint(t,e,n,o){try{t.beginPath();t.lineWidth=2/n;t.fillStyle=o;t.drawCircle(t,e.X,e.Y,this.radius/n);t.fill();t.closePath()}catch(t){WebClient.Utils.DebugConsoleLog("Knee draw two points error on view")}}drawSegmentA(t,e,n,o,l){try{var a=Math.abs(t===OrthoPlugin.ETemplateView.AP?this.APContext.ScaleX:this.MLContext.ScaleX);e.beginPath();e.strokeStyle=this.Selected?WebClient.Colors.Emerald:WebClient.Colors.Alizarin;e.dashedLine(e,n.X,n.Y,o.X,o.Y,l);e.fill()}catch(e){WebClient.Utils.DebugConsoleLog("Knee drawSegment error on view :"+OrthoPlugin.ETemplateView[t])}}drawSegment(t,e,n,o){var l=new ImagingStudyView.AnnotationPoint(n);var a=new ImagingStudyView.AnnotationPoint(o);this.drawSegmentA(t,e,l,a,0)}drawPointMoveA(t,e){var n=new ImagingStudyView.AnnotationPoint(e);this.drawPointMove(t,n)}drawPointMove(t,e,n){try{var o=t===OrthoPlugin.ETemplateView.AP?this.APContext.Viewport.ViewportElement.getContext("2d"):this.MLContext.Viewport.ViewportElement.getContext("2d");var l=Math.abs(t===OrthoPlugin.ETemplateView.AP?this.APContext.ScaleX:this.MLContext.ScaleX);var a=5/l;o.beginPath();o.lineWidth=2/l;if(n){o.fillStyle=WebClient.Colors.Pomegranate}else{o.stroke()}o.fillStyle=WebClient.Colors.Pomegranate;o.arc(e.X,e.Y,a,0,2*Math.PI,false);o.fill()}catch(e){WebClient.Utils.DebugConsoleLog("Knee drawPointMove error on view :"+OrthoPlugin.ETemplateView[t])}}drawText(t,e,n,o){var l=t===OrthoPlugin.ETemplateView.AP?this.APContext.Viewport.ViewportElement.getContext("2d"):this.MLContext.Viewport.ViewportElement.getContext("2d");var a=Math.abs(this.Context.ScaleX);var r=16/a;l.save();l.beginPath();l.strokeStyle=o;this.Context.Viewport.AnnotationManager.DrawAnnotationText(l,0,0,n.X,n.Y,e,r);l.restore()}drawArc(t,e,n,o,l,a){var r=t===OrthoPlugin.ETemplateView.AP?this.APContext.Viewport.ViewportElement.getContext("2d"):this.MLContext.Viewport.ViewportElement.getContext("2d");r.strokeStyle=this.Selected?WebClient.Colors.Emerald:WebClient.Colors.Carrot;r.beginPath();if(a){r.setLineDash([5,5])}r.arc(e.X,e.Y,n,o,l,false);r.stroke();r.setLineDash([]);r.closePath()}drawArcDim(t,e,n,o,l,a){var r=.2*Math.min(n.Norm(),o.Norm());var s=n.Clone().VectorBisectorNorm(o.Clone());var h=new ImagingStudyView.Vector2D(l,n.P1);var m=new ImagingStudyView.Vector2D(l,n.P2);var d=new ImagingStudyView.Vector2D(l,o.P1);if(h.Norm()<m.Norm()){this.drawSegmentA(t,e,l,h.P2,5)}else{this.drawSegmentA(t,e,l,m.P2,5)}if(h.EvaluateSideOfPoint(d.P2)===-1&&d.EvaluateSideOfPoint(h.P2)===1){if(h.Angle2Vectors(d)>Math.PI/2){this.drawArc(t,l,r,m.Clone().AngleRad(),d.Clone().AngleRad(),true)}else{this.drawArc(t,l,r,d.Clone().AngleRad(),h.AngleRad(),true)}}if(h.EvaluateSideOfPoint(d.P2)===1&&d.EvaluateSideOfPoint(h.P2)===-1){if(h.Angle2Vectors(d)>Math.PI/2){this.drawArc(t,l,r,d.Clone().AngleRad(),m.Clone().AngleRad(),true)}else{this.drawArc(t,l,r,h.AngleRad(),d.Clone().AngleRad(),true)}}this.drawText(t,a,s.ScalarMult(r).AddVectorToAnnotationPoint(l),WebClient.Colors.Carrot)}drawCorticalLine(t,e){if(this.Points[t]||this.Points[t]){if(this.Points[t]&&this.Points[t].length>=1){this.drawPointMove(OrthoPlugin.ETemplateView.ML,this.Points[t][0])}if(this.Points[t]&&this.Points[t].length>=2){this.drawPointMove(OrthoPlugin.ETemplateView.ML,this.Points[t][1]);this.drawSegment(OrthoPlugin.ETemplateView.ML,this.CanvasContextMl,this.Points[t][0],this.Points[t][1]);this.femoral.mlVectorAnterioCortical=new ImagingStudyView.Vector2D(this.Points[t][0],this.Points[t][1])}if(this.Points[t]&&this.Points[t].length>=3){var n=new ImagingStudyView.Vector2D(this.Points[t][0],this.Points[t][1]);var o=n.CalculateProjectionOrthogonal(this.Points[t][2]);var l=new ImagingStudyView.Vector2D(o,this.Points[t][2]);this.drawPointMove(OrthoPlugin.ETemplateView.ML,this.Points[t][2]);this.drawPointMove(OrthoPlugin.ETemplateView.ML,o,false);var a=new ImagingStudyView.Vector2D(this.Points[t][2],o);var r=a.Clone().VectorForLabels(20);this.drawText(OrthoPlugin.ETemplateView.ML,"P",r.P1,WebClient.Colors.Carrot);this.drawText(OrthoPlugin.ETemplateView.ML,"A",r.P2,WebClient.Colors.Carrot);this.drawSegmentA(OrthoPlugin.ETemplateView.ML,this.CanvasContextMl,a.P1,a.P2,5);this.setMLfemoralImplantAngles(l.Clone());this.setAPDimension(ImagingStudyView.Geometry.GetDistanceCalibrate(l.P1,l.P2,this.MLContext))}if(this.Points[e]&&this.Points[e].length===1){this.SetInitialFemoralImplantPositionML(this.Points[e][0]);this.drawPointMove(OrthoPlugin.ETemplateView.ML,this.Points[e][0]);this.femoral.mlMostDistalCondylarPoint=new Array;this.femoral.mlMostDistalCondylarPoint[0]=this.Points[e][0]}}}drawMlTibialAnteriorCortexLine(t,e,n){var o=t===OrthoPlugin.ETemplateView.AP?this.APContext.Viewport.ViewportElement.getContext("2d"):this.MLContext.Viewport.ViewportElement.getContext("2d");if(this.Points[e]&&this.Points[e].length>=1){for(var l=0;l<this.Points[e].length;l++){this.drawPointMove(t,this.Points[e][l])}var a=new ImagingStudyView.Vector2D;var r=new ImagingStudyView.Vector2D;if(this.Points[e].length>=2){a=new ImagingStudyView.Vector2D(this.Points[e][0],this.Points[e][1]);var s=a.Clone().AlwaysPointsUpwards().AngleDeg();this.SetInitialTibialImplantPositionML(a.MidPoint());this.SetInitialTibialImplantRotationAngleML(s);this.drawSegmentA(OrthoPlugin.ETemplateView.ML,this.CanvasContextMl,a.P1,a.P2,0);if(this.Points[e].length===4){r=new ImagingStudyView.Vector2D(this.Points[e][2],this.Points[e][3]);this.drawSegmentA(OrthoPlugin.ETemplateView.ML,this.CanvasContextMl,r.P1,r.P2,0);var h=new ImagingStudyView.Line2D(r.P1,r);var m=new ImagingStudyView.Line2D(a.P1,a);var d=new ImagingStudyView.AnnotationPoint(h.Intersection(m));this.SetMLTibialSlopeAngle(this.calculateAngle(r,a));this.drawSegmentA(OrthoPlugin.ETemplateView.ML,this.CanvasContextMl,d,a.P1,5);this.drawSegmentA(OrthoPlugin.ETemplateView.ML,this.CanvasContextMl,d,r.P1,5);this.drawArcDim(OrthoPlugin.ETemplateView.ML,this.CanvasContextMl,a,r,d,this.GetMLTibialSlopeAngle().toFixed(1).toString())}}}}calculateDepths(t,e,n){if(this.Points[t]&&this.Points[t].length>=4||this.Points[e]&&this.Points[e].length===2){var o=new ImagingStudyView.Vector2D(this.Points[t][2],this.Points[t][3]);var l=1;var a=1;var r=new ImagingStudyView.Vector2D;var s=new ImagingStudyView.AnnotationPoint;var h;if(this.Points[e]&&this.Points[e].length!==0){r=new ImagingStudyView.Vector2D(this.Points[e][0],this.Points[e][1]);s=r.MidPoint()}else if(this.Points[t]&&this.Points[t].length===5){r=new ImagingStudyView.Vector2D(this.Points[t][2],this.Points[t][3]);s=this.Points[t][4]}if(r.EvalXDirection()){h=r.AngleDeg()}else{h=r.Clone().Opposite().AngleDeg()}if(n===SectionLeg.Femoral){if(this.Points[e]){this.SetFemoralLateralResectionDepth(ImagingStudyView.Geometry.GetValueCalibrate(l*o.DistancePointToVector(this.Points[e][0]),this.APContext));this.SetFemoralMedialResectionDepth(ImagingStudyView.Geometry.GetValueCalibrate(a*o.DistancePointToVector(this.Points[e][1]),this.APContext))}this.SetInitialFemoralImplantPositionAP(s);this.SetInitialFemoralImplantRotationAngleAP(h)}else if(n===SectionLeg.Tibial){if(this.Points[e]){this.SetTibialLateralResectionDepth(ImagingStudyView.Geometry.GetValueCalibrate(l*o.DistancePointToVector(this.Points[e][0]),this.APContext));this.SetTibialMedialResectionDepth(ImagingStudyView.Geometry.GetValueCalibrate(a*o.DistancePointToVector(this.Points[e][1]),this.APContext))}}}}calculateAngle(t,e){return t.Angle2VectorsDeg90(e)}calculateInsertionPoint(t,e,n){var o=new ImagingStudyView.AnnotationPoint;o.X=t.X+e*n.Normalize().X;o.Y=t.Y+e*n.Normalize().Y;return o}evaluateCircumference(t,e,n,o,l){try{var a=Math.abs(t===OrthoPlugin.ETemplateView.AP?this.APContext.ScaleX:this.MLContext.ScaleX);var n=ImagingStudyView.Viewport.AnnotationThreshold/a;var r=l/2;var s=t===OrthoPlugin.ETemplateView.AP?Math.abs(this.APContext.ScaleX*this.APContext.ScaleX):Math.abs(this.MLContext.ScaleX*this.MLContext.ScaleX);var h=Math.round(11/s*10)/10;var m=o.X-r;var d=o.X+r;var u=o.Y-h;var p=o.Y;if(e.X>=m&&e.X<=d&&e.Y>=u&&e.Y<=p)return true;var c=l/2;var A=c;var C=Math.atan2((e.Y-o.Y)*Math.abs(c/A),e.X-o.X);var S=o.X+Math.cos(C)*Math.abs(c);var g=o.Y+Math.sin(C)*Math.abs(A);var I=e.X-S;var P=e.Y-g;return Math.sqrt(I*I+P*P)<n}catch(e){WebClient.Utils.DebugConsoleLog("Knee evaluateCircumference error on view :"+OrthoPlugin.ETemplateView[t])}return false}xorFlip(t,e,n){var o=t===n;var l=e===EKneeTemplateSide.Right;return(o||l)&&(!o||!l)}renderIncomplete(t){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===ImagingStudyView.EAnnotationStatus.Complete)return;try{if(t===OrthoPlugin.ETemplateView.AP){if(this.APContext!==undefined){var e=Math.abs(this.APContext.ScaleX);var n=Math.round(11/e*10)/10;this.CanvasContextAp.textAlign="center";this.CanvasContextAp.textBaseline="bottom";this.CanvasContextAp.font=n+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";this.CanvasContextAp.strokeStyle=this.Selected?WebClient.Colors.Emerald:WebClient.Colors.Alizarin;this.CanvasContextAp.setLineDash([10,10]);this.apRadiusMax=Math.max(this.APContext.Viewport.GetWidth(),this.APContext.Viewport.GetHeight());if(this.TemporalCurrentGroupName==="AP_WidthFemoralComponent"&&this.Points[this.TemporalCurrentGroupName].length===1){var o=this.Points["AP_WidthFemoralComponent"];this.drawPointsOnView(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,o[0],this.TemporalPoint)}if(this.TemporalCurrentGroupName==="AP_WidthTibialComponent"&&this.Points[this.TemporalCurrentGroupName].length===1){var o=this.Points["AP_WidthTibialComponent"];this.drawPointsOnView(OrthoPlugin.ETemplateView.AP,this.CanvasContextAp,o[0],this.TemporalPoint)}else if(this.TemporalCurrentGroupName==="AP_TibialTComponent"&&this.Points[this.TemporalCurrentGroupName].length>=0){this.drawPointMove(OrthoPlugin.ETemplateView.AP,this.TemporalPoint)}this.CanvasContextMl.setLineDash([])}}else if(t===OrthoPlugin.ETemplateView.ML){if(this.MLContext!==undefined){var l=Math.abs(this.MLContext.ScaleX);var a=Math.round(11/l*10)/10;this.CanvasContextMl.textAlign="center";this.CanvasContextMl.textBaseline="bottom";this.CanvasContextMl.font=a+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";this.CanvasContextMl.strokeStyle=this.Selected?WebClient.Colors.Emerald:WebClient.Colors.Alizarin;this.CanvasContextMl.setLineDash([10,10]);this.mlRadiusMax=Math.max(this.MLContext.Viewport.GetWidth(),this.MLContext.Viewport.GetHeight());if(this.TemporalCurrentGroupName==="ML_AnteriorFemoralCorticalLine"&&this.Points[this.TemporalCurrentGroupName].length>=0){this.drawPointMove(OrthoPlugin.ETemplateView.ML,this.TemporalPoint)}if(this.TemporalCurrentGroupName==="ML_MostDistalCondylarPoint"&&this.Points[this.TemporalCurrentGroupName].length>=0){this.drawPointMove(OrthoPlugin.ETemplateView.ML,this.TemporalPoint)}if(this.TemporalCurrentGroupName==="ML_TibialImplantDimension"&&this.Points[this.TemporalCurrentGroupName].length>=0){this.drawPointMove(OrthoPlugin.ETemplateView.ML,this.TemporalPoint)}if(this.TemporalCurrentGroupName==="ML_AnteriorFemoralCorticalLine"){if(this.Points["ML_AnteriorFemoralCorticalLine"].length===2){this.drawSegment(OrthoPlugin.ETemplateView.ML,this.CanvasContextMl,this.Points["ML_AnteriorFemoralCorticalLine"][0],this.Points["ML_AnteriorFemoralCorticalLine"][1])}}this.CanvasContextMl.setLineDash([])}}}catch(e){WebClient.Utils.DebugConsoleLog("Knee renderIncomplete error on view :"+OrthoPlugin.ETemplateView[t])}}}OrthoPlugin.KneeImplantAnnotation=KneeImplantAnnotation})(OrthoPlugin=Products.OrthoPlugin||(Products.OrthoPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class ParallelLineAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["OffsetPoint"]=new Array;this.Points["EndPoints"]=new Array;this.Points["ReferencePoints"]=new Array;this.Points["Label"]=new Array;this.SnapPoints=new Array;this.Vectors={};this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsEditionMode=false;this.IndexPointDrag=0;this.IsReferable=true;this.FactorScale=1;this.IsLineType=true}Render(){if(!this.Visible)return;var t;try{t=this.Context.Viewport.ViewportElement.getContext("2d");this.isRestore=false;t.save();var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r=5/o;t.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;t.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;t.strokeStyle=this.Selected===true?e.Colors.Emerald:t.strokeStyle;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var s=this.Points["EndPoints"];var h=this.Points["OffsetPoint"];var m=this.Points["Label"];if(this.Status===n.EAnnotationStatus.Complete){if(this.ReferenceAnnotation===undefined){this.fillReferenceObject()}}if(this.ReferenceAnnotation!==null&&this.ReferenceAnnotation!==undefined){this.Points["ReferencePoints"]=this.ReferenceAnnotation.annotation.Points["EndPoints"];var d=this.ReferenceAnnotation.groupName;var u=this.ReferenceAnnotation.annotation.Points[d];if(h.length>0){var p=this.calculateProjectionPoint(u[0],u[1],h[0]);var c=new n.Vector2D(u[0],p);var A=new n.Vector2D(p,u[1]);var C=new n.Vector2D(c.SubstractVectorToPoint(h[0].Clone()),A.AddVectorToAnnotationPoint(h[0].Clone()));if(this.IsEditionMode){var S=s[this.IndexPointDrag];var g=0;if(this.IndexPointDrag===0)g=1;var I=new n.Line2D(S,C);var P=new n.Line2D(s[g],C.Clone().Orthogonal());var f=new n.Line2D(h[0],C.Clone().Orthogonal());var w=new n.AnnotationPoint(I.Intersection(P));var b=new n.AnnotationPoint(I.Intersection(f));t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.PeterRiver;this.drawCircle(t,p,r);this.drawCircle(t,b,r);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawLine(t,S,w);this.Points["OffsetPoint"][0]=b;this.Points["EndPoints"][g]=w}else{this.vectorParallelLine=new n.Vector2D(C.P1,C.P2);this.Points["EndPoints"][0]=this.vectorParallelLine.P1;this.Points["EndPoints"][1]=this.vectorParallelLine.P2;t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.PeterRiver;this.drawCircle(t,p,r);this.drawCircle(t,h[0],r);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawLine(t,this.Points["EndPoints"][0],this.Points["EndPoints"][1])}}var s=this.Points["EndPoints"];if(this.Status===n.EAnnotationStatus.Complete){if(s.length===2){this.DrawTextLabel(t,s[0],s[1])}if(m.length>0){var v=(s[0].X+s[1].X)/2;var T=(s[0].Y+s[1].Y)/2;if(s[1].X!==m[0].X||s[1].Y!==m[0].Y){t.dashedLine(t,v,T,m[0].X,m[0].Y,3/o)}var F=this.MeasureAnnotation(this.Points["EndPoints"][0],this.Points["EndPoints"][1]);var O=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,v,T,m[0].X,m[0].Y,F,a);this.TextboxLabel[0]={X0:O.X0,X1:O.X1,Y0:O.Y0,Y1:O.Y1,Text:F}}this.fillSnapPoints();if(this.IsReferenced){this.Context.Viewport.AnnotationManager.DrawReferenceLine(t);this.Selected=false}}if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}}t.restore();this.isRestore=true}catch(n){if(!this.isRestore&&t!==undefined)t.restore();e.Utils.DebugConsoleLog("Error drawing ParallelLayout Annotation")}}DrawIsValid(){var t=true;return t}HitTest(t,e){if(this.ReferenceAnnotation!==null&&this.ReferenceAnnotation!==undefined){var o=this.Points["EndPoints"];if(n.Geometry.PointToLine(t.X,t.Y,o[0].X,o[0].Y,o[1].X,o[1].Y)<e)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"}}return{isFound:false,groupName:null,endRangePoints:""}}DrawGrips(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["OffsetPoint"];var l=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(t,n,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,o,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,l,e)}DrawSnaps(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(t,n,e)}EvaluateAnnotationTextInCanvas(t){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],t);return false}MeasureAnnotation(t,e){var n=this.Context.ImageEntity["pixelSpacing"][0];var o=this.Context.ImageEntity["pixelSpacing"][1];var l=this.Context.ImageEntity["pixelSpacing"][2];var a=this.Points["EndPoints"];if(t===undefined||t===null)t=a[0];if(e===undefined||e===null)e=a[1];var r=t.X*n;var s=t.Y*o;var h=e.X*n;var m=e.Y*o;var d=Math.sqrt((h-r)*(h-r)+(m-s)*(m-s));var u=parseFloat(d.toFixed(1))+" "+l;return u}GetTemplate(){var e=t.ResourceBag.ParallelLineTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){if(e==="EndPoints"){this.IsEditionMode=true}this.IndexPointDrag=n;return this.IsEditionMode}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,Step:this.Step,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,IsEditionMode:this.IsEditionMode,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"],ReferenceId:this.ReferenceAnnotation.annotation.Id,ReferenceAnnotationGroupName:this.ReferenceAnnotation.groupName};t=JSON.stringify(e);return t}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Date=e["Date"]||e["date"];this.Type=e["Type"]||e["type"];this.Plugin=e["Plugin"]||e["plugin"];this.Selected=e["Selected"]||e["selected"];this.Status=e["Status"]||e["status"];this.Step=e["Step"]||e["step"];this.TextboxLabel=e["TextboxLabel"]||e["textboxLabel"];this.IsEditionMode=e["IsEditionMode"]||e["IsEditionMode"];var o=e["Points"]||e["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=e["Name"]||e["name"];this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"]);this.referenceAnnotationId=e["ReferenceId"]||e["referenceId"];this.referenceAnnotationGroupName=e["ReferenceAnnotationGroupName"]||e["referenceAnnotationGroupName"]}ConvertPointsWithFactororResolution(t){}DrawTextLabel(t,e,o){var l=this.Points["Label"];var a=Math.abs(this.Context.ScaleX);t.dashedLine(t,e.X,e.Y,o.X,o.Y,0);var r=(e.X+o.X)/2;var s=(e.Y+o.Y)/2;var h=40/a;var m=(o.Y-e.Y)/(o.X-e.X);var d=-1/m;var u=s-d*r;var p=Math.floor(Math.abs(m));if(l===undefined||l===null||l!==undefined&&l!==null&&l.length===0){this.Points["Label"][0]=new n.AnnotationPoint;if(p===0){h=40/a;if(m!==0){this.Points["Label"][0].Y=s+(d<0?-h:h);this.Points["Label"][0].X=(this.Points["Label"][0].Y-u)/d}else{this.Points["Label"][0].Y=s-h;this.Points["Label"][0].X=r}}else{this.Points["Label"][0].X=r+(d<0?-h:h);this.Points["Label"][0].Y=d*this.Points["Label"][0].X+u}}}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r=5/o;var s=this.ReferenceAnnotation.groupName;var h=this.ReferenceAnnotation.annotation.Points[s];var m=this.calculateProjectionPoint(h[0],h[1],this.TemporalPoint);var d=new n.Vector2D(h[0],m);var u=new n.Vector2D(m,h[1]);var p=new n.Vector2D(h[0],h[1]);var c=new n.Vector2D(d.SubstractVectorToPoint(this.TemporalPoint.Clone()),u.AddVectorToAnnotationPoint(this.TemporalPoint.Clone()));this.Points["EndPoints"]=new Array;var A=this.Points["EndPoints"];var C=this.Points["Label"];var S=this.Points["OffsetPoint"];t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.PeterRiver;if(this.IsEditionMode){var g=0;if(this.IndexPointDrag===0)g=1;var I=new n.AnnotationPoint;I=p.AddVectorToAnnotationPoint(this.TemporalPoint.Clone());var I=this.calculateProjectionPoint(this.TemporalPoint,this.Points["EndPoints"][g],m);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.PeterRiver;this.drawCircle(t,I,r);this.drawCircle(t,h[0],r);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawLine(t,this.TemporalPoint,I)}else{this.vectorParallelLine=new n.Vector2D(c.P1,c.P2);this.Points["EndPoints"].push(this.vectorParallelLine.P1);this.Points["EndPoints"].push(this.vectorParallelLine.P2);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.PeterRiver;this.drawCircle(t,m,r);this.drawCircle(t,this.TemporalPoint,r);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawPreviewLine(t,this.TemporalPoint,p,.25)}var P=this.Context.Viewport.AnnotationManager.GetAllAnnotationsNearToPoint(this.TemporalPoint.X,this.TemporalPoint.Y);if(P!==null){P.DrawSnaps()}}drawPreviewLine(t,e,n,o){this.drawDashedLine(t,n.Clone().ScalarMult(o).AddVectorToAnnotationPoint(e),n.Clone().ScalarMult(-o).AddVectorToAnnotationPoint(e))}drawCircle(t,e,n){t.beginPath();t.setLineDash([]);t.arc(e.X,e.Y,n,0,2*Math.PI,true);t.stroke();t.closePath()}drawDashedLine(t,e,n){t.beginPath();t.setLineDash([5,5]);t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}drawLine(t,e,n){t.beginPath();t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}calculateProjectionPoint(t,e,o){var l=new n.Vector2D(t,e);return l.CalculateProjectionOrthogonal(o)}calculateLineParams(t){}fillSnapPoints(){var t=this.Points["EndPoints"];var e=this.Points["OffsetPoint"];this.SnapPoints=new Array;this.SnapPoints.push(t[1]);this.SnapPoints.push(t[0]);this.SnapPoints.push(e[0])}fillReferenceObject(){if(this.Points["ReferencePoints"]!==undefined){if(this.referenceAnnotationId){var t=this.Context.Viewport.AnnotationManager.GetAnnotationPerId(this.referenceAnnotationId);if(t){this.ReferenceAnnotation={annotation:t,groupName:this.referenceAnnotationGroupName}}}else{for(var e=0;e<this.Points["ReferencePoints"].length;e++){var n=this.Points["ReferencePoints"][e];var o=this.Context.Viewport.AnnotationManager.GetPointInDetectAnnotation(n,true);if(o!==null){this.ReferenceAnnotation={annotation:o.annotation,groupName:o.group};break}}}}}}t.ParallelLineAnnotation=ParallelLineAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class PerpendicularLineAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["OffsetPoint"]=new Array;this.Points["EndPoints"]=new Array;this.Points["SnapPoints"]=new Array;this.Points["ReferencePoints"]=new Array;this.Points["Label"]=new Array;this.Vectors={};this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsEditionMode=false;this.IsReferable=true;this.FactorScale=1;this.vectorPerpendicularLine=new n.Vector2D(new n.AnnotationPoint,new n.AnnotationPoint);this.IsLineType=true;this.isRestore=false}Render(){if(!this.Visible)return;var t;try{t=this.Context.Viewport.ViewportElement.getContext("2d");this.isRestore=false;t.save();var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r=5/o;t.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;t.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;t.strokeStyle=this.Selected===true?e.Colors.Emerald:t.strokeStyle;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var s=this.Points["OffsetPoint"];var h=this.Points["Label"];var m=this.Points["EndPoints"];if(this.Status===n.EAnnotationStatus.Complete){if(this.ReferenceAnnotation===undefined){this.fillReferenceObject()}}if(this.ReferenceAnnotation!==null&&this.ReferenceAnnotation!==undefined){this.Points["ReferencePoints"]=this.ReferenceAnnotation.annotation.Points["EndPoints"];var d=this.ReferenceAnnotation.groupName;var u=this.ReferenceAnnotation.annotation.Points[d];if(s.length>0){var p=new n.Vector2D(u[0],u[1]);var c=n.Geometry.CalculateProjectionPoint(u[0],u[1],this.Points["EndPoints"][0]);var A=new n.Vector2D(u[0],c);var C=new n.Vector2D(u[1],c);if(this.IsEditionMode){var S=n.Geometry.CalculateProjectionPoint(u[0],u[1],this.Points["EndPoints"][0]);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawLine(t,S,this.Points["EndPoints"][0]);this.Points["EndPoints"][1]=S;t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.SunFlower;this.drawCircle(t,this.Points["EndPoints"][0],r);this.drawCircle(t,S,r);this.IsEditionMode=false}else{t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;if(this.Points["EndPoints"][0]===undefined){this.Points["EndPoints"][0]=this.Points["OffsetPoint"][0].Clone()}this.drawLine(t,c,this.Points["EndPoints"][0]);this.Points["EndPoints"][1]=c;t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.SunFlower;this.drawCircle(t,this.Points["EndPoints"][0],r);this.drawCircle(t,c,r)}var g=p.Clone();this.vectorPerpendicularLine=new n.Vector2D(this.Points["EndPoints"][1],this.Points["EndPoints"][0]);if(A.Norm()>p.Norm()&&C.Norm()<p.Norm()||(C.Norm()>p.Norm()||A.Norm()<p.Norm())){t.beginPath();t.setLineDash([5,5]);if(A.Norm()+C.Norm()-p.Norm()>.5){if(A.Norm()>C.Norm()){this.drawLine(t,C.P1,c);g=new n.Vector2D(c.Clone(),C.P1.Clone())}else{this.drawLine(t,A.P1,c);g=new n.Vector2D(c.Clone(),A.P1.Clone())}}t.stroke();t.closePath()}var I=10;var P=g.Clone().Normalize().ScalarMult(I).AddVectorToAnnotationPoint(c.Clone());var f=this.vectorPerpendicularLine.Clone().Normalize().ScalarMult(I).AddVectorToAnnotationPoint(c.Clone());var w=g.Clone().Normalize().ScalarMult(I).AddVectorToAnnotationPoint(f.Clone());t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;t.setLineDash([]);this.drawLine(t,P,w);this.drawLine(t,f,w)}t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;if(this.Status===n.EAnnotationStatus.Complete){if(this.Points["EndPoints"].length===2){this.vectorPerpendicularLine=new n.Vector2D(this.Points["EndPoints"][0],this.Points["EndPoints"][1]);if(this.vectorPerpendicularLine!==null||this.vectorPerpendicularLine!==undefined){this.DrawTextLabel(t,this.Points["EndPoints"][0],this.Points["EndPoints"][1]);if(h.length>0){var b=this.vectorPerpendicularLine.MidPoint().X;var v=this.vectorPerpendicularLine.MidPoint().Y;if(this.vectorPerpendicularLine.P2.X!==h[0].X||this.vectorPerpendicularLine.P2.Y!==h[0].Y){t.dashedLine(t,b,v,h[0].X,h[0].Y,3/o)}var T=this.MeasureAnnotation(this.vectorPerpendicularLine.P1,this.vectorPerpendicularLine.P2);var F=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,b,v,h[0].X,h[0].Y,T,a);this.TextboxLabel[0]={X0:F.X0,X1:F.X1,Y0:F.Y0,Y1:F.Y1,Text:T}}}}this.fillSnapPoints();if(this.IsReferenced){this.Context.Viewport.AnnotationManager.DrawReferenceLine(t);this.Selected=false}}if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){}}t.restore();this.isRestore=true}catch(n){if(!this.isRestore&&t!==undefined)t.restore();e.Utils.DebugConsoleLog("Error drawing PerpendicularLayout Annotation")}}DrawIsValid(){var t=true;return t}VectorsCalculate(){}HitTest(t,e){if(this.vectorPerpendicularLine!==null&&this.vectorPerpendicularLine!==undefined){if(this.ReferenceAnnotation!==null&&this.ReferenceAnnotation!==undefined){if(n.Geometry.PointToLine(t.X,t.Y,this.vectorPerpendicularLine.P1.X,this.vectorPerpendicularLine.P1.Y,this.vectorPerpendicularLine.P2.X,this.vectorPerpendicularLine.P2.Y)<e)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"}}}return{isFound:false,groupName:null,endRangePoints:""}}DrawGrips(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["OffsetPoint"];var o=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(t,n,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,o,e)}DrawSnaps(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(t,n,e)}EvaluateAnnotationTextInCanvas(t){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],t);return false}MeasureAnnotation(t,e){var n;var o=this.Context.ImageEntity["pixelSpacing"][0];var l=this.Context.ImageEntity["pixelSpacing"][1];var a=this.Context.ImageEntity["pixelSpacing"][2];if(this.vectorPerpendicularLine!==undefined&&this.vectorPerpendicularLine!==null){if(t===undefined||t===null)t=this.vectorPerpendicularLine.P1;if(e===undefined||e===null)e=this.vectorPerpendicularLine.P2;var r=t.X*o;var s=t.Y*l;var h=e.X*o;var m=e.Y*l;var d=Math.sqrt((h-r)*(h-r)+(m-s)*(m-s));n=parseFloat(d.toFixed(1))+" "+a}return n}GetTemplate(){var e=t.ResourceBag.PerpendicularLineTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){if(e==="EndPoints"||e==="OffsetPoint"){this.IsEditionMode=true}return true}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,Step:this.Step,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,IsEditionMode:this.IsEditionMode,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"],ReferenceId:this.ReferenceAnnotation.annotation.Id,ReferenceAnnotationGroupName:this.ReferenceAnnotation.groupName};t=JSON.stringify(e);return t}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Date=e["Date"]||e["date"];this.Type=e["Type"]||e["type"];this.Plugin=e["Plugin"]||e["plugin"];this.Selected=e["Selected"]||e["selected"];this.Status=e["Status"]||e["status"];this.Step=e["Step"]||e["step"];this.TextboxLabel=e["TextboxLabel"]||e["textboxLabel"];this.IsEditionMode=e["IsEditionMode"]||e["IsEditionMode"];var o=e["Points"]||e["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=e["Name"]||e["name"];this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"]);this.referenceAnnotationId=e["ReferenceId"]||e["referenceId"];this.referenceAnnotationGroupName=e["ReferenceAnnotationGroupName"]||e["referenceAnnotationGroupName"]}ConvertPointsWithFactororResolution(t){}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r=5/o;t.lineWidth=2/o;t.strokeStyle=this.Selected===true?e.Colors.Emerald:e.Colors.Silver;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.BelizeHole;t.textAlign="center";t.textBaseline="bottom";var s=this.ReferenceAnnotation.groupName;var h=this.ReferenceAnnotation.annotation.Points[s];var m=n.Geometry.CalculateProjectionPoint(h[0],h[1],this.TemporalPoint);var d=new n.Vector2D(h[0],h[1]);var u=new n.Vector2D(h[0],m);var p=new n.Vector2D(m,h[1]);if(this.IsEditionMode){m=n.Geometry.CalculateProjectionPoint(h[0],h[1],this.TemporalPoint);this.drawCircle(t,this.TemporalPoint,r);this.drawCircle(t,m,r);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawDashedLine(t,m,this.TemporalPoint)}else{t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Carrot;this.drawCircle(t,this.TemporalPoint,r);this.drawCircle(t,m,r);t.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Concrete;this.drawDashedLine(t,m,this.TemporalPoint)}if(u.Norm()>d.Norm()&&p.Norm()<d.Norm()||(p.Norm()>d.Norm()||u.Norm()<d.Norm())){if(u.Norm()+p.Norm()-d.Norm()>.5){if(u.Norm()>p.Norm()){this.drawLine(t,p.P2,m)}else{this.drawLine(t,u.P1,m)}t.stroke();t.closePath()}}}calculateLineParams(t){}DrawTextLabel(t,e,o){var l=this.Points["Label"];var a=Math.abs(this.Context.ScaleX);t.dashedLine(t,e.X,e.Y,o.X,o.Y,0);var r=(e.X+o.X)/2;var s=(e.Y+o.Y)/2;var h=40/a;var m=(o.Y-e.Y)/(o.X-e.X);var d=-1/m;var u=s-d*r;var p=Math.floor(Math.abs(m));if(l===undefined||l===null||l!==undefined&&l!==null&&l.length===0){this.Points["Label"][0]=new n.AnnotationPoint;if(p===0){h=40/a;if(m!==0){this.Points["Label"][0].Y=s+(d<0?-h:h);this.Points["Label"][0].X=(this.Points["Label"][0].Y-u)/d}else{this.Points["Label"][0].Y=s-h;this.Points["Label"][0].X=r}}else{this.Points["Label"][0].X=r+(d<0?-h:h);this.Points["Label"][0].Y=d*this.Points["Label"][0].X+u}}}drawCircle(t,e,n){t.beginPath();t.setLineDash([]);t.arc(e.X,e.Y,n,0,2*Math.PI,true);t.stroke();t.closePath()}drawDashedLine(t,e,n){t.beginPath();t.setLineDash([5,5]);t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}drawLine(t,e,n){t.beginPath();t.dashedLine(t,e.X,e.Y,n.X,n.Y,0);t.stroke();t.closePath()}fillSnapPoints(){var t=this.Points["OffsetPoint"];this.Points["SnapPoints"]=new Array;this.Points["SnapPoints"].push(t[0])}fillReferenceObject(){if(this.Points["ReferencePoints"]!==undefined){if(this.referenceAnnotationId){var t=this.Context.Viewport.AnnotationManager.GetAnnotationPerId(this.referenceAnnotationId);if(t){this.ReferenceAnnotation={annotation:t,groupName:this.referenceAnnotationGroupName}}}else{for(var e=0;e<this.Points["ReferencePoints"].length;e++){var n=this.Points["ReferencePoints"][e];var o=this.Context.Viewport.AnnotationManager.GetPointInDetectAnnotation(n,true);if(o!==null){this.ReferenceAnnotation={annotation:o.annotation,groupName:o.group};break}}}}}}t.PerpendicularLineAnnotation=PerpendicularLineAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class ReferenceLineAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["Label"]=new Array;this.Points["SnapPoints"]=new Array;this.Points["Polar"]=new Array;this.Vectors={};this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=true;this.ExportedPoints=[];this.FactorScale=1;this.IsLineType=true}GetExportedPoints(){if(this.Points["EndPoints"].length===2){this.ExportedPoints[0]=this.Points["EndPoints"][0];this.ExportedPoints[1]=this.Points["EndPoints"][1]}return this.ExportedPoints}Render(){if(!this.Visible)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r;var s;t.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected!==true?2/o:1/o;t.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;t.strokeStyle=this.Selected===true?e.Colors.Emerald:t.strokeStyle;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";this.renderIncomplete();this.TemporalCurrentGroupName=null;this.TemporalPoint=null;var h=this.Points["EndPoints"];if(h.length===2)this.DrawTextLabel(t,h[0],h[1]);if(this.Status===n.EAnnotationStatus.Complete){r=(h[0].X+h[1].X)/2;s=(h[0].Y+h[1].Y)/2;if(h[1].X!==this.Points["Label"][0].X||h[1].Y!==this.Points["Label"][0].Y){t.dashedLine(t,r,s,this.Points["Label"][0].X,this.Points["Label"][0].Y,3/o)}var m=this.MeasureAnnotation(h[0],h[1]);var d=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,r,s,this.Points["Label"][0].X,this.Points["Label"][0].Y,m,a);this.TextboxLabel[0]={X0:d.X0,X1:d.X1,Y0:d.Y0,Y1:d.Y1,Text:m};this.fillSnapPoints();if(this.IsReferenced){this.Context.Viewport.AnnotationManager.DrawReferenceLine(t);this.Selected=false}}this.VectorsCalculate();if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}}DrawIsValid(){var t=false;var e=3;var o=this.Points["EndPoints"];if(o.length===2){var l=n.Geometry.GetRealDistance(o[0],o[1],this.Context);t=l>e}else t=true;return t}VectorsCalculate(){if(this.Points["EndPoints"].length===2){var t=new n.AnnotationVector;t.Point1=this.Points["EndPoints"][0];t.Point2=this.Points["EndPoints"][1];t.Calculator();this.Vectors["VectorA"]=t}if(this.Status===n.EAnnotationStatus.Complete){var e=new n.AnnotationVector;e.Point1=this.Points["EndPoints"][1];e.Point2=this.Points["Label"][0];e.Calculator();this.Vectors["VectorB"]=e}}HitTest(t,e){var o=this.Points["EndPoints"];if(n.Geometry.PointToLine(t.X,t.Y,o[0].X,o[0].Y,o[1].X,o[1].Y)<e)return{isFound:true,groupName:"EndPoints",endRangePoints:"0,0-1,1"};return{isFound:false,groupName:null,endRangePoints:""}}DrawGrips(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["EndPoints"];var o=this.Points["Label"];this.Context.Viewport.AnnotationManager.DrawGrips(t,n,e);this.Context.Viewport.AnnotationManager.DrawGrips(t,[o[0]],e)}DrawSnaps(){var t=this.Context.Viewport.ViewportElement.getContext("2d");var e=Math.abs(this.Context.ScaleX);var n=this.Points["SnapPoints"];this.Context.Viewport.AnnotationManager.DrawSnapsPoints(t,n,e)}EvaluateAnnotationTextInCanvas(t){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0)return n.AnnotationManager.EvaluateAnnotationTextInCanvas(this.TextboxLabel[0],t);return false}MeasureAnnotation(t,e){var n;var o=this.Context.ImageEntity["pixelSpacing"][0];var l=this.Context.ImageEntity["pixelSpacing"][1];var a=this.Context.ImageEntity["pixelSpacing"][2];var r;var s;var h;var m;var d=this.Points["EndPoints"];if(t===undefined||t===null)t=d[0];if(e===undefined||e===null)e=d[1];r=t.X*o;s=t.Y*l;h=e.X*o;m=e.Y*l;var u=Math.sqrt((h-r)*(h-r)+(m-s)*(m-s));n=parseFloat(u.toFixed(1))+" "+a;return n}GetTemplate(){var e=t.ResourceBag.ReferenceLineTemplateJson;return e}EvaluatePointDragMoveAndEnd(t,e,n){Efferent.ClientViews.ImagingStudyView.Geometry.CalculateTextWithPoints(this.Points,t,e,n,this.Context);return true}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Points:this.Points,Selected:this.Selected,Status:this.Status,Step:this.Step,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};t=JSON.stringify(e);return t}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Date=e["Date"]||e["date"];this.Type=e["Type"]||e["type"];this.Plugin=e["Plugin"]||e["plugin"];this.Selected=e["Selected"]||e["selected"];this.Status=e["Status"]||e["status"];this.Step=e["Step"]||e["step"];this.TextboxLabel=e["TextboxLabel"]||e["textboxLabel"];var o=e["Points"]||e["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.Name=e["Name"]||e["name"];this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"])}ConvertPointsWithFactororResolution(t){}renderIncomplete(){if(this.TemporalPoint===undefined||this.TemporalPoint===null||(this.TemporalCurrentGroupName===undefined||this.TemporalCurrentGroupName===null))return;if(this.Status===n.EAnnotationStatus.Complete)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r;var s;t.lineWidth=2/o;t.strokeStyle=this.Selected===true?e.Colors.Emerald:e.Colors.SunFlower;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";var h=this.Points["EndPoints"];if(this.Points[this.TemporalCurrentGroupName].length===1){this.DrawTextLabel(t,h[0],this.TemporalPoint);r=(h[0].X+this.TemporalPoint.X)/2;s=(h[0].Y+this.TemporalPoint.Y)/2;if(this.TemporalPoint.X!==this.Points["Label"][0].X||this.TemporalPoint.Y!==this.Points["Label"][0].Y){t.dashedLine(t,r,s,this.Points["Label"][0].X,this.Points["Label"][0].Y,3/o)}var m=this.MeasureAnnotation(h[0],this.TemporalPoint);this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,r,s,this.Points["Label"][0].X,this.Points["Label"][0].Y,m,a)}var d=this.Context.Viewport.AnnotationManager.GetAllAnnotationsNearToPoint(this.TemporalPoint.X,this.TemporalPoint.Y);if(d!==null){d.DrawSnaps()}}fillSnapPoints(){var t=this.Points["EndPoints"];var e=new n.AnnotationPoint;e.X=(t[0].X+t[1].X)/2;e.Y=(t[0].Y+t[1].Y)/2;this.Points["SnapPoints"]=new Array;this.Points["SnapPoints"].push(t[0]);this.Points["SnapPoints"].push(t[1]);this.Points["SnapPoints"].push(e)}DrawTextLabel(t,e,o){t.dashedLine(t,e.X,e.Y,o.X,o.Y,0);if(this.Status!==n.EAnnotationStatus.Complete){n.Geometry.SetLabelOnLine(this.Points,e,o,0,this.Context)}}}t.ReferenceLineAnnotation=ReferenceLineAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;let o;(function(t){t[t["Left"]=0]="Left";t[t["Right"]=1]="Right"})(o=t.EShoulderTemplateSide||(t.EShoulderTemplateSide={}));class ShoulderImplantAnnotation{constructor(){this.glenosphereImplantInsertPoint=new e.Point(0,0);this.glenoidImplantInsertPoint=new e.Point(0,0);this.humeralHeadImplantInsertPoint=new e.Point(0,0);this.stemImplantInsertPoint=new e.Point(0,0);this.glenosphereRotationAngle=0;this.glenoidRotationAngle=0;this.humeralHeadRotationAngle=0;this.stemRotationAngle=0;this.UnSelectToExecuteClickOnViewport=false;this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Selected=false;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.SnapPoints=new Array;this.Points["Label"]=new Array;this.Points["Polar"]=new Array;this.shoulderSide=o.Right;this.ReadyForRender=false;this.isRestore=false;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1;this.CanDragPoint=false;this.ViewDirection=t.EViewCiss.AP;this.CanSavedInSpecialStructure=true;this.OrthoStemImplant=new t.OrthoTemplate(this,t.EShoulderImplant[t.EShoulderImplant.Stem]);this.OrthoGlenosphereImplant=new t.OrthoTemplate(this,t.EShoulderImplant[t.EShoulderImplant.Glenosphere]);this.OrthoHumeralHeadImplant=new t.OrthoTemplate(this,t.EShoulderImplant[t.EShoulderImplant.Humeral_Head]);this.OrthoGlenoidImplant=new t.OrthoTemplate(this,t.EShoulderImplant[t.EShoulderImplant.Glenoid])}Render(){var n;try{n=this.Context.Viewport.ViewportElement.getContext("2d");this.isRestore=false;n.save();var l=Math.abs(this.Context.ScaleX);var a=Math.round(11/l*10)/10;var r=this.Context.Viewport.Context.ImageEntity["pixelSpacing"][0];var s=this.Context.Viewport.Context.ImageEntity["pixelSpacing"][1];var h=r||s;if(this.Selected===undefined)this.Selected=false;n.textAlign="center";n.textBaseline="bottom";n.font=a+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";n.strokeStyle=this.Selected?e.Colors.Emerald:e.Colors.Alizarin;n.restore();this.isRestore=true;if(this.OrthoGlenosphereImplant.ImplantReadyForDraw){let t=this.GetShoulderSideNumeric();this.OrthoGlenosphereImplant.RenderImplant(this.Context,n,t)}else{this.OrthoGlenosphereImplant.LoadImplantFromSVG((()=>{this.renderViewport(this.Context)}))}if(this.OrthoGlenoidImplant.ImplantReadyForDraw){let t=this.GetShoulderSideNumeric();this.OrthoGlenoidImplant.RenderImplant(this.Context,n,t)}else{this.OrthoGlenoidImplant.LoadImplantFromSVG((()=>{this.renderViewport(this.Context)}))}if(this.OrthoHumeralHeadImplant.ImplantReadyForDraw){let t=this.GetShoulderSideNumeric();this.OrthoHumeralHeadImplant.RenderImplant(this.Context,n,t)}else{this.OrthoHumeralHeadImplant.LoadImplantFromSVG((()=>{this.renderViewport(this.Context)}))}if(this.OrthoStemImplant.ImplantReadyForDraw){let t=this.GetShoulderSideNumeric();if(t>0){if(this.OrthoStemImplant.StemtoHumeralComp.X<0&&this.shoulderSide!==o.Left){this.OrthoStemImplant.RenderImplant(this.Context,n,t*-1)}else{this.OrthoStemImplant.RenderImplant(this.Context,n,t)}}if(t<0){var m=this.OrthoStemImplant.StemtoHumeralComp.X>0&&this.shoulderSide===o.Left;if(m){this.OrthoStemImplant.RenderImplant(this.Context,n,t)}else{this.OrthoStemImplant.RenderImplant(this.Context,n,t*-1)}}}else{this.OrthoStemImplant.LoadImplantFromSVG((()=>{this.renderViewport(this.Context)}))}t.OrthoPlugin.RenderViewCiss(this.Context.Viewport,this.ViewDirection,this.shoulderSide===o.Left,true,a)}catch(t){if(!this.isRestore&&n!==undefined)n.restore();e.Utils.DebugConsoleLog("Error drawing ShoulderImplant Annotation")}}GetShoulderSideNumeric(){return this.shoulderSide===o.Left?-1:1}GetShoulderSide(){return this.shoulderSide}SetShoulderSide(t){this.shoulderSide=t}GetInitialGlenosphereImplantPosition(){return this.glenosphereImplantInsertPoint}GetInitialGlenoidImplantPosition(){return this.glenoidImplantInsertPoint}GetInitialHumeralHeadImplantPosition(){return this.humeralHeadImplantInsertPoint}GetInitialStemImplantPosition(){return this.stemImplantInsertPoint}GetInitialGlenosphereImplantRotationAngle(){let t;t=this.glenosphereRotationAngle===0?0:(2*Math.PI-(3*Math.PI/2-this.glenosphereRotationAngle))%(2*Math.PI);return t}GetInitialGlenoidImplantRotationAngle(){let t;t=this.glenoidRotationAngle===0?0:(2*Math.PI-(3*Math.PI/2-this.glenoidRotationAngle))%(2*Math.PI);return t}GetInitialHumeralHeadImplantRotationAngle(){let t;t=this.humeralHeadRotationAngle===0?0:(2*Math.PI-(3*Math.PI/2-this.humeralHeadRotationAngle))%(2*Math.PI);return t}GetInitialStemImplantRotationAngle(){let t;t=this.stemRotationAngle===0?0:(2*Math.PI-(3*Math.PI/2-this.stemRotationAngle))%(2*Math.PI);return t}HitTest(t,e){var n=Math.abs(this.Context.ScaleX);var o=null;var l=false;return{isFound:l,groupName:o,endRangePoints:""}}EvaluateAnnotationTextInCanvas(t){return false}MeasureAnnotation(t,e,n){}DrawGrips(){throw new Error("Method not implemented.")}DrawSnaps(){throw new Error("Method not implemented.")}Serialize(){var t={Id:this.Id,Author:this.Author,Date:this.Date,Points:this.Points,Type:this.Type,Status:this.Status,TextboxLabel:this.TextboxLabel,Name:this.Name,Plugin:this.Plugin,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ShoulderSide:this.shoulderSide,implantStemManufacturer:encodeURI(this.OrthoStemImplant.ImplantManufacturer),ImplantStemProductLine:encodeURI(this.OrthoStemImplant.ImplantProductLine),ImplantStemComponentFamily:encodeURI(this.OrthoStemImplant.ImplantComponentFamily),ImplantsStemPatientSide:encodeURI(this.OrthoStemImplant.ImplantPatientSide),ImplantStemSize:this.OrthoStemImplant.ImplantSize,ImplantStemPositionX:this.OrthoStemImplant.PositionX,ImplantStemPositionY:this.OrthoStemImplant.PositionY,ImplantStemOffsetX:this.OrthoStemImplant.OffsetX,ImplantStemOffsetY:this.OrthoStemImplant.OffsetY,ImplantStemRotation:this.OrthoStemImplant.Rotation,ImplantStemSvgPath:this.OrthoStemImplant.ImplantSvgUrl,FemoralHeadDiameter:this.OrthoStemImplant.AFemoralHeadDiameter,FemoralHeadOffset:this.OrthoStemImplant.AFemoralHeadOffset,ImplantStemComponentName:this.OrthoStemImplant.ComponentName,ImplantGlenosphereManufacturer:encodeURI(this.OrthoGlenosphereImplant.ImplantManufacturer),ImplantGlenosphereProductLine:encodeURI(this.OrthoGlenosphereImplant.ImplantProductLine),ImplantGlenosphereComponentFamily:encodeURI(this.OrthoGlenosphereImplant.ImplantComponentFamily),ImplantGlenosphereSize:this.OrthoGlenosphereImplant.ImplantSize,ImplantGlenospherePositionX:this.OrthoGlenosphereImplant.PositionX,ImplantGlenospherePositionY:this.OrthoGlenosphereImplant.PositionY,ImplantGlenosphereOffsetX:this.OrthoGlenosphereImplant.OffsetX,ImplantGlenosphereOffsetY:this.OrthoGlenosphereImplant.OffsetY,ImplantGlenosphereRotation:this.OrthoGlenosphereImplant.Rotation,ImplantGlenosphereSvgPath:this.OrthoGlenosphereImplant.ImplantSvgUrl,ImplantGlenosphereComponentName:this.OrthoGlenosphereImplant.ComponentName,ImplantGlenoidManufacturer:encodeURI(this.OrthoGlenoidImplant.ImplantManufacturer),ImplantGlenoidProductLine:encodeURI(this.OrthoGlenoidImplant.ImplantProductLine),ImplantGlenoidComponentFamily:encodeURI(this.OrthoGlenoidImplant.ImplantComponentFamily),ImplantGlenoidSize:this.OrthoGlenoidImplant.ImplantSize,ImplantGlenoidPositionX:this.OrthoGlenoidImplant.PositionX,ImplantGlenoidPositionY:this.OrthoGlenoidImplant.PositionY,ImplantGlenoidOffsetX:this.OrthoGlenoidImplant.OffsetX,ImplantGlenoidOffsetY:this.OrthoGlenoidImplant.OffsetY,ImplantGlenoidRotation:this.OrthoGlenoidImplant.Rotation,ImplantGlenoidSvgPath:this.OrthoGlenoidImplant.ImplantSvgUrl,ImplantGlenoidComponentName:this.OrthoGlenoidImplant.ComponentName,ImplantHumeralheadManufacturer:encodeURI(this.OrthoHumeralHeadImplant.ImplantManufacturer),ImplantHumeralheadProductLine:encodeURI(this.OrthoHumeralHeadImplant.ImplantProductLine),ImplantHumeralheadComponentFamily:encodeURI(this.OrthoHumeralHeadImplant.ImplantComponentFamily),ImplantHumeralheadSize:this.OrthoHumeralHeadImplant.ImplantSize,ImplantHumeralheadPositionX:this.OrthoHumeralHeadImplant.PositionX,ImplantHumeralheadPositionY:this.OrthoHumeralHeadImplant.PositionY,ImplantHumeralheadOffsetX:this.OrthoHumeralHeadImplant.OffsetX,ImplantHumeralheadOffsetY:this.OrthoHumeralHeadImplant.OffsetY,ImplantHumeralheadRotation:this.OrthoHumeralHeadImplant.Rotation,ImplantHumeralheadSvgPath:this.OrthoHumeralHeadImplant.ImplantSvgUrl,ImplantHumeralheadComponentName:this.OrthoHumeralHeadImplant.ComponentName,ViewDirection:this.ViewDirection,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};var e=JSON.stringify(t);return e}Deserialize(o){var l,a,r,s,h,m,d,u,p,c,A,C,S,g,I,P,f,w,b;var v=JSON.parse(o);this.Id=(l=v["Id"])!==null&&l!==void 0?l:v["id"];this.Author=(a=v["Author"])!==null&&a!==void 0?a:v["author"];this.Date=(r=v["Date"])!==null&&r!==void 0?r:v["date"];this.Plugin=(s=v["Plugin"])!==null&&s!==void 0?s:v["plugin"];var T=(h=v["Points"])!==null&&h!==void 0?h:v["points"];this.Points=n.AnnotationController.ConvertSamplePoints(T);this.Type=(m=v["Type"])!==null&&m!==void 0?m:v["type"];this.Status=(d=v["Status"])!==null&&d!==void 0?d:v["status"];this.TextboxLabel=(u=v["TextboxLabel"])!==null&&u!==void 0?u:v["TextboxLabel"];this.Name=(p=v["Name"])!==null&&p!==void 0?p:v["name"];this.Selected=(c=v["Selected"])!==null&&c!==void 0?c:v["selected"];this.Plugin=(A=v["Plugin"])!==null&&A!==void 0?A:v["plugin"];this.ColsOrigin=parseInt((C=v["ColsOrigin"])!==null&&C!==void 0?C:v["colsOrigin"]);this.RowsOrigin=parseInt((S=v["RowsOrigin"])!==null&&S!==void 0?S:v["rowsOrigin"]);this.ViewDirection=(g=v["ViewDirection"])!==null&&g!==void 0?g:v["viewDirection"];this.shoulderSide=(I=v["ShoulderSide"])!==null&&I!==void 0?I:v["shoulderSide"];let F=(P=v["ImplantStemComponentName"])!==null&&P!==void 0?P:v["implantStemComponentName"];this.OrthoStemImplant=new t.OrthoTemplate(this,F!==null&&F!==void 0?F:t.EShoulderImplant[t.EShoulderImplant.Stem]);this.OrthoStemImplant.ImplantManufacturer=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantStemManufacturer"]||v["implantStemManufacturer"]));this.OrthoStemImplant.ImplantProductLine=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantStemProductLine"]||v["implantStemProductLine"]));this.OrthoStemImplant.ImplantComponentFamily=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantStemComponentFamily"]||v["implantStemComponentFamily"]));this.OrthoStemImplant.ImplantPatientSide=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantsStemPatientSide"]||v["implantsStemPatientSide"]));this.OrthoStemImplant.ImplantSize=v["ImplantStemSize"]||v["implantStemSize"];this.OrthoStemImplant.PositionX=v["ImplantStemPositionX"]||v["implantStemPositionX"]||0;this.OrthoStemImplant.PositionY=v["ImplantStemPositionY"]||v["implantStemPositionY"]||0;this.OrthoStemImplant.OffsetX=v["ImplantStemOffsetX"]||v["implantStemOffsetX"]||0;this.OrthoStemImplant.OffsetY=v["ImplantStemOffsetY"]||v["ImplantStemOffsetY"]||0;this.OrthoStemImplant.Rotation=v["ImplantStemRotation"]||v["implantStemRotation"]||0;this.OrthoStemImplant.ImplantSvgUrl=v["ImplantStemSvgPath"]||v["implantStemSvgPath"]||null;this.OrthoStemImplant.AFemoralHeadDiameter=v["FemoralHeadDiameter"]||v["femoralHeadDiameter"];this.OrthoStemImplant.AFemoralHeadOffset=v["FemoralHeadOffset"]||v["femoralHeadOffset"];this.OrthoStemImplant.ComponentName=F;let O=(f=v["ImplantGlenosphereComponentName"])!==null&&f!==void 0?f:v["implantGlenosphereComponentName"];this.OrthoGlenosphereImplant=new t.OrthoTemplate(this,F!==null&&F!==void 0?F:t.EShoulderImplant[t.EShoulderImplant.Glenosphere]);this.OrthoGlenosphereImplant.ImplantManufacturer=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantGlenosphereManufacturer"]||v["implantGlenosphereManufacturer"]));this.OrthoGlenosphereImplant.ImplantProductLine=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantGlenosphereProductLine"]||v["implantGlenosphereProductLine"]));this.OrthoGlenosphereImplant.ImplantComponentFamily=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantGlenosphereComponentFamily"]||v["implantGlenosphereComponentFamily"]));this.OrthoGlenosphereImplant.ImplantSize=v["ImplantGlenosphereSize"]||v["implantGlenosphereSize"];this.OrthoGlenosphereImplant.PositionX=v["ImplantGlenospherePositionX"]||v["implantGlenospherePositionX"]||0;this.OrthoGlenosphereImplant.PositionY=v["ImplantGlenospherePositionY"]||v["implantGlenospherePositionY"]||0;this.OrthoGlenosphereImplant.OffsetX=v["ImplantGlenosphereOffsetX"]||v["implantGlenosphereOffsetX"]||0;this.OrthoGlenosphereImplant.OffsetY=v["ImplantGlenosphereOffsetY"]||v["implantGlenosphereOffsetY"]||0;this.OrthoGlenosphereImplant.Rotation=v["ImplantGlenosphereRotation"]||v["implantGlenosphereRotation"]||0;this.OrthoGlenosphereImplant.ImplantSvgUrl=v["ImplantGlenosphereSvgPath"]||v["implantGlenosphereSvgPath"]||null;this.OrthoGlenosphereImplant.ComponentName=O;let L=(w=v["ImplantGlenoidComponentName"])!==null&&w!==void 0?w:v["implantGlenoidComponentName"];this.OrthoGlenoidImplant=new t.OrthoTemplate(this,L!==null&&L!==void 0?L:t.EShoulderImplant[t.EShoulderImplant.Glenoid]);this.OrthoGlenoidImplant.ImplantManufacturer=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantGlenoidManufacturer"]||v["implantGlenoidManufacturer"]));this.OrthoGlenoidImplant.ImplantProductLine=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantGlenoidProductLine"]||v["implantGlenoidProductLine"]));this.OrthoGlenoidImplant.ImplantComponentFamily=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantGlenoidComponentFamily"]||v["implantGlenoidComponentFamily"]));this.OrthoGlenoidImplant.ImplantSize=v["ImplantGlenoidSize"]||v["implantGlenoidSize"];this.OrthoGlenoidImplant.PositionX=v["ImplantGlenoidPositionX"]||v["implantGlenoidPositionX"]||0;this.OrthoGlenoidImplant.PositionY=v["ImplantGlenoidPositionY"]||v["implantGlenoidPositionY"]||0;this.OrthoGlenoidImplant.OffsetX=v["ImplantGlenoidOffsetX"]||v["implantGlenoidOffsetX"]||0;this.OrthoGlenoidImplant.OffsetY=v["ImplantGlenoidOffsetY"]||v["implantGlenoidOffsetY"]||0;this.OrthoGlenoidImplant.Rotation=v["ImplantGlenoidRotation"]||v["implantGlenoidRotation"]||0;this.OrthoGlenoidImplant.ImplantSvgUrl=v["ImplantGlenoidSvgPath"]||v["implantGlenoidSvgPath"]||null;this.OrthoGlenoidImplant.ComponentName=L;let E=(b=v["ImplantHumeralheadComponentName"])!==null&&b!==void 0?b:v["implantHumeralheadComponentName"];this.OrthoHumeralHeadImplant=new t.OrthoTemplate(this,E!==null&&E!==void 0?E:t.EShoulderImplant[t.EShoulderImplant.Humeral_Head]);this.OrthoHumeralHeadImplant.ImplantManufacturer=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantHumeralheadManufacturer"]||v["implantHumeralheadManufacturer"]));this.OrthoHumeralHeadImplant.ImplantProductLine=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantHumeralheadProductLine"]||v["implantHumeralheadProductLine"]));this.OrthoHumeralHeadImplant.ImplantComponentFamily=e.Utils.EvaluateNullAndUndefined(decodeURI(v["ImplantHumeralheadComponentFamily"]||v["implantHumeralheadComponentFamily"]));this.OrthoHumeralHeadImplant.ImplantSize=v["ImplantHumeralheadSize"]||v["implantHumeralheadSize"];this.OrthoHumeralHeadImplant.PositionX=v["ImplantHumeralheadPositionX"]||v["implantHumeralheadPositionX"]||0;this.OrthoHumeralHeadImplant.PositionY=v["ImplantHumeralheadPositionY"]||v["implantHumeralheadPositionY"]||0;this.OrthoHumeralHeadImplant.OffsetX=v["ImplantHumeralheadOffsetX"]||v["implantHumeralheadOffsetX"]||0;this.OrthoHumeralHeadImplant.OffsetY=v["ImplantHumeralheadOffsetY"]||v["implantHumeralheadOffsetY"]||0;this.OrthoHumeralHeadImplant.Rotation=v["ImplantHumeralheadRotation"]||v["implantHumeralheadRotation"]||0;this.OrthoHumeralHeadImplant.ImplantSvgUrl=v["ImplantHumeralheadSvgPath"]||v["implantHumeralheadSvgPath"]||null;this.OrthoHumeralHeadImplant.ComponentName=E}GetTemplate(){var e=t.ResourceBag.ShoulderImplantTemplateJson;return e}DrawIsValid(){return true}EvaluatePointDragMoveAndEnd(t,e,n){return true}DonePointDragMoveAndEnd(t,e,n){}ConvertPointsWithFactororResolution(t){}renderViewport(t){if(t!==undefined){t.Renderer.Render();t.OverlayRenderer.Render()}}}t.ShoulderImplantAnnotation=ShoulderImplantAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;class SpineAnnotation{constructor(){this.TextboxLabel=new Array;this.Visible=true;this.Name=this.constructor.name;this.Namespace="Vue.Products.OrthoPlugin";this.Points={};this.Points["EndPoints"]=new Array;this.Points["SnapPoints"]=new Array;this.UnSelectToExecuteClickOnViewport=true;this.IsReferenced=false;this.ShowSnaps=false;this.IsReferable=false;this.FactorScale=1}Render(){if(!this.Visible)return;var t=this.Context.Viewport.ViewportElement.getContext("2d");var o=Math.abs(this.Context.ScaleX);var l=Math.round(11/o*10)/10;var a=16/o;var r=this.Context.ImageEntity["pixelSpacing"][0];t.lineWidth=this.Status!==n.EAnnotationStatus.Complete||this.Selected?2/o:1/o;t.strokeStyle=this.Status===n.EAnnotationStatus.Complete?e.Colors.SunFlower:e.Colors.SunFlower;t.strokeStyle=this.Selected?e.Colors.Emerald:t.strokeStyle;t.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";t.fillStyle=e.Colors.SunFlower;t.textAlign="center";t.textBaseline="bottom";var s=this.Points["EndPoints"];var h=this.Context.Viewport.AnnotationManager.DrawAnnotationText(t,null,null,s[0].X,s[0].Y,this.TextLabel,a);if(h!==null){this.TextboxLabel[0]={X0:h.X0,X1:h.X1,Y0:h.Y0,Y1:h.Y1,Text:this.TextLabel};this.fillSnapPoints()}if(this.Selected){this.DrawGrips()}if(this.ShowSnaps){this.DrawSnaps()}}DrawIsValid(){var t=true;return t}HitTest(t,e){return{isFound:false,groupName:null,endRangePoints:""}}EvaluateAnnotationTextInCanvas(t){if(this.TextboxLabel!==undefined&&this.TextboxLabel.length>0){var e=t.X>=this.TextboxLabel[0].X0;var n=t.X<=this.TextboxLabel[0].X1;var o=t.Y>=this.TextboxLabel[0].Y0;var l=t.Y<=this.TextboxLabel[0].Y1;if(e&&n&&o&&l)return true}return false}DrawGrips(){}DrawSnaps(){}MeasureAnnotation(){return""}GetTemplate(){var t=new n.AnnotationTemplate;t.ClassName="Vue.Products.OrthoPlugin.SpineAnnotation";t.Name="SpineAnnotation";var e=new n.AnnotationPointGroup;e.GroupName="EndPoints";e.IsDesign=true;e.IsVisible=true;e.IsDraggable=true;e.MaxPoints=1;e.MinPoints=1;e.PromptMessage="Click on a vertebrae";t.Groups={};t.Groups["EndPoints"]=e;return t}EvaluatePointDragMoveAndEnd(t,e,n){return true}DonePointDragMoveAndEnd(t,e,n){}Serialize(){var t="";var e={Author:this.Author,Date:this.Date,Id:this.Id,Name:this.Name,Plugin:this.Plugin,Selected:this.Selected,Status:this.Status,Points:this.Points,TextLabel:this.TextLabel,TextboxLabel:this.TextboxLabel,Type:this.Type,Visible:this.Visible,ImageGuid:this.Context.ImageEntity.ImageGUID,Namespace:this.Namespace,ColsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0011"],RowsOrigin:this.Context.ImageEntity["dicomTags"]["0028_0010"]};t=JSON.stringify(e);return t}Deserialize(t){var e=JSON.parse(t);this.Id=e["Id"]||e["id"];this.Author=e["Author"]||e["author"];this.Date=e["Date"]||e["date"];this.Type=e["Type"]||e["type"];this.Plugin=e["Plugin"]||e["plugin"];this.Selected=e["Selected"]||e["selected"];this.Status=e["Status"]||e["status"];var o=e["Points"]||e["points"];this.Points=n.AnnotationController.ConvertSamplePoints(o);this.TextLabel=e["TextLabel"]||e["textLabel"];this.TextboxLabel=e["TextboxLabel"]||e["textboxLabel"];this.Name=e["Name"]||e["name"];this.ColsOrigin=parseInt(e["ColsOrigin"]||e["colsOrigin"]);this.RowsOrigin=parseInt(e["RowsOrigin"]||e["rowsOrigin"])}ConvertPointsWithFactororResolution(t){}fillSnapPoints(){}}SpineAnnotation.SpineCervical=["C2","C3","C4","C5","C6","C7"];SpineAnnotation.SpineThoracic=["T1","T2","T3","T4","T5","T6","T7","T8","T9","T10","T11","T12"];SpineAnnotation.SpineLumbar=["L1","L2","L3","L4","L5"];SpineAnnotation.SpineSacrum=["S1","S2","S3","S4","S5"];t.SpineAnnotation=SpineAnnotation})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class AlignmentToolSection1Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");var s=document.createElement("div");n.AddClass(s,"block");s.style.display="block";r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Container,"formAP",{id:"formButtonsContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnCalibrate",{id:"IdBtnCalibrate",text:"&nbsp;",containerId:"formButtonsContainer"},{},["topbarOptions"],o[0].actionBtnCalibration));h.AddField(new e.Field(e.EFieldType.Button,"BtnNativeKnee",{text:"Native Knee",containerId:"formButtonsContainer"},{},["topbarOptions","blue","inline"],o[0].actionBtnNativeKnee));h.AddField(new e.Field(e.EFieldType.Button,"BtnTKA",{text:"TKA",containerId:"formButtonsContainer"},{},["topbarOptions","blue","inline"],o[0].actionBtnTKA));h.AddField(new e.Field(e.EFieldType.Button,"BtnBilateral",{text:"Bilateral",containerId:"formButtonsContainer"},{},["topbarOptions","blue","inline"],o[0].actionBtnBilateral));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);return a}}t.AlignmentToolSection1Form=AlignmentToolSection1Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class AlignmentToolSection2Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");var s=document.createElement("div");n.AddClass(s,"block");r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FEMORAL POINTS",newline:true},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextMechanicalAxisFemoral",{text:"Select 3 points for Femur"},{},["textDescription","blinkOnce"]));h.Render();r.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");r["right"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverMechanicalAxisFemoral",{text:"Start over"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[0].actionBtnStartOverMechanicalAxisFemoral));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneMechanicalAxisFemoral",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[0].actionBtnDoneMechanicalAxisFemoral));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelMechanicalAxisFemoral",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[0].actionBtnCancelMechanicalAxisFemoral));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);var m=document.createElement("div");n.AddClass(m,"section");var s=document.createElement("div");n.AddClass(s,"block");m["left"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"TIBIAL POINTS",newline:true},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextMechanicalAxisTibial",{text:"Select 2 points for Tibia"},{},["textDescription","blinkOnce"]));h.Render();m.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");m["right"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverMechanicalAxisTibial",{text:"Start over"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[1].actionBtnStartOverMechanicalAxisTibial));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneMechanicalAxisTibial",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[1].actionBtnDoneMechanicalAxisTibial));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelMechanicalAxisTibial",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[1].actionBtnCancelMechanicalAxisTibial));h.Render();m.appendChild(s);t.appendChild(m);a.push(m);var d=document.createElement("div");n.AddClass(d,"section");var s=document.createElement("div");n.AddClass(s,"block");d["left"]=s;var h=new e.Form(s,o[2],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FEMORAL POINTS",newline:true},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextAnatomicalAxisFemoral",{text:"Select 2 points for Anatomical Axis of Femur"},{},["textDescription","blinkOnce"]));h.Render();d.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");d["right"]=s;var h=new e.Form(s,o[2],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverAnatomicalAxisFemoral",{text:"Start over"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[2].actionBtnStartOverAnatomicalAxisFemoral));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAnatomicalAxisFemoral",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[2].actionBtnDoneAnatomicalAxisFemoral));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAnatomicalAxisFemoral",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[2].actionBtnCancelAnatomicalAxisFemoral));h.Render();d.appendChild(s);t.appendChild(d);a.push(d);var u=document.createElement("div");n.AddClass(u,"section");var s=document.createElement("div");n.AddClass(s,"block");u["left"]=s;var h=new e.Form(s,o[3],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"TIBIAL POINTS",newline:true},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextAnatomicalAxisTibial",{text:"Select 2 points for Anatomical Axis of Tibial"},{},["textDescription","blinkOnce"]));h.Render();u.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");u["right"]=s;var h=new e.Form(s,o[3],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverAnatomicalAxisTibial",{text:"Start over"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[3].actionBtnStartOverAnatomicalAxisTibial));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAnatomicalAxisTibial",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[3].actionBtnDoneAnatomicalAxisTibial));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAnatomicalAxisTibial",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[3].actionBtnCancelAnatomicalAxisTibial));h.Render();u.appendChild(s);t.appendChild(u);a.push(u);return a}}t.AlignmentToolSection2Form=AlignmentToolSection2Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class CalibrationForm{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");var s=document.createElement("div");n.AddClass(s,"block");r["headerDiv"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.ImageField,"",{src:o[0].calibrateIconSrc},{},["leftIconTopBar"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"CALIBRATION",newline:false},{display:"inline-block","margin-top":"8px",width:"200px"},[]));h.Render();r.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");r["buttonDiv"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnAutoCalibration",{id:"IdAutoCalibration",text:"Auto (Preview)",disabled:false,newline:false},{display:"inline-block",width:"90px","margin-right":"4px"},["blue","inline"],o[0].actionBtnAutoCalibration));h.AddField(new e.Field(e.EFieldType.Button,"BtnSphereCalibration",{id:"IdShpereCalibration",text:"Sphere",newline:false},{display:"inline-block",width:"90px","margin-right":"4px"},["blue","inline"],o[0].actionBtnSphereCalibration));h.AddField(new e.Field(e.EFieldType.Button,"BtnLinearCalibration",{id:"IdLinearCalibration",text:"Linear"},{display:"inline-block",width:"90px"},["blue","inline"],o[0].actionBtnLinearCalibration));h.Render();r.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");r["controlsDiv"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Label,"labelTextTitle",{text:"Please select the diameter"},{display:"inline-block","margin-bottom":"10px","font-size":"14px !important"},["textDescription2"]));h.AddField(new e.Field(e.EFieldType.Radio,"radio25mm",{action:o[0].actionChange25,checked:true,label:"25 mm",name:"radioCalibration",newline:false},{width:"220px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{width:"-webkit-fill-available",margin:"0;","line-height":"10px;"},[]));h.AddField(new e.Field(e.EFieldType.Radio,"radio30mm",{action:o[0].actionChange30,checked:false,label:"30 mm",name:"radioCalibration",newline:false},{width:"220px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{width:"-webkit-fill-available",margin:"0;","line-height":"10px;"},[]));h.AddField(new e.Field(e.EFieldType.Radio,"radio1inch",{action:o[0].actionChangeInch,checked:false,label:"1 inch",name:"radioCalibration",newline:false},{width:"220px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{width:"-webkit-fill-available",margin:"0;","line-height":"3px;"},[]));h.AddField(new e.Field(e.EFieldType.Radio,"radioCustom",{action:o[0].actionChangeCustom,checked:false,label:"Custom",name:"radioCalibration",newline:false},{"margin-top":"6px"},[]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputCustomCalibration",{value:"",newline:false,placeholder:"10-100"},{width:"60px",display:"inline-block","margin-left":"5px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"textFieldCustomCalibration",{text:"mm"},{display:"inline-block","text-align":"left",width:"70px","margin-left":"5px","margin-top":"6px"},[]));h.AddField(new e.Field(e.EFieldType.ButtonBar,"buttonBarCalibration",{options:["25 mm","1 in"],values:["mm","in"],name:"radiobbCalibration",id:"bbCalibrationx",optionchecked:"mm"},{display:"none"},[]));h.Render();r.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");r["actionButtonsDiv"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelCalibration",{id:"IdCancelCalibration",text:"Cancel"},{},["red","inline"],o[0].actionBtnCancelCalibration));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);return a}}t.CalibrationForm=CalibrationForm})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class ConfigOrthoForm{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");var s=document.createElement("div");n.AddClass(s,"block");r["selects"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Group,"",{text:"Select options"},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"txtFavImplantName",{text:"Name",width:110,colon:true},{display:"inline-block"},[]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputFavImplantName",{id:"idFavImplantName",width:262,newline:true},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Manufacturer",width:110,colon:true},{display:"inline-block"},[]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectManufacturer",{options:"",values:"",value:"",id:"idManufacturer",width:270,newline:true},{},["implantOption"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Group",width:110,colon:true},{display:"inline-block"},[]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectGroup",{options:"",values:"",value:"",id:"idGroup",width:270,newline:true},{},["implantOption"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Product line",width:110,colon:true},{display:"inline-block"},[]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductLine",{options:"",values:"",value:"",id:"idProductLine",width:270,newline:true},{},["implantOption"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Type",width:110,colon:true},{display:"inline-block"},[]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectType",{options:"",values:"",value:"",id:"idType",width:270,newline:true},{},["implantOption"]));h.AddField(new e.Field(e.EFieldType.Label,"LabelProductFamily",{text:"Product family",width:110,colon:true},{display:"inline-block"},[]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductFamily",{options:"",values:"",value:"",id:"idProductFamily",width:270,newline:true},{},["implantOption"]));h.AddField(new e.Field(e.EFieldType.Label,"LabelFemoralComponent",{text:"Femoral component",width:110,colon:true},{display:"none"},[]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectFemoralComponent",{options:"",values:"",value:"",id:"idFemoralComponent",newline:true,width:270},{display:"none"},["implantOption"]));h.AddField(new e.Field(e.EFieldType.Label,"LabelTibialComponent",{text:"Tibial component",width:110,colon:true},{display:"none"},[]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectTibialComponent",{options:"",values:"",value:"",id:"idTibialComponent",newline:false,width:270},{display:"none"},["implantOption"]));h.Render();r.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");r["buttons"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Button,"newfavorite",{text:"New",id:"idNewfavorite"},{display:"inline-block","margin-right":"15px"},["blue"]));h.AddField(new e.Field(e.EFieldType.Button,"addfavorite",{text:"Add",id:"idAddfavorite"},{display:"inline-block","margin-right":"15px"},["green"]));h.AddField(new e.Field(e.EFieldType.Button,"removefavorite",{text:"Remove",id:"idRemovefavorite"},{display:"inline-block","margin-right":"15px"},["red"]));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);return a}}t.ConfigOrthoForm=ConfigOrthoForm})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class HipImplantSection1Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");r.setAttribute("id","SectionButtonsA");var s=document.createElement("div");n.AddClass(s,"block");r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Container,"formTitleDesign",{id:"formDesign"},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"labelTitleDesign",{text:"Design:",containerId:"formDesign"},{"font-weight":"bold","font-size":"14px",margin:"4px 0"},[]));h.AddField(new e.Field(e.EFieldType.Container,"formAP",{id:"formAPContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnAp",{id:"IdBtnAp",text:"AP",containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnAp));h.AddField(new e.Field(e.EFieldType.Button,"BtnAcetabulum",{id:"IdBtnAcetabulum",text:"Acetabulum",containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnAcetabulum));h.AddField(new e.Field(e.EFieldType.Button,"BtnFemur",{id:"IdBtnFemur",text:"Femur",containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnFemur));h.AddField(new e.Field(e.EFieldType.Button,"BtnShaft",{id:"IdBtnShaft",text:"Neck/Shaft Angle",containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnShaft));h.AddField(new e.Field(e.EFieldType.Button,"BtnTransschial",{id:"IdBtnTransschial",text:"Transischial <br /> Line",containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnTransschial));h.AddField(new e.Field(e.EFieldType.Button,"BtnAbduction",{id:"IdBtnAbduction",text:"Acetabular Inclination",containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnAbduction));h.AddField(new e.Field(e.EFieldType.Container,"formImplants",{id:"formImplantsContainer"},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"labelTitleImplants",{text:"Implants:",containerId:"formImplantsContainer"},{"font-weight":"bold","font-size":"14px",margin:"4px 0"},[]));h.AddField(new e.Field(e.EFieldType.Container,"formButtonsImplants",{id:"formButtonsImplantsContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnStemAction",{id:"IdBtnStem",text:"Stem",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnStem));h.AddField(new e.Field(e.EFieldType.Button,"BtnCupAction",{id:"IdBtnCup",text:"Cup",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnCup));h.AddField(new e.Field(e.EFieldType.Button,"BtnHeadAction",{id:"IdBtnHead",text:"Head",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnHead));h.AddField(new e.Field(e.EFieldType.Button,"BtnAdjust",{id:"IdBtnAdjust",text:"Adjust",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnAdjust));h.AddField(new e.Field(e.EFieldType.Button,"BtnFavorites",{id:"IdBtnFavorites",text:"Favorites",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnFavorites));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);var m=document.createElement("div");n.AddClass(m,"section");m.setAttribute("id","SectionButtonsB");var s=document.createElement("div");n.AddClass(s,"block");m["left"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStem",{id:"IdBtnStemImplant",text:"Stem"},{},["topbarOptions"],o[1].actionBtnStemImplant));h.AddField(new e.Field(e.EFieldType.Button,"BtnAcetabularCup",{id:"IdBtnAcetabularCupImplant",text:"Acetabular Cup"},{},["topbarOptions"],o[1].actionBtnAcetabularCupImplant));h.Render();m.appendChild(s);t.appendChild(m);a.push(m);return a}}t.HipImplantSection1Form=HipImplantSection1Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class HipImplantSection2Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");r.setAttribute("id","AcetabulumSection");var s=document.createElement("div");n.AddClass(s,"block");r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"ACETABULUM",newline:false},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextAcetabular",{text:"Any"},{},["textDescription","blinkOnce"]));h.Render();r.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");r["right"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverAcetabulum",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[0].actionBtnStartOverAcetabulum));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAcetabulum",{text:"Done"},{width:"80px",height:"30px",display:"none"},["topbarOptions","blue"],o[0].actionBtnDoneAcetabulum));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAcetabulum",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[0].actionBtnCancelAcetabulum));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);var m=document.createElement("div");n.AddClass(m,"section");m.setAttribute("id","FemoralHeadSection");var s=document.createElement("div");n.AddClass(s,"block");m["left"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"1/2"},{float:"left"},["femurAndAcetSteps"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FEMUR",newline:false},{float:"left","margin-top":"14px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"25px;"},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextFemoral",{text:"Mark 3 points for femoral head"},{float:"left",clear:"left"},["textDescription","blinkOnce"]));h.Render();m.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");m["right"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverFemoralHead",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[1].actionBtnStartOverFemoralHead));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelFemoralHead",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[1].actionBtnCancelFemoralHead));h.Render();m.appendChild(s);t.appendChild(m);a.push(m);var d=document.createElement("div");n.AddClass(d,"section");d.setAttribute("id","FemoralLeftLateralSection");var s=document.createElement("div");n.AddClass(s,"block");d["left"]=s;var h=new e.Form(s,o[2],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"2/2"},{float:"left"},["femurAndAcetSteps"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FEMUR",newline:false},{float:"left","margin-top":"14px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"25px;"},[]));h.AddField(new e.Field(e.EFieldType.Label,"LeftTextLateralFemoral",{text:"Mark 3-5 points for the lateral side of the femoral canal from bottom to top"},{float:"left",clear:"left"},["textDescription","blinkOnce"]));h.Render();d.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");d["right"]=s;var h=new e.Form(s,o[2],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverLeftLateral",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[2].actionBtnStartOverLeftLateral));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneLeftLateral",{text:"Set points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[2].actionBtnDoneLeftLateral));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelLeftLateral",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[2].actionBtnCancelLeftLateral));h.Render();d.appendChild(s);t.appendChild(d);a.push(d);var u=document.createElement("div");n.AddClass(u,"section");u.setAttribute("id","FemoralRightLateralSection");var s=document.createElement("div");n.AddClass(s,"block");u["left"]=s;var h=new e.Form(s,o[3],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"2/2"},{float:"left"},["femurAndAcetSteps"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FEMUR",newline:false},{float:"left","margin-top":"14px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"25px;"},[]));h.AddField(new e.Field(e.EFieldType.Label,"RightTextLateralFemoral",{text:"Mark 3-5 points for the medial side of the femoral canal from bottom to top"},{float:"left",clear:"left"},["textDescription","blinkOnce"]));h.Render();u.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");u["right"]=s;var h=new e.Form(s,o[3],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverRightLateral",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[3].actionBtnStartOverRightLateral));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneRightLateral",{text:"Set points"},{width:"80px",height:"30px",display:"none"},["topbarOptions","blue"],o[3].actionBtnDoneRightLateral));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelRightLateral",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[3].actionBtnCancelRightLateral));h.Render();u.appendChild(s);t.appendChild(u);a.push(u);var p=document.createElement("div");n.AddClass(p,"section");p.setAttribute("id","ShaftAngleSection");var s=document.createElement("div");n.AddClass(s,"block");p["left"]=s;var h=new e.Form(s,o[4],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"STEM SHAFT ANGLE",newline:false},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextShaftAngle",{text:"Enter the desired stem shaft angle"},{},["textDescription","blinkOnce"]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"10px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextLabelShaftAngle",{text:"Value"},{display:"inline-block","margin-right":"10px;"},["textDescription"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputShaftAngle",{id:"IdShaftAngle",value:o[4].shaftAngle,newline:false,readonly:true},{display:"inline-block","margin-top":"0px","margin-right":"10px",width:"26px !important"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownShaftAngle",{id:"IdShaftAngleUpDown",controlRefId:"IdShaftAngle",values:o[4].dataShaftAngleUD,defaultV:o[4].defaultShaftAngleUD,isRange:true,inc:1},{display:"inline-block","margin-top":"5px"},[]));h.Render();p.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");p["right"]=s;var h=new e.Form(s,o[4],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneShaftAngle",{text:"Set angle"},{width:"80px",height:"30px",display:"none"},["topbarOptions","blue"],o[4].actionBtnDoneShaftAngle));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelShaftAngle",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[4].actionBtnCancelShaftAngle));h.Render();p.appendChild(s);t.appendChild(p);a.push(p);var c=document.createElement("div");n.AddClass(c,"section");c.setAttribute("id","AcetabulumAbductionPointsSection");var s=document.createElement("div");n.AddClass(s,"block");c["left"]=s;var h=new e.Form(s,o[5],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"TRANSISCHIAL LINE",newline:false},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextAcetabulum",{text:"Mark 2 distal points bellow the ischial tuberosities. Desired angle"},{display:"inline-block","font-size":"14px"},["textDescription","blinkOnce"]));h.Render();c.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");c["right"]=s;var h=new e.Form(s,o[5],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverAbductionAngle",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[5].actionBtnStartOverAbductionAngle));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAbductionAngle",{text:"Set Points"},{width:"80px",height:"30px",display:"none"},["topbarOptions","blue"],o[5].actionBtnDoneAbductionAngle));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAbductionAngle",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[5].actionBtnCancelAbductionAngle));h.Render();c.appendChild(s);t.appendChild(c);a.push(c);var A=document.createElement("div");n.AddClass(A,"section");A.setAttribute("id","FavoritesSection");var s=document.createElement("div");n.AddClass(s,"block");A["left"]=s;var h=new e.Form(s,o[6],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FAVORITES"},{"font-weight":"bold","margin-bottom":"10px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Favorite Stem"},{width:"90px"},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectfavoriteProductLineStem",{action:o[6].actionStemfavoriteProductLine,options:o[6].optionsStemfavoriteProductLine,values:o[6].valuesStemfavoriteProductLine,value:o[6].productfavoriteLineStem,newline:false},{display:"inline-block","margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Favorite Cup"},{width:"90px"},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectfavoriteProductLineAcetabular",{action:o[6].actionAcetabularfavoriteProductLine,options:o[6].optionsAcetabularfavoriteProductLine,values:o[6].valuesAcetabularfavoriteProductLine,value:o[6].productfavoriteLineAcetabular,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.Render();A.appendChild(s);t.appendChild(A);a.push(A);var C=document.createElement("div");n.AddClass(C,"section");C.setAttribute("id","StemImplantSection");var s=document.createElement("div");n.AddClass(s,"block");C["left"]=s;var h=new e.Form(s,o[7],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"STEM IMPLANT SELECTION"},{"margin-bottom":"10px","font-weight":"bold"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Manufacturer"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectManufacturerStem",{action:o[7].actionStemManufacturer,options:o[7].optionsStemManufacturer,values:o[7].valuesStemManufacturer,value:o[7].manufactrurerStem,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Product line"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductLineStem",{action:o[7].actionStemProductLine,options:o[7].optionsStemProductLine,values:o[7].valuesStemProductLine,value:o[7].productLineStem,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Family"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectComponentFamilyStem",{action:o[7].actionStemComponentFamily,options:o[7].optionsStemComponentFamily,values:o[7].valuesStemComponentFamily,value:o[7].componentFamilyStem,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Size"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputImplantSizeStem",{id:"IdImplantSizeStem",value:o[7].implantSizeStem,newline:false,readonly:true},{"margin-left":"10px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownImplantSizeStem",{id:"IdImplantSizeUpDownStem",controlRefId:"IdImplantSizeStem",values:o[7].dataImplantSizeStem,isRange:false,inc:0},{"margin-top":"7px","margin-left":"5px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"5px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneInsertImplantStem",{text:"Set Implant"},{width:"80px",height:"30px","margin-right":"4px"},["topbarOptions","blue"],o[7].actionBtnDoneInsertImplantStem));h.AddField(new e.Field(e.EFieldType.Button,"BtnClearInsertImplantStem",{text:"Clear"},{width:"80px",height:"30px","margin-right":"4px"},["topbarOptions","blue"],o[7].actionBtnClearInsertImplantStem));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelInsertImplantStem",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[7].actionBtnCancelInsertImplantStem));h.Render();C.appendChild(s);t.appendChild(C);a.push(C);var S=document.createElement("div");n.AddClass(S,"section");S.setAttribute("id","AcetabularImplantSection");var s=document.createElement("div");n.AddClass(s,"block");S["left"]=s;var h=new e.Form(s,o[8],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"ACETABULAR CUP IMPLANT SELECTION"},{"font-weight":"bold","margin-bottom":"10px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Manufacturer"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectManufacturerAcetabularCup",{action:o[8].actionAcetabularCupManufacturer,options:o[8].optionsAcetabularCupManufacturer,values:o[8].valuesAcetabularCupManufacturer,value:o[8].manufacturerAcetabularCup,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Product line"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductLineAcetabularCup",{action:o[8].actionAcetabularCupProductLine,options:o[8].optionsAcetabularCupProductLine,values:o[8].valuesAcetabularCupProductLine,value:o[8].productLineAcetabularCup,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Family"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectComponentFamilyAcetabularCup",{action:o[8].actionAcetabularCupComponentFamily,options:o[8].optionsAcetabularCupComponentFamily,values:o[8].valuesAcetabularCupComponentFamily,value:o[8].componentFamilyAcetabularCup,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Size"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputImplantSizeAcetabularCup",{id:"IdImplantSizeAcetabularCup",value:o[8].implantSizeAcetabularCup,newline:false,readonly:true},{"margin-left":"10px","margin-bottom":"0px",width:"82px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownImplantSizeAcetabularCup",{id:"IdImplantSizeUpDownAcetabularCup",controlRefId:"IdImplantSizeAcetabularCup",values:o[8].dataImplantSizeAcetabularCup,isRange:false,inc:0},{"margin-top":"7px","margin-left":"4px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"15px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneInsertImplantAcetabularCup",{text:"Set Implant"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[8].actionBtnDoneInsertImplantAcetabularCup));h.AddField(new e.Field(e.EFieldType.Button,"BtnClearInsertImplantAcetabularCup",{text:"Clear"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[8].actionBtnClearInsertImplantAcetabularCup));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelInsertImplantAcetabularCup",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[8].actionBtnCancelInsertImplantAcetabularCup));h.Render();S.appendChild(s);t.appendChild(S);a.push(S);var g=document.createElement("div");n.AddClass(g,"section");g.setAttribute("id","FemoralHeadImplantSection");var s=document.createElement("div");n.AddClass(s,"block");g["left"]=s;var h=new e.Form(s,o[9],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FEMORAL HEAD IMPLANT SELECTION"},{"font-weight":"bold","margin-bottom":"10px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Femoral head diameter (mm)"},{width:"200px"},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"FemoralHeadDiameter",{id:"IdFemoralHeadDiameter",newline:false},{"margin-left":"10px","margin-bottom":"0px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Neck Length option (mm)"},{"margin-bottom":"0px",width:"200px"},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"FemoralHeadOffset",{id:"IdFemoralHeadOffset",newline:false,value:0},{"margin-left":"10px","margin-bottom":"0px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"15px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneFemoralHeadSet",{text:"Set values"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[9].actionBtnDoneFemoralHeadSet));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelFemoralHeadSet",{text:"Clean"},{width:"80px",height:"30px"},["topbarOptions","red"],o[9].actionBtnCancelFemoralHeadSet));h.Render();g.appendChild(s);t.appendChild(g);a.push(g);var I=document.createElement("div");n.AddClass(I,"section");I.setAttribute("id","AcetabulumAbductionAngleSectionFinal");var s=document.createElement("div");n.AddClass(s,"block");I["left"]=s;var h=new e.Form(s,o[10],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"TRANSISCHIAL LINE",newline:false},{"font-weight":"bold","margin-bottom":"10px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"textTransischialFinal",{text:"Leg"},{display:"inline-block","font-size":"14px"},["textDescription","blinkOnce"]));h.Render();I.appendChild(s);t.appendChild(I);a.push(I);var P=document.createElement("div");n.AddClass(P,"section");P.setAttribute("id","CalibrationSection");var s=document.createElement("div");n.AddClass(s,"block");P["left"]=s;var h=new e.Form(s,o[11],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnCalibration",{id:"IdBtnCalibration",text:"&nbsp;"},{width:"60px"},["topbarOptions"],o[11].actionBtnCalibration));h.AddField(new e.Field(e.EFieldType.Label,"TextCalibrationStatus",{text:"Image not calibrated"},{display:"inline-block","margin-left":"10px","margin-top":"12px"},["textDescription","blinkOnce"]));h.Render();P.appendChild(s);t.appendChild(P);a.push(P);var f=document.createElement("div");n.AddClass(f,"section");f.setAttribute("id","AcetabulumAbductionAngleSection");var s=document.createElement("div");n.AddClass(s,"block");f["left"]=s;var h=new e.Form(s,o[12],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"CUP INCLINATION",newline:false},{},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"15px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextAcetabulumAngle",{text:"Desired angle"},{display:"inline-block","margin-right":"10px"},["textDescription","blinkOnce"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputAbductionAngle",{id:"IdAbductionAngle",value:o[12].abductionAngle,newline:false,readonly:true},{display:"inline-block","margin-top":"0px","margin-right":"10px",width:"18px !important"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownAbductionAngle",{id:"IdAbductionAngleUpDown",controlRefId:"IdAbductionAngle",values:o[12].dataAbductionAngleUD,defaultV:o[12].defaultAbductionAngleUD,isRange:true,inc:1},{display:"inline-block","margin-top":"5px"},[]));h.Render();f.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");f["right"]=s;var h=new e.Form(s,o[12],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAbductionSetAngle",{text:"Set angle"},{width:"80px",height:"30px",display:"none"},["topbarOptions","blue"],o[12].actionBtnDoneAbductionSetAngle));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAbductionSetAngle",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[12].actionBtnCancelAbductionSetAngle));h.Render();f.appendChild(s);t.appendChild(f);a.push(f);return a}}t.HipImplantSection2Form=HipImplantSection2Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class KneeImplantSection2Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");r.setAttribute("id","FemoralComponentSection");var s=document.createElement("div");n.AddClass(s,"block");r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Label,"TextWidthFemoralComponent",{text:"DEFAULT"},{padding:"5px"},["textDescription","blinkOnce"]));h.AddField(new e.Field(e.EFieldType.Label,"textWidthFemoralComponentDistance",{text:"&nbsp;"},{display:"none",padding:"5px"},["textDescription","blinkOnce"]));h.Render();r.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");r["right"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverAPWidthFemoralComponent",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[0].actionBtnStartOverAPWidthFemoralComponent));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAPWidthFemoralComponent",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[0].actionBtnDoneAPWidthFemoralComponent));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAPWidthFemoralComponent",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[0].actionBtnCancelAPWidthFemoralComponent));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);var m=document.createElement("div");n.AddClass(m,"section");m.setAttribute("id","FemoralResectionSection");var s=document.createElement("div");n.AddClass(s,"block");m["left"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Label,"TextAPFemoralResection",{text:"DEFAULT"},{},["textDescription","blinkOnce"]));h.Render();m.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");m["right"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverAPFemoralResection",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[1].actionBtnStartOverAPFemoralResection));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAPFemoralResection",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[1].actionBtnDoneAPFemoralResection));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAPFemoralResection",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[1].actionBtnCancelAPFemoralResection));h.Render();m.appendChild(s);t.appendChild(m);a.push(m);var d=document.createElement("div");n.AddClass(d,"section");d.setAttribute("id","WidtTibialComponentSection");var s=document.createElement("div");n.AddClass(s,"block");d["left"]=s;var h=new e.Form(s,o[2],l);h.AddField(new e.Field(e.EFieldType.Label,"TextAPWidthTibialComponent",{text:"DEFAULT"},{},["textDescription","blinkOnce"]));h.AddField(new e.Field(e.EFieldType.Label,"textWidthTibialComponentDistance",{text:"&nbsp;"},{},["textDescription","blinkOnce"]));h.Render();d.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");d["right"]=s;var h=new e.Form(s,o[2],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverAPWithTibialComponent",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[2].actionBtnStartOverAPWithTibialComponent));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAPWithTibialComponent",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[2].actionBtnDoneAPWithTibialComponent));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAPWithTibialComponent",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[2].actionBtnCancelAPWithTibialComponet));h.Render();d.appendChild(s);t.appendChild(d);a.push(d);var u=document.createElement("div");n.AddClass(u,"section");u.setAttribute("id","TibialResectionSection");var s=document.createElement("div");n.AddClass(s,"block");u["left"]=s;var h=new e.Form(s,o[3],l);h.AddField(new e.Field(e.EFieldType.Label,"TextAPTibialResection",{text:"DEFAULT"},{},["textDescription","blinkOnce"]));h.Render();u.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");u["right"]=s;var h=new e.Form(s,o[3],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverAPTibialResection",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[3].actionBtnStartOverAPTibialResection));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneAPTibialResection",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[3].actionBtnDoneAPTibialResection));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelAPTibialResection",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[3].actionBtnCancelAPTibialResection));h.Render();u.appendChild(s);t.appendChild(u);a.push(u);var p=document.createElement("div");n.AddClass(p,"section");p.setAttribute("id","FemoralFitLineSection");var s=document.createElement("div");n.AddClass(s,"block");p["left"]=s;var h=new e.Form(s,o[4],l);h.AddField(new e.Field(e.EFieldType.Label,"TextFemoralFitLine",{text:"DEFAULT"},{},["textDescription","blinkOnce"]));h.AddField(new e.Field(e.EFieldType.NewLine,"null",{space:false},{width:"100%",padding:"0",margin:"0","line-height":"1px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextMLFemoralDistance",{text:"&nbsp;"},{display:"none","margin-top":"-10px"},["textDescription","blinkOnce"]));h.Render();p.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");p["right"]=s;var h=new e.Form(s,o[4],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverMLFemoralFitLine",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[4].actionBtnStartOverMLFemoralFitLine));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneMLFemoralFitLine",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[4].actionBtnDoneMLFemoralFitLine));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelMLFemoralFitLine",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[4].actionBtnCancelMLFemoralFitLine));h.Render();p.appendChild(s);t.appendChild(p);a.push(p);var c=document.createElement("div");n.AddClass(c,"section");c.setAttribute("id","TibialLongitudinalAxisSection");var s=document.createElement("div");n.AddClass(s,"block");c["left"]=s;var h=new e.Form(s,o[5],l);h.AddField(new e.Field(e.EFieldType.Label,"TextMlTibialLongitudinalAxis",{text:"DEFAULT"},{},["textDescription","blinkOnce"]));h.AddField(new e.Field(e.EFieldType.NewLine,"null",{space:false},{margin:"0",padding:"0","line-height":"1px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextMLTibialAngle",{text:"&nbsp;"},{display:"none",padding:"5px"},["textDescription","blinkOnce"]));h.Render();c.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");c["right"]=s;var h=new e.Form(s,o[5],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverMLTibialLongitudinalAxis",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[5].actionBtnStartOverMLTibialLongitudinalAxis));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneMLTibialLongitudinalAxis",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[5].actionBtnDoneMLTibialLongitudinalAxis));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelMLTibialLongitudinalAxis",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[5].actionBtnCancelMLTibialLongitudinalAxis));h.Render();c.appendChild(s);t.appendChild(c);a.push(c);var A=document.createElement("div");n.AddClass(A,"section");var s=document.createElement("div");n.AddClass(s,"block");A["left"]=s;var h=new e.Form(s,o[6],l);h.AddField(new e.Field(e.EFieldType.Label,"TextMlTibialSlope",{text:"DEFAULT"},{},["textDescription","blinkOnce"]));h.AddField(new e.Field(e.EFieldType.NewLine,"null",{space:false},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"TextMLTibialSlopeAngle",{text:"&nbsp;"},{display:"inline-block",padding:"5px"},["textDescription","blinkOnce"]));h.Render();A.appendChild(s);var s=document.createElement("div");n.AddClass(s,"block");A["right"]=s;var h=new e.Form(s,o[6],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnStartOverMLTibialSlope",{text:"Reset Points"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[6].actionBtnStartOverMLTibialSlope));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneMLTibialSlope",{text:"Done"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[6].actionBtnDoneMLTibialSlope));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelMLTibialSlope",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[6].actionBtnCancelMLTibialSlope));h.Render();A.appendChild(s);t.appendChild(A);a.push(A);var C=document.createElement("div");n.AddClass(C,"section");C.setAttribute("id","FavoritesSection");var s=document.createElement("div");n.AddClass(s,"block");C["left"]=s;var h=new e.Form(s,o[7],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FAVORITES"},{"margin-bottom":"6px","font-weight":"bold"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Favorite"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectfavoriteProductLineKnee",{action:o[7].actionKneefavoriteProductLine,options:o[7].optionsKneefavoriteProductLine,values:o[7].valuesKneefavoriteProductLine,value:o[7].productfavoriteLineKnee,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.Render();C.appendChild(s);t.appendChild(C);a.push(C);var S=document.createElement("div");n.AddClass(S,"section");S.setAttribute("id","ImplantSection");var s=document.createElement("div");n.AddClass(s,"block");S["left"]=s;var h=new e.Form(s,o[8],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"IMPLANT SELECTION"},{"margin-bottom":"6px","font-weight":"bold"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Manufacturer"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectManufacturer",{action:o[8].actionManufacturer,options:o[8].optionsManufacturer,values:o[8].valuesManufacturer,value:o[8].manufacturer,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Product line"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductLine",{action:o[8].actionProductLine,options:o[8].optionsProductLine,values:o[8].valuesProductLine,value:o[8].productLine,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"FEMORAL COMPONENT"},{"margin-top":"10px","margin-bottom":"6px","font-weight":"bold"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Family"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectFemoralComponentFamily",{action:o[8].actionFemoralComponentFamily,options:o[8].optionsFemoralComponentFamily,values:o[8].valuesFemoralComponentFamily,value:o[8].FemoralcomponentFamily,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Size"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputFemoralImplantSize",{id:"IdFemoralImplantSize",value:o[8].FemoralImplantSize,newline:false,readonly:true},{"margin-left":"10px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownFemoralImplantSize",{id:"IdFemoralImplantSizeUpDown",controlRefId:"IdFemoralImplantSize",values:o[8].dataFemoralImplantSize,isRange:false,inc:0},{"margin-left":"7px","margin-top":"5px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"TIBIAL COMPONENT"},{"margin-top":"10px","margin-bottom":"6px","font-weight":"bold"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Family"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectTibialComponentFamily",{action:o[8].actionTibialComponentFamily,options:o[8].optionsTibialComponentFamily,values:o[8].valuesTibialComponentFamily,value:o[8].TibialcomponentFamily,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Size"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputTibialImplantSize",{id:"IdTibialImplantSize",value:o[8].TibialImplantSize,newline:false,readonly:true},{"margin-left":"10px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownTibialImplantSize",{id:"IdTibialImplantSizeUpDown",controlRefId:"IdTibialImplantSize",values:o[8].dataTibialImplantSize,isRange:false,inc:0},{"margin-top":"7px","margin-left":"5px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"15px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Button,"BtnClearImplants",{text:"Clear"},{width:"80px",height:"30px","margin-right":"4px"},["topbarOptions","blue"],o[8].actionBtnClearInsertImplants));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelInsertImplants",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[8].actionBtnCancelInsertImplants));h.Render();S.appendChild(s);t.appendChild(S);a.push(S);var g=document.createElement("div");n.AddClass(g,"section");g.setAttribute("id","CalibrationAPSection");var s=document.createElement("div");n.AddClass(s,"block");g["left"]=s;var h=new e.Form(s,o[9],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnAPCalibration",{id:"IdAPBtnCalibration",text:"&nbsp;"},{width:"60px"},["topbarOptions"],o[9].actionAPBtnCalibration));h.AddField(new e.Field(e.EFieldType.Label,"TextAPCalibrationStatus",{text:"Image not calibrated"},{display:"inline-block","margin-left":"10px","margin-top":"12px"},["textDescription","blinkOnce"]));h.Render();g.appendChild(s);t.appendChild(g);a.push(g);var I=document.createElement("div");n.AddClass(I,"section");I.setAttribute("id","CalibrationMLSection");var s=document.createElement("div");n.AddClass(s,"block");I["left"]=s;var h=new e.Form(s,o[10],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnMLCalibration",{id:"IdMLBtnCalibration",text:"&nbsp;"},{width:"60px"},["topbarOptions"],o[10].actionMLBtnCalibration));h.AddField(new e.Field(e.EFieldType.Label,"TextMLCalibrationStatus",{text:"Image not calibrated"},{display:"inline-block","margin-left":"10px","margin-top":"12px"},["textDescription","blinkOnce"]));h.Render();I.appendChild(s);t.appendChild(I);a.push(I);return a}}t.KneeImplantSection2Form=KneeImplantSection2Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class LayoutSection1Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");var s=document.createElement("div");n.AddClass(s,"block");s.style.display="block";r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Container,"formAP",{id:"formButtonsContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnCalibrate",{id:"IdBtnCalibrate",text:"&nbsp;",containerId:"formButtonsContainer"},{},["topbarOptions"],o[0].actionBtnCalibration));h.AddField(new e.Field(e.EFieldType.Button,"BtnLine",{text:"Create line",containerId:"formButtonsContainer"},{},["topbarOptions","blue","inline"],o[0].actionBtnLine));h.AddField(new e.Field(e.EFieldType.Button,"BtnReference",{text:"Set reference",containerId:"formButtonsContainer"},{},["topbarOptions"],o[0].actionBtnReference));h.AddField(new e.Field(e.EFieldType.Button,"BtnReferenceLine",{text:"&nbsp;",containerId:"formButtonsContainer"},{display:"none"},["topbarOptions"],o[0].actionBtnReferenceLine));h.AddField(new e.Field(e.EFieldType.Button,"BtnPerpendicularLine",{text:"&nbsp;",containerId:"formButtonsContainer"},{},["topbarOptions"],o[0].actionBtnPerpendicularLine));h.AddField(new e.Field(e.EFieldType.Button,"BtnParallelLine",{text:"&nbsp;",containerId:"formButtonsContainer"},{},["topbarOptions"],o[0].actionBtnParallelLine));h.AddField(new e.Field(e.EFieldType.Button,"BtnAngularLine",{text:"&nbsp;",containerId:"formButtonsContainer"},{},["topbarOptions"],o[0].actionBtnAngularLine));h.AddField(new e.Field(e.EFieldType.Button,"BtnAngle",{text:"&nbsp;",containerId:"formButtonsContainer"},{},["topbarOptions"],o[0].actionBtnAngle));h.AddField(new e.Field(e.EFieldType.Button,"BtnCircle",{text:"Circle",containerId:"formButtonsContainer"},{},["topbarOptions"],o[0].actionBtnCircle));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);return a}}t.LayoutSection1Form=LayoutSection1Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class ShoulderImplantSection1Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");r.setAttribute("id","SectionButtonsA");var s=document.createElement("div");n.AddClass(s,"block");r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Container,"formTitleDesign",{id:"formDesign"},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"labelTitleDesign",{text:"Design:",containerId:"formDesign"},{"font-weight":"bold","font-size":"14px",margin:"4px 0"},[]));h.AddField(new e.Field(e.EFieldType.Container,"formAP",{id:"formAPContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnAp",{id:"IdBtnAp",text:"AP",containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnAp));h.AddField(new e.Field(e.EFieldType.Container,"formImplants",{id:"formImplantsContainer"},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"labelTitleImplants",{text:"Implants:",containerId:"formImplantsContainer"},{"font-weight":"bold","font-size":"14px",margin:"4px 0"},[]));h.AddField(new e.Field(e.EFieldType.Container,"formButtonsImplants",{id:"formButtonsImplantsContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnGlenosphereAction",{id:"IdBtnGlenosphere",text:"Glenosphere",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnGlenosphere));h.AddField(new e.Field(e.EFieldType.Button,"BtnGlenoidAction",{id:"IdBtnGlenoid",text:"Glenoid",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnGlenoid));h.AddField(new e.Field(e.EFieldType.Button,"BtnStemAction",{id:"IdBtnStem",text:"Stem",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnStem));h.AddField(new e.Field(e.EFieldType.Button,"BtnHumeralHeadAction",{id:"IdBtnHumeralHead",text:"Humeral Head",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnHumeralHead));h.AddField(new e.Field(e.EFieldType.Button,"BtnAdjust",{id:"IdBtnAdjust",text:"&nbsp;",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnAdjust));h.AddField(new e.Field(e.EFieldType.Button,"BtnFavorites",{id:"IdBtnFavorites",text:"Favorites",containerId:"formButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnFavorites));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);return a}}t.ShoulderImplantSection1Form=ShoulderImplantSection1Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class ShoulderImplantSection2Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");r.setAttribute("id","GlenoSphereImplantSection");var s=document.createElement("div");n.AddClass(s,"block");r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"GLENOSPHERE IMPLANT SELECTION"},{"margin-bottom":"10px","font-weight":"bold"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Manufacturer"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectManufacturerGlenosphere",{action:o[0].actionGlenosphereManufacturer,options:o[0].optionsGlenosphereManufacturer,values:o[0].valuesGlenosphereManufacturer,value:o[0].manufactrurerGlenosphere,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Product line"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductLineGlenosphere",{action:o[0].actionGlenosphereProductLine,options:o[0].optionsGlenosphereProductLine,values:o[0].valuesGlenosphereProductLine,value:o[0].productLineGlenosphere,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Family"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectComponentFamilyGlenosphere",{action:o[0].actionGlenosphereComponentFamily,options:o[0].optionsGlenosphereComponentFamily,values:o[0].valuesGlenosphereComponentFamily,value:o[0].componentFamilyGlenosphere,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Size"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputImplantSizeGlenosphere",{id:"IdImplantSizeGlenosphere",value:o[0].implantSizeGlenosphere,newline:false,readonly:true},{"margin-left":"10px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownImplantSizeGlenosphere",{id:"IdImplantSizeUpDownGlenosphere",controlRefId:"IdImplantSizeGlenosphere",values:o[0].dataImplantSizeGlenosphere,isRange:false,inc:0},{"margin-top":"7px","margin-left":"5px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"15px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneInsertImplantGlenosphere",{text:"Set Implant"},{width:"80px",height:"30px","margin-right":"4px"},["topbarOptions","blue"],o[0].actionBtnDoneInsertImplantGlenosphere));h.AddField(new e.Field(e.EFieldType.Button,"BtnClearInsertImplantGlenosphere",{text:"Clear"},{width:"80px",height:"30px","margin-right":"4px"},["topbarOptions","blue"],o[0].actionBtnClearInsertImplantGlenosphere));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelInsertImplantGlenosphere",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[0].actionBtnCancelInsertImplantGlenosphere));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);var m=document.createElement("div");n.AddClass(m,"section");m.setAttribute("id","GlenoidImplantSection");var s=document.createElement("div");n.AddClass(s,"block");m["left"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"GLENOID IMPLANT SELECTION"},{"font-weight":"bold","margin-bottom":"10px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Manufacturer"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectManufacturerGlenoid",{action:o[1].actionGlenoidManufacturer,options:o[1].optionsGlenoidManufacturer,values:o[1].valuesGlenoidManufacturer,value:o[1].manufacturerGlenoid,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Product line"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductLineGlenoid",{action:o[1].actionGlenoidProductLine,options:o[1].optionsGlenoidProductLine,values:o[1].valuesGlenoidProductLine,value:o[1].productLineGlenoid,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Family"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectComponentFamilyGlenoid",{action:o[1].actionGlenoidComponentFamily,options:o[1].optionsGlenoidComponentFamily,values:o[1].valuesGlenoidComponentFamily,value:o[1].componentFamilyGlenoid,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Size"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputImplantSizeGlenoid",{id:"IdImplantSizeGlenoid",value:o[1].implantSizeGlenoid,newline:false,readonly:true},{"margin-left":"10px","margin-bottom":"0px",width:"82px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownImplantSizeGlenoid",{id:"IdImplantSizeUpDownGlenoid",controlRefId:"IdImplantSizeGlenoid",values:o[1].dataImplantSizeGlenoid,isRange:false,inc:0},{"margin-top":"7px","margin-left":"4px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"15px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneInsertImplantGlenoid",{text:"Set Implant"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[1].actionBtnDoneInsertImplantGlenoid));h.AddField(new e.Field(e.EFieldType.Button,"BtnClearInsertImplantGlenoid",{text:"Clear"},{width:"80px",height:"30px","margin-right":"4px"},["topbarOptions","blue"],o[1].actionBtnClearInsertImplantGlenoid));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelInsertImplantGlenoid",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[1].actionBtnCancelInsertImplantGlenoid));h.Render();m.appendChild(s);t.appendChild(m);a.push(m);var d=document.createElement("div");n.AddClass(d,"section");d.setAttribute("id","HumeralHeadImplantSection");var s=document.createElement("div");n.AddClass(s,"block");d["left"]=s;var h=new e.Form(s,o[2],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"HUMERAL HEAD IMPLANT SELECTION"},{"font-weight":"bold","margin-bottom":"10px"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Manufacturer"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectManufacturerHumeralHead",{action:o[2].actionHumeralHeadManufacturer,options:o[2].optionsHumeralHeadManufacturer,values:o[2].valuesHumeralHeadManufacturer,value:o[2].manufactrurerHumeralHead,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Product line"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductLineHumeralHead",{action:o[2].actionHumeralHeadProductLine,options:o[2].optionsHumeralHeadProductLine,values:o[2].valuesHumeralHeadProductLine,value:o[2].productLineHumeralHead,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Family"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectComponentFamilyHumeralHead",{action:o[2].actionHumeralHeadComponentFamily,options:o[2].optionsHumeralHeadComponentFamily,values:o[2].valuesHumeralHeadComponentFamily,value:o[2].componentFamilyHumeralHead,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Size"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputImplantSizeHumeralHead",{id:"IdImplantSizeHumeralHead",value:o[2].implantSizeHumeralHead,newline:false,readonly:true},{"margin-left":"10px","margin-bottom":"0px",width:"82px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownImplantSizeHumeralHead",{id:"IdImplantSizeUpDownHumeralHead",controlRefId:"IdImplantSizeHumeralHead",values:o[2].dataImplantSizeHumeralHead,isRange:false,inc:0},{"margin-top":"7px","margin-left":"4px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"15px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneInsertImplantHumeralHead",{text:"Set Implant"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[2].actionBtnDoneInsertImplantHumeralHead));h.AddField(new e.Field(e.EFieldType.Button,"BtnClearInsertImplantHumeralHead",{text:"Clear"},{width:"80px",height:"30px","margin-right":"4px"},["topbarOptions","blue"],o[2].actionBtnClearInsertImplantHumeralHead));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelInsertImplantHumeralHead",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[2].actionBtnCancelInsertImplantHumeralHead));h.Render();d.appendChild(s);t.appendChild(d);a.push(d);var u=document.createElement("div");n.AddClass(u,"section");u.setAttribute("id","StemImplantSection");var s=document.createElement("div");n.AddClass(s,"block");u["left"]=s;var h=new e.Form(s,o[3],l);h.AddField(new e.Field(e.EFieldType.Label,"",{text:"STEM IMPLANT SELECTION"},{"margin-bottom":"10px","font-weight":"bolder"},[]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Manufacturer"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectManufacturerStem",{action:o[3].actionStemManufacturer,options:o[3].optionsStemManufacturer,values:o[3].valuesStemManufacturer,value:o[3].manufactrurerStem,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Product line"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectProductLineStem",{action:o[3].actionStemProductLine,options:o[3].optionsStemProductLine,values:o[3].valuesStemProductLine,value:o[3].productLineStem,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Family"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.SelectBox,"selectComponentFamilyStem",{action:o[3].actionStemComponentFamily,options:o[3].optionsStemComponentFamily,values:o[3].valuesStemComponentFamily,value:o[3].componentFamilyStem,newline:false},{"margin-left":"10px"},["topBarSelectBox"]));h.AddField(new e.Field(e.EFieldType.Label,"",{text:"Size"},{},["textLabel"]));h.AddField(new e.Field(e.EFieldType.Textbox,"inputImplantSizeStem",{id:"IdImplantSizeStem",value:o[3].implantSizeStem,newline:false,readonly:true},{"margin-left":"10px"},["topBarInput"]));h.AddField(new e.Field(e.EFieldType.UpDown,"upDownImplantSizeStem",{id:"IdImplantSizeUpDownStem",controlRefId:"IdImplantSizeStem",values:o[3].dataImplantSizeStem,isRange:false,inc:0},{"margin-top":"7px","margin-left":"4px"},[]));h.AddField(new e.Field(e.EFieldType.NewLine,"",{space:true,text:""},{margin:"0;","line-height":"5px;",width:"-webkit-fill-available"},[]));h.AddField(new e.Field(e.EFieldType.Button,"BtnDoneInsertImplantStem",{text:"Set Implant"},{width:"80px",height:"30px"},["topbarOptions","blue"],o[3].actionBtnDoneInsertImplantStem));h.AddField(new e.Field(e.EFieldType.Button,"BtnClearInsertImplantStem",{text:"Clear"},{width:"80px",height:"30px","margin-right":"4px"},["topbarOptions","blue"],o[3].actionBtnClearInsertImplantStem));h.AddField(new e.Field(e.EFieldType.Button,"BtnCancelInsertImplantStem",{text:"Cancel"},{width:"80px",height:"30px"},["topbarOptions","red"],o[3].actionBtnCancelInsertImplantStem));h.Render();u.appendChild(s);t.appendChild(u);a.push(u);var p=document.createElement("div");n.AddClass(p,"section");p.setAttribute("id","CalibrationSection");var s=document.createElement("div");n.AddClass(s,"block");p["left"]=s;var h=new e.Form(s,o[4],l);h.AddField(new e.Field(e.EFieldType.Button,"BtnCalibration",{id:"IdBtnCalibration",text:"&nbsp;"},{width:"60px"},["topbarOptions"],o[4].actionBtnCalibration));h.AddField(new e.Field(e.EFieldType.Label,"TextCalibrationStatus",{text:"Image not calibrated"},{display:"inline-block","margin-left":"10px","margin-top":"12px"},["textDescription","blinkOnce"]));h.Render();p.appendChild(s);t.appendChild(p);a.push(p);return a}}t.ShoulderImplantSection2Form=ShoulderImplantSection2Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;class KneeImplantSection1Form{Create(t,o,l){var a=new Array;var r=document.createElement("div");n.AddClass(r,"section");r.setAttribute("id","APViewSection");var s=document.createElement("div");n.AddClass(s,"block");r["left"]=s;var h=new e.Form(s,o[0],l);h.AddField(new e.Field(e.EFieldType.Container,"formTitleAPDesign",{id:"formTitleAPDesign"},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"labelTitleDesign",{text:"Design (AP):",containerId:"formTitleAPDesign"},{"font-weight":"bold","font-size":"14px",margin:"4px 0"},[]));h.AddField(new e.Field(e.EFieldType.Container,"formAP",{id:"formAPContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnAP",{id:"IdBtnAP",text:"AP",disabled:false,containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnAP));h.AddField(new e.Field(e.EFieldType.Button,"BtnFemoralWithComponent",{id:"IdBtnFemoralWithComponent",text:"Femoral axis & width",disabled:false,containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnFemoralWithComponent));h.AddField(new e.Field(e.EFieldType.Button,"BtnFemoralResection",{id:"IdBtnFemoralWithResection",text:"Distal femoral condyles",disabled:false,containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnFemoralResection));h.AddField(new e.Field(e.EFieldType.Button,"BtnAPTibialResection",{id:"IdBtnAPTibialResection",text:"Tibial resec. depth",disabled:false,containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnAPTibialResection));h.AddField(new e.Field(e.EFieldType.Button,"BtnAPWithTibialComponent",{id:"IdBtnWithTibialComponent",text:"Tibial axis & width",disabled:false,containerId:"formAPContainer"},{},["topbarOptions"],o[0].actionBtnWithTibialComponent));h.AddField(new e.Field(e.EFieldType.Button,"BtnTibialOsteotomyLine",{id:"IdBtnTibialOsteotomyLine",text:"Tibial Osteotomy Line",disabled:true,containerId:"formAPContainer"},{display:"none"},["topbarOptions"],o[0].actionBtnTibialOsteotomyLine));h.AddField(new e.Field(e.EFieldType.Container,"formLabelImplantsAPButtons",{id:"formLabelImplantsAPButtonsContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Label,"labelAPTitleImplants",{text:"Implants:",containerId:"formLabelImplantsAPButtonsContainer"},{"font-weight":"bold","font-size":"14px",margin:"4px 0"},[]));h.AddField(new e.Field(e.EFieldType.Container,"formAPButtonsImplants",{id:"formAPButtonsImplantsContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnImplantAP",{id:"IdBtnImplantAP",text:"Implants",containerId:"formAPButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnImplantAP));h.AddField(new e.Field(e.EFieldType.Button,"BtnAdjustAP",{id:"IdBtnAdjustAP",text:"Adjust",containerId:"formAPButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnAdjustAP));h.AddField(new e.Field(e.EFieldType.Button,"BtnFavoritesAP",{id:"IdBtnFavoritesAP",text:"Favorites",containerId:"formAPButtonsImplantsContainer"},{},["topbarOptions"],o[0].actionBtnFavoritesAP));h.Render();r.appendChild(s);t.appendChild(r);a.push(r);var m=document.createElement("div");n.AddClass(m,"section");m.setAttribute("id","MLViewSection");var s=document.createElement("div");n.AddClass(s,"block");m["left"]=s;var h=new e.Form(s,o[1],l);h.AddField(new e.Field(e.EFieldType.Container,"formTitleLatDesign",{id:"formTitleLatDesign"},{},[]));h.AddField(new e.Field(e.EFieldType.Label,"labelTitleDesign",{text:"Design (LAT):",containerId:"formTitleLatDesign"},{"font-weight":"bold","font-size":"14px",margin:"4px 0"},[]));h.AddField(new e.Field(e.EFieldType.Container,"formAP",{id:"formLatContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnML",{id:"IdBtnML",text:"LAT",disabled:false,containerId:"formLatContainer"},{},["topbarOptions"],o[1].actionBtnML));h.AddField(new e.Field(e.EFieldType.Button,"BtnFemoralFitLine",{id:"IdBtnFemoralFitLine",text:"AP dimension",disabled:false,containerId:"formLatContainer"},{},["topbarOptions"],o[1].actionBtnFemoralFitLine));h.AddField(new e.Field(e.EFieldType.Button,"BtnMlTibialLongitudinalAxis",{id:"IdBtnMlTibialLongitudinalAxis",text:"Tibial axis",disabled:false,containerId:"formLatContainer"},{},["topbarOptions"],o[1].actionBtnMlTibialLongitudinalAxis));h.AddField(new e.Field(e.EFieldType.Container,"formLabelImplantsMLButtons",{id:"formLabelImplantsMLButtonsContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Label,"labelMLTitleImplants",{text:"Implants:",containerId:"formLabelImplantsMLButtonsContainer"},{"font-weight":"bold","font-size":"14px",margin:"4px 0"},[]));h.AddField(new e.Field(e.EFieldType.Container,"formMLButtonsImplants",{id:"formMLButtonsImplantsContainer"},{},["buttonGrid"]));h.AddField(new e.Field(e.EFieldType.Button,"BtnImplantML",{id:"IdBtnImplantML",text:"Implants",containerId:"formMLButtonsImplantsContainer"},{},["topbarOptions"],o[1].actionBtnImplantML));h.AddField(new e.Field(e.EFieldType.Button,"BtnAdjustML",{id:"IdBtnAdjustML",text:"Adjust",disabled:true,containerId:"formMLButtonsImplantsContainer"},{},["topbarOptions"],o[1].actionBtnAdjustML));h.AddField(new e.Field(e.EFieldType.Button,"BtnFavoritesML",{id:"IdBtnFavoritesML",text:"Favorites",containerId:"formMLButtonsImplantsContainer"},{},["topbarOptions"],o[1].actionBtnFavoritesML));h.Render();m.appendChild(s);t.appendChild(m);a.push(m);return a}}t.KneeImplantSection1Form=KneeImplantSection1Form})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;let o;(function(t){t[t["NativeKnee"]=0]="NativeKnee";t[t["TKA"]=1]="TKA"})(o=t.ETabsAligmentCalculation||(t.ETabsAligmentCalculation={}));class AligmentCalculationsPanel extends e.TabController{constructor(t,e){super();this.parent=t;this.view=e;this.IdDefault=o[o.NativeKnee];this.OpenTab=this.openTab;this.BuildUI()}BuildUI(){this.BarTabs=document.createElement("div");n.AddClass(this.BarTabs,"tabs");this.BarTabs.style.padding="2px 0";this.BarTabs.style.margin="0";this.Tabs=new Array;this.SpaceTab=document.createElement("div");n.AddClass(this.SpaceTab,"content");this.parent.appendChild(this.BarTabs);this.parent.appendChild(this.SpaceTab);setTimeout((()=>{this.buildTabs()}),500)}ViewTab(){this.viewTab()}buildTabs(){var t=new e.Tab(o[o.NativeKnee],"Native Knee");t.ActionTab=t=>{this.IdDefault=o[o.NativeKnee];this.view.GetController().ShowSummary()};var n=new e.Tab(o[o.TKA],"TKA");n.ActionTab=t=>{this.IdDefault=o[o.TKA];this.view.GetController().ShowSummary()};this.Tabs.push(t);this.Tabs.push(n);this.viewTab()}viewTab(){this.BuildTabs();this.RemoveActiveTabs();var t=this.GetTabforId(this.IdDefault);if(t){n.RemoveClass(t.Element,"tab");n.AddClass(t.Element,"tabActive");this.OpenTab(t)}}openTab(t){for(var e=0;e<this.Tabs.length;e++){var n=this.Tabs[e].Id;if(t.Id===n){if(t.ActionTab!==undefined){t.ActionTab(this.SpaceTab);break}}}}}t.AligmentCalculationsPanel=AligmentCalculationsPanel})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;let o;(function(t){t[t["None"]=0]="None";t[t["Calibration"]=1]="Calibration";t[t["NativeKnee"]=2]="NativeKnee";t[t["TKA"]=3]="TKA";t[t["KneeLine"]=4]="KneeLine"})(o=t.EActionAlignmentTool||(t.EActionAlignmentTool={}));let l;(function(t){t[t["Left"]=0]="Left";t[t["Right"]=1]="Right"})(l=t.EAlignmentLeg||(t.EAlignmentLeg={}));class AlignmentToolController{constructor(e,n,o){this.Plugin=e;this.ActionsSummaryData={};this.AlignmentToolView=new t.AlignmentToolView(this,n,o);this.StatusButtonIsActive=false;this.AlignmentToolOptionActive=false}ActionCalibrate(){this.ActionAlignmentTool=o.Calibration;this.Plugin.CalibrationOptionFromMainMenu=false;this.Plugin.Menu.ProcessCalibrationToolEvent(null,"calibrationTool","eFit",this.AlignmentToolAnnotation)}ActionNativeKnee(e){var l=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var a=l.RendererPlugins[this.Plugin.PluginName];if(!a.Context.AnnotationController)a.Context.AnnotationController=new n.AnnotationController(this.AlignmentToolAnnotation);a.Context.AnnotationController.SetCurrentGroup("FemoralPoints");this.AlignmentToolView.GetCalculationPanel().IdDefault=t.ETabsAligmentCalculation[t.ETabsAligmentCalculation.NativeKnee];this.StatusDraw=true;this.ActionAlignmentTool=o.NativeKnee;this.AlignmentToolAnnotation.CanDragPoint=false;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",this.ButtonNameOptionInToolbar,"optionInMenuPressed");e();this.ShowTextAndControl(2,this.AlignmentToolView.OrthoElementsSection2,0,0,"TextMechanicalAxisFemoral","FemoralPoints",this.Edition);this.AlignmentToolView.GetCalculationPanel().ViewTab()}ActionTKA(e){var l=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var a=l.RendererPlugins[this.Plugin.PluginName];if(!a.Context.AnnotationController)a.Context.AnnotationController=new n.AnnotationController(this.AlignmentToolAnnotation);this.AlignmentToolView.GetCalculationPanel().IdDefault=t.ETabsAligmentCalculation[t.ETabsAligmentCalculation.TKA];this.StatusDraw=true;this.ActionAlignmentTool=o.TKA;this.AlignmentToolAnnotation.CanDragPoint=false;a.Context.AnnotationController.SetCurrentGroup("TKAFemoralPoints");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",this.ButtonNameOptionInToolbar,"optionInMenuPressed");e();this.ShowTextAndControl(2,this.AlignmentToolView.OrthoElementsSection2,0,2,"TextAnatomicalAxisFemoral","TKAFemoralPoints",this.Edition);this.AlignmentToolView.GetCalculationPanel().ViewTab()}ActionOkMechanicalAxisFemoral(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=t.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["FemoralPoints"])&&n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["TibialPoints"])){this.ActionAlignmentTool=o.None;this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(n,this.AlignmentToolAnnotation,this.ActionAlignmentTool);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The group is not complete.",e.Colors.GreenSea,5)}}ActionCancelNativeKnee(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionAlignmentTool=o.None;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("TibialPoints");e.Context.AnnotationController.ResetCurrentGroup();this.ShowTextAndControl(2,this.AlignmentToolView.OrthoElementsSection2,1,0,"","",this.Edition);this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(e,this.AlignmentToolAnnotation,this.ActionAlignmentTool);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionOkMechanicalAxisTibial(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];if(l.Context.AnnotationController.GroupIsSatisfied(l.Context.AnnotationController.Template.Groups["FemoralPoints"])&&l.Context.AnnotationController.GroupIsSatisfied(l.Context.AnnotationController.Template.Groups["TibialPoints"])){this.ActionAlignmentTool=o.None;this.AlignmentToolView.GetCalculationPanel().IdDefault=t.ETabsAligmentCalculation[t.ETabsAligmentCalculation.NativeKnee];this.AlignmentToolView.GetCalculationPanel().ViewTab();this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(l,this.AlignmentToolAnnotation,this.ActionAlignmentTool);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The group is not complete.",e.Colors.GreenSea,5)}}ActionOkTKA(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];this.ActionAlignmentTool=o.None;this.AlignmentToolView.GetCalculationPanel().IdDefault=t.ETabsAligmentCalculation[t.ETabsAligmentCalculation.TKA];this.AlignmentToolView.GetCalculationPanel().ViewTab();this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(n,this.AlignmentToolAnnotation,this.ActionAlignmentTool);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}ActionCancelMechanicalAxisTibial(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionAlignmentTool=o.None;this.StatusDraw=false;e.Context.AnnotationController.ResetOnlyCurrentGroup();this.ShowTextAndControl(2,this.AlignmentToolView.OrthoElementsSection2,1,1,"","",this.Edition);this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(e,this.AlignmentToolAnnotation,this.ActionAlignmentTool);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionKneeLine(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];if(e.Context.AnnotationController!==null&&e.Context.AnnotationController!==undefined){this.StatusDraw=true;this.ActionAlignmentTool=o.KneeLine;e.Context.AnnotationController.SetCurrentGroup("ValgusKneeLinePoints");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",this.ButtonNameOptionInToolbar,"optionInMenuPressed")}}ActionAnatomicalAxisFemoral(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController!==null&&n.Context.AnnotationController!==undefined){this.StatusDraw=true;n.Context.AnnotationController.SetCurrentGroup("AnatomicalAxisFemoral");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",this.ButtonNameOptionInToolbar,"optionInMenuPressed");t();this.ShowTextAndControl(2,this.AlignmentToolView.OrthoElementsSection2,0,2,"TextAnatomicalAxisFemoral","AnatomicalAxisFemoral",this.Edition)}}ActionOkAnatomicalAxisFemoral(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=t.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["TKAFemoralPoints"])&&n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["TKATibialPoints"])){this.ActionAlignmentTool=o.None;this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(n,this.AlignmentToolAnnotation,this.ActionAlignmentTool);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The group is not complete.",e.Colors.GreenSea,5)}}ActionCancelAnatomicalAxisFemoral(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionAlignmentTool=o.None;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("TKATibialPoints");e.Context.AnnotationController.ResetCurrentGroup();this.ShowTextAndControl(2,this.AlignmentToolView.OrthoElementsSection2,1,2,"","",this.Edition);this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(e,this.AlignmentToolAnnotation,this.ActionAlignmentTool);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionAnatomicalAxisTibial(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController!==null&&n.Context.AnnotationController!==undefined){this.StatusDraw=true;n.Context.AnnotationController.SetCurrentGroup("AnatomicalAxisTibial");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",this.ButtonNameOptionInToolbar,"optionInMenuPressed");t();this.ShowTextAndControl(2,this.AlignmentToolView.OrthoElementsSection2,0,3,"TextAnatomicalAxisTibial","AnatomicalAxisTibial",this.Edition)}}ActionOkAnatomicalAxisTibial(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=t.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["TKAFemoralPoints"])&&n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["TKATibialPoints"])){this.ActionAlignmentTool=o.None;this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(n,this.AlignmentToolAnnotation,this.ActionAlignmentTool);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The group is not complete.",e.Colors.GreenSea,5)}}ActionCancelAnatomicalAxisTibial(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionAlignmentTool=o.None;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("TKATibialPoints");e.Context.AnnotationController.ResetCurrentGroup();this.ShowTextAndControl(2,this.AlignmentToolView.OrthoElementsSection2,1,3,"","",this.Edition);this.ShowSummary();this.AlignmentToolView.ControlButtonsMainWindow(e,this.AlignmentToolAnnotation,this.ActionAlignmentTool);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}SaveAlignmentToolWindow(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=t.RendererPlugins[this.Plugin.PluginName];var l=o.Context.AnnotationController.Instance.Points["TKATibialPoints"]&&o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["TKATibialPoints"]);var a=o.Context.AnnotationController.Instance.Points["TKAFemoralPoints"]&&o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["TKAFemoralPoints"]);var r=o.Context.AnnotationController.Instance.Points["FemoralPoints"]&&o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["FemoralPoints"]);var s=o.Context.AnnotationController.Instance.Points["TibialPoints"]&&o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["TibialPoints"]);var h=false;var m=false;if(l||a)h=true;if(r||s)m=true;if((h||m)&&((!h||h&&l&&a)&&(!m||m&&r&&s))){if(!this.Edition){this.AlignmentToolAnnotation.Status=n.EAnnotationStatus.Complete;this.AlignmentToolAnnotation.Selected=false;o.Annotations.push(this.AlignmentToolAnnotation);o.LastAnnotationCreatedOrSelected=null;this.Plugin.AnnotationDone(t);this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.AlignmentToolView.OrthoFloatingBar.Id);this.AlignmentToolView.OrthoFloatingBar=null;this.Controller.SelectDefaultTool()}else{this.AlignmentToolAnnotation.Selected=false;o.CurrentAnnotation=this.AlignmentToolAnnotation;o.LastAnnotationCreatedOrSelected=null;const annotationDoneCallback=()=>{e.Toaster.ShowToast("Last changes were saved.",e.Colors.Emerald,5)};this.Plugin.AnnotationDone(t,annotationDoneCallback);this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.AlignmentToolView.OrthoFloatingBar.Id);this.AlignmentToolView.OrthoFloatingBar=null;this.Controller.SelectDefaultTool()}}else{e.Toaster.ShowToast("The annotation does not meet the minimum requirements to be saved.",e.Colors.GreenSea,5)}}ActionCancelAlignmentToolWindow(){if(!this.Edition){var n={Action:()=>{this.StatusButtonIsActive=false;if(this.Plugin.Controller.View.ReferencedAnnotationLayout!==null&&this.Plugin.Controller.View.ReferencedAnnotationLayout!==undefined){this.Plugin.Controller.View.ReferencedAnnotationLayout.annotation.IsReferenced=false;this.Plugin.Controller.View.ReferencedAnnotationLayout=null}var t=this.Plugin.Controller.GetSelectViewport(this.Controller.ViewportPane);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render();this.CloseAligmentToolWindow();this.Plugin.Controller.View.Platform.Toolbar.DeselectAllButtons()},Name:"Ok",Text:"Yes",Id:"btnOkCancelAlignmentTool"};var o={Action:()=>{},Name:"Cancel",Text:"No",Id:"btnCancelCancelAlignmentTool"};n.ClassNames=[t.ButtonClasses.SUCCESS];o.ClassNames=[t.ButtonClasses.CRITIC];var l=new e.MessageBox("Do you want to cancel the whole operation?",[n,o]);l.Show()}else{this.CloseAligmentToolWindow()}}CloseAligmentToolWindow(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];e.LastAnnotationCreatedOrSelected=null;this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.AlignmentToolView.OrthoFloatingBar.Id);this.AlignmentToolView.OrthoFloatingBar=null;this.Plugin.Menu.CancelAlignmentTool(this.AlignmentToolAnnotation);this.Plugin.Controller.SelectDefaultTool()}ShowSummary(){this.AlignmentToolView.BuildSummary(this.ActionsSummaryData)}ShowTextAndControl(t,e,n,o,l,a,r,s){var h=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var m=h.RendererPlugins[this.Plugin.PluginName];this.Controller.TopBarElement.PostActionShow=()=>{};this.AlignmentToolView.OrthoFloatingBar.BuildForm(e,[o]);this.AlignmentToolView.ShowValueLabel(t,n,o,l,a,s);this.AlignmentToolView.ControlStatusMainButtons(m,r,this.ActionAlignmentTool,this.AlignmentToolAnnotation);this.AlignmentToolView.ControlUI();this.AlignmentToolView.ControlButtonsMainWindow(m,this.AlignmentToolAnnotation,this.ActionAlignmentTool)}static Create(e,o,l,a,r,s){var h=new AlignmentToolController(e,l,o);h.Controller=e.Controller;h.AlignmentToolAnnotation=o;h.StatusDraw=false;h.Edition=l;h.Controller.ActiveContextMenu=false;h.ButtonNameOptionInToolbar=a;h.ButtonMenuParentName=r;var m=e.Controller.GetSelectViewport(e.Controller.ViewportPane);var d=m.RendererPlugins[e.PluginName];if(!d.Context.AnnotationController)d.Context.AnnotationController=new n.AnnotationController(h.AlignmentToolAnnotation);if(l){h.AlignmentToolAnnotation.CanDragPoint=true;if(s){if(s.match(/TKA/))h.AlignmentToolView.GetCalculationPanel().IdDefault=t.ETabsAligmentCalculation[t.ETabsAligmentCalculation.TKA];else h.AlignmentToolView.GetCalculationPanel().IdDefault=t.ETabsAligmentCalculation[t.ETabsAligmentCalculation.NativeKnee]}h.ShowSummary()}h.AlignmentToolView.InitFormDataAndEvents(o,l);return h}}t.AlignmentToolController=AlignmentToolController})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(e){var n;(function(e){var n=Efferent.Frontend.WebClient;var o=Efferent.Frontend.WebClient.DOMUtils;const{div:l,h3:a,label:r,input:s,ul:h,li:m,img:d,button:u,table:p,tr:c,td:A,th:C}=o;class AlignmentToolView{constructor(t,n,o){this.controller=t;this.IdDefault=e.ETemplateView[e.ETemplateView.AP];const l=o.Leg!==undefined&&o.Leg!==null;this.orthoToolWindow=new e.OrthoToolWindow(l,(()=>{this.controller.ActionCancelAlignmentToolWindow()}));this.BuildUI(n,o);this.calculationsPanel=new e.AligmentCalculationsPanel(this.orthoToolWindow.ActionsSummaryContainer,this);this.orthoToolWindow.TabsContainer.style.display="none"}BuildUI(t,n){this.orthoToolWindow.InitComponents();this.OrthoFloatingBar=this.controller.Plugin.ManagementFloatingBar.CreateFloatingBar(document.body,"orthoCissDialog",true,"AligmentTool",(()=>{this.controller.Controller.ResizeViewports()}));this.orthoToolWindow.RightTopSection.className="rightTopSection";this.orthoToolWindow.RightTopSection.appendChild(l({className:"iconImage",style:{backgroundImage:`url('${e.ResourceBag.KneeAlignPng}')`,marginTop:"24px",marginBottom:"10px"}}));this.inputLeftSide=s({type:"radio",name:"radioBtnSide",id:"bbSideLeft",value:"Left",checked:(()=>{if(n){if(n.Leg===e.EAlignmentLeg.Left)return true}return false})(),onchange:t=>{o.SetStyles(this.orthoToolWindow.OuterContainer,{overflow:"visible",height:"auto",gap:"10px",display:"flex",flexDirection:"column"});this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.controller.LegSelect=e.EAlignmentLeg.Left;if(this.controller.AlignmentToolAnnotation)this.controller.AlignmentToolAnnotation.Leg=this.controller.LegSelect;this.controller.ShowSummary()}});this.inputRightSide=s({type:"radio",name:"radioBtnSide",id:"bbSideRight",value:"Right",checked:(()=>{if(n){if(n.Leg===e.EAlignmentLeg.Right)return true}return false})(),onchange:t=>{this.orthoToolWindow.OuterContainer.style.overflow="visible";this.orthoToolWindow.OuterContainer.style.height="auto";this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.controller.LegSelect=e.EAlignmentLeg.Right;if(this.controller.AlignmentToolAnnotation)this.controller.AlignmentToolAnnotation.Leg=this.controller.LegSelect;this.controller.ShowSummary()}});if(n.Leg!==undefined&&n.Leg!==null)this.controller.LegSelect=n.Leg;const a=l({className:"h3",innerHTML:"Alignment Tool"});const h=l({children:[l({className:"label",innerHTML:"Leg: "}),l({className:"buttonbar",style:{display:"inline-block"},children:[this.inputRightSide,r({innerHTML:"Right",htmlFor:"bbSideRight"}),this.inputLeftSide,r({innerHTML:"Left",htmlFor:"bbSideLeft"})]})]});this.orthoToolWindow.LeftTopSection.className="leftTopSection";this.orthoToolWindow.LeftTopSection.appendChild(a);this.orthoToolWindow.LeftTopSection.appendChild(h);this.spaceTab=l({className:"content"});this.orthoToolWindow.TabsContainer.style.display="flex";this.orthoToolWindow.TabsContainer.appendChild(this.spaceTab);this.orthoToolWindow.MainSection.appendChild(l({className:"margin",children:[l({className:"topSection",children:[this.orthoToolWindow.LeftTopSection,this.orthoToolWindow.RightTopSection]}),this.orthoToolWindow.SelectSideMessage,this.orthoToolWindow.CloseFirstDialogContainer,this.orthoToolWindow.OuterContainer]}));this.OrthoFloatingBar.Element.innerHTML="";this.OrthoFloatingBar.Element.style.height="auto";this.OrthoFloatingBar.Element.appendChild(this.orthoToolWindow.MainSection);this.ContainerLegend=l({className:"legendContainer"});this.orthoToolWindow.ActionsWindowContainer.style.position="relative";this.SwitchSummaryOrDetails(t);this.BuildLegend()}ShowValueLabel(t,n,o,l,a,r){var s;if(t===1)s=this.DataSection1[o]["forms"][n];else s=this.DataSection2[o]["forms"][n];try{var h=s.GetField(l);var m=e.ResourceBag.AlignmentToolTemplateJson;h.htmlElement.innerHTML=r||m.Groups[a].PromptMessage}catch(t){}}GetCalculationPanel(){return this.calculationsPanel}BuildSummary(t){this.orthoToolWindow.ActionsSummaryContainer.style.height="200px";this.calculationsPanel.SpaceTab.innerHTML="";const n=l({innerHTML:"Calculations:",style:{fontWeight:"bolder",marginBottom:"8px"}});this.calculationsPanel.SpaceTab.appendChild(n);if(this.calculationsPanel.IdDefault===e.ETabsAligmentCalculation[e.ETabsAligmentCalculation.NativeKnee])this.createInfoNativeKneeTable(this.calculationsPanel.SpaceTab);else this.createInfoTKATable(this.calculationsPanel.SpaceTab);var o=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);var a=o.RendererPlugins[this.controller.Plugin.PluginName];let r=a.Context.AnnotationController.Instance.Points["TKATibialPoints"]&&a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["TKATibialPoints"]);let s=a.Context.AnnotationController.Instance.Points["TKAFemoralPoints"]&&a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["TKAFemoralPoints"]);let d=a.Context.AnnotationController.Instance.Points["TibialPoints"]&&a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["TibialPoints"]);let u=a.Context.AnnotationController.Instance.Points["FemoralPoints"]&&a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["FemoralPoints"]);if(this.calculationsPanel.Tabs.length>0){if(r&&s){this.calculationsPanel.Tabs.filter((t=>t.Id==="NativeKnee"))[0].Element.style.display="none";this.calculationsPanel.SpaceTab.innerHTML="";this.createInfoTKATable(this.calculationsPanel.SpaceTab)}else if(d&&u){this.calculationsPanel.Tabs.filter((t=>t.Id==="TKA"))[0].Element.style.display="none";this.calculationsPanel.SpaceTab.innerHTML="";this.createInfoNativeKneeTable(this.calculationsPanel.SpaceTab)}else if(this.GetController().SetOnlyActionAlignmentTool){if(this.GetController().SetOnlyActionAlignmentTool===e.EActionAlignmentTool.TKA){this.calculationsPanel.Tabs.filter((t=>t.Id==="NativeKnee"))[0].Element.style.display="none";this.calculationsPanel.SpaceTab.innerHTML="";this.createInfoTKATable(this.calculationsPanel.SpaceTab)}else{this.calculationsPanel.Tabs.filter((t=>t.Id==="TKA"))[0].Element.style.display="none";this.calculationsPanel.SpaceTab.innerHTML="";this.createInfoNativeKneeTable(this.calculationsPanel.SpaceTab)}}}const p=h({children:Object.keys(t).map((e=>m({className:"blinkOnce",innerHTML:t[e].Description})))});this.calculationsPanel.SpaceTab.appendChild(p)}BuildLegend(){const t=l({innerHTML:"Legend:",style:{fontWeight:"bolder",marginBottom:"8px"}});this.ContainerLegend.innerHTML="";this.ContainerLegend.style.height="120px";this.ContainerLegend.appendChild(t)}SwitchSummaryOrDetails(t){if(t){this.orthoToolWindow.ActionsSummaryContainer.style.display="block";this.orthoToolWindow.TabsContainer.style.display="none"}else{this.orthoToolWindow.ActionsSummaryContainer.style.display="none";this.orthoToolWindow.TabsContainer.style.display="block"}}GetController(){return this.controller}ControlButtonsMainWindow(t,n,l){var a=this.DataSection1[0]["forms"][0];var r=a.GetField("BtnCalibrate").htmlElement;var s=a.GetField("BtnNativeKnee").htmlElement;var h=a.GetField("BtnTKA").htmlElement;var m=a.GetField("BtnBilateral").htmlElement;var cleanGroup=t=>{for(var n=0;n<t.GetFields().length;n++){var l=t.GetFields()[n].htmlElement;o.RemoveClass(l,e.ButtonClasses.ACTIVE);o.AddClass(l,e.ButtonClasses.ENABLE)}};let d=t.Context.AnnotationController.Instance.Points["TKATibialPoints"]&&t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["TKATibialPoints"]);let p=t.Context.AnnotationController.Instance.Points["TKAFemoralPoints"]&&t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["TKAFemoralPoints"]);let c=t.Context.AnnotationController.Instance.Points["TibialPoints"]&&t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["TibialPoints"]);let A=t.Context.AnnotationController.Instance.Points["FemoralPoints"]&&t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["FemoralPoints"]);cleanGroup(a);if(d&&p)s.style.display="none";else if(c&&A)h.style.display="none";if(this.controller.SetOnlyActionAlignmentTool===e.EActionAlignmentTool.TKA)s.style.display="none";else if(this.controller.SetOnlyActionAlignmentTool===e.EActionAlignmentTool.NativeKnee)h.style.display="none";if(d&&p||c&&A)m.disabled=false;else m.disabled=true;if(this.hasBilateraAnnotation(t.Context.AnnotationController.Instance)){m.disabled=true}switch(l){case e.EActionAlignmentTool.None:break;case e.EActionAlignmentTool.Calibration:o.RemoveClass(r,e.ButtonClasses.ENABLE);o.AddClass(r,e.ButtonClasses.ACTIVE);break;case e.EActionAlignmentTool.NativeKnee:o.RemoveClass(s,e.ButtonClasses.ENABLE);o.AddClass(s,e.ButtonClasses.ACTIVE);break;case e.EActionAlignmentTool.TKA:o.RemoveClass(h,e.ButtonClasses.ENABLE);o.AddClass(h,e.ButtonClasses.ACTIVE);break}const C=u({type:"button",innerHTML:"Cancel",className:`${e.ButtonClasses.CRITIC} inline`,onclick:t=>{this.controller.ActionCancelAlignmentToolWindow()}});const S=u({type:"button",innerHTML:"Save",className:`${e.ButtonClasses.SUCCESS} inline`,onclick:t=>{this.controller.SaveAlignmentToolWindow();C.innerHTML="Close"}});this.orthoToolWindow.ActionsWindowContainer.innerHTML="";S.style.flexGrow="2";C.style.flexGrow="2";const g=[S,C];g.forEach((t=>{this.orthoToolWindow.ActionsWindowContainer.appendChild(t)}));this.cleanClassColorOfButtonDisabled(a);this.cleanClassColorOfButtonDisabled(a);this.ControlStatusMainButtons(t,this.controller.Edition,l,n)}AppendIconsToMainButtons(){var t=this.DataSection1[0]["forms"][0];var n=t.GetField("BtnCalibrate").htmlElement;var o=d({src:e.ResourceBag.Icons8Sphere32Png});n.appendChild(o);this.ControlUI()}BuildUIAdjustControl(t){}InitFormDataAndEvents(a,r){var s=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);var h=s.RendererPlugins[this.controller.Plugin.PluginName];this.orthoToolWindow.ButtonsElementsContainer.innerHTML="";var m={};var d={};var u={};var p={};var c={};this.DataSection1=[m];this.DataSection2=[d,u,p,c];this.controller.Plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",this.controller.ButtonNameOptionInToolbar,"optionInMenuPressed");var cleanGroup=t=>{for(var n=0;n<t.GetFields().length;n++){var l=t.GetFields()[n].htmlElement;o.RemoveClass(l,e.ButtonClasses.ACTIVE);o.AddClass(l,e.ButtonClasses.ENABLE)}};m["actionBtnCalibration"]=t=>{this.controller.ActionCalibrate()};m["actionBtnNativeKnee"]=t=>{this.SwitchSummaryOrDetails(false);this.controller.ActionNativeKnee((()=>{this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};m["actionBtnTKA"]=t=>{this.SwitchSummaryOrDetails(false);this.controller.ActionTKA((()=>{this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};m["actionBtnBilateral"]=t=>{let o=h.Context.AnnotationController.Instance.Points["TKATibialPoints"]&&h.Context.AnnotationController.GroupIsSatisfied(h.Context.AnnotationController.Template.Groups["TKATibialPoints"]);let l=h.Context.AnnotationController.Instance.Points["TKAFemoralPoints"]&&h.Context.AnnotationController.GroupIsSatisfied(h.Context.AnnotationController.Template.Groups["TKAFemoralPoints"]);let a=h.Context.AnnotationController.Instance.Points["TibialPoints"]&&h.Context.AnnotationController.GroupIsSatisfied(h.Context.AnnotationController.Template.Groups["TibialPoints"]);let r=h.Context.AnnotationController.Instance.Points["TibialPoints"]&&h.Context.AnnotationController.GroupIsSatisfied(h.Context.AnnotationController.Template.Groups["FemoralPoints"]);if(o&&l||a&&r){var s=this.controller.AlignmentToolAnnotation.Leg;var m=this.controller.AlignmentToolAnnotation.Id;this.controller.SaveAlignmentToolWindow();this.controller.Plugin.Menu.ProcessAlignmentTool(t,false,"AlignmentTool1","orthoTool");var d=s===e.EAlignmentLeg.Left?e.EAlignmentLeg.Right:e.EAlignmentLeg.Left;this.controller.Plugin.AlignmentToolController.AlignmentToolView.orthoToolWindow.OuterContainer.style.overflow="visible";this.controller.Plugin.AlignmentToolController.AlignmentToolView.orthoToolWindow.OuterContainer.style.height="auto";this.controller.Plugin.AlignmentToolController.AlignmentToolView.orthoToolWindow.SelectSideMessage.style.display="none";this.controller.Plugin.AlignmentToolController.AlignmentToolView.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.controller.Plugin.AlignmentToolController.LegSelect=d;if(this.controller.Plugin.AlignmentToolController.AlignmentToolAnnotation){this.controller.LegSelect=d;this.controller.Plugin.AlignmentToolController.AlignmentToolAnnotation.Leg=this.controller.LegSelect;this.controller.Plugin.AlignmentToolController.AlignmentToolAnnotation.AnnotationIDBilateral=m}this.controller.Plugin.AlignmentToolController.ShowSummary();if(d===e.EAlignmentLeg.Left)this.controller.Plugin.AlignmentToolController.AlignmentToolView.inputLeftSide.checked=true;else this.controller.Plugin.AlignmentToolController.AlignmentToolView.inputRightSide.checked=true;if(o&&l){this.controller.Plugin.AlignmentToolController.SetOnlyActionAlignmentTool=e.EActionAlignmentTool.TKA;var u=n.Form.GetFieldFromForms(this.controller.Plugin.AlignmentToolController.AlignmentToolView.DataSection1,"BtnTKA");u.htmlElement.click()}else if(a&&r){this.controller.Plugin.AlignmentToolController.SetOnlyActionAlignmentTool=e.EActionAlignmentTool.NativeKnee;var p=n.Form.GetFieldFromForms(this.controller.Plugin.AlignmentToolController.AlignmentToolView.DataSection1,"BtnNativeKnee");p.htmlElement.click()}}else{n.Toaster.ShowToast("The annotation does not meet the minimum requirements to be saved.",n.Colors.GreenSea,5)}};m["actionBtnAnatomicalAxisFemoral"]=t=>{this.controller.ActionAnatomicalAxisFemoral((()=>{this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};m["actionBtnAnatomicalAxisTibial"]=t=>{this.controller.ActionAnatomicalAxisTibial((()=>{this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};m["actionBtnKneeLine"]=t=>{this.controller.ActionKneeLine()};d["actionBtnStartOverMechanicalAxisFemoral"]=t=>{this.startOver()};d["actionBtnDoneMechanicalAxisFemoral"]=t=>{this.controller.ActionOkMechanicalAxisFemoral()};d["actionBtnCancelMechanicalAxisFemoral"]=t=>{this.controller.ActionCancelNativeKnee()};u["actionBtnStartOverMechanicalAxisTibial"]=t=>{this.startOver()};u["actionBtnDoneMechanicalAxisTibial"]=t=>{this.controller.ActionOkMechanicalAxisTibial()};u["actionBtnCancelMechanicalAxisTibial"]=t=>{this.controller.ActionCancelNativeKnee()};p["actionBtnStartOverAnatomicalAxisFemoral"]=t=>{this.startOver()};p["actionBtnDoneAnatomicalAxisFemoral"]=t=>{this.controller.ActionOkAnatomicalAxisFemoral()};p["actionBtnCancelAnatomicalAxisFemoral"]=t=>{this.controller.ActionCancelAnatomicalAxisFemoral()};c["actionBtnStartOverAnatomicalAxisTibial"]=t=>{this.startOver()};c["actionBtnDoneAnatomicalAxisTibial"]=t=>{this.controller.ActionOkAnatomicalAxisTibial()};c["actionBtnCancelAnatomicalAxisTibial"]=t=>{this.controller.ActionCancelAnatomicalAxisTibial()};this.OrthoElementsSection1=(new t.Products.OrthoPlugin.AlignmentToolSection1Form).Create(this.orthoToolWindow.ButtonsElementsContainer,this.DataSection1);this.OrthoFloatingBar.BuildForm(this.OrthoElementsSection1,[0]);this.containerASection2=l({style:{display:"none"}});this.containerBSection2=l({style:{display:"none"}});this.spaceTab.appendChild(this.containerASection2);this.spaceTab.appendChild(this.containerBSection2);this.OrthoElementsSection2=(new t.Products.OrthoPlugin.AlignmentToolSection2Form).Create(this.containerASection2,this.DataSection2);this.controller.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",this.controller.ButtonNameOptionInToolbar,"optionInMenuPressed");this.AppendIconsToMainButtons();this.ControlUI();this.orthoToolWindow.MainSection.style.display="block";this.orthoToolWindow.MainSection.style.width="100%";this.ControlButtonsMainWindow(h,a,this.controller.ActionAlignmentTool);this.controller.ShowSummary();this.OrthoFloatingBar.Element.style.height="auto"}ViewTab(){this.viewTab()}ControlUI(){var t=this.OrthoFloatingBar.Element.getElementsByClassName("section");for(var e=0;e<t.length;e++){if(t[e]["style"]["display"]!=="none"){t[e].style.margin="0px";var n=t[e].getElementsByClassName("block");if(e>=0){for(var o=0;o<n.length;o++){n[o].style.paddingBottom="0"}var l=n[0].childNodes[0];l["style"]["justify-content"]="left"}}}}ControlStatusMainButtons(t,e,n,o){var l=t.Context.ImageEntity.IsCalibrated();var a=this.DataSection1[0]["forms"][0];this.ControlTabContent(n);this.cleanClassColorOfButtonDisabled(a)}ControlTabContent(t){switch(t){case e.EActionAlignmentTool.None:this.spaceTab.style.display="block";var n=this.spaceTab.getElementsByClassName("section");for(var o in n){if(n.hasOwnProperty(o))n[o].style.display="none"}if(this.containerASection2!==undefined)this.containerASection2.style.display="none";if(this.containerBSection2!==undefined)this.containerBSection2.style.display="none";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break}}cleanClassColorOfButtonDisabled(t){for(var n=0;n<t.GetFields().length;n++){var l=t.GetFields()[n].htmlElement;if(l.disabled){o.RemoveClass(l,e.ButtonClasses.ACTIVE);o.RemoveClass(l,e.ButtonClasses.ENABLE)}}}createInfoTableRow(t,e){t.appendChild(c({className:"infoTableRow",children:[A({innerText:e[0]}),A({innerText:e[1]})]}))}createInfoTableSimple(t,e){t.appendChild(c({className:"infoTableRow",children:[A({innerText:e[0]})]}))}getTerm(t){var e;switch(t){case 0:e="valgus";break;case 1:e="varus";break;case 2:e="neutral";break;default:e="-";break}return e}createInfoTKATable(t){var e=this.getTerm(this.controller.AlignmentToolAnnotation.TKAFemoralEval);var o=this.getTerm(this.controller.AlignmentToolAnnotation.TKATibialEval);var l=Math.abs(this.controller.AlignmentToolAnnotation.TKACa)?Math.abs(this.controller.AlignmentToolAnnotation.TKACa).toFixed(0)+"° ":"";var a=Math.abs(this.controller.AlignmentToolAnnotation.TKACb)?Math.abs(this.controller.AlignmentToolAnnotation.TKACb).toFixed(0)+"° ":"";const r=p({style:{textAlign:"center",width:"100%"},children:[c({style:{backgroundColor:n.Colors.BgDarker},children:[C({innerText:this.controller.LegSelect===0?"Left":"Right",attr:{colspan:"2"}})]})]});this.createInfoTableRow(r,["Femoral component",l+e]);this.createInfoTableRow(r,["Tibial component",a+o]);t.appendChild(r)}createInfoNativeKneeTable(t){var e=this.getTerm(this.controller.AlignmentToolAnnotation.MCTEval);var o=this.getTerm(this.controller.AlignmentToolAnnotation.ACTEval);var l=this.controller.AlignmentToolAnnotation.AngleMKAA?this.controller.AlignmentToolAnnotation.AngleMKAA.toFixed(0)+"° ":"-";var a=this.controller.AlignmentToolAnnotation.AngleAKAA?this.controller.AlignmentToolAnnotation.AngleAKAA.toFixed(0)+"° ":"-";var r=Math.abs(this.controller.AlignmentToolAnnotation.AngleMCT)?Math.abs(this.controller.AlignmentToolAnnotation.AngleMCT).toFixed(0)+"° ":"";var s=Math.abs(this.controller.AlignmentToolAnnotation.AngleACT)?Math.abs(this.controller.AlignmentToolAnnotation.AngleACT).toFixed(0)+"° ":"";const h=p({style:{textAlign:"center",width:"100%"},children:[c({style:{backgroundColor:n.Colors.BgDarker},children:[C({innerText:this.controller.LegSelect===0?"Left":"Right",attr:{colspan:"2"}})]})]});this.createInfoTableRow(h,["MKAA",l]);this.createInfoTableRow(h,["MCT",r+e]);this.createInfoTableRow(h,["AKAA",a]);this.createInfoTableRow(h,["ACT",s+o]);this.createInfoTableRow(h,["  ","  "]);const m=p({style:{textAlign:"center",width:"100%"},children:[c({style:{backgroundColor:n.Colors.BgDarker}})]});t.appendChild(h);this.createInfoTableSimple(m,["MKAA : Mechanical Knee Align. Angle",""]);this.createInfoTableSimple(m,["AKAA : Anatomic Knee Alignment Angle",""]);this.createInfoTableSimple(m,["MCT : Mechanical Clinical Terminology",""]);this.createInfoTableSimple(m,["ACT : Anatomic Clinical Terminology",""]);t.appendChild(m)}viewTab(){this.orthoToolWindow.MainSection.style.display="block"}startOver(){var t=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var n=t.RendererPlugins[this.controller.Plugin.PluginName];switch(this.controller.ActionAlignmentTool){case e.EActionAlignmentTool.NativeKnee:this.controller.ActionCancelNativeKnee();this.controller.ActionNativeKnee((()=>{this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}));break;case e.EActionAlignmentTool.TKA:this.controller.AlignmentToolAnnotation.InitialTee=true;this.controller.ActionCancelAnatomicalAxisFemoral();this.controller.ActionTKA((()=>{this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}));break}}hasBilateraAnnotation(t){var n=false;var o=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var l=o.GetAllAnnotations().filter((t=>t instanceof e.AlignmentToolAnnotation));n=l.some((e=>e.AnnotationIDBilateral===t.Id));if(!n)n=l.some((e=>e.Id===t.AnnotationIDBilateral));return n}setPostControls(t){}}e.AlignmentToolView=AlignmentToolView})(n=e.OrthoPlugin||(e.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;const{div:o}=n;let l;(function(t){t[t["Auto"]=0]="Auto";t[t["Sphere"]=1]="Sphere";t[t["Linear"]=2]="Linear"})(l=t.ETypeCalibration||(t.ETypeCalibration={}));class CalibrationController{constructor(){this.TypeCalibration=null;this.CalibrationAutoModeCancelMute=false;this.CalibrationView=new t.CalibrationView(this)}ActionBtnAutoCalibration(t,n=false){let o=this.Plugin.GetOrthoContext();let a=this.Plugin.StructureLoadAutoCalibration.findIndex((t=>t.StudyGUID===o.Context.StudyGuid&&t.ImageGUID===o.Context.ImageEntity.ImageGUID));let r;var executeAutoCalib=t=>{let n=JSON.parse(t);let o=n["valueString"];let l=JSON.parse(e.Utils.DecodeBase64(o));let a=l["Diameter"];let r=l["Value"];let s=l["XCentroid"];let h=l["YCentroid"];let m=l["RowsOrigin"];let d=l["ColsOrigin"];let u=s;let p=h;let c=a;u=u-m/2;p=p-d/2;let A=new e.Point(u,p);this.Plugin.ExecuteCalibration(A,c)};if(this.Plugin.StructureLoadAutoCalibration[a].Status===e.ERequestAjaxStatus.Void){o.CurrentAnnotation=null;o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();if(!n){this.TypeCalibration=l.Auto;this.Plugin.Controller.SelectTool("OrthoAnnotationCalibrationAuto",t);this.CalibrationView.ChangeColorsForButtons()}var s=this.Controller.StudyViewerModel.Documents.StructureData[o.Context.StudyGuid];var h=s.Study.Series.StructureData[o.Context.SeriesGuid].Images.StructureData[o.Context.ImageEntity.ImageGUID];var m=o.Context.Viewport.ViewportElement.getContext("2d");if(!n)e.Toaster.ShowToast("Detecting calibration sphere.",e.Colors.PeterRiver,5);let d=Efferent.Frontend.WebClient.PlatformContext.PlatformUri;let u=this.Plugin.Controller.RegionId.split("/")[0];let p=sessionStorage["organizationName"];switch(sessionStorage["Environment"]){case"DEV":case"TEST":d="https://test.efferenthealth.net";break;case"PROD":d="https://platform.efferenthealth.net"}this.Plugin.StructureLoadAutoCalibration[a].Status=e.ERequestAjaxStatus.Pending;let c=`${d}/dcm/calibration?region=${u}&organization=${p}&study=${o.Context.StudyGuid}&series=${o.Context.SeriesGuid}&instance=${o.Context.ImageEntity.ImageGUID}`;let A={Accept:o.Context.ImageEntity.TransferSyntax==="1.2.840.10008.1.2.4.50"?"application/dicom;transfer-syntax=1.2.840.10008.1.2.4.50":"application/dicom"};let C=e.HttpUtils.AjaxCall(c,"GET",A,null,((t,o)=>{clearTimeout(r);this.Plugin.StructureLoadAutoCalibration[a].Status=e.ERequestAjaxStatus.Ready;if(o){try{this.Plugin.StructureLoadAutoCalibration[a].Status=e.ERequestAjaxStatus.Done;this.Plugin.StructureLoadAutoCalibration[a].Data=o;if(!n||this.CalibrationAutoModeCancelMute)executeAutoCalib(o)}catch(t){e.Utils.DebugConsoleLog(t);if(!n)e.Toaster.ShowToast("Auto Calibration is not available.",e.Colors.GreenSea,5);this.Plugin.StructureLoadAutoCalibration[a].Status=e.ERequestAjaxStatus.Error}}else{this.Plugin.StructureLoadAutoCalibration[a].Status=e.ERequestAjaxStatus.Error}}),((t,o)=>{clearTimeout(r);if(!n)e.Toaster.ShowToast("Calibration Sphere not found.",e.Colors.GreenSea,5);this.Plugin.StructureLoadAutoCalibration[a].Status=e.ERequestAjaxStatus.Error}));r=setTimeout((()=>{this.Plugin.StructureLoadAutoCalibration[a].Status=e.ERequestAjaxStatus.Abort;C.abort()}),1e4)}else{switch(this.Plugin.StructureLoadAutoCalibration[a].Status){case e.ERequestAjaxStatus.Done:executeAutoCalib(this.Plugin.StructureLoadAutoCalibration[a].Data);break;case e.ERequestAjaxStatus.Pending:e.Toaster.ShowToast("Detecting calibration sphere still.",e.Colors.PeterRiver,5);break;case e.ERequestAjaxStatus.Abort:case e.ERequestAjaxStatus.Error:this.Plugin.StructureLoadAutoCalibration[a].Status=e.ERequestAjaxStatus.Void;this.ActionBtnAutoCalibration(t);break}}}ActionBtnSphereCalibration(t){let n=this.Plugin.GetOrthoContext();n.CurrentAnnotation=null;n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();let o=e.Form.GetFieldFromForms(this.Data,"labelTextTitle");o.htmlElement.innerHTML="Mark 3 points around the calibration sphere";this.TypeCalibration=l.Sphere;this.Plugin.SphereDetector=null;this.Plugin.Controller.SelectTool("OrthoAnnotationCalibration",t);this.CalibrationView.ChangeColorsForButtons()}ActionBtnLinearCalibration(t){let n=this.Plugin.GetOrthoContext();n.CurrentAnnotation=null;n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();let o=e.Form.GetFieldFromForms(this.Data,"labelTextTitle");o.htmlElement.innerHTML="Mark 2 points for the calibration line";this.TypeCalibration=l.Linear;this.Plugin.SphereDetector=null;this.Plugin.Controller.SelectTool("OrthoAnnotationCalibrationLinear",t);this.CalibrationView.ChangeColorsForButtons()}ActionBtnCancelCalibration(e,n){let o=this.Plugin.GetOrthoContext();this.Plugin.SphereDetector=null;this.TypeCalibration=null;if(this.Plugin.CalibrationOptionFromMainMenu){this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.CalibrationView.OrthoFloatingBar.Id);this.CalibrationView.OrthoFloatingBar=null;this.Plugin.Menu.CancelCalibration();this.Controller.SelectDefaultTool()}else{this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.CalibrationView.OrthoFloatingBar.Id);this.CalibrationView.OrthoFloatingBar=null;this.Plugin.Menu.CancelCalibration();if(this.AnnotationReference!==null&&this.AnnotationReference!==undefined){let e=0;switch(this.AnnotationReference.Name){case"HipImplantAnnotation":e=parseFloat(this.Plugin.HipImplantController.HipImplantView.OrthoFloatingBar.Element.style.height);this.Plugin.HipImplantController.StatusDraw=false;this.Plugin.HipImplantController.HipAnnotation=o.CurrentAnnotation=null;var l=this.Plugin.HipImplantController.LegSide;this.Plugin.Menu.ProcessHipImplantToolEvent(null,this.Plugin.HipImplantController.Edition,this.Plugin.HipImplantController.HipAnnotation);this.Plugin.HipImplantController.LegSide=l;this.Plugin.HipImplantController.HipImplantView.SetBodyHip(l);o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();this.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.Plugin.HipImplantController.HipImplantView.OrthoFloatingBar.Element.style.height=e+"px";this.Plugin.HipImplantController.HipImplantView.OrthoFloatingBar.Element.children[0].style.height=`${e-5}px`;break;case"ShoulderImplantAnnotation":e=parseFloat(this.Plugin.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Element.style.height);this.Plugin.ShoulderImplantController.StatusDraw=false;this.Plugin.ShoulderImplantController.ShoulderAnnotation=o.CurrentAnnotation=null;var a=this.Plugin.ShoulderImplantController.LegSide;this.Plugin.Menu.ProcessShoulderImplantToolEvent(null,this.Plugin.ShoulderImplantController.Edition,this.Plugin.ShoulderImplantController.ShoulderAnnotation);this.Plugin.ShoulderImplantController.LegSide=a;this.Plugin.ShoulderImplantController.ShoulderImplantView.SetBodyShoulder(a);o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();this.Plugin.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");this.Plugin.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Element.style.height=e+"px";this.Plugin.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Element.children[0].style.height=`${e-5}px`;break;case"KneeImplantAnnotation":e=parseFloat(this.Plugin.KneeImplantController.KneeImplantView.OrthoFloatingBar.Element.style.height);o.CurrentAnnotation=null;if(this.Plugin.KneeImplantController.KneeImplantView.IdDefault!==t.ETemplateView[t.ETemplateView.AP]&&this.Plugin.KneeImplantController.KneeImplantView.IdDefault!==t.ETemplateView[t.ETemplateView.ML])this.Plugin.KneeImplantController.KneeImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];var r=this.Plugin.KneeImplantController.LegSide;this.Plugin.Menu.ProcessKneeImplantToolEvent(null,this.Plugin.KneeImplantController.Edition,this.Plugin.KneeImplantController.KneeAnnotation,this.AnnotationController);this.Plugin.KneeImplantController.LegSide=r;this.Plugin.KneeImplantController.KneeImplantView.SetBodyKnee(r);o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();this.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.Plugin.KneeImplantController.KneeImplantView.OrthoFloatingBar.Element.style.height=e+"px";this.Plugin.KneeImplantController.KneeImplantView.OrthoFloatingBar.Element.children[0].style.height=`${e-5}px`;break;case"AlignmentToolAnnotation":e=parseFloat(this.Plugin.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Element.style.height);this.Plugin.AlignmentToolController.AlignmentToolAnnotation=o.CurrentAnnotation=null;this.Plugin.Menu.ProcessAlignmentTool(null,this.Plugin.AlignmentToolController.Edition,"AlignmentTool","eFit",this.Plugin.AlignmentToolController.AlignmentToolAnnotation);this.Plugin.AlignmentToolController.ShowTextAndControl(1,this.Plugin.AlignmentToolController.AlignmentToolView.OrthoElementsSection1,0,0,"","",this.Plugin.AlignmentToolController.Edition);this.Plugin.AlignmentToolController.ShowTextAndControl(2,this.Plugin.AlignmentToolController.AlignmentToolView.OrthoElementsSection2,0,0,"","",this.Plugin.AlignmentToolController.Edition);o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();this.Plugin.Controller.SelectTool("OrthoAnnotationAlignmentTool","AlignmentTool");this.Plugin.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Element.style.height=e+"px";this.Plugin.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Element.children[0].style.height=`${e-5}px`;break}}if(n!==undefined){n()}}}GetCalibrationOption(){var t=e.Form.GetFieldFromForms(this.Data,"radio25mm");var n=e.Form.GetFieldFromForms(this.Data,"radio30mm");var o=e.Form.GetFieldFromForms(this.Data,"radio1inch");var l=e.Form.GetFieldFromForms(this.Data,"radioCustom");var a=e.Form.GetFieldFromForms(this.Data,"inputCustomCalibration");var r=0;if(t.htmlElement.checked){r=25}else if(n.htmlElement.checked){r=30}else if(o.htmlElement.checked){r=25.4}else if(l.htmlElement.checked){let t=a.htmlElement.value;if(t!==""&&!isNaN(+t))r=parseFloat(t);else r=0}return r}static Create(t,e,n=[0],o,l,a){var r=new CalibrationController;r.Controller=t.Controller;r.AnnotationReference=e;r.AnnotationController=o;r.Callback=l;r.Plugin=t;r.Controller.ActiveContextMenu=false;var s=r.Controller.GetSelectViewport(r.Controller.ViewportPane);if(s===null)return;var h=s.RendererPlugins[t.PluginName];r.CalibrationView.InitFormDataAndEvents(n,h,l,a);return r}}t.CalibrationController=CalibrationController})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(e){var n;(function(e){var n=Efferent.Frontend.WebClient;var o=Efferent.Frontend.WebClient.DOMUtils;const{div:l}=o;class CalibrationView{constructor(t){this.CalibrationController=t}InitFormDataAndEvents(o,a,r,s){this.OrthoFloatingBar=this.CalibrationController.Plugin.ManagementFloatingBar.CreateFloatingBar(document.body,"orthoCissDialog",true,"CalibrationTool",(()=>{this.CalibrationController.Controller.ResizeViewports()}));const h=l({className:"configPane",style:{display:"block"},children:[l({className:"margin"})]});this.CalibrationController.Container=h;var m={};this.CalibrationController.Data=[m];m["calibrateIconSrc"]=e.ResourceBag.Icons8Sphere32Png;m["actionBtnAutoCalibration"]=t=>{this.CalibrationController.CalibrationAutoModeCancelMute=true;this.CalibrationController.ActionBtnAutoCalibration(s)};m["actionBtnSphereCalibration"]=t=>{this.CalibrationController.ActionBtnSphereCalibration(s)};m["actionBtnLinearCalibration"]=t=>{this.CalibrationController.ActionBtnLinearCalibration(s)};m["actionChange25"]=(t,e)=>{this.actionRadioChangeValues()};m["actionChange30"]=(t,e)=>{this.actionRadioChangeValues()};m["actionChangeInch"]=(t,e)=>{this.actionRadioChangeValues()};m["actionChangeCustom"]=(t,e)=>{var o=n.Form.GetFieldFromForms(this.CalibrationController.Data,"inputCustomCalibration");o.htmlElement.focus()};m["actionBtnCancelCalibration"]=t=>{this.CalibrationController.ActionBtnCancelCalibration(s,r)};this.OrthoFloatingBar.Element.appendChild(h);this.orthoSections=(new t.Products.OrthoPlugin.CalibrationForm).Create(h.children[0],this.CalibrationController.Data);this.OrthoFloatingBar.BuildForm(this.orthoSections,o);this.uiControl();this.OrthoFloatingBar.Element.style.height="auto";var d=n.Form.GetFieldFromForms(m,"inputCustomCalibration");var u=n.Form.GetFieldFromForms(m,"radioCustom");var p=n.Form.GetFieldFromForms(m,"BtnSphereCalibration");p.htmlElement.click();d.htmlElement["focusIn"]=t=>{u.htmlElement.click()};d.htmlElement["keyPress"]=t=>{if(!n.Utils.IsNumber(t))t.preventDefault()}}ChangeColorsForButtons(){var t=n.Form.GetFieldFromForms(this.CalibrationController.Data,"BtnAutoCalibration");var l=n.Form.GetFieldFromForms(this.CalibrationController.Data,"BtnSphereCalibration");var a=n.Form.GetFieldFromForms(this.CalibrationController.Data,"BtnLinearCalibration");switch(this.CalibrationController.TypeCalibration){case e.ETypeCalibration.Auto:o.RemoveClass(t===null||t===void 0?void 0:t.htmlElement,e.ButtonClasses.ENABLE);o.AddClass(t===null||t===void 0?void 0:t.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(l===null||l===void 0?void 0:l.htmlElement,e.ButtonClasses.ENABLE);o.RemoveClass(l===null||l===void 0?void 0:l.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(a===null||a===void 0?void 0:a.htmlElement,e.ButtonClasses.ENABLE);o.RemoveClass(a===null||a===void 0?void 0:a.htmlElement,e.ButtonClasses.ACTIVE);break;case e.ETypeCalibration.Sphere:o.RemoveClass(t===null||t===void 0?void 0:t.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(t===null||t===void 0?void 0:t.htmlElement,e.ButtonClasses.ENABLE);o.AddClass(l===null||l===void 0?void 0:l.htmlElement,e.ButtonClasses.ACTIVE);o.RemoveClass(l===null||l===void 0?void 0:l.htmlElement,e.ButtonClasses.ENABLE);o.AddClass(a===null||a===void 0?void 0:a.htmlElement,e.ButtonClasses.ENABLE);o.RemoveClass(a===null||a===void 0?void 0:a.htmlElement,e.ButtonClasses.ACTIVE);break;case e.ETypeCalibration.Linear:o.RemoveClass(t===null||t===void 0?void 0:t.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(t===null||t===void 0?void 0:t.htmlElement,e.ButtonClasses.ENABLE);o.AddClass(l===null||l===void 0?void 0:l.htmlElement,e.ButtonClasses.ENABLE);o.RemoveClass(l===null||l===void 0?void 0:l.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(a===null||a===void 0?void 0:a.htmlElement,e.ButtonClasses.ACTIVE);o.RemoveClass(a===null||a===void 0?void 0:a.htmlElement,e.ButtonClasses.ENABLE);break}}uiControl(){var t=this.orthoSections;for(var e=0;e<t.length;e++){var n=t[e].children;for(var e=0;e<n.length;e++){var o=n[e];o.style.marginBottom="0px";if(e===n.length-1){o.style.marginBottom="0px";o.style.flex="1";o.style.display="flex";o.style.justifyContent="center";o.style.marginTop="5px"}}}}actionRadioChangeValues(){var t=this.CalibrationController.Controller.GetSelectViewport(this.CalibrationController.Controller.ViewportPane);if(t){var e=t.RendererPlugins[this.CalibrationController.Plugin.PluginName];if(e&&e.CurrentAnnotation){let t=this.CalibrationController.GetCalibrationOption();e.CurrentAnnotation.Value=t;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}}}e.CalibrationView=CalibrationView})(n=e.OrthoPlugin||(e.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;let o;(function(t){t[t["X"]=0]="X";t[t["Y"]=1]="Y"})(o=t.EAxis||(t.EAxis={}));class AxisValue{}class CobbAngle{}t.CobbAngle=CobbAngle;class CobbAngleCalculator{constructor(){}CalculateCobbAngle(t,e,o,l){this.pixelSpacing=1/parseFloat(o.toString());var a=new n.Vector2D(new n.AnnotationPoint(t.pointA),new n.AnnotationPoint(t.pointB));var r=new n.Vector2D(new n.AnnotationPoint(e.pointA),new n.AnnotationPoint(e.pointB));var s=new n.Line2D(a.P1,a);var h=new n.Line2D(r.P1,r);var m=new n.Line2D(a.P2,a.Clone().Orthogonal());var d;d=s.Intersection(h);var u=r.CalculateProjectionOrthogonal(a.P2);var p;p=m.Intersection(h);var c=new n.Vector2D(u,new n.AnnotationPoint(p));var A=new n.Vector2D(u,a.P2);var C=new n.Vector2D(a.P2,new n.AnnotationPoint(p));var S=C.MidPoint();var g=c.ScalarMult(.5).AddVectorToPoint(u);var I=C.Clone().ScalarMult(.2).AddVectorToAnnotationPoint(S);var P=A.Clone().ScalarMult(.2).AddVectorToAnnotationPoint(S);var f=a.Angle2VectorsDeg90(r);return{Angle:f,IP1X:I.X,IP1Y:I.Y,IP2X:P.X,IP2Y:P.Y,IX:S.X,IY:S.Y,PAX:d.X,PAY:d.Y,PS1X:a.P2.X,PS1Y:a.P2.Y,PS2X:g.X,PS2Y:g.Y,R1P1X:a.P1.X,R1P1Y:a.P1.Y,R1P2X:a.P2.X,R1P2Y:a.P2.Y,R2P1X:r.P1.X,R2P1Y:r.P1.Y,R2P2X:r.P2.X,R2P2Y:r.P2.Y}}CalculateCobbAngle2(t,e,n,l){this.pixelSpacing=1/parseFloat(n.toString());var a=this.viewDistanceBetweenPoints(t.pointB,e.pointB);var r=a;var s=t.pointA.Clone();var h=t.pointB.Clone();var m=e.pointA.Clone();var d=e.pointB.Clone();var u=this.getIntersection(s,h,m,d,{pointA:r.coordA,pointB:r.coordB});if(Math.abs(r.coordA.X-u.X)>r.distance||Math.abs(r.coordA.Y-u.Y)>r.distance||(Math.abs(r.coordB.X-u.X)>r.distance||Math.abs(r.coordB.Y-u.Y)>r.distance)){return null}else{var p;var c;var A=Math.abs(Math.abs(u.CrossA.X)-Math.abs(u.X));var C=Math.abs(Math.abs(u.CrossA.Y)-Math.abs(u.Y));if(A>C)p={Axis:o.X,Value:A};else p={Axis:o.Y,Value:C};var S=Math.abs(Math.abs(u.CrossB.X)-Math.abs(u.X));var g=Math.abs(Math.abs(u.CrossB.Y)-Math.abs(u.Y));if(S>g)c={Axis:o.X,Value:S};else c={Axis:o.Y,Value:g};var I=r.coordA.Clone();var P=u.Clone();var f=r.coordB.Clone();var w=180-this.getAngle(I,P,f,n,l);var b=this.getCoordAngle(u.LineA.A,u.LineA.B,u.LineA.C,u.LineB.A,u.LineB.B,u.LineB.C,u.X,u.Y,p,c);return{Angle:w,IP1X:u.CrossA.X,IP1Y:u.CrossA.Y,IP2X:u.CrossB.X,IP2Y:u.CrossB.Y,IX:u.X,IY:u.Y,PAX:b.X,PAY:b.Y,PS1X:u.PointExtA.X,PS1Y:u.PointExtA.Y,PS2X:u.PointExtB.X,PS2Y:u.PointExtB.Y,R1P1X:s.X,R1P1Y:s.Y,R1P2X:h.X,R1P2Y:h.Y,R2P1X:m.X,R2P1Y:m.Y,R2P2X:d.X,R2P2Y:d.Y}}}viewDistanceBetweenPoints(t,e){var n=Math.sqrt(Math.pow(e.Y-t.Y,2)+Math.pow(e.X-t.X,2));return{distance:n,coordA:t,coordB:e}}getIntersection(t,o,l,a,r){var s=this.getPointsSlope(t,o);var h=this.getPointsSlope(l,a);var m;var d;var u;var p;var c=0;var A=0;var C=0;var S=0;var g=0;var I=0;var P=0;var f=0;if(o.X===r.pointA.X&&o.Y===r.pointA.Y){u=this.getSlopeInRect(s,o);m=o}else{u=this.getSlopeInRect(s,t);m=t}if(a.X===r.pointB.X&&a.Y===r.pointB.Y){p=this.getSlopeInRect(h,a);d=a}else{p=this.getSlopeInRect(h,l);d=l}this.getIntersectionInPerpendiculate(t,o,p);this.getIntersectionInPerpendiculate(l,a,u);var w=new e.Point(0,0);w.X=(u.C*p.B-u.B*p.C)/(-u.A*p.B+u.B*p.A);if(p.B!==0)w.Y=(-p.A*w.X-p.C)/p.B;else w.Y=(-u.A*w.X-u.C)/u.B;if(w.X>m.X)c=w.X+20*this.pixelSpacing;else if(w.X===m.X)c=w.X;else c=w.X-20*this.pixelSpacing;if(w.Y>m.Y)A=w.Y+20*this.pixelSpacing;else if(w.Y===m.Y)A=w.Y;else A=w.Y-20*this.pixelSpacing;if(Math.abs(m.Y-w.Y)>Math.abs(m.X-w.X)){if(u.A!==0){g=(-u.C-u.B*A)/u.A;I=A}else{g=c;I=A}}else{if(u.B!==0){g=c;I=(-u.C-u.A*c)/u.B}else{g=c;I=A}}if(w.X>d.X)C=w.X+20*this.pixelSpacing;else if(w.X===d.X)C=w.X;else C=w.X-20*this.pixelSpacing;if(w.Y>d.Y)S=w.Y+20*this.pixelSpacing;else if(w.Y===d.Y)S=w.Y;else S=w.Y-20*this.pixelSpacing;if(Math.abs(w.Y-d.Y)>Math.abs(w.X-d.X)){if(p.A!==0){P=(-p.C-p.B*S)/p.A;f=S}else{P=C;f=S}}else{if(p.B!==0){P=C;f=(-p.C-p.A*C)/p.B}else{P=C;f=S}}var b=new e.Point(g,I);var v=new e.Point(P,f);return new n.Intersection(w,b,v,u,p,m,d)}getSlopeInRect(t,e){var n;var o;var l;if(t.X!==0){n=t.Y/t.X;o=-1;l=e.Y-n*e.X}else{n=1;o=0;l=-e.X}return{A:n,B:o,C:l}}getPointsSlope(t,n){var o=t.Y-n.Y;var l=n.X-t.X;return new e.Point(o,l)}getPointInRect(t,e){var n=e.Y-t.Y;var o=-e.X+t.X;var l=-((e.Y-t.Y)*t.X+(e.X-t.X)*t.Y);return{A:n,B:o,C:l}}getIntersectionInPerpendiculate(t,n,o){var l=this.getPointInRect(t,n);var a=new e.Point(0,0);a.X=(l.C*o.B-l.B*o.C)/(-l.A*o.B+l.B*o.A);if(o.B!==0)a.Y=(-o.A*a.X-o.C)/o.B;else a.Y=(-l.A*a.X-l.C)/l.B;return false}getAngle(t,e,n,o,l){var a=t.X*o-e.X*o;var r=t.Y*l-e.Y*l;var s=n.X*o-e.X*o;var h=n.Y*l-e.Y*l;var m=(a*s+r*h)/(Math.sqrt(Math.pow(a,2)+Math.pow(r,2))*Math.sqrt(Math.pow(s,2)+Math.pow(h,2)));var d=180*Math.acos(m)/Math.PI;return d}getCoordAngle(t,n,l,a,r,s,h,m,d,u){var p=Math.sqrt(Math.pow(a,2)+Math.pow(r,2));var c=Math.sqrt(Math.pow(t,2)+Math.pow(n,2));var A;var C;var S;var g;var I;var P;var f;var w;d.Value=d.Value+10*this.pixelSpacing;u.Value=u.Value+10*this.pixelSpacing;if(d.Axis===o.Y){I=(-l*p+s*c-(m-d.Value)*(n*p-r*c))/(t*p-a*c);A=new e.Point(h,m);C=new e.Point(I,m-d.Value)}else if(d.Axis===o.X){I=(-l*p+s*c-(h-d.Value)*(t*p-a*c))/(n*p-r*c);A=new e.Point(h,m);C=new e.Point(h-d.Value,I)}f=Math.sqrt(Math.pow(C.Y-A.Y,2)+Math.pow(C.X-A.X,2));if(u.Axis===o.Y){P=(-l*p-s*c-(m-u.Value)*(n*p+r*c))/(t*p+a*c);S=new e.Point(h,m);g=new e.Point(P,m-u.Value)}else if(u.Axis===o.X){P=(-l*p-s*c-(h-u.Value)*(t*p+a*c))/(n*p+r*c);S=new e.Point(h,m);g=new e.Point(h-u.Value,P)}w=Math.sqrt(Math.pow(g.Y-S.Y,2)+Math.pow(g.X-S.X,2));if(w<f){if(u.Axis===o.Y)return new e.Point(g.X-6*this.pixelSpacing,g.Y);else return new e.Point(g.X,g.Y)}else{if(u.Axis===o.Y)return new e.Point(C.X-6*this.pixelSpacing,C.Y);else return new e.Point(C.X,C.Y)}}}t.CobbAngleCalculator=CobbAngleCalculator})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){let e;(function(t){t[t["AP"]=0]="AP";t[t["ML"]=1]="ML";t[t["Fav"]=2]="Fav";t[t["Stem"]=3]="Stem";t[t["Cup"]=4]="Cup";t[t["Head"]=5]="Head";t[t["Femoral"]=6]="Femoral";t[t["Tibial"]=7]="Tibial";t[t["Implant"]=8]="Implant";t[t["Glenosphere"]=9]="Glenosphere";t[t["Glenoid"]=10]="Glenoid";t[t["HumeralHead"]=11]="HumeralHead"})(e=t.ETemplateView||(t.ETemplateView={}))})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){t.ButtonClasses={ENABLE:"blue",ACTIVE:"orange",REFERENCE:"purple",CRITIC:"red",SUCCESS:"green"}})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;let o;(function(t){t[t["None"]=0]="None";t[t["Calibration"]=1]="Calibration";t[t["Acetabulum"]=2]="Acetabulum";t[t["FemoralHead"]=3]="FemoralHead";t[t["FemoralCurveDistal"]=4]="FemoralCurveDistal";t[t["FemoralCurveMedial"]=5]="FemoralCurveMedial";t[t["ShaftAngle"]=6]="ShaftAngle";t[t["AbductionAngle"]=7]="AbductionAngle";t[t["AbductionSetAngle"]=8]="AbductionSetAngle";t[t["FavImplant"]=9]="FavImplant";t[t["StemImplant"]=10]="StemImplant";t[t["CupImplant"]=11]="CupImplant";t[t["HeadImplant"]=12]="HeadImplant";t[t["InsertImplant"]=13]="InsertImplant";t[t["AdjustImplant"]=14]="AdjustImplant";t[t["AdjustStemImplant"]=15]="AdjustStemImplant";t[t["AdjustAcetabularCupImplant"]=16]="AdjustAcetabularCupImplant"})(o=t.EActionHip||(t.EActionHip={}));let l;(function(t){t[t["Stem"]=0]="Stem";t[t["Cup"]=1]="Cup"})(l=t.EHipImplant||(t.EHipImplant={}));class HipImplantController{constructor(e,n){this.Plugin=e;this.LegSide=t.EBodySide.Right;this.ActionHip=o.None;this.ActionsSummaryData={};this.ImplantsPerFamily={};this.DataWasLoaded={};this.manufacturers={};this.ImplantsPerFamily[l[l.Cup]]=new Array;this.ImplantsPerFamily[l[l.Stem]]=new Array;this.HipImplantView=new t.HipImplantView(this,n);this.ShaftAngleWasUpdated=false;this.StatusAfterOkHipAbductionAngle=false;this.StatusSetAbductionAngle=false;this.CISSAutomaticImplantsMode=true}LoadSvgStemOnViewport(t,o,a,r=false){var s=this.HipImplantView.GetSelectManufacturerStem();var h=this.HipImplantView.GetSelectProductLineStem();var m=this.HipImplantView.GetSelectComponentFamilyStem();var d=this.implantStemLibrary.GetImplantTemplateForId(h,m,o);if(d){this.HipAnnotation.OrthoStemImplant.ImplantManufacturer=s;this.HipAnnotation.OrthoStemImplant.ImplantProductLine=h;this.HipAnnotation.OrthoStemImplant.ImplantComponentFamily=m;this.HipAnnotation.OrthoStemImplant.ImplantSize=o;try{var u=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.HipImplantView.GetSelectManufacturerStem()+"/groups/hip/files/";this.HipAnnotation.OrthoStemImplant.ImplantSvgUrl=u+d.templates.filter((t=>t.title==="AP"))[0].url;this.HipAnnotation.OrthoStemImplant.LoadImplantFromSVG((()=>{if(Efferent.ClientViews.ImplantTemplateView.LandmarksManager.LandmarksAreComplete("Hip","Stem","AP",this.HipAnnotation.OrthoStemImplant.LandmarksTemplate,this.HipAnnotation.OrthoStemImplant.LandmarkItems)){if(!this.ShaftAngleWasUpdated){var o=this.HipAnnotation.GetShaftAngleFromLandmarks();if(o)this.HipAnnotation.SetShaftAngle(o)}var s=this.HipAnnotation.GetInitialStemImplantPosition();if(this.HipAnnotation.GetShaftAngle())this.ActionsSummaryData["Code07"]={Code:"Code07",Description:"Shaft angle set in "+Math.round(this.HipAnnotation.GetShaftAngle())+" degrees"};else e.Toaster.ShowToast("Shaft angle is indefinite, please enter value.",e.Colors.Orange,3.5);this.ActionsSummaryData["Code11"]={Code:"Code11",Description:"Stem rotation: "+Math.round(n.Geometry.CalculateRotate360(this.HipAnnotation.OrthoStemImplant.Rotation))+" deg"};this.ActionsSummaryData["Code12"]={Code:"Code12",Description:"Stem implant size: "+this.GetImplantSizeName(this.HipAnnotation.OrthoStemImplant,l.Stem)};this.ShowSummary();this.HipAnnotation.OrthoStemImplant.PositionX=this.HipAnnotation.OrthoStemImplant.WasMoved?this.HipAnnotation.OrthoStemImplant.PositionX:parseFloat(s.X.toString());this.HipAnnotation.OrthoStemImplant.PositionY=this.HipAnnotation.OrthoStemImplant.WasMoved?this.HipAnnotation.OrthoStemImplant.PositionY:parseFloat(s.Y.toString());this.HipAnnotation.OrthoStemImplant.Rotation=this.HipAnnotation.OrthoStemImplant.WasRotated?this.HipAnnotation.OrthoStemImplant.Rotation:this.HipAnnotation.GetInitialStemImplantRotationAngle()*(180/Math.PI);if(r)this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",a);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The implant cannot be shown due to non-existent data.",e.Colors.Orange,3.5);this.HipAnnotation.OrthoStemImplant.SetImplantImage(null);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}}),d.templates.filter((t=>t.title==="AP"))[0].content,d.templates.filter((t=>t.title==="AP"))[0].landmarks)}catch(t){e.Toaster.ShowToast("Error getting implant parsing data",e.Colors.Orange,3.5)}}}LoadSvgAcetabularCupOnViewport(t,n,o,a=false){var r=this.HipImplantView.GetSelectManufacturerAcetabularCup();var s=this.HipImplantView.GetSelectProductLineAcetabularCup();var h=this.HipImplantView.GetSelectComponentFamilyAcetabularCup();var m=this.implantAcetabularCupLibrary.GetImplantTemplateForId(s,h,n);if(m){this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=r;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantProductLine=s;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantComponentFamily=h;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantSize=n;try{var d=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.HipImplantView.GetSelectManufacturerAcetabularCup()+"/groups/hip/files/";this.HipAnnotation.OrthoAcetabularCupImplant.ImplantSvgUrl=d+m.templates.filter((t=>t.title==="AP"))[0].url;this.HipAnnotation.OrthoAcetabularCupImplant.LoadImplantFromSVG((()=>{if(Efferent.ClientViews.ImplantTemplateView.LandmarksManager.LandmarksAreComplete("Hip","Cup","AP",this.HipAnnotation.OrthoAcetabularCupImplant.LandmarksTemplate,this.HipAnnotation.OrthoAcetabularCupImplant.LandmarkItems)){var n=this.HipAnnotation.GetInitialAcetabularCupImplantPosition();this.HipAnnotation.OrthoAcetabularCupImplant.PositionX=this.HipAnnotation.OrthoAcetabularCupImplant.WasMoved?this.HipAnnotation.OrthoAcetabularCupImplant.PositionX:parseFloat(n.X.toString());this.HipAnnotation.OrthoAcetabularCupImplant.PositionY=this.HipAnnotation.OrthoAcetabularCupImplant.WasMoved?this.HipAnnotation.OrthoAcetabularCupImplant.PositionY:parseFloat(n.Y.toString());this.HipAnnotation.OrthoAcetabularCupImplant.Rotation=this.HipAnnotation.OrthoAcetabularCupImplant.WasRotated?this.HipAnnotation.OrthoAcetabularCupImplant.Rotation:this.HipAnnotation.GetInitialAcetabularImplantRotationAngle()*(180/Math.PI);if(a)this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",o);var r=t.Context.ImageEntity["pixelSpacing"][2];var s=t.Context.ImageEntity["pixelSpacing"][0];var h=t.Context.ImageEntity["pixelSpacing"][1];var m=s||h;this.ActionsSummaryData["Code05"]={Code:"Code05",Description:"Acetabular Diameter "+Math.round(this.HipAnnotation.GetAcetabularCupActualDiameter()*1)+" "+r};this.ActionsSummaryData["Code14"]={Code:"Code14",Description:"Cup rotation: "+Math.round(this.HipAnnotation.OrthoAcetabularCupImplant.Rotation)+" deg"};this.ActionsSummaryData["Code15"]={Code:"Code15",Description:"Cup implant size: "+this.GetImplantSizeName(this.HipAnnotation.OrthoAcetabularCupImplant,l.Cup)};this.ShowSummary();t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The implant cannot be shown due to non-existent data.",e.Colors.Orange,3.5);this.HipAnnotation.OrthoAcetabularCupImplant.SetImplantImage(null);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}}),m.templates.filter((t=>t.title==="AP"))[0].content,m.templates.filter((t=>t.title==="AP"))[0].landmarks)}catch(t){e.Toaster.ShowToast("Error getting implant parsing data",e.Colors.Orange,3.5)}}}SetCISSAutomaticImplantsModeStatus(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];if(t){this.CISSAutomaticImplantsMode=true;this.HipAnnotation.OrthoStemImplant.WasMoved=false;this.HipAnnotation.OrthoStemImplant.WasRotated=false;this.HipAnnotation.OrthoStemImplant.OffsetX=0;this.HipAnnotation.OrthoStemImplant.OffsetY=0;this.HipAnnotation.OrthoAcetabularCupImplant.WasMoved=false;this.HipAnnotation.OrthoAcetabularCupImplant.WasRotated=false;this.HipAnnotation.OrthoAcetabularCupImplant.OffsetX=0;this.HipAnnotation.OrthoAcetabularCupImplant.OffsetY=0;this.LoadSvgStemOnViewport(n,this.HipImplantView.GetUpDownImplantSizeStem(),true);this.LoadSvgAcetabularCupOnViewport(n,this.HipImplantView.GetUpDownImplantSizeAcetabularCup(),true)}else{this.CISSAutomaticImplantsMode=false}}AIHipImplantAdapter(){return __awaiter(this,void 0,void 0,(function*(){return new Promise((n=>{let o=this.Plugin.GetOrthoContext();let l="https://dev-efferent-anatomical-landmarks.azurewebsites.net";switch(sessionStorage["Environment"]){case"DEV":l="https://dev-efferent-anatomical-landmarks.azurewebsites.net";break;case"TEST":l="https://test-efferent-anatomical-landmarks.azurewebsites.net";break;case"PROD":l="https://dev-efferent-anatomical-landmarks.azurewebsites.net";break}let a=this.Plugin.Controller.RegionId.split("/")[0];let r=sessionStorage["organizationName"];let s=this.HipAnnotation.ViewDirection===t.EViewCiss.AP?"AP":"PA";let h=`${l}/api/anatomical-landmarks/anlyze-hips?region=${a}&organization=${r}&study=${o.Context.StudyGuid}&series=${o.Context.SeriesGuid}&instance=${o.Context.ImageEntity.ImageGUID}&orientation=${s}`;let m={Accept:o.Context.ImageEntity.TransferSyntax==="1.2.840.10008.1.2.4.50"?"application/dicom;transfer-syntax=1.2.840.10008.1.2.4.50":"application/dicom"};e.Loader.Show("Executing AI");let d=e.HttpUtils.AjaxCall(h,"GET",m,null,((t,o)=>{e.Loader.Hide();if(o){n(o)}else{e.Toaster.ShowToast("HIP IA not found.",e.Colors.GreenSea,5);n("")}}),((t,o)=>{e.Loader.Hide();e.Toaster.ShowToast("HIP IA error with image.",e.Colors.GreenSea,5);n("")}),undefined,undefined,undefined,undefined,undefined,3e4,(()=>{e.Toaster.ShowToast("HIP IA not found.",e.Colors.GreenSea,5);n("")}))}))}))}RerenderImplantBySide(n){try{var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=o.RendererPlugins[this.Plugin.PluginName];var a=!this.Edition?l.CurrentAnnotation:l.LastAnnotationCreatedOrSelected;a.SetHipSide(n===t.EBodySide.Left?t.EHipTemplateSide.Left:t.EHipTemplateSide.Right);o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){e.Utils.DebugConsoleLog(t)}}ShowSummary(){if(this.HipAnnotation){if(this.HipAnnotation.OrthoStemImplant&&!this.HipAnnotation.OrthoStemImplant.ImplantReadyForDraw){delete this.ActionsSummaryData["Code11"];delete this.ActionsSummaryData["Code12"]}if(this.HipAnnotation.OrthoAcetabularCupImplant&&!this.HipAnnotation.OrthoAcetabularCupImplant.ImplantReadyForDraw){delete this.ActionsSummaryData["Code14"];delete this.ActionsSummaryData["Code15"]}}this.HipImplantView.BuildSummary(this.ActionsSummaryData)}ActionOkHipStatusNone(t){var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=o.RendererPlugins[this.Plugin.PluginName];var a=l.Context.AnnotationController.GroupIsSatisfied(l.Context.AnnotationController.Template.Groups["Acetabulum"]);var r=l.Context.AnnotationController.GroupIsSatisfied(l.Context.AnnotationController.Template.Groups["FemoralHead"]);var s=l.Context.AnnotationController.GroupIsSatisfied(l.Context.AnnotationController.Template.Groups["CurveDistal"]);var h=l.Context.AnnotationController.GroupIsSatisfied(l.Context.AnnotationController.Template.Groups["CurveMedial"]);var m=this.HipAnnotation.OrthoStemImplant.ImplantReadyForDraw;var d=this.HipAnnotation.OrthoAcetabularCupImplant.ImplantReadyForDraw;if(a&&r&&s&&h||m||d){this.HipAnnotation.Status=n.EAnnotationStatus.Complete}if(!this.Edition){this.HipAnnotation.Visible=true;l.Annotations.push(this.HipAnnotation);l.LastAnnotationCreatedOrSelected=this.HipAnnotation;this.Plugin.AnnotationDone(o);this.Edition=true;this.Plugin.Controller.View.Platform.Toolbar.DeselectAllButtons();if(t)t()}else{this.HipAnnotation.Visible=true;const annotationDoneCallback=()=>{e.Toaster.ShowToast("Last changes were saved.",e.Colors.Emerald,5)};l.CurrentAnnotation=this.HipAnnotation;this.Plugin.AnnotationDone(o,annotationDoneCallback);if(t)t()}this.HipAnnotation.Selected=true;this.UnSelectAllImplants();this.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool")}UnSelectAllImplants(){Object.keys(this.HipAnnotation).forEach((e=>{if(this.HipAnnotation[e]instanceof t.OrthoTemplate){if(this.HipAnnotation[e]){this.HipAnnotation[e].Hover=false;this.HipAnnotation[e].Selected=false}}}))}ActionCancelHipStatusNone(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition){var l={Action:()=>{o.LastAnnotationCreatedOrSelected=null;this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.HipImplantView.OrthoFloatingBar.Id);this.HipImplantView.OrthoFloatingBar=null;this.Plugin.Menu.CancelHipImplant(this.HipAnnotation);this.Plugin.Controller.View.Platform.Toolbar.DeselectAllButtons();this.UnSelectAllImplants();this.Controller.SelectDefaultTool()},Name:"Ok",Text:"Yes",Id:"btnOkCancelHipImplant"};var a={Action:()=>{},Name:"Cancel",Text:"No",Id:"btnCancelCancelHipImplant"};l.ClassNames=[t.ButtonClasses.SUCCESS];a.ClassNames=[t.ButtonClasses.CRITIC];var r=new e.MessageBox("Do you want to cancel the whole operation?",[l,a]);r.Show()}else{o.LastAnnotationCreatedOrSelected=null;this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.HipImplantView.OrthoFloatingBar.Id);this.HipImplantView.OrthoFloatingBar=null;this.Plugin.Menu.CancelHipImplant(this.HipAnnotation);this.Controller.SelectDefaultTool()}}ActionOkHipStatusAcetabulum(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=t.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["Acetabulum"])){this.ActionHip=o.None;this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(n,this.HipAnnotation,this.ActionHip);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The current group is not complete.",e.Colors.PeterRiver,3.5)}}ActionCancelHipStatusAcetabulum(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionHip=o.None;this.StatusDraw=false;this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default");e.Context.AnnotationController.ResetOnlyCurrentGroup();e.Context.AnnotationController.CurrentGroup=null;delete this.ActionsSummaryData["Code05"];this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionOkHipStatusFemoralHead(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=t.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["FemoralHead"])){this.ActionHip=o.None;this.StatusDraw=false;n.Context.AnnotationController.ResetOnlyCurrentGroup();delete this.ActionsSummaryData["Code04"];delete this.ActionsSummaryData["Code05"];delete this.ActionsSummaryData["Code06"];n.CurrentAnnotation.MeasureAnnotation();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(n,this.HipAnnotation,this.ActionHip);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The current group is not complete.",e.Colors.PeterRiver,3.5)}}ResetActionsDraw(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];this.StatusDraw=false;if(n.Context.AnnotationController){if(n.Context.AnnotationController.CurrentGroup&&t!==n.Context.AnnotationController.CurrentGroup.GroupName){if(!n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups[n.Context.AnnotationController.CurrentGroup.GroupName])){n.Context.AnnotationController.ResetOnlyCurrentGroup();n.Context.AnnotationController.CurrentGroup=null;n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}}}this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default")}ActionCancelHipStatusFemoralHead(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionHip=o.Calibration;this.StatusDraw=false;this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default");e.Context.AnnotationController.ResetOnlyCurrentGroup();e.Context.AnnotationController.CurrentGroup=null;delete this.ActionsSummaryData["Code04"];this.ShowSummary();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionOkHipStatusFemoralCurveDistal(t){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];if(l.Context.AnnotationController.GroupIsSatisfied(l.Context.AnnotationController.Template.Groups["CurveDistal"])){this.ActionHip=o.FemoralCurveMedial;t();this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(l,this.HipAnnotation,this.ActionHip);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"FemoralRightLateralSection","RightTextLateralFemoral","CurveMedial",this.Edition);l.Context.AnnotationController.JumpToNextGroup()}else{e.Toaster.ShowToast("The current group is not complete.",e.Colors.PeterRiver,3.5)}}ActionCancelHipStatusFemoralCurveDistal(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionHip=o.Calibration;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("CurveMedial");e.Context.AnnotationController.ResetCurrentGroup();delete this.ActionsSummaryData["Code04"];delete this.ActionsSummaryData["Code05"];delete this.ActionsSummaryData["Code06"];e.CurrentAnnotation.MeasureAnnotation();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionOkHipStatusFemoralCurveMedial(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=t.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["CurveMedial"])){this.ActionHip=o.Calibration;this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(n,this.HipAnnotation,this.ActionHip);this.DoneCurveMedial=this.HipAnnotation.ReadyForRender=true;n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);n.Context.AnnotationController.JumpToNextGroup();if(this.HipAnnotation.OrthoStemImplant.ImplantReadyForDraw){var a=this.HipAnnotation.GetInitialStemImplantPosition();this.HipAnnotation.OrthoStemImplant.OffsetX=0;this.HipAnnotation.OrthoStemImplant.OffsetY=0;this.HipAnnotation.OrthoStemImplant.PositionX=parseFloat(a.X.toString());this.HipAnnotation.OrthoStemImplant.PositionY=parseFloat(a.Y.toString());this.HipAnnotation.OrthoStemImplant.Rotation=this.HipAnnotation.OrthoStemImplant.WasRotated?this.HipAnnotation.OrthoStemImplant.Rotation:this.HipAnnotation.GetInitialStemImplantRotationAngle()*(180/Math.PI);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();this.ImplantInformation(this.HipAnnotation.OrthoStemImplant,l.Stem)}}else{e.Toaster.ShowToast("The current group is not complete.",e.Colors.PeterRiver,3.5)}}ActionCancelHipStatusFemoralCurveMedial(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionHip=o.Calibration;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("CurveMedial");e.Context.AnnotationController.ResetCurrentGroup();delete this.ActionsSummaryData["Code04"];delete this.ActionsSummaryData["Code05"];delete this.ActionsSummaryData["Code06"];e.CurrentAnnotation.MeasureAnnotation();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionOkHipStatusShaftAngle(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ShaftAngleWasUpdated=true;this.HipAnnotation.ShaftAngleWasUpdated=true;this.ActionsSummaryData["Code07"]={Code:"Code07",Description:"Shaft angle set in "+Math.round(this.HipAnnotation.GetShaftAngle())+" degrees"};this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionCancelHipStatusShaftAngle(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionHip=o.Calibration;this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default");this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);this.HipAnnotation.SetShaftAngle(this.LastValueShaftAngle);this.ActionsSummaryData["Code07"]={Code:"Code07",Description:"Shaft angle set in "+Math.round(this.HipAnnotation.GetShaftAngle())+" degrees"};this.ShowSummary();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}GetDataCalibration(){const t=this.Plugin.Controller;const e=t.GetSelectViewport(t.ViewportPane);const n=e.Context.ImageEntity["pixelSpacing"][2];const o=e.Context.ImageEntity["pixelSpacing"][0];const l=e.Context.ImageEntity["pixelSpacing"][1];const a=o||l;return{calibrationFactor:a,units:n}}SetLegDiscrepaceAbductionAngle(){let t=this.HipAnnotation.GetLengthLegDiscrepancy();if(t!==undefined){let e=this.GetDataCalibration();let n=Math.round(t);this.ActionsSummaryData["CodeLegDiscrepancyAbduction"]={Code:"CodeLegDiscrepancyAbduction",Description:`Hip length variance: ${n} ${e.units}`}}}GetHipManufacturers(){return this.manufacturers}SetLegOffsetDifference(){let t=this.HipAnnotation.GetLegOffsetDifference();if(t!==undefined){let e=this.GetDataCalibration();this.ActionsSummaryData["CodeLegOffsetDifference"]={Code:"CodeLegOffsetDifference",Description:`Leg Offset : ${Math.round(t*e.calibrationFactor)} ${e.units}`}}}ActionOkHipStatusAbductionAngle(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionsSummaryData["Code08"]={Code:"Code08",Description:"Abduction line set in "+Math.round(this.HipAnnotation.GetAbductionAngle())+" degrees"};this.StatusDraw=false;this.SetLegDiscrepaceAbductionAngle();this.SetLegOffsetDifference();this.StatusAfterOkHipAbductionAngle=true;this.ShowTextDiscrepancyAbductionAngle();this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();this.ShowTextDiscrepancyAbductionAngle();if(this.Edition)this.Controller.SelectDefaultTool()}ActionCancelHipStatusAbductionAngle(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];if(!this.Edition){e.Context.AnnotationController.SetCurrentGroup("AbductionLine");e.Context.AnnotationController.ResetCurrentGroup()}this.ActionHip=o.Calibration;this.StatusDraw=false;e.Context.AnnotationController.CurrentGroup=null;this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default");this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();if(this.Edition)this.Controller.SelectDefaultTool()}ActionOkHipStatusAbductionSetAngle(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionsSummaryData["Code08"]={Code:"Code08",Description:"Abduction line set in "+Math.round(this.HipAnnotation.GetAbductionAngle())+" degrees"};this.SetLegDiscrepaceAbductionAngle();this.SetLegOffsetDifference();this.StatusSetAbductionAngle=true;this.HipAnnotation.StatusSetAbductionAngle=true;this.StatusDraw=false;this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default");this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();if(this.Edition)this.Controller.SelectDefaultTool()}ActionCancelHipStatusAbductionSetAngle(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=t.RendererPlugins[this.Plugin.PluginName];this.ActionHip=o.Calibration;this.StatusDraw=false;this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default");this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.HipImplantView.ControlButtonsMainWindow(e,this.HipAnnotation,this.ActionHip);this.HipAnnotation.SetAbductionAngle(this.LastAbductionAngle);this.ActionsSummaryData["Code08"]={Code:"Code08",Description:"Abduction line set in "+Math.round(this.HipAnnotation.GetAbductionAngle())+" degrees"};this.ShowSummary();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();if(this.Edition)this.Controller.SelectDefaultTool()}GetTextAbductionAngleDiscrepancy(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];let o=this.GetDataCalibration();let l="";const a=this.HipAnnotation.GetLengthLegDiscrepancy();let r=this.HipImplantView.GetTransischialPointsStatusComplete(n);if(r===true){if(a!==undefined){if(this.LegSide===t.EBodySide.Right){if(a>0){l=`The right leg length is  ${Math.abs(Math.round(a))} ${o.units} larger than the left leg.`}else{l=`The right leg length is  ${Math.abs(Math.round(a))} ${o.units} shorter than the left leg.`}}else{if(a>0){l=`The left leg length is  ${Math.abs(Math.round(a))} ${o.units} larger than the right leg.`}else{l=`The left leg length is  ${Math.abs(Math.round(a))} ${o.units} shorter than the right leg.`}}if(Math.abs(Math.round(a))<.5){l=`Both legs are the same length.`}}}return l}GetTextAbductionAngleOffset(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];let o=this.GetDataCalibration();let l="";let a=this.HipImplantView.GetTransischialPointsStatusComplete(n);const r=this.HipAnnotation.GetLegOffsetDifference()*o.calibrationFactor;if(a===true){if(r!==undefined){if(this.LegSide===t.EBodySide.Right){if(r>0){l=`The right hip offset is  ${Math.abs(Math.round(r))} ${o.units} larger than the left hip.`}else{l=`The right hip offset is  ${Math.abs(Math.round(r))} ${o.units} shorter than the left hip.`}}else{if(r>0){l=`The left hip offset is  ${Math.abs(Math.round(r))} ${o.units} larger than the right hip.`}else{l=`The left hip offset is  ${Math.abs(Math.round(r))} ${o.units} shorter than the right hip.`}}if(Math.abs(Math.round(r))<.5){l=`The hips are symmetrical`}}}return l}ShowTextDiscrepancyAbductionAngle(){let e=this.GetDataCalibration();let n=this.GetTextAbductionAngleDiscrepancy();let o=this.GetTextAbductionAngleOffset();let l="";let a="";let r="";const s=this.HipAnnotation.GetLengthLegDiscrepancy();const h=this.HipAnnotation.GetLegOffsetDifference()*e.calibrationFactor;if(s!==undefined&&h!==undefined){if(this.LegSide===t.EBodySide.Right){l=`(R - L)`;a=`(L - R)`}else{l=`(L - R)`;a=`(R - L)`}}r=`Hip length variance: <br /> You can relocate the marking points on each leg. <br />\n                                Left leg length: ${Math.abs(Math.round(this.HipAnnotation.GetLegAbductionAngleLeftDiscrepancy()*e.calibrationFactor)).toString()} ${e.units} <br />\n                                Right leg length: ${Math.abs(Math.round(this.HipAnnotation.GetLegAbductionAngleRightDiscrepancy()*e.calibrationFactor)).toString()} ${e.units} <br />\n                                <br />\n                                Length ${a}:  ${Math.round(s).toString()} ${e.units} <br />\n                                Offset ${l}:  ${Math.round(h).toString()} ${e.units} <br />\n                                <br />\n                                ${n} <br />\n                                ${o}`;this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"AcetabulumAbductionAngleSectionFinal","textTransischialFinal","AbductionLine",this.Edition,r);this.SetLegDiscrepaceAbductionAngle();this.SetLegOffsetDifference();this.WriteActionSummaryDataForEdition()}WriteActionSummaryDataForEdition(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];var o=n.Context.ImageEntity["pixelSpacing"][2];var a=n.Context.ImageEntity["pixelSpacing"][0];var r=n.Context.ImageEntity["pixelSpacing"][1];var s=a||r;this.ActionsSummaryData["Code04"]={Code:"Code04",Description:"Femoral head diameter "+Math.round(this.HipAnnotation.GetFemoralHeadDiameter()*s)+" "+o};if(this.HipAnnotation.GetShaftAngle()){this.ActionsSummaryData["Code07"]={Code:"Code07",Description:"Shaft angle set in "+Math.round(this.HipAnnotation.GetShaftAngle())+" degrees"}}this.SetLegDiscrepaceAbductionAngle();this.SetLegOffsetDifference();this.ActionsSummaryData["Code08"]={Code:"Code08",Description:"Abduction line set in "+Math.round(this.HipAnnotation.GetAbductionAngle())+" degrees"};if(this.HipAnnotation.OrthoStemImplant){this.LoadManufacturers((t=>{if(!this.implantStemLibrary){this.LoadDataPerManufacturer(l.Stem,this.HipAnnotation.OrthoStemImplant.ImplantManufacturer,false,(()=>{this.ImplantInformation(this.HipAnnotation.OrthoStemImplant,l.Stem)}))}}),"hip",t.EBodySide[this.LegSide],l[l.Stem].replace("_"," "))}if(this.HipAnnotation.OrthoAcetabularCupImplant){if(this.HipAnnotation.OrthoAcetabularCupImplant.ImplantReadyForDraw){this.ActionsSummaryData["Code05"]={Code:"Code05",Description:"Acetabular Diameter "+Math.round(this.HipAnnotation.GetAcetabularCupActualDiameter()*1)+" "+o}}this.LoadManufacturers((t=>{if(!this.implantAcetabularCupLibrary){this.LoadDataPerManufacturer(l.Cup,this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer,false,(()=>{this.ImplantInformation(this.HipAnnotation.OrthoAcetabularCupImplant,l.Cup)}))}}),"hip",t.EBodySide[this.LegSide],l[l.Cup].replace("_"," "))}this.ShowSummary()}ImplantInformation(t,o){try{if(o===l.Stem){this.ActionsSummaryData["Code11"]={Code:"Code11",Description:"Stem rotation: "+Math.round(n.Geometry.CalculateRotate360(t.Rotation))+" deg"};this.ActionsSummaryData["Code12"]={Code:"Code12",Description:"Stem implant size: "+this.GetImplantSizeName(t,l.Stem)};this.ShowSummary()}else if(o===l.Cup){this.ActionsSummaryData["Code14"]={Code:"Code14",Description:"Cup rotation: "+Math.round(n.Geometry.CalculateRotate360(t.Rotation))+" deg"};this.ActionsSummaryData["Code15"]={Code:"Code15",Description:"Cup implant size: "+this.GetImplantSizeName(t,l.Cup)};this.ShowSummary()}}catch(t){e.Utils.DebugConsoleLog(t)}}ActionOkHipStatusInsertImplantStem(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];this.HipImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionHip=o.None;this.HipImplantView.ViewTab();this.LoadSvgStemOnViewport(n,this.HipImplantView.GetUpDownImplantSizeStem(),true);this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(n,this.HipAnnotation,this.ActionHip);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}ActionCancelHipStatusInsertImplantStem(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var a=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition)a.LastAnnotationCreatedOrSelected=null;this.implantStemLibrary=null;this.HipAnnotation.OrthoStemImplant=new t.OrthoTemplate(this.HipAnnotation);this.HipImplantView.SetSelectProductLineStem(["--"],["--"],"--");this.HipImplantView.SetSelectComponentFamilyStem(["--"],["--"],"--");this.HipImplantView.SetUpDownImplantSizeStem([new e.ValuesUD("-","-")],"");this.ClearDataImplants(l.Stem);this.HipImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionHip=o.Calibration;this.HipImplantView.ViewTab();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(a,this.HipAnnotation,this.ActionHip);a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}ActionBtnDoneFemoralHeadSet(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=t.RendererPlugins[this.Plugin.PluginName];var o=this.HipImplantView.GetFemoralHeadDiameter();var l=this.HipImplantView.GetFemoralHeadOffset();try{if(o!==""&&l!==""){if(parseInt(o)>0){if(this.HipAnnotation.OrthoStemImplant&&this.HipAnnotation.OrthoStemImplant.ImplantReadyForDraw){if(this.HipAnnotation.OrthoStemImplant.Landmarks["HEAD_ROTATION+0"]){this.HipAnnotation.OrthoStemImplant.AFemoralHeadDiameter=parseInt(o);this.HipAnnotation.OrthoStemImplant.AFemoralHeadOffset=parseInt(l);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("Head rotation landmark is not available for stem.",e.Colors.Orange,3)}}else{e.Toaster.ShowToast("Stem implant is not available.",e.Colors.Orange,3)}}else{e.Toaster.ShowToast("Please input diameter greater than 0.",e.Colors.Orange,3)}}else{e.Toaster.ShowToast("Please input diameter and offset values.",e.Colors.Orange,3)}}catch(t){e.Toaster.ShowToast("Error for the current operation.",e.Colors.Orange,3)}}ActionBtnCancelFemoralHeadSet(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=t.RendererPlugins[this.Plugin.PluginName];this.HipAnnotation.OrthoStemImplant.AFemoralHeadDiameter=undefined;this.HipAnnotation.OrthoStemImplant.AFemoralHeadOffset=0;this.HipImplantView.SetFemoralHeadDiameter("");this.HipImplantView.SetFemoralHeadOffset("");var o=e.Form.GetFieldFromForms(this.HipImplantView.DataSection2,"FemoralHeadDiameter");o.htmlElement.focus();n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}ActionOkHipStatusInsertImplantAcetabularCup(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];this.HipImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionHip=o.None;this.HipImplantView.ViewTab();this.LoadSvgAcetabularCupOnViewport(n,this.HipImplantView.GetUpDownImplantSizeAcetabularCup(),true);this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(n,this.HipAnnotation,this.ActionHip);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}ActionCancelHipStatusInsertImplantAcetabularCup(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var a=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition)a.LastAnnotationCreatedOrSelected=null;this.implantAcetabularCupLibrary=null;this.HipAnnotation.OrthoAcetabularCupImplant=new t.OrthoTemplate(this.HipAnnotation);this.HipImplantView.SetSelectProductLineAcetabularCup(["--"],["--"],"--");this.HipImplantView.SetSelectComponentFamilyAcetabularCup(["--"],["--"],"--");this.HipImplantView.SetUpDownImplantSizeAcetabularCup([new e.ValuesUD("-","-")],"");this.ClearDataImplants(l.Cup);this.HipImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionHip=o.Calibration;this.HipImplantView.ViewTab();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(a,this.HipAnnotation,this.ActionHip);a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}ActionOkHipStatusAdjustImplant(e){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];this.HipImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionHip=o.None;this.ShowTextAndControl(1,this.HipImplantView.OrthoElementsSection1,"SectionButtonsA","","",this.Edition);this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(l,this.HipAnnotation,this.ActionHip);e();l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}ActionCancelHipStatusAdjustImplant(e){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition)l.LastAnnotationCreatedOrSelected=null;this.HipImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionHip=o.None;this.ShowTextAndControl(1,this.HipImplantView.OrthoElementsSection1,"SectionButtonsA","","",this.Edition);this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.HipImplantView.ControlButtonsMainWindow(l,this.HipAnnotation,this.ActionHip);e();l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}GetSettingfavoriteImplant(){var t=this.Plugin.Controller.View.Platform.GetSetting("favoriteImplants");if(t!==null&&t!==undefined){try{t=e.Utils.DecodeBase64(t);var n=JSON.parse(t);this.DataFavoriteStruct=n}catch(t){}}}GetfavoriteImplant(t){var e=new Array;var n=this.DataFavoriteStruct;if(n!==null&&n!==undefined){try{this.DataFavoriteStruct.Favorites.forEach((n=>{n.Manufacturer.forEach((o=>{o.Groups.forEach((o=>{if(o.Name.toUpperCase()==="HIP"){o.ProductLines.forEach((o=>{o.Types.forEach((o=>{if(o.Name.toUpperCase().match(t)){e.push(decodeURIComponent(n.Name))}}))}))}}))}))}))}catch(t){}}return e}LoadManufacturers(t,e,n,o){let l=false;if(this.manufacturers[o]){if(this.manufacturers[o].sideManufacturers&&this.manufacturers[o].sideManufacturers[n])l=true}if(!l){this.Plugin.GetManufacturers((e=>{if(!this.manufacturers[o])this.manufacturers[o]={};if(!this.manufacturers[o].sideManufacturers)this.manufacturers[o].sideManufacturers={};this.manufacturers[o].sideManufacturers[n]=e;t(e)}),e,n,o)}else{t(this.manufacturers[o].sideManufacturers[n])}}CleanImplant(t,n){var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var a=o.RendererPlugins[this.Plugin.PluginName];try{if(t===l.Stem){if(!n)this.HipAnnotation.OrthoStemImplant.ImplantManufacturer=undefined;this.HipAnnotation.OrthoStemImplant.ImplantProductLine=undefined;this.HipAnnotation.OrthoStemImplant.ImplantComponentFamily=undefined;this.HipAnnotation.OrthoStemImplant.ImplantSize=undefined;this.HipAnnotation.OrthoStemImplant.ImplantReadyForDraw=false;this.HipAnnotation.OrthoStemImplant.ImplantSvgUrl=null;this.HipAnnotation.OrthoStemImplant.AFemoralHeadOffset=0;this.HipAnnotation.OrthoStemImplant.AFemoralHeadDiameter=undefined;delete this.ActionsSummaryData["Code11"];delete this.ActionsSummaryData["Code12"];this.ShowSummary()}else if(t===l.Cup){if(!n)this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=undefined;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantProductLine=undefined;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantComponentFamily=undefined;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantSize=undefined;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantReadyForDraw=false;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantSvgUrl=null;delete this.ActionsSummaryData["Code14"];delete this.ActionsSummaryData["Code15"];this.ShowSummary()}}catch(t){e.Utils.DebugConsoleLog(t)}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}ClearDataImplants(t){if(t===l.Stem){this.HipImplantView.SetSelectProductLineStem(["--"],["--"],"--");this.HipImplantView.SetSelectComponentFamilyStem(["--"],["--"],"--");this.HipImplantView.SetUpDownImplantSizeStem([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Stem,true)}else if(t===l.Cup){this.HipImplantView.SetSelectProductLineAcetabularCup(["--"],["--"],"--");this.HipImplantView.SetSelectComponentFamilyAcetabularCup(["--"],["--"],"--");this.HipImplantView.SetUpDownImplantSizeAcetabularCup([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Cup,true)}}ChangeLegSideForLoadData(){if(this.HipAnnotation){var n;var o;if(this.HipAnnotation.OrthoStemImplant){n=this.HipAnnotation.OrthoStemImplant.ImplantManufacturer;this.HipImplantView.SetSelectProductLineStem(["--"],["--"],"--");this.HipImplantView.SetSelectComponentFamilyStem(["--"],["--"],"--");this.HipImplantView.SetUpDownImplantSizeStem([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Stem);var a=e.Form.GetFieldFromForms(this.HipImplantView.DataSection2,"selectManufacturerStem");if(this.HipImplantView.IdDefault===t.ETemplateView[t.ETemplateView.Stem]){a.htmlElement.value=n;this.HipAnnotation.OrthoStemImplant.ImplantManufacturer=n;this.LoadDataPerManufacturer(l.Stem,n,true,(()=>{this.HipAnnotation.OrthoStemImplant.ImplantManufacturer=n}))}else{a.htmlElement.value="--"}}if(this.HipAnnotation.OrthoAcetabularCupImplant){o=this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer;this.HipImplantView.SetSelectProductLineAcetabularCup(["--"],["--"],"--");this.HipImplantView.SetSelectComponentFamilyAcetabularCup(["--"],["--"],"--");this.HipImplantView.SetUpDownImplantSizeAcetabularCup([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Cup);var r=e.Form.GetFieldFromForms(this.HipImplantView.DataSection2,"selectManufacturerAcetabularCup");if(this.HipImplantView.IdDefault===t.ETemplateView[t.ETemplateView.Cup]){r.htmlElement.value=o;this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=o;this.LoadDataPerManufacturer(l.Cup,o,true,(()=>{this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=o}))}else{r.htmlElement.value="--"}}}}ManufacturerLoadedImplantsPerSide(t,e){var n=false;var o=this.DataWasLoaded[t];if(o){if(o.SideImplant===e&&o.Loaded)n=true}return n}GetDataLibraryExists(e,n,o){let l;if(this.DataWasLoaded){if(this.DataWasLoaded[e]&&this.DataWasLoaded[e].SideImplant===t.EBodySide[n]&&this.DataWasLoaded[e].Loaded&&this.DataWasLoaded[e].ImplantType===o){l=this.DataWasLoaded[e].implantLibrary}}return l}LoadDataPerManufacturer(n,o,a,r){let stemActions=()=>{var n;if((n=this.manufacturers[l[l.Stem].replace("_"," ")])===null||n===void 0?void 0:n.sideManufacturers[t.EBodySide[this.LegSide]]){var s=new Array;this.manufacturers[l[l.Stem].replace("_"," ")].sideManufacturers[t.EBodySide[this.LegSide]].forEach((t=>s.push(t)));s.unshift("--");this.HipImplantView.SetSelectManufacturerStem(s,s,o)}var h=this.HipAnnotation.OrthoStemImplant;var m=this.implantStemLibrary.GetProductLineNames();m.unshift("--");this.HipImplantView.SetSelectProductLineStem(m,m,h.ImplantProductLine);if(!a&&h.ImplantComponentFamily!==null&&h.ImplantComponentFamily!==undefined){var d=this.implantStemLibrary.GetFamilyNames(h.ImplantProductLine);d.unshift("--");this.HipImplantView.SetSelectComponentFamilyStem(d,d,h.ImplantComponentFamily)}else{this.HipImplantView.SetSelectComponentFamilyStem(["--"],["--"],"--");this.HipImplantView.SetUpDownImplantSizeStem([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Stem,true)}this.HipAnnotation.OrthoStemImplant.ImplantManufacturer=o;if(!a&&h.ImplantSize!==null&&h.ImplantSize!==undefined){this.implantStemLibrary.GetFamilySizes(h.ImplantProductLine,h.ImplantComponentFamily,t.EBodySide[this.LegSide],"hip","Stem",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.HipAnnotation.OrthoStemImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.HipImplantView.SetUpDownImplantSizeStem(n,h.ImplantSize);if(r)r(o)}))}else{if(r)r(o)}};let cupActions=()=>{var n;if((n=this.manufacturers[l[l.Cup].replace("_"," ")])===null||n===void 0?void 0:n.sideManufacturers[t.EBodySide[this.LegSide]]){var s=new Array;this.manufacturers[l[l.Cup].replace("_"," ")].sideManufacturers[t.EBodySide[this.LegSide]].forEach((t=>s.push(t)));s.unshift("--");this.HipImplantView.SetSelectManufacturerAcetabularCup(s,s,o)}var h=this.HipAnnotation.OrthoAcetabularCupImplant;var m=this.implantAcetabularCupLibrary.GetProductLineNames();m.unshift("--");this.HipImplantView.SetSelectProductLineAcetabularCup(m,m,h.ImplantProductLine);if(!a&&h.ImplantComponentFamily!==null&&h.ImplantComponentFamily!==undefined){var d=this.implantAcetabularCupLibrary.GetFamilyNames(h.ImplantProductLine);d.unshift("--");this.HipImplantView.SetSelectComponentFamilyAcetabularCup(d,d,h.ImplantComponentFamily)}else{this.HipImplantView.SetSelectComponentFamilyAcetabularCup(["--"],["--"],"--");this.HipImplantView.SetUpDownImplantSizeAcetabularCup([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Cup,true)}this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=o;if(!a&&h.ImplantSize!==null&&h.ImplantSize!==undefined){this.implantAcetabularCupLibrary.GetFamilySizes(h.ImplantProductLine,h.ImplantComponentFamily,t.EBodySide[this.LegSide],"hip","Cup",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.HipAnnotation.OrthoAcetabularCupImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.HipImplantView.SetUpDownImplantSizeAcetabularCup(n,h.ImplantSize);if(r)r(o)}))}else{if(r)r(o)}};if(o&&o!=="--"){let a=this.GetDataLibraryExists(o,this.LegSide,l[n]);if(!a){var s=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+o+"/groups/hip/families?patientSide="+t.EBodySide[this.LegSide]+"&ProductType="+l[n].replace("_"," ");t.ImplantLibraryReader.LoadImplantLibrary(s,(e=>{this.DataWasLoaded[o]={SideImplant:t.EBodySide[this.LegSide],ImplantType:l[n],Loaded:true,implantLibrary:e};if(n===l.Stem){this.implantStemLibrary=e;stemActions()}else if(n===l.Cup){this.implantAcetabularCupLibrary=e;cupActions()}}))}else{if(a){if(n===l.Stem){this.implantStemLibrary=a;stemActions()}else if(n===l.Cup){this.implantAcetabularCupLibrary=a;cupActions()}}}}}GetImplantSizeName(t,e){var n;try{var o=e===l.Stem?this.implantStemLibrary:this.implantAcetabularCupLibrary;var a=o.GetSizes(t.ImplantProductLine,t.ImplantComponentFamily);var r=a.filter((e=>e.id===t.ImplantSize))[0];n=r.size}catch(t){n=""}return n}OpenTabImplantFavorites(){this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"FavoritesSection","","",this.Edition);this.GetSettingfavoriteImplant();var t=this.GetfavoriteImplant("STEM");t.unshift("-None-");this.HipImplantView.SetSelectfavoriteFamilyStem(t,t,this.FavoriteStemItem?this.FavoriteStemItem:"-None-");var e=this.GetfavoriteImplant("CUP");e.unshift("-None-");this.HipImplantView.SetSelectfavoriteFamilyCup(e,e,this.FavoriteCupItem?this.FavoriteCupItem:"-None-")}OpenTabImplantStem(e){var n;this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"StemImplantSection","","",this.Edition);if(this.implantStemLibrary){if((n=this.manufacturers[l[l.Stem].replace("_"," ")])===null||n===void 0?void 0:n.sideManufacturers[t.EBodySide[this.LegSide]]){var o=new Array;this.manufacturers[l[l.Stem].replace("_"," ")].sideManufacturers[t.EBodySide[this.LegSide]].forEach((t=>o.push(t)));o.unshift("--");this.HipImplantView.SetSelectManufacturerStem(o,o,this.HipAnnotation.OrthoStemImplant.ImplantManufacturer)}this.ImplantInformation(this.HipAnnotation.OrthoStemImplant,l.Stem);if(e)e();return}this.LoadManufacturers((t=>{if(!this.implantStemLibrary){var n=new Array;t.forEach((t=>n.push(t)));n.unshift("--");if(this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer)this.HipAnnotation.OrthoStemImplant.ImplantManufacturer=this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer;this.HipImplantView.SetSelectManufacturerStem(n,n,this.HipAnnotation.OrthoStemImplant.ImplantManufacturer);if(this.HipAnnotation.OrthoStemImplant.ImplantManufacturer){this.LoadDataPerManufacturer(l.Stem,this.HipAnnotation.OrthoStemImplant.ImplantManufacturer,false,(()=>{this.ImplantInformation(this.HipAnnotation.OrthoStemImplant,l.Stem);if(e)e()}))}else{if(e)e()}if(this.HipAnnotation.OrthoStemImplant.AFemoralHeadDiameter)this.HipImplantView.SetFemoralHeadDiameter(this.HipAnnotation.OrthoStemImplant.AFemoralHeadDiameter.toString());if(this.HipAnnotation.OrthoStemImplant.AFemoralHeadOffset)this.HipImplantView.SetFemoralHeadOffset(this.HipAnnotation.OrthoStemImplant.AFemoralHeadOffset.toString())}}),"hip",t.EBodySide[this.LegSide],l[l.Stem].replace("_"," "))}OpenTabImplantAcetabular(e){this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"AcetabularImplantSection","","",this.Edition);if(this.implantAcetabularCupLibrary){if(this.manufacturers[l[l.Cup].replace("_"," ")].sideManufacturers[t.EBodySide[this.LegSide]]){var n=new Array;this.manufacturers[l[l.Cup].replace("_"," ")].sideManufacturers[t.EBodySide[this.LegSide]].forEach((t=>n.push(t)));n.unshift("--");this.HipImplantView.SetSelectManufacturerAcetabularCup(n,n,this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer)}this.ImplantInformation(this.HipAnnotation.OrthoAcetabularCupImplant,l.Cup);if(e)e();return}this.LoadManufacturers((t=>{if(!this.implantAcetabularCupLibrary){var n=new Array;t.forEach((t=>n.push(t)));n.unshift("--");if(this.HipAnnotation.OrthoStemImplant.ImplantManufacturer)this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=this.HipAnnotation.OrthoStemImplant.ImplantManufacturer;this.HipImplantView.SetSelectManufacturerAcetabularCup(n,n,this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer);if(this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer){this.LoadDataPerManufacturer(l.Cup,this.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer,false,(()=>{this.ImplantInformation(this.HipAnnotation.OrthoAcetabularCupImplant,l.Cup);if(e)e()}))}}}),"hip",t.EBodySide[this.LegSide],l[l.Cup].replace("_"," "))}OpenTabImplantHead(){this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"FemoralHeadImplantSection","","",this.Edition)}ShowTextAndControl(t,e,n,o,l,a,r){var s=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var h=s.RendererPlugins[this.Plugin.PluginName];this.Controller.TopBarElement.PostActionShow=()=>{};this.HipImplantView.OrthoFloatingBar.BuildForm(e,[n]);this.HipImplantView.ShowValueLabel(t,o,l,r);this.HipImplantView.ControlStatusMainButtons(h,a,this.ActionHip,this.HipAnnotation);this.HipImplantView.ControlUI();this.HipImplantView.ControlButtonsMainWindow(h,this.HipAnnotation,this.ActionHip)}ControlAdjustImplant(t,n){var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var a=o.RendererPlugins[this.Plugin.PluginName];var r=t.getAttribute("data-control");switch(r){case"rotate-cw":if(n===l.Stem){this.HipAnnotation.OrthoStemImplant.WasRotated=true;this.HipAnnotation.OrthoStemImplant.Rotation=(this.HipAnnotation.OrthoStemImplant.Rotation-1)%360}else{this.HipAnnotation.OrthoAcetabularCupImplant.WasRotated=true;this.HipAnnotation.OrthoAcetabularCupImplant.Rotation=(this.HipAnnotation.OrthoAcetabularCupImplant.Rotation-1)%360}break;case"rotate-ccw":if(n===l.Stem){this.HipAnnotation.OrthoStemImplant.WasRotated=true;this.HipAnnotation.OrthoStemImplant.Rotation=(this.HipAnnotation.OrthoStemImplant.Rotation+1)%360}else{this.HipAnnotation.OrthoAcetabularCupImplant.WasRotated=true;this.HipAnnotation.OrthoAcetabularCupImplant.Rotation=(this.HipAnnotation.OrthoAcetabularCupImplant.Rotation+1)%360}break;case"left-up":n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetX-=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetX-=1;n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetY-=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetY-=1;break;case"up-right":n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetX+=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetX+=1;n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetY-=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetY-=1;break;case"down-right":n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetX+=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetX+=1;n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetY+=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetY+=1;break;case"down-left":n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetX-=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetX-=1;n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetY+=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetY+=1;break;case"up":n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetY-=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetY-=1;break;case"right":n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetX+=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetX+=1;break;case"down":n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetY+=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetY+=1;break;case"left":n===l.Stem?this.HipAnnotation.OrthoStemImplant.OffsetX-=1:this.HipAnnotation.OrthoAcetabularCupImplant.OffsetX-=1;break;case"minus":if(n===l.Stem){var s=e.Form.GetFieldFromForms(this.HipImplantView.DataSection2,"upDownImplantSizeStem");var h=s.htmlElement["UpDownObject"];if(h.Index-1>=0){this.HipImplantView.SetUpDownImplantSizeStem(h.Items,null,h.Index-1);this.ActionIncreaseDecreaseSizeImplantStem(h.Item,a)}}else{var m=e.Form.GetFieldFromForms(this.HipImplantView.DataSection2,"upDownImplantSizeAcetabularCup");var d=m.htmlElement["UpDownObject"];if(d.Index-1>=0){this.HipImplantView.SetUpDownImplantSizeAcetabularCup(d.Items,null,d.Index-1);this.ActionIncreaseDecreaseSizeImplantAcetabularCup(d.Item,a)}}break;case"plus":if(n===l.Stem){var u=e.Form.GetFieldFromForms(this.HipImplantView.DataSection2,"upDownImplantSizeStem");var p=u.htmlElement["UpDownObject"];if(p.Index+1<p.Items.length){this.HipImplantView.SetUpDownImplantSizeStem(p.Items,null,p.Index+1);this.ActionIncreaseDecreaseSizeImplantStem(p.Item,a)}}else{var c=e.Form.GetFieldFromForms(this.HipImplantView.DataSection2,"upDownImplantSizeAcetabularCup");var A=c.htmlElement["UpDownObject"];if(A.Index+1<A.Items.length){this.HipImplantView.SetUpDownImplantSizeAcetabularCup(A.Items,null,A.Index+1);this.ActionIncreaseDecreaseSizeImplantAcetabularCup(A.Item,a)}}break}switch(r){case"left-up":case"up-right":case"down-right":case"down-left":case"up":case"right":case"down":case"left":if(n===l.Stem){this.HipAnnotation.OrthoStemImplant.WasMoved=true}else{this.HipAnnotation.OrthoAcetabularCupImplant.WasMoved=true}break}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();this.HipImplantView.ChangeCISSAutomaticImplantsModeStatus(false);this.HipImplantView.UpdateUIAdjustImplant(n===l.Stem?this.HipAnnotation.OrthoStemImplant:this.HipAnnotation.OrthoAcetabularCupImplant,n===l.Stem?l.Stem:l.Cup)}ActionCalibrate(){this.ActionHip=o.Calibration;this.Plugin.CalibrationOptionFromMainMenu=false;this.Plugin.Menu.ProcessCalibrationToolEvent(null,"calibrationTool","eFit",this.HipAnnotation)}ActionAcetabulum(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController!==null&&n.Context.AnnotationController!==undefined)n.Context.AnnotationController.SetCurrentGroup("Acetabulum");this.Edition=false;this.ActionHip=o.Acetabulum;this.StatusDraw=true;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");t();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"AcetabulumSection","TextAcetabular","Acetabulum",this.Edition)}ActionFemur(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController!==null&&n.Context.AnnotationController!==undefined)n.Context.AnnotationController.SetCurrentGroup("FemoralHead");this.Edition=false;this.ActionHip=o.FemoralHead;this.StatusDraw=true;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");t();this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"FemoralHeadSection","TextFemoral","FemoralHead",this.Edition);if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["FemoralHead"])){let t=e.Context.ImageEntity["pixelSpacing"][0];let l=e.Context.ImageEntity["pixelSpacing"][1];let a=t||l;let r=e.Context.ImageEntity["pixelSpacing"][2];this.ActionsSummaryData["Code04"]={Code:"Code04",Description:"Femoral head diameter "+Math.round(n.CurrentAnnotation.GetFemoralHeadDiameter()*a)+" "+r};this.ActionHip=o.FemoralCurveDistal;n.Context.AnnotationController.SetCurrentGroup("CurveDistal");this.ShowTextAndControl(2,this.HipImplantView.OrthoElementsSection2,"FemoralRightLateralSection","RightTextLateralFemoral","CurveDistal",false);this.ShowSummary()}}ActionShaftAngle(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController!==null&&n.Context.AnnotationController!==undefined){if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["CurveMedial"])&&n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["CurveDistal"])){this.ActionHip=o.ShaftAngle;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");t();this.HipAnnotation.SetShaftAngle(parseInt(this.HipImplantView.GetShaftAngle()))}else{this.ActionHip=o.ShaftAngle;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");t()}}}ActionAbductionSetPoints(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController!==null&&n.Context.AnnotationController!==undefined){if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["AbductionLine"])){this.ActionHip=o.AbductionSetAngle;this.StatusAfterOkHipAbductionAngle=true;this.ShowTextDiscrepancyAbductionAngle()}else{this.Edition=false;this.StatusDraw=true;this.ActionHip=o.AbductionSetAngle;n.Context.AnnotationController.SetCurrentGroup("AbductionLine");this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");t();if(this.Edition){if(!this.HipAnnotation.Points["AbductionLine"]||this.HipAnnotation.Points["AbductionLine"]&&this.HipAnnotation.Points["AbductionLine"].length===0){this.HipAnnotation.Points["AbductionLine"]=new Array;this.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool")}}}}}ActionAbductionAngle(t){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];if(n.Context.AnnotationController!==null&&n.Context.AnnotationController!==undefined){this.Edition=false;this.StatusDraw=true;this.ActionHip=o.AbductionAngle;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");t();this.HipAnnotation.SetAbductionAngle(parseInt(this.HipImplantView.GetAbductionAngle()));this.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool")}}ActionAdjust(t){this.OpenTabImplantStem((()=>{this.ActionHip=o.AdjustImplant;this.ActionHip=o.AdjustStemImplant;if(t)this.HipImplantView.BuildUIAdjustControl(this.HipAnnotation,t);else this.HipImplantView.BuildUIAdjustControl(this.HipAnnotation,l.Stem)}))}ActionProductLineStem(t){var n=this.implantStemLibrary.GetFamilyNames(this.HipImplantView.GetSelectProductLineStem());var o=new Array;var l;if(n!==undefined){o=n;o.unshift("--");l=t===undefined?"--":t}else{o=["--"];o=["--"];l="--"}this.HipImplantView.SetSelectComponentFamilyStem(o,o,l);var a=new Array;a.push(new e.ValuesUD("--","--"));this.HipImplantView.SetUpDownImplantSizeStem(a,null,0);if(!t&&o.length>=2){this.HipImplantView.SetSelectComponentFamilyStem(o,o,o[1]);this.ActionComponentFamilyStem()}}ActionProductLineAcetabularCup(t){var n=this.implantAcetabularCupLibrary.GetFamilyNames(this.HipImplantView.GetSelectProductLineAcetabularCup());var o=new Array;var l;if(n!==undefined){o=n;o.unshift("--");l=t===undefined?"--":t}else{o=["--"];o=["--"];l="--"}this.HipImplantView.SetSelectComponentFamilyAcetabularCup(o,o,l);var a=new Array;a.push(new e.ValuesUD("--","--"));this.HipImplantView.SetUpDownImplantSizeAcetabularCup(a,null,0);if(!t&&o.length>=2){this.HipImplantView.SetSelectComponentFamilyAcetabularCup(o,o,o[1]);this.ActionComponentFamilyAcetabularCup()}}ActionComponentFamilyStem(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=n.RendererPlugins[this.Plugin.PluginName];var a=this.HipImplantView.GetSelectProductLineStem();var r=this.HipImplantView.GetSelectComponentFamilyStem();if(r!==""&&r!=="--"){this.implantStemLibrary.GetFamilySizes(a,r,t.EBodySide[this.LegSide],"hip","Stem",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.HipAnnotation.OrthoStemImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.HipImplantView.SetUpDownImplantSizeStem(n,null,Math.floor(n.length/2));var a=n[Math.floor(n.length/2)].Value;this.LoadSvgStemOnViewport(o,a,this.Edition)}))}else{var s=new Array;s.push(new e.ValuesUD("--","--"));this.HipImplantView.SetUpDownImplantSizeStem(s,null,0);this.CleanImplant(l.Stem)}}ActionComponentFamilyAcetabularCup(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=n.RendererPlugins[this.Plugin.PluginName];var a=this.HipImplantView.GetSelectProductLineAcetabularCup();var r=this.HipImplantView.GetSelectComponentFamilyAcetabularCup();if(r!==""&&r!=="--"){this.implantAcetabularCupLibrary.GetFamilySizes(a,r,t.EBodySide[this.LegSide],"hip","Cup",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.HipAnnotation.OrthoStemImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.HipImplantView.SetUpDownImplantSizeAcetabularCup(n,null,Math.floor(n.length/2));var a=n[Math.floor(n.length/2)].Value;this.LoadSvgAcetabularCupOnViewport(o,a,this.Edition)}))}else{var s=new Array;s.push(new e.ValuesUD("--","--"));this.HipImplantView.SetUpDownImplantSizeAcetabularCup(s,null,0);this.CleanImplant(l.Cup)}}ActionIncreaseDecreaseShaftAngle(t,e){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o;if(n===null)return;if(this.HipAnnotation!==undefined&&this.HipAnnotation!==null){o=this.HipAnnotation;this.HipAnnotation.SetShaftAngle(parseInt(t.Value));this.ActionOkHipStatusShaftAngle()}else{var l;for(var a=0;a<e.Annotations.length;a++){if(e.Annotations[a].Id===e.LastAnnotationCreatedOrSelected.Id){l=e.Annotations[a];break}}o=l;l.SetShaftAngle(parseInt(t.Value))}var r=o.GetInitialStemImplantPosition();o.OrthoStemImplant.PositionX=parseFloat(r.X.toString());o.OrthoStemImplant.PositionY=parseFloat(r.Y.toString());e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionIncreaseDecreaseAbductionAngle(t,e){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(n===null)return;e=n.RendererPlugins[this.Plugin.PluginName];if(this.HipAnnotation!==undefined&&this.HipAnnotation!==null){this.HipAnnotation.SetAbductionAngle(parseInt(t.Value));this.ActionOkHipStatusAbductionSetAngle()}else{var o;for(var l=0;l<e.Annotations.length;l++){if(e.Annotations[l].Id===e.LastAnnotationCreatedOrSelected.Id){o=e.Annotations[l];break}}o.SetAbductionAngle(parseInt(t.Value))}e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionIncreaseDecreaseSizeImplantStem(t,e){var n=t.Value;this.LoadSvgStemOnViewport(e,n,this.Edition)}ActionIncreaseDecreaseSizeImplantAcetabularCup(t,e){var n=t.Value;this.LoadSvgAcetabularCupOnViewport(e,n,this.Edition)}static Create(o,l,a,r=[0],s){var h;var m=new HipImplantController(o,s);m.Controller=o.Controller;m.HipAnnotation=l;m.StatusDraw=false;m.Edition=a;m.DoneCurveMedial=false;m.Controller.ActiveContextMenu=false;if(m.HipAnnotation){m.LegSide=t.EBodySide[m.HipAnnotation.GetHipSide()]==="Left"?t.EBodySide.Left:t.EBodySide.Right;m.HipImplantView.BuildUI()}m.HipImplantView.BuildViewSide();m.HipImplantView.BuildShowDesign();var d=m.Controller.GetSelectViewport(m.Controller.ViewportPane);m.InitialViewportStart=d;if(d===null)return;var u=d.RendererPlugins[o.PluginName];if(a){u.Context.AnnotationController=new n.AnnotationController(m.HipAnnotation);m.WriteActionSummaryDataForEdition();document.querySelector("#BtnShowHide").style.display="block";l.CanDragPoint=true;m.StatusSetAbductionAngle=l.StatusSetAbductionAngle;m.ShaftAngleWasUpdated=l.ShaftAngleWasUpdated}else{if(u.CurrentAnnotation===null||u.CurrentAnnotation===undefined){u.CurrentAnnotation=(h=m.HipAnnotation)!==null&&h!==void 0?h:new t.HipImplantAnnotation;u.CurrentAnnotation.Context=d.Context;u.CurrentAnnotation.Id=e.Utils.GetGuid();u.CurrentAnnotation.Selected=false;u.CurrentAnnotation.Status=n.EAnnotationStatus.New;u.CurrentAnnotation.Author=sessionStorage["userEmail"];u.CurrentAnnotation.Date=new Date;u.CurrentAnnotation.Plugin=o.PluginName;u.CurrentAnnotation["new"]=true;m.HipAnnotation=u.CurrentAnnotation;u.Context.AnnotationController=new n.AnnotationController(u.CurrentAnnotation)}}m.HipImplantView.InitFormDataAndEvents(m.HipAnnotation,r,u,a);t.OrthoPlugin.HipImplantControlerStaticInstance=m;return m}}t.HipImplantController=HipImplantController})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var OrthoPlugin;(function(OrthoPlugin){var WebClient=Efferent.Frontend.WebClient;var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;var ImagingStudyView=Efferent.ClientViews.ImagingStudyView;const{div:div,span:span,h3:h3,label:label,input:input,ul:ul,li:li,img:img,button:button}=DOMUtils;class HipImplantView{constructor(t,e){this.controller=t;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.orthoToolWindow=new OrthoPlugin.OrthoToolWindow(e,(()=>{this.controller.ActionCancelHipStatusNone()}));this.BuildUI()}BuildUI(){this.orthoToolWindow.InitComponents();this.OrthoFloatingBar=this.controller.Plugin.ManagementFloatingBar.CreateFloatingBar(document.body,"orthoCissDialog",true,"HipTool",(()=>{this.controller.Controller.ResizeViewports()}));this.orthoToolWindow.RightTopSection.className="rightTopSection";this.orthoToolWindow.RightTopSection.appendChild(div({className:"iconImage",style:{backgroundImage:`url('${OrthoPlugin.ResourceBag.HipMainIconPng}')`}}));this.orthoToolWindow.OuterContainer.className="middleSection";this.inputLeftSide=input({type:"radio",name:"radioBtnSide",id:"bbSideLeft",value:"Left",checked:this.controller.LegSide===OrthoPlugin.EBodySide.Left&&this.orthoToolWindow.OuterContainer.style.overflow!=="hidden",onchange:t=>{var e=t.target;if(e.value==="Left"){var n=this.controller.LegSide;this.controller.LegSide=OrthoPlugin.EBodySide.Left;if(n!==OrthoPlugin.EBodySide.Left)this.controller.ChangeLegSideForLoadData()}this.buildIAButton();this.controller.RerenderImplantBySide(OrthoPlugin.EBodySide.Left);this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.OrthoFloatingBar.Element.querySelector("#BtnShowHide").style.display="block";DOMUtils.SetStyles(this.orthoToolWindow.OuterContainer,{height:"auto",overflow:"visible"});this.orthoToolWindow.MainSection.querySelector(".margin").style.minHeight="max(calc(100% - 20px), 605px)"}});this.inputRightSide=input({type:"radio",name:"radioBtnSide",id:"bbSideRight",value:"Right",checked:this.controller.LegSide===OrthoPlugin.EBodySide.Right&&this.orthoToolWindow.OuterContainer.style.overflow!=="hidden",onchange:t=>{var e=t.target;if(e.value==="Right"){var n=this.controller.LegSide;this.controller.LegSide=OrthoPlugin.EBodySide.Right;if(n!==OrthoPlugin.EBodySide.Right)this.controller.ChangeLegSideForLoadData()}this.buildIAButton();this.controller.RerenderImplantBySide(OrthoPlugin.EBodySide.Right);this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.OrthoFloatingBar.Element.querySelector("#BtnShowHide").style.display="block";DOMUtils.SetStyles(this.orthoToolWindow.OuterContainer,{height:"auto",overflow:"visible"});this.orthoToolWindow.MainSection.querySelector(".margin").style.minHeight="max(calc(100% - 20px), 605px)"}});const t=div({className:"h3",innerHTML:"Hip implant"});const e=div({children:[div({className:"label",innerHTML:"Laterality: "}),div({className:"buttonbar",children:[this.inputRightSide,label({htmlFor:"bbSideRight",innerHTML:"Right"}),this.inputLeftSide,label({htmlFor:"bbSideLeft",innerHTML:"Left"})]})]});this.orthoToolWindow.LeftTopSection.className="leftTopSection";this.orthoToolWindow.LeftTopSection.appendChild(t);this.orthoToolWindow.LeftTopSection.appendChild(e);this.spaceTab=div({className:"content"});this.orthoToolWindow.TabsContainer.style.display="flex";this.orthoToolWindow.TabsContainer.appendChild(this.spaceTab);this.orthoToolWindow.MainSection.appendChild(div({className:"margin",children:[div({className:"topSection",style:{"flex-direction":"row","align-content":"stretch","justify-content":"space-between"},children:[this.orthoToolWindow.LeftTopSection,this.orthoToolWindow.RightTopSection]}),this.orthoToolWindow.SelectSideMessage,this.orthoToolWindow.CloseFirstDialogContainer,this.orthoToolWindow.OuterContainer]}));this.OrthoFloatingBar.Element.innerHTML="";this.OrthoFloatingBar.Element.style.height="auto";this.OrthoFloatingBar.MinHeight=510;this.OrthoFloatingBar.Element.appendChild(this.orthoToolWindow.MainSection);this.OrthoFloatingBar.SetContentBox(this.orthoToolWindow.ActionsSummaryContainer);this.orthoToolWindow.ButtonsElementsContainer.style.removeProperty("height")}SetBodyHip(t){if(t===OrthoPlugin.EBodySide.Left)this.inputLeftSide.checked=true;else this.inputRightSide.checked=true;DOMUtils.SetStyles(this.orthoToolWindow.OuterContainer,{height:"auto",overflow:"visible",marginTop:"10px"});this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.OrthoFloatingBar.Element.querySelector("#BtnShowHide").style.display="block";this.buildIAButton()}ShowValueLabel(t,e,n,o){var l;if(t===1)l=this.DataSection1;else l=this.DataSection2;try{var a=WebClient.Form.GetFieldFromForms(l,e);var r=OrthoPlugin.ResourceBag.HipImplantTemplateJson;a.htmlElement.innerHTML=o||r.Groups[n].PromptMessage}catch(t){}}BuildSummary(t){const e=div({innerHTML:"Measurements :",style:{fontWeight:"bold",marginBottom:"8px"}});const sortObject=t=>Object.keys(t).sort().reduce(((e,n)=>(e[n]=t[n],e)),{});t=sortObject(t);const n=ul({children:Object.keys(t).map((e=>li({className:"blinkOnce",innerHTML:t[e].Description})))});this.orthoToolWindow.ActionsSummaryContainer.innerHTML="";this.orthoToolWindow.ActionsSummaryContainer.appendChild(e);this.orthoToolWindow.ActionsSummaryContainer.appendChild(n);this.orthoToolWindow.ActionsSummaryContainer.focus();this.orthoToolWindow.ActionsSummaryContainer.scrollTop=this.orthoToolWindow.ActionsSummaryContainer.clientHeight}ControlButtonsMainWindow(t,e,n){var o,l,a,r,s;var h=new Array;var m;var d;var u;var p=this.DataSection1[0]["forms"][0];var c=this.DataSection1[1]["forms"][0];var A=p.GetField("BtnAp").htmlElement;var C=p.GetField("BtnFemur").htmlElement;var S=p.GetField("BtnAcetabulum").htmlElement;var g=p.GetField("BtnShaft").htmlElement;var I=p.GetField("BtnTransschial").htmlElement;var P=p.GetField("BtnAbduction").htmlElement;var f=c.GetField("BtnStem").htmlElement;var w=c.GetField("BtnAcetabularCup").htmlElement;var b=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavorites").htmlElement;var v=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnStemAction").htmlElement;var T=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnCupAction").htmlElement;var F=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnHeadAction").htmlElement;var O=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAdjust").htmlElement;var cleanGroup=t=>{for(var e=0;e<t.GetFields().length;e++){var n=t.GetFields()[e].htmlElement;DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.ACTIVE);DOMUtils.AddClass(n,OrthoPlugin.ButtonClasses.ENABLE)}};cleanGroup(p);cleanGroup(c);switch(n){case OrthoPlugin.EActionHip.None:case OrthoPlugin.EActionHip.Calibration:DOMUtils.RemoveClass(A,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(A,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.Acetabulum:DOMUtils.RemoveClass(S,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(S,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.FemoralHead:DOMUtils.RemoveClass(C,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(C,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.FemoralCurveDistal:DOMUtils.RemoveClass(C,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(C,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.FemoralCurveMedial:DOMUtils.RemoveClass(C,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(C,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.ShaftAngle:DOMUtils.RemoveClass(g,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(g,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.AbductionSetAngle:DOMUtils.RemoveClass(I,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(I,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.AbductionAngle:DOMUtils.RemoveClass(P,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(P,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.InsertImplant:break;case OrthoPlugin.EActionHip.AdjustImplant:case OrthoPlugin.EActionHip.AdjustStemImplant:DOMUtils.RemoveClass(f,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(f,OrthoPlugin.ButtonClasses.ACTIVE);case OrthoPlugin.EActionHip.AdjustAcetabularCupImplant:DOMUtils.RemoveClass(f,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(f,OrthoPlugin.ButtonClasses.ACTIVE);DOMUtils.RemoveClass(O,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(O,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.AdjustAcetabularCupImplant:DOMUtils.RemoveClass(w,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(w,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.StemImplant:DOMUtils.RemoveClass(v,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(v,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.CupImplant:DOMUtils.RemoveClass(T,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(T,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.HeadImplant:DOMUtils.RemoveClass(F,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(F,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionHip.FavImplant:DOMUtils.RemoveClass(b,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(b,OrthoPlugin.ButtonClasses.ACTIVE);break}m=button({className:`${OrthoPlugin.ButtonClasses.SUCCESS} inline`,type:"button",innerHTML:"Save",onclick:t=>{this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ActionOkHipStatusNone();d.innerHTML="Close"}});let L=(o=t.Context.AnnotationController)===null||o===void 0?void 0:o.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["Acetabulum"]);let E=(l=t.Context.AnnotationController)===null||l===void 0?void 0:l.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["FemoralHead"]);let x=(a=t.Context.AnnotationController)===null||a===void 0?void 0:a.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["CurveDistal"]);let y=(r=t.Context.AnnotationController)===null||r===void 0?void 0:r.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["CurveMedial"]);let M=(s=t.Context.AnnotationController)===null||s===void 0?void 0:s.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["AbductionLine"]);let D=L||E||x||y||M;let R=e.OrthoStemImplant.ImplantReadyForDraw||e.OrthoAcetabularCupImplant.ImplantReadyForDraw;u=button({className:`${OrthoPlugin.ButtonClasses.SUCCESS} inline`,type:"button",innerHTML:"Generate report",disabled:false});u.onclick=t=>{this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ActionOkHipStatusNone((()=>{const t=this.controller.Plugin.Controller;const n=t.GetSelectViewport(t.ViewportPane);const o=t.ImagingStudyFhirEntities[n.Context.StudyGuid];const l=n.Context.ImageEntity["pixelSpacing"][2];const a=n.Context.ImageEntity["pixelSpacing"][0];const r=n.Context.ImageEntity["pixelSpacing"][1];const s=a||r;let h=this.controller.GetTextAbductionAngleDiscrepancy();let m={};const continueReportCreation=()=>{var t,n,a,r,d,u;let p=[m["referrer"],o["description"],m["location"],o["started"],"Hip procedure",`${OrthoPlugin.EHipTemplateSide[this.controller.HipAnnotation.GetHipSide()]}`,L||e.OrthoAcetabularCupImplant.ImplantReadyForDraw?`${e.OrthoAcetabularCupImplant.ImplantReadyForDraw?Math.round(this.controller.HipAnnotation.GetAcetabularCupActualDiameter()*1):Math.round(this.controller.HipAnnotation.GetAcetabulumDiameter()*s)} ${l}`:"",E?`${Math.round(this.controller.HipAnnotation.GetFemoralHeadDiameter()*s)} ${l}`:"",E&&x&&y?`${Math.round(this.controller.HipAnnotation.GetShaftAngle())} degrees`:"",M?`${Math.round(this.controller.HipAnnotation.GetAbductionAngle())} degrees`:"",`${h}`,`${this.controller.GetTextAbductionAngleOffset()}`,e.OrthoStemImplant.ImplantReadyForDraw?(t=this.controller.HipAnnotation.OrthoStemImplant.ImplantManufacturer)!==null&&t!==void 0?t:"":"",e.OrthoStemImplant.ImplantReadyForDraw?(n=this.controller.HipAnnotation.OrthoStemImplant.ImplantProductLine)!==null&&n!==void 0?n:"":"",e.OrthoStemImplant.ImplantReadyForDraw?(a=this.controller.HipAnnotation.OrthoStemImplant.ImplantComponentFamily)!==null&&a!==void 0?a:"":"",e.OrthoStemImplant.ImplantReadyForDraw?this.controller.HipAnnotation.OrthoStemImplant.ImplantSize?this.controller.GetImplantSizeName(this.controller.HipAnnotation.OrthoStemImplant,OrthoPlugin.EHipImplant.Stem):"":"",e.OrthoAcetabularCupImplant.ImplantReadyForDraw?(r=this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer)!==null&&r!==void 0?r:"":"",e.OrthoAcetabularCupImplant.ImplantReadyForDraw?(d=this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantProductLine)!==null&&d!==void 0?d:"":"",e.OrthoAcetabularCupImplant.ImplantReadyForDraw?(u=this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantComponentFamily)!==null&&u!==void 0?u:"":"",e.OrthoAcetabularCupImplant.ImplantReadyForDraw?this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantSize?this.controller.GetImplantSizeName(this.controller.HipAnnotation.OrthoAcetabularCupImplant,OrthoPlugin.EHipImplant.Cup):"":""];this.controller.Plugin.CreateDiagnosticReport(p,o,"361FF6A2-BB27-4A60-AA1B-0955003EA8A1")};this.controller.Plugin.GenerateOrthoReport(o,m,continueReportCreation)}))};d=button({className:`${OrthoPlugin.ButtonClasses.CRITIC} inline`,type:"button",innerHTML:this.controller.Edition?"Close":"Cancel",onclick:t=>{this.controller.ActionCancelHipStatusNone()}});h.push(m);if(WebClient.Utils.CheckNotAllowTag("guest")){h.push(u)}else{m.style.flexGrow="2";d.style.flexGrow="2"}h.push(d);this.orthoToolWindow.ActionsWindowContainer.innerHTML="";h.forEach((t=>{this.orthoToolWindow.ActionsWindowContainer.appendChild(t)}));this.cleanClassColorOfButtonDisabled(p);this.cleanClassColorOfButtonDisabled(c);this.ControlStatusMainButtons(t,this.controller.Edition,n,e)}ControlCalibrationButton(){let t=WebClient.Form.GetFieldFromForms(this.DataSection2,"BtnCalibration");let e=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextCalibrationStatus");let n=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);if(n===null)return;let o=n.RendererPlugins[this.controller.Plugin.PluginName];let l=o.Context.ImageEntity.IsCalibrated();if(l){t.htmlElement.style.backgroundColor=WebClient.Colors.BelizeHole;e.htmlElement.innerHTML="Image calibrated"}else{t.htmlElement.style.backgroundColor=WebClient.Colors.Alizarin;e.htmlElement.innerHTML="Image not calibrated"}}AppendIconsToMainButtons(){const t=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAdjust");const e=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnStemAction");const n=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnCupAction");const o=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnHeadAction");const l=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavorites");const a=WebClient.Form.GetFieldFromForms(this.DataSection2,"BtnCalibration");[{field:t,text:"Adjust",icon:OrthoPlugin.ResourceBag.Icons8Drag32Png},{field:e,text:"Stem",icon:OrthoPlugin.ResourceBag.FemoralStemPng},{field:n,text:"Cup",icon:OrthoPlugin.ResourceBag.AcetabularPng},{field:o,text:"Head",icon:OrthoPlugin.ResourceBag.FemoralHeadPng},{field:l,text:"Favorites",icon:OrthoPlugin.ResourceBag.Icons8StartPng}].forEach((e=>{e.field.htmlElement.innerHTML="";e.field.htmlElement.appendChild(img({src:e.icon,style:{verticalAlign:"middle",marginRight:"5px",width:[o,t,l].indexOf(e.field)>-1?"24px":""}}));e.field.htmlElement.appendChild(label({innerHTML:e.text}))}));a.htmlElement.appendChild(img({src:OrthoPlugin.ResourceBag.Icons8Sphere32Png}));this.ControlUI()}BuildComponentForAdjustControl(t,e){const n=input({type:"radio",name:"radioBtnComponent",id:"bbStem",value:"Stem",checked:e===OrthoPlugin.EHipImplant.Stem,onchange:t=>{const e=t.target;if(e.value==="Stem"){this.controller.ActionHip=OrthoPlugin.EActionHip.AdjustStemImplant;this.controller.OpenTabImplantStem((()=>{this.BuildUIAdjustControl(this.controller.HipAnnotation,OrthoPlugin.EHipImplant.Stem)}))}}});const o=input({type:"radio",name:"radioBtnComponent",id:"bbCup",value:"Cup",checked:e===OrthoPlugin.EHipImplant.Cup,onchange:t=>{const e=t.target;if(e.value==="Cup"){this.controller.ActionHip=OrthoPlugin.EActionHip.AdjustAcetabularCupImplant;this.controller.OpenTabImplantAcetabular((()=>{this.BuildUIAdjustControl(this.controller.HipAnnotation,OrthoPlugin.EHipImplant.Cup)}))}}});const l=div({className:"buttonbar",style:{display:"inline-block"},children:[n,label({htmlFor:"bbStem",innerHTML:"Stem"}),o,label({htmlFor:"bbCup",innerHTML:"Cup"})]});t.style.textAlign="center";t.appendChild(l)}BuildUIAdjustControl(t,e){const n=div({innerHTML:"Adjust implant",style:{marginBottom:"10px"}});const o=div({style:{margin:"5px auto",width:"fit-content"}});const l=div({});const a=div({innerHTML:e===OrthoPlugin.EHipImplant.Stem?"Stem component":"Acetabular Cup",style:{margin:"0 auto",width:"fit-content",marginBottom:"10px"}});this.offsetXContainer=div({innerHTML:"Offset x: "+(t!==null?e===OrthoPlugin.EHipImplant.Stem?t.OrthoStemImplant.OffsetX.toFixed(1):t.OrthoAcetabularCupImplant.OffsetX.toFixed(1):0),style:{marginLeft:"90px",marginTop:"5px",display:"none"}});this.offsetYContainer=div({innerHTML:"Offset y: "+(t!==null?e===OrthoPlugin.EHipImplant.Stem?t.OrthoStemImplant.OffsetY.toFixed(1):t.OrthoAcetabularCupImplant.OffsetY.toFixed(1):0),style:{marginLeft:"90px",marginTop:"5px",display:"none"}});this.rotationContainer=div({innerHTML:"Rotation: "+(t!==null?(e===OrthoPlugin.EHipImplant.Stem?t.OrthoStemImplant.Rotation:t.OrthoAcetabularCupImplant.Rotation).toFixed(1):0)+" deg",style:{marginLeft:"90px",marginTop:"5px"}});this.implantSizeContainer=div({innerHTML:"Implant: "+(t!==null?e===OrthoPlugin.EHipImplant.Stem?this.controller.GetImplantSizeName(t.OrthoStemImplant,OrthoPlugin.EHipImplant.Stem):this.controller.GetImplantSizeName(t.OrthoAcetabularCupImplant,OrthoPlugin.EHipImplant.Cup):""),style:{marginLeft:"90px",marginTop:"5px"}});this.toggleStatusCissModeContainer=div({style:{marginTop:"20px",display:"flex",flexDirection:"row",justifyContent:"center"},children:[div({innerHTML:"Design mode: ",style:{width:"100px",height:"30px"}})]});const r=this;this.containerBSection2.innerHTML="";DOMUtils.SetOptions(this.containerBSection2,{children:[n,l,o,a,r.offsetXContainer,r.offsetYContainer,r.rotationContainer,r.implantSizeContainer,r.toggleStatusCissModeContainer]});this.ToggleStatusCissMode=new WebClient.ToggleButton(this.toggleStatusCissModeContainer,WebClient.ETypeToggleButton.ButtonA,"On","Off",this.controller.CISSAutomaticImplantsMode,(t=>{this.controller.SetCISSAutomaticImplantsModeStatus(t)}));this.ToggleStatusCissMode.Create();DOMUtils.SetOptions(this.ToggleStatusCissMode.Element,{style:{width:"60px",height:"30px"}});let s;let h;let m;if(t!==null&&t!==undefined){s=e===OrthoPlugin.EHipImplant.Stem?t.OrthoStemImplant.OffsetX:t.OrthoAcetabularCupImplant.OffsetX;h=e===OrthoPlugin.EHipImplant.Stem?t.OrthoStemImplant.OffsetY:t.OrthoAcetabularCupImplant.OffsetY;m=e===OrthoPlugin.EHipImplant.Stem?t.OrthoStemImplant.Rotation:t.OrthoAcetabularCupImplant.Rotation}var d=new WebClient.AdjustControl(o,150,(t=>{this.controller.ControlAdjustImplant(t,e)}));this.BuildComponentForAdjustControl(l,e);var u=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var p=u.RendererPlugins[this.controller.Plugin.PluginName];this.ControlUI();this.ControlButtonsMainWindow(p,this.controller.HipAnnotation,this.controller.ActionHip)}UpdateUIAdjustImplant(t,e){this.rotationContainer.innerHTML="Rotation: "+t.Rotation.toFixed(1)+" deg";this.offsetXContainer.innerHTML="Offset x: "+t.OffsetX.toFixed(1);this.offsetYContainer.innerHTML="Offset y: "+t.OffsetY.toFixed(1);this.implantSizeContainer.innerHTML="Implant: "+this.controller.GetImplantSizeName(t,e);this.controller.ImplantInformation(t,e)}UnSelectAllImplants(){var t=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var e=t.RendererPlugins[this.controller.Plugin.PluginName];if(this.controller.HipAnnotation.OrthoStemImplant.ImplantReadyForDraw&&this.controller.HipAnnotation.OrthoStemImplant.Selected){this.controller.HipAnnotation.OrthoStemImplant.Selected=false;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}if(this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantReadyForDraw&&this.controller.HipAnnotation.OrthoAcetabularCupImplant.Selected){this.controller.HipAnnotation.OrthoAcetabularCupImplant.Selected=false;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}InitFormDataAndEvents(t,e,n,o){this.orthoToolWindow.ButtonsElementsContainer.innerHTML="";this.spaceTab.innerHTML="";var l={};var a={};var r={};var s={};var h={};var m={};var d={};var u={};var p={};var c={};var A={};var C={};var S={};var g={};var I={};this.DataSection1=[l,a];this.DataSection2=[r,s,h,m,d,u,p,c,A,C,S,g,I];l["actionBtnAp"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.ActionApButton(true)};l["actionBtnAcetabulum"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ResetActionsDraw("Acetabulum");this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");if(!this.controller.HipAnnotation.Points["Acetabulum"])this.controller.HipAnnotation.Points["Acetabulum"]=new Array;this.spaceTab.style.height="auto";this.UnSelectAllImplants();this.controller.ActionAcetabulum((()=>{this.viewTab();this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};l["actionBtnFemur"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ResetActionsDraw("FemoralHead");this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");if(!this.controller.HipAnnotation.Points["FemoralHead"])this.controller.HipAnnotation.Points["FemoralHead"]=new Array;if(!this.controller.HipAnnotation.Points["CurveDistal"])this.controller.HipAnnotation.Points["CurveDistal"]=new Array;if(!this.controller.HipAnnotation.Points["CurveMedial"])this.controller.HipAnnotation.Points["CurveMedial"]=new Array;this.spaceTab.style.height="auto";this.UnSelectAllImplants();this.controller.ActionFemur((()=>{this.viewTab();this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};l["actionBtnShaft"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ResetActionsDraw(null);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.spaceTab.style.height="auto";this.UnSelectAllImplants();this.controller.ActionShaftAngle((()=>{this.viewTab();var t=this.controller.HipAnnotation.GetShaftAngle();this.controller.LastValueShaftAngle=t;this.SetShaftAngle(Math.floor(this.controller.HipAnnotation.GetShaftAngle()).toString());this.controller.ShowTextAndControl(2,this.OrthoElementsSection2,"ShaftAngleSection","TextShaftAngle","Acetabulum",this.controller.Edition,"Enter a value for the shaft angle");this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};l["actionBtnTransschial"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ResetActionsDraw("AbductionLine");this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");if(!this.controller.HipAnnotation.Points["AbductionLine"])this.controller.HipAnnotation.Points["AbductionLine"]=new Array;if(!this.controller.HipAnnotation.Points["LegLengthDiscrepancy"])this.controller.HipAnnotation.Points["LegLengthDiscrepancy"]=new Array;if(!this.controller.HipAnnotation.Points["LegLengthDiscrepancyLabel"])this.controller.HipAnnotation.Points["LegLengthDiscrepancyLabel"]=new Array;this.spaceTab.style.height="auto";this.UnSelectAllImplants();this.controller.ActionAbductionSetPoints((()=>{this.viewTab();this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");this.controller.ShowTextAndControl(2,this.OrthoElementsSection2,"AcetabulumAbductionPointsSection","TextAcetabulum","AbductionLine",this.controller.Edition);this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};l["actionBtnAbduction"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ResetActionsDraw(null);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.spaceTab.style.height="auto";this.UnSelectAllImplants();this.controller.ActionAbductionAngle((()=>{this.viewTab();var t=this.controller.HipAnnotation.GetAbductionAngle();this.controller.LastAbductionAngle=t;this.SetAbductionAngle(Math.floor(this.controller.HipAnnotation.GetAbductionAngle()).toString());this.controller.ShowTextAndControl(2,this.OrthoElementsSection2,"AcetabulumAbductionAngleSection","TextAcetabulum","",this.controller.Edition);this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}))};l["actionBtnAdjust"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.controller.ResetActionsDraw(null);this.controller.ActionAdjust()};l["actionBtnStem"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.controller.ResetActionsDraw(null);let e=n.Context.ImageEntity.IsCalibrated();if(e){this.controller.ActionHip=OrthoPlugin.EActionHip.StemImplant;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.Stem];this.controller.OpenTabImplantStem();this.ControlTabContent(this.controller.ActionHip);this.ControlStatusMainButtons(n,o,this.controller.ActionHip,this.controller.HipAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.HipAnnotation,this.controller.ActionHip);this.OrthoFloatingBar.Element.style.height="auto"}else{WebClient.Toaster.ShowToast("Image calibration is mandatory.",WebClient.Colors.Orange,3)}};l["actionBtnCup"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.controller.ResetActionsDraw(null);let e=n.Context.ImageEntity.IsCalibrated();if(e){this.controller.ActionHip=OrthoPlugin.EActionHip.CupImplant;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.Cup];this.controller.OpenTabImplantAcetabular();this.ControlTabContent(this.controller.ActionHip);this.ControlStatusMainButtons(n,o,this.controller.ActionHip,this.controller.HipAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.HipAnnotation,this.controller.ActionHip);this.OrthoFloatingBar.Element.style.height="auto"}else{WebClient.Toaster.ShowToast("Image calibration is mandatory.",WebClient.Colors.Orange,3)}};l["actionBtnHead"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.controller.ResetActionsDraw(null);this.controller.ActionHip=OrthoPlugin.EActionHip.HeadImplant;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.Head];this.controller.OpenTabImplantStem();this.controller.OpenTabImplantHead();this.ControlTabContent(this.controller.ActionHip);this.ControlStatusMainButtons(n,o,this.controller.ActionHip,this.controller.HipAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.HipAnnotation,this.controller.ActionHip);this.OrthoFloatingBar.Element.style.height="auto"};l["actionBtnFavorites"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.controller.ResetActionsDraw(null);let e=n.Context.ImageEntity.IsCalibrated();if(e){this.controller.ActionHip=OrthoPlugin.EActionHip.FavImplant;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.Fav];this.controller.OpenTabImplantStem();this.controller.OpenTabImplantAcetabular();this.controller.OpenTabImplantFavorites();this.ControlTabContent(this.controller.ActionHip);this.ControlStatusMainButtons(n,o,this.controller.ActionHip,this.controller.HipAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.HipAnnotation,this.controller.ActionHip);this.OrthoFloatingBar.Element.style.height="auto"}else{WebClient.Toaster.ShowToast("Image calibration is mandatory.",WebClient.Colors.Orange,3)}};a["actionBtnStemImplant"]=t=>{this.controller.ResetActionsDraw(null);this.controller.ActionHip=OrthoPlugin.EActionHip.AdjustStemImplant;this.BuildUIAdjustControl(this.controller.HipAnnotation,OrthoPlugin.EHipImplant.Stem)};a["actionBtnAcetabularCupImplant"]=t=>{this.controller.ResetActionsDraw(null);this.controller.ActionHip=OrthoPlugin.EActionHip.AdjustAcetabularCupImplant;this.BuildUIAdjustControl(this.controller.HipAnnotation,OrthoPlugin.EHipImplant.Cup)};r["actionBtnStartOverAcetabulum"]=t=>{this.startOver()};r["actionBtnDoneAcetabulum"]=t=>{this.controller.ActionOkHipStatusAcetabulum()};r["actionBtnCancelAcetabulum"]=t=>{this.controller.ActionCancelHipStatusAcetabulum()};s["actionBtnStartOverFemoralHead"]=t=>{this.startOver()};s["actionBtnCancelFemoralHead"]=t=>{this.controller.ActionCancelHipStatusFemoralHead()};h["actionBtnStartOverLeftLateral"]=t=>{this.startOver()};h["actionBtnDoneLeftLateral"]=t=>{this.controller.ActionOkHipStatusFemoralCurveDistal((()=>{this.spaceTab.style.display="block"}))};h["actionBtnCancelLeftLateral"]=t=>{this.controller.ActionCancelHipStatusFemoralCurveDistal()};m["actionBtnStartOverRightLateral"]=t=>{this.startOver()};m["actionBtnDoneRightLateral"]=t=>{this.controller.ActionOkHipStatusFemoralCurveMedial()};m["actionBtnCancelRightLateral"]=t=>{this.controller.ActionCancelHipStatusFemoralCurveMedial()};d["actionBtnDoneShaftAngle"]=t=>{this.controller.ActionOkHipStatusShaftAngle()};d["actionBtnCancelShaftAngle"]=t=>{this.controller.ActionCancelHipStatusShaftAngle()};d["shaftAngle"]="";d["dataShaftAngleUD"]=[new WebClient.ValuesUD("100","100"),new WebClient.ValuesUD("160","160")];if(t!==null&&t!==undefined)d["defaultShaftAngleUD"]=new WebClient.ValuesUD(t.GetShaftAngle().toString(),t.GetShaftAngle().toString());u["actionBtnStartOverAbductionAngle"]=t=>{this.startOver()};u["actionBtnDoneAbductionAngle"]=t=>{this.controller.ActionOkHipStatusAbductionAngle()};u["actionBtnCancelAbductionAngle"]=t=>{this.controller.ActionCancelHipStatusAbductionAngle()};I["abductionAngle"]="";I["dataAbductionAngleUD"]=[new WebClient.ValuesUD("0","0"),new WebClient.ValuesUD("90","90")];if(t!==null&&t!==undefined)I["defaultAbductionAngleUD"]=new WebClient.ValuesUD(t.GetAbductionAngle().toString(),t.GetAbductionAngle().toString());I["actionBtnDoneAbductionSetAngle"]=()=>{this.controller.ActionOkHipStatusAbductionSetAngle()};I["actionBtnCancelAbductionSetAngle"]=()=>{this.controller.ActionCancelHipStatusAbductionSetAngle()};p["actionStemfavoriteProductLine"]=(t,e)=>{var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");var l=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");var a=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");l.UpdateValue(p,this.GetSelectfavoriteFamilyStem());if(!this.GetSelectfavoriteFamilyStem().match("None")){this.controller.FavoriteStemItem=this.GetSelectfavoriteFamilyStem();var r=this.controller.DataFavoriteStruct.Favorites.filter((t=>decodeURIComponent(t.Name)===this.GetSelectfavoriteFamilyStem()));var s=r[0].Manufacturer[0].Name;this.controller.LoadDataPerManufacturer(OrthoPlugin.EHipImplant.Stem,s,true,(()=>{var t=decodeURIComponent(r[0].Manufacturer[0].Groups[0].ProductLines[0].Name);l.htmlElement.value=t;o.htmlElement.value=s;var e=decodeURIComponent(r[0].Manufacturer[0].Groups[0].ProductLines[0].Types[0].ProductFamilies[0].Name);this.controller.ActionProductLineStem(e);this.controller.HipAnnotation.OrthoStemImplant.ImplantManufacturer=s;this.controller.HipAnnotation.OrthoStemImplant.ImplantProductLine=t;this.controller.HipAnnotation.OrthoStemImplant.ImplantComponentFamily=e;this.controller.ActionComponentFamilyStem();o.htmlElement.disabled=true;l.htmlElement.disabled=true;a.htmlElement.disabled=true}))}else{this.controller.FavoriteStemItem=null;o.htmlElement.selectedIndex=0;l.htmlElement.selectedIndex=0;a.htmlElement.selectedIndex=0;this.SetSelectProductLineStem(["--"],["--"],"--");this.SetSelectComponentFamilyStem(["--"],["--"],"--");this.SetUpDownImplantSizeStem([new WebClient.ValuesUD("-","-")],"");o.htmlElement.disabled=false;l.htmlElement.disabled=false;a.htmlElement.disabled=false;this.controller.HipAnnotation.OrthoStemImplant.ImplantManufacturer=undefined;this.controller.HipAnnotation.OrthoStemImplant.ImplantProductLine=undefined;this.controller.HipAnnotation.OrthoStemImplant.ImplantComponentFamily=undefined;this.controller.HipAnnotation.OrthoStemImplant.ImplantSize=undefined;this.controller.HipAnnotation.OrthoStemImplant.ImplantReadyForDraw=false;this.controller.HipAnnotation.OrthoStemImplant.ImplantSvgUrl=null;n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}};p["optionsStemfavoriteProductLine"]="-None-";p["valuesStemfavoriteProductLine"]="-None-";p["productfavoriteLineStem"]="-None-";p["actionAcetabularfavoriteProductLine"]=()=>{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerAcetabularCup");var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineAcetabularCup");var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyAcetabularCup");e.UpdateValue(p,this.GetSelectfavoriteFamilyCup());if(!this.GetSelectfavoriteFamilyCup().match("None")){this.controller.FavoriteCupItem=this.GetSelectfavoriteFamilyCup();var l=this.controller.DataFavoriteStruct.Favorites.filter((t=>decodeURIComponent(t.Name)===this.GetSelectfavoriteFamilyCup()));var a=l[0].Manufacturer[0].Name;this.controller.LoadDataPerManufacturer(OrthoPlugin.EHipImplant.Cup,a,true,(()=>{var n=decodeURIComponent(l[0].Manufacturer[0].Groups[0].ProductLines[0].Name);e.htmlElement.value=n;t.htmlElement.value=a;var r=decodeURIComponent(l[0].Manufacturer[0].Groups[0].ProductLines[0].Types[0].ProductFamilies[0].Name);this.controller.ActionProductLineAcetabularCup(r);this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=a;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantProductLine=n;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantComponentFamily=r;this.controller.ActionComponentFamilyAcetabularCup();t.htmlElement.disabled=true;e.htmlElement.disabled=true;o.htmlElement.disabled=true}))}else{this.controller.FavoriteCupItem=null;t.htmlElement.selectedIndex=0;e.htmlElement.selectedIndex=0;o.htmlElement.selectedIndex=0;this.SetSelectProductLineAcetabularCup(["--"],["--"],"--");this.SetSelectComponentFamilyAcetabularCup(["--"],["--"],"--");this.SetUpDownImplantSizeAcetabularCup([new WebClient.ValuesUD("-","-")],"");t.htmlElement.disabled=false;e.htmlElement.disabled=false;o.htmlElement.disabled=false;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=undefined;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantProductLine=undefined;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantComponentFamily=undefined;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantSize=undefined;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantReadyForDraw=false;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantSvgUrl=null;n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}};p["optionsAcetabularfavoriteProductLine"]="-None-";p["valuesAcetabularfavoriteProductLine"]="-None-";p["productfavoriteLineAcetabular"]="-None-";c["actionStemManufacturer"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");n.htmlElement.innerHTML="";if(t.currentTarget.selectedIndex===0){this.ResetStemSelection()}else{this.controller.LoadDataPerManufacturer(OrthoPlugin.EHipImplant.Stem,t.currentTarget.value,true,(t=>{this.ValidateManufacturesComponents(OrthoPlugin.EHipImplant.Stem,t)}))}};c["optionsStemManufacturer"]="--";c["valuesStemManufacturer"]="--";c["manufactrurerStem"]="--";c["actionStemProductLine"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");n.htmlElement.innerHTML="";this.controller.CleanImplant(OrthoPlugin.EHipImplant.Stem);this.controller.ActionProductLineStem()};c["optionsStemProductLine"]="--";c["valuesStemProductLine"]="--";c["productLineStem"]="--";c["actionStemComponentFamily"]=(t,e)=>{this.controller.ActionComponentFamilyStem()};c["optionsStemComponentFamily"]="--";c["valuesStemComponentFamily"]="--";c["componentFamilyStem"]="--";c["implantSizeStem"]="";c["dataImplantSizeStem"]=[new WebClient.ValuesUD("-","-")];c["actionBtnDoneInsertImplantStem"]=t=>{this.controller.ActionOkHipStatusInsertImplantStem();this.controller.ActionAdjust(OrthoPlugin.EHipImplant.Stem)};c["actionBtnClearInsertImplantStem"]=t=>{var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");this.controller.ClearDataImplants(OrthoPlugin.EHipImplant.Stem);this.controller.LoadDataPerManufacturer(OrthoPlugin.EHipImplant.Stem,e.htmlElement.value,true,null)};c["actionBtnCancelInsertImplantStem"]=t=>{this.controller.ActionCancelHipStatusInsertImplantStem()};A["actionAcetabularCupManufacturer"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineAcetabularCup");n.htmlElement.innerHTML="";if(t.currentTarget.selectedIndex===0){this.ResetCupSelection()}else{this.controller.LoadDataPerManufacturer(OrthoPlugin.EHipImplant.Cup,t.currentTarget.value,true,(t=>{this.ValidateManufacturesComponents(OrthoPlugin.EHipImplant.Cup,t)}))}};A["optionsAcetabularCupManufacturer"]="--";A["valuesAcetabularCupManufacturer"]="--";A["manufacturerAcetabularCup"]="--";A["actionAcetabularCupProductLine"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyAcetabularCup");n.htmlElement.innerHTML="";this.controller.CleanImplant(OrthoPlugin.EHipImplant.Cup);this.controller.ActionProductLineAcetabularCup()};A["optionsAcetabularCupProductLine"]="--";A["valuesAcetabularCupProductLine"]="--";A["productLineAcetabularCup"]="--";A["actionAcetabularCupComponentFamily"]=(t,e)=>{this.controller.ActionComponentFamilyAcetabularCup()};A["optionsAcetabularCupComponentFamily"]="--";A["valuesAcetabularCupComponentFamily"]="--";A["componentFamilyAcetabularCup"]="--";A["implantSizeAcetabularCup"]="";A["dataImplantSizeAcetabularCup"]=[new WebClient.ValuesUD("-","-")];A["actionBtnDoneInsertImplantAcetabularCup"]=t=>{this.controller.ActionOkHipStatusInsertImplantAcetabularCup();this.controller.ActionAdjust(OrthoPlugin.EHipImplant.Cup)};A["actionBtnClearInsertImplantAcetabularCup"]=t=>{var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerAcetabularCup");this.controller.ClearDataImplants(OrthoPlugin.EHipImplant.Cup);this.controller.LoadDataPerManufacturer(OrthoPlugin.EHipImplant.Cup,e.htmlElement.value,true,null)};A["actionBtnCancelInsertImplantAcetabularCup"]=t=>{this.controller.ActionCancelHipStatusInsertImplantAcetabularCup()};C["actionBtnDoneFemoralHeadSet"]=t=>{this.controller.ActionBtnDoneFemoralHeadSet()};C["actionBtnCancelFemoralHeadSet"]=t=>{this.controller.ActionBtnCancelFemoralHeadSet()};g["actionBtnCalibration"]=t=>{this.controller.ActionCalibrate()};this.OrthoElementsSection1=(new Vue.Products.OrthoPlugin.HipImplantSection1Form).Create(this.orthoToolWindow.ButtonsElementsContainer,this.DataSection1);this.OrthoFloatingBar.BuildForm(this.OrthoElementsSection1,e);this.ControlUI();this.ControlStatusMainButtons(n,o,this.controller.ActionHip,t);this.containerASection2=div({style:{display:"none"}});this.containerBSection2=div({style:{display:"none"}});this.spaceTab.appendChild(this.containerASection2);this.spaceTab.appendChild(this.containerBSection2);this.OrthoElementsSection2=(new Vue.Products.OrthoPlugin.HipImplantSection2Form).Create(this.containerASection2,this.DataSection2);this.controller.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.AppendIconsToMainButtons();this.ControlCalibrationButton();this.BuildUIAdjustControl(t,OrthoPlugin.EHipImplant.Stem);this.setPostControls(n);this.viewTab();WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAp").htmlElement.click();this.OrthoFloatingBar.Element.querySelector("#SectionButtonsA").style.margin="0px";this.OrthoFloatingBar.Element.querySelector("#SectionButtonsB").style.margin="0px"}ValidateManufacturesComponents(t,e){let n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerAcetabularCup");let o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");let l=this.controller.GetHipManufacturers();if(t===OrthoPlugin.EHipImplant.Stem){if(o.htmlElement.selectedIndex!==0&&n.htmlElement.value!==e){if(l[OrthoPlugin.EHipImplant[OrthoPlugin.EHipImplant.Cup]]){this.controller.LoadDataPerManufacturer(OrthoPlugin.EHipImplant.Cup,e,true);this.ResetCupSelection(true)}}}else if(t===OrthoPlugin.EHipImplant.Cup){if(n.htmlElement.selectedIndex!==0&&o.htmlElement.value!==e){if(l[OrthoPlugin.EHipImplant[OrthoPlugin.EHipImplant.Stem]]){this.controller.LoadDataPerManufacturer(OrthoPlugin.EHipImplant.Stem,e,true);this.ResetStemSelection(true)}}}}ChangeCISSAutomaticImplantsModeStatus(t){this.ToggleStatusCissMode.SetStatus(t)}ResetStemSelection(t=false){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");var l=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var a=l.RendererPlugins[this.controller.Plugin.PluginName];n.htmlElement.selectedIndex=0;o.htmlElement.selectedIndex=0;this.SetSelectComponentFamilyStem(["--"],["--"],"--");this.SetUpDownImplantSizeStem([new WebClient.ValuesUD("-","-")],"");e.htmlElement.disabled=false;n.htmlElement.disabled=false;o.htmlElement.disabled=false;if(!t){e.htmlElement.selectedIndex=0;this.controller.HipAnnotation.OrthoStemImplant.ImplantManufacturer=undefined;this.SetSelectProductLineStem(["--"],["--"],"--")}this.controller.HipAnnotation.OrthoStemImplant.ImplantProductLine=undefined;this.controller.HipAnnotation.OrthoStemImplant.ImplantComponentFamily=undefined;this.controller.HipAnnotation.OrthoStemImplant.ImplantSize=undefined;this.controller.HipAnnotation.OrthoStemImplant.ImplantReadyForDraw=false;this.controller.HipAnnotation.OrthoStemImplant.ImplantSvgUrl=null;a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}ResetCupSelection(t=false){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerAcetabularCup");var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineAcetabularCup");var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyAcetabularCup");var l=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var a=l.RendererPlugins[this.controller.Plugin.PluginName];n.htmlElement.selectedIndex=0;o.htmlElement.selectedIndex=0;this.SetSelectComponentFamilyAcetabularCup(["--"],["--"],"--");this.SetUpDownImplantSizeAcetabularCup([new WebClient.ValuesUD("-","-")],"");e.htmlElement.disabled=false;n.htmlElement.disabled=false;o.htmlElement.disabled=false;if(!t){e.htmlElement.selectedIndex=0;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantManufacturer=undefined;this.SetSelectProductLineAcetabularCup(["--"],["--"],"--")}this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantProductLine=undefined;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantComponentFamily=undefined;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantSize=undefined;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantReadyForDraw=false;this.controller.HipAnnotation.OrthoAcetabularCupImplant.ImplantSvgUrl=null;a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}ViewTab(){this.viewTab()}ControlUI(){var t=this.OrthoFloatingBar.Element.getElementsByClassName("section");for(var e=0;e<t.length;e++){if(t[e]["style"]["display"]!=="none"){var n=t[e].getElementsByClassName("block");if(e>=0){for(var o=0;o<n.length;o++){n[o].style.paddingBottom="0"}var l=n[0].childNodes[0];l["style"]["justify-content"]="left"}}}}AddRemoveCheckControlToButtons(t,e){let removeCheckControl=()=>{let t=e.getElementsByTagName("span");if(t){let e=t[0];DOMUtils.RemoveItem(e)}};if(e){if(t){removeCheckControl();let t=span({style:{position:"absolute",bottom:"-1px",right:"1px"},children:[img({width:12,height:12,src:OrthoPlugin.ResourceBag.CheckedPng})]});e.style.position="relative";e.appendChild(t)}else{removeCheckControl()}}}ValidateViewportStarted(){var t=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var e=true;if(t.Id!==this.controller.InitialViewportStart.Id){var n=this.controller.InitialViewportStart.RendererPlugins[this.controller.Plugin.PluginName];this.controller.StatusDraw=false;this.controller.ActionHip=OrthoPlugin.EActionHip.Calibration;this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"default");n.Context.AnnotationController.ResetOnlyCurrentGroup();n.Context.AnnotationController.CurrentGroup=null;this.controller.ShowTextAndControl(2,this.OrthoElementsSection2,"CalibrationSection","","",this.controller.Edition);this.GetButtonsForm().forEach((t=>{t.disabled=true}));n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();WebClient.Toaster.ShowToast("Please remain on the active viewport to continue editing.",WebClient.Colors.GreenSea,5);e=false}return e}GetButtonsForm(){var t=new Array;var e=this.DataSection1[0]["forms"][0];var n=this.DataSection1[1]["forms"][0];var o=e.GetField("BtnFemur").htmlElement;var l=e.GetField("BtnAcetabulum").htmlElement;var a=e.GetField("BtnShaft").htmlElement;var r=e.GetField("BtnTransschial").htmlElement;var s=e.GetField("BtnAbduction").htmlElement;var h=e.GetField("BtnAdjust").htmlElement;var m=n.GetField("BtnStem").htmlElement;var d=n.GetField("BtnAcetabularCup").htmlElement;var u=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnStemAction").htmlElement;var p=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnCupAction").htmlElement;var c=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnHeadAction").htmlElement;var A=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavorites").htmlElement;t.push(...[o,l,a,r,s,h,m,d,u,p,c,A]);return t}ControlStatusMainButtons(t,e,n,o){var l=t.Context.ImageEntity.IsCalibrated();var a=this.DataSection1[0]["forms"][0];var r=this.DataSection1[1]["forms"][0];var s=a.GetField("BtnFemur").htmlElement;var h=a.GetField("BtnAcetabulum").htmlElement;var m=a.GetField("BtnShaft").htmlElement;var d=a.GetField("BtnTransschial").htmlElement;var u=a.GetField("BtnAbduction").htmlElement;var p=a.GetField("BtnAdjust").htmlElement;var c=r.GetField("BtnStem").htmlElement;var A=r.GetField("BtnAcetabularCup").htmlElement;var C=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnStemAction").htmlElement;var S=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnCupAction").htmlElement;var g=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnHeadAction").htmlElement;var I=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavorites").htmlElement;if(o&&o.Status===ImagingStudyView.EAnnotationStatus.Complete){s.disabled=false;h.disabled=false;m.disabled=false;u.disabled=false;p.disabled=false}else{s.disabled=!l;h.disabled=!l;m.disabled=!l;u.disabled=!l;p.disabled=!l;c.disabled=!l;A.disabled=!l;d.disabled=!l;C.disabled=!l;S.disabled=!l;g.disabled=!l;I.disabled=!l}if(t.Context.AnnotationController){let e=t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["Acetabulum"]);if(e)this.AddRemoveCheckControlToButtons(true,h);else this.AddRemoveCheckControlToButtons(false,h);let n=t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["FemoralHead"]);let o=t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["CurveDistal"]);let l=t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["CurveMedial"]);if(n&&o&&l)this.AddRemoveCheckControlToButtons(true,s);else this.AddRemoveCheckControlToButtons(false,s);let a=t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["AbductionLine"]);if(a)this.AddRemoveCheckControlToButtons(true,d);else this.AddRemoveCheckControlToButtons(false,d);if(this.controller.StatusSetAbductionAngle)this.AddRemoveCheckControlToButtons(true,u);else this.AddRemoveCheckControlToButtons(false,u);if(this.controller.ShaftAngleWasUpdated)this.AddRemoveCheckControlToButtons(true,m);else this.AddRemoveCheckControlToButtons(false,m)}this.ControlTabContent(n);this.cleanClassColorOfButtonDisabled(a);this.cleanClassColorOfButtonDisabled(r);if(!l){this.controller.StatusDraw=false}}GetTransischialPointsStatusComplete(t){return t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["AbductionLine"])}ControlTabContent(t){this.spaceTab.style.minHeight="100px";switch(t){case OrthoPlugin.EActionHip.None:this.spaceTab.style.display="block";var e=this.spaceTab.getElementsByClassName("section");for(var n in e){if(e.hasOwnProperty(n))e[n].style.display="none"}if(this.containerASection2!==undefined)this.containerASection2.style.display="none";if(this.containerBSection2!==undefined)this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break;case OrthoPlugin.EActionHip.Calibration:case OrthoPlugin.EActionHip.Acetabulum:case OrthoPlugin.EActionHip.FemoralHead:case OrthoPlugin.EActionHip.FemoralCurveDistal:case OrthoPlugin.EActionHip.FemoralCurveMedial:case OrthoPlugin.EActionHip.AbductionAngle:case OrthoPlugin.EActionHip.AbductionSetAngle:this.spaceTab.style.display="block";this.containerASection2.style.display="block";this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break;case OrthoPlugin.EActionHip.InsertImplant:case OrthoPlugin.EActionHip.FavImplant:case OrthoPlugin.EActionHip.StemImplant:case OrthoPlugin.EActionHip.CupImplant:case OrthoPlugin.EActionHip.HeadImplant:this.spaceTab.style.display="block";this.containerASection2.style.display="block";this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break;case OrthoPlugin.EActionHip.AdjustImplant:case OrthoPlugin.EActionHip.AdjustStemImplant:case OrthoPlugin.EActionHip.AdjustAcetabularCupImplant:this.spaceTab.style.display="block";this.containerASection2.style.display="none";this.containerBSection2.style.display="block";this.spaceTab.style.height="332px";this.orthoToolWindow.ActionsSummaryContainer.style.display="none";if(t===OrthoPlugin.EActionHip.AdjustStemImplant)this.UpdateUIAdjustImplant(this.controller.HipAnnotation.OrthoStemImplant,OrthoPlugin.EHipImplant.Stem);else if(t===OrthoPlugin.EActionHip.AdjustAcetabularCupImplant)this.UpdateUIAdjustImplant(this.controller.HipAnnotation.OrthoAcetabularCupImplant,OrthoPlugin.EHipImplant.Cup);break}}GetSelectProductLineStem(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectProductLineAcetabularCup(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineAcetabularCup");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}SetSelectProductLineStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectProductLineAcetabularCup(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineAcetabularCup");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}GetSelectComponentFamilyStem(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}SetSelectComponentFamilyStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o);if(t.length>1&&(t[0]!=="--"&&n!=="--")){}}GetSelectfavoriteFamilyStem(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectfavoriteProductLineStem");return decodeURIComponent(t.htmlElement.value)}catch(t){return""}}SetSelectfavoriteFamilyStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectfavoriteProductLineStem");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o)}GetSelectfavoriteFamilyCup(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectfavoriteProductLineAcetabular");return decodeURIComponent(t.htmlElement.value)}catch(t){return""}}SetSelectfavoriteFamilyCup(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectfavoriteProductLineAcetabular");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o)}GetSelectManufacturerStem(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}SetSelectManufacturerStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}GetSelectManufacturerAcetabularCup(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerAcetabularCup");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}SetSelectManufacturerAcetabularCup(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerAcetabularCup");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}GetSelectComponentFamilyAcetabularCup(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyAcetabularCup");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}SetSelectComponentFamilyAcetabularCup(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyAcetabularCup");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o);if(t.length>1&&t[0]!=="--"&&n!=="--"){}}GetShaftAngle(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownShaftAngle");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}SetShaftAngle(t){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownShaftAngle");var n=e.htmlElement["UpDownObject"];var o=e.htmlElement["GetIndexValue"](n,t);if(o){n.Index=o;n.Item=new WebClient.ValuesUD(t,t);e.htmlElement["UpdateInputReference"](n,true)}}GetAbductionAngle(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownAbductionAngle");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}SetAbductionAngle(t){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownAbductionAngle");var n=e.htmlElement["UpDownObject"];var o=e.htmlElement["GetIndexValue"](n,t);if(o){n.Index=o;n.Item=new WebClient.ValuesUD(t,t);e.htmlElement["UpdateInputReference"](n,true)}}GetUpDownImplantSizeStem(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeStem");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}SetUpDownImplantSizeStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeStem");var l=o.htmlElement["UpDownObject"];l.Items=t;if(e!==undefined&&e!==null){var a=t.filter((t=>t.Value===e));var r=e;if(a.length>0)r=a[0].Text;l.Item=new WebClient.ValuesUD(e,r)}if(n!==undefined&&n!==null){l.Index=n;o.htmlElement["UpdateInputReference"](l,true)}else{o.htmlElement["UpdateInputReference"](l,false)}}GetUpDownImplantSizeAcetabularCup(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeAcetabularCup");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}GetFemoralHeadDiameter(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"FemoralHeadDiameter");return t.htmlElement.value}catch(t){return""}}SetFemoralHeadDiameter(t){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"FemoralHeadDiameter");var n=e.htmlElement;e.UpdateValue(e.htmlElement["binding"],t);n.value=t}GetFemoralHeadOffset(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"FemoralHeadOffset");return t.htmlElement.value}catch(t){return""}}SetFemoralHeadOffset(t){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"FemoralHeadOffset");var n=e.htmlElement;e.UpdateValue(e.htmlElement["binding"],t);n.value=t}SetUpDownImplantSizeAcetabularCup(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeAcetabularCup");var l=o.htmlElement["UpDownObject"];l.Items=t;if(e!==undefined&&e!==null){var a=t.filter((t=>t.Value===e));var r=e;if(a.length>0)r=a[0].Text;l.Item=new WebClient.ValuesUD(e,r)}if(n!==undefined&&n!==null){l.Index=n;o.htmlElement["UpdateInputReference"](l,true)}else o.htmlElement["UpdateInputReference"](l,false)}BuildViewSide(){var t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);var e=t.RendererPlugins[this.controller.Plugin.PluginName];var n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;const o=input({type:"radio",name:"radioBtnView",id:"bbSideAP",value:"AP",checked:!n||n&&n.ViewDirection===OrthoPlugin.EViewCiss.AP,onchange:o=>{t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);e=t.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;var l=o.target;if(l.value==="AP")n.ViewDirection=OrthoPlugin.EViewCiss.AP;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}});const l=input({type:"radio",name:"radioBtnView",id:"bbSidePA",value:"PA",checked:n&&n.ViewDirection===OrthoPlugin.EViewCiss.PA,onchange:o=>{t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);e=t.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;var l=o.target;if(l.value==="PA")n.ViewDirection=OrthoPlugin.EViewCiss.PA;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}});const a=div({children:[div({className:"label",innerHTML:"Orientation: "}),div({className:"buttonbar",children:[o,label({htmlFor:"bbSideAP",innerHTML:"AP"}),l,label({htmlFor:"bbSidePA",innerHTML:"PA"})]})]});this.orthoToolWindow.LeftTopSection.appendChild(a)}ActionApButton(t){try{var e=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var n=e.RendererPlugins[this.controller.Plugin.PluginName];this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ResetActionsDraw(null);if(t)this.controller.Plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");this.controller.ActionHip=OrthoPlugin.EActionHip.Calibration;this.controller.ShowTextAndControl(2,this.OrthoElementsSection2,"CalibrationSection","","",this.controller.Edition);this.controller.StatusDraw=false;n.Context.AnnotationController.CurrentGroup=null;this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ControlTabContent(this.controller.ActionHip);this.ControlStatusMainButtons(n,this.controller.Edition,this.controller.ActionHip,this.controller.HipAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.HipAnnotation,this.controller.ActionHip);this.OrthoFloatingBar.Element.style.height="auto";this.ControlCalibrationButton()}catch(t){Efferent.Frontend.WebClient.Utils.DebugConsoleLog(t)}}BuildShowDesign(){var toogleDesign=t=>{var e=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var n=e.RendererPlugins[this.controller.Plugin.PluginName];var o=!this.controller.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;this.controller.Plugin.HideAnnotationSpecialForOrtho=!t;if(o)e.SwitchVisibleAnnotations(t,o.Name,o)};const t=input({type:"radio",name:"radioBtnDesign",id:"bbSideYes",value:"Yes",checked:true,onchange:t=>{var e=t.target;if(e.value==="Yes")toogleDesign(true)}});const e=input({type:"radio",name:"radioBtnDesign",id:"bbSideNo",value:"No",checked:false,onchange:t=>{var e=t.target;if(e.value==="No")toogleDesign(false)}});const n=div({id:"BtnShowHide",children:[div({className:"label",innerHTML:"Show design: "}),div({className:"buttonbar",children:[t,label({htmlFor:"bbSideYes",innerHTML:"Yes"}),e,label({htmlFor:"bbSideNo",innerHTML:"No"})]})]});if(WebClient.DOMUtils.IsDisplay(this.orthoToolWindow.SelectSideMessage))n.style.display="none";this.orthoToolWindow.LeftTopSection.appendChild(n)}cleanClassColorOfButtonDisabled(t){for(var e=0;e<t.GetFields().length;e++){var n=t.GetFields()[e].htmlElement;if(n.disabled){DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.SUCCESS);DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.ENABLE)}}}buildIAButton(){let t=button({innerHTML:"AI",type:"button",style:{display:"block","border-radius":"5px","z-index":12e3,width:"40px",height:"30px"},className:"orange",onclick:()=>__awaiter(this,void 0,void 0,(function*(){let t=yield this.controller.AIHipImplantAdapter();if(t){let e=JSON.parse(t);let n=decodeURIComponent(atob(e["valueString"]));let o=JSON.parse(n);console.log(o);let l=this.controller.Plugin.GetOrthoContext();let a=this.controller.LegSide;let r;let s;let h;let m;let d;if(a===OrthoPlugin.EBodySide.Left){r=o.Groups["AcetabulumLeft"];s=o.Groups["FemoralHeadLeft"];h=o.Groups["CurveDistalLeft"];m=o.Groups["CurveMedialLeft"]}else{r=o.Groups["AcetabulumRight"];s=o.Groups["FemoralHeadRight"];h=o.Groups["CurveDistalRight"];m=o.Groups["CurveMedialRight"]}d=o.Groups["AbductionLine"];this.controller.HipAnnotation.Points["Acetabulum"]=[];this.controller.HipAnnotation.Points["Acetabulum"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(r.PointAX,r.PointAY)));this.controller.HipAnnotation.Points["Acetabulum"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(r.PointBX,r.PointBY)));this.controller.HipAnnotation.Points["Acetabulum"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(r.PointCX,r.PointCY)));this.controller.HipAnnotation.Points["FemoralHead"]=[];this.controller.HipAnnotation.Points["FemoralHead"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(s.PointAX,s.PointAY)));this.controller.HipAnnotation.Points["FemoralHead"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(s.PointBX,s.PointBY)));this.controller.HipAnnotation.Points["FemoralHead"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(s.PointCX,s.PointCY)));this.controller.HipAnnotation.Points["CurveDistal"]=[];this.controller.HipAnnotation.Points["CurveDistal"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(h.PointAX,h.PointAY)));this.controller.HipAnnotation.Points["CurveDistal"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(h.PointBX,h.PointBY)));this.controller.HipAnnotation.Points["CurveDistal"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(h.PointCX,h.PointCY)));this.controller.HipAnnotation.Points["CurveDistal"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(h.PointDX,h.PointDY)));this.controller.HipAnnotation.Points["CurveMedial"]=[];this.controller.HipAnnotation.Points["CurveMedial"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(m.PointAX,m.PointAY)));this.controller.HipAnnotation.Points["CurveMedial"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(m.PointBX,m.PointBY)));this.controller.HipAnnotation.Points["CurveMedial"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(m.PointCX,m.PointCY)));this.controller.HipAnnotation.Points["CurveMedial"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(m.PointDX,m.PointDY)));this.controller.HipAnnotation.Points["AbductionLine"]=[];this.controller.HipAnnotation.Points["AbductionLine"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(d.PointAX,d.PointAY)));this.controller.HipAnnotation.Points["AbductionLine"].push(new ImagingStudyView.AnnotationPoint(new WebClient.Point(d.PointBX,d.PointBY)));this.controller.HipAnnotation.CanDragPoint=true;this.controller.HipAnnotation.MeasureAnnotation();this.controller.WriteActionSummaryDataForEdition();this.controller.ActionOkHipStatusFemoralCurveMedial();this.controller.ActionOkHipStatusAbductionAngle();WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAp").htmlElement.click();l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}}))});let e=div({id:"IAButtonContainer",style:{"margin-left":"50px"},children:[t]});let n=this.orthoToolWindow.RightTopSection.querySelector("#IAButtonContainer");if(n)Efferent.Frontend.WebClient.DOMUtils.RemoveItem(n);this.orthoToolWindow.RightTopSection.appendChild(e)}viewTab(){this.orthoToolWindow.MainSection.style.display="block"}startOver(){var t=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var e=t.RendererPlugins[this.controller.Plugin.PluginName];switch(this.controller.ActionHip){case OrthoPlugin.EActionHip.Acetabulum:this.controller.ActionCancelHipStatusAcetabulum();this.controller.ActionAcetabulum((()=>{this.viewTab();this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}));break;case OrthoPlugin.EActionHip.FemoralHead:this.controller.ActionCancelHipStatusFemoralHead();this.controller.ActionFemur((()=>{this.viewTab();this.containerASection2.style.display="block";this.containerBSection2.style.display="none"}));break;case OrthoPlugin.EActionHip.FemoralCurveDistal:case OrthoPlugin.EActionHip.FemoralCurveMedial:e.Context.AnnotationController.SetCurrentGroup("CurveMedial");e.Context.AnnotationController.ResetOnlyCurrentGroup();e.Context.AnnotationController.SetCurrentGroup("CurveDistal");e.Context.AnnotationController.ResetOnlyCurrentGroup();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();break;case OrthoPlugin.EActionHip.AbductionSetAngle:e.Context.AnnotationController.SetCurrentGroup("AbductionLine");e.Context.AnnotationController.ResetOnlyCurrentGroup();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();break}this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair")}setPostControls(t){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownShaftAngle");e.htmlElement["Decrease"]=e=>{this.controller.ActionIncreaseDecreaseShaftAngle(e,t)};e.htmlElement["Increase"]=e=>{this.controller.ActionIncreaseDecreaseShaftAngle(e,t)};var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownAbductionAngle");n.htmlElement["Decrease"]=e=>{this.controller.ActionIncreaseDecreaseAbductionAngle(e,t)};n.htmlElement["Increase"]=e=>{this.controller.ActionIncreaseDecreaseAbductionAngle(e,t)};var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeStem");o.htmlElement["Decrease"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantStem(e,t)};o.htmlElement["Increase"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantStem(e,t)};var l=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeAcetabularCup");l.htmlElement["Decrease"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantAcetabularCup(e,t)};l.htmlElement["Increase"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantAcetabularCup(e,t)}}}OrthoPlugin.HipImplantView=HipImplantView})(OrthoPlugin=Products.OrthoPlugin||(Products.OrthoPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.Utils;var o=Efferent.Frontend.WebClient.HttpUtils;class ImplantLibraryReader{constructor(){this.implantTemplates={}}GetProductLineNames(){var t=[];for(var n=0;n<this.implantData.ProductLines.length;n++){var o=this.implantData.ProductLines[n];t.push(o.Name)}return t.sort(e.Utils.CompareByName)}GetFamilyNames(t){var n=[];var o=this.productLineIndex[t];if(o){for(var l=0;l<o.ProductFamilies.length;l++){n.push(o.ProductFamilies[l].Name)}}return n.sort(e.Utils.CompareByName)}GetTemplateImplats(t,n,l,a,r,s){if(!this.implantTemplates[t]||this.implantTemplates[t]&&!this.implantTemplates[t][n]){e.Loader.Show("Loading implant information...");let h=t.replace(/\//gi,"¬");let m=n.replace(/\//gi,"¬");let d=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.manufacturer+"/groups/"+a+"/lines/"+h+"/families/"+m+"?patientSide="+l+"&productType="+r.replace("_"," ");o.AjaxCall(d,"GET","min",null,((o,l)=>{e.Loader.Hide();try{let e=JSON.parse(l);if(!this.implantTemplates[t])this.implantTemplates[t]={};this.implantTemplates[t][n]=e.products;s()}catch(t){e.Utils.DebugConsoleLog(t);e.Toaster.ShowToast("Error reading implant information",e.Colors.Orange,3)}}),(t=>{e.Loader.Hide();e.Toaster.ShowToast("Error getting implant information",e.Colors.Orange,3)}))}}GetFamilySizes(t,e,n,o,l,a){let getSizes=()=>{var n=new Array;this.implantTemplates[t][e].forEach((t=>{n.push({size:t.size,id:t.identifierValue})}));n=n.sort(((t,e)=>t.size.localeCompare(e.size,undefined,{numeric:true,sensitivity:"base"})));return n};if(this.implantTemplates[t]&&this.implantTemplates[t][e]){a(getSizes())}else{this.GetTemplateImplats(t,e,n,o,l,(()=>{a(getSizes())}))}}GetSizes(t,e){var n=[];if(this.implantTemplates[t]&&this.implantTemplates[t][e]){var n=new Array;this.implantTemplates[t][e].forEach((t=>{n.push({size:t.size,id:t.identifierValue})}));n=n.sort(((t,e)=>t.size.localeCompare(e.size,undefined,{numeric:true,sensitivity:"base"})))}return n}GetImplantTemplateForId(t,e,n){var o;if(this.implantTemplates[t]&&this.implantTemplates[t][e]){this.implantTemplates[t][e].forEach((t=>{if(t.identifierValue===n){o=t}}))}return o}GetFamilySizes1(t,e){var n=this.productLineIndex[t];var o=n.ProductFamilies.find((t=>t.Name===e));var l=new Array;for(const t in o.Sizes){if(o.Sizes.hasOwnProperty(t)){const e=o.Sizes[t];l.push({size:e,id:t})}}l=l.sort(((t,e)=>t.size.localeCompare(e.size,undefined,{numeric:true,sensitivity:"base"})));return l}static LoadImplantLibrary(t,l){e.Loader.Show("Loading implant templates...");const a=`implantData-${t.replace(/^.*\/\/[^\/]+/,"")}`;const processImplantData=(t,e)=>{if(n.IsDebugActive())localStorage.setItem(a,t);var o=new ImplantLibraryReader;var l=JSON.parse(t);o.implantData=l;o.manufacturer=l.Manufacturer;o.productLineIndex={};var r=o.implantData.ProductLines;for(var s=0;s<r.length;s++){var h=r[s];h.componentTypes={};o.productLineIndex[h.Name]=h;o.productFamilyIndex={};for(var m=0;m<h.ProductFamilies.length;m++){var d=h.ProductFamilies[m];o.productFamilyIndex[d.Name]=d;h.componentTypes[d.Type]=true}}e(o)};if(n.IsDebugActive()){const t=localStorage.getItem(a);try{if(t){e.Loader.Hide();processImplantData(t,l);return}}catch(t){e.Utils.DebugConsoleLog(t);e.Toaster.ShowToast("Error reading implant data",e.Colors.Orange,3)}}o.AjaxCall(t,"GET","min",null,((t,n)=>{e.Loader.Hide();try{processImplantData(n,l)}catch(t){e.Utils.DebugConsoleLog(t);e.Toaster.ShowToast("Error reading implant data",e.Colors.Orange,3)}}),(t=>{e.Loader.Hide();e.Toaster.ShowToast("Error getting implant data",e.Colors.Orange,3)}))}static filterBySizes(t){var e=[];var n={};var o=t["ProductLines"];for(var l=0;l<o.length;l++){var a=o[l]["ProductFamilies"];var r=0;a.forEach(((t,e)=>{if(t["Sizes"]){if(Object.keys(t["Sizes"]).length>0){r++}else{if(!n[l])n[l]=[];n[l].push(e)}}}));if(r===0){e.push(l)}}var s=[];for(var h=0;h<o.length;h++){var m=[];var a=o[h]["ProductFamilies"];for(var d=0;d<a.length;d++){var u=Object.keys(n);if(u.some((t=>parseInt(t)===h))&&!n[h].some((t=>t===d))||!u.some((t=>parseInt(t)===h))){m.push(a[d])}}o[h]["ProductFamilies"]=m}for(var h=0;h<o.length;h++){if(!e.some((t=>t===h))){s.push(o[h])}}o=s;return o}}t.ImplantLibraryReader=ImplantLibraryReader})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.Frontend.WebClient.DOMUtils;var o=Efferent.ClientViews.ImagingStudyView;let l;(function(t){t[t["None"]=0]="None";t[t["APCalibration"]=1]="APCalibration";t[t["APFemoralWithComponent"]=2]="APFemoralWithComponent";t[t["APFemoralResection"]=3]="APFemoralResection";t[t["APTibialWidthComponent"]=4]="APTibialWidthComponent";t[t["APTibialResection"]=5]="APTibialResection";t[t["APImplantAdjust"]=6]="APImplantAdjust";t[t["MLCalibration"]=7]="MLCalibration";t[t["MLFemoralFitLine"]=8]="MLFemoralFitLine";t[t["MLTibialLongitudinalAxis"]=9]="MLTibialLongitudinalAxis";t[t["MLImplantAdjust"]=10]="MLImplantAdjust";t[t["InsertImplant"]=11]="InsertImplant";t[t["Favorites"]=12]="Favorites"})(l=t.EActionKnee||(t.EActionKnee={}));let a;(function(t){t[t["Femoral_Component"]=0]="Femoral_Component";t[t["Tibial_Component"]=1]="Tibial_Component"})(a=t.EKneeImplant||(t.EKneeImplant={}));const{div:r,span:s,h3:h,label:m,input:d,ul:u,li:p,img:c}=n;class KneeImplantController{constructor(e,n){this.Plugin=e;this.IsTabMenu=true;this.ViewportsSelected=false;this.ReadyForSelectedViewports=false;this.AnnotationsSupport={};this.ActionKnee=l.None;this.LegSide=t.EBodySide.Left;this.ActionsSummaryAPData={};this.ActionsSummaryMLData={};this.manufacturers=new Array;this.KneeImplantView=new t.KneeImplantView(this,n);this.CISSAutomaticImplantsMode=true}LoadSvgFemoralOnViewport(n,o,r,s,h,m,d,u,p=false){var c=this.KneeImplantView.GetSelectManufacturer();c=c&&c!=="--"?c:r.ImplantManufacturer;var A=this.implantFemoralLibrary.GetImplantTemplateForId(s,h,m);if(A){try{var C=new e.Point(0,0);var S=new RegExp(t.EBodySide[this.LegSide]);r.ImplantManufacturer=c;r.ImplantProductLine=s;r.ImplantComponentFamily=h;r.ImplantSize=m;try{if(this.Edition&&(this.ActionKnee===l.APImplantAdjust||this.ActionKnee===l.MLImplantAdjust)){if(n==="AP")this.KneeImplantView.UpdateUIAdjustAPFemoralImplant(r);else if(n==="ML")this.KneeImplantView.UpdateUIAdjustMLFemoralImplant(r)}this.AddImplantInformationToSummary(t.ETemplateView[n],a.Femoral_Component,r)}catch(t){e.Utils.DebugConsoleLog(t)}var g=A.templates.filter((t=>t.title===n))[0];if(g){var I=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.KneeImplantView.GetSelectManufacturer()+"/groups/knee/files/";r.ImplantSvgUrl=I+g.url;r.LoadImplantFromSVG((()=>{if(n==="AP"){C=o.GetInitialFemoralImplantPositionAP();r.Rotation=r.WasRotated?r.Rotation:o.GetInitialFemoralImplantRotationAngleAP()}else if(n==="ML"){C=o.GetInitialFemoralImplantPositionML();r.Rotation=r.WasRotated?r.Rotation:o.GetInitialFemoralImplantRotationAngleML()}if(Efferent.ClientViews.ImplantTemplateView.LandmarksManager.LandmarksAreComplete("Knee","Femoral_Component",n,r.LandmarksTemplate,r.LandmarkItems)){r.PositionX=r.WasMoved?r.PositionX:parseFloat(C.X.toString());r.PositionY=r.WasMoved?r.PositionY:parseFloat(C.Y.toString());if(p)this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralComponentSection","","",this.Edition);d.Context.Renderer.Render();d.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The implant cannot be shown due to non-existent data.",e.Colors.Orange,3.5);r.SetImplantImage(null);d.Context.Renderer.Render();d.Context.OverlayRenderer.Render()}}),g.content,g.landmarks)}else{e.Toaster.ShowToast(`The ${n} view of this implant is not available`,e.Colors.Orange,3.5);this.KneeImplantView.CleanImplant(a.Femoral_Component,n)}}catch(t){e.Utils.DebugConsoleLog(t);e.Toaster.ShowToast(`Error getting implant parsing data for ${n} view`,e.Colors.Orange,3.5);this.KneeImplantView.CleanImplant(a.Femoral_Component,n)}}}LoadSvgTibialOnViewport(n,o,r,s,h,m,d,u,p=false){var c=this.KneeImplantView.GetSelectManufacturer();c=c&&c!=="--"?c:r.ImplantManufacturer;var A=this.implantTibialLibrary.GetImplantTemplateForId(s,h,m);if(A){try{var C=new e.Point(0,0);var S=new RegExp(t.EBodySide[this.LegSide]);r.ImplantManufacturer=c;r.ImplantProductLine=s;r.ImplantComponentFamily=h;r.ImplantSize=m;try{if(this.Edition&&(this.ActionKnee===l.APImplantAdjust||this.ActionKnee===l.MLImplantAdjust)){if(n==="AP")this.KneeImplantView.UpdateUIAdjustAPTibialImplant(r);else if(n==="ML")this.KneeImplantView.UpdateUIAdjustMLTibialImplant(r)}this.AddImplantInformationToSummary(t.ETemplateView[n],a.Tibial_Component,r)}catch(t){e.Utils.DebugConsoleLog(t)}var g=A.templates.filter((t=>t.title===n))[0];if(g){var I=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.KneeImplantView.GetSelectManufacturer()+"/groups/knee/files/";r.ImplantSvgUrl=I+g.url;r.LoadImplantFromSVG((()=>{if(n==="AP"){C=o.GetInitialTibialImplantPositionAP();r.Rotation=r.WasRotated?r.Rotation:o.GetInitialTibialImplantRotationAngleAP()}else if(n==="ML"){C=o.GetInitialTibialImplantPositionML();r.Rotation=r.WasRotated?r.Rotation:o.GetInitialTibialImplantRotationAngleML()}if(Efferent.ClientViews.ImplantTemplateView.LandmarksManager.LandmarksAreComplete("Knee","Tibial_Component",n,r.LandmarksTemplate,r.LandmarkItems)){r.PositionX=r.WasMoved?r.PositionX:parseFloat(C.X.toString());r.PositionY=r.WasMoved?r.PositionY:parseFloat(C.Y.toString());if(p)this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralComponentSection","","",this.Edition);d.Context.Renderer.Render();d.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The implant cannot be shown due to non-existent data.",e.Colors.Orange,3.5);r.SetImplantImage(null);d.Context.Renderer.Render();d.Context.OverlayRenderer.Render()}}),g.content,g.landmarks)}else{e.Toaster.ShowToast(`The ${n} view of this implant is not available`,e.Colors.Orange,3.5);this.KneeImplantView.CleanImplant(a.Tibial_Component,n)}}catch(t){e.Utils.DebugConsoleLog(t);e.Toaster.ShowToast(`Error getting implant parsing data for ${n} view`,e.Colors.Orange,3.5);this.KneeImplantView.CleanImplant(a.Tibial_Component,n)}}}SetCISSAutomaticImplantsModeStatus(t){var e=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var n=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(e);var l=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(n);if(t){this.CISSAutomaticImplantsMode=true;var a=this.KneeImplantView.GetSelectProductLine();var r;var s;var h;var m;if(o){o.APOrthoImplantTibial.WasMoved=false;o.APOrthoImplantTibial.WasRotated=false;o.APOrthoImplantTibial.OffsetX=0;o.APOrthoImplantTibial.OffsetY=0;o.APOrthoImplantFemoral.WasMoved=false;o.APOrthoImplantFemoral.WasRotated=false;o.APOrthoImplantFemoral.OffsetX=0;o.APOrthoImplantFemoral.OffsetY=0;s=this.KneeImplantView.GetSelectTibialComponentFamily();r=this.KneeImplantView.GetSelectFemoralComponentFamily();m=this.KneeImplantView.GetUpDownTibialImplantSize();h=this.KneeImplantView.GetUpDownFemoralImplantSize();this.LoadSvgTibialOnViewport("AP",o,o.APOrthoImplantTibial,a,s,m,e,this.Edition);this.LoadSvgFemoralOnViewport("AP",o,o.APOrthoImplantFemoral,a,r,h,e,this.Edition)}if(l){l.MLOrthoImplantTibial.WasMoved=false;l.MLOrthoImplantTibial.WasRotated=false;l.MLOrthoImplantTibial.OffsetX=0;l.MLOrthoImplantTibial.OffsetY=0;l.MLOrthoImplantFemoral.WasMoved=false;l.MLOrthoImplantFemoral.WasRotated=false;l.MLOrthoImplantFemoral.OffsetX=0;l.MLOrthoImplantFemoral.OffsetY=0;s=this.KneeImplantView.GetSelectTibialComponentFamily();r=this.KneeImplantView.GetSelectFemoralComponentFamily();m=this.KneeImplantView.GetUpDownTibialImplantSize();h=this.KneeImplantView.GetUpDownFemoralImplantSize();this.LoadSvgTibialOnViewport("ML",l,l.MLOrthoImplantTibial,a,s,m,n,this.Edition);this.LoadSvgFemoralOnViewport("ML",l,l.MLOrthoImplantFemoral,a,r,h,n,this.Edition)}}else{this.CISSAutomaticImplantsMode=false}}ClearDataImplants(n){let o=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection2,"selectProductLine");o.htmlElement.selectedIndex=0;if(n===a.Femoral_Component){this.KneeImplantView.SetSelectFemoralComponentFamily(["--"],["--"],"--");this.KneeImplantView.SetUpDownFemoralImplantSize([new e.ValuesUD("-","-")],"");this.KneeImplantView.CleanImplant(n,null,true);this.DeleteImplantInformationSummary(t.ETemplateView.AP,n);this.DeleteImplantInformationSummary(t.ETemplateView.ML,n)}else if(n===a.Tibial_Component){this.KneeImplantView.SetSelectTibialComponentFamily(["--"],["--"],"--");this.KneeImplantView.SetUpDownTibialImplantSize([new e.ValuesUD("-","-")],"");this.KneeImplantView.CleanImplant(n,null,true);this.DeleteImplantInformationSummary(t.ETemplateView.AP,n);this.DeleteImplantInformationSummary(t.ETemplateView.ML,n)}}DeleteImplantInformationSummary(e,n,o=true){if(e===t.ETemplateView.AP){if(n===a.Femoral_Component){delete this.ActionsSummaryAPData["TitleAPFemoral"];delete this.ActionsSummaryAPData["CodeManufacturerAPFemoral"];delete this.ActionsSummaryAPData["CodeProductLineAPFemoral"];delete this.ActionsSummaryAPData["CodeProductFamilyAPFemoral"];delete this.ActionsSummaryAPData["CodeSizeAPFemoral"];delete this.ActionsSummaryAPData["CodeRotationAPFemoral"]}else if(n===a.Tibial_Component){delete this.ActionsSummaryAPData["TitleAPTibial"];delete this.ActionsSummaryAPData["CodeManufacturerAPTibial"];delete this.ActionsSummaryAPData["CodeProductLineAPTibial"];delete this.ActionsSummaryAPData["CodeProductFamilyAPTibial"];delete this.ActionsSummaryAPData["CodeSizeAPTibial"];delete this.ActionsSummaryAPData["CodeRotationAPTibial"]}if(o)this.ShowSummary(t.ETemplateView.AP)}else if(e===t.ETemplateView.ML){if(n===a.Femoral_Component){delete this.ActionsSummaryMLData["TitleMLFemoral"];delete this.ActionsSummaryMLData["CodeManufacturerMLFemoral"];delete this.ActionsSummaryMLData["CodeProductLineMLFemoral"];delete this.ActionsSummaryMLData["CodeProductFamilyMLFemoral"];delete this.ActionsSummaryMLData["CodeSizeMLFemoral"];delete this.ActionsSummaryMLData["CodeRotationMLFemoral"]}else if(n===a.Tibial_Component){delete this.ActionsSummaryMLData["TitleMLTibial"];delete this.ActionsSummaryMLData["CodeManufacturerMLTibial"];delete this.ActionsSummaryMLData["CodeProductLineMLTibial"];delete this.ActionsSummaryMLData["CodeProductFamilyMLTibial"];delete this.ActionsSummaryMLData["CodeSizeMLTibial"];delete this.ActionsSummaryMLData["CodeRotationMLTibial"]}if(o)this.ShowSummary(t.ETemplateView.ML)}}AddImplantInformationToSummary(e,n,o){let l=o.ImplantManufacturer;let SetInformation=()=>{let r=this.GetImplantSizeName(o,n);let s=o.ImplantProductLine;let h=o.ImplantComponentFamily;if(e===t.ETemplateView.AP){if(n===a.Femoral_Component){if(l){this.ActionsSummaryAPData["TitleAPFemoral"]={Code:"TitleAPFemoral",Description:"Femoral Component"};this.ActionsSummaryAPData["CodeManufacturerAPFemoral"]={Code:"CodeManufacturerAPFemoral",Description:`Manufacturer: ${l}`};this.ActionsSummaryAPData["CodeProductLineAPFemoral"]={Code:"CodeProductLineAPFemoral",Description:`Product Line: ${s}`};this.ActionsSummaryAPData["CodeProductFamilyAPFemoral"]={Code:"CodeProductFamilyAPFemoral",Description:`Family: ${h}`};this.ActionsSummaryAPData["CodeSizeAPFemoral"]={Code:"CodeSizeAPFemoral",Description:`Size: ${r}`}}}else if(n===a.Tibial_Component){if(l){this.ActionsSummaryAPData["TitleAPTibial"]={Code:"TitleAPTibial",Description:"Tibial Component"};this.ActionsSummaryAPData["CodeManufacturerAPTibial"]={Code:"CodeManufacturerAPTibial",Description:`Manufacturer: ${l}`};this.ActionsSummaryAPData["CodeProductLineAPTibial"]={Code:"CodeProductLineAPTibial",Description:`Product Line: ${s}`};this.ActionsSummaryAPData["CodeProductFamilyAPTibial"]={Code:"CodeProductFamilyAPTibial",Description:`Family: ${h}`};this.ActionsSummaryAPData["CodeSizeAPTibial"]={Code:"CodeSizeAPTibial",Description:`Size: ${r}`}}}this.ShowSummary(t.ETemplateView.AP)}else if(e===t.ETemplateView.ML){if(n===a.Femoral_Component){if(l){this.ActionsSummaryMLData["TitleMLFemoral"]={Code:"TitleMLFemoral",Description:"Femoral Component"};this.ActionsSummaryMLData["CodeManufacturerMLFemoral"]={Code:"CodeManufacturerMLFemoral",Description:`Manufacturer: ${l}`};this.ActionsSummaryMLData["CodeProductLineMLFemoral"]={Code:"CodeProductLineMLFemoral",Description:`Product Line: ${s}`};this.ActionsSummaryMLData["CodeProductFamilyMLFemoral"]={Code:"CodeProductFamilyMLFemoral",Description:`Family: ${h}`};this.ActionsSummaryMLData["CodeSizeMLFemoral"]={Code:"CodeSizeMLFemoral",Description:`Size: ${r}`}}}else if(n===a.Tibial_Component){if(l){this.ActionsSummaryMLData["TitleMLTibial"]={Code:"TitleMLTibial",Description:"Tibial Component"};this.ActionsSummaryMLData["CodeManufacturerMLTibial"]={Code:"CodeManufacturerMLTibial",Description:`Manufacturer: ${l}`};this.ActionsSummaryMLData["CodeProductLineMLTibial"]={Code:"CodeProductLineMLTibial",Description:`Product Line: ${s}`};this.ActionsSummaryMLData["CodeProductFamilyMLTibial"]={Code:"CodeProductFamilyMLTibial",Description:`Family: ${h}`};this.ActionsSummaryMLData["CodeSizeMLTibial"]={Code:"CodeSizeMLTibial",Description:`Size: ${r}`}}}this.ShowSummary(t.ETemplateView.ML)}};if(this.implantFemoralLibrary){SetInformation()}else{this.GetImplantLibrary(n,l,(()=>{let t=n===a.Femoral_Component?a.Tibial_Component:a.Femoral_Component;this.GetImplantLibrary(t,l,(()=>{}));SetInformation()}))}}ShowSummary(e){let n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(this.KneeAnnotation){var o=this.APviewport?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var l=this.MLviewport?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var r=o?!this.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(o):null;var s=l?!this.Edition?l.CurrentAnnotation:l.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(l):null;if(r&&r.APOrthoImplantFemoral&&!r.APOrthoImplantFemoral.ImplantReadyForDraw){if(!r.APOrthoImplantFemoral.ImplantSize){this.DeleteImplantInformationSummary(t.ETemplateView.AP,a.Femoral_Component,false);this.DeleteImplantInformationSummary(t.ETemplateView.ML,a.Femoral_Component,false)}}if(s&&s.APOrthoImplantTibial&&!s.APOrthoImplantTibial.ImplantReadyForDraw){if(!s.APOrthoImplantTibial.ImplantSize){this.DeleteImplantInformationSummary(t.ETemplateView.AP,a.Tibial_Component,false);this.DeleteImplantInformationSummary(t.ETemplateView.ML,a.Tibial_Component,false)}}}if(e===t.ETemplateView.AP&&n===this.APviewport){this.KneeImplantView.BuildSummary(this.ActionsSummaryAPData)}else if(e===t.ETemplateView.ML&&n===this.MLviewport){this.KneeImplantView.BuildSummary(this.ActionsSummaryMLData)}}UpdateMeasures(e){try{if(e===t.ETemplateView.AP){this.ShowMessageForAP_WidthFemoralComponent(this.Edition);this.ShowMessageForAP_GetDistalFemoralJointLineShaftAngle(this.Edition);this.ShowMessageForAP_GetFemoralLateralResectionDepth(this.Edition);this.ShowMessageForAP_GetFemoralMedialResectionDepth(this.Edition);this.ShowMessageForAP_WidthTibialComponent(this.Edition);this.ShowMessageForAP_GetDistalTibialJointLineShaftAngle(this.Edition);this.ShowMessageForAP_GetTibialLateralResectionDepth(this.Edition);this.ShowMessageForAP_GetTibialMedialResectionDepth(this.Edition);this.KneeImplantView.BuildSummary(this.ActionsSummaryAPData)}}catch(t){}}GetSettingfavoriteImplant(){var t=this.Plugin.Controller.View.Platform.GetSetting("favoriteImplants");if(t!==null&&t!==undefined){try{t=e.Utils.DecodeBase64(t);var n=JSON.parse(t);this.DataFavoriteStruct=n}catch(t){}}}GetfavoriteImplant(t){var e=new Array;var n=this.DataFavoriteStruct;if(n!==null&&n!==undefined){try{this.DataFavoriteStruct.Favorites.forEach((n=>{n.Manufacturer.forEach((o=>{o.Groups.forEach((o=>{if(o.Name.toUpperCase()==="KNEE"){o.ProductLines.forEach((o=>{o.Types.forEach((o=>{if(o.Name.toUpperCase().match(t)){e.push(decodeURIComponent(n.Name))}}))}))}}))}))}))}catch(t){}}return e}LoadManufacturers(t){if(this.manufacturers.length<=0){this.Plugin.GetManufacturers((e=>{this.manufacturers=e;t(e)}))}else{t(this.manufacturers)}}ChangeLegSideForLoadData(){if(this.APviewport&&this.MLviewport){try{var t=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var n=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=!this.Edition?t.CurrentAnnotation:t.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(t);var r=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(n);var s;var h=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection2,"selectManufacturer");var m=false;try{if(o){s=o.APOrthoImplantFemoral.ImplantManufacturer||o.APOrthoImplantTibial.ImplantManufacturer;this.KneeImplantView.SetSelectProductLine([],[],null);this.KneeImplantView.SetSelectFemoralComponentFamily([],[],null);this.KneeImplantView.SetSelectTibialComponentFamily([],[],null);this.KneeImplantView.CleanImplant(a.Femoral_Component,"AP");this.KneeImplantView.CleanImplant(a.Tibial_Component,"AP");if(this.ActionKnee===l.InsertImplant){h.htmlElement.value=s;o.APOrthoImplantFemoral.ImplantManufacturer=s;o.APOrthoImplantTibial.ImplantManufacturer=s;this.implantFemoralLibrary=null;this.implantTibialLibrary=null;this.LoadDataPerManufacturer(s,true)}else{h.htmlElement.value="--"}m=true}}catch(t){e.Utils.DebugConsoleLog(t)}try{if(r){s=r.MLOrthoImplantFemoral.ImplantManufacturer||r.MLOrthoImplantTibial.ImplantManufacturer;this.KneeImplantView.SetSelectProductLine([],[],null);this.KneeImplantView.SetSelectFemoralComponentFamily([],[],null);this.KneeImplantView.SetSelectTibialComponentFamily([],[],null);this.KneeImplantView.CleanImplant(a.Femoral_Component,"ML");this.KneeImplantView.CleanImplant(a.Tibial_Component,"ML");if(this.ActionKnee===l.InsertImplant){h.htmlElement.value=s;r.MLOrthoImplantFemoral.ImplantManufacturer=s;r.MLOrthoImplantTibial.ImplantManufacturer=s;if(!m){this.implantFemoralLibrary=null;this.implantTibialLibrary=null;this.LoadDataPerManufacturer(s,true)}}else{h.htmlElement.value="--"}}}catch(t){e.Utils.DebugConsoleLog(t)}}catch(t){e.Utils.DebugConsoleLog(t)}}}LoadDataPerManufacturer(n,o,l){var r=this.KneeAnnotation.APContext===this.KneeAnnotation.Context?this.KneeAnnotation.APOrthoImplantFemoral:this.KneeAnnotation.MLOrthoImplantFemoral;var s=this.KneeAnnotation.APContext===this.KneeAnnotation.Context?this.KneeAnnotation.APOrthoImplantTibial:this.KneeAnnotation.MLOrthoImplantTibial;var proccess=()=>{var n;r=this.KneeAnnotation.APContext===this.KneeAnnotation.Context?this.KneeAnnotation.APOrthoImplantFemoral:this.KneeAnnotation.MLOrthoImplantFemoral;s=this.KneeAnnotation.APContext===this.KneeAnnotation.Context?this.KneeAnnotation.APOrthoImplantTibial:this.KneeAnnotation.MLOrthoImplantTibial;if(this.manufacturers&&(r.ImplantManufacturer||s.ImplantManufacturer)){var a=new Array;this.manufacturers.forEach((t=>a.push(t)));a.unshift("--");this.KneeImplantView.SetSelectManufacturer(a,a,(n=r.ImplantManufacturer)!==null&&n!==void 0?n:s.ImplantManufacturer)}if(r.ImplantProductLine&&!s.ImplantProductLine)s.ImplantProductLine=r.ImplantProductLine;else if(!r.ImplantProductLine&&s.ImplantProductLine)r.ImplantProductLine=s.ImplantProductLine;let h=this.implantFemoralLibrary.GetProductLineNames();let m=this.implantTibialLibrary.GetProductLineNames();var d=[...h,...m];d=d.filter(((t,e)=>d.indexOf(t)===e));this.KneeImplantView.SetSelectProductLine(d,d,r.ImplantProductLine);if(!o){var u=this.implantFemoralLibrary.GetFamilyNames(r.ImplantProductLine);this.KneeImplantView.SetSelectFemoralComponentFamily(u,u,r.ImplantComponentFamily)}if(!o&&r.ImplantSize!==null&&r.ImplantSize!==undefined){this.implantFemoralLibrary.GetFamilySizes(r.ImplantProductLine,r.ImplantComponentFamily,t.EBodySide[this.LegSide],"knee","Femoral Component",(t=>{var n=new Array;var o=new Array;for(var l=0;l<t.length;l++){if(o.find((e=>e.id===t[l].id))===undefined)o.push(t[l])}for(var a=0;a<o.length;a++){n.push(new e.ValuesUD(o[a].id,o[a].size))}this.KneeImplantView.SetUpDownFemoralImplantSize(n,r.ImplantSize);this.ControlActionUpDownFemoralSize(r.ImplantSize)}))}this.KneeImplantView.SetActionsFemoralSize();if(!o){var p=this.implantTibialLibrary.GetFamilyNames(s.ImplantProductLine);this.KneeImplantView.SetSelectTibialComponentFamily(p,p,s.ImplantComponentFamily)}if(!o&&s.ImplantSize!==null&&s.ImplantSize!==undefined){this.implantTibialLibrary.GetFamilySizes(s.ImplantProductLine,s.ImplantComponentFamily,t.EBodySide[this.LegSide],"knee","Tibial Component",(t=>{var n=new Array;var o=new Array;for(var l=0;l<t.length;l++){if(o.find((e=>e.id===t[l].id))===undefined)o.push(t[l])}for(var a=0;a<o.length;a++){n.push(new e.ValuesUD(o[a].id,o[a].size))}this.KneeImplantView.SetUpDownTibialImplantSize(n,s.ImplantSize);this.ControlActionUpDownTibialSize(s.ImplantSize)}))}this.KneeImplantView.SetActionsTibialSize();if(l)l()};if(!this.implantFemoralLibrary||n!==r.ImplantManufacturer){this.GetImplantLibrary(a.Femoral_Component,n,(()=>{this.GetImplantLibrary(a.Tibial_Component,n,proccess)}))}else{proccess()}}GetImplantLibrary(n,o,l){var r=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+o+"/groups/knee/families?patientSide="+t.EBodySide[this.LegSide]+"&ProductType="+a[n].replace("_"," ");if(o){t.ImplantLibraryReader.LoadImplantLibrary(r,(t=>{if(n===a.Femoral_Component)this.implantFemoralLibrary=t;else if(n===a.Tibial_Component)this.implantTibialLibrary=t;l()}))}else{l()}}OpenUIInsertImplant(t){this.ActionKnee=l.InsertImplant;this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"ImplantSection","","",this.Edition);if(this.APviewport||this.MLviewport){if(this.implantFemoralLibrary&&this.manufacturers.length>0){var n=this.APviewport&&this.APviewport.SelectViewport?this.KneeAnnotation.APOrthoImplantFemoral:this.KneeAnnotation.MLOrthoImplantFemoral;if(n.ImplantManufacturer&&!n.ImplantReadyForDraw){this.LoadDataPerManufacturer(n.ImplantManufacturer,false,t)}else{if(t)t()}return}this.LoadManufacturers((e=>{var n=this.APviewport&&this.APviewport.SelectViewport?this.KneeAnnotation.APOrthoImplantFemoral:this.KneeAnnotation.MLOrthoImplantFemoral;if(n){var o=new Array;e.forEach((t=>o.push(t)));o.unshift("--");this.KneeImplantView.SetSelectManufacturer(o,o,n.ImplantManufacturer);if(n.ImplantManufacturer){this.LoadDataPerManufacturer(n.ImplantManufacturer,false,t)}}}))}else{e.Toaster.ShowToast("Enter the annotation points.",e.Colors.Orange,3)}}FillManufacturerList(t){if(this.manufacturers.length===0){this.LoadManufacturers((e=>{var n=this.APviewport.SelectViewport?this.KneeAnnotation.APOrthoImplantFemoral:this.KneeAnnotation.MLOrthoImplantFemoral;var o=new Array;e.forEach((t=>o.push(t)));o.unshift("--");this.KneeImplantView.SetSelectManufacturer(o,o,n.ImplantManufacturer);t()}))}else{t()}}ControlActionUpDownFemoralSize(e){var n=this.KneeImplantView.GetSelectProductLine();var o=this.KneeImplantView.GetSelectFemoralComponentFamily();var l=e;this.implantFemoralLibrary.GetFamilySizes(n,o,t.EBodySide[this.LegSide],"knee","Femoral Component",(t=>{var e=t.filter((t=>t.id===l))[0];var a=this.APviewport?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var r=this.MLviewport?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var s=a?!this.Edition?a.CurrentAnnotation:a.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(a):null;var h=r?!this.Edition?r.CurrentAnnotation:r.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(r):null;if(s)this.LoadSvgFemoralOnViewport("AP",s,s.APOrthoImplantFemoral,n,o,l,a,this.Edition);if(h)this.LoadSvgFemoralOnViewport("ML",h,h.MLOrthoImplantFemoral,n,o,l,r,this.Edition)}))}ControlActionUpDownTibialSize(e){var n=this.KneeImplantView.GetSelectProductLine();var o=this.KneeImplantView.GetSelectTibialComponentFamily();var l=e;this.implantTibialLibrary.GetFamilySizes(n,o,t.EBodySide[this.LegSide],"knee","Tibial Component",(t=>{var e=t.filter((t=>t.id===l))[0];var a=this.APviewport?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var r=this.MLviewport?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var s=a?!this.Edition?a.CurrentAnnotation:a.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(a):null;var h=r?!this.Edition?r.CurrentAnnotation:r.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(r):null;if(s)this.LoadSvgTibialOnViewport("AP",s,s.APOrthoImplantTibial,n,o,l,a,this.Edition);if(h)this.LoadSvgTibialOnViewport("ML",h,h.MLOrthoImplantTibial,n,o,l,r,this.Edition)}))}ShowTextAndControl(t,e,n,o,l,a,r){if(this.KneeAnnotation!==null&&this.KneeAnnotation!==undefined)this.KneeAnnotation.CanDragPoint=true;this.IsTabMenu=false;this.Controller.TopBarElement.PostActionShow=()=>{};this.KneeImplantView.OrthoFloatingBar.BuildForm(e,[n]);this.KneeImplantView.ShowValueLabel(t,o,l,r);this.KneeImplantView.ControlStatusMainButtons();this.KneeImplantView.ControlUI();this.KneeImplantView.ControlButtonsMainWindow(this.ActionKnee)}WriteActionSummaryDataForEdition(){let e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);let n=e.RendererPlugins[this.Plugin.PluginName];let o=n.Context.ImageEntity["pixelSpacing"][2];let l=n.Context.ImageEntity["pixelSpacing"][0];let r=n.Context.ImageEntity["pixelSpacing"][1];let s=l||r;let h=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;if(!h){var m=e.Annotations[this.Plugin.PluginName];m.forEach((e=>{if(e.Id===this.KneeAnnotation.Id&&e instanceof t.KneeImplantAnnotation){h=e}}))}n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();if(this.APviewport&&e===this.APviewport){let e=Math.round(h.GetAPDimension());if(!isNaN(e)){try{this.ActionsSummaryAPData["Code03"]={Code:"Code03",Description:"The width of femoral component calculated is "+Math.round(h.GetDistanceWidthFemoralComponent())+" "+o};this.ActionsSummaryAPData["CodeWithTibialDistance"]={Code:"CodeWithTibialDistance",Description:"The width of tibial component calculated is "+Math.round(h.GetDistanceWidthTibialComponent())+" "+o};this.ActionsSummaryAPData["CodeFResect"]={Code:"CodeFResect",Description:"Distal femoral joint-line/shaft angle: "+Math.round(h.GetDistalFemoralJointLineShaftAngle())+"°"};this.ActionsSummaryAPData["CodeTResect"]={Code:"CodeTResect",Description:"Distal tibial joint-line/shaft angle: "+Math.round(h.GetDistalTibialJointLineShaftAngle())+"°"};this.ActionsSummaryAPData["CodeTibialLateralResect"]={Code:"CodeTibialLateralResect",Description:"Tibial lateral resection depth: "+Math.round(h.GetTibialLateralResectionDepth())+" "+o};this.ActionsSummaryAPData["CodeTibialMedialResect"]={Code:"CodeTibialMedialResect",Description:"Tibial medial resection depth: "+Math.round(h.GetTibialMedialResectionDepth())+" "+o};this.AddImplantInformationToSummary(t.ETemplateView.AP,a.Femoral_Component,h.APOrthoImplantFemoral);this.AddImplantInformationToSummary(t.ETemplateView.AP,a.Tibial_Component,h.APOrthoImplantTibial)}catch(t){}}else{try{this.AddImplantInformationToSummary(t.ETemplateView.AP,a.Femoral_Component,h.APOrthoImplantFemoral);this.AddImplantInformationToSummary(t.ETemplateView.AP,a.Tibial_Component,h.APOrthoImplantTibial)}catch(t){}}if(h.APOrthoImplantFemoral.ImplantReadyForDraw)this.ActionsSummaryAPData["CodeRotationAPFemoral"]={Code:"CodeRotationAPFemoral",Description:`Femoral Rotation: ${Math.round(h.APOrthoImplantFemoral.Rotation)} deg`};if(h.APOrthoImplantTibial.ImplantReadyForDraw)this.ActionsSummaryAPData["CodeRotationAPTibial"]={Code:"CodeRotationAPTibial",Description:`Tibial Rotation: ${Math.round(h.APOrthoImplantTibial.Rotation)} deg`};this.ShowSummary(t.ETemplateView.AP)}else if(this.MLviewport&&e===this.MLviewport){let e=Math.round(h.GetAPDimension());let n=Math.round(h.GetMLTibialSlopeAngle());if(!isNaN(e)){try{this.ActionsSummaryMLData["Code04"]={Code:"Code04",Description:"The distance from condyles to femoral anterior cortical line is "+e+" "+o};this.ActionsSummaryMLData["Code06"]={Code:"Code06",Description:"The tibial slope calculated is "+n+"°"};this.AddImplantInformationToSummary(t.ETemplateView.ML,a.Femoral_Component,h.MLOrthoImplantFemoral);this.AddImplantInformationToSummary(t.ETemplateView.ML,a.Tibial_Component,h.MLOrthoImplantTibial)}catch(t){}}else{try{this.AddImplantInformationToSummary(t.ETemplateView.ML,a.Femoral_Component,h.MLOrthoImplantFemoral);this.AddImplantInformationToSummary(t.ETemplateView.ML,a.Tibial_Component,h.MLOrthoImplantTibial)}catch(t){}}if(h.MLOrthoImplantFemoral.ImplantReadyForDraw)this.ActionsSummaryMLData["CodeRotationMLFemoral"]={Code:"CodeRotationMLFemoral",Description:`Femoral Rotation: ${Math.round(h.MLOrthoImplantFemoral.Rotation)} deg`};if(h.MLOrthoImplantTibial.ImplantReadyForDraw)this.ActionsSummaryMLData["CodeRotationMLTibial"]={Code:"CodeRotationMLTibial",Description:`Tibial Rotation: ${Math.round(h.MLOrthoImplantTibial.Rotation)} deg`};this.ShowSummary(t.ETemplateView.ML)}}ShowMessageForAP_WidthFemoralComponent(n){try{var l=this.APviewport.RendererPlugins[this.Plugin.PluginName];var a=!n?l.CurrentAnnotation.Points:l.LastAnnotationCreatedOrSelected.Points;var r=!n?l.CurrentAnnotation:l.LastAnnotationCreatedOrSelected;var s=l.Context.ImageEntity["pixelSpacing"][2];if(l.Context.AnnotationController.GroupIsSatisfied(l.Context.AnnotationController.Template.Groups["AP_WidthFemoralComponent"])){var h=o.Geometry.GetDistanceCalibrate(a["AP_WidthFemoralComponent"][2],a["AP_WidthFemoralComponent"][3],l.Context);r.SetDistanceWidthFemoralComponent(h);this.ActionsSummaryAPData["Code03"]={Code:"Code03",Description:"The width of femoral component calculated is "+Math.round(r.GetDistanceWidthFemoralComponent())+" "+s};this.ShowSummary(t.ETemplateView.AP);this.KneeImplantView.ShowMessageForAP_WidthFemoralComponent(h,n)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForAP_WidthTibialComponent(n){try{var l=this.APviewport.RendererPlugins[this.Plugin.PluginName];var a=!n?l.CurrentAnnotation.Points:l.LastAnnotationCreatedOrSelected.Points;var r=!n?l.CurrentAnnotation:l.LastAnnotationCreatedOrSelected;var s=l.Context.ImageEntity["pixelSpacing"][2];if(l.Context.AnnotationController.GroupIsComplete(l.Context.AnnotationController.Template.Groups["AP_WidthTibialComponent"])){var h=o.Geometry.GetDistanceCalibrate(a["AP_WidthTibialComponent"][2],a["AP_WidthTibialComponent"][4],l.Context);r.SetDistanceWidthTibialComponent(h);this.ActionsSummaryAPData["CodeWithTibialDistance"]={Code:"CodeWithTibialDistance",Description:"The width of tibial component calculated is "+Math.round(r.GetDistanceWidthTibialComponent())+" "+s};this.ShowSummary(t.ETemplateView.AP);this.KneeImplantView.ShowMessageForAP_WidthTibialComponent(h,n)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForAP_GetDistalFemoralJointLineShaftAngle(n){try{var o=this.APviewport.RendererPlugins[this.Plugin.PluginName];var l=!n?o.CurrentAnnotation.Points:o.LastAnnotationCreatedOrSelected.Points;var a=!n?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;if(o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["AP_WidthFemoralComponent"])){o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();this.ActionsSummaryAPData["CodeFResect"]={Code:"CodeFResect",Description:"Distal femoral joint-line/shaft angle: "+Math.round(a.GetDistalFemoralJointLineShaftAngle())+"°"};this.ShowSummary(t.ETemplateView.AP)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForAP_GetDistalTibialJointLineShaftAngle(n){try{var o=this.APviewport.RendererPlugins[this.Plugin.PluginName];var l=!n?o.CurrentAnnotation.Points:o.LastAnnotationCreatedOrSelected.Points;var a=!n?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;if(o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["AP_WidthTibialComponent"])){this.ActionsSummaryAPData["CodeTResect"]={Code:"CodeTResect",Description:"Distal tibial joint-line/shaft angle: "+Math.round(a.GetDistalTibialJointLineShaftAngle())+"°"};this.ShowSummary(t.ETemplateView.AP)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForAP_GetFemoralLateralResectionDepth(n){try{var o=this.APviewport.RendererPlugins[this.Plugin.PluginName];var l=!n?o.CurrentAnnotation.Points:o.LastAnnotationCreatedOrSelected.Points;var a=!n?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;if(o.Context.AnnotationController.GroupIsComplete(o.Context.AnnotationController.Template.Groups["AP_FemoralResection"])&&a.Points["AP_WidthFemoralComponent"].length>=2){o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();this.ShowSummary(t.ETemplateView.AP)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForAP_GetFemoralMedialResectionDepth(n){try{var o=this.APviewport.RendererPlugins[this.Plugin.PluginName];var l=!n?o.CurrentAnnotation.Points:o.LastAnnotationCreatedOrSelected.Points;var a=!n?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;if(o.Context.AnnotationController.GroupIsComplete(o.Context.AnnotationController.Template.Groups["AP_FemoralResection"])&&a.Points["AP_WidthFemoralComponent"].length>=2){this.ShowSummary(t.ETemplateView.AP)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForAP_GetTibialLateralResectionDepth(n){try{var o=this.APviewport.RendererPlugins[this.Plugin.PluginName];var l=!n?o.CurrentAnnotation.Points:o.LastAnnotationCreatedOrSelected.Points;var a=!n?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;var r=o.Context.ImageEntity["pixelSpacing"][2];if(o.Context.AnnotationController.GroupIsComplete(o.Context.AnnotationController.Template.Groups["AP_TibialResection"])&&a.Points["AP_WidthTibialComponent"].length>=2){o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();this.ActionsSummaryAPData["CodeTibialLateralResect"]={Code:"CodeTibialLateralResect",Description:"Tibial lateral resection depth: "+Math.round(a.GetTibialLateralResectionDepth())+" "+r};this.ShowSummary(t.ETemplateView.AP)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForAP_GetTibialMedialResectionDepth(n){try{var o=this.APviewport.RendererPlugins[this.Plugin.PluginName];var l=!n?o.CurrentAnnotation.Points:o.LastAnnotationCreatedOrSelected.Points;var a=!n?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;var r=o.Context.ImageEntity["pixelSpacing"][2];if(o.Context.AnnotationController.GroupIsComplete(o.Context.AnnotationController.Template.Groups["AP_TibialResection"])&&a.Points["AP_WidthTibialComponent"].length>=2){o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();this.ActionsSummaryAPData["CodeTibialMedialResect"]={Code:"CodeTibialMedialResect",Description:"Tibial medial resection depth: "+Math.round(a.GetTibialMedialResectionDepth())+" "+r};this.ShowSummary(t.ETemplateView.AP)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForML_TextMLFemoralDistance(n){try{var o=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var l=!n?o.CurrentAnnotation.Points:o.LastAnnotationCreatedOrSelected.Points;var a=!n?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;var r=o.Context.ImageEntity["pixelSpacing"][2];this.MLviewport.Context.Renderer.Render();this.MLviewport.Context.OverlayRenderer.Render();var s=a.GetAPDimension();var h=Math.round(s);if(!isNaN(s)&&s){this.ActionsSummaryMLData["Code04"]={Code:"Code04",Description:"The distance from condyles to femoral anterior cortical line is "+h+" "+r};this.ShowSummary(t.ETemplateView.ML);this.KneeImplantView.ShowMessageForML_TextMLFemoralDistance(h,n)}else{this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralFitLineSection","TextFemoralFitLine","ML_AnteriorFemoralCorticalLine",this.Edition)}}catch(t){e.Utils.DebugConsoleLog(t)}}ShowMessageForML_TextMLTibialAngle(n){try{var o=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var l=!n?o.CurrentAnnotation.Points:o.LastAnnotationCreatedOrSelected.Points;var a=!n?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;var r=o.Context.ImageEntity["pixelSpacing"][2];this.MLviewport.Context.Renderer.Render();this.MLviewport.Context.OverlayRenderer.Render();if(o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["ML_TibialImplantDimension"])){var s=Math.round(a.GetMLTibialSlopeAngle());this.ActionsSummaryMLData["Code06"]={Code:"Code06",Description:"The tibial slope calculated is "+s+"°"};this.ShowSummary(t.ETemplateView.ML);this.KneeImplantView.ShowMessageForML_TextMLTibialAngle(s,n)}}catch(t){e.Utils.DebugConsoleLog(t)}}CancelInsertImplants(){var t=this.Plugin.Controller.GetSelectViewport(this.Plugin.Controller.ViewportPane);if(t){if(t===this.APviewport){if(this.KneeImplantView["orthoToolWindow"].MainSection.parentElement)this.KneeImplantView.ActionApButton(false)}else if(t===this.MLviewport){if(this.KneeImplantView["orthoToolWindow"].MainSection.parentElement)this.KneeImplantView.ActionMlButton(false)}this.ClearDataImplants(a.Femoral_Component);this.ClearDataImplants(a.Tibial_Component)}}SaveAnnotation(n){var l,a,r,s,h,m;try{var d;var u;d=this.APviewport.RendererPlugins[this.Plugin.PluginName];u=this.MLviewport.RendererPlugins[this.Plugin.PluginName];let C=d.Context.AnnotationController.GroupIsComplete(d.Context.AnnotationController.Template.Groups["AP_WidthFemoralComponent"]);let S=d.Context.AnnotationController.GroupIsComplete(d.Context.AnnotationController.Template.Groups["AP_FemoralResection"]);let g=d.Context.AnnotationController.GroupIsComplete(d.Context.AnnotationController.Template.Groups["AP_WidthTibialComponent"]);let I=d.Context.AnnotationController.GroupIsComplete(d.Context.AnnotationController.Template.Groups["AP_TibialResection"]);let P=u.Context.AnnotationController.GroupIsComplete(u.Context.AnnotationController.Template.Groups["ML_AnteriorFemoralCorticalLine"]);let f=u.Context.AnnotationController.GroupIsComplete(u.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"]);let w=u.Context.AnnotationController.GroupIsComplete(u.Context.AnnotationController.Template.Groups["ML_TibialImplantDimension"]);let b=((l=d.CurrentAnnotation)!==null&&l!==void 0?l:d.LastAnnotationCreatedOrSelected).APOrthoImplantFemoral.ImplantReadyForDraw;let v=((a=d.CurrentAnnotation)!==null&&a!==void 0?a:d.LastAnnotationCreatedOrSelected).APOrthoImplantTibial.ImplantReadyForDraw;let T=((r=u.CurrentAnnotation)!==null&&r!==void 0?r:u.LastAnnotationCreatedOrSelected).MLOrthoImplantFemoral.ImplantReadyForDraw;let F=((s=u.CurrentAnnotation)!==null&&s!==void 0?s:u.LastAnnotationCreatedOrSelected).MLOrthoImplantTibial.ImplantReadyForDraw;if(C&&S&&g&&I&&P&&f&&w||b&&v||T&&F){((h=d.CurrentAnnotation)!==null&&h!==void 0?h:d.LastAnnotationCreatedOrSelected).Status=o.EAnnotationStatus.Complete;((m=u.CurrentAnnotation)!==null&&m!==void 0?m:u.LastAnnotationCreatedOrSelected).Status=o.EAnnotationStatus.Complete}if(!this.Edition){d.CurrentAnnotation.Selected=true;d.CurrentAnnotation.Visible=true;Object.keys(d.CurrentAnnotation).forEach((e=>{if(d.CurrentAnnotation[e]instanceof t.OrthoTemplate){if(d.CurrentAnnotation[e]){d.CurrentAnnotation[e].Hover=false;d.CurrentAnnotation[e].Selected=false}}}));Object.keys(u.CurrentAnnotation).forEach((e=>{if(u.CurrentAnnotation[e]instanceof t.OrthoTemplate){if(u.CurrentAnnotation[e]){u.CurrentAnnotation[e].Hover=false;u.CurrentAnnotation[e].Selected=false}}}));u.CurrentAnnotation.Selected=true;u.CurrentAnnotation.Visible=true;d.Annotations.push(d.CurrentAnnotation);u.Annotations.push(u.CurrentAnnotation);d.LastAnnotationCreatedOrSelected=d.CurrentAnnotation;u.LastAnnotationCreatedOrSelected=u.CurrentAnnotation;this.Plugin.AnnotationKneeDone(this.APviewport,this.MLviewport);this.Edition=true;this.Plugin.Controller.View.Platform.Toolbar.DeselectAllButtons();this.Controller.SelectDefaultTool();if(n)n()}else{this.KneeAnnotation.Selected=true;this.KneeAnnotation.Visible=true;var searchAnnotationInViewportPerId=(e,n)=>{var o=null;var l;if(e===t.ETemplateView.AP)l=this.MLviewport;else l=this.APviewport;if(l){l.Annotations[this.Plugin.PluginName].forEach((t=>{if(t.Id===n)o=t}))}return o};var p=this.Plugin.Controller.GetSelectViewport(this.Plugin.Controller.ViewportPane);if(p===this.APviewport){d=this.APviewport.RendererPlugins[this.Plugin.PluginName];Object.keys(this.KneeAnnotation).forEach((e=>{if(this.KneeAnnotation[e]instanceof t.OrthoTemplate){if(this.KneeAnnotation[e]){this.KneeAnnotation[e].Hover=false;this.KneeAnnotation[e].Selected=false}}}));var c=searchAnnotationInViewportPerId(t.ETemplateView.AP,this.KneeAnnotation.Id);if(c!==null){c.Visible=true;this.KneeAnnotation.MLOrthoImplantFemoral=c.MLOrthoImplantFemoral;this.KneeAnnotation.MLOrthoImplantTibial=c.MLOrthoImplantTibial;this.MLviewport.Context.Renderer.Render();this.MLviewport.Context.OverlayRenderer.Render()}}else if(p===this.MLviewport){u=this.MLviewport.RendererPlugins[this.Plugin.PluginName];Object.keys(this.KneeAnnotation).forEach((e=>{if(this.KneeAnnotation[e]instanceof t.OrthoTemplate){if(this.KneeAnnotation[e]){this.KneeAnnotation[e].Hover=false;this.KneeAnnotation[e].Selected=false}}}));var A=searchAnnotationInViewportPerId(t.ETemplateView.ML,this.KneeAnnotation.Id);if(A!==null){A.Visible=true;this.KneeAnnotation.APOrthoImplantFemoral=A.APOrthoImplantFemoral;this.KneeAnnotation.APOrthoImplantTibial=A.APOrthoImplantTibial;this.APviewport.Context.Renderer.Render();this.APviewport.Context.OverlayRenderer.Render()}}if(this.KneeImplantView.IdDefault!==t.ETemplateView[t.ETemplateView.AP]&&this.KneeImplantView.IdDefault!==t.ETemplateView[t.ETemplateView.ML]){if(p===this.APviewport)this.KneeImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];else if(p===this.MLviewport)this.KneeImplantView.IdDefault=t.ETemplateView[t.ETemplateView.ML]}const annotationDoneCallback=()=>{e.Toaster.ShowToast("Last changes were saved.",e.Colors.Emerald,5)};if(this.KneeImplantView.IdDefault===t.ETemplateView[t.ETemplateView.AP]){d=this.APviewport.RendererPlugins[this.Plugin.PluginName];d.CurrentAnnotation=this.KneeAnnotation;this.Plugin.AnnotationDone(this.APviewport,annotationDoneCallback)}else if(this.KneeImplantView.IdDefault===t.ETemplateView[t.ETemplateView.ML]){u=this.MLviewport.RendererPlugins[this.Plugin.PluginName];u.CurrentAnnotation=this.KneeAnnotation;this.Plugin.AnnotationDone(this.MLviewport,annotationDoneCallback)}this.Controller.SelectDefaultTool();if(n)n()}}catch(t){if(!this.Edition)e.Toaster.ShowToast("The annotation does not meet the minimum requirements to be saved.",e.Colors.GreenSea,5)}}ResetActionsDraw(t,e){var n=e.RendererPlugins[this.Plugin.PluginName];this.StatusDraw=false;if(n.Context.AnnotationController){if(n.Context.AnnotationController.CurrentGroup&&t!==n.Context.AnnotationController.CurrentGroup.GroupName){if(!n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups[n.Context.AnnotationController.CurrentGroup.GroupName])){n.Context.AnnotationController.ResetOnlyCurrentGroup();n.Context.AnnotationController.CurrentGroup=null;n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}}}this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default")}CancelAnnotation(n){var o=this.APviewport!==undefined&&this.APviewport!=null;var l=this.MLviewport!==undefined&&this.MLviewport!==null;if(!this.Edition){var a={Action:()=>{this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.KneeImplantView.OrthoFloatingBar.Id);this.KneeImplantView.OrthoFloatingBar=null;if(o)this.APviewport.RendererPlugins[this.Plugin.PluginName].CurrentAnnotation=null;if(l)this.MLviewport.RendererPlugins[this.Plugin.PluginName].CurrentAnnotation=null;this.Plugin.Menu.CancelKneeImplant();if(o){this.APviewport.Context.Renderer.Render();this.APviewport.Context.OverlayRenderer.Render()}if(l){this.MLviewport.Context.Renderer.Render();this.MLviewport.Context.OverlayRenderer.Render()}n.Controller.SelectDefaultTool();n=null;this.Plugin.KneeImplantController=null},Name:"Ok",Text:"Yes",Id:"btnOkCancelKneeImplant"};var r={Action:()=>{},Name:"Cancel",Text:"No",Id:"btnCancelCancelKneeImplant"};a.ClassNames=[t.ButtonClasses.SUCCESS];r.ClassNames=[t.ButtonClasses.CRITIC];var s=new e.MessageBox("Do you want to cancel the whole operation?",[a,r]);s.Show()}else{this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.KneeImplantView.OrthoFloatingBar.Id);this.KneeImplantView.OrthoFloatingBar=null;this.Plugin.Menu.CancelKneeImplant(this.KneeAnnotation);if(o){var h=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var m=!this.Edition?h.CurrentAnnotation:h.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(h);if(m){m.Visible=true;Object.keys(m).forEach((e=>{if(m[e]instanceof t.OrthoTemplate){if(m[e]){m[e].Hover=false;m[e].Selected=false}}}))}this.APviewport.Context.Renderer.Render();this.APviewport.Context.OverlayRenderer.Render()}if(l){var d=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var u=!this.Edition?d.CurrentAnnotation:d.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(d);if(u){u.Visible=true;Object.keys(u).forEach((e=>{if(u[e]instanceof t.OrthoTemplate){if(u[e]){u[e].Hover=false;u[e].Selected=false}}}))}this.MLviewport.Context.Renderer.Render();this.MLviewport.Context.OverlayRenderer.Render()}this.Controller.SelectDefaultTool();n=null;this.Plugin.KneeImplantController=null}}ReconstructorViewportReferences(t,e){var n=this.Plugin.Controller.GetSelectViewport(this.Plugin.Controller.ViewportPane);if(n.Id===(t===null||t===void 0?void 0:t.Id)){if(e==="AP")this.APviewport=n;else if(e==="ML")this.MLviewport=n}}ActionOkAPFemoralWithComponent(t){var n=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["AP_WidthFemoralComponent"])){this.StatusDraw=false;this.ActionKnee=l.APCalibration;t(o);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}else{e.Toaster.ShowToast("The group does not meet the minimum requirement.",e.Colors.PeterRiver,3.5)}}ActionCancelAPFemoralWithComponent(t){var e=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;if(e!==null){var n=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;if(this.Edition){this.ActionKnee=l.APCalibration;this.StatusDraw=false;t(n);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}else{this.ActionKnee=l.APCalibration;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("AP_WidthFemoralComponent");e.Context.AnnotationController.ResetCurrentGroup();t(n);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}else{this.ActionKnee=l.APCalibration;this.StatusDraw=false;t(n)}this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}ActionOkAPFemoralResection(t){var n=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["AP_FemoralResection"])){this.StatusDraw=false;this.ActionKnee=l.APCalibration;t(o);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}else{e.Toaster.ShowToast("The group does not meet the minimum requirement.",e.Colors.PeterRiver,3.5)}}ActionCancelAPFemoralResection(t){var e=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;if(e!==null){var n=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;if(this.Edition){this.ActionKnee=l.APCalibration;this.StatusDraw=false;t(n);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}else{this.ActionKnee=l.APCalibration;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("AP_FemoralResection");e.Context.AnnotationController.ResetCurrentGroup();t(n);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}else{this.ActionKnee=l.APCalibration;this.StatusDraw=false;t(n)}this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}ActionOkAPTibialResection(t){var n=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["AP_TibialResection"])){this.StatusDraw=false;this.ActionKnee=l.APCalibration;t(o);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}else{e.Toaster.ShowToast("The group does not meet the minimum requirement.",e.Colors.PeterRiver,3.5)}}ActionCancelAPTibialResection(t){var e=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;if(e!==null){var n=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;if(this.Edition){this.ActionKnee=l.APCalibration;this.StatusDraw=false;t(n);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}else{this.ActionKnee=l.APCalibration;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("AP_TibialResection");e.Context.AnnotationController.ResetCurrentGroup();t(n);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}else{this.ActionKnee=l.APCalibration;this.StatusDraw=false;t(n)}this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}ActionOkAPWithTibialComponent(t){var n=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;if(n.Context.AnnotationController.GroupIsSatisfied(n.Context.AnnotationController.Template.Groups["AP_WidthTibialComponent"])){this.ActionKnee=l.None;this.StatusDraw=false;var a=!this.Edition?n.CurrentAnnotation.Points:n.LastAnnotationCreatedOrSelected.Points;var r=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;t(o);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}else{e.Toaster.ShowToast("The group does not meet the minimum requirement.",e.Colors.PeterRiver,3.5)}}ActionCancelAPWithTibialComponent(t){var e=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var n=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;if(this.Edition){this.ActionKnee=l.APCalibration;this.StatusDraw=false;e.Context.AnnotationController.CurrentGroup=null;t(n);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}else{this.ActionKnee=l.APCalibration;this.StatusDraw=false;e.Context.AnnotationController.SetCurrentGroup("AP_WidthTibialComponent");e.Context.AnnotationController.ResetCurrentGroup();e.Context.AnnotationController.CurrentGroup=null;t(n);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition)}}ActionOKMLFemoralFitLine(t){var n=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var a=!this.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;if(o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["ML_AnteriorFemoralCorticalLine"])&&o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"])){this.ActionKnee=l.MLCalibration;this.StatusDraw=false;this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralFitLineSection","TextFemoralFitLine","ML_MostDistalCondylarPoint",false);t(a);try{n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}catch(t){}try{o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){}this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationMLSection","","",this.Edition)}else{e.Toaster.ShowToast("The current group is not complete.",e.Colors.PeterRiver,3.5)}}ActionCancelMLFemoralFitLine(t){var e=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var n=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;if(this.Edition){this.ActionKnee=l.MLCalibration;this.StatusDraw=false;n.Context.AnnotationController.CurrentGroup=null;t(o)}else{this.ActionKnee=l.MLCalibration;this.StatusDraw=false;n.Context.AnnotationController.SetCurrentGroup("ML_MostDistalCondylarPoint");n.Context.AnnotationController.ResetCurrentGroup();n.Context.AnnotationController.CurrentGroup=null;t(o)}try{e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}catch(t){}try{n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}catch(t){}this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationMLSection","","",this.Edition)}ActionOKMLTibialLongitudinalAxis(t){var n=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var a=!this.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;if(o.Context.AnnotationController.GroupIsSatisfied(o.Context.AnnotationController.Template.Groups["ML_TibialImplantDimension"])){this.ActionKnee=l.MLCalibration;this.StatusDraw=false;t(a);try{n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}catch(t){}try{o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){}this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationMLSection","","",this.Edition)}else{e.Toaster.ShowToast("The current group is not complete.",e.Colors.PeterRiver,3.5)}}ActionCancelMLTibialLongitudinalAxis(t){var e=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var n=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var o=!this.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;if(this.Edition){this.ActionKnee=l.MLCalibration;this.StatusDraw=false;n.Context.AnnotationController.CurrentGroup=null;t(o)}else{this.ActionKnee=l.MLCalibration;this.StatusDraw=false;n.Context.AnnotationController.SetCurrentGroup("ML_TibialImplantDimension");n.Context.AnnotationController.ResetCurrentGroup();n.Context.AnnotationController.CurrentGroup=null;t(o)}try{e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}catch(t){}try{n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}catch(t){}this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationMLSection","","",this.Edition)}ActionOkAPImplantAdjust(n){var o=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var a=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var r=!this.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;this.ActionKnee=l.APCalibration;this.ShowSummary(t.ETemplateView.AP);n(r,this.ActionKnee);this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition);let s=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection1,"BtnAP");s.htmlElement.click();try{o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){}try{a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}catch(t){}}ActionCancelAPImplantAdjust(n){var o=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var a=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var r=!this.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;if(!this.Edition)o.LastAnnotationCreatedOrSelected=null;this.ActionKnee=l.APCalibration;this.ShowSummary(t.ETemplateView.AP);n(r,this.ActionKnee);this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition);let s=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection1,"BtnAP");s.htmlElement.click();try{o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){}try{a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}catch(t){}}ActionOkMLImplantAdjust(n){var o=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var a=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var r=!this.Edition?a.CurrentAnnotation:a.LastAnnotationCreatedOrSelected;this.ActionKnee=l.MLCalibration;this.ShowSummary(t.ETemplateView.ML);n(r,this.ActionKnee);this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationMLSection","","",this.Edition);let s=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection1,"BtnML");s.htmlElement.click();try{o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){}try{a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}catch(t){}}ActionCancelMLImplantAdjust(n){var o=this.APviewport!==null&&this.APviewport!==undefined?this.APviewport.RendererPlugins[this.Plugin.PluginName]:null;var a=this.MLviewport!==null&&this.MLviewport!==undefined?this.MLviewport.RendererPlugins[this.Plugin.PluginName]:null;var r=!this.Edition?a.CurrentAnnotation:a.LastAnnotationCreatedOrSelected;if(!this.Edition)o.LastAnnotationCreatedOrSelected=null;this.ActionKnee=l.MLCalibration;this.ShowSummary(t.ETemplateView.ML);n(r,this.ActionKnee);this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationMLSection","","",this.Edition);let s=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection1,"BtnML");s.htmlElement.click();try{o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){}try{a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}catch(t){}}GetImplantSizeName(t,e){var n;try{var o=e===a.Femoral_Component?this.implantFemoralLibrary:this.implantTibialLibrary;var l=o.GetSizes(t.ImplantProductLine,t.ImplantComponentFamily);var r=l.filter((e=>e.id===t.ImplantSize))[0];n=r.size}catch(t){n=""}return n}ControlAdjustAPFemoralImplant(t){var e=this.APviewport.RendererPlugins[this.Plugin.PluginName];var n=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;var o=t.getAttribute("data-control");switch(o){case"rotate-cw":n.APOrthoImplantFemoral.Rotation=(n.APOrthoImplantFemoral.Rotation-1)%360;break;case"rotate-ccw":n.APOrthoImplantFemoral.Rotation=(n.APOrthoImplantFemoral.Rotation+1)%360;break;case"left-up":n.APOrthoImplantFemoral.OffsetX--;n.APOrthoImplantFemoral.OffsetY--;break;case"up-right":n.APOrthoImplantFemoral.OffsetX++;n.APOrthoImplantFemoral.OffsetY--;break;case"down-right":n.APOrthoImplantFemoral.OffsetX++;n.APOrthoImplantFemoral.OffsetY++;break;case"down-left":n.APOrthoImplantFemoral.OffsetX--;n.APOrthoImplantFemoral.OffsetY++;break;case"up":n.APOrthoImplantFemoral.OffsetY--;break;case"right":n.APOrthoImplantFemoral.OffsetX++;break;case"down":n.APOrthoImplantFemoral.OffsetY++;break;case"left":n.APOrthoImplantFemoral.OffsetX--;break;case"minus":this.UpdateFemoralMinusControl();break;case"plus":this.UpdateFemoralPlusControl();break}e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();this.KneeImplantView.UpdateUIAdjustAPFemoralImplant(n.APOrthoImplantFemoral)}UpdateFemoralMinusControl(){var t=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection2,"upDownFemoralImplantSize");var n=t.htmlElement["UpDownObject"];if(n.Index-1>=0){this.KneeImplantView.SetUpDownFemoralImplantSize(n.Items,null,n.Index-1);this.ControlActionUpDownFemoralSize(n.Item.Value)}}UpdateFemoralPlusControl(){var t=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection2,"upDownFemoralImplantSize");var n=t.htmlElement["UpDownObject"];if(n.Index+1<n.Items.length){this.KneeImplantView.SetUpDownFemoralImplantSize(n.Items,null,n.Index+1);this.ControlActionUpDownFemoralSize(n.Item.Value)}}UpdateTibialMinusControl(){var t=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection2,"upDownTibialImplantSize");var n=t.htmlElement["UpDownObject"];if(n.Index-1>=0){this.KneeImplantView.SetUpDownTibialImplantSize(n.Items,null,n.Index-1);this.ControlActionUpDownTibialSize(n.Item.Value)}}UpdateTibialPlusControl(){var t=e.Form.GetFieldFromForms(this.KneeImplantView.DataSection2,"upDownTibialImplantSize");var n=t.htmlElement["UpDownObject"];if(n.Index+1<n.Items.length){this.KneeImplantView.SetUpDownTibialImplantSize(n.Items,null,n.Index+1);this.ControlActionUpDownTibialSize(n.Item.Value)}}ControlAdjustAPTibialImplant(t){var e=this.APviewport.RendererPlugins[this.Plugin.PluginName];var n=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;var o=t.getAttribute("data-control");switch(o){case"rotate-cw":n.APOrthoImplantTibial.Rotation=(n.APOrthoImplantTibial.Rotation-1)%360;break;case"rotate-ccw":n.APOrthoImplantTibial.Rotation=(n.APOrthoImplantTibial.Rotation+1)%360;break;case"left-up":n.APOrthoImplantTibial.OffsetX--;n.APOrthoImplantTibial.OffsetY--;break;case"up-right":n.APOrthoImplantTibial.OffsetX++;n.APOrthoImplantTibial.OffsetY--;break;case"down-right":n.APOrthoImplantTibial.OffsetX++;n.APOrthoImplantTibial.OffsetY++;break;case"down-left":n.APOrthoImplantTibial.OffsetX--;n.APOrthoImplantTibial.OffsetY++;break;case"up":n.APOrthoImplantTibial.OffsetY--;break;case"right":n.APOrthoImplantTibial.OffsetX++;break;case"down":n.APOrthoImplantTibial.OffsetY++;break;case"left":n.APOrthoImplantTibial.OffsetX--;break;case"minus":this.UpdateTibialMinusControl();break;case"plus":this.UpdateTibialPlusControl();break}this.KneeImplantView.UpdateUIAdjustAPTibialImplant(n.APOrthoImplantTibial);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ControlAdjustMLFemoralImplant(t){var e=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var n=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;var o=t.getAttribute("data-control");switch(o){case"rotate-cw":n.MLOrthoImplantFemoral.Rotation=(n.MLOrthoImplantFemoral.Rotation-1)%360;break;case"rotate-ccw":n.MLOrthoImplantFemoral.Rotation=(n.MLOrthoImplantFemoral.Rotation+1)%360;break;case"left-up":n.MLOrthoImplantFemoral.OffsetX--;n.MLOrthoImplantFemoral.OffsetY--;break;case"up-right":n.MLOrthoImplantFemoral.OffsetX++;n.MLOrthoImplantFemoral.OffsetY--;break;case"down-right":n.MLOrthoImplantFemoral.OffsetX++;n.MLOrthoImplantFemoral.OffsetY++;break;case"down-left":n.MLOrthoImplantFemoral.OffsetX--;n.MLOrthoImplantFemoral.OffsetY++;break;case"up":n.MLOrthoImplantFemoral.OffsetY--;break;case"right":n.MLOrthoImplantFemoral.OffsetX++;break;case"down":n.MLOrthoImplantFemoral.OffsetY++;break;case"left":n.MLOrthoImplantFemoral.OffsetX--;break;case"minus":this.UpdateFemoralMinusControl();break;case"plus":this.UpdateFemoralPlusControl();break}this.KneeImplantView.UpdateUIAdjustMLFemoralImplant(n.MLOrthoImplantFemoral);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ControlAdjustMLTibialImplant(t){var e=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var n=!this.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;var o=t.getAttribute("data-control");switch(o){case"rotate-cw":n.MLOrthoImplantTibial.Rotation=(n.MLOrthoImplantTibial.Rotation-1)%360;break;case"rotate-ccw":n.MLOrthoImplantTibial.Rotation=(n.MLOrthoImplantTibial.Rotation+1)%360;break;case"left-up":n.MLOrthoImplantTibial.OffsetX--;n.MLOrthoImplantTibial.OffsetY--;break;case"up-right":n.MLOrthoImplantTibial.OffsetX++;n.MLOrthoImplantTibial.OffsetY--;break;case"down-right":n.MLOrthoImplantTibial.OffsetX++;n.MLOrthoImplantTibial.OffsetY++;break;case"down-left":n.MLOrthoImplantTibial.OffsetX--;n.MLOrthoImplantTibial.OffsetY++;break;case"up":n.MLOrthoImplantTibial.OffsetY--;break;case"right":n.MLOrthoImplantTibial.OffsetX++;break;case"down":n.MLOrthoImplantTibial.OffsetY++;break;case"left":n.MLOrthoImplantTibial.OffsetX--;break;case"minus":this.UpdateTibialMinusControl();break;case"plus":this.UpdateTibialPlusControl();break}this.KneeImplantView.UpdateUIAdjustMLTibialImplant(n.MLOrthoImplantTibial);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}ActionCalibrateAP(t){this.IsTabMenu=false;this.Plugin.CalibrationOptionFromMainMenu=false;this.Plugin.Menu.ProcessCalibrationToolEvent(null,"calibrationTool","eFit",t,this)}ActionFemoralWidthComponentAP(){if(this.APviewport!==null&&this.APviewport!==undefined){var t=this.APviewport.RendererPlugins[this.Plugin.PluginName];var e=t.Context.ImageEntity.IsCalibrated();if(e){this.ActionKnee=l.APFemoralWithComponent;if(t.Context.AnnotationController!==null&&t.Context.AnnotationController!==undefined)t.Context.AnnotationController.SetCurrentGroup("AP_WidthFemoralComponent");if(!this.Edition){this.StatusDraw=true;this.Edition=false;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralComponentSection","TextWidthFemoralComponent","AP_WidthFemoralComponent",this.Edition)}else{this.StatusDraw=true;this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralComponentSection","TextWidthFemoralComponent","AP_WidthFemoralComponent",this.Edition);this.ShowMessageForAP_WidthFemoralComponent(true);this.ShowMessageForAP_GetDistalFemoralJointLineShaftAngle(true)}}}else{if(!this.Edition){this.StatusDraw=true;this.ActionKnee=l.APFemoralWithComponent;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralComponentSection","TextWidthFemoralComponent","AP_WidthFemoralComponent",this.Edition)}}}ActionFemoralResectionAP(){if(this.APviewport!==null&&this.APviewport!==undefined){var t=this.APviewport.RendererPlugins[this.Plugin.PluginName];var e=t.Context.ImageEntity.IsCalibrated();if(e){this.ActionKnee=l.APFemoralResection;if(t.Context.AnnotationController!==null&&t.Context.AnnotationController!==undefined)t.Context.AnnotationController.SetCurrentGroup("AP_FemoralResection");if(!this.Edition){this.StatusDraw=true;this.Edition=false;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralResectionSection","TextAPFemoralResection","AP_FemoralResection",this.Edition)}else{this.StatusDraw=true;this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralResectionSection","TextAPFemoralResection","AP_FemoralResection",this.Edition);if(this.KneeAnnotation.Points["AP_WidthFemoralComponent"].length>=2){this.ShowMessageForAP_GetFemoralLateralResectionDepth(true);this.ShowMessageForAP_GetFemoralMedialResectionDepth(true)}}}}else{if(!this.Edition){this.StatusDraw=true;this.ActionKnee=l.APFemoralResection;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralResectionSection","TextAPFemoralResection","AP_FemoralResection",this.Edition)}}}ActionTibialResectionAP(t){if(this.APviewport!==null&&this.APviewport!==undefined){var e=this.APviewport.RendererPlugins[this.Plugin.PluginName];var n=e.Context.ImageEntity.IsCalibrated();if(n){this.ActionKnee=l.APTibialResection;if(e.Context.AnnotationController!==null&&e.Context.AnnotationController!==undefined)e.Context.AnnotationController.SetCurrentGroup("AP_TibialResection");if(!this.Edition){this.StatusDraw=true;if(t!==null&&t!==undefined)this.KneeAnnotation.CanDragPoint=true;this.Edition=false;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"TibialResectionSection","TextAPTibialResection","AP_TibialResection",this.Edition)}else{this.StatusDraw=true;this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"TibialResectionSection","TextAPTibialResection","AP_TibialResection",this.Edition);if(this.KneeAnnotation.Points["AP_WidthTibialComponent"]&&this.KneeAnnotation.Points["AP_WidthTibialComponent"].length===2){this.ShowMessageForAP_GetTibialLateralResectionDepth(true);this.ShowMessageForAP_GetTibialMedialResectionDepth(true)}}}}else{if(!this.Edition){this.ActionKnee=l.APTibialResection;this.StatusDraw=true;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"TibialResectionSection","TextAPTibialResection","AP_TibialResection",this.Edition)}}}ActionWidthTibialComponentAP(){if(this.APviewport!==null&&this.APviewport!==undefined){this.ActionKnee=l.APTibialWidthComponent;var t=this.APviewport.RendererPlugins[this.Plugin.PluginName];if(t.Context.AnnotationController!==null&&t.Context.AnnotationController!==undefined)t.Context.AnnotationController.SetCurrentGroup("AP_WidthTibialComponent");if(!this.Edition){this.StatusDraw=true;this.Edition=false;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"WidtTibialComponentSection","TextAPWidthTibialComponent","AP_WidthTibialComponent",this.Edition)}else{this.StatusDraw=true;this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"WidtTibialComponentSection","TextAPWidthTibialComponent","AP_WidthTibialComponent",this.Edition);this.ShowMessageForAP_WidthTibialComponent(true);this.ShowMessageForAP_GetDistalTibialJointLineShaftAngle(true)}}else{if(!this.Edition){this.ActionKnee=l.APTibialWidthComponent;this.StatusDraw=true;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"WidtTibialComponentSection","TextAPWidthTibialComponent","AP_WidthTibialComponent",this.Edition)}}}ActionAdjustAP(){this.KneeImplantView.BuildUIAdjustControl(t.ETemplateView.AP);this.ActionKnee=l.APImplantAdjust;this.ShowTextAndControl(1,this.KneeImplantView.OrthoElementsSection1,"APViewSection","","",this.Edition)}ActionCalibrateML(t){this.IsTabMenu=false;this.Plugin.CalibrationOptionFromMainMenu=false;this.Plugin.Menu.ProcessCalibrationToolEvent(null,"calibrationTool","eFit",t,this)}ActionFemoralFitLineML(){if(this.MLviewport!==null&&this.MLviewport!==undefined){var t=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var e=t.Context.ImageEntity.IsCalibrated();if(e){this.ActionKnee=l.MLFemoralFitLine;if(t.Context.AnnotationController)t.Context.AnnotationController.SetCurrentGroup("ML_AnteriorFemoralCorticalLine");this.StatusDraw=true;if(!this.Edition){this.Edition=false;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralFitLineSection","TextFemoralFitLine","ML_AnteriorFemoralCorticalLine",this.Edition)}else{this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralFitLineSection","TextFemoralFitLine","ML_AnteriorFemoralCorticalLine",this.Edition);this.ShowMessageForML_TextMLFemoralDistance(true)}}}else{if(!this.Edition){this.ActionKnee=l.MLFemoralFitLine;this.StatusDraw=true;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"FemoralFitLineSection","TextFemoralFitLine","ML_AnteriorFemoralCorticalLine",this.Edition)}}}ActionTibialLongitudinalAxisML(){if(this.MLviewport!==null&&this.MLviewport!==undefined){var t=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var e=t.Context.ImageEntity.IsCalibrated();if(e){this.ActionKnee=l.MLTibialLongitudinalAxis;this.StatusDraw=true;if(t.Context.AnnotationController)t.Context.AnnotationController.SetCurrentGroup("ML_TibialImplantDimension");if(!this.Edition){this.Edition=false;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"TibialLongitudinalAxisSection","TextMlTibialLongitudinalAxis","ML_TibialImplantDimension",this.Edition)}else{this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"TibialLongitudinalAxisSection","TextMlTibialLongitudinalAxis","ML_TibialImplantDimension",this.Edition);this.ShowMessageForML_TextMLTibialAngle(true)}}}else{if(!this.Edition){this.ActionKnee=l.MLTibialLongitudinalAxis;this.StatusDraw=true;this.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"TibialLongitudinalAxisSection","TextMlTibialLongitudinalAxis","ML_TibialImplantDimension",this.Edition)}}}ActionAdjustML(){this.KneeImplantView.BuildUIAdjustControl(t.ETemplateView.ML);this.ActionKnee=l.MLImplantAdjust;this.ShowTextAndControl(1,this.KneeImplantView.OrthoElementsSection1,"MLViewSection","","",this.Edition)}ActionProductLineFemoralInsertImplant(t){var n=this.KneeImplantView.GetSelectProductLine();var o=this.implantFemoralLibrary.GetFamilyNames(n);if(o!==undefined){this.KneeImplantView.SetSelectFemoralComponentFamily(o,o,t===undefined?"--":t)}else{this.KneeImplantView.SetSelectFemoralComponentFamily(["--"],["--"],"--")}var l=new Array;l.push(new e.ValuesUD("--","--"));this.KneeImplantView.SetUpDownFemoralImplantSize(l,null,0)}GetKneeAnnotationFromViewport(e){var n=null;for(var o=0;o<e.Annotations.length;o++){var l=e.Annotations[o];if(l instanceof t.KneeImplantAnnotation){n=l;break}}return n}ActionProductLineTibialInsertImplant(t){var n=this.KneeImplantView.GetSelectProductLine();var o=this.implantTibialLibrary.GetFamilyNames(n);if(o!==undefined){this.KneeImplantView.SetSelectTibialComponentFamily(o,o,t===undefined?"--":t)}else{this.KneeImplantView.SetSelectTibialComponentFamily(["--"],["--"],"--")}var l=new Array;l.push(new e.ValuesUD("--","--"));this.KneeImplantView.SetUpDownTibialImplantSize(l,null,0)}ActionFemoralComponentFamilyInsertImplant(){var n=this.KneeImplantView.GetSelectProductLine();var o=this.KneeImplantView.GetSelectFemoralComponentFamily();this.implantFemoralLibrary.GetFamilySizes(n,o,t.EBodySide[this.LegSide],"knee","Femoral Component",(t=>{var l=new Array;if(this.APviewport===undefined||this.MLviewport===undefined){this.KneeImplantView.ResetFavorite();this.KneeImplantView.ActionFavorite();e.Toaster.ShowToast("Draw the annotation before start.",e.Colors.GreenSea,5)}else{var a=this.APviewport.RendererPlugins[this.Plugin.PluginName];var r=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var s=!this.Edition?a.CurrentAnnotation:a.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(a);var h=!this.Edition?r.CurrentAnnotation:r.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(r);var m=new Array;for(var d=0;d<t.length;d++){if(m.find((e=>e.id===t[d].id))===undefined)m.push(t[d])}for(var u=0;u<m.length;u++){s.APOrthoImplantFemoral.svgPoints[m[u].id]=h.MLOrthoImplantFemoral.svgPoints[m[u].id]=new Array;l.push(new e.ValuesUD(m[u].id,m[u].size))}this.KneeImplantView.SetUpDownFemoralImplantSize(l,null,0);var p=l[0].Value;this.LoadSvgFemoralOnViewport("AP",s,s.APOrthoImplantFemoral,n,o,p,a,this.Edition);this.LoadSvgFemoralOnViewport("ML",h,h.MLOrthoImplantFemoral,n,o,p,r,this.Edition)}}))}ActionTibialComponentFamilyInsertImplant(){var n=this.KneeImplantView.GetSelectProductLine();var o=this.KneeImplantView.GetSelectTibialComponentFamily();this.implantTibialLibrary.GetFamilySizes(n,o,t.EBodySide[this.LegSide],"knee","Tibial Component",(t=>{if(this.APviewport===undefined||this.MLviewport===undefined){this.KneeImplantView.ResetFavorite();this.KneeImplantView.ActionFavorite();e.Toaster.ShowToast("Draw the annotation before start.",e.Colors.GreenSea,5)}else{var l=this.APviewport.RendererPlugins[this.Plugin.PluginName];var a=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var r=!this.Edition?l.CurrentAnnotation:l.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(l);var s=!this.Edition?a.CurrentAnnotation:a.LastAnnotationCreatedOrSelected||this.GetKneeAnnotationFromViewport(a);var h=new Array;var m=new Array;for(var d=0;d<t.length;d++){if(m.find((e=>e.id===t[d].id))===undefined)m.push(t[d])}for(var u=0;u<m.length;u++){r.APOrthoImplantTibial.svgPoints[m[u].id]=s.MLOrthoImplantTibial.svgPoints[m[u].id]=new Array;h.push(new e.ValuesUD(m[u].id,m[u].size))}this.KneeImplantView.SetUpDownTibialImplantSize(h,null,0);var p=h[0].Value;this.LoadSvgTibialOnViewport("AP",r,r.APOrthoImplantTibial,n,o,p,l,this.Edition);this.LoadSvgTibialOnViewport("ML",s,s.MLOrthoImplantTibial,n,o,p,a,this.Edition)}}))}AssingViewportToAPView(l){if(l===null){e.Toaster.ShowToast("Select a viewport.",e.Colors.Alizarin,5);if(this.APviewport===undefined&&this.MLviewport===undefined){this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.KneeImplantView.OrthoFloatingBar.Id);this.KneeImplantView.OrthoFloatingBar=null;this.Plugin.Menu.CancelKneeImplant(this.KneeAnnotation);this.Controller.SelectDefaultTool()}return}else{if(this.APviewport===undefined&&this.MLviewport!==undefined&&l===this.MLviewport){e.Toaster.ShowToast("This viewport already associated with the ML context.",e.Colors.Alizarin,5);return}else{if(this.APviewport===undefined&&this.ReadyForSelectedViewports){this.APviewport=l;e.Toaster.ShowToast("Viewport AP view selected",e.Colors.GreenSea,5);let n=this.KneeImplantView.ContainerViewSide.querySelector("#buttonSelectAPView");n.classList.remove(t.ButtonClasses.SUCCESS);n.classList.add(t.ButtonClasses.ENABLE);n.disabled=true;n.style.width="70px";n.style.position="relative";let o=s({style:{position:"absolute",bottom:"-1px",right:"1px",padding:"1px"},children:[c({width:12,height:12,src:t.ResourceBag.CheckedPng})]});n.appendChild(o);this.KneeImplantView.ValidateSelectedAPMLViewports()}else{if(!this.ReadyForSelectedViewports)return}if(!this.Edition){var a=this.APviewport.RendererPlugins[this.Plugin.PluginName];if(a.CurrentAnnotation!==null&&a.CurrentAnnotation!==undefined)this.KneeAnnotation=a.CurrentAnnotation}if(!this.APviewport.Context.AnnotationController)this.APviewport.Context.AnnotationController=new o.AnnotationController(this.KneeAnnotation);this.Controller.UnselectViewports(this.Controller.ViewportPane);this.APviewport.SelectViewport=true;this.APviewport.ViewportFrameElement.style.borderColor=e.Colors.Emerald;n.AddClass(this.APviewport.ViewportFrameElement,"SelectedViewport");if(this.KneeAnnotation!==null&&this.KneeAnnotation!==undefined){this.KneeAnnotation.APContext=this.APviewport.Context;this.KneeAnnotation.APImageGuid=this.APviewport.Context.ImageEntity.ImageGUID}}}}ControlTapAPView(n){this.ReconstructorViewportReferences(this.APviewport,"AP");if(this.APviewport!==undefined&&this.APviewport===n){var o=this.APviewport.RendererPlugins[this.Plugin.PluginName];var a=!this.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;try{if(this!==null&&this!==undefined&&this.ViewportsSelected){if(this.Plugin.Controller.ToolSelect==="Pointer"&&(this.APviewport.RendererPlugins[this.Plugin.PluginName].LastAnnotationCreatedOrSelected===undefined||this.APviewport.RendererPlugins[this.Plugin.PluginName].LastAnnotationCreatedOrSelected===null))return;if(this.KneeImplantView.DataSection2!==null&&this.Plugin.KneeImplantController!==null&&this.Plugin.Controller.ToolSelect==="OrthoAnnotationKneeImplant"){this.KneeImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];if(!this.StatusDraw){this.ActionKnee=l.APCalibration;this.KneeImplantView.ViewTab(a);try{this.KneeImplantView.ActionApButton(false)}catch(t){e.Utils.DebugConsoleLog(t)}}}}}catch(t){e.Utils.DebugConsoleLog("viewport Knee view AP error => "+t)}}}AssingViewportToMLView(l){if(l===null){e.Toaster.ShowToast("Select a viewport.",e.Colors.Alizarin,5);return}else{if(this.APviewport!==undefined&&this.MLviewport===undefined&&l===this.APviewport){e.Toaster.ShowToast("This viewport already associated with the AP context.",e.Colors.Alizarin,5);return}else{if(this.MLviewport===undefined&&this.ReadyForSelectedViewports){this.MLviewport=l;e.Toaster.ShowToast("Viewport Lateral view selected",e.Colors.GreenSea,5);let n=this.KneeImplantView.ContainerViewSide.querySelector("#buttonSelectMLView");n.classList.remove(t.ButtonClasses.SUCCESS);n.classList.add(t.ButtonClasses.ENABLE);n.disabled=true;n.style.width="70px";n.style.position="relative";let o=s({style:{position:"absolute",bottom:"-1px",right:"1px",padding:"1px"},children:[c({width:12,height:12,src:t.ResourceBag.CheckedPng})]});n.appendChild(o);this.KneeImplantView.ValidateSelectedAPMLViewports()}else{if(!this.ReadyForSelectedViewports)return}if(!this.Edition){var a=this.MLviewport.RendererPlugins[this.Plugin.PluginName];if(a.CurrentAnnotation!==null&&a.CurrentAnnotation!==undefined)this.KneeAnnotation=a.CurrentAnnotation}if(!this.MLviewport.Context.AnnotationController)this.MLviewport.Context.AnnotationController=new o.AnnotationController(this.KneeAnnotation);this.Controller.UnselectViewports(this.Controller.ViewportPane);this.MLviewport.SelectViewport=true;this.MLviewport.ViewportFrameElement.style.borderColor=e.Colors.Emerald;n.AddClass(this.MLviewport.ViewportFrameElement,"SelectedViewport");if(this.KneeAnnotation!==null&&this.KneeAnnotation!==undefined){this.KneeAnnotation.MLContext=this.MLviewport.Context;this.KneeAnnotation.MLImageGuid=this.MLviewport.Context.ImageEntity.ImageGUID}}}}ControlTapMLView(n){this.ReconstructorViewportReferences(this.MLviewport,"ML");if(this.MLviewport!==undefined&&this.MLviewport===n){var o=this.MLviewport.RendererPlugins[this.Plugin.PluginName];var a=!this.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;try{if(this!==null&&this!==undefined&&this.ViewportsSelected){if(this.Plugin.Controller.ToolSelect==="Pointer"&&(this.MLviewport.RendererPlugins[this.Plugin.PluginName].LastAnnotationCreatedOrSelected===undefined||this.MLviewport.RendererPlugins[this.Plugin.PluginName].LastAnnotationCreatedOrSelected===null))return;if(this.KneeImplantView.DataSection2!==null&&this.Plugin.KneeImplantController!==null&&this.Plugin.Controller.ToolSelect==="OrthoAnnotationKneeImplant"){this.KneeImplantView.IdDefault=t.ETemplateView[t.ETemplateView.ML];if(!this.StatusDraw){this.ActionKnee=l.MLCalibration;this.KneeImplantView.ViewTab(a);try{this.KneeImplantView.ActionMlButton(false)}catch(t){e.Utils.DebugConsoleLog(t)}}}}}catch(t){e.Utils.DebugConsoleLog("viewport Knee view ML error => "+t)}}}ActionControlTabAP(e){this.IsTabMenu=true;this.ActionKnee=l.APCalibration;this.StatusDraw=false;this.KneeImplantView.OrthoFloatingBar.BuildForm(this.KneeImplantView.OrthoElementsSection1,["APViewSection"]);this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationAPSection","","",this.Edition);if(this.APviewport!==null&&this.APviewport!==undefined)this.AssingViewportToAPView(this.APviewport);e();this.ShowSummary(t.ETemplateView.AP)}ActionControlTabML(e){this.IsTabMenu=true;this.ActionKnee=l.MLCalibration;this.KneeImplantView.OrthoFloatingBar.BuildForm(this.KneeImplantView.OrthoElementsSection1,["MLViewSection"]);this.ShowTextAndControl(2,this.KneeImplantView.OrthoElementsSection2,"CalibrationMLSection","","",this.Edition);if(this.MLviewport!==null&&this.MLviewport!==undefined)this.AssingViewportToMLView(this.MLviewport);this.ShowSummary(t.ETemplateView.ML);e()}ActionControlTabFavorite(t){this.ActionKnee=l.Favorites;this.KneeImplantView.OrthoFloatingBar.BuildForm(this.KneeImplantView.OrthoElementsSection2,["FavoritesSection"]);t();this.GetSettingfavoriteImplant();var e=this.GetfavoriteImplant("Knee femoral/tibial set".toUpperCase());e.unshift("-None-");this.KneeImplantView.SetSelectfavoriteFamily(e,e,this.FavoriteItem||"-None-")}ActionControlTabImplant(n){if(this.APviewport&&this.MLviewport||this.Edition&&(this.APviewport||this.MLviewport)){this.ActionKnee=l.InsertImplant;this.KneeImplantView.OrthoFloatingBar.BuildForm(this.KneeImplantView.OrthoElementsSection2,["ImplantSection"]);n();this.OpenUIInsertImplant();this.ShowSummary(t.ETemplateView.Implant)}else{e.Toaster.ShowToast("Select AP and LAT viewports.",e.Colors.Wisteria,5)}}CreateInitialAnnotation(n){if(this.APviewport&&this.MLviewport){let l=this.APviewport.RendererPlugins[this.Plugin.PluginName];let a=this.MLviewport.RendererPlugins[this.Plugin.PluginName];if(!l.CurrentAnnotation){l.CurrentAnnotation=n!==null&&n!==void 0?n:new t.KneeImplantAnnotation;l.CurrentAnnotation.Context=this.APviewport.Context;l.CurrentAnnotation.Id=e.Utils.GetGuid();l.CurrentAnnotation.Selected=false;l.CurrentAnnotation.Status=o.EAnnotationStatus.New;l.CurrentAnnotation.Author=sessionStorage["userEmail"];l.CurrentAnnotation.Date=new Date;l.CurrentAnnotation.Plugin=this.Plugin.PluginName;l.CurrentAnnotation["new"]=true;this.KneeAnnotation=l.CurrentAnnotation;l.Context.AnnotationController=new o.AnnotationController(l.CurrentAnnotation)}if(!a.CurrentAnnotation){a.CurrentAnnotation=n!==null&&n!==void 0?n:new t.KneeImplantAnnotation;a.CurrentAnnotation.Context=this.MLviewport.Context;a.CurrentAnnotation.Id=e.Utils.GetGuid();a.CurrentAnnotation.Selected=false;a.CurrentAnnotation.Status=o.EAnnotationStatus.New;a.CurrentAnnotation.Author=sessionStorage["userEmail"];a.CurrentAnnotation.Date=new Date;a.CurrentAnnotation.Plugin=this.Plugin.PluginName;a.CurrentAnnotation["new"]=true;a.Context.AnnotationController=new o.AnnotationController(a.CurrentAnnotation)}}}static Create(e,n,a,r=[0],s,h){var m;if(s!==undefined&&s!==null){s.ActionKnee=l.None;m=s;m.KneeImplantView.BuildUI();if(m.MLviewport!==undefined&&m.KneeImplantView.IdDefault===t.ETemplateView[t.ETemplateView.ML])m.MLviewport.Context.AnnotationController=new o.AnnotationController(m.KneeAnnotation)}else{m=new KneeImplantController(e,h)}m.Controller=e.Controller;if(n!==null)m.KneeAnnotation=n;if(m.KneeAnnotation!==null&&m.KneeAnnotation!==undefined)m.KneeAnnotation.IsEdition=a;m.StatusDraw=false;m.Edition=a;m.DoneCurveMedial=false;m.Controller.ActiveContextMenu=false;if(m.KneeAnnotation){m.LegSide=t.EBodySide[m.KneeAnnotation.GetKneeSide()]==="Left"?t.EBodySide.Left:t.EBodySide.Right;m.KneeImplantView.BuildUI()}m.KneeImplantView.BuildViewSide();if(a){document.querySelector("#BtnShowHide").style.display="block";var d=m.Plugin.Controller.ViewportPane.ViewportsArray;for(var u=0;u<d.length;u++){if(d[u].Context.ImageEntity!==null&&!d[u].Context.IsPseudoSeries){var p=d[u].RendererPlugins[m.Plugin.PluginName];if(m.KneeAnnotation.APImageGuid===p.Context.ImageEntity.ImageGUID){m.APviewport=d[u]}if(m.KneeAnnotation.MLImageGuid===p.Context.ImageEntity.ImageGUID){m.MLviewport=d[u]}}}m.WriteActionSummaryDataForEdition()}else{m.CreateInitialAnnotation(m.KneeAnnotation)}if(m.APviewport&&m.MLviewport){if(m.Edition){if(!m.APviewport.Context.AnnotationController)m.APviewport.Context.AnnotationController=new o.AnnotationController(m.KneeAnnotation);if(!m.MLviewport.Context.AnnotationController)m.MLviewport.Context.AnnotationController=new o.AnnotationController(m.KneeAnnotation);m.ViewportsSelected=true;m.KneeAnnotation.CanDragPoint=true}}m.KneeImplantView.InitFormDataAndEvents(a);t.OrthoPlugin.KneeImplantControlerStaticInstance=m;return m}}t.KneeImplantController=KneeImplantController})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var OrthoPlugin;(function(OrthoPlugin){var WebClient=Efferent.Frontend.WebClient;var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;const{div:div,span:span,h3:h3,label:label,input:input,ul:ul,li:li,img:img,button:button}=DOMUtils;class KneeImplantView{constructor(t,e){this.controller=t;this.DataSection1=new Array;this.DataSection2=new Array;this.dataImplantSection1F1={};this.dataImplantSection1F2={};this.dataImplantSection2F1={};this.dataImplantSection2F2={};this.dataImplantSection2F3={};this.dataImplantSection2F4={};this.dataImplantSection2F5={};this.dataImplantSection2F6={};this.dataImplantSection2F7={};this.dataImplantSection2F8={};this.dataFavoriteSection={};this.dataImplantSection={};this.dataAPCalibration={};this.dataMLCalibration={};this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.orthoToolWindow=new OrthoPlugin.OrthoToolWindow(e,(()=>{this.controller.CancelAnnotation(this.controller)}));this.BuildUI()}BuildUI(){this.orthoToolWindow.InitComponents();this.OrthoFloatingBar=this.controller.Plugin.ManagementFloatingBar.CreateFloatingBar(document.body,"orthoCissDialog",true,"KneeTool",(()=>{this.controller.Controller.ResizeViewports()}));this.orthoToolWindow.RightTopSection.className="rightTopSection";this.orthoToolWindow.RightTopSection.appendChild(div({className:"iconImage",style:{backgroundImage:`url('${OrthoPlugin.ResourceBag.KneeImplantPng}')`}}));this.orthoToolWindow.OuterContainer.className="middleSection";this.InputLeftSide=input({type:"radio",name:"radioBtnSide",id:"bbSideLeft",value:"Left",checked:this.controller.LegSide===OrthoPlugin.EBodySide.Left&&this.orthoToolWindow.OuterContainer.style.overflow!=="hidden",onchange:t=>{var e=t.target;if(e.value==="Left"){var n=this.controller.LegSide;this.controller.LegSide=OrthoPlugin.EBodySide.Left;if(n!==OrthoPlugin.EBodySide.Left)this.controller.ChangeLegSideForLoadData()}this.RerenderImplantBySide(this.controller.LegSide);this.orthoToolWindow.SelectSideMessage.style.display="none";if(!this.controller.APviewport&&!this.controller.MLviewport)this.buildSetViewSideAPLAT()}});this.InputRightSide=input({type:"radio",name:"radioBtnSide",id:"bbSideRight",value:"Right",checked:this.controller.LegSide===OrthoPlugin.EBodySide.Right&&this.orthoToolWindow.OuterContainer.style.overflow!=="hidden",onchange:t=>{var e=t.target;if(e.value==="Right"){var n=this.controller.LegSide;this.controller.LegSide=OrthoPlugin.EBodySide.Right;if(n!==OrthoPlugin.EBodySide.Right)this.controller.ChangeLegSideForLoadData()}this.RerenderImplantBySide(this.controller.LegSide);this.orthoToolWindow.SelectSideMessage.style.display="none";if(!this.controller.APviewport&&!this.controller.MLviewport)this.buildSetViewSideAPLAT()}});const t=div({className:"h3",innerHTML:"Knee implant"});const e=div({id:"lateralityContainer",children:[div({className:"label",innerHTML:"Laterality: "}),div({className:"buttonbar",children:[this.InputRightSide,label({htmlFor:"bbSideRight",innerHTML:"Right"}),this.InputLeftSide,label({htmlFor:"bbSideLeft",innerHTML:"Left"})]})]});this.orthoToolWindow.LeftTopSection.className="leftTopSection";this.orthoToolWindow.LeftTopSection.appendChild(t);this.orthoToolWindow.LeftTopSection.appendChild(e);this.ContainerViewSide=div({style:{display:"none"}});this.spaceTab=div({className:"content"});this.orthoToolWindow.TabsContainer.appendChild(this.spaceTab);this.orthoToolWindow.MainSection.appendChild(div({className:"margin",children:[div({className:"topSection",children:[this.orthoToolWindow.LeftTopSection,this.orthoToolWindow.RightTopSection]}),this.orthoToolWindow.SelectSideMessage,this.ContainerViewSide,this.orthoToolWindow.CloseFirstDialogContainer,this.orthoToolWindow.OuterContainer]}));this.OrthoFloatingBar.Element.innerHTML="";this.OrthoFloatingBar.Element.style.height="auto";this.OrthoFloatingBar.Element.appendChild(this.orthoToolWindow.MainSection);this.OrthoFloatingBar.SetContentBox(this.orthoToolWindow.ActionsSummaryContainer);this.orthoToolWindow.ButtonsElementsContainer.style.removeProperty("height");this.buildShowHideAnnotation()}SetBodyKnee(t){if(t===OrthoPlugin.EBodySide.Left)this.InputLeftSide.checked=true;else this.InputRightSide.checked=true;this.orthoToolWindow.OuterContainer.style.height="auto";this.orthoToolWindow.OuterContainer.style.overflow="visible";this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none"}BuildSummary(t){const e=div({innerHTML:"Measurements:",style:{fontWeight:"bolder",marginBottom:"8px"}});const n=ul({children:Object.keys(t).map((e=>li({className:"blinkOnce",innerHTML:t[e].Description})))});DOMUtils.SetOptions(this.orthoToolWindow.ActionsSummaryContainer,{innerHTML:"",children:[e,n]})}ControlSkipButtonsForViews(){try{let t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);let e=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFemoralFitLine").htmlElement;let n=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnMlTibialLongitudinalAxis").htmlElement;if(this.controller.MLviewport&&this.controller.MLviewport===t){let t=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];let o=t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["ML_AnteriorFemoralCorticalLine"]);let l=t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"]);let a=t.Context.AnnotationController.GroupIsSatisfied(t.Context.AnnotationController.Template.Groups["ML_TibialImplantDimension"]);if(o&&l&&!a){n.dispatchEvent(new Event("click"))}if(a&&!o){e.dispatchEvent(new Event("click"))}}}catch(t){WebClient.Utils.DebugConsoleLog(t)}}ControlButtonsMainWindow(t){var e,n,o,l,a,r,s,h,m,d;var u=this.DataSection1[0]["forms"][0];var p=this.DataSection1[1]["forms"][0];var c;var A;var C=u.GetField("BtnFemoralWithComponent").htmlElement;var S=u.GetField("BtnFemoralResection").htmlElement;var g=u.GetField("BtnAPWithTibialComponent").htmlElement;var I=u.GetField("BtnAPTibialResection").htmlElement;var P=u.GetField("BtnAdjustAP").htmlElement;var f=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnImplantAP").htmlElement;var w=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavoritesAP").htmlElement;var b=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAP").htmlElement;var v=p.GetField("BtnFemoralFitLine").htmlElement;var T=p.GetField("BtnMlTibialLongitudinalAxis").htmlElement;var F=p.GetField("BtnAdjustML").htmlElement;var O=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnImplantML").htmlElement;var L=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavoritesML").htmlElement;var E=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnML").htmlElement;var cleanGroup=t=>{for(var e=0;e<t.GetFields().length;e++){var n=t.GetFields()[e].htmlElement;DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.ACTIVE);if(!n.disabled)DOMUtils.AddClass(n,OrthoPlugin.ButtonClasses.ENABLE)}};cleanGroup(u);cleanGroup(p);if(this.controller.APviewport&&this.controller.MLviewport){c=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];A=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];if(c&&c.Context.AnnotationController){if(c.Context.AnnotationController.GroupIsSatisfied(c.Context.AnnotationController.Template.Groups["AP_WidthFemoralComponent"]))this.AddRemoveCheckControlToButtons(true,C);else this.AddRemoveCheckControlToButtons(false,C);if(c.Context.AnnotationController.GroupIsSatisfied(c.Context.AnnotationController.Template.Groups["AP_FemoralResection"]))this.AddRemoveCheckControlToButtons(true,S);else this.AddRemoveCheckControlToButtons(false,S);if(c.Context.AnnotationController.GroupIsSatisfied(c.Context.AnnotationController.Template.Groups["AP_TibialResection"]))this.AddRemoveCheckControlToButtons(true,I);else this.AddRemoveCheckControlToButtons(false,I);if(c.Context.AnnotationController.GroupIsSatisfied(c.Context.AnnotationController.Template.Groups["AP_WidthTibialComponent"]))this.AddRemoveCheckControlToButtons(true,g);else this.AddRemoveCheckControlToButtons(false,g)}if(A&&A.Context.AnnotationController){if(A.Context.AnnotationController.GroupIsSatisfied(A.Context.AnnotationController.Template.Groups["ML_AnteriorFemoralCorticalLine"])&&A.Context.AnnotationController.GroupIsSatisfied(A.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"])){this.AddRemoveCheckControlToButtons(true,v)}else{this.AddRemoveCheckControlToButtons(false,v)}if(A.Context.AnnotationController.GroupIsSatisfied(A.Context.AnnotationController.Template.Groups["ML_TibialImplantDimension"]))this.AddRemoveCheckControlToButtons(true,T);else this.AddRemoveCheckControlToButtons(false,T)}}switch(t){case OrthoPlugin.EActionKnee.None:break;case OrthoPlugin.EActionKnee.APCalibration:DOMUtils.RemoveClass(b,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(b,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.MLCalibration:DOMUtils.RemoveClass(E,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(E,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.APFemoralWithComponent:DOMUtils.RemoveClass(C,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(C,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.APFemoralResection:DOMUtils.RemoveClass(S,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(S,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.APTibialWidthComponent:DOMUtils.RemoveClass(g,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(g,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.APTibialResection:DOMUtils.RemoveClass(I,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(I,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.MLFemoralFitLine:DOMUtils.RemoveClass(v,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(v,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.MLTibialLongitudinalAxis:DOMUtils.RemoveClass(T,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(T,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.InsertImplant:DOMUtils.RemoveClass(f,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(f,OrthoPlugin.ButtonClasses.ACTIVE);DOMUtils.RemoveClass(O,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(O,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.APImplantAdjust:DOMUtils.RemoveClass(P,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(P,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.MLImplantAdjust:DOMUtils.RemoveClass(F,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(F,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionKnee.Favorites:DOMUtils.RemoveClass(w,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(w,OrthoPlugin.ButtonClasses.ACTIVE);DOMUtils.RemoveClass(L,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(L,OrthoPlugin.ButtonClasses.ACTIVE);break}c=(e=this.controller.APviewport)===null||e===void 0?void 0:e.RendererPlugins[this.controller.Plugin.PluginName];A=(n=this.controller.MLviewport)===null||n===void 0?void 0:n.RendererPlugins[this.controller.Plugin.PluginName];let x=false;let y=false;if(c){try{let t=c.Context.AnnotationController.GroupIsComplete(c.Context.AnnotationController.Template.Groups["AP_WidthFemoralComponent"]);let e=c.Context.AnnotationController.GroupIsComplete(c.Context.AnnotationController.Template.Groups["AP_FemoralResection"]);let n=c.Context.AnnotationController.GroupIsComplete(c.Context.AnnotationController.Template.Groups["AP_WidthTibialComponent"]);let s=c.Context.AnnotationController.GroupIsComplete(c.Context.AnnotationController.Template.Groups["AP_TibialResection"]);let h=(l=(o=c.CurrentAnnotation)!==null&&o!==void 0?o:c.LastAnnotationCreatedOrSelected)===null||l===void 0?void 0:l.APOrthoImplantFemoral.ImplantReadyForDraw;let m=(r=(a=c.CurrentAnnotation)!==null&&a!==void 0?a:c.LastAnnotationCreatedOrSelected)===null||r===void 0?void 0:r.APOrthoImplantTibial.ImplantReadyForDraw;if(t||e||n||s||h||m)x=true}catch(t){}}if(A){try{let t=A.Context.AnnotationController.GroupIsComplete(A.Context.AnnotationController.Template.Groups["ML_AnteriorFemoralCorticalLine"]);let e=A.Context.AnnotationController.GroupIsComplete(A.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"]);let n=A.Context.AnnotationController.GroupIsComplete(A.Context.AnnotationController.Template.Groups["ML_TibialImplantDimension"]);let o=(h=(s=A.CurrentAnnotation)!==null&&s!==void 0?s:A.LastAnnotationCreatedOrSelected)===null||h===void 0?void 0:h.MLOrthoImplantFemoral.ImplantReadyForDraw;let l=(d=(m=A.CurrentAnnotation)!==null&&m!==void 0?m:A.LastAnnotationCreatedOrSelected)===null||d===void 0?void 0:d.MLOrthoImplantTibial.ImplantReadyForDraw;if(t||e||n||o||l)y=true}catch(t){}}const M=button({type:"button",innerHTML:"Generate Report",disabled:false,className:`${OrthoPlugin.ButtonClasses.SUCCESS} inline`,onclick:t=>{this.ReturnToCurrentAnnotation();this.controller.SaveAnnotation((()=>{var t,e;const n=this.controller.Plugin.Controller;const o=n.GetSelectViewport(n.ViewportPane);const l=n.ImagingStudyFhirEntities[o.Context.StudyGuid];let a={};c=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];A=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];let r="";let s="";let h="";let m="";let d="";let u;let p;let C;let S;if(c){let e=(t=c.CurrentAnnotation)!==null&&t!==void 0?t:c.LastAnnotationCreatedOrSelected;let n=c.Context.ImageEntity["pixelSpacing"][2];r=e.GetDistanceWidthFemoralComponent()!==0?`${Math.round(e.GetDistanceWidthFemoralComponent())} ${n}`:"";s=`${Math.round(e.GetDistalFemoralJointLineShaftAngle())} degrees`;h=e.GetDistanceWidthTibialComponent()!==0?`${Math.round(e.GetDistanceWidthTibialComponent())}  ${n}`:"";u=e.APOrthoImplantFemoral;p=e.APOrthoImplantTibial}if(A){let t=(e=A.CurrentAnnotation)!==null&&e!==void 0?e:A.LastAnnotationCreatedOrSelected;let n=A.Context.ImageEntity["pixelSpacing"][2];m=isNaN(t.GetAPDimension())?"":`${Math.round(t.GetAPDimension())} ${n}`;d=`${Math.round(t.GetMLTibialSlopeAngle())} degress`;C=t.MLOrthoImplantFemoral;S=t.MLOrthoImplantTibial}const continueReportCreation=()=>{var t,e,n,o,c,A;let g=[a["referrer"],l["description"],a["location"],l["started"],"Knee procedure",OrthoPlugin.EKneeTemplateSide[this.controller.KneeAnnotation.GetKneeSide()],r,s,h,m,d,(t=u===null||u===void 0?void 0:u.ImplantManufacturer)!==null&&t!==void 0?t:C===null||C===void 0?void 0:C.ImplantManufacturer,(e=u===null||u===void 0?void 0:u.ImplantProductLine)!==null&&e!==void 0?e:C===null||C===void 0?void 0:C.ImplantProductLine,(n=u===null||u===void 0?void 0:u.ImplantComponentFamily)!==null&&n!==void 0?n:C===null||C===void 0?void 0:C.ImplantComponentFamily,this.controller.GetImplantSizeName(u!==null&&u!==void 0?u:C,OrthoPlugin.EKneeImplant.Femoral_Component),(o=p===null||p===void 0?void 0:p.ImplantManufacturer)!==null&&o!==void 0?o:S===null||S===void 0?void 0:S.ImplantManufacturer,(c=p===null||p===void 0?void 0:p.ImplantProductLine)!==null&&c!==void 0?c:S===null||S===void 0?void 0:S.ImplantProductLine,(A=p===null||p===void 0?void 0:p.ImplantComponentFamily)!==null&&A!==void 0?A:S===null||S===void 0?void 0:S.ImplantComponentFamily,this.controller.GetImplantSizeName(p!==null&&p!==void 0?p:S,OrthoPlugin.EKneeImplant.Tibial_Component)];this.controller.Plugin.CreateDiagnosticReport(g,l,"8654F9D0-2EEA-45D6-BD00-BD4E5ECAB703")};this.controller.Plugin.GenerateOrthoReport(l,a,continueReportCreation)}))}});const D=button({type:"button",className:`${OrthoPlugin.ButtonClasses.CRITIC} inline`,innerHTML:this.controller.Edition?"Close":"Cancel",onclick:t=>{this.controller.CancelAnnotation(this.controller)}});const R=button({type:"button",innerHTML:"Save",className:`${OrthoPlugin.ButtonClasses.SUCCESS} inline`,onclick:t=>{this.ReturnToCurrentAnnotation();this.controller.SaveAnnotation();D.innerHTML="Close"}});let V=[];V.push(R);if(WebClient.Utils.CheckNotAllowTag("guest")){V.push(M)}else{R.style.flexGrow="2";D.style.flexGrow="2"}V.push(D);DOMUtils.SetOptions(this.orthoToolWindow.ActionsWindowContainer,{innerHTML:"",children:V});this.cleanClassColorOfButtonDisabled(u);this.cleanClassColorOfButtonDisabled(p);this.ControlStatusMainButtons();this.controller.ShowSummary(OrthoPlugin.ETemplateView[this.IdDefault])}ReturnToCurrentAnnotation(){const t=this.controller.Plugin.Controller;const e=t.GetSelectViewport(t.ViewportPane);if(e===this.controller.APviewport){this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation)}else if(e===this.controller.MLviewport){this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.MLviewport,this.controller.MLIdCurrentAnnotation)}}AddRemoveCheckControlToButtons(t,e){let removeCheckControl=()=>{let t=e.getElementsByTagName("span");if(t){let e=t[0];DOMUtils.RemoveItem(e)}};if(e){if(t){removeCheckControl();let t=span({style:{position:"absolute",bottom:"-1px",right:"1px"},children:[img({width:12,height:12,src:OrthoPlugin.ResourceBag.CheckedPng})]});e.style.position="relative";e.appendChild(t)}else{removeCheckControl()}}}ControlStatusMainButtons(){var t;var e=this.DataSection1[0]["forms"][0];var n=this.DataSection1[1]["forms"][0];if(this.IdDefault===OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP]&&this.controller.APviewport!==undefined){var o=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];t=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName].Context.ImageEntity.IsCalibrated();var l=e.GetField("BtnFemoralWithComponent").htmlElement;var a=e.GetField("BtnFemoralResection").htmlElement;var r=e.GetField("BtnAPWithTibialComponent").htmlElement;var s=e.GetField("BtnAPTibialResection").htmlElement;var h=e.GetField("BtnAdjustAP").htmlElement;var m=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnImplantAP").htmlElement;var d=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavoritesAP").htmlElement;if(!t){l.disabled=false;a.disabled=false;r.disabled=false;s.disabled=false;h.disabled=true;m.disabled=true;d.disabled=true;DOMUtils.RemoveClass(l,"blue");DOMUtils.RemoveClass(a,"blue");DOMUtils.RemoveClass(r,"blue");DOMUtils.RemoveClass(s,"blue");DOMUtils.RemoveClass(h,"blue");DOMUtils.RemoveClass(m,"blue");DOMUtils.RemoveClass(d,"blue")}else{l.disabled=false;a.disabled=false;r.disabled=false;s.disabled=false;h.disabled=false;m.disabled=false;d.disabled=false}}else if(this.IdDefault===OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML]&&this.controller.MLviewport!==undefined){var u=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];t=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName].Context.ImageEntity.IsCalibrated();var p=n.GetField("BtnFemoralFitLine").htmlElement;var c=n.GetField("BtnMlTibialLongitudinalAxis").htmlElement;var A=n.GetField("BtnAdjustML").htmlElement;var C=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnImplantML").htmlElement;var S=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavoritesML").htmlElement;if(!t){p.disabled=false;c.disabled=false;A.disabled=true;C.disabled=true;S.disabled=true;DOMUtils.RemoveClass(p,"blue");DOMUtils.RemoveClass(c,"blue");DOMUtils.RemoveClass(A,"blue");DOMUtils.RemoveClass(C,"blue");DOMUtils.RemoveClass(S,"blue")}else{p.disabled=false;c.disabled=false;A.disabled=false;C.disabled=false;S.disabled=false}}else if(this.IdDefault===OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.Implant]){["BtnFemoralWithComponent","BtnFemoralResection","BtnAPWithTibialComponent","BtnAPTibialResection","BtnAdjustAP"].forEach((t=>{const n=e.GetField(t).htmlElement;n.disabled=true}));["BtnFemoralFitLine","BtnMlTibialLongitudinalAxis","BtnAdjustML"].forEach((t=>{const e=n.GetField(t).htmlElement;e.disabled=true}))}else{var g=e.GetField("BtnFemoralWithComponent").htmlElement;var I=e.GetField("BtnAdjustAP").htmlElement;var P=n.GetField("BtnFemoralFitLine").htmlElement;var f=n.GetField("BtnMlTibialLongitudinalAxis").htmlElement;var w=n.GetField("BtnAdjustML").htmlElement;g.disabled=false;if(this.controller.Edition)I.disabled=false;else I.disabled=true;P.disabled=false;f.disabled=false;if(this.controller.Edition)w.disabled=false;else w.disabled=true}this.ControlTabContent();this.cleanClassColorOfButtonDisabled(e);this.cleanClassColorOfButtonDisabled(n)}ControlTabContent(){this.spaceTab.style.minHeight="100px";switch(this.controller.ActionKnee){case OrthoPlugin.EActionKnee.None:this.spaceTab.style.display="block";var t=this.spaceTab.getElementsByClassName("section");for(var e in t){if(t.hasOwnProperty(e))t[e].style.display="none"}if(this.containerASection2!==undefined)this.containerASection2.style.display="none";if(this.containerBSection2!==undefined)this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break;case OrthoPlugin.EActionKnee.APFemoralWithComponent:case OrthoPlugin.EActionKnee.APFemoralResection:case OrthoPlugin.EActionKnee.APTibialWidthComponent:case OrthoPlugin.EActionKnee.APTibialResection:case OrthoPlugin.EActionKnee.MLFemoralFitLine:case OrthoPlugin.EActionKnee.MLTibialLongitudinalAxis:case OrthoPlugin.EActionKnee.APCalibration:case OrthoPlugin.EActionKnee.MLCalibration:this.spaceTab.style.display="block";this.containerASection2.style.display="block";this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break;case OrthoPlugin.EActionKnee.Favorites:case OrthoPlugin.EActionKnee.InsertImplant:this.spaceTab.style.display="block";this.containerASection2.style.display="block";this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="none";break;case OrthoPlugin.EActionKnee.APImplantAdjust:case OrthoPlugin.EActionKnee.MLImplantAdjust:this.spaceTab.style.display="block";this.containerASection2.style.display="none";this.containerBSection2.style.display="block";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="none";try{var n=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];var o=!this.controller.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;this.UpdateUIAdjustAPFemoralImplant(o.APOrthoImplantFemoral);this.UpdateUIAdjustAPTibialImplant(o.APOrthoImplantTibial)}catch(t){WebClient.Utils.DebugConsoleLog(t)}try{var l=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];var a=!this.controller.Edition?l.CurrentAnnotation:l.LastAnnotationCreatedOrSelected;this.UpdateUIAdjustMLFemoralImplant(a.MLOrthoImplantFemoral);this.UpdateUIAdjustMLTibialImplant(a.MLOrthoImplantTibial)}catch(t){WebClient.Utils.DebugConsoleLog(t)}break}}RerenderImplantBySide(t){if(this.controller.APviewport){var e=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];var n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;if(n){n.SetKneeSide(t===OrthoPlugin.EBodySide.Left?OrthoPlugin.EKneeTemplateSide.Left:OrthoPlugin.EKneeTemplateSide.Right);this.controller.APviewport.Context.Renderer.Render();this.controller.APviewport.Context.OverlayRenderer.Render()}}if(this.controller.MLviewport){var o=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];var l=!this.controller.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected;if(l){l.SetKneeSide(t===OrthoPlugin.EBodySide.Left?OrthoPlugin.EKneeTemplateSide.Left:OrthoPlugin.EKneeTemplateSide.Right);this.controller.MLviewport.Context.Renderer.Render();this.controller.MLviewport.Context.OverlayRenderer.Render()}}this.RefreshLegOnAllViewports(t)}RefreshLegOnAllViewports(t){if(this.controller.Edition){var e=this.controller.Plugin.Controller.ViewportPane.ViewportsArray;for(var n=0;n<e.length;n++){if(e[n].Context.ImageEntity!==null){var o=e[n].RendererPlugins[this.controller.Plugin.PluginName].Annotations;for(var l=0;l<o.length;l++){if(o[l]instanceof OrthoPlugin.KneeImplantAnnotation){o[l].SetKneeSide(t===OrthoPlugin.EBodySide.Left?OrthoPlugin.EKneeTemplateSide.Left:OrthoPlugin.EKneeTemplateSide.Right);e[n].Context.Renderer.Render();e[n].Context.OverlayRenderer.Render()}}}}}}BuildViewSide(){let t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);let e;let n;let o;if(t===this.controller.APviewport)o=true;else if(t===this.controller.MLviewport)o=false;if(o!==undefined){if(o){e=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected}else{e=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected}const l=input({type:"radio",name:"radioBtnView",id:o?"bbSideAP":"bbSideML",value:o?"AP":"ML",checked:(()=>{if(o){if(!n||n&&n.APViewDirection===OrthoPlugin.EViewCiss.AP)return true}else{if(!n||n&&n.MLViewDirection===OrthoPlugin.EViewCiss.ML)return true}return false})(),onchange:l=>{t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);if(o){e=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected}else{e=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected}var a=l.target;if(a.value==="AP"||a.value==="ML"){if(o)n.APViewDirection=OrthoPlugin.EViewCiss.AP;else n.MLViewDirection=OrthoPlugin.EViewCiss.ML}t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}});const a=input({type:"radio",name:"radioBtnView",id:o?"bbSidePA":"bbSideLM",value:o?"PA":"LM",checked:(()=>{if(o){if(n&&n.APViewDirection===OrthoPlugin.EViewCiss.PA)return true}else{if(n&&n.MLViewDirection===OrthoPlugin.EViewCiss.LM)return true}return false})(),onchange:l=>{t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);if(o){e=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected}else{e=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected}var a=l.target;if(a.value==="PA"||a.value==="LM"){if(o)n.APViewDirection=OrthoPlugin.EViewCiss.PA;else n.MLViewDirection=OrthoPlugin.EViewCiss.LM}t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}});const r=div({id:"btnBarSpaceViewSide",className:"buttonbar",children:[l,label({htmlFor:o?"bbSideAP":"bbSideML",innerHTML:o?"AP":"ML"}),a,label({htmlFor:o?"bbSidePA":"bbSideLM",innerHTML:o?"PA":"LM"})]});const s=this.OrthoFloatingBar.Element.querySelector("#ContainerViewSide");const h=this.OrthoFloatingBar.Element.querySelector("#lateralityContainer");if(s===null){const t=div({id:"ContainerViewSide",children:[div({className:"label",innerHTML:"Orientation: "}),r]});h.after(t)}else{const t=this.OrthoFloatingBar.Element.querySelector("#btnBarSpaceViewSide");WebClient.DOMUtils.RemoveItem(t);s.appendChild(r)}}}AppendIconsToMainButtons(t){const e=this.DataSection1[0]["forms"][0];const n=this.DataSection1[1]["forms"][0];const o=img({src:OrthoPlugin.ResourceBag.KneeImplantPng});let l;let a;let r;let s;const h=img({src:OrthoPlugin.ResourceBag.Icons8Drag32Png,style:{width:"24px",height:"24px",verticalAlign:"middle",marginRight:"2px"}});const m=div({innerHTML:" Adjust",style:{display:"inline-block"}});const d=img({src:OrthoPlugin.ResourceBag.KneeAlignPng,style:{width:"28px",height:"28px",verticalAlign:"middle",marginRight:"2px"}});const u=div({innerHTML:" Implants",style:{display:"inline-block"}});const p=img({src:OrthoPlugin.ResourceBag.Icons8StartPng,style:{width:"24px",height:"24px",verticalAlign:"middle",marginRight:"2px"}});const c=div({innerHTML:" Favorites",style:{display:"inline-block"}});if(t===OrthoPlugin.ETemplateView.AP){l=WebClient.Form.GetFieldFromForms(this.DataSection2,"BtnAPCalibration").htmlElement;a=img({src:OrthoPlugin.ResourceBag.Icons8Sphere32Png});l.innerHTML="";l.appendChild(a);var A=e.GetField("BtnAdjustAP").htmlElement;A.innerHTML="";A.appendChild(h);A.appendChild(m);var C=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnImplantAP").htmlElement;C.innerHTML="";C.appendChild(d);C.appendChild(u);var S=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavoritesAP").htmlElement;S.innerHTML="";S.appendChild(p);S.appendChild(c)}else if(t===OrthoPlugin.ETemplateView.ML){a=img({src:OrthoPlugin.ResourceBag.Icons8Sphere32Png});l=WebClient.Form.GetFieldFromForms(this.DataSection2,"BtnMLCalibration").htmlElement;l.innerHTML="";l.appendChild(a);const t=n.GetField("BtnAdjustML").htmlElement;t.innerHTML="";t.appendChild(h);t.appendChild(m);var g=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnImplantML").htmlElement;g.innerHTML="";g.appendChild(d);g.appendChild(u);var I=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavoritesML").htmlElement;I.innerHTML="";I.appendChild(p);I.appendChild(c)}this.ControlUI()}ControlUI(){var t=this.spaceTab.getElementsByClassName("section");for(var e=0;e<t.length;e++){if(t[e]["style"]["display"]!=="none"){var n=t[e].getElementsByClassName("block");n[0]["style"].height="max-content";if(this.controller.ActionKnee===OrthoPlugin.EActionKnee.InsertImplant)n[0]["style"]["padding-bottom"]=0;var o=n[0].childNodes[0];o["style"]["justify-content"]="left"}}}ShowValueLabel(t,e,n,o){const l=t===1?this.DataSection1:this.DataSection2;try{var a=WebClient.Form.GetFieldFromForms(l,e);var r=OrthoPlugin.ResourceBag.KneeImplantTemplateJson;a.htmlElement.innerHTML=o||r.Groups[n].PromptMessage}catch(t){}}ShowMessageForAP_WidthFemoralComponent(t,e){var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"textWidthFemoralComponentDistance");n.htmlElement.style.display="block";n.htmlElement["innerHTML"]="The width of femoral component calculated is: "+"<b>"+t.toFixed(2)+"</b>";this.ControlButtonsMainWindow(this.controller.ActionKnee);if(e){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextWidthFemoralComponent");o.htmlElement.innerHTML=""}}ShowMessageForAP_WidthTibialComponent(t,e){var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"textWidthTibialComponentDistance");n.htmlElement["innerHTML"]="The width of tibial component calculated is: "+"<b>"+t.toFixed(2)+"</b>";this.ControlButtonsMainWindow(this.controller.ActionKnee);if(e){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextAPWidthTibialComponent");o.htmlElement.innerHTML=""}}ShowMessageForML_TextMLFemoralDistance(t,e){var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextMLFemoralDistance");n.htmlElement.style.display="block";n.htmlElement.innerHTML="The distance is "+t;this.ControlButtonsMainWindow(this.controller.ActionKnee);if(e){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextFemoralFitLine");o.htmlElement.innerHTML=""}}ShowMessageForML_TextMLTibialAngle(t,e){var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextMLTibialAngle");n.htmlElement.style.display="block";n.htmlElement.innerHTML="The Angle is "+t;this.ControlButtonsMainWindow(this.controller.ActionKnee);if(e){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextMlTibialLongitudinalAxis");o.htmlElement.innerHTML=""}}ResetDataObjects(){this.dataImplantSection1F1={};this.dataImplantSection1F2={};this.dataImplantSection2F1={};this.dataImplantSection2F2={};this.dataImplantSection2F3={};this.dataImplantSection2F4={};this.dataImplantSection2F5={};this.dataImplantSection2F6={};this.dataImplantSection2F7={};this.dataImplantSection2F8={};this.dataFavoriteSection={};this.dataImplantSection={};this.dataAPCalibration={}}ActionApButton(t){this.controller.ReconstructorViewportReferences(this.controller.APviewport,"AP");this.controller.ActionControlTabAP((()=>{if(this.controller.APviewport){this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation);this.controller.ResetActionsDraw(null,this.controller.APviewport);if(t)this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");let e=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];if(e.Context.AnnotationController)e.Context.AnnotationController.CurrentGroup=null;this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"default");this.BuildViewSide();this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.AP);this.ControlTabContent();this.ControlStatusMainButtons();this.ControlButtonsMainWindow(this.controller.ActionKnee);this.OrthoFloatingBar.Element.style.height="auto";this.ControlCalibrationButton()}}))}ActionMlButton(t){this.controller.ReconstructorViewportReferences(this.controller.MLviewport,"ML");this.controller.ActionControlTabML((()=>{if(this.controller.MLviewport){this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.MLviewport,this.controller.MLIdCurrentAnnotation);this.controller.ResetActionsDraw(null,this.controller.MLviewport);if(t)this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");let e=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];if(e.Context.AnnotationController)e.Context.AnnotationController.CurrentGroup=null;this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"default");this.BuildViewSide();this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.ML);this.ControlTabContent();this.ControlStatusMainButtons();this.ControlButtonsMainWindow(this.controller.ActionKnee);this.OrthoFloatingBar.Element.style.height="auto";this.ControlCalibrationButton()}}))}InitFormDataAndEvents(t){this.ResetDataObjects();this.spaceTab.innerHTML="";this.dataImplantSection1F1["actionBtnAP"]=t=>{this.ActionApButton(true)};this.dataImplantSection1F1["actionBtnFemoralWithComponent"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.APviewport,"AP");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation);this.controller.ResetActionsDraw("AP_WidthFemoralComponent",this.controller.APviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");if(!this.controller.KneeAnnotation.Points["AP_WidthFemoralComponent"])this.controller.KneeAnnotation.Points["AP_WidthFemoralComponent"]=new Array;this.controller.ActionFemoralWidthComponentAP()};this.dataImplantSection1F1["actionBtnFemoralResection"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.APviewport,"AP");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation);this.controller.ResetActionsDraw("AP_FemoralResection",this.controller.APviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");if(!this.controller.KneeAnnotation.Points["AP_FemoralResection"])this.controller.KneeAnnotation.Points["AP_FemoralResection"]=new Array;this.controller.ActionFemoralResectionAP()};this.dataImplantSection1F1["actionBtnAPTibialResection"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.APviewport,"AP");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation);this.controller.ResetActionsDraw("AP_TibialResection",this.controller.APviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");if(!this.controller.KneeAnnotation.Points["AP_TibialResection"])this.controller.KneeAnnotation.Points["AP_TibialResection"]=new Array;this.controller.ActionTibialResectionAP(this.controller.KneeAnnotation)};this.dataImplantSection1F1["actionBtnTibialOsteotomyLine"]=t=>{};this.dataImplantSection1F1["actionBtnWithTibialComponent"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.APviewport,"AP");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation);this.controller.ResetActionsDraw("AP_WidthTibialComponent",this.controller.APviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");if(!this.controller.KneeAnnotation.Points["AP_WidthTibialComponent"])this.controller.KneeAnnotation.Points["AP_WidthTibialComponent"]=new Array;this.controller.ActionWidthTibialComponentAP()};this.dataImplantSection1F1["actionBtnAdjustAP"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.APviewport,"AP");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation);this.controller.ResetActionsDraw(null,this.controller.APviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.controller.OpenUIInsertImplant((()=>{this.controller.ActionAdjustAP()}))};this.dataImplantSection1F1["actionBtnImplantAP"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.APviewport,"AP");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation);this.controller.ResetActionsDraw(null,this.controller.APviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");let e=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];let n=e.Context.ImageEntity.IsCalibrated();let o=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];let l=o.Context.ImageEntity.IsCalibrated();let a=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);if(n&&l){if(this.controller.APviewport&&a===this.controller.APviewport){if(n){if(this.controller.KneeAnnotation.APOrthoImplantFemoral)this.controller.KneeAnnotation.APOrthoImplantFemoral.ImplantReadyForDraw=false;if(this.controller.KneeAnnotation.APOrthoImplantTibial)this.controller.KneeAnnotation.APOrthoImplantTibial.ImplantReadyForDraw=false;this.controller.ActionControlTabImplant((()=>{this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.Implant);this.ControlTabContent();this.ControlStatusMainButtons();this.ControlButtonsMainWindow(this.controller.ActionKnee)}))}else{if(!n)WebClient.Toaster.ShowToast("The AP image is not calibrated.",WebClient.Colors.GreenSea,5);this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(this.controller.KneeAnnotation)}}else if(this.controller.MLviewport&&this.controller.MLviewport===a){if(l){if(this.controller.KneeAnnotation.MLOrthoImplantFemoral)this.controller.KneeAnnotation.MLOrthoImplantFemoral.ImplantReadyForDraw=false;if(this.controller.KneeAnnotation.MLOrthoImplantTibial)this.controller.KneeAnnotation.MLOrthoImplantTibial.ImplantReadyForDraw=false;this.controller.ActionControlTabImplant((()=>{this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.Implant);this.ControlTabContent();this.ControlStatusMainButtons();this.ControlButtonsMainWindow(this.controller.ActionKnee)}))}else{if(!l)WebClient.Toaster.ShowToast("The ML image is not calibrated.",WebClient.Colors.GreenSea,5);this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ViewTab(this.controller.KneeAnnotation)}}}else{if(!n){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];WebClient.Toaster.ShowToast("The AP image is not calibrated.",WebClient.Colors.GreenSea,5)}if(!l){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];WebClient.Toaster.ShowToast("The ML image is not calibrated.",WebClient.Colors.GreenSea,5)}this.ViewTab(this.controller.KneeAnnotation)}};this.dataImplantSection1F1["actionBtnFavoritesAP"]=t=>{if(this.controller.APviewport&&this.controller.MLviewport){this.controller.ReconstructorViewportReferences(this.controller.APviewport,"AP");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.APviewport,this.controller.APIdCurrentAnnotation);this.controller.ResetActionsDraw(null,this.controller.APviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");let t=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];let o=t.Context.ImageEntity.IsCalibrated();let l=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];var e=l.Context.ImageEntity.IsCalibrated();if(o&&e){this.controller.ActionControlTabFavorite((()=>{this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.Fav);this.ControlTabContent();this.ControlStatusMainButtons();this.ControlButtonsMainWindow(this.controller.ActionKnee)}))}else{var n=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);if(!o){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];WebClient.Toaster.ShowToast("The AP image is not calibrated.",WebClient.Colors.GreenSea,5)}if(!e){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];WebClient.Toaster.ShowToast("The ML image is not calibrated.",WebClient.Colors.GreenSea,5)}this.ViewTab(this.controller.KneeAnnotation)}}};this.dataImplantSection1F2["actionBtnML"]=t=>{this.ActionMlButton(true)};this.dataImplantSection1F2["actionBtnFemoralFitLine"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.MLviewport,"ML");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.MLviewport,this.controller.MLIdCurrentAnnotation);this.controller.ResetActionsDraw("ML_AnteriorFemoralCorticalLine",this.controller.MLviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");if(!this.controller.KneeAnnotation.Points["ML_AnteriorFemoralCorticalLine"])this.controller.KneeAnnotation.Points["ML_AnteriorFemoralCorticalLine"]=new Array;if(!this.controller.KneeAnnotation.Points["ML_MostDistalCondylarPoint"])this.controller.KneeAnnotation.Points["ML_MostDistalCondylarPoint"]=new Array;this.controller.ActionFemoralFitLineML()};this.dataImplantSection1F2["actionBtnMlTibialLongitudinalAxis"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.MLviewport,"ML");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.MLviewport,this.controller.MLIdCurrentAnnotation);this.controller.ResetActionsDraw("ML_TibialImplantDimension",this.controller.MLviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"crosshair");if(!this.controller.KneeAnnotation.Points["ML_TibialImplantDimension"])this.controller.KneeAnnotation.Points["ML_TibialImplantDimension"]=new Array;this.controller.ActionTibialLongitudinalAxisML()};this.dataImplantSection1F2["actionBtnAdjustML"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.MLviewport,"ML");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.MLviewport,this.controller.MLIdCurrentAnnotation);this.controller.ResetActionsDraw(null,this.controller.MLviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");this.controller.OpenUIInsertImplant((()=>{this.controller.ActionAdjustML()}))};this.dataImplantSection1F2["actionBtnImplantML"]=t=>{this.controller.ReconstructorViewportReferences(this.controller.MLviewport,"ML");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.MLviewport,this.controller.MLIdCurrentAnnotation);this.controller.ResetActionsDraw(null,this.controller.MLviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");let e=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];let n=e.Context.ImageEntity.IsCalibrated();let o=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];let l=o.Context.ImageEntity.IsCalibrated();let a=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);if(n&&l){if(this.controller.APviewport&&this.controller.APviewport===a){if(n){if(this.controller.KneeAnnotation.APOrthoImplantFemoral)this.controller.KneeAnnotation.APOrthoImplantFemoral.ImplantReadyForDraw=false;if(this.controller.KneeAnnotation.APOrthoImplantTibial)this.controller.KneeAnnotation.APOrthoImplantTibial.ImplantReadyForDraw=false;this.controller.ActionControlTabImplant((()=>{this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.Implant);this.ControlTabContent();this.ControlStatusMainButtons();this.ControlButtonsMainWindow(this.controller.ActionKnee)}))}else{if(!n)WebClient.Toaster.ShowToast("The AP image is not calibrated.",WebClient.Colors.GreenSea,5);this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(this.controller.KneeAnnotation)}}else if(this.controller.MLviewport&&this.controller.MLviewport===a){if(l){if(this.controller.KneeAnnotation.MLOrthoImplantFemoral)this.controller.KneeAnnotation.MLOrthoImplantFemoral.ImplantReadyForDraw=false;if(this.controller.KneeAnnotation.MLOrthoImplantTibial)this.controller.KneeAnnotation.MLOrthoImplantTibial.ImplantReadyForDraw=false;this.controller.ActionControlTabImplant((()=>{this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.Implant);this.ControlTabContent();this.ControlStatusMainButtons();this.ControlButtonsMainWindow(this.controller.ActionKnee)}))}else{if(!l)WebClient.Toaster.ShowToast("The ML image is not calibrated.",WebClient.Colors.GreenSea,5);this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ViewTab(this.controller.KneeAnnotation)}}}else{if(!n){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];WebClient.Toaster.ShowToast("The AP image is not calibrated.",WebClient.Colors.GreenSea,5)}if(!l){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];WebClient.Toaster.ShowToast("The ML image is not calibrated.",WebClient.Colors.GreenSea,5)}this.ViewTab(this.controller.KneeAnnotation)}};this.dataImplantSection1F2["actionBtnFavoritesML"]=t=>{if(this.controller.APviewport&&this.controller.MLviewport){this.controller.ReconstructorViewportReferences(this.controller.MLviewport,"ML");this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller,this.controller.MLviewport,this.controller.MLIdCurrentAnnotation);this.controller.ResetActionsDraw(null,this.controller.MLviewport);this.controller.Plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");let t=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];let o=t.Context.ImageEntity.IsCalibrated();let l=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];var e=l.Context.ImageEntity.IsCalibrated();if(o&&e){this.controller.ActionControlTabFavorite((()=>{this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.Fav);this.ControlTabContent();this.ControlStatusMainButtons();this.ControlButtonsMainWindow(this.controller.ActionKnee)}))}else{var n=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);if(!o){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];WebClient.Toaster.ShowToast("The AP image is not calibrated.",WebClient.Colors.GreenSea,5)}if(!e){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];WebClient.Toaster.ShowToast("The ML image is not calibrated.",WebClient.Colors.GreenSea,5)}this.ViewTab(this.controller.KneeAnnotation)}}};this.dataImplantSection2F1["actionBtnStartOverAPWidthFemoralComponent"]=t=>{this.startOver()};this.dataImplantSection2F1["actionBtnDoneAPWidthFemoralComponent"]=t=>{this.controller.ActionOkAPFemoralWithComponent((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(t)}))};this.dataImplantSection2F1["actionBtnCancelAPWidthFemoralComponent"]=t=>{this.controller.ActionCancelAPFemoralWithComponent((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(t)}))};this.dataImplantSection2F2["actionBtnStartOverAPFemoralResection"]=t=>{this.startOver()};this.dataImplantSection2F2["actionBtnDoneAPFemoralResection"]=t=>{this.controller.ActionOkAPFemoralResection((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(t)}))};this.dataImplantSection2F2["actionBtnCancelAPFemoralResection"]=t=>{this.controller.ActionCancelAPFemoralResection((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(t)}))};this.dataImplantSection2F3["actionBtnStartOverAPWithTibialComponent"]=t=>{this.startOver()};this.dataImplantSection2F3["actionBtnDoneAPWithTibialComponent"]=t=>{this.controller.ActionOkAPWithTibialComponent((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(t)}))};this.dataImplantSection2F3["actionBtnCancelAPWithTibialComponet"]=t=>{this.controller.ActionCancelAPWithTibialComponent((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(t)}))};this.dataImplantSection2F4["actionBtnStartOverAPTibialResection"]=t=>{this.startOver()};this.dataImplantSection2F4["actionBtnDoneAPTibialResection"]=t=>{this.controller.ActionOkAPTibialResection((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(t)}))};this.dataImplantSection2F4["actionBtnCancelAPTibialResection"]=t=>{this.controller.ActionCancelAPTibialResection((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ViewTab(t)}))};this.dataImplantSection2F5["actionBtnStartOverMLFemoralFitLine"]=t=>{var e=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];e.Context.AnnotationController.SetCurrentGroup("ML_MostDistalCondylarPoint");this.startOver()};this.dataImplantSection2F5["actionBtnDoneMLFemoralFitLine"]=t=>{this.controller.ActionOKMLFemoralFitLine((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ViewTab(t)}))};this.dataImplantSection2F5["actionBtnCancelMLFemoralFitLine"]=t=>{this.controller.ActionCancelMLFemoralFitLine((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ViewTab(t)}))};this.dataImplantSection2F6["actionBtnStartOverMLTibialLongitudinalAxis"]=t=>{this.startOver()};this.dataImplantSection2F6["actionBtnDoneMLTibialLongitudinalAxis"]=t=>{this.controller.ActionOKMLTibialLongitudinalAxis((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ViewTab(t)}))};this.dataImplantSection2F6["actionBtnCancelMLTibialLongitudinalAxis"]=t=>{this.controller.ActionCancelMLTibialLongitudinalAxis((t=>{this.controller.KneeAnnotation.CanDragPoint=true;this.controller.Plugin.Controller.SetCursorForViewports(this.controller.Plugin.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ViewTab(t)}))};this.dataFavoriteSection["actionKneefavoriteProductLine"]=()=>{this.controller.FillManufacturerList(this.ActionFavorite.bind(this))};this.dataFavoriteSection["optionsKneefavoriteProductLine"]="-None-";this.dataFavoriteSection["valuesKneefavoriteProductLine"]="-None-";this.dataFavoriteSection["productfavoriteLineKnee"]="-None-";this.dataImplantSection["stemIconSrc"]=OrthoPlugin.ResourceBag.KneeImplantPng;this.dataImplantSection["actionManufacturer"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLine");n.htmlElement.innerHTML="";var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectFemoralComponentFamily");o.htmlElement.selectedIndex=0;this.SetSelectFemoralComponentFamily(["--"],["--"],"--");this.CleanImplant(OrthoPlugin.EKneeImplant.Femoral_Component);var l=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectTibialComponentFamily");l.htmlElement.selectedIndex=0;this.CleanImplant(OrthoPlugin.EKneeImplant.Tibial_Component);this.SetSelectTibialComponentFamily(["--"],["--"],"--");if(t.currentTarget.selectedIndex!==0){this.controller.LoadDataPerManufacturer(t.currentTarget.value,true)}};this.dataImplantSection["optionsManufacturer"]="--";this.dataImplantSection["valuesManufacturer"]="--";this.dataImplantSection["manufacturer"]="--";this.dataImplantSection["actionProductLine"]=(t,e)=>{this.CleanImplant(OrthoPlugin.EKneeImplant.Femoral_Component);this.CleanImplant(OrthoPlugin.EKneeImplant.Tibial_Component);this.controller.ActionProductLineFemoralInsertImplant();this.controller.ActionProductLineTibialInsertImplant()};this.dataImplantSection["optionsProductLine"]="--";this.dataImplantSection["valuesProductLine"]="--";this.dataImplantSection["productLine"]="--";this.dataImplantSection["actionFemoralComponentFamily"]=(t,e)=>{this.controller.ActionFemoralComponentFamilyInsertImplant()};this.dataImplantSection["optionsFemoralComponentFamily"]="--";this.dataImplantSection["valuesFemoralComponentFamily"]="--";this.dataImplantSection["FemoralcomponentFamily"]="--";this.dataImplantSection["actionTibialComponentFamily"]=(t,e)=>{this.controller.ActionTibialComponentFamilyInsertImplant()};this.dataImplantSection["optionsTibialComponentFamily"]="--";this.dataImplantSection["valuesTibialComponentFamily"]="--";this.dataImplantSection["TibialcomponentFamily"]="--";this.dataImplantSection["TibialImplantSize"]="";this.dataImplantSection["dataTibialImplantSize"]=[new WebClient.ValuesUD("-","-")];this.dataImplantSection["FemoralImplantSize"]="";this.dataImplantSection["dataFemoralImplantSize"]=[new WebClient.ValuesUD("-","-")];this.dataImplantSection["actionBtnClearInsertImplants"]=t=>{this.controller.ClearDataImplants(OrthoPlugin.EKneeImplant.Femoral_Component);this.controller.ClearDataImplants(OrthoPlugin.EKneeImplant.Tibial_Component)};this.dataImplantSection["actionBtnCancelInsertImplants"]=t=>{this.controller.CancelInsertImplants()};this.dataAPCalibration["actionAPBtnCalibration"]=t=>{this.controller.ActionCalibrateAP(this.controller.KneeAnnotation)};this.dataMLCalibration["actionMLBtnCalibration"]=t=>{this.controller.ActionCalibrateML(this.controller.KneeAnnotation)};this.DataSection1=[this.dataImplantSection1F1,this.dataImplantSection1F2];this.DataSection2=[this.dataImplantSection2F1,this.dataImplantSection2F2,this.dataImplantSection2F3,this.dataImplantSection2F4,this.dataImplantSection2F5,this.dataImplantSection2F6,this.dataImplantSection2F7,this.dataFavoriteSection,this.dataImplantSection,this.dataAPCalibration,this.dataMLCalibration];this.OrthoElementsSection1=(new Vue.Products.OrthoPlugin.KneeImplantSection1Form).Create(this.orthoToolWindow.ButtonsElementsContainer,this.DataSection1);this.ControlUI();this.containerASection2=div({style:{display:"none"}});this.containerBSection2=div({style:{display:"none"}});this.spaceTab.appendChild(this.containerASection2);this.spaceTab.appendChild(this.containerBSection2);this.OrthoElementsSection2=(new Vue.Products.OrthoPlugin.KneeImplantSection2Form).Create(this.containerASection2,this.DataSection2);this.controller.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");let e=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);if(e&&e===this.controller.APviewport){this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.AP)}else if(e&&e===this.controller.MLviewport){this.AppendIconsToMainButtons(OrthoPlugin.ETemplateView.ML)}this.ControlCalibrationButton();this.ControlStatusMainButtons();if(!t){}else{if(this.controller.KneeAnnotation.Context===this.controller.KneeAnnotation.APContext){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP]}else if(this.controller.KneeAnnotation.Context===this.controller.KneeAnnotation.MLContext){this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML]}}if(this.IdDefault==="AP"){let t=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAP");t.htmlElement.click()}else if(this.IdDefault==="ML"){let t=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnML");t.htmlElement.click()}this.ViewTab(this.controller.KneeAnnotation)}ResetFavorite(){var t=this.controller.GetfavoriteImplant("Knee femoral/tibial set".toUpperCase());t.unshift("-None-");this.SetSelectfavoriteFamily(t,t,"-None-")}CleanImplant(t,e,n){try{var o=this.controller.APviewport!==null&&this.controller.APviewport!==undefined?this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName]:null;var l=this.controller.MLviewport!==null&&this.controller.MLviewport!==undefined?this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName]:null;var a=!this.controller.Edition?o.CurrentAnnotation:o.LastAnnotationCreatedOrSelected||this.controller.GetKneeAnnotationFromViewport(o);var r=!this.controller.Edition?l.CurrentAnnotation:l.LastAnnotationCreatedOrSelected||this.controller.GetKneeAnnotationFromViewport(l);if(t===OrthoPlugin.EKneeImplant.Femoral_Component){if(a&&(!e||e==="AP")){if(!n)a.APOrthoImplantFemoral.ImplantManufacturer=undefined;a.APOrthoImplantFemoral.ImplantProductLine=undefined;a.APOrthoImplantFemoral.ImplantComponentFamily=undefined;a.APOrthoImplantFemoral.ImplantSize=undefined;a.APOrthoImplantFemoral.ImplantReadyForDraw=false;a.APOrthoImplantFemoral.ImplantSvgUrl=null}if(r&&(!e||e==="ML")){if(!n)r.MLOrthoImplantFemoral.ImplantManufacturer=undefined;r.MLOrthoImplantFemoral.ImplantProductLine=undefined;r.MLOrthoImplantFemoral.ImplantComponentFamily=undefined;r.MLOrthoImplantFemoral.ImplantSize=undefined;r.MLOrthoImplantFemoral.ImplantReadyForDraw=false;r.MLOrthoImplantFemoral.ImplantSvgUrl=null}}else if(t===OrthoPlugin.EKneeImplant.Tibial_Component){if(a&&(!e||e==="AP")){if(!n)a.APOrthoImplantTibial.ImplantManufacturer=undefined;a.APOrthoImplantTibial.ImplantProductLine=undefined;a.APOrthoImplantTibial.ImplantComponentFamily=undefined;a.APOrthoImplantTibial.ImplantSize=undefined;a.APOrthoImplantTibial.ImplantReadyForDraw=false;a.APOrthoImplantTibial.ImplantSvgUrl=null}if(r&&(!e||e==="ML")){if(!n)r.MLOrthoImplantTibial.ImplantManufacturer=undefined;r.MLOrthoImplantTibial.ImplantProductLine=undefined;r.MLOrthoImplantTibial.ImplantComponentFamily=undefined;r.MLOrthoImplantTibial.ImplantSize=undefined;r.MLOrthoImplantTibial.ImplantReadyForDraw=false;r.MLOrthoImplantTibial.ImplantSvgUrl=null}}try{o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){}try{l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}catch(t){}}catch(t){}}ActionFavorite(){var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturer");var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLine");var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectFemoralComponentFamily");var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectTibialComponentFamily");e.UpdateValue(this.dataImplantSection2F7,this.GetSelectfavoriteFamily());if(!this.GetSelectfavoriteFamily().match("None")){this.controller.FavoriteItem=this.GetSelectfavoriteFamily();var l=this.controller.DataFavoriteStruct.Favorites.filter((t=>decodeURIComponent(t.Name)===this.GetSelectfavoriteFamily()));var a=l[0].Manufacturer[0].Name;this.controller.LoadDataPerManufacturer(a,true,(()=>{var r=decodeURIComponent(l[0].Manufacturer[0].Groups[0].ProductLines[0].Name);e.htmlElement.value=r;t.htmlElement.value=a;try{var s=decodeURIComponent(l[0].Manufacturer[0].Groups[0].ProductLines[0].Types[0].ProductFamilies[0].Name);var h=decodeURIComponent(l[0].Manufacturer[0].Groups[0].ProductLines[0].Types[0].ProductFamilies[1].Name);this.controller.ActionProductLineFemoralInsertImplant(s);this.controller.ActionFemoralComponentFamilyInsertImplant();this.controller.ActionProductLineTibialInsertImplant(h);this.controller.ActionTibialComponentFamilyInsertImplant();if(this.controller.APviewport!==undefined&&this.controller.MLviewport){try{var m=this.controller.APviewport!==null&&this.controller.APviewport!==undefined?this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName]:null;var d=this.controller.MLviewport!==null&&this.controller.MLviewport!==undefined?this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName]:null;var u=!this.controller.Edition?m.CurrentAnnotation:m.LastAnnotationCreatedOrSelected||this.controller.GetKneeAnnotationFromViewport(m);var p=!this.controller.Edition?d.CurrentAnnotation:d.LastAnnotationCreatedOrSelected||this.controller.GetKneeAnnotationFromViewport(d);if(u){u.APOrthoImplantFemoral.ImplantManufacturer=a;u.APOrthoImplantFemoral.ImplantProductLine=r;u.APOrthoImplantFemoral.ImplantComponentFamily=s;u.APOrthoImplantTibial.ImplantManufacturer=a;u.APOrthoImplantTibial.ImplantProductLine=r;u.APOrthoImplantTibial.ImplantComponentFamily=h}if(p){p.MLOrthoImplantFemoral.ImplantManufacturer=a;p.MLOrthoImplantFemoral.ImplantProductLine=r;p.MLOrthoImplantFemoral.ImplantComponentFamily=s;p.MLOrthoImplantTibial.ImplantManufacturer=a;p.MLOrthoImplantTibial.ImplantProductLine=r;p.MLOrthoImplantTibial.ImplantComponentFamily=h}}catch(t){}t.htmlElement.disabled=true;e.htmlElement.disabled=true;n.htmlElement.disabled=true;e.htmlElement.disabled=true;o.htmlElement.disabled=true}}catch(t){WebClient.Utils.DebugConsoleLog(t)}}))}else{this.controller.FavoriteItem=null;e.htmlElement.selectedIndex=0;n.htmlElement.selectedIndex=0;this.SetSelectFemoralComponentFamily(["--"],["--"],"--");t.htmlElement.disabled=false;e.htmlElement.disabled=false;n.htmlElement.disabled=false;o.htmlElement.selectedIndex=0;this.SetSelectTibialComponentFamily(["--"],["--"],"--");o.htmlElement.disabled=false;this.CleanImplant(OrthoPlugin.EKneeImplant.Femoral_Component);this.CleanImplant(OrthoPlugin.EKneeImplant.Tibial_Component)}}UpdateUIAdjustAPFemoralImplant(t){try{let e=this.controller.GetImplantSizeName(t,OrthoPlugin.EKneeImplant.Femoral_Component);this.rotationAPFemoralContainer.innerHTML="Rotation: "+t.Rotation.toFixed(1)+" deg";this.offsetXAPFemoralContainer.innerHTML="Offset x: "+t.OffsetX.toFixed(1);this.offsetYAPFemoralContainer.innerHTML="Offset y: "+t.OffsetY.toFixed(1);this.implantSizeAPFemoralContainer.innerHTML="Implant: "+e;this.controller.ActionsSummaryAPData["CodeRotationAPFemoral"]={Code:"CodeRotationAPFemoral",Description:`Femoral Rotation: ${Math.round(t.Rotation)} deg`};this.controller.ShowSummary(OrthoPlugin.ETemplateView.AP)}catch(t){}}UpdateUIAdjustAPTibialImplant(t){try{let e=this.controller.GetImplantSizeName(t,OrthoPlugin.EKneeImplant.Tibial_Component);this.rotationAPTibialContainer.innerHTML="Rotation: "+t.Rotation.toFixed(1)+" deg";this.offsetXAPTibialContainer.innerHTML="Offset x: "+t.OffsetX.toFixed(1);this.offsetYAPTibialContainer.innerHTML="Offset y: "+t.OffsetY.toFixed(1);this.implantSizeAPTibialContainer.innerHTML="Implant: "+e;this.controller.ActionsSummaryAPData["CodeRotationAPTibial"]={Code:"CodeRotationAPTibial",Description:`Tibial Rotation: ${Math.round(t.Rotation)} deg`};this.controller.ShowSummary(OrthoPlugin.ETemplateView.AP)}catch(t){}}UpdateUIAdjustMLFemoralImplant(t){try{let e=this.controller.GetImplantSizeName(t,OrthoPlugin.EKneeImplant.Femoral_Component);this.rotationMLFemoralContainer.innerHTML="Rotation: "+t.Rotation.toFixed(1)+" deg";this.offsetXMLFemoralContainer.innerHTML="Offset x: "+t.OffsetX.toFixed(1);this.offsetYMLFemoralContainer.innerHTML="Offset y: "+t.OffsetY.toFixed(1);this.implantSizeMLFemoralContainer.innerHTML="Implant: "+e;this.controller.ActionsSummaryMLData["CodeRotationMLFemoral"]={Code:"CodeRotationMLFemoral",Description:`Femoral Rotation: ${Math.round(t.Rotation)} deg`};this.controller.ShowSummary(OrthoPlugin.ETemplateView.ML)}catch(t){}}UpdateUIAdjustMLTibialImplant(t){try{let e=this.controller.GetImplantSizeName(t,OrthoPlugin.EKneeImplant.Tibial_Component);this.rotationMLTibialContainer.innerHTML="Rotation: "+t.Rotation.toFixed(1)+" deg";this.offsetXMLTibialContainer.innerHTML="Offset x: "+t.OffsetX.toFixed(1);this.offsetYMLTibialContainer.innerHTML="Offset y: "+t.OffsetY.toFixed(1);this.implantSizeMLTibialContainer.innerHTML="Implant: "+e;this.controller.ActionsSummaryMLData["CodeRotationMLTibial"]={Code:"CodeRotationMLTibial",Description:`Tibial Rotation: ${Math.round(t.Rotation)} deg`};this.controller.ShowSummary(OrthoPlugin.ETemplateView.ML)}catch(t){}}BuildUIAdjustControl(t){const e=div({style:{display:"inline-block",width:"50%"}});const n=div({style:{display:"inline-block",width:"50%"}});const o=div({innerHTML:"Adjust implant",style:{marginBottom:"10px"}});this.toggleStatusCissModeContainer=div({style:{marginTop:"20px",display:"flex",flexDirection:"row",justifyContent:"center"},children:[div({innerHTML:"Design mode: ",style:{width:"100px",height:"30px"}})]});DOMUtils.SetOptions(this.containerBSection2,{innerHTML:"",children:[o,e,n,this.toggleStatusCissModeContainer]});this.ToggleStatusCissMode=new WebClient.ToggleButton(this.toggleStatusCissModeContainer,WebClient.ETypeToggleButton.ButtonA,"On","Off",this.controller.CISSAutomaticImplantsMode,(t=>{this.controller.SetCISSAutomaticImplantsModeStatus(t)}));this.ToggleStatusCissMode.Create();let l;let a;let r;if(t===OrthoPlugin.ETemplateView.AP){const t=this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName];const o=!this.controller.Edition?t.CurrentAnnotation:t.LastAnnotationCreatedOrSelected;const h=div({style:{margin:"5px auto",width:"fit-content"}});const m=div({innerHTML:"Femoral component",style:{margin:"0 auto",width:"fit-content",marginBottom:"10px"}});const d=div({style:{display:"flex",flexDirection:"column",marginLeft:"10px"},children:[this.offsetXAPFemoralContainer=div({innerHTML:"Offset x: "+(o!==null?o.APOrthoImplantFemoral.OffsetX:0),style:{marginTop:"5px"}}),this.offsetYAPFemoralContainer=div({innerHTML:"Offset y: "+(o!==null?o.APOrthoImplantFemoral.OffsetY:0),style:{marginTop:"5px"}}),this.rotationAPFemoralContainer=div({innerHTML:"Rotation: "+(o!==null?o.APOrthoImplantFemoral.Rotation.toFixed(1):0)+" deg",style:{marginTop:"5px"}}),this.implantSizeAPFemoralContainer=div({innerHTML:"Implant: "+(o!==null?this.controller.GetImplantSizeName(o.APOrthoImplantFemoral,OrthoPlugin.EKneeImplant.Femoral_Component):""),style:{marginTop:"5px"}})]});e.appendChild(h);e.appendChild(m);e.appendChild(d);const u=new WebClient.AdjustControl(h,100,(t=>{this.controller.ControlAdjustAPFemoralImplant(t)}));const p=div({style:{margin:"5px auto",width:"fit-content"}});const c=div({innerHTML:"Tibial component",style:{margin:"0 auto",width:"fit-content",marginBottom:"10px"}});const A=div({style:{display:"flex",flexDirection:"column",marginLeft:"25px"},children:[this.offsetXAPTibialContainer=div({innerHTML:"Offset x: "+(o!==null?o.APOrthoImplantTibial.OffsetX:0),style:{marginTop:"5px"}}),this.offsetYAPTibialContainer=div({innerHTML:"Offset y: "+(o!==null?o.APOrthoImplantTibial.OffsetY:0),style:{marginTop:"5px"}}),this.rotationAPTibialContainer=div({innerHTML:"Rotation: "+(o!==null?o.APOrthoImplantTibial.Rotation.toFixed(1):0)+" deg",style:{marginTop:"5px"}}),this.implantSizeAPTibialContainer=div({innerHTML:"Implant: "+(o!==null?this.controller.GetImplantSizeName(o.APOrthoImplantTibial,OrthoPlugin.EKneeImplant.Tibial_Component):""),style:{marginTop:"5px"}})]});n.appendChild(p);n.appendChild(c);n.appendChild(A);var s=new WebClient.AdjustControl(p,100,(t=>{this.controller.ControlAdjustAPTibialImplant(t)}));a=button({type:"button",innerHTML:"Save",className:`topbarOptions ${OrthoPlugin.ButtonClasses.SUCCESS}`,style:{display:"inline-block",width:"80px",height:"30px"},onclick:t=>{this.controller.ActionOkAPImplantAdjust(((t,e)=>{this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ControlButtonsMainWindow(e);this.ViewTab(t)}))}});r=button({type:"button",innerHTML:this.controller.Edition?"Close":"Cancel",className:"topbarOptions red",style:{display:"inline-block",marginLeft:"5px",width:"80px",height:"30px"},onclick:t=>{this.controller.ActionCancelAPImplantAdjust(((t,e)=>{this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ControlButtonsMainWindow(e);this.ViewTab(t)}))}});l=div({style:{textAlign:"center",marginTop:"5px"},children:[a,r]});this.containerBSection2.appendChild(l)}else if(t===OrthoPlugin.ETemplateView.ML){const t=this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName];const o=!this.controller.Edition?t.CurrentAnnotation:t.LastAnnotationCreatedOrSelected;const s=div({style:{margin:"5px auto",width:"fit-content"}});const d=div({innerHTML:"Femoral component",style:{margin:"0 auto",width:"fit-content",marginBottom:"10px"}});const u=div({style:{display:"flex",flexDirection:"column",marginLeft:"10px"},children:[this.offsetXMLFemoralContainer=div({innerHTML:"Offset x: "+(o!==null?o.MLOrthoImplantFemoral.OffsetX:0),style:{marginTop:"5px"}}),this.offsetYMLFemoralContainer=div({innerHTML:"Offset y: "+(o!==null?o.MLOrthoImplantFemoral.OffsetY:0),style:{marginTop:"5px"}}),this.rotationMLFemoralContainer=div({innerHTML:"Rotation: "+(o!==null?o.MLOrthoImplantFemoral.Rotation.toFixed(1):0)+" deg",style:{marginTop:"5px"}}),this.implantSizeMLFemoralContainer=div({innerHTML:"Implant: "+(o!==null?this.controller.GetImplantSizeName(o.MLOrthoImplantFemoral,OrthoPlugin.EKneeImplant.Femoral_Component):""),style:{marginTop:"5px"}})]});e.appendChild(s);e.appendChild(d);e.appendChild(u);var h=new WebClient.AdjustControl(s,100,(t=>{this.controller.ControlAdjustMLFemoralImplant(t)}));const p=div({style:{margin:"5px auto",width:"fit-content"}});const c=div({innerHTML:"Tibial component",style:{margin:"0 auto",width:"fit-content",marginBottom:"10px"}});const A=div({style:{display:"flex",flexDirection:"column",marginLeft:"25px"},children:[this.offsetXMLTibialContainer=div({innerHTML:"Offset x: "+(o!==null?o.MLOrthoImplantTibial.OffsetX:0),style:{marginTop:"5px"}}),this.offsetYMLTibialContainer=div({innerHTML:"Offset y: "+(o!==null?o.MLOrthoImplantTibial.OffsetY:0),style:{marginTop:"5px"}}),this.rotationMLTibialContainer=div({innerHTML:"Rotation: "+(o!==null?o.MLOrthoImplantTibial.Rotation.toFixed(1):0)+" deg",style:{marginTop:"5px"}}),this.implantSizeMLTibialContainer=div({innerHTML:"Implant: "+(o!==null?this.controller.GetImplantSizeName(o.MLOrthoImplantTibial,OrthoPlugin.EKneeImplant.Tibial_Component):""),style:{marginTop:"5px"}})]});n.appendChild(p);n.appendChild(c);n.appendChild(A);var m=new WebClient.AdjustControl(p,100,(t=>{this.controller.ControlAdjustMLTibialImplant(t)}));a=button({type:"button",innerHTML:"Done",className:`topbarOptions ${OrthoPlugin.ButtonClasses.SUCCESS}`,style:{display:"inline-block",width:"80px",height:"30px"},onclick:t=>{this.controller.ActionOkMLImplantAdjust(((t,e)=>{this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ControlButtonsMainWindow(e);this.ViewTab(t)}))}});r=button({type:"button",innerHTML:"Cancel",className:"topbarOptions red",style:{display:"inline-block",marginLeft:"5px",width:"80px",height:"30px"},onclick:t=>{this.controller.ActionCancelMLImplantAdjust(((t,e)=>{this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ControlButtonsMainWindow(e);this.ViewTab(t)}))}});l=div({style:{textAlign:"center",marginTop:"5px"},children:[a,r]});this.containerBSection2.appendChild(l)}}ChangeCISSAutomaticImplantsModeStatus(t){this.ToggleStatusCissMode.SetStatus(t)}RestartControlsSelectImplant(t){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineFemoral");var n=t.GetProductLineNames();n.unshift("--");e["params"]["options"]=n;e["params"]["values"]=n;var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectFemoralComponentFamily");o["params"]["options"]="--";o["params"]["values"]="--";o["params"]["value"]="--";o["htmlElement"]["UpdateData"](o);var l=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectTibialComponentFamily");l["params"]["options"]="--";l["params"]["values"]="--";l["params"]["value"]="--";l["htmlElement"]["UpdateData"](l);var a=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownFemoralImplantSize");var r=a.htmlElement["UpDownObject"];var s=new Array;s.push(new WebClient.ValuesUD("",""));r.Items=s;r.Item=new WebClient.ValuesUD("","");a.htmlElement["UpdateInputReference"](r,false);var h=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownTibialImplantSize");var m=h.htmlElement["UpDownObject"];var d=new Array;d.push(new WebClient.ValuesUD("",""));m.Items=d;m.Item=new WebClient.ValuesUD("","");h.htmlElement["UpdateInputReference"](m,false)}SetActionsFemoralSize(){var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownFemoralImplantSize");t.htmlElement["Decrease"]=t=>{this.controller.ControlActionUpDownFemoralSize(t.Value)};t.htmlElement["Increase"]=t=>{this.controller.ControlActionUpDownFemoralSize(t.Value)}}ControlCalibrationButton(){let t;let e;let n=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);let o="";if(n===null)return;if(n===this.controller.APviewport){t=WebClient.Form.GetFieldFromForms(this.DataSection2,"BtnAPCalibration");e=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextAPCalibrationStatus");o="AP"}else if(n===this.controller.MLviewport){t=WebClient.Form.GetFieldFromForms(this.DataSection2,"BtnMLCalibration");e=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextMLCalibrationStatus");o="LAT"}if(t){let l=n.RendererPlugins[this.controller.Plugin.PluginName];let a=l.Context.ImageEntity.IsCalibrated();if(a){t.htmlElement.style.backgroundColor=WebClient.Colors.BelizeHole;e.htmlElement.innerHTML=`${o} Image calibrated`}else{t.htmlElement.style.backgroundColor=WebClient.Colors.Alizarin;e.htmlElement.innerHTML=`${o} Image not calibrated`}}else{if(!WebClient.DOMUtils.IsDisplay(this.orthoToolWindow.SelectSideMessage))WebClient.Toaster.ShowToast(`Viewport not recognized as AP or LAT`,WebClient.Colors.Wisteria,5)}}SetActionsTibialSize(){var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownTibialImplantSize");t.htmlElement["Decrease"]=t=>{this.controller.ControlActionUpDownTibialSize(t.Value)};t.htmlElement["Increase"]=t=>{this.controller.ControlActionUpDownTibialSize(t.Value)}}GetSelectFemoralComponentFamily(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectFemoralComponentFamily").htmlElement.value;return t}catch(t){return""}}GetSelectTibialComponentFamily(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectTibialComponentFamily").htmlElement.value;return t}catch(t){return""}}GetSelectfavoriteFamily(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectfavoriteProductLineKnee");return decodeURIComponent(t.htmlElement.value)}catch(t){return""}}SetSelectfavoriteFamily(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectfavoriteProductLineKnee");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o)}GetSelectManufacturer(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturer");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}SetSelectManufacturer(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturer");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}GetSelectProductLine(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLine");var e=t.htmlElement.value;return e}catch(t){return""}}SetSelectProductLine(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLine");o.htmlElement.innerHTML="";t.unshift("--");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectFemoralComponentFamily(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectFemoralComponentFamily");o.htmlElement.innerHTML="";t.unshift("--");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined)o["params"]["value"]=n;else o["params"]["value"]="--";o["htmlElement"]["UpdateData"](o);switch(n){case"--":case null:case undefined:this.SetUpDownFemoralImplantSize([new WebClient.ValuesUD("-","-")],"");break}}SetSelectTibialComponentFamily(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectTibialComponentFamily");o.htmlElement.innerHTML="";t.unshift("--");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined)o["params"]["value"]=n;else o["params"]["value"]="--";o["htmlElement"]["UpdateData"](o);switch(n){case"--":case null:case undefined:this.SetUpDownTibialImplantSize([new WebClient.ValuesUD("-","-")],"");break}}GetUpDownFemoralImplantSize(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownFemoralImplantSize");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}GetUpDownTibialImplantSize(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownTibialImplantSize");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}SetUpDownFemoralImplantSize(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownFemoralImplantSize");var l=o.htmlElement["UpDownObject"];l.Items=t;if(e!==undefined&&e!==null){var a=t.filter((t=>t.Value===e));var r=e;if(a.length>0)r=a[0].Text;l.Item=new WebClient.ValuesUD(e,r)}if(n!==undefined&&n!==null){l.Index=n;o.htmlElement["UpdateInputReference"](l,true)}else o.htmlElement["UpdateInputReference"](l,false)}SetUpDownTibialImplantSize(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownTibialImplantSize");var l=o.htmlElement["UpDownObject"];l.Items=t;if(e!==undefined&&e!==null){var a=t.filter((t=>t.Value===e));var r=e;if(a.length>0)r=a[0].Text;l.Item=new WebClient.ValuesUD(e,r)}if(n!==undefined&&n!==null){l.Index=n;o.htmlElement["UpdateInputReference"](l,true)}else o.htmlElement["UpdateInputReference"](l,false)}ViewTab(t){if(t!==null&&t!==undefined)t.CanDragPoint=false;this.orthoToolWindow.MainSection.style.display="block"}GetOrthoToolWindow(){return this.orthoToolWindow}ValidateSelectedAPMLViewports(){if(this.controller.APviewport&&this.controller.MLviewport){this.ContainerViewSide.style.display="none";this.orthoToolWindow.OuterContainer.style.height="auto";this.orthoToolWindow.OuterContainer.style.overflow="visible";this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.orthoToolWindow.MainSection.querySelector(".margin").style.minHeight="max(calc(100% - 20px), 540px)";this.OrthoFloatingBar.Element.querySelector("#BtnShowHide").style.display="block";this.controller.ViewportsSelected=true;let t=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);if(t===this.controller.APviewport){let t=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAP");t.htmlElement.click()}else if(t===this.controller.MLviewport){let t=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnML");t.htmlElement.click()}this.controller.CreateInitialAnnotation(null)}}startOver(){try{var t=this.controller.APviewport!==null&&this.controller.APviewport!==undefined?this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName]:null;var e=this.controller.MLviewport!==null&&this.controller.MLviewport!==undefined?this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName]:null;switch(this.controller.ActionKnee){case OrthoPlugin.EActionKnee.APFemoralWithComponent:case OrthoPlugin.EActionKnee.APTibialWidthComponent:case OrthoPlugin.EActionKnee.APTibialResection:case OrthoPlugin.EActionKnee.APFemoralResection:if(t===null)return;t.Context.AnnotationController.ResetOnlyCurrentGroup();switch(this.controller.ActionKnee){case OrthoPlugin.EActionKnee.APFemoralWithComponent:var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"textWidthFemoralComponentDistance");n.htmlElement.style.display="none";var o=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFemoralWithComponent");o.htmlElement.click();const t=o.htmlElement;this.AddRemoveCheckControlToButtons(false,t);break;case OrthoPlugin.EActionKnee.APFemoralResection:var l=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFemoralResection");var a=l.htmlElement;this.AddRemoveCheckControlToButtons(false,a);break;case OrthoPlugin.EActionKnee.APTibialResection:var r=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAPTibialResection");var s=r.htmlElement;this.AddRemoveCheckControlToButtons(false,s);break;case OrthoPlugin.EActionKnee.APTibialWidthComponent:var h=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAPWithTibialComponent");var m=h.htmlElement;this.AddRemoveCheckControlToButtons(false,m);break}t.Context.Renderer.Render();t.Context.OverlayRenderer.Render();break;case OrthoPlugin.EActionKnee.MLFemoralFitLine:case OrthoPlugin.EActionKnee.MLTibialLongitudinalAxis:if(e===null)return;e.Context.AnnotationController.ResetCurrentGroup();if(this.controller.ActionKnee===OrthoPlugin.EActionKnee.MLTibialLongitudinalAxis){var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextMLTibialAngle");n.htmlElement.style.display="none";var d=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnMlTibialLongitudinalAxis");d.htmlElement.click();const t=d.htmlElement;this.AddRemoveCheckControlToButtons(false,t)}else if(this.controller.ActionKnee===OrthoPlugin.EActionKnee.MLFemoralFitLine){var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextMLFemoralDistance");n.htmlElement.style.display="none";if(e.CurrentAnnotation)e.CurrentAnnotation.DistanceAPDimensionPoints=null;var u=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFemoralFitLine");u.htmlElement.click();var p=u.htmlElement;this.AddRemoveCheckControlToButtons(false,p)}e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();break}}catch(t){WebClient.Utils.DebugConsoleLog(t)}}buildSetViewSideAPLAT(){const t=div({innerHTML:"AP View: ",style:{width:"100px",display:"inline-flex",fontSize:"13px"}});this.ButtonSelectAPView=button({type:"button",textContent:"Select",className:"blue",id:"buttonSelectAPView",style:{margin:"0 0 0 2px",width:"60px",height:"30px"},onclick:t=>{this.controller.ReadyForSelectedViewports=true;this.controller.KneeImplantView.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ContainerViewSide.querySelector("#buttonSelectAPView").classList.remove(OrthoPlugin.ButtonClasses.ENABLE);this.ContainerViewSide.querySelector("#buttonSelectAPView").classList.add(OrthoPlugin.ButtonClasses.ACTIVE);this.ContainerViewSide.querySelector("#buttonSelectMLView").classList.remove(OrthoPlugin.ButtonClasses.ACTIVE);this.ContainerViewSide.querySelector("#buttonSelectMLView").classList.add(OrthoPlugin.ButtonClasses.ENABLE);WebClient.Toaster.ShowToast("Select a viewport for AP view.",WebClient.Colors.Wisteria,5);if(this.controller.Plugin.Controller.ToolSelect!=="OrthoAnnotationKneeImplant")this.controller.Plugin.Menu.ProcessKneeImplantToolEvent(null,false)}});const e=label({innerHTML:"ML View: ",style:{width:"100px",display:"inline-flex",fontSize:"13px"}});this.ButtonSelectMLView=button({type:"button",textContent:"Select",className:"blue",id:"buttonSelectMLView",style:{margin:"0 0 0 2px",width:"60px",height:"30px"},onclick:t=>{this.controller.ReadyForSelectedViewports=true;this.controller.KneeImplantView.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.ML];this.ContainerViewSide.querySelector("#buttonSelectMLView").classList.remove(OrthoPlugin.ButtonClasses.ENABLE);this.ContainerViewSide.querySelector("#buttonSelectMLView").classList.add(OrthoPlugin.ButtonClasses.ACTIVE);this.ContainerViewSide.querySelector("#buttonSelectAPView").classList.remove(OrthoPlugin.ButtonClasses.ACTIVE);this.ContainerViewSide.querySelector("#buttonSelectAPView").classList.add(OrthoPlugin.ButtonClasses.ENABLE);WebClient.Toaster.ShowToast("Select a viewport for LAT view.",WebClient.Colors.Wisteria,5);if(this.controller.Plugin.Controller.ToolSelect!=="OrthoAnnotationKneeImplant")this.controller.Plugin.Menu.ProcessKneeImplantToolEvent(null,false)}});const n=div({children:[t,this.ButtonSelectAPView]});const o=div({children:[e,this.ButtonSelectMLView]});const l=div({style:{display:"flex",flexDirection:"column",gap:"10px",margin:"10px"},children:[n,o]});this.ContainerViewSide.innerHTML="";this.ContainerViewSide.style.display="flex";this.ContainerViewSide.appendChild(l)}buildShowHideAnnotation(){var toogleDesign=t=>{var e=this.controller.APviewport!==null&&this.controller.APviewport!==undefined?this.controller.APviewport.RendererPlugins[this.controller.Plugin.PluginName]:null;var n=this.controller.MLviewport!==null&&this.controller.MLviewport!==undefined?this.controller.MLviewport.RendererPlugins[this.controller.Plugin.PluginName]:null;this.controller.Plugin.HideAnnotationSpecialForOrtho=!t;try{var o=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected||this.controller.GetKneeAnnotationFromViewport(e);if(o)this.controller.APviewport.SwitchVisibleAnnotations(t,o.Name,o)}catch(t){}try{var l=!this.controller.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected||this.controller.GetKneeAnnotationFromViewport(n);if(l)this.controller.MLviewport.SwitchVisibleAnnotations(t,l.Name,l)}catch(t){}};const t=input({type:"radio",name:"radioBtnDesign",id:"bbSideYes",value:"Yes",checked:true,onchange:t=>{var e=t.target;if(e.value==="Yes")toogleDesign(true)}});const e=input({type:"radio",name:"radioBtnDesign",id:"bbSideNo",value:"No",checked:false,onchange:t=>{var e=t.target;if(e.value==="No")toogleDesign(false)}});const n=div({id:"BtnShowHide",children:[div({className:"label",innerHTML:"Show design: "}),div({className:"buttonbar",children:[t,label({htmlFor:"bbSideYes",innerHTML:"Yes"}),e,label({htmlFor:"bbSideNo",innerHTML:"No"})]})]});if(WebClient.DOMUtils.IsDisplay(this.orthoToolWindow.SelectSideMessage))n.style.display="none";this.orthoToolWindow.LeftTopSection.appendChild(n)}cleanClassColorOfButtonDisabled(t){for(var e=0;e<t.GetFields().length;e++){var n=t.GetFields()[e].htmlElement;if(n.disabled){DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.ACTIVE);DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.ENABLE)}}}}OrthoPlugin.KneeImplantView=KneeImplantView})(OrthoPlugin=Products.OrthoPlugin||(Products.OrthoPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){class LayoutController{constructor(e){this.Plugin=e;this.LayoutView=new t.LayoutView(this);this.StatusButtonIsActive=false;this.LayoutOptionActive=false}CloseLayoutWindow(){this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.Plugin.LayoutController.LayoutView.OrthoFloatingBar.Id);this.Plugin.LayoutController.LayoutView=null;this.Plugin.Controller.SelectDefaultTool()}static Create(t,e,n){var o=new LayoutController(t);o.ButtonNameOptionInToolbar=e;o.ButtonMenuParentName=n;o.LayoutView.InitFormDataAndEvents();return o}}t.LayoutController=LayoutController})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(e){var n;(function(e){var n=Efferent.Frontend.WebClient;var o=Efferent.Frontend.WebClient.DOMUtils;const{div:l,img:a,button:r}=o;class LayoutView{constructor(t){this.parallelGIFbase64="data:image/gif;base64,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";this.perpendicularGIFbase64="data:image/gif;base64,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";this.angularStep1GIFbase64="data:image/gif;base64,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";this.angularStep2GIFbase64="data:image/gif;base64,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";this.selectReferenceGIFbase64="data:image/gif;base64,R0lGODlh2ACEAPcCACk8S////wgOEwkQFQoRFwoSGAsTGQsTGgsUGgsUGwwVHAwWHQ0WHg0XHw0XIA4YIA4YIQ4ZIQ4ZIg8aIg8aIw8bJBAbJRAcJRAcJhAdJxEdJxEeKBEeKRIfKhkhJhIgKhIgKxMhLBMhLRMiLRMiLhQiLhQjLx0mLxQjMBQkMBUkMBUkMRUlMRUlMhYmMxYmNBYnNBYnNRcnNR0nMBcoNRcoNhcpNxgpOBgqOBgqORgrOhkrOhksOhksOxksPBktPBotPBotPRouPRouPhsvPyIvOiw1PTY7PjY7PxsvQBswQBswQRwwQRwxQRwxQiU1QiY3RCY4Ri44QSg7SjY8QDc9QTc9Qjg/RDk/RTtCSDtDSTZGVDdIVj5IUEJPWUVVYllgZVNibmRoa2Vpa2VpbGZqbWZrbmhuc2Jwe2tzend8gXB8hn+JkoaKjpWZnZaanZukqqOmqKSmqaSnqqSoqqaqraetsqmxtqqxtrS3ubi+w8PFx8bLz9HT1NLU1dLU1tPV19TW2NTX2dTX2tXY2+Hi4+Pl5/Dx8fHx8fHx8vHy8vHy8/Hz8yo+TjhLWnF/iYCLlaqyucfM0NXZ3OPm6PLz9EhOU0VVYUZWY2Nwe42Xn/Hz9PX19fb29vf39/z8/P39/f7+/hojKVhdYcLExe3t7fLy8vPz8/T09Pj4+Pn5+fr6+vv7+yc1Pyk+PzZLO2t/LSY4Ryk9TV1pcXiLKqCyH7rMGcfZFdTmEuHxCuX1C+b2C+f3C+LzDuj4C+n6C+r7C+v8C+z9C+3+C+7/C+/+KvD/KuDtOOj1OObyQ+34WOv0dnB+iHiDjH+KlI+Pj5KSkpqamqKioqyxtLS0tLm5ufH5hfP4s8DAwMLCws3Q08/R09TU1NfX19PW2ODj5eXl5enp6evs7ezs7P3+8QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hlPcHRpbWl6ZWQgdXNpbmcgZXpnaWYuY29tACH5BARkAP8ALAAAAADYAIQAAAj/AJ0IHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo8ePIEOKHEmypMmTKFOqXMmypcuXMGPKnEmzps2bOHPq3Mmzp8+fQIMKHUq0qNGjSJMqXcq0qdOnUKNKnUq1qtWrWLNq3cq1q9evYMOKHUu2rNmzaNOqXcu2rdu3cOPKnUu3rt27ePPq3cu3r9+/gAMLHky4sOHDiBMrXsy4sePHkCNLnky5suXLmDNr3sxZaiNIkgKIlgSpUeeEn0OPLv0RUiXRsEVXgnTaoOvYsGd3jIS7d6TaA3n3jv1bIyTYlB45cuLoESXYtGsfF518efPnoqNfbPQ6wCTTBBtN/5INnjN30d8LiiePcTql8uGxa9/sHv7ARvIxqn6U8NHo0/v1999FsC2HkCPDJajgggw26OCDEEYo4YQPGngQgqJhBNtCFHbo4YcghijighxmSKBoFhqE4Ygstujiix+mWNCK+onGH0L+BSAJgDYKqGN71NknEH7ZnVbfQUQGMB9F53ln33oBVCIkZk2mF954UU4p0XQBVMecc9ABx6WX14WpkXAKFgccmgmqaVx3uOkG3EC39SZnR6nBRpqWp+W5Gp9zBirooIQWauihiCaq6KKMNuroo5BGKulgmWiCCRFJKLEEE01MutElsunBBheYasqppxcZgpshd6wxRamnov8akQt2KEgIHGHAGqusCtmAQhoO8sHGF7p2yqtBNZQgRYSM6LEGqZnueqyvFvxBIatoAGDqtDekgMEbHi6yxRDRcrsBGB2K62uxssIAwgkUKtKFCC7kEES57SZLwR4SJpIFBR2sgMO90qKKwgVtMHvFAgC3YO+2026gBYSHVHHAAxqYkCy7+UqQyIN9eMCABfTqQG7B7VaQB4R+zBDwwBx3rEaEgBQRQw8xd2yEhIE8gfOm0xKkbyE8Q0Fw0EJfQMeEg0RxMtLktrDBGXYyaMfGKHcc5xFipPlBvU9DPQIFfuSGhAACjDHcHBBwwALMxiJ9sBuyUTEAAXiTgZscCkx98LXJEJt7bpYFINC34WXAFsfFGWMNdakhUOBvAiNXYPnIZgSweAMYjADDDmE/frAEDkRwwcsBc24J5Z2/8HDWEW+QgdsO30wv6aaXfPTjsdarse04u546CWDnLDrckNf+ORDGH8/xurvzLv301Fdv/fXYZ6/99tx37/1dAQEAIfkEBWQAjQAsbgBAACIAOgAACP8AA4QayKrgJ1AEBSpcyLBhw1SqOEmEaDChw4sLEZXKaOpUJ4oILWIU2EQJER84DDE0dGfNlJMmSzqZSbOmzSA4XNjBSAhOGJhLmMi8eRNFmpEK+bD5AlQoUZglpCBlyEjPGi5Ni5qw8GeqQ5ZoAMS0mQLDG68XF20ZksRp0BwtNoBB+9CLDZRjoZ6gm7GLCBdw29asMYLCHr4BEmWh0GFFTsGDL7Thi+jKAsYtAg9lG1cL3UNVDjzQYIJwVqgSEqHt44GBhb862LodWqJCHrp+ZjR+PDuyGr6AisTocTqyEcSBnhB/+7RwIeRQcPaOTAdxgEFRZDffcOYhUjs18G7B35vxiBiMdT4A1q6Vgh+FoAUIGONwDgQOLHhvdyMwPoH/ZDAkhwITqBdbXmTJlZgVBSBAoINlKBSHaKSFV5xTMYRAgWIJuFbBh66ZEQApFI4Aww7sbSeBAxFcsFtjDSQwiigxwibdUzG98FcG+GWW4Y4sYmDjhe3lx5uOMJKwHpHN6SedjycCwWSTxd2F4pQ4Iqglc1l26eWXYE4X5phklmnmmWimqeaabLbp5ptwxinnnHTWaeedeOap55589qlmQAAh+QQFZAACACwMADkAwAARAAAI/wAFCBTgipYtYght0XI1sKHDhxAjSpxIsSLFRpAkBdgoCVIjiyBDirRY8GDChRBp9ULIkiWtkTBjypwIqdLGmxsrQZrJs+dAlS1bvmxYK6jRWj6TKoUYCafTjZGWSq1Y1GhLpAKBEsMF65WAV7BwuZxKdiakm5QeORLg6BGlmzvLyhWglatXsGIRvnS1civDhq5usfw7t7DERjYDTPoIeFJOxoaV8kV4i7DAwIOB4rI8EDOxoZFDDzwbgBJkwG8DxBXdUzPny3kN6pUIKyFr1hoDPJL4iOPtniZh0U7I0mvEV1aTK1/OvLlz5gONDZsOrHowYcOKDXzOvbv3lsYhItAPSvG7+fPoWW7H7kuZNWS6dvn6tT69ffPlg4Z/OP6+//8tRWfdMQKRc80yydRHHYAM6idRf8ENR4wtv4WWGzMTfdKJNxXOFGFEtU3oGkSegdahXKR9A8CJZY34UImT+eWQZ728xuJSiIXyiTax3ChVjJXNKBhCDNXV1VdhjeUjijpyss0srSyZlJF3JTmbQFUph5WUZTXlSTjcUPMMOFzylGVyW2bVl1EmljmVM+KM00010GTj5kxasUmibCfZeKdkzUyDTTTS/ClTSSwpZFlAADs=";this.lineGIFbase64="data:image/gif;base64,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";this.circleGIF1base64="data:image/gif;base64,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";this.circleGIF2base64="data:image/gif;base64,R0lGODlh2ACEAPcTAA4ZIhEdJyIvOhsvQBwxQjtDSVVlcWZrbn+JkoaKjo6YoZylraSnqqetsri+w8fM0DY7P0VVYqqxtggOEwkQFQoRFwoSGAsTGQsTGgsUGgsUGwwVHAwWHQ0WHg0XHw0XIA4YIA4YIQ4ZIQ8aIg8aIw8bJBAbJRAcJRAcJhAdJxEeKBEeKRIfKhkhJhIgKhIgKxMhLBMhLRMiLRMiLhQiLhQjLx0mLxQjMBUkMRUlMRUlMhYmMxYmNBYnNBYnNRcnNR0nMBcoNhcpNxgpOBgqOBgqORgrOhkrOhksOhksOxksPBktPBotPBotPRouPRouPhsvPyw1PTY7PhswQBswQRwwQRwxQSU1QiY3RCY4Rig7Sik8Syo+TjY8QDc9QTc9Qjg/RDk/RTtCSDZGVDdIVj5IUDhLWkJPWUVVYUZWY1lgZVNibmRoa2Vpa2VpbGZqbWhuc2Jwe2Nwe2tzend8gXB8hnF/iY2Xn5WZnZukqqOmqKSmqaSoqqaqrbS3ucPFx8bLz9HT1NLU1dPV19TW2NTX2dTX2tXY29XZ3OHi4+Pl5/Dx8fHx8fHx8vHy8vHy8/Hz8/Hz9P///wwUG/7+/io9TTZIVjdKWERNU0hOU2JobWRrcWtyeWp4gW17hHV9hXuEjIWHiY+Pj4qUnZKSko2XoLS0tLO5v7W6vbm5ucLCwtTU1NfX19PX2tTY29fa3OXl5enp6ezs7PLy8vPz8/X19ff39/j4+Pr6+vv7+/z8/P39/VhdYRojKRQkMBUkMBcoNS44QZaanamxtsLExdLU1hskFykvDjI3CBQiLBgrOSk+Py5AMzZLO0VKA01TBFRaBF9mBGZtBWpyBWVwEEhaLkRYOE9iM1FlNF5yMWBvImt/LWNmMik7Sjc+QjhKWUNNVURWV1BVWmh4bGZtc2ZxenmCBnaCE3iLKoWOBoyYD5eiB5ytHp+xH6GsB6e5HYWYJpOlI7fECbrMGcDOCc3cCsfZFdrqCtTmEu3+C+//GvD/Kuj1OKe0R4aKY+34WCH/C05FVFNDQVBFMi4wAwEAAAAh/hlPcHRpbWl6ZWQgdXNpbmcgZXpnaWYuY29tACH5BARkAP8ALAAAAADYAIQAAAj/AAkIHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo8ePIEOKHEmypMmTKFOqXMmypcuXMGPKnEmzps2bOHPq3Mmzp8+fQIMKHUq0qNGjSJMqXcq0qdOnUKNKnUq1qtWrWLNq3cq1q9evYMOKHUu2rNmzaNOqXcu2rdu3cOPKnUu3rt27ePPq3cu3r9+/gAMLHky4sOHDiBMrXsy4sePHkCNLnky5suXLmDNr3sy5s0MzdhQosGPGs0wDDySpXv3AgGmXC1bLXr3g9crYrEWnpm0bpYHViEoPNINoteveJXcj4mKQS3FJD5CTNLNauEHqqq1L/2hHdfSEu+1s/w+pQLUChaUoUTo//mN5SeytVJki504aKANG4cpVqj137wWhoVokDrwyCy2eTEHFfP5phJ0k2hGhyGy6nFKHFvgpKF+DFilXyQBNELFDAxQCl8caGS64IYcQ/eadJUoIccMcJVIICAIRpMggiw3hpkstqHyySSg11giJA3WQoSOPC/kYyyqmiAJLkVQqIkEcW2jIZEKo3SILK6mQogqVZD4yxhMgbqnQJZ2AwgkmmpBZpJkyLqkmQj28YIOcJTpSRgw7FBHijnceFIQMJPzBp2yNiEECCziImGaheN5wQgKLDggGB4/qIKiWlBqqQgGZLuIFBiAEUMOhdoZKkA8vAP/QyKKBtNCBCYAagSahrr5KQwl+ZCoIEJBKymuvvtKRKXQC+JBEq8gyyIMLUSzL7LMqRmvQoSQkYm0hWAyqrah8WCuJIVnsOq6vKsBB4SJkNhBEjMdqm+eejErBRpF9uBCouuumiaggq5k6wQRtlMhACCvkYGzAGlqKh6YUVGCxG7PtscEI/uoKasA6qKCGJIx8YUEGG6P8Bm2oqjovtPbCQEKjGtxaws23HiCJxh6gIEMPRwAMcYiWAvCBCCcUC+nRmaScq7hDRwxoCg17CuvUDLv8ab0gB7qqs9hOG6ueQEMdta91Qs3qv2afzXW29Ho8qdt012333XjnrffefPck7fffgAcu+OCEF2744YgnrvjijDfu+OOQRy755JRXbvnlWAUEACH5BAVkAJMALGcAHQBGAEYAAAj/AAkIHEiwoMGDCBMqXMiwocOCcu6kgTJgCpUqVh5q3NgQjSRJkRwgIEPRIkaOKFMSUfSxpaJhdbSUPKmypsIdDVrq/Hgoz5qZNG0KFXJjzs6jHwEhiAA041CUQWgEQ0oVpIM6JCsGfeqwholiVcO+jLPFJNeuKISFXftozBOtZxnqUKFmbdW2RJvGRdjjhQ27SB2VibGjSBO4e/nKIPEHsM5GYkiwwEHk8NbEBW+cSOD4IyMwHCTrMGwW88G5BTov8oIBRIAaUfWaJujjBYBGjgO16GCCsJG3l2drpVHCT2dBQCZXli3cJI4AdDpLGiTARxLmzSnycBFF+vQr1y9m/z+9OJH3QlgsjyfPx/t34Oszq4BzdNHaBrGDZ+/797EUNlX14UJh8MU3HAmCtLTaBBO0gRQDIayQw3JOGTiEZnh41gUFFXToxk57bDDCgL+VZiFdIH1hQQYisvhGS3q09lp+Fp5UGwmQacBbCTzydoAkxMgoQw9HFFgjUa99IMIJyk3mgQa89PKkb+od+dZ2KqQg4Wg3aqkkClTqZYYdCihghxn7FQabdeFhmSSBTRnwwFEPGJAmhdoBwyWRTOgV1gJWtlmkbC09UOacMAbap5EETYfmQGYg0pKdiuqHCBcGcSHpe5Ue9KhBZrT0aY0pIWoHqTUp8JECqKqkqiSstleKkqmyJjQqQaF+dGutA12a6aYP8IqQo7huKgmlwhZU6KE6AZqsQX8+e5CcdCIrLahkmrnrtdx26+234IYr7rjklmvuueimq+667Lbr7rvwxivvvPQeFBAAIfkEBWQAWwAsNwAMAHYAbACGDBQbDhkiER0nFCIsGCs5GyQXGy9AHDFCIi86KS8OKTtKKT4/LkAzMjcINks7Nz5COEpZO0NJQ01VRFZXRFg4RUoDSFouTVMET2IzUFVaUWU0VFoEVWVxWF1hXnIxX2YEYG8iY2YyZXAQZmtuZm0FZm1zZnF6aHhsanIFa38tcX+IdoITeIsqeYIGf4mShY4GhZgmhopjhoqOi5WejJgPjpihk6UjlZ2llpeYl6IHnKWtnK0en7EfoawHpKeqp62yp7RHp7kdt7i5t8QJuL7DuswZwM4JxMfJx8zQx9kVzdHTzdwK1OYS1dja2uoK3eK55ebn6PU47fhY7f4L7/8a8PLj8P8q8fmF+P+V+fzT/v7+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB/+AB4KDhIWGh4iJigoGi46PkJGSk4kOGhosMJqbLJcOgoyUoqOkkxowRUlTq6ytrlNJQTAapbW2pBSor7u8rkUwFLfCw4UONky9U0VFspuay0XJTDbBjdbE2JEpqq9MRZ0LioQLmKm7SSnX2euJMLvfn+qUDixBuzCh4uy2ME6+LPmIpYjmCp++faNSvLIRD6ExV04AIhxGgSAriRPH9WtVpFpGUu5YOYHBgMDHQyFZGTwAwcWMGS4gnKzEbVWRhjMNObDHKskJJFqCCkXCISchD62Y0DKqSAOyKViEShWqg2nKKTsCMk0UJOrQGjWAUs3Jo5WHrZA4CM1ihccgCE3/hBbNyMBiEo9oxYllazOcoLhakHysWURrXkQQhE6omcRv4qAyEdZ0e/igiqCCD+zoGUqsCoQWg8irjKhG0BqDdki5EmVIoxmn95VdRZm0PtNaUFsDIvSJyyq52aXMavugC8zqgE/V8sOwLaQ2Rxc/9FhLZJM/lgttomPuQXEO/MGKIH26IbFNQg0woX05Ehdbyh+sidO8IrWYyQ940L4/ERXXfZfSWfZ9p4NQUPhQQgZQ9OcgFFt8Jp8gFLBSW4EHHagFFE0IIcMRDoZYRYCIEMSEcxgmwsERHBKBgw8h9jeiSTQeotAqS6UoCQQmqDCCBDFqN2ONiLBSmI6jCBAA/4hBIhiBkgMQWUhK9SH5HQEDBCBDk0FV8UAASko5zkVWJilABFx6CQCYUYrZSEhO+FUmJUoqF6MSWYLp5iAqzWmmEFziGeaeN04hp5+SZHlZoAjsKQg3NiCa5AJc5rdnhatUKak+WAbQYKXpuWlDdJvSGQCMlWoRqiFPYVTqlVmWkCpzYmJq6KumTlVFCDH090ObU9KGq6mAbbhFAxX0upwPbEpJUDrDJioAbmomsMEFylK1JrA0KsCKptEmgmUHG365JgkfbDCCtttKqcEqJ4YLa5ZqsrlCCygUsO4R23I7SEiiyTsvlPbm8EIFAHSQp7+preKqwOJ0OigBIPTQg/8IbE7MKo55tfRSTBMOIzGNFiwxBA0LM8xnplut6J53+9RIIwNOmJylyoM4wMpWGrZXVUZSTlFzSY4e8K4yTPUcGFhiBfVzTtE4YUHRRpM6E36qBgiXXEYRlGMiLFh9EnrkGQJYZjPx9DBKq8AQMjHVkfiWYjmFtFI7bee0KNqHePb2MHaHHPhMuOlWWmwz2Y3iv3kTjvjhwSXeuCKDn7S3ImK5UPfkeE9xd0ZxI0a35J7rEzbSOZF9yNldO6zP0UX8PQzWTWhdLMwfef262CcpjQTTUj09k+7g7Zy0g8LP9O1BxjPl8lREodW8ONxg0LFLNQCY19GNHfQsxKWEdKT/PgCDTwpPnyfCvfmjPPW1OMuzL4nOq0jyvfza8C5O+fh/h/780+ufIliBl/m4ToCKOF28JDEq1CGwRMKahK3AhUD6TaGA34HUAw/RwO5RQoGL6594oCWKPm2QcfUDCbxCyD7xpG8SJtxgSlhIvvhVkEy2EE/AEMgTJ5StFqebwvvYd7QpsEB2+jDRoVqov1LYaofs48kFsTEg+RXqhbaoCQajZSsPYsOCXgwXA7jhw31ABxZIRFJNCLSP4chrNqXLiBShWCo4XmgiocEVHMd3ksnUsSdEywljaFicCNiFkOuwyxbtQwHCBHIrcBQiks6IFdtcJVIFYkAksbgVSirFijxOEQkbC1kTrFBwJjtJyikPc5U4biUCQeQchiqSFE620ReLLFChLLTKWxhDPPBaW5laqYwUIHISA4EIDH74x1fAwxb0sEgrbCmpbZxDFkOsxCnM0Q1hhosCx0hGKprhDGhIgxoPzIU0k8FOZQDjhIXYZinbmYRvWA+e+rAEJpyhiU5ooJf4ZF8gAAA7";this.controller=t;this.orthoToolWindow=new e.OrthoToolWindow;this.BuildUI()}BuildUI(){this.orthoToolWindow.InitComponents();this.OrthoFloatingBar=this.controller.Plugin.ManagementFloatingBar.CreateFloatingBar(document.body,"orthoCissDialog",true,"LayoutTool",(()=>{this.controller.Plugin.Controller.ResizeViewports()}));this.orthoToolWindow.ButtonsElementsContainer.style.height="140px";this.orthoToolWindow.LeftTopSection.innerHTML="Layout Tools";this.orthoToolWindow.LeftTopSection.className="leftTopSection";this.orthoToolWindow.LeftTopSection.style.marginBottom="8px";this.orthoToolWindow.OuterContainer.className="middleSection";this.orthoToolWindow.MainSection.appendChild(l({className:"margin",style:{minHeight:"max(calc(100% - 20px), 550px)"},children:[l({className:"topSection",children:[this.orthoToolWindow.LeftTopSection,this.orthoToolWindow.RightTopSection]}),this.orthoToolWindow.OuterContainer]}));this.orthoToolWindow.OuterContainer.style.overflow="visible";this.actionContainer=l({innerHTML:"To use the Layout Tool, you need a reference line selected.",style:{border:"dotted 1px white",height:"213px",overflowX:"hidden",overflowY:"auto",fontSize:"13px",display:"flex",flexDirection:"column"}});this.orthoToolWindow.TabsContainer.appendChild(this.actionContainer);this.OrthoFloatingBar.Element.innerHTML="";this.OrthoFloatingBar.Element.style.height="";this.OrthoFloatingBar.Element.appendChild(this.orthoToolWindow.MainSection)}InitFormDataAndEvents(){this.orthoToolWindow.ButtonsElementsContainer.innerHTML="";var l={};var r;var s;this.DataSection1=[l];this.controller.Plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",this.controller.ButtonNameOptionInToolbar,"optionInMenuPressed");var cleanGroup=t=>{for(var n=0;n<t.GetFields().length;n++){var l=t.GetFields()[n].htmlElement;o.RemoveClass(l,e.ButtonClasses.ACTIVE);o.AddClass(l,e.ButtonClasses.ENABLE)}};l["actionBtnCalibration"]=t=>{this.controller.StatusButtonIsActive=true;this.controller.Plugin.Controller.SelectTool("Pointer","pointerTool");this.controller.Plugin.CalibrationOptionFromMainMenu=false;this.controller.Plugin.Menu.ProcessCalibrationToolEvent(null,"calibrationTool","eFit",null,null,(()=>{this.controller.Plugin.Menu.ProcessLayoutTool(t,this.controller.ButtonNameOptionInToolbar,this.controller.ButtonMenuParentName)}))};l["actionBtnParallelLine"]=t=>{this.controller.LayoutOptionActive=true;r=this.DataSection1[0]["forms"][0];cleanGroup(r);var l=n.Form.GetFieldFromForms(this.DataSection1,"BtnParallelLine").htmlElement;o.RemoveClass(l,e.ButtonClasses.ENABLE);o.AddClass(l,e.ButtonClasses.ACTIVE);this.controller.Plugin.Menu.ProcessParallelLineToolEvent();this.actionContainer.innerHTML="<b>Parallel line:</b>Click on a point to create a parallel copy of the selected reference line.";var s=a({src:this.parallelGIFbase64,style:{margin:"15px auto"}});this.actionContainer.appendChild(s)};l["actionBtnPerpendicularLine"]=t=>{this.controller.LayoutOptionActive=true;r=this.DataSection1[0]["forms"][0];cleanGroup(r);var l=n.Form.GetFieldFromForms(this.DataSection1,"BtnPerpendicularLine").htmlElement;o.RemoveClass(l,e.ButtonClasses.ENABLE);o.AddClass(l,e.ButtonClasses.ACTIVE);this.controller.Plugin.Menu.ProcessPerpendicularLineToolEvent();this.actionContainer.innerHTML="<b>Perpendicular line:</b>Click on a point for the extreme of a perpendicular line to the selected reference line.";var s=a({src:this.perpendicularGIFbase64,style:{margin:"15px auto"}});this.actionContainer.appendChild(s)};l["actionBtnAngularLine"]=t=>{this.controller.LayoutOptionActive=true;r=this.DataSection1[0]["forms"][0];cleanGroup(r);var l=n.Form.GetFieldFromForms(this.DataSection1,"BtnAngularLine").htmlElement;o.RemoveClass(l,e.ButtonClasses.ENABLE);o.AddClass(l,e.ButtonClasses.ACTIVE);this.controller.Plugin.Menu.ProcessAngularLineToolEvent();this.actionContainer.innerHTML="<b>Angular line:</b>1 - Click on a point to start an angular line to the selected reference line.";var a=document.createElement("img");a.style.margin="15px auto";a.src=this.angularStep1GIFbase64;this.actionContainer.appendChild(a)};l["actionBtnLine"]=t=>{this.controller.StatusButtonIsActive=true;this.ControlButtonReference();var l=n.Form.GetFieldFromForms(this.DataSection1,"BtnLine").htmlElement;if(this.controller.Plugin.Controller.ToolSelect==="OrthoAnnotationReferenceLine"){o.AddClass(l,e.ButtonClasses.ENABLE);o.RemoveClass(l,e.ButtonClasses.ACTIVE);var a=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);var s=a.RendererPlugins[this.controller.Plugin.PluginName];s.CurrentAnnotation=null;this.controller.Plugin.Controller.SelectTool("Pointer","pointerTool");s.Context.Renderer.Render();s.Context.OverlayRenderer.Render()}else{this.controller.LayoutOptionActive=true;r=this.DataSection1[0]["forms"][0];o.RemoveClass(l,e.ButtonClasses.ENABLE);o.AddClass(l,e.ButtonClasses.ACTIVE);this.controller.Plugin.Menu.ProcessReferenceLineToolEvent();this.actionContainer.innerHTML="<b>Line:</b>Click on two points to create a line.";var h=document.createElement("img");h.style.margin="15px auto";h.src=this.lineGIFbase64;this.actionContainer.appendChild(h)}};l["actionBtnCircle"]=t=>{this.controller.LayoutOptionActive=true;r=this.DataSection1[0]["forms"][0];cleanGroup(r);var l=n.Form.GetFieldFromForms(this.DataSection1,"BtnCircle").htmlElement;o.RemoveClass(l,e.ButtonClasses.ENABLE);o.AddClass(l,e.ButtonClasses.ACTIVE);this.controller.Plugin.Menu.ProcessCircleToolEvent();this.actionContainer.innerHTML="<b>Circle:</b>1- Click on a point to define the center of the circle.";var a=document.createElement("img");a.style.margin="15px auto";a.src=this.circleGIF1base64;this.actionContainer.appendChild(a)};l["actionBtnAngle"]=t=>{this.controller.LayoutOptionActive=true;r=this.DataSection1[0]["forms"][0];cleanGroup(r);var l=n.Form.GetFieldFromForms(this.DataSection1,"BtnAngle").htmlElement;o.RemoveClass(l,e.ButtonClasses.ENABLE);o.AddClass(l,e.ButtonClasses.ACTIVE);this.actionContainer.innerHTML="<b>Angle between lines:</b>Select two lines.";var a=document.createElement("img");a.style.margin="15px auto";a.src=this.selectReferenceGIFbase64;this.actionContainer.appendChild(a);this.controller.Plugin.Menu.ProcessAngleToolEvent()};l["actionBtnReference"]=t=>{this.ControlButtonReference()};this.OrthoElementsSection1=(new t.Products.OrthoPlugin.LayoutSection1Form).Create(this.orthoToolWindow.ButtonsElementsContainer,this.DataSection1);this.OrthoFloatingBar.BuildForm(this.OrthoElementsSection1,[0]);this.AppendIconsToMainButtons();this.orthoToolWindow.MainSection.style.display="block";this.orthoToolWindow.MainSection.style.width="100%";this.createButtonsMainWindow();this.ControlButtonsTop();s=n.Form.GetFieldFromForms(this.DataSection1,"BtnReference");s.htmlElement.style.backgroundColor=n.Colors.Amethyst}ControlButtonReference(){this.controller.LayoutOptionActive=false;var t=n.Form.GetFieldFromForms(this.DataSection1,"BtnReference");var e=this.controller.Plugin.Controller.View.ReferencedAnnotationLayout;if(!this.controller.StatusButtonIsActive){t.htmlElement.style.backgroundColor=n.Colors.Pumpkin;if(e){t.htmlElement.innerHTML="Clear reference"}else{t.htmlElement.innerHTML="Cancel reference"}this.controller.StatusButtonIsActive=true;this.actionContainer.innerHTML="<b>Set reference line:</b>Select an existing line to act as the reference line.";var o=document.createElement("img");o.style.margin="15px auto";o.src=this.selectReferenceGIFbase64;this.actionContainer.appendChild(o)}else{this.controller.StatusButtonIsActive=false;t.htmlElement.innerHTML="Set Reference";if(this.controller.Plugin.Controller.View.ReferencedAnnotationLayout!==null&&this.controller.Plugin.Controller.View.ReferencedAnnotationLayout!==undefined){this.controller.Plugin.Controller.View.ReferencedAnnotationLayout.annotation.IsReferenced=false;this.controller.Plugin.Controller.View.ReferencedAnnotationLayout=null}this.ControlButtonsTop();t.htmlElement.style.backgroundColor=n.Colors.Amethyst;var l=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}}AngularStep2Instructions(){this.actionContainer.innerHTML="<b>Angular line:</b>2 - Click on the second point to create an angular line to the selected reference line.";var t=document.createElement("img");t.style.margin="15px auto";t.src=this.angularStep2GIFbase64;this.actionContainer.appendChild(t)}CircleStep2Instructions(){this.actionContainer.innerHTML="<b>Circle:</b>2 - Click on the second point to define the circle´s radius.";var t=document.createElement("img");t.style.margin="15px auto";t.src=this.circleGIF2base64;this.actionContainer.appendChild(t)}AppendIconsToMainButtons(){var t=n.Form.GetFieldFromForms(this.DataSection1,"BtnCalibrate").htmlElement;var r=a({src:e.ResourceBag.Icons8Sphere32Png});o.AddClass(t,"blue");t.appendChild(r);var s=n.Form.GetFieldFromForms(this.DataSection1,"BtnReferenceLine").htmlElement;s.style.backgroundImage="url('"+e.ResourceBag.RefLinePng+"')";s.innerHTML="Reference";o.AddClass(s,"blue");o.AddClass(s,"iconButton");var h=n.Form.GetFieldFromForms(this.DataSection1,"BtnParallelLine").htmlElement;h.style.backgroundImage="url('"+e.ResourceBag.ParallelLinePng+"')";h.innerHTML="Parallel";o.AddClass(h,"blue");o.AddClass(h,"iconButton");var m=n.Form.GetFieldFromForms(this.DataSection1,"BtnPerpendicularLine").htmlElement;m.style.backgroundImage="url('"+e.ResourceBag.PerpendicularLinePng+"')";m.innerHTML="Perpend.";o.AddClass(m,"blue");o.AddClass(m,"iconButton");var d=n.Form.GetFieldFromForms(this.DataSection1,"BtnAngularLine").htmlElement;d.style.backgroundImage="url('"+e.ResourceBag.AngularLinePng+"')";d.innerHTML="Angular";o.AddClass(d,"blue");o.AddClass(d,"iconButton");var u=n.Form.GetFieldFromForms(this.DataSection1,"BtnAngle").htmlElement;var p=l({innerHTML:"Angle",className:"blue"});u.innerHTML="";u.appendChild(p)}UnSelectAngleTool(){var t=n.Form.GetFieldFromForms(this.DataSection1,"BtnAngle");o.RemoveClass(t.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(t.htmlElement,e.ButtonClasses.ENABLE)}ControlButtonsTop(){var t=n.Form.GetFieldFromForms(this.DataSection1,"BtnReferenceLine");var l=n.Form.GetFieldFromForms(this.DataSection1,"BtnLine");var a=n.Form.GetFieldFromForms(this.DataSection1,"BtnParallelLine");var r=n.Form.GetFieldFromForms(this.DataSection1,"BtnPerpendicularLine");var s=n.Form.GetFieldFromForms(this.DataSection1,"BtnAngularLine");var h=n.Form.GetFieldFromForms(this.DataSection1,"BtnCircle");var m=this.controller.Plugin.Controller.View.ReferencedAnnotationLayout;if(m===null||m===undefined){o.RemoveClass(h.htmlElement,e.ButtonClasses.ACTIVE);o.RemoveClass(h.htmlElement,e.ButtonClasses.ENABLE);h.htmlElement.disabled=true;o.RemoveClass(t.htmlElement,e.ButtonClasses.ACTIVE);o.RemoveClass(t.htmlElement,e.ButtonClasses.ENABLE);t.htmlElement.disabled=true;o.RemoveClass(a.htmlElement,e.ButtonClasses.ACTIVE);o.RemoveClass(a.htmlElement,e.ButtonClasses.ENABLE);a.htmlElement.disabled=true;o.RemoveClass(r.htmlElement,e.ButtonClasses.ACTIVE);o.RemoveClass(r.htmlElement,e.ButtonClasses.ENABLE);r.htmlElement.disabled=true;o.RemoveClass(s.htmlElement,e.ButtonClasses.ACTIVE);o.RemoveClass(s.htmlElement,e.ButtonClasses.ENABLE);s.htmlElement.disabled=true;this.actionContainer.innerHTML="To use the Layout Tool, you need a reference line selected."}else{o.RemoveClass(h.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(h.htmlElement,e.ButtonClasses.ENABLE);h.htmlElement.disabled=false;o.RemoveClass(t.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(t.htmlElement,e.ButtonClasses.ENABLE);t.htmlElement.disabled=false;o.RemoveClass(a.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(a.htmlElement,e.ButtonClasses.ENABLE);a.htmlElement.disabled=false;o.RemoveClass(r.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(r.htmlElement,e.ButtonClasses.ENABLE);r.htmlElement.disabled=false;o.RemoveClass(s.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(s.htmlElement,e.ButtonClasses.ENABLE);s.htmlElement.disabled=false;this.actionContainer.innerHTML=""}o.RemoveClass(l.htmlElement,e.ButtonClasses.ACTIVE);o.AddClass(l.htmlElement,e.ButtonClasses.ENABLE);l.htmlElement.disabled=false}createButtonsMainWindow(){const t=new Array;const n=r({type:"button",innerHTML:"Close",className:`${e.ButtonClasses.CRITIC} inline`});n.onclick=t=>{this.controller.StatusButtonIsActive=false;if(this.controller.Plugin.Controller.View.ReferencedAnnotationLayout!==null&&this.controller.Plugin.Controller.View.ReferencedAnnotationLayout!==undefined){this.controller.Plugin.Controller.View.ReferencedAnnotationLayout.annotation.IsReferenced=false;this.controller.Plugin.Controller.View.ReferencedAnnotationLayout=null}const e=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();this.controller.CloseLayoutWindow()};t.push(n);this.orthoToolWindow.ActionsWindowContainer.innerHTML="";t.forEach((t=>{this.orthoToolWindow.ActionsWindowContainer.appendChild(t)}))}}e.LayoutView=LayoutView})(n=e.OrthoPlugin||(e.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){let e;(function(t){t[t["CobbAngle"]=0]="CobbAngle";t[t["Spine"]=1]="Spine"})(e=t.AnnotType||(t.AnnotType={}));class OrthoContext{constructor(t){this.Annotations=new Array;this.Plugin=t}}t.OrthoContext=OrthoContext})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var OrthoPlugin;(function(OrthoPlugin){var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;var WebClient=Efferent.Frontend.WebClient;var ImagingStudyView=Efferent.ClientViews.ImagingStudyView;class OrthoMenu{constructor(t){this.plugin=t}ProcessOrthoToolEvent(t,e){}ProcessCobbAngleToolEvent(t){this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationCobbAngle","cobbangleTool");this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","orthoTool","optionInMenuPressed")}ProcessCalibrationToolEvent(t,e,n,o,l,a){var r=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(r!==null&&r.Context.ImageEntity!==null&&r.Context.ImageEntity!==undefined){var s=r.RendererPlugins[this.plugin.PluginName];if(s.CurrentAnnotation!==null&&s.CurrentAnnotation!==undefined&&l!==null&&l!==undefined&&s.CurrentAnnotation.Context.Viewport!==l.APviewport){s.CurrentAnnotation=null}let t=this.getStatusAutoCalibration(r);this.plugin.Controller.SelectTool("OrthoAnnotationCalibration",e);this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",n,"optionInMenuPressed");this.plugin.CalibrationController=OrthoPlugin.CalibrationController.Create(this.plugin,o,[0],l,a,e);if(t===WebClient.ERequestAjaxStatus.Void){this.plugin.CalibrationController.CalibrationAutoModeCancelMute=false;this.plugin.CalibrationController.ActionBtnAutoCalibration("calibrationTool",true)}this.plugin.ManagementFloatingBar.ShowFloatingBar(this.plugin.CalibrationController.CalibrationView.OrthoFloatingBar.Id)}else{WebClient.Toaster.ShowToast("Please select a viewport with an image",WebClient.Colors.BelizeHole,3)}}ProcessSpineToolEvent(t,e,n){var o=t.target||t;if(!DOMUtils.HasClass(o,"toolbarButton"))o=o.parentElement;if(DOMUtils.HasClass(o,"selected"))DOMUtils.RemoveClass(o,"selected");else DOMUtils.AddClass(o,"selected");this.plugin.SpineController=new OrthoPlugin.SpineController(this.plugin);this.plugin.SpineController.SpineProgression=OrthoPlugin.ESpineDirection.TopToBottom;this.plugin.SpineController.SpineCurrent="";this.plugin.SpineController.SpineView.Toggle();this.plugin.Controller.SelectDefaultTool();this.plugin.Controller.SelectTool("OrthoAnnotationSpine",e);WebClient.Toolbar.DeselectFixed();WebClient.Toolbar.HideAllMenus();if(n){this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",n,"optionInMenuPressed fixedSelectedMenu")}}ProcessShoulderImplantToolEvent(t,e,n){if(t!==undefined&&t!==null){t.preventDefault();t.srcEvent.stopPropagation()}let openDialogShoulder=(t,o)=>{const a=t?t:e;const r=o?o:n;WebClient.Toolbar.HideAllMenus();var s=r?r:new OrthoPlugin.ShoulderImplantAnnotation;this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");l.Context.AnnotationController=new ImagingStudyView.AnnotationController(s);OrthoPlugin.OrthoPlugin.ShoulderImplantControlerStaticInstance=this.plugin.ShoulderImplantController=OrthoPlugin.ShoulderImplantController.Create(this.plugin,s,a,[0],a);this.plugin.ManagementFloatingBar.ShowFloatingBar(this.plugin.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Id)};var o=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(o!==null&&o.Context.ImageEntity!==null&&o.Context.ImageEntity!==undefined){var l=o.RendererPlugins[this.plugin.PluginName];if(l.Annotations.some((t=>t instanceof OrthoPlugin.ShoulderImplantAnnotation))){WebClient.Toaster.ShowToast("Shoulder type annotation was found. Edit mode activated.",WebClient.Colors.BelizeHole,5);WebClient.Toolbar.HideAllMenus();let t=l.Annotations.filter((t=>t instanceof OrthoPlugin.ShoulderImplantAnnotation))[0];t.Selected=true;l.LastAnnotationCreatedOrSelected=t;l.Context.AnnotationController=new ImagingStudyView.AnnotationController(t);openDialogShoulder(true,t)}else{openDialogShoulder()}}else{WebClient.Toaster.ShowToast("please select a viewport with an image",WebClient.Colors.BelizeHole,3)}}ProcessHipImplantToolEvent(t,e,n){if(t!==undefined&&t!==null){t.preventDefault();t.srcEvent.stopPropagation()}let openDialogHip=(t,o)=>{const a=t?t:e;const r=o?o:n;WebClient.Toolbar.HideAllMenus();var s=r?r:new OrthoPlugin.HipImplantAnnotation;this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");l.Context.AnnotationController=new ImagingStudyView.AnnotationController(s);OrthoPlugin.OrthoPlugin.HipImplantControlerStaticInstance=this.plugin.HipImplantController=OrthoPlugin.HipImplantController.Create(this.plugin,s,a,[0],a);this.plugin.ManagementFloatingBar.ShowFloatingBar(this.plugin.HipImplantController.HipImplantView.OrthoFloatingBar.Id)};var o=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(o!==null&&o.Context.ImageEntity!==null&&o.Context.ImageEntity!==undefined){var l=o.RendererPlugins[this.plugin.PluginName];if(!l.Context.IsPseudoSeries){if(l.Annotations.some((t=>t instanceof OrthoPlugin.HipImplantAnnotation))){WebClient.Toaster.ShowToast("HIP type annotation was found. Edit mode activated.",WebClient.Colors.BelizeHole,5);WebClient.Toolbar.HideAllMenus();let t=l.Annotations.filter((t=>t instanceof OrthoPlugin.HipImplantAnnotation))[0];t.Selected=true;l.LastAnnotationCreatedOrSelected=t;l.Context.AnnotationController=new ImagingStudyView.AnnotationController(t);openDialogHip(true,t)}else{openDialogHip()}}else{WebClient.Toaster.ShowToast("please select a viewport with a no key-image",WebClient.Colors.BelizeHole,3)}}else{WebClient.Toaster.ShowToast("please select a viewport with an image",WebClient.Colors.BelizeHole,3)}}ProcessKneeImplantToolEvent(t,e,n,o){if(t!==undefined&&t!==null){t.preventDefault();t.srcEvent.stopPropagation()}let openDialogKnee=(t,l)=>{var r,s,h,m,d,u,p;const c=t?t:e;const A=l?l:n;WebClient.Toolbar.HideAllMenus();var C=A?A:new OrthoPlugin.KneeImplantAnnotation;this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");let S=(s=(r=this.plugin.KneeImplantController)===null||r===void 0?void 0:r.KneeImplantView)===null||s===void 0?void 0:s.GetOrthoToolWindow();let g=(m=(h=S===null||S===void 0?void 0:S.SelectSideMessage)===null||h===void 0?void 0:h.style)===null||m===void 0?void 0:m.display;let I=(d=this.plugin.KneeImplantController)===null||d===void 0?void 0:d.LegSide;let P=(u=this.plugin.KneeImplantController)===null||u===void 0?void 0:u.ReadyForSelectedViewports;let f=(p=this.plugin.KneeImplantController)===null||p===void 0?void 0:p.KneeImplantView.IdDefault;a.Context.AnnotationController=new ImagingStudyView.AnnotationController(C);OrthoPlugin.OrthoPlugin.KneeImplantControlerStaticInstance=this.plugin.KneeImplantController=OrthoPlugin.KneeImplantController.Create(this.plugin,C,c,[0],o,c);this.plugin.ManagementFloatingBar.ShowFloatingBar(this.plugin.KneeImplantController.KneeImplantView.OrthoFloatingBar.Id);if(I&&g==="none"){if(I===OrthoPlugin.EBodySide.Left)this.plugin.KneeImplantController.KneeImplantView.InputLeftSide.click();else this.plugin.KneeImplantController.KneeImplantView.InputRightSide.click();if(P){if(f===OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP]){this.plugin.KneeImplantController.KneeImplantView.ButtonSelectAPView.click()}else{this.plugin.KneeImplantController.KneeImplantView.ButtonSelectMLView.click()}}}};var l=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(l!==null&&l.Context.ImageEntity!==null&&l.Context.ImageEntity!==undefined){var a=l.RendererPlugins[this.plugin.PluginName];if(!a.Context.IsPseudoSeries){if(a.Annotations.some((t=>t instanceof OrthoPlugin.KneeImplantAnnotation))){WebClient.Toaster.ShowToast("Knee type annotation was found. Edit mode activated.",WebClient.Colors.BelizeHole,5);WebClient.Toolbar.HideAllMenus();let t=a.Annotations.filter((t=>t instanceof OrthoPlugin.KneeImplantAnnotation))[0];t.Selected=true;this.plugin.Controller.ViewportPane.ViewportsArray.forEach((e=>{if(e.Context.ImageEntity!==null&&e!==l){var n=e.Annotations[this.plugin.PluginName];n.forEach((n=>{if(t.Id===n.Id){n.Selected=true;let t=e.RendererPlugins[this.plugin.PluginName];t.LastAnnotationCreatedOrSelected=n}}))}}));a.LastAnnotationCreatedOrSelected=t;a.Context.AnnotationController=new ImagingStudyView.AnnotationController(t);openDialogKnee(true,t)}else{openDialogKnee()}}else{WebClient.Toaster.ShowToast("please select a viewport with a no key-image",WebClient.Colors.BelizeHole,3)}}else{WebClient.Toaster.ShowToast("Please select a viewport with an image",WebClient.Colors.BelizeHole,3)}}ProcessLayoutTool(t,e,n){this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.LayoutController=OrthoPlugin.LayoutController.Create(this.plugin,e,n);this.plugin.ManagementFloatingBar.ShowFloatingBar(this.plugin.LayoutController.LayoutView.OrthoFloatingBar.Id);this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",n,"optionInMenuPressed")}ProcessAlignmentTool(t,e,n,o,l,a){var r=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);if(r!==null&&r.Context.ImageEntity!==null&&r.Context.ImageEntity!==undefined){var s=l!==undefined&&l!==null?l:new OrthoPlugin.AlignmentToolAnnotation;this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationAlignmentTool",n);var h=r.RendererPlugins[this.plugin.PluginName];h.Context.AnnotationController=new ImagingStudyView.AnnotationController(s);this.plugin.AlignmentToolController=OrthoPlugin.AlignmentToolController.Create(this.plugin,s,e,n,o,a);this.plugin.ManagementFloatingBar.ShowFloatingBar(this.plugin.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Id);this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2",o,"optionInMenuPressed")}}ProcessReferenceLineToolEvent(){this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationReferenceLine","ReferenceLineTool");this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ReferenceLine","optionInMenuPressed")}ProcessParallelLineToolEvent(){this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationParallelLine","ParallelLineTool");this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","ParallelLine","optionInMenuPressed");this.initCurrentAnnotation()}ProcessPerpendicularLineToolEvent(){this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationPerpendicularLine","PerpendicularLineTool");this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","PerpendicularLine","optionInMenuPressed");this.initCurrentAnnotation()}ProcessAngularLineToolEvent(){this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationAngularLine","AngularLineTool");this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","AngularLine","optionInMenuPressed");this.initCurrentAnnotation()}ProcessCircleToolEvent(){this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationCircle","CircleTool");this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","Circle","optionInMenuPressed");this.initCurrentAnnotation()}ProcessAngleToolEvent(){this.plugin.Controller.SelectTool("Pointer","pointerTool");this.plugin.Controller.SelectTool("OrthoAnnotationAngleTool","AngleTool");this.plugin.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","AngleTool","optionInMenuPressed");var t=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);t.SelectUnSelectAnnotations(false);this.initCurrentAnnotation()}CancelKneeImplant(t){var e=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);var n=this.plugin.AssignOrthoContextToViewport(e);n.Context.CurrentAnnotation=null;this.plugin.Controller.HasBlockedDoubleClick=false;this.plugin.Controller.HasBlockedRightClick=false;this.plugin.KneeImplantController.KneeImplantView.DataSection1=null;this.plugin.KneeImplantController.KneeImplantView.DataSection2=null;WebClient.Toolbar.DeselectFixed();if(t===null||t===undefined)this.plugin.Controller.SelectDefaultTool();delete this.plugin.Controller.SpecialAnnotations[this.plugin.KneeImplantController.APIdCurrentAnnotation];delete this.plugin.Controller.SpecialAnnotations[this.plugin.KneeImplantController.MLIdCurrentAnnotation];if(n.CurrentAnnotation!==null&&n.CurrentAnnotation!==undefined){n.CurrentAnnotation.Selected=false;n.CurrentAnnotation.Visible=true}else if(t!==undefined&&t!==null){t.Selected=false;t.Visible=true}}CancelAlignmentTool(t){var e=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);var n=this.plugin.AssignOrthoContextToViewport(e);n.Context.CurrentAnnotation=null;this.plugin.AlignmentToolController.AlignmentToolView.DataSection1=null;WebClient.Toolbar.DeselectFixed();if(t===null||t===undefined)this.plugin.Controller.SelectDefaultTool();if(n.CurrentAnnotation!==null&&n.CurrentAnnotation!==undefined)n.CurrentAnnotation.Selected=false;else if(t!==undefined&&t!==null)t.Selected=false}CancelCalibration(){var t=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);var e=this.plugin.AssignOrthoContextToViewport(t);e.Context.CurrentAnnotation=null;if(this.plugin.CalibrationOptionFromMainMenu){this.plugin.Controller.HasBlockedDoubleClick=false;this.plugin.Controller.HasBlockedRightClick=false}this.plugin.CalibrationController.Data=null;WebClient.Toolbar.DeselectFixed();this.plugin.Controller.SelectDefaultTool();if(e.CurrentAnnotation!==null&&e.CurrentAnnotation!==undefined)e.CurrentAnnotation.Selected=false;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}CancelShoulderImplant(t){var e=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);var n=this.plugin.AssignOrthoContextToViewport(e);n.Context.CurrentAnnotation=null;this.plugin.Controller.HasBlockedDoubleClick=false;this.plugin.Controller.HasBlockedRightClick=false;this.plugin.ShoulderImplantController.ShoulderImplantView.DataSection1=null;this.plugin.ShoulderImplantController.ShoulderImplantView.DataSection2=null;WebClient.Toolbar.DeselectFixed();this.plugin.Controller.SelectDefaultTool();delete this.plugin.Controller.SpecialAnnotations[this.plugin.ShoulderImplantController.IdCurrentAnnotation];if(n.CurrentAnnotation!==null&&n.CurrentAnnotation!==undefined){n.CurrentAnnotation.Selected=false;n.CurrentAnnotation.Visible=true}else if(t!==undefined&&t!==null){t.Selected=false;t.Visible=true}else{var o;for(var l=0;l<n.Annotations.length;l++){if(n.LastAnnotationCreatedOrSelected!==undefined&&n.LastAnnotationCreatedOrSelected!==null){if(n.Annotations[l].Id===n.LastAnnotationCreatedOrSelected.Id){o=n.Annotations[l];break}}}if(o!==undefined)o.Selected=false}n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}CancelHipImplant(t){var e=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);var n=this.plugin.AssignOrthoContextToViewport(e);n.Context.CurrentAnnotation=null;this.plugin.Controller.HasBlockedDoubleClick=false;this.plugin.Controller.HasBlockedRightClick=false;this.plugin.HipImplantController.HipImplantView.DataSection1=null;this.plugin.HipImplantController.HipImplantView.DataSection2=null;WebClient.Toolbar.DeselectFixed();this.plugin.Controller.SelectDefaultTool();delete this.plugin.Controller.SpecialAnnotations[this.plugin.HipImplantController.IdCurrentAnnotation];if(n.CurrentAnnotation!==null&&n.CurrentAnnotation!==undefined){n.CurrentAnnotation.Selected=false;n.CurrentAnnotation.Visible=true}else if(t!==undefined&&t!==null){t.Selected=false;t.Visible=true}else{var o;for(var l=0;l<n.Annotations.length;l++){if(n.LastAnnotationCreatedOrSelected!==undefined&&n.LastAnnotationCreatedOrSelected!==null){if(n.Annotations[l].Id===n.LastAnnotationCreatedOrSelected.Id){o=n.Annotations[l];break}}}if(o!==undefined)o.Selected=false}n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}initCurrentAnnotation(){var viewport=this.plugin.Controller.View.ViewerPage.GetSelectViewport(this.plugin.Controller.ViewportPane);var orthoCtx=viewport.RendererPlugins[this.plugin.PluginName];var tool=this.plugin.Controller.View.ViewerPage.ToolSelect;var subTypeAnnotationName=tool.substr(15);viewport.PauseMoveForClickEvent=false;orthoCtx.CurrentAnnotation=eval("new Vue.Products.OrthoPlugin."+subTypeAnnotationName+"Annotation()");orthoCtx.CurrentAnnotation.Context=viewport.Context;orthoCtx.CurrentAnnotation.Id=WebClient.Utils.GetGuid();orthoCtx.CurrentAnnotation.Selected=false;orthoCtx.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.New;orthoCtx.CurrentAnnotation.Author=sessionStorage["userEmail"];orthoCtx.CurrentAnnotation.Date=new Date;orthoCtx.CurrentAnnotation.Plugin=this.plugin.PluginName;orthoCtx.CurrentAnnotation["new"]=true;orthoCtx.Context.AnnotationController=new ImagingStudyView.AnnotationController(orthoCtx.CurrentAnnotation);orthoCtx.Context.AnnotationController.SetFirstGroup()}getStatusAutoCalibration(t){let e=WebClient.ERequestAjaxStatus.Void;let runRules=()=>{this.plugin.StructureLoadAutoCalibration.push({StudyGUID:t.Context.StudyGuid,ImageGUID:t.Context.ImageEntity.ImageGUID,Status:WebClient.ERequestAjaxStatus.Void,Data:null})};if(this.plugin.StructureLoadAutoCalibration.length>0){let n=this.plugin.StructureLoadAutoCalibration.findIndex((e=>e.StudyGUID===t.Context.StudyGuid&&e.ImageGUID===t.Context.ImageEntity.ImageGUID));if(n!==-1){e=this.plugin.StructureLoadAutoCalibration[n].Status;switch(this.plugin.StructureLoadAutoCalibration[n].Status){case WebClient.ERequestAjaxStatus.Abort:case WebClient.ERequestAjaxStatus.Error:this.plugin.StructureLoadAutoCalibration.splice(n,1);e=WebClient.ERequestAjaxStatus.Void;runRules();break}}else{runRules()}}else{runRules()}return e}}OrthoPlugin.OrthoMenu=OrthoMenu})(OrthoPlugin=Products.OrthoPlugin||(Products.OrthoPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var OrthoPlugin;(function(OrthoPlugin_1){var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;var WebClient=Efferent.Frontend.WebClient;var ImagingStudyView=Efferent.ClientViews.ImagingStudyView;var FhirClient=Efferent.Frontend.FhirClient;let EViewCiss;(function(t){t[t["AP"]=0]="AP";t[t["PA"]=1]="PA";t[t["ML"]=2]="ML";t[t["LM"]=3]="LM"})(EViewCiss=OrthoPlugin_1.EViewCiss||(OrthoPlugin_1.EViewCiss={}));let EFitStates;(function(t){t[t["Process"]=0]="Process";t[t["Selected"]=1]="Selected";t[t["CompletedCiss"]=2]="CompletedCiss";t[t["CompletedImplant"]=3]="CompletedImplant";t[t["Transischial"]=4]="Transischial"})(EFitStates=OrthoPlugin_1.EFitStates||(OrthoPlugin_1.EFitStates={}));class OrthoPlugin{constructor(){this.PluginName="OrthoPlugin";this.SupportedViewportType=["DicomViewport"];this.StructureLoadAutoCalibration=new Array}Initialize(t,e,n,o,l){Efferent.Frontend.WebClient.DOMUtils.InjectCSS(Vue.Products.OrthoPlugin.ResourceBag.OrthoPluginCss,"styleOrthoPlugin");this.Controller=t;this.fillMovePoints=new Array;this.ManagementFloatingBar=WebClient.FloatingBarManager.getInstance();var a=WebClient.Loader.Show();this.Controller.View.Platform.LanguageManager.AddDictionary("{Vue.Products.OrthoPlugin.ResourceBag.OrthoPluginLanguageJson}","OrthoPluginLanguage",Vue.Products.OrthoPlugin.ResourceBag.OrthoPluginLanguageJson[this.Controller.View.Platform.LanguageManager.CurrentLanguage]);this.LoadPlugin();if(n===e.length-1){if(o!==undefined)o.call(this.Controller.View,l)}else{e[n+1].Initialize(this.Controller,e,n+1,o,l)}WebClient.Loader.Hide(a.getAttribute("id"))}LoadPlugin(){this.CobbAngle=new OrthoPlugin_1.CobbAngleCalculator;this.Menu=new OrthoPlugin_1.OrthoMenu(this);var t=[["eFit",OrthoPlugin_1.ResourceBag.EfferentPng,t=>{this.Menu.ProcessOrthoToolEvent(t,"eFit");var e=[];this.Controller.View.Plugins.forEach((t=>{var n=t.GetButtonsToMenu(["3dTool"],"3dTool");e.push({dictionary:n.dictionary,buttons:n.buttons});n=t.GetButtonsToMenu(["show3DTemplate"],"3dTool");e.push({dictionary:n.dictionary,buttons:n.buttons});n=t.GetButtonsToMenu(["project3DTool"],"3dTool");e.push({dictionary:n.dictionary,buttons:n.buttons});n=t.GetButtonsToMenu(["project3DToolImplant"],"3dTool");e.push({dictionary:n.dictionary,buttons:n.buttons});n=t.GetButtonsToMenu(["project3DToolBone"],"3dTool");e.push({dictionary:n.dictionary,buttons:n.buttons});n=t.GetButtonsToMenu(["project3DToolBoth"],"3dTool");e.push({dictionary:n.dictionary,buttons:n.buttons})}));if(e.length>0){e.forEach((t=>{if(t.buttons.length>0)this.Controller.View.Platform.Toolbar.AppendMenuButtonItems(t.buttons,t.dictionary,"AlignmentTool",true,"eFit",true)}))}}],{title:"",name:"efitLogo",imageString:OrthoPlugin_1.ResourceBag.EfitLogoPng,stylesImage:{textAlign:"center",width:"120px",margin:"0px auto 20px auto",float:"none"},event:()=>{}},["spineTool",OrthoPlugin_1.ResourceBag.SpinePng,t=>this.Menu.ProcessSpineToolEvent(t,"spineTool","eFit")],["HipImplantTool",OrthoPlugin_1.ResourceBag.Icons8Implant32Png,t=>{this.Controller.HasBlockedDoubleClick=true;this.Controller.HasBlockedRightClick=true;this.Menu.ProcessHipImplantToolEvent(t,false)}],["KneeImplantTool",OrthoPlugin_1.ResourceBag.KneeImplantPng,t=>{this.Controller.HasBlockedDoubleClick=true;this.Controller.HasBlockedRightClick=true;this.Menu.ProcessKneeImplantToolEvent(t,false)}],["ShoulderImplantTool",OrthoPlugin_1.ResourceBag.ShoulderPng,t=>{this.Controller.HasBlockedDoubleClick=true;this.Controller.HasBlockedRightClick=true;this.Menu.ProcessShoulderImplantToolEvent(t,false)}],["calibrationTool",OrthoPlugin_1.ResourceBag.Icons8Sphere32Png,t=>{this.Controller.HasBlockedDoubleClick=true;this.Controller.HasBlockedRightClick=true;this.CalibrationOptionFromMainMenu=true;this.Menu.ProcessCalibrationToolEvent(t,"calibrationTool","eFit")}],["LayoutTool",OrthoPlugin_1.ResourceBag.LayoutToolsPng,t=>this.Menu.ProcessLayoutTool(t,"LayoutTool","eFit")],["AlignmentTool",OrthoPlugin_1.ResourceBag.KneeAlignPng,t=>this.Menu.ProcessAlignmentTool(t,false,"AlignmentTool","eFit")]];var e=[["orthoTool",OrthoPlugin_1.ResourceBag.Icons8Vertebra32Png,t=>this.Menu.ProcessOrthoToolEvent(t,"orthoTool")],["calibrationTool1",OrthoPlugin_1.ResourceBag.Icons8Sphere32Png,t=>{this.CalibrationOptionFromMainMenu=true;this.Menu.ProcessCalibrationToolEvent(t,"calibrationTool1","orthoTool")}],["cobbangleTool",OrthoPlugin_1.ResourceBag.CobbPng,t=>this.Menu.ProcessCobbAngleToolEvent(t)],["spineTool1",OrthoPlugin_1.ResourceBag.SpinePng,t=>this.Menu.ProcessSpineToolEvent(t,"spineTool1","orthoTool")],["LayoutTool1",OrthoPlugin_1.ResourceBag.LayoutToolsPng,t=>this.Menu.ProcessLayoutTool(t,"LayoutTool1","orthoTool")],["AlignmentTool1",OrthoPlugin_1.ResourceBag.KneeAlignPng,t=>this.Menu.ProcessAlignmentTool(t,false,"AlignmentTool1","orthoTool")]];this.Controller.View.Platform.Toolbar.AppendControlsToGroup([e,t],"OrthoPluginLanguage","toolbarviewer.2",this);if(WebClient.Utils.CheckNotAllowTag(["patient","guest"])){var n=new WebClient.Tab("ortho",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("OrthoPluginLanguage","ortho").toUpperCase());n.ActionTab=t=>{var e=new OrthoPlugin_1.SettingsOrthoCissPane(t,this.Controller.View.Platform);e.BuildUI()};this.Controller.View.Platform.TemporalSettingsTabs.push(n)}this.HideAnnotationSpecialForOrtho=false}CreateDiagnosticReport(t,e,n){WebClient.Loader.Show();let o="new";let l;const a=WebClient.PlatformContext.PlatformUri+"/fhir/DiagnosticReport?imagingStudy="+e["id"];const r=new Efferent.Frontend.FhirClient.FhirCall(a,"GET");r.FuncOk=t=>{const e=JSON.parse(t);if(e["total"]===0){WebClient.Toaster.ShowToast("Existing report not found.",WebClient.Colors.PeterRiver,3)}else{l=e["entry"][0].resource["id"];o="edit"}continueProcess()};r.FuncError=()=>{WebClient.Toaster.ShowToast("Error aquiring existing reports for this resource.",WebClient.Colors.Alizarin,3);continueProcess()};r.Send();const continueProcess=()=>{const a={subject:["subject","subject.name[0].text"],issued:["started","started"],performer:"",imagingStudy:""};const r={resourceType:"DiagnosticReport",status:"final",code:{text:"TEST"},contained:[],result:[]};for(let t in a){if(a.hasOwnProperty(t)){if(t==="performer"){r["performer"]={reference:sessionStorage["practitionerId"]}}else if(t==="imagingStudy"){r["imagingStudy"]={reference:"ImagingStudy/"+e["id"]}}else{try{const n=e[a[t][0]];if(n){if(n.hasOwnProperty("resourceType"))r[t]={reference:n["resourceType"]+"/"+n["id"]};else r[t]=n}}catch(t){}}}}if(o==="edit"){r["id"]=l}for(let e=0;e<t.length;e++){r["contained"].push(this.createObservation(t[e],e+1));r["result"].push({reference:"#embedded"+(e+1)})}const s=WebClient.PlatformContext.PlatformUri+"/fhir/DiagnosticReport"+(o==="edit"?"/"+l:"");const h=new Efferent.Frontend.FhirClient.FhirCall(s,o==="edit"?"PUT":"POST");h.BodyData=JSON.stringify(r);h.FuncOk=()=>{const t="?view=reportView&ReportTemplate=ActivityDefinition/"+n+"&ReportMode=new&ResourceId=ImagingStudy/"+e["id"]+"&FormMode=edit";this.Controller.View.Platform.SwitchView(t);WebClient.Toaster.ShowToast("Diagnostic report created.",WebClient.Colors.Emerald,3);WebClient.Loader.Hide()};h.FuncError=()=>{WebClient.Toaster.ShowToast("Could not create diagnostic report.",WebClient.Colors.Alizarin,3);WebClient.Loader.Hide()};h.Send()}}GenerateOrthoReport(study,refResourcesNames,continueReportCreation){const referenceProperties=["referrer.name[0].text|practitioner","location.name|location"];let processedProperties=0;for(let i=0;i<referenceProperties.length;i++){const baseFieldName=referenceProperties[i].split(".")[0];const propertyPath=referenceProperties[i].split("|")[0];const referenceResourceType=referenceProperties[i].split("|")[1];const thisProperty=study[baseFieldName];if(thisProperty){if(thisProperty["reference"]){WebClient.Loader.Show();const url=WebClient.PlatformContext.PlatformUri+"/fhir/ImagingStudy?_id="+study["id"]+"&_include=ImagingStudy:"+referenceResourceType;const resourceCall=new FhirClient.FhirCall(url,"GET");resourceCall.FuncOk=data=>{WebClient.Loader.Hide();if(data!==""){const parsedResponse=JSON.parse(data);try{const referencedResource=parsedResponse["entry"][1]["resource"];const valuePathOnly=propertyPath.replace(baseFieldName,"");refResourcesNames[baseFieldName]=eval("referencedResource"+valuePathOnly)}catch(t){refResourcesNames[baseFieldName]=""}processedProperties++;if(processedProperties===referenceProperties.length){continueReportCreation()}}};resourceCall.FuncError=()=>{WebClient.Loader.Hide();refResourcesNames[baseFieldName]="";processedProperties++;if(processedProperties===referenceProperties.length){continueReportCreation()}};resourceCall.Send()}else if(thisProperty["display"]){refResourcesNames[baseFieldName]=thisProperty["display"];processedProperties++;if(processedProperties===referenceProperties.length){continueReportCreation()}}else if(thisProperty["resourceType"]){try{refResourcesNames[baseFieldName]=eval("study."+propertyPath)}catch(t){refResourcesNames[baseFieldName]=""}processedProperties++;if(processedProperties===referenceProperties.length){continueReportCreation()}}else{refResourcesNames[baseFieldName]="";processedProperties++;if(processedProperties===referenceProperties.length){continueReportCreation()}}}else{refResourcesNames[baseFieldName]="";processedProperties++;if(processedProperties===referenceProperties.length){continueReportCreation()}}}}Terminate(){this.ManagementFloatingBar.RemoveAllInstancesFloatingBar();const t=document.querySelector("style#styleOrthoPlugin");Efferent.Frontend.WebClient.DOMUtils.RemoveItem(t)}CloseActionsConfig(){}EscapeAction(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var e=this.AssignOrthoContextToViewport(t);var n=e.LastAnnotationCreatedOrSelected;if(n){n.Selected=false;e.LastAnnotationCreatedOrSelected=undefined}e.CurrentAnnotation=null;this.Controller.HasBlockedDoubleClick=false;this.Controller.HasBlockedRightClick=false;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}OnWindowResize(t,e,n=false){}AssignViewportDrag(t,e,n,o,l){}SetSeriesToViewport(t,e,n,o,l,a){}RefreshAnnotationsOnAllViewports(){}GetRememberToolsPerName(){var t=[];return t}GetContextMenuOptions(){var t=new Array;if(this.Controller){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(e!==null&&e!==undefined){var n=new ImagingStudyView.ContextMenuOption("spineTool",this.Controller.View.Platform.LanguageManager.GetValuesFromDict("OrthoPluginLanguage","spineTool"),"spineTool");n.Action=t=>{var e=this.Controller.View.Platform.Toolbar.GetButton("spineTool");this.Menu.ProcessSpineToolEvent(e.Element,"spineTool","eFit")};if(WebClient.Utils.CheckNotAllowTag("patient"))t.push(n)}}return t}DeleteSelectedAnnotations(t){var e=this.AssignOrthoContextToViewport(t);if(e.Context.IsPseudoSeries)return;var n=new Array;var o=false;for(var l=0;l<e.Annotations.length;l++){if(e.Annotations[l].Selected===true){if(e.Annotations[l]instanceof OrthoPlugin_1.CalibrationAnnotation||e.Annotations[l]instanceof OrthoPlugin_1.CalibrationLinearAnnotation){e.Context.ImageEntity.CalibrationData=null;t.Context.ImageEntity["pixelSpacing"]=[1,1,"px"];this.Controller.View.Plugins.forEach((e=>{try{if(e["Process3DInformation"])e["Process3DInformation"](t.Context.ImageEntity)}catch(t){WebClient.Utils.DebugConsoleLog(t)}}))}if(e.Annotations[l]instanceof OrthoPlugin_1.HipImplantAnnotation||e.Annotations[l]instanceof OrthoPlugin_1.KneeImplantAnnotation||e.Annotations[l]instanceof OrthoPlugin_1.AlignmentToolAnnotation||e.Annotations[l]instanceof OrthoPlugin_1.ShoulderImplantAnnotation){e.LastAnnotationCreatedOrSelected=null;switch(true){case e.Annotations[l]instanceof OrthoPlugin_1.HipImplantAnnotation:if(this.HipImplantController&&this.HipImplantController.HipImplantView.OrthoFloatingBar.Id)this.ManagementFloatingBar.RemoveFloatingBar(this.HipImplantController.HipImplantView.OrthoFloatingBar.Id);break;case e.Annotations[l]instanceof OrthoPlugin_1.KneeImplantAnnotation:o=true;if(this.KneeImplantController&&this.KneeImplantController.KneeImplantView.OrthoFloatingBar.Id)this.ManagementFloatingBar.RemoveFloatingBar(this.KneeImplantController.KneeImplantView.OrthoFloatingBar.Id);break;case e.Annotations[l]instanceof OrthoPlugin_1.AlignmentToolAnnotation:if(this.AlignmentToolController&&this.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Id)this.ManagementFloatingBar.RemoveFloatingBar(this.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Id);break;case e.Annotations[l]instanceof OrthoPlugin_1.ShoulderImplantAnnotation:if(this.ShoulderImplantController&&this.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Id)this.ManagementFloatingBar.RemoveFloatingBar(this.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Id);break}this.Controller.SelectDefaultTool()}t.AnnotationManager.DeleteAnnotation(e.Annotations[l])}else{n.push(e.Annotations[l])}}e.Annotations=n;e.Context.Viewport.Annotations[this.PluginName]=e.Annotations;e.Context.Viewport.AnnotationManager.UpdateAnnotationsToImage();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();if(this.KneeImplantController&&o){var a=this.Controller.ViewportPane.ViewportsArray;for(var r=0;r<a.length;r++){if(a[r].Context.ImageEntity!==null){var s=a[r].Annotations[this.PluginName];var h=new Array;var m=false;var d;for(var u=0;u<s.length;u++){if(!(s[u]instanceof OrthoPlugin_1.KneeImplantAnnotation)){h.push(s[u])}else if(s[u].Id!==this.KneeImplantController.KneeAnnotation.Id&&s[u]instanceof OrthoPlugin_1.KneeImplantAnnotation){h.push(s[u])}else{m=true;d=s[u].Id}}if(m){var p=a[r].RendererPlugins[this.PluginName];p.Annotations=h;p.Context.Viewport.Annotations[this.PluginName]=p.Annotations;p.Context.Viewport.AnnotationManager.UpdateAnnotationsToImage();p.LastAnnotationCreatedOrSelected=null;delete this.Controller.SpecialAnnotations[d];p.CurrentAnnotation=null;p.Context.Renderer.Render();p.Context.OverlayRenderer.Render()}}}a.forEach((t=>{if(t.Context.ImageEntity!==null){var e=t.RendererPlugins[this.PluginName];e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}));this.KneeImplantController.APviewport.Context.AnnotationController=null;this.KneeImplantController.MLviewport.Context.AnnotationController=null;this.KneeImplantController=null}}GetAnnotSelectCount(){var t=0;var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(e!==null){var n=this.AssignOrthoContextToViewport(e);if(n.Annotations!==null&&n.Annotations!==undefined){for(var o=0;o<n.Annotations.length;o++){if(n.Annotations[o].Selected)t++}}return t}else{return 0}}GetMouseBehaviors(){var t=this.Controller.View.Platform.LanguageManager;var e=[new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"OrthoAnnotationCobbAngle","Ortho",t.GetValuesFromDict("OrthoPluginLanguage","coobangleTool"),"coobangleTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"OrthoCalibration","Ortho",t.GetValuesFromDict("OrthoPluginLanguage","calibrationTool"),"calibrationTool"),new ImagingStudyView.MouseBehavior(ImagingStudyView.EMouseBehavior.TapAndHoverOrDrag,"OrthoAnnotationSpine","Ortho",t.GetValuesFromDict("OrthoPluginLanguage","spineTool"),"spineTool")];return e}OnEvent(t,e,n,o){var l=this.AssignOrthoContextToViewport(n);if(!this.SupportedViewportType.some((t=>t===n.PluginNameAction)))return;switch(t){case"singletap":this.processSingleTapEvent(e,n,o);break;case"doubletap":this.processDoubleTap(e,n,o);break;case"keydown":if(!n.EnableActionsOnViewport)return;if(o.which===27){this.Controller.View.MessageBar.style.display="none"}break;case"mouseup":this.processMouseUp(e,n,o);break;case"mousedown":this.ProcessMouseDown(e,n,o);break;case"mousemove":this.ProcessMouseMove(e,n,o);break;case"mouseout":if(o.button===1||o.buttons===1){if(!n.EnableActionsOnViewport)return}break;case"wheel":if(!n.EnableActionsOnViewport)return;if(o.deltaY>0){this.ProcessWheel(true,n)}else if(o.deltaY<0){this.ProcessWheel(false,n)}break;case"panstart":case"panmove":case"panend":this.processPanEvent(t,e,n,o);break}}ProcessWheel(t,e){let n=this.GetImplantDetected(e,0,0,false,true);let o=document.createElement("button");if(t){if(n){o.setAttribute("data-control","minus")}}else{if(n){o.setAttribute("data-control","plus")}}if(n){if(n.implant instanceof OrthoPlugin_1.ShoulderImplantAnnotation){switch(n.template.ComponentName){case OrthoPlugin_1.EShoulderImplant[OrthoPlugin_1.EShoulderImplant.Stem]:this.ShoulderImplantController.ControlAdjustImplant(o,OrthoPlugin_1.EShoulderImplant.Stem);break;case OrthoPlugin_1.EShoulderImplant[OrthoPlugin_1.EShoulderImplant.Glenosphere]:this.ShoulderImplantController.ControlAdjustImplant(o,OrthoPlugin_1.EShoulderImplant.Glenosphere);break;case OrthoPlugin_1.EShoulderImplant[OrthoPlugin_1.EShoulderImplant.Glenoid]:this.ShoulderImplantController.ControlAdjustImplant(o,OrthoPlugin_1.EShoulderImplant.Glenoid);break;case OrthoPlugin_1.EShoulderImplant[OrthoPlugin_1.EShoulderImplant.Humeral_Head]:this.ShoulderImplantController.ControlAdjustImplant(o,OrthoPlugin_1.EShoulderImplant.Humeral_Head);break}}else if(n.implant instanceof OrthoPlugin_1.HipImplantAnnotation){switch(n.template.ComponentName){case OrthoPlugin_1.EHipImplant[OrthoPlugin_1.EHipImplant.Stem]:this.HipImplantController.ControlAdjustImplant(o,OrthoPlugin_1.EHipImplant.Stem);break;case OrthoPlugin_1.EHipImplant[OrthoPlugin_1.EHipImplant.Cup]:this.HipImplantController.ControlAdjustImplant(o,OrthoPlugin_1.EHipImplant.Cup);break}}else if(n.implant instanceof OrthoPlugin_1.KneeImplantAnnotation){if(this.KneeImplantController.APviewport){if(n.template.ComponentName==="Femoral")this.KneeImplantController.ControlAdjustAPFemoralImplant(o);else if(n.template.ComponentName==="Tibial")this.KneeImplantController.ControlAdjustAPTibialImplant(o)}if(this.KneeImplantController.MLviewport){if(n.template.ComponentName==="Femoral")this.KneeImplantController.ControlAdjustMLFemoralImplant(o);else if(n.template.ComponentName==="Tibial")this.KneeImplantController.ControlAdjustMLTibialImplant(o)}}}}SetSeriesAutomaticInViewports(){}GetMarkers(){var t=OrthoPlugin_1.ResourceBag.MarkersJson;return[t]}GetOrthoContext(){var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t){var e=t.RendererPlugins[this.PluginName];return e}return null}InitAnnotations(t,e){var n=this.AssignOrthoContextToViewport(e);n.Annotations=new Array;e.Annotations[this.PluginName]=new Array}SetAnnotations(t,e){var n=e.RendererPlugins[this.PluginName];if(n!==undefined){n.Context=t;n.Annotations=e.Annotations[this.PluginName];if(!n.Context.IsPseudoSeries&&n.Annotations!==undefined&&n.Annotations!==null){n.Annotations.forEach((e=>{if(e instanceof OrthoPlugin_1.CalibrationAnnotation||e instanceof OrthoPlugin_1.CalibrationLinearAnnotation){n.Context.ImageEntity.CalibrationData=e.Serialize()}else if(e instanceof OrthoPlugin_1.KneeImplantAnnotation){if(e.APImageGuid===n.Context.ImageEntity.ImageGUID){if(!e.APContext)e.APContext=t}if(e.MLImageGuid===n.Context.ImageEntity.ImageGUID){if(!e.MLContext)e.MLContext=t}}}));if(n.Context.ImageEntity.IsCalibrated()){var o=n.Context.ImageEntity.GetCalibration();var l=n.Context.Viewport.GetFactorScaleImageLowOnHigh(o,n.Context.ImageEntity["dicomTags"]["0028_0011"],n.Context.ImageEntity["dicomTags"]["0028_0010"]);var a=(o.Value/(o.Diameter*l)).toFixed(5);n.Context.ImageEntity["pixelSpacing"]=[a,a,"mm"]}}e.AnnotationManager.UpdateAnnotationsPerPlugin(e.Annotations[this.PluginName],e)}}RenderAnnotations(t){var e=this.AssignOrthoContextToViewport(t);var n=this.Controller.AnnotationsHide;if(e.Annotations!==null&&e.Annotations!==undefined){for(var o=0;o<e.Annotations.length;o++){try{e.Annotations[o].Context=e.Context;if(!this.HideAnnotationSpecialForOrtho){if(!e.Annotations[o]["recentCreated"])e.Annotations[o].Visible=!n;else e.Annotations[o].Visible=true}e.Annotations[o].Render()}catch(t){WebClient.Utils.DebugConsoleLog(t)}}}if(e.CurrentAnnotation!==null&&e.CurrentAnnotation!==undefined){try{e.CurrentAnnotation.Render()}catch(t){WebClient.Utils.DebugConsoleLog(t)}}}SelectAnyTool(){if(this.Controller===undefined)return;var t=this.Controller.GetSelectViewport(this.Controller.ViewportPane);if(t===null)return;var e=t.RendererPlugins[this.PluginName];if(e===undefined||e.Context.Renderer===undefined)return;this.HideAnnotationSpecialForOrtho=false;this.SphereDetector=null;if(t!==null){if(e!==undefined&&e.CurrentAnnotation!==null&&e.CurrentAnnotation!==undefined){if(!this.Controller.ToolSelect.match("Annotation")){this.controlSpecialAnnotationsForOrtho(e,t);this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default");e.CurrentAnnotation=null}}e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}HoldSaveSpecialAnnotationsOnCourse(t){var e=t!==null&&t!==void 0?t:this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.PluginName];if(e!==null){if(n!==undefined&&n.CurrentAnnotation!==null&&n.CurrentAnnotation!==undefined){this.controlSpecialAnnotationsForOrtho(n,e)}}}SetSpecialAnnotationToCurrentDrawObject(controller,viewportIn,idCurrentAnnotationIn){let specialAnnotation=this.Controller.SpecialAnnotations[idCurrentAnnotationIn!==null&&idCurrentAnnotationIn!==void 0?idCurrentAnnotationIn:controller.IdCurrentAnnotation];let viewport=viewportIn!==null&&viewportIn!==void 0?viewportIn:this.Controller.GetSelectViewport(this.Controller.ViewportPane);try{if(specialAnnotation&&viewport&&specialAnnotation.IsActive){if(specialAnnotation.ImageGuid===viewport.Context.ImageEntity.ImageGUID){let orthoCtx=viewport.RendererPlugins[this.PluginName];orthoCtx.Context.Renderer.Render((ctx=>{let annotationTemporalNew=eval("new Vue.Products.OrthoPlugin."+specialAnnotation.Type+"()");annotationTemporalNew.Context=viewport.Context;if(controller instanceof OrthoPlugin_1.HipImplantController){WebClient.Cloner.CopyObjectFromto(specialAnnotation.Annotation,annotationTemporalNew,["Context"]);orthoCtx.CurrentAnnotation=annotationTemporalNew;if(!orthoCtx.Context.AnnotationController)orthoCtx.Context.AnnotationController=new ImagingStudyView.AnnotationController(orthoCtx.CurrentAnnotation);controller.HipAnnotation=orthoCtx.Context.AnnotationController.Instance=orthoCtx.CurrentAnnotation}else if(controller instanceof OrthoPlugin_1.ShoulderImplantController){WebClient.Cloner.CopyObjectFromto(specialAnnotation.Annotation,annotationTemporalNew,["Context"]);orthoCtx.CurrentAnnotation=annotationTemporalNew;if(!orthoCtx.Context.AnnotationController)orthoCtx.Context.AnnotationController=new ImagingStudyView.AnnotationController(orthoCtx.CurrentAnnotation);controller.ShoulderAnnotation=orthoCtx.Context.AnnotationController.Instance=orthoCtx.CurrentAnnotation}else if(controller instanceof OrthoPlugin_1.KneeImplantController){if(specialAnnotation.ContextReplaceNames.includes("APContext"))annotationTemporalNew.APContext=viewport.Context;else if(specialAnnotation.ContextReplaceNames.includes("MLContext"))annotationTemporalNew.MLContext=viewport.Context;WebClient.Cloner.CopyObjectFromto(specialAnnotation.Annotation,annotationTemporalNew,["Context","APContext","MLContext"]);orthoCtx.CurrentAnnotation=annotationTemporalNew;if(!orthoCtx.Context.AnnotationController)orthoCtx.Context.AnnotationController=new ImagingStudyView.AnnotationController(orthoCtx.CurrentAnnotation);controller.KneeAnnotation=orthoCtx.Context.AnnotationController.Instance=orthoCtx.CurrentAnnotation}specialAnnotation.IsActive=false;orthoCtx.Context.AnnotationController.Template=orthoCtx.CurrentAnnotation.GetTemplate();orthoCtx.Context.AnnotationController.EvaluateIsCompleted();delete this.Controller.SpecialAnnotations[idCurrentAnnotationIn!==null&&idCurrentAnnotationIn!==void 0?idCurrentAnnotationIn:controller.IdCurrentAnnotation];annotationTemporalNew.Render()}));orthoCtx.Context.OverlayRenderer.Render()}}}catch(t){WebClient.Utils.DebugConsoleLog(t)}}ProcessMouseDown(t,e,n){}ProcessMouseMove(t,e,n){if(!e.EnableActionsOnViewport)return;if(n.srcEvent!==undefined&&n.pointerType==="mouse"||(n.srcEvent===undefined||n instanceof MouseEvent)){this.moveOnCanvas(e,n)}}GetPointsGrips(t,e){var n=null;if(t===this.PluginName){var o=e.GetTemplate();if(o!==undefined){var l=o.Groups;var a=0;var r=Object.keys(l);r.forEach((t=>{if(l[t].IsDraggable)a+=l[t].MaxPoints}));if(a!==0)n=a}}return n}AssignOrthoContextToViewport(t){var e=t.RendererPlugins[this.PluginName];if(e===undefined)e=t.RendererPlugins[this.PluginName]=new OrthoPlugin_1.OrthoContext(this);e.Context=t.Context;return e}AnnotationDone(t,e){var n;var o=t.RendererPlugins[this.PluginName];if(o.Context.Viewport.Annotations[this.PluginName]===undefined)o.Context.Viewport.Annotations[this.PluginName]=o.Annotations;o.Context.Renderer.Render();o.Context.OverlayRenderer.Render();if((o.CurrentAnnotation instanceof OrthoPlugin_1.CalibrationAnnotation||o.CurrentAnnotation instanceof OrthoPlugin_1.CalibrationLinearAnnotation)&&this.CalibrationOptionFromMainMenu){this.Controller.HasBlockedDoubleClick=false;this.Controller.HasBlockedRightClick=false}else if(!(o.CurrentAnnotation instanceof OrthoPlugin_1.CalibrationAnnotation||o.CurrentAnnotation instanceof OrthoPlugin_1.CalibrationLinearAnnotation)){this.Controller.HasBlockedDoubleClick=false;this.Controller.HasBlockedRightClick=false}t.AnnotationManager.SaveAnnotation((n=o.CurrentAnnotation)!==null&&n!==void 0?n:o.LastAnnotationCreatedOrSelected,e);o.CurrentAnnotation=null;if(o.CurrentAnnotation instanceof OrthoPlugin_1.KneeImplantAnnotation){this.KneeImplantController.APviewport.RendererPlugins[this.PluginName].CurrentAnnotation=null;this.KneeImplantController.MLviewport.RendererPlugins[this.PluginName].CurrentAnnotation=null}}ReCreateViewport(t){}Evaluate3DAnnotation(t,e){}OpenPaneStlLayout(){}AnnotationKneeDone(t,e){var n;var o=t.RendererPlugins[this.PluginName];var l=e.RendererPlugins[this.PluginName];for(const t in l.CurrentAnnotation.Points){if(l.CurrentAnnotation.Points.hasOwnProperty(t)){var a=l.CurrentAnnotation.Points[t];if(t.match(/^ML/)!==null){o.CurrentAnnotation.Points[t]=a}}}l.CurrentAnnotation.Points=o.CurrentAnnotation.Points;o.CurrentAnnotation["MLImageGuid"]=l.CurrentAnnotation["MLImageGuid"];o.CurrentAnnotation["MLOrthoImplantFemoral"]=l.CurrentAnnotation["MLOrthoImplantFemoral"];o.CurrentAnnotation["MLOrthoImplantTibial"]=l.CurrentAnnotation["MLOrthoImplantTibial"];o.CurrentAnnotation["MLColsOrigin"]=l.CurrentAnnotation["MLColsOrigin"];o.CurrentAnnotation["MLRowsOrigin"]=l.CurrentAnnotation["MLRowsOrigin"];l.CurrentAnnotation["APImageGuid"]=o.CurrentAnnotation["APImageGuid"];l.CurrentAnnotation["APOrthoImplantFemoral"]=o.CurrentAnnotation["APOrthoImplantFemoral"];l.CurrentAnnotation["APOrthoImplantTibial"]=o.CurrentAnnotation["APOrthoImplantTibial"];l.CurrentAnnotation["APColsOrigin"]=o.CurrentAnnotation["APColsOrigin"];l.CurrentAnnotation["APRowsOrigin"]=o.CurrentAnnotation["APRowsOrigin"];if(o.Context.Viewport.Annotations[this.PluginName]===undefined)o.Context.Viewport.Annotations[this.PluginName]=o.Annotations;if(l.Context.Viewport.Annotations[this.PluginName]===undefined)l.Context.Viewport.Annotations[this.PluginName]=l.Annotations;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();l.CurrentAnnotation.Id=o.CurrentAnnotation.Id;o.CurrentAnnotation["DistanceAPDimensionPoints"]=l.CurrentAnnotation["DistanceAPDimensionPoints"];t.AnnotationManager.SaveAnnotation((n=o.CurrentAnnotation)!==null&&n!==void 0?n:o.LastAnnotationCreatedOrSelected);delete l.CurrentAnnotation["new"];e.AnnotationManager.UpdateAnnotationsToImage();o.CurrentAnnotation=null;l.CurrentAnnotation=null;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}GetManufacturers(t,e,n,o){var l="";if(e&&e!==""&&n&&n!==""&&o&&o!==""){l=`?group=${e}&patientSide=${n}&ProductType=${o}`}var a=WebClient.PlatformContext.PlatformUri+"/implants/manufacturers"+l;WebClient.Loader.Show("Loading manufacturers...");WebClient.HttpUtils.AjaxCall(a,"GET","min",null,((e,n)=>{WebClient.Loader.Hide();try{var o=new Array;var l=/([a-zA-Z0-9]*)/g;var a=n.match(l);if(a.length>0){var r=JSON.parse(n);t(r)}else{WebClient.Toaster.ShowToast("No exists data of manufacturers",WebClient.Colors.Orange,3.5)}}catch(t){WebClient.Utils.DebugConsoleLog(t);WebClient.Toaster.ShowToast("Error parsing manufacturers data",WebClient.Colors.Orange,3.5)}}),(t=>{WebClient.Loader.Hide();WebClient.Toaster.ShowToast("Error getting manufacturers",WebClient.Colors.Orange,3.5)}))}GetSettingsPaneNames(){return[]}GetSettings(t){}UpdateSettings(t,e){return true}CreateSettingsPane(t,e){}GetButtonsToMenu(t,e){var n=[];n.push(" ");for(var o=0;o<t.length;o++){switch(t[o]){case"Calibration":n.push(["calibrationTool2",OrthoPlugin_1.ResourceBag.Icons8Sphere32Png,t=>{this.CalibrationOptionFromMainMenu=true;this.Menu.ProcessCalibrationToolEvent(t,"calibrationTool2",e)}]);break}}return{dictionary:"OrthoPluginLanguage",buttons:n}}GetImageEntityForStudyAndSeries(t,e,n,o){return null}SetDefaultTool(t){}GetImplantDetected(t,e,n,o=true,l=false,a=false){let r;let s=t.PointInElement(e,n);let h=t.RendererPlugins[this.PluginName];let m=h.CurrentAnnotation?[h.CurrentAnnotation]:h.Annotations;if(t.Context.ImageEntity){let e=t.Context.ImageEntity["pixelSpacing"];let n={valueX:e[0],valueY:e[1],metric:e[2]};m.forEach((e=>{for(const h in e){if(Object.prototype.hasOwnProperty.call(e,h)){const m=e[h];if(m instanceof OrthoPlugin_1.OrthoTemplate){if(m.ImplantReadyForDraw){if(o){let o=m.DetectImplant(n,t.Context.ScaleX,s);if(o){r={template:m,implant:e};break}}else{if(l){if(m.Selected||m.Hover){r={template:m,implant:e};break}}else{if(a&&m.Selected){r={template:m,implant:e};break}}}}}}}}))}return r}ClearViewports(){}ExecuteCalibration(t,e){if(e>0){let n=this.Controller.ToolSelect;let o=this.GetOrthoContext().Context.Viewport;let l=o.RendererPlugins[this.PluginName];this.processAnnotations(n,null,t,ImagingStudyView.EAnnotationEventType.Tap,o);l.CurrentAnnotation.Points["EndPoints"]=[];l.CurrentAnnotation.Diameter=e;l.Context.AnnotationController.IsCompleted=true;this.processAnnotations(n,null,t,ImagingStudyView.EAnnotationEventType.Tap,o)}else{WebClient.Toaster.ShowToast("Calibration Sphere not found.",WebClient.Colors.GreenSea,5)}}processMouseUp(t,e,n){}processSingleTapEvent(t,e,n){var o,l,a;var r;var s;var h=e.RendererPlugins[this.PluginName];var m;if(!e.EnableActionsOnViewport)return;if(e.Context.ImageEntity===null)return;if(n.srcEvent!==undefined&&n.pointerType==="mouse"||(n.pointerType==="touch"||n.pointerType==="pen"||((o=n.srcEvent)===null||o===void 0?void 0:o.touches))){r=DOMUtils.GetOffset(n,"x");s=DOMUtils.GetOffset(n,"y");e.Context.MouseDownX=e.Context.MouseMoveX=r;e.Context.MouseDownY=e.Context.MouseMoveY=s}var d=e.PointInElement(e.Context.MouseDownX,e.Context.MouseDownY);if(!t.match("Annotation")||t==="OrthoAnnotationHipImplant"||t==="OrthoAnnotationShoulderImplant"||t==="OrthoAnnotationKneeImplant"||t==="OrthoAnnotationAlignmentTool"){m=e.DetectAnnotation(d);if(m!==null&&!h.Context.IsPseudoSeries){if(this.LayoutController!==undefined&&this.LayoutController.StatusButtonIsActive&&!this.LayoutController.LayoutOptionActive){if(!m.annotation.IsReferable)return;if(m.endRangePoints==="")return;m.annotation.IsReferenced=true;this.Controller.View.ReferencedAnnotationLayout=m;this.LayoutController.StatusButtonIsActive=false;this.LayoutController.LayoutView.ControlButtonReference();this.LayoutController.LayoutView.ControlButtonsTop();e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}if(m.annotation.Plugin!==this.PluginName)return;e.IsAnyAnnotationSelected=true;if(m.annotation instanceof OrthoPlugin_1.HipImplantAnnotation){if(!m.annotation.Selected){h.Annotations.forEach((t=>{if(t instanceof OrthoPlugin_1.HipImplantAnnotation)t.Selected=false}));m.annotation.Selected=true;h.LastAnnotationCreatedOrSelected=m.annotation;h.Context.AnnotationController=new ImagingStudyView.AnnotationController(m.annotation);this.Menu.ProcessHipImplantToolEvent(null,true,m.annotation)}}else if(m.annotation instanceof OrthoPlugin_1.ShoulderImplantAnnotation){if(!m.annotation.Selected){h.Annotations.forEach((t=>{if(t instanceof OrthoPlugin_1.ShoulderImplantAnnotation)t.Selected=false}));m.annotation.Selected=true;h.LastAnnotationCreatedOrSelected=m.annotation;h.Context.AnnotationController=new ImagingStudyView.AnnotationController(m.annotation);this.Menu.ProcessShoulderImplantToolEvent(null,true,m.annotation)}}else if(m.annotation instanceof OrthoPlugin_1.KneeImplantAnnotation){if(!m.annotation.Selected){m.annotation.Selected=true;m.annotation.IsEdition=true;h.LastAnnotationCreatedOrSelected=m.annotation;h.Context.AnnotationController=new ImagingStudyView.AnnotationController(m.annotation);this.Menu.ProcessKneeImplantToolEvent(null,true,m.annotation)}}else if(m.annotation instanceof OrthoPlugin_1.AlignmentToolAnnotation){if(!m.annotation.Selected){m.annotation.Selected=true;m.annotation.IsEdition=true;h.LastAnnotationCreatedOrSelected=m.annotation;h.Context.AnnotationController=new ImagingStudyView.AnnotationController(m.annotation);this.Menu.ProcessAlignmentTool(null,true,"AlignmentTool","eFit",m.annotation,m.groupName)}}else{m.annotation.Selected=!m.annotation.Selected}e.Annotations[this.PluginName]=h.Annotations;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render();return}else{this.detectImplants(t,h,e);e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}if(WebClient.Utils.CheckNotAllowTag(["patient"])){this.Controller.View.Platform.Toolbar.PerformButtonAction("toolbarviewer.2","deleteAnnotTool",(t=>{if(this.GetAnnotSelectCount()>=1)t.Element.style.display="inline-block"}))}(l=this.KneeImplantController)===null||l===void 0?void 0:l.ControlTapAPView(e);(a=this.KneeImplantController)===null||a===void 0?void 0:a.ControlTapMLView(e);if(t.match("^OrthoAnnotation")){if(e.Context.ImageEntity===null)return;if(e.Context.IsPseudoSeries)return;if(t==="OrthoAnnotationAngleTool"){m=e.DetectAnnotation(d);if(m!==null){e.IsAnyAnnotationSelected=true;m.annotation.Selected=true}if(e.CountingSelectedLinesAnnotations().length===2){let t=h.CurrentAnnotation.SearchSelected();if(t.linesCount>0){h.Context.Renderer.Render();h.Context.OverlayRenderer.Render();h.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;h.Annotations.push(h.CurrentAnnotation);this.AnnotationDone(e);e.SelectUnSelectAnnotations(false);this.LayoutController.LayoutView.ControlButtonsTop();this.LayoutController.LayoutView.UnSelectAngleTool();this.Controller.SelectDefaultTool()}else{WebClient.Toaster.ShowToast("Can't get angle.",WebClient.Colors.GreenSea,5);t.arrayAnnots.forEach((t=>t.Selected=false));h.Context.Renderer.Render();h.Context.OverlayRenderer.Render()}}}else{if(t==="OrthoAnnotationHipImplant"){if(this.HipImplantController){let t=this.HipImplantController.HipImplantView.ValidateViewportStarted();if(t){var u=this.Controller.GetSelectViewport(this.Controller.ViewportPane);this.HipImplantController.InitialViewportStart=u;let t=u.RendererPlugins[this.PluginName];this.HipImplantController.HipImplantView.ControlStatusMainButtons(t,this.HipImplantController.Edition,this.HipImplantController.ActionHip,this.HipImplantController.HipAnnotation)}}}else if(t==="OrthoAnnotationShoulderImplant"){if(this.ShoulderImplantController){let t=this.ShoulderImplantController.ShoulderImplantView.ValidateViewportStarted();if(t){var p=this.Controller.GetSelectViewport(this.Controller.ViewportPane);this.ShoulderImplantController.InitialViewportStart=p;let t=p.RendererPlugins[this.PluginName];this.ShoulderImplantController.ShoulderImplantView.ControlStatusMainButtons(t,this.ShoulderImplantController.Edition,this.ShoulderImplantController.ActionShoulder,this.ShoulderImplantController.ShoulderAnnotation)}}}this.processAnnotations(t,n,d,ImagingStudyView.EAnnotationEventType.Tap,e)}}}processPanEvent(t,e,n,o){var l,a,r;var s;var h;switch(t){case"panstart":if(!n.EnableActionsOnViewport)return;let t=n.RendererPlugins[this.PluginName];s=DOMUtils.GetOffset(o,"x");h=DOMUtils.GetOffset(o,"y");if(n.Context.ImageEntity===null||n.Context.ImageEntity["dicomTags"]===undefined)return;if(o.srcEvent!==undefined&&o.pointerType==="mouse"){n.Context.MouseDownX=n.Context.MouseMoveX=this.moveX=s;n.Context.MouseDownY=n.Context.MouseMoveY=this.moveY=h}else if(o.pointerType==="touch"||o.pointerType==="pen"||((l=o.srcEvent)===null||l===void 0?void 0:l.touches)){n.Context.MouseDownX=n.Context.MouseMoveX=this.moveX=s;n.Context.MouseDownY=n.Context.MouseMoveY=this.moveY=h}this.detectImplants(e,t,n,true);this.startDragImplants(n,t);if(e.match("^OrthoAnnotation")){if(n.Context.ImageEntity===null)return;if(n.Context.IsPseudoSeries)return}break;case"panmove":if(!n.EnableActionsOnViewport)return;if(n.Context.ImageEntity===null)return;if(e.match("^OrthoAnnotation")&&(o.pointerType==="touch"||o.pointerType==="pen"||((a=o.srcEvent)===null||a===void 0?void 0:a.touches)))this.moveOnCanvas(n,o);break;case"panend":if(!n.EnableActionsOnViewport)return;this.isDragImplant=false;this.isDragControlRotateImplant=false;this.mouseRotateC=null;s=DOMUtils.GetOffset(o,"x");h=DOMUtils.GetOffset(o,"y");if(o.srcEvent!==undefined&&o.pointerType==="mouse"){s=DOMUtils.GetOffset(o,"x");h=DOMUtils.GetOffset(o,"y");n.Context.MouseDownX=n.Context.MouseMoveX=s;n.Context.MouseDownY=n.Context.MouseMoveY=h}else if(o.pointerType==="touch"||o.pointerType==="pen"||((r=o.srcEvent)===null||r===void 0?void 0:r.touches)){s=DOMUtils.GetOffset(o,"x");h=DOMUtils.GetOffset(o,"y");n.Context.MouseDownX=n.Context.MouseMoveX=s;n.Context.MouseDownY=n.Context.MouseMoveY=h}break}}processDoubleTap(t,e,n){if(e.Context.ImageEntity===null)return;var o=this.Controller.View.Platform.GetSetting("selectMouseBehLeftDoubleClick")}getCurrentSpineAnnotation(t,e){var n=e.RendererPlugins[this.PluginName];var o=null;for(var l=0;l<n.Annotations.length;l++){var a=n.Annotations[l].TextLabel;if(a!==undefined&&a.toUpperCase()===t){return l}}return o}moveOnCanvas(t,e){var n;var o=t.RendererPlugins[this.PluginName];var l=DOMUtils.GetOffset(e,"x");var a=DOMUtils.GetOffset(e,"y");this.moveX=l;this.moveY=a;if(o.Context.ImageEntity===null||o.Context.ImageEntity["dicomTags"]===undefined)return;if(o.Context.Viewport.PauseMoveForClickEvent)return;this.moveImplants(o,l,a,t);if(o.CurrentAnnotation&&this.Controller.ToolSelect.match("^OrthoAnnotation")){if(o.Context.IsPseudoSeries)return;o.Context.Viewport.UpdateDeltaInMove(e);n=o.Context.Viewport.PointInElement(o.Context.MouseMoveX,o.Context.MouseMoveY);if(o.CurrentAnnotation!==undefined&&o.CurrentAnnotation!==null){o.CurrentAnnotation.ReferenceAnnotation=this.Controller.View.ReferencedAnnotationLayout;o.Context.Renderer.Render((t=>{o.CurrentAnnotation.Render()}));o.Context.OverlayRenderer.Render();o.CurrentAnnotation.TemporalCurrentGroupName=o.Context.AnnotationController.CurrentGroup?o.Context.AnnotationController.CurrentGroup.GroupName:null;o.CurrentAnnotation.TemporalPoint=new ImagingStudyView.AnnotationPoint(n)}}if(this.SphereDetector){}if(this.AlignmentToolController){try{if(t.InitDragMoveAnnotFromGrip)this.AlignmentToolController.ShowSummary()}catch(t){}}if(this.KneeImplantController){try{if(t.InitDragMoveAnnotFromGrip)this.KneeImplantController.UpdateMeasures(OrthoPlugin_1.ETemplateView[this.KneeImplantController.KneeImplantView.IdDefault])}catch(t){}}}preProcessAnnotations(t,e){var n=e.RendererPlugins[this.PluginName];switch(t){case"OrthoAnnotationHipImplant":case"OrthoAnnotationShoulderImplant":case"OrthoAnnotationKneeImplant":case"OrthoAnnotationAlignmentTool":if(n.LastAnnotationCreatedOrSelected!==null&&n.LastAnnotationCreatedOrSelected!==undefined){n.CurrentAnnotation=n.LastAnnotationCreatedOrSelected;if(n.CurrentAnnotation instanceof OrthoPlugin_1.HipImplantAnnotation){this.HipImplantController.HipAnnotation=n.CurrentAnnotation}else if(n.CurrentAnnotation instanceof OrthoPlugin_1.ShoulderImplantAnnotation){this.ShoulderImplantController.ShoulderAnnotation=n.CurrentAnnotation}else if(n.CurrentAnnotation instanceof OrthoPlugin_1.KneeImplantAnnotation){this.KneeImplantController.KneeAnnotation=n.CurrentAnnotation;n.Context.AnnotationController.Instance=n.CurrentAnnotation}if(!n.Context.AnnotationController)n.Context.AnnotationController=new ImagingStudyView.AnnotationController(n.CurrentAnnotation)}if(t==="OrthoAnnotationKneeImplant"){if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP]){this.KneeImplantController.AssingViewportToAPView(e);if(n.Context.AnnotationController!==undefined&&n.Context.AnnotationController!==null&&n.Context.AnnotationController.CurrentGroup===null)this.KneeImplantController.KneeImplantView.ViewTab(n.CurrentAnnotation);if(this.KneeImplantController.APviewport!==null&&this.KneeImplantController.APviewport!==undefined&&this.KneeImplantController.APviewport!==e)return false}else if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.ML]){this.KneeImplantController.AssingViewportToMLView(e);if(n.Context.AnnotationController!==undefined&&n.Context.AnnotationController!==null&&n.Context.AnnotationController.CurrentGroup!==null)this.KneeImplantController.KneeImplantView.ViewTab(n.CurrentAnnotation);if(this.KneeImplantController.MLviewport!==null&&this.KneeImplantController.MLviewport!==undefined&&this.KneeImplantController.MLviewport!==e)return false}var o=n.Context.ImageEntity.IsCalibrated();if(!o){if(this.KneeImplantController.ViewportsSelected){WebClient.Toaster.ShowToast("The image is not calibrated.",WebClient.Colors.GreenSea,5);return false}}if(n.Context.AnnotationController!==undefined&&n.Context.AnnotationController!==null&&n.Context.AnnotationController.CurrentGroup===null)this.KneeImplantController.StatusDraw=false}break;case"OrthoAnnotationCalibration":case"OrthoAnnotationCalibrationLinear":if(!this.CalibrationController.TypeCalibration)return false;break}return true}createObservation(t,e){let n={resourceType:"Observation",id:"embedded"+e,valueString:t,status:"registered",code:{}};return n}processOrthoAnnotationSpine(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];var r=new ImagingStudyView.AnnotationPoint(o,l);if(t){if(this.SpineController.SpineCurrent!==null){a.Context.AnnotationController.SetFirstGroup();a.Context.AnnotationController.RegisterPoint(r);a.CurrentAnnotation.Type=OrthoPlugin_1.AnnotType.Spine.toString();a.CurrentAnnotation.TextLabel=this.SpineController.SpineCurrent;var s=this.getCurrentSpineAnnotation(this.SpineController.SpineCurrent,n);if(s!==null){delete a.CurrentAnnotation["new"];a.Annotations[s]=a.CurrentAnnotation}else{a.Annotations.push(a.CurrentAnnotation)}this.AnnotationDone(n);this.SpineController.SpineCurrent=this.SpineController.GetNextValue(this.SpineController.SpineCurrent)}else{if(a.CurrentAnnotation!==null)a.CurrentAnnotation=null}}}processOrthoAnnotationCalibrationLinear(t,e,n,o,l){this.processOrthoAnnotationCalibration(t,e,n,o,l)}processOrthoAnnotationAutoCalibration(t,e,n,o,l){this.processOrthoAnnotationCalibration(t,e,n,o,l)}processOrthoAnnotationCalibration(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];var r=new ImagingStudyView.AnnotationPoint(o,l);if(t){this.CalibrationController.CalibrationAnnotation=a.CurrentAnnotation;a.Context.AnnotationController.SetFirstGroup();a.Context.AnnotationController.RegisterPoint(r);if(a.CurrentAnnotation&&a.CurrentAnnotation instanceof OrthoPlugin_1.CalibrationLinearAnnotation){let t=this.CalibrationController.GetCalibrationOption();a.CurrentAnnotation.Value=t}}else{a.Context.AnnotationController.RegisterPoint(r);if(a.CurrentAnnotation.DrawIsValid()){if(a.Context.AnnotationController.IsCompleted){if(this.CalibrationController.Data!==null&&this.CalibrationController.Data!==undefined){var s="mm";let t=this.CalibrationController.GetCalibrationOption();if(t===0||t<10||t>100){WebClient.Toaster.ShowToast("The value entered must be between 10 to 100.",WebClient.Colors.GreenSea,5);a.Context.AnnotationController.ReversePointRegister();a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();return}for(var h=0;h<a.Annotations.length;h++){if(a.Annotations[h]instanceof OrthoPlugin_1.CalibrationAnnotation||a.Annotations[h]instanceof OrthoPlugin_1.CalibrationLinearAnnotation){n.AnnotationManager.DeleteAnnotation(a.Annotations[h]);a.Annotations.splice(h,1);h=-1}}a.CurrentAnnotation.ImageGuid=n.Context.ImageEntity.ImageGUID;a.CurrentAnnotation.StudyGuid=n.Context.StudyGuid;a.CurrentAnnotation.SeriesGuid=n.Context.SeriesGuid;a.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;a.CurrentAnnotation.Value=t;a.CurrentAnnotation.MeasureAnnotation();a.Context.ImageEntity.CalibrationData=a.CurrentAnnotation.Serialize();var m=(a.CurrentAnnotation["Value"]/a.CurrentAnnotation["Diameter"]).toFixed(5);a.Context.ImageEntity["pixelSpacing"]=[m,m,s];a.Annotations.push(a.CurrentAnnotation);this.AnnotationDone(n);this.CalibrationController.Data=null;this.CalibrationController.TypeCalibration=null;this.Controller.TopBarElement.Element.innerHTML="";if(!this.CalibrationOptionFromMainMenu){let t=0;if(this.CalibrationController.AnnotationReference!==null&&this.CalibrationController.AnnotationReference.Name==="HipImplantAnnotation"){t=parseFloat(this.HipImplantController.HipImplantView.OrthoFloatingBar.Element.style.height);this.Controller.SelectTool("OrthoAnnotationHipImplant","HipImplantTool");var d=this.HipImplantController.LegSide;OrthoPlugin.HipImplantControlerStaticInstance=this.HipImplantController=OrthoPlugin_1.HipImplantController.Create(this,this.CalibrationController.AnnotationReference||this.CalibrationController.AnnotationController.HipAnnotation,this.HipImplantController.Edition,[0],true);this.HipImplantController.LegSide=d;this.HipImplantController.HipImplantView.SetBodyHip(d);this.HipImplantController.HipImplantView.OrthoFloatingBar.Element.style.height=t+"px";this.HipImplantController.HipImplantView.OrthoFloatingBar.Element.children[0].style.height=`${t-5}px`}else if(this.CalibrationController.AnnotationReference!==null&&this.CalibrationController.AnnotationReference.Name==="ShoulderImplantAnnotation"){t=parseFloat(this.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Element.style.height);this.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");var u=this.ShoulderImplantController.LegSide;OrthoPlugin.ShoulderImplantControlerStaticInstance=this.ShoulderImplantController=OrthoPlugin_1.ShoulderImplantController.Create(this,this.CalibrationController.AnnotationReference||this.CalibrationController.AnnotationController.ShoulderAnnotation,this.ShoulderImplantController.Edition,[0],true);this.ShoulderImplantController.LegSide=u;this.ShoulderImplantController.ShoulderImplantView.SetBodyShoulder(u);this.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Element.style.height=t+"px";this.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Element.children[0].style.height=`${t-5}px`}else if(this.CalibrationController.AnnotationReference!==null&&this.CalibrationController.AnnotationReference.Name==="KneeImplantAnnotation"||this.CalibrationController.AnnotationController!==null&&this.CalibrationController.AnnotationController!==undefined&&this.CalibrationController.AnnotationController.KneeAnnotation!==undefined&&this.CalibrationController.AnnotationController.KneeAnnotation.Name==="KneeImplantAnnotation"){t=parseFloat(this.KneeImplantController.KneeImplantView.OrthoFloatingBar.Element.style.height);this.Controller.SelectTool("OrthoAnnotationKneeImplant","KneeImplantTool");var p=this.KneeImplantController.LegSide;OrthoPlugin.KneeImplantControlerStaticInstance=this.KneeImplantController=OrthoPlugin_1.KneeImplantController.Create(this,this.CalibrationController.AnnotationReference||this.CalibrationController.AnnotationController.KneeAnnotation,this.KneeImplantController.Edition,[0],this.CalibrationController.AnnotationController,true);this.KneeImplantController.LegSide=p;this.KneeImplantController.KneeImplantView.SetBodyKnee(p);this.KneeImplantController.KneeImplantView.OrthoFloatingBar.Element.style.height=t+"px";this.KneeImplantController.KneeImplantView.OrthoFloatingBar.Element.children[0].style.height=`${t-5}px`}else if(this.CalibrationController.AnnotationReference!==null&&this.CalibrationController.AnnotationReference.Name==="AlignmentToolAnnotation"){t=parseFloat(this.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Element.style.height);this.Controller.SelectTool("OrthoAnnotationAlignmentTool","AlignmentTool");this.AlignmentToolController=OrthoPlugin_1.AlignmentToolController.Create(this,this.CalibrationController.AnnotationReference||this.CalibrationController.AnnotationController.AlignmentToolAnnotation,this.AlignmentToolController.Edition,"AlignmentTool","eFit");this.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Element.style.height=t+"px";this.AlignmentToolController.AlignmentToolView.OrthoFloatingBar.Element.children[0].style.height=`${t-5}px`}if(this.CalibrationController.Callback!==undefined){this.CalibrationController.Callback()}this.ManagementFloatingBar.RemoveFloatingBar(this.CalibrationController.CalibrationView.OrthoFloatingBar.Id);this.CalibrationController.Controller.TopBarElement.Hide()}else{this.ManagementFloatingBar.RemoveFloatingBar(this.CalibrationController.CalibrationView.OrthoFloatingBar.Id);this.CalibrationController.Controller.TopBarElement.Hide();this.Menu.CancelCalibration();this.Controller.SelectDefaultTool()}}}}else{a.Context.AnnotationController.ReversePointRegister()}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}}controlSpecialAnnotationsForOrtho(t,e){try{if(t.CurrentAnnotation.CanSavedInSpecialStructure){if(t.CurrentAnnotation instanceof OrthoPlugin_1.KneeImplantAnnotation){let t=this.KneeImplantController.APviewport.RendererPlugins[this.PluginName];this.KneeImplantController.APIdCurrentAnnotation=t.CurrentAnnotation.Id;let n=this.KneeImplantController.MLviewport.RendererPlugins[this.PluginName];this.KneeImplantController.MLIdCurrentAnnotation=n.CurrentAnnotation.Id;if(e===this.KneeImplantController.APviewport){if(this.KneeImplantController.KneeImplantView["orthoToolWindow"].MainSection.parentElement)this.KneeImplantController.KneeImplantView.ActionApButton(false)}else if(e===this.KneeImplantController.MLviewport){if(this.KneeImplantController.KneeImplantView["orthoToolWindow"].MainSection.parentElement)this.KneeImplantController.KneeImplantView.ActionMlButton(false)}e.AnnotationManager.SaveToSpecialAnnotation(this.KneeImplantController.APviewport.RendererPlugins[this.PluginName].CurrentAnnotation,this.KneeImplantController.APviewport,this.PluginName,["Context","APContext"],["Context","APContext","MLContext"]);e.AnnotationManager.SaveToSpecialAnnotation(this.KneeImplantController.MLviewport.RendererPlugins[this.PluginName].CurrentAnnotation,this.KneeImplantController.MLviewport,this.PluginName,["Context","MLContext"],["Context","APContext","MLContext"])}else{if(t.CurrentAnnotation instanceof OrthoPlugin_1.HipImplantAnnotation){this.HipImplantController.IdCurrentAnnotation=t.CurrentAnnotation.Id;if(this.HipImplantController.HipImplantView["orthoToolWindow"].MainSection.parentElement)this.HipImplantController.HipImplantView.ActionApButton(false)}else if(t.CurrentAnnotation instanceof OrthoPlugin_1.ShoulderImplantAnnotation){this.ShoulderImplantController.IdCurrentAnnotation=t.CurrentAnnotation.Id;if(this.ShoulderImplantController.ShoulderImplantView["orthoToolWindow"].MainSection.parentElement)this.ShoulderImplantController.ShoulderImplantView.ActionApButton(false)}e.AnnotationManager.SaveToSpecialAnnotation(t.CurrentAnnotation,e,this.PluginName,["Context"],["Context"])}}}catch(t){WebClient.Utils.DebugConsoleLog(t)}}processOrthoAnnotationCobbAngle(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];var r=new ImagingStudyView.AnnotationPoint(o,l);if(t){a.Context.AnnotationController.SetFirstGroup();a.Context.AnnotationController.RegisterPoint(r)}else{a.Context.AnnotationController.RegisterPoint(r);if(a.CurrentAnnotation.DrawIsValid()){if(a.Context.AnnotationController.IsCompleted){a.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;a.Annotations.push(a.CurrentAnnotation);this.AnnotationDone(n);this.Controller.SelectDefaultTool()}}else a.Context.AnnotationController.ReversePointRegister();a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}}processOrthoAnnotationAlignmentTool(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];var r=new ImagingStudyView.AnnotationPoint(o,l);var s=a.Context.AnnotationController.CurrentGroup!==null?a.Context.AnnotationController.CurrentGroup.GroupName:"";var h;if(t){this.AlignmentToolController.AlignmentToolAnnotation=a.CurrentAnnotation;this.AlignmentToolController.AlignmentToolAnnotation.Leg=this.AlignmentToolController.LegSelect;if(!a.Context.AnnotationController.CurrentGroup)a.Context.AnnotationController.SetFirstGroup();if(this.AlignmentToolController.StatusDraw)a.Context.AnnotationController.RegisterPoint(r)}else{if(!a.Context.AnnotationController.CurrentGroup)this.AlignmentToolController.StatusDraw=false;if(this.AlignmentToolController.StatusDraw)a.Context.AnnotationController.RegisterPoint(r);if(a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["FemoralPoints"])&&s==="FemoralPoints"){this.AlignmentToolController.ShowTextAndControl(2,this.AlignmentToolController.AlignmentToolView.OrthoElementsSection2,0,1,"TextMechanicalAxisTibial","TibialPoints",this.AlignmentToolController.Edition)}if(a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["TibialPoints"])&&s==="TibialPoints"){this.AlignmentToolController.ActionOkMechanicalAxisTibial();this.AlignmentToolController.StatusDraw=false;this.AlignmentToolController.AlignmentToolView.SwitchSummaryOrDetails(true)}if(a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["TKAFemoralPoints"])&&s==="TKAFemoralPoints"){this.AlignmentToolController.ShowTextAndControl(2,this.AlignmentToolController.AlignmentToolView.OrthoElementsSection2,0,3,"TextAnatomicalAxisTibial","TKATibialPoints",this.AlignmentToolController.Edition)}if(a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["TKATibialPoints"])&&s==="TKATibialPoints"){this.AlignmentToolController.ActionOkTKA();this.AlignmentToolController.StatusDraw=false;this.AlignmentToolController.AlignmentToolView.SwitchSummaryOrDetails(true)}}this.AlignmentToolController.ShowSummary();a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();if(a.Context.AnnotationController.CurrentGroup===null){this.AlignmentToolController.AlignmentToolAnnotation.CanDragPoint=true;this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default")}else if(a.Context.AnnotationController.CurrentGroup){switch(a.Context.AnnotationController.CurrentGroup.GroupName){case"FemoralPoints":switch(this.AlignmentToolController.AlignmentToolAnnotation.Points["FemoralPoints"].length){case 1:this.AlignmentToolController.ShowTextAndControl(2,this.AlignmentToolController.AlignmentToolView.OrthoElementsSection2,0,0,"TextMechanicalAxisFemoral","FemoralPoints",this.AlignmentToolController.Edition,"Enter a point for Femoral Center at Knee");break;case 2:this.AlignmentToolController.ShowTextAndControl(2,this.AlignmentToolController.AlignmentToolView.OrthoElementsSection2,0,0,"TextMechanicalAxisFemoral","FemoralPoints",this.AlignmentToolController.Edition,"Enter a point for Femoral Shaft Center")}break;case"TibialPoints":switch(this.AlignmentToolController.AlignmentToolAnnotation.Points["TibialPoints"].length){case 1:this.AlignmentToolController.ShowTextAndControl(2,this.AlignmentToolController.AlignmentToolView.OrthoElementsSection2,0,1,"TextMechanicalAxisTibial","TibialPoints",this.AlignmentToolController.Edition,"Enter a point for Ankle Center");break}break;case"TKAFemoralPoints":switch(this.AlignmentToolController.AlignmentToolAnnotation.Points["TKAFemoralPoints"].length){case 1:this.AlignmentToolController.ShowTextAndControl(2,this.AlignmentToolController.AlignmentToolView.OrthoElementsSection2,0,2,"TextAnatomicalAxisFemoral","TKAFemoralPoints",this.AlignmentToolController.Edition,"Enter a point for Femoral Center at Knee");break}break;case"TKATibialPoints":switch(this.AlignmentToolController.AlignmentToolAnnotation.Points["TKATibialPoints"].length){case 1:this.AlignmentToolController.ShowTextAndControl(2,this.AlignmentToolController.AlignmentToolView.OrthoElementsSection2,0,3,"TextAnatomicalAxisTibial","TKATibialPoints",this.AlignmentToolController.Edition,"Enter a point for Ankle Center");break}break}}}processOrthoAnnotationHipImplant(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];var r=new ImagingStudyView.AnnotationPoint(o,l);var s=a.Context.AnnotationController.CurrentGroup!==null?a.Context.AnnotationController.CurrentGroup.GroupName:"";var h=n.Context.ImageEntity["pixelSpacing"][2];var m=n.Context.ImageEntity["pixelSpacing"][0];var d=n.Context.ImageEntity["pixelSpacing"][1];var u=m||d;if(this.HipImplantController.StatusDraw&&!a.Context.AnnotationController.IsCompleted)this.HipImplantController.HipAnnotation=a.CurrentAnnotation;if(t){this.HipImplantController.RerenderImplantBySide(this.HipImplantController.LegSide);if(a.Context.AnnotationController.CurrentGroup===null)a.Context.AnnotationController.SetFirstGroup();if(this.HipImplantController.StatusDraw)a.Context.AnnotationController.RegisterPoint(r)}else{this.HipImplantController.RerenderImplantBySide(this.HipImplantController.LegSide);if(!a.Context.AnnotationController.IsCompleted||a.Context.AnnotationController.CurrentGroup.GroupName==="AbductionLine"&&!a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["AbductionLine"])){if(this.HipImplantController.StatusDraw)a.Context.AnnotationController.RegisterPoint(r)}if(a.CurrentAnnotation.DrawIsValid(s,u)){if(!a.Context.AnnotationController.IsCompleted){if(a.Context.AnnotationController.CurrentGroup!==null&&a.Context.AnnotationController.CurrentGroup.GroupName!=="AbductionLine"){if(a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["FemoralHead"])&&a.Context.AnnotationController.CurrentGroup.PrevGroup&&a.Context.AnnotationController.CurrentGroup.PrevGroup.GroupName==="FemoralHead"){this.HipImplantController.ActionsSummaryData["Code04"]={Code:"Code04",Description:"Femoral head diameter "+Math.round(a.CurrentAnnotation.GetFemoralHeadDiameter()*u)+" "+h};this.HipImplantController.ActionHip=OrthoPlugin_1.EActionHip.FemoralCurveDistal;this.HipImplantController.ShowTextAndControl(2,this.HipImplantController.HipImplantView.OrthoElementsSection2,"FemoralRightLateralSection","RightTextLateralFemoral","CurveDistal",false);this.HipImplantController.ShowSummary()}if(a.Context.AnnotationController.GroupIsComplete(a.Context.AnnotationController.Template.Groups["CurveDistal"])&&a.Context.AnnotationController.CurrentGroup.PrevGroup&&a.Context.AnnotationController.CurrentGroup.PrevGroup.GroupName==="CurveDistal"){this.HipImplantController.ActionHip=OrthoPlugin_1.EActionHip.FemoralCurveMedial;this.HipImplantController.ShowSummary()}}else if(a.Context.AnnotationController.CurrentGroup===null){if(a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["Acetabulum"])&&s==="Acetabulum"){this.HipImplantController.ActionsSummaryData["Code05"]={Code:"Code05",Description:"Acetabular diameter "+Math.round(a.CurrentAnnotation.GetAcetabulumDiameter()*u)+" "+h};if(!a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["FemoralHead"])){a.Context.AnnotationController.SetCurrentGroup("FemoralHead");var p=WebClient.Form.GetFieldFromForms(this.HipImplantController.HipImplantView.DataSection1,"BtnFemur");p.htmlElement.click()}else{this.HipImplantController.ActionHip=OrthoPlugin_1.EActionHip.None;this.HipImplantController.ShowTextAndControl(2,this.HipImplantController.HipImplantView.OrthoElementsSection2,"AcetabulumSection","","",false);this.HipImplantController.ShowSummary()}if(this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant.ImplantReadyForDraw){var c=this.HipImplantController.HipAnnotation.GetInitialAcetabularCupImplantPosition();this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant.OffsetX=0;this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant.OffsetY=0;this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant.PositionX=parseFloat(c.X.toString());this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant.PositionY=parseFloat(c.Y.toString());this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant.Rotation=this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant.WasRotated?this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant.Rotation:this.HipImplantController.HipAnnotation.GetInitialAcetabularImplantRotationAngle()*(180/Math.PI);a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();this.HipImplantController.ImplantInformation(this.HipImplantController.HipAnnotation.OrthoAcetabularCupImplant,OrthoPlugin_1.EHipImplant.Cup)}}else if(a.Context.AnnotationController.GroupIsSatisfied(a.Context.AnnotationController.Template.Groups["AbductionLine"])&&s==="AbductionLine"){this.HipImplantController.ActionOkHipStatusAbductionAngle()}else if(a.Context.AnnotationController.GroupIsComplete(a.Context.AnnotationController.Template.Groups["CurveDistal"])&&a.Context.AnnotationController.GroupIsComplete(a.Context.AnnotationController.Template.Groups["CurveMedial"])&&s==="CurveMedial"){this.HipImplantController.ActionOkHipStatusFemoralCurveMedial()}}}}else{if(s)a.Context.AnnotationController.SetCurrentGroup(s);a.Context.AnnotationController.ReversePointRegister()}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();if(a.Context.AnnotationController.CurrentGroup===null){this.HipImplantController.HipAnnotation.CanDragPoint=true;this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default")}}}processOrthoReferenceLine(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];var r=new ImagingStudyView.AnnotationPoint(o,l);if(t){a.Context.AnnotationController.SetFirstGroup();a.Context.AnnotationController.RegisterPoint(r)}else{a.Context.AnnotationController.RegisterPoint(r);if(a.CurrentAnnotation.DrawIsValid()){if(a.Context.AnnotationController.IsCompleted){a.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;a.Annotations.push(a.CurrentAnnotation);this.AnnotationDone(n);this.LayoutController.LayoutView.ControlButtonsTop();this.Controller.SelectDefaultTool()}}else a.Context.AnnotationController.ReversePointRegister();a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}}processOrthoAnnotationParallelLine(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];if(this.Controller.View.ReferencedAnnotationLayout!==null){a.CurrentAnnotation.ReferenceAnnotation=this.Controller.View.ReferencedAnnotationLayout}if(a.CurrentAnnotation.ReferenceAnnotation!==undefined){var r=new ImagingStudyView.AnnotationPoint(o,l);a.Context.AnnotationController.SetFirstGroup();a.Context.AnnotationController.RegisterPoint(r);if(a.CurrentAnnotation.DrawIsValid()){if(a.Context.AnnotationController.IsCompleted){a.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;a.Annotations.push(a.CurrentAnnotation);this.AnnotationDone(n);this.LayoutController.LayoutView.ControlButtonsTop();this.Controller.SelectDefaultTool()}}}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}processOrthoAnnotationPerpendicularLine(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];if(a.CurrentAnnotation.ReferenceAnnotation===undefined){var r=n.DetectAnnotation(o);if(r!==null){a.CurrentAnnotation.ReferenceAnnotation=r;r.annotation.Selected=true;a.Context.AnnotationController.SetFirstGroup()}}else{var s=new ImagingStudyView.AnnotationPoint(o,l);a.Context.AnnotationController.SetFirstGroup();a.Context.AnnotationController.RegisterPoint(s);if(a.CurrentAnnotation.DrawIsValid()){if(a.Context.AnnotationController.IsCompleted){a.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;a.Annotations.push(a.CurrentAnnotation);this.AnnotationDone(n);this.LayoutController.LayoutView.ControlButtonsTop();this.Controller.SelectDefaultTool()}}}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}processOrthoAngularLine(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];if(a.CurrentAnnotation.ReferenceAnnotation===undefined){var r=n.DetectAnnotation(o);if(r!==null){a.CurrentAnnotation.ReferenceAnnotation=r;r.annotation.Selected=true;a.Context.AnnotationController.SetFirstGroup()}}else{var s=new ImagingStudyView.AnnotationPoint(o,l);a.Context.AnnotationController.SetFirstGroup();a.Context.AnnotationController.RegisterPoint(s);if(a.CurrentAnnotation.DrawIsValid()){if(a.Context.AnnotationController.IsCompleted){a.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;a.Annotations.push(a.CurrentAnnotation);this.AnnotationDone(n);this.LayoutController.LayoutView.ControlButtonsTop();this.Controller.SelectDefaultTool()}}else{this.LayoutController.LayoutView.AngularStep2Instructions()}}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}processOrthoAnnotationCircle(t,e,n,o,l){var a=n.RendererPlugins[this.PluginName];if(a.CurrentAnnotation.ReferenceAnnotation===undefined){var r=n.DetectAnnotation(o);if(r!==null){a.CurrentAnnotation.ReferenceAnnotation=r;r.annotation.Selected=true;a.Context.AnnotationController.SetFirstGroup()}}else{var s=new ImagingStudyView.AnnotationPoint(o,l);a.Context.AnnotationController.SetFirstGroup();a.Context.AnnotationController.RegisterPoint(s);if(a.CurrentAnnotation.DrawIsValid()){if(a.Context.AnnotationController.IsCompleted){a.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.Complete;a.Annotations.push(a.CurrentAnnotation);this.AnnotationDone(n);this.LayoutController.LayoutView.ControlButtonsTop();this.Controller.SelectDefaultTool()}}else{this.LayoutController.LayoutView.CircleStep2Instructions()}}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}processOrthoAnnotationKneeImplant(t,e,n,o,l,a){var r=o.RendererPlugins[this.PluginName];var s=new ImagingStudyView.AnnotationPoint(l,a);var h;if(this.KneeImplantController.APviewport!==null&&this.KneeImplantController.APviewport!==undefined&&this.KneeImplantController.APviewport===o){h=this.KneeImplantController.APviewport.RendererPlugins[this.PluginName].Context.ImageEntity.IsCalibrated();if(!h){return}}if(this.KneeImplantController.MLviewport!==null&&this.KneeImplantController.MLviewport!==undefined&&this.KneeImplantController.MLviewport===o){h=this.KneeImplantController.MLviewport.RendererPlugins[this.PluginName].Context.ImageEntity.IsCalibrated();if(!h){return}}if(this.KneeImplantController.StatusDraw&&!r.Context.AnnotationController.IsCompleted)this.KneeImplantController.KneeAnnotation=r.CurrentAnnotation;if(t){this.KneeImplantController.KneeImplantView.RerenderImplantBySide(this.KneeImplantController.LegSide);this.KneeImplantController.KneeImplantView.BuildViewSide();if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.ML]){if(this.KneeImplantController.KneeAnnotation!==null&&this.KneeImplantController.KneeAnnotation!==undefined){this.KneeImplantController.KneeAnnotation.MLContext=this.KneeImplantController.MLviewport.Context;this.KneeImplantController.KneeAnnotation.MLImageGuid=this.KneeImplantController.MLviewport.Context.ImageEntity.ImageGUID}}if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP]){if(this.KneeImplantController.APviewport!==null&&this.KneeImplantController.APviewport!==undefined){switch(this.KneeImplantController.ActionKnee){case OrthoPlugin_1.EActionKnee.APFemoralWithComponent:this.KneeImplantController.StatusDraw=true;if(r.Context.AnnotationController!==null&&r.Context.AnnotationController!==undefined)r.Context.AnnotationController.SetCurrentGroup("AP_WidthFemoralComponent");break;case OrthoPlugin_1.EActionKnee.APFemoralResection:this.KneeImplantController.StatusDraw=true;if(r.Context.AnnotationController!==null&&r.Context.AnnotationController!==undefined)r.Context.AnnotationController.SetCurrentGroup("AP_FemoralResection");break;case OrthoPlugin_1.EActionKnee.APTibialWidthComponent:this.KneeImplantController.StatusDraw=true;if(r.Context.AnnotationController!==null&&r.Context.AnnotationController!==undefined)r.Context.AnnotationController.SetCurrentGroup("AP_WidthTibialComponent");break;case OrthoPlugin_1.EActionKnee.APTibialResection:this.KneeImplantController.StatusDraw=true;if(r.Context.AnnotationController!==null&&r.Context.AnnotationController!==undefined)r.Context.AnnotationController.SetCurrentGroup("AP_TibialResection");break}}}else if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.ML]){if(this.KneeImplantController.MLviewport!==null&&this.KneeImplantController.MLviewport!==undefined){switch(this.KneeImplantController.ActionKnee){case OrthoPlugin_1.EActionKnee.MLFemoralFitLine:this.KneeImplantController.StatusDraw=true;if(r.Context.AnnotationController!==null&&r.Context.AnnotationController!==undefined)r.Context.AnnotationController.SetCurrentGroup("ML_AnteriorFemoralCorticalLine");break;case OrthoPlugin_1.EActionKnee.MLTibialLongitudinalAxis:this.KneeImplantController.StatusDraw=true;if(r.Context.AnnotationController!==null&&r.Context.AnnotationController!==undefined)r.Context.AnnotationController.SetCurrentGroup("ML_TibialImplantDimension");break}}}if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP]&&(r.Context.AnnotationController.CurrentGroup&&r.Context.AnnotationController.CurrentGroup.GroupName===null)&&e===undefined)r.Context.AnnotationController.SetFirstGroup();if(this.KneeImplantController.StatusDraw)r.Context.AnnotationController.RegisterPoint(s)}else{this.KneeImplantController.KneeImplantView.RerenderImplantBySide(this.KneeImplantController.LegSide);this.KneeImplantController.KneeImplantView.BuildViewSide();var m=r.Context.AnnotationController.CurrentGroup;if(this.KneeImplantController.StatusDraw)r.Context.AnnotationController.RegisterPoint(s);if(r.CurrentAnnotation.DrawIsValid()){if(r.Context.AnnotationController.CurrentGroup!==null){if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP]){if(r.Context.AnnotationController.CurrentGroup.GroupName==="AP_FemoralResection"&&this.KneeImplantController.KneeAnnotation.Points["AP_FemoralResection"].length===1){this.KneeImplantController.ShowTextAndControl(2,this.KneeImplantController.KneeImplantView.OrthoElementsSection2,"FemoralResectionSection","TextAPFemoralResection","",false,"Enter the distal Medial femoral condyle most distal point.")}if(r.Context.AnnotationController.CurrentGroup&&r.Context.AnnotationController.CurrentGroup.GroupName==="AP_WidthFemoralComponent"&&r.Context.AnnotationController.GroupIsSatisfied(r.Context.AnnotationController.Template.Groups["AP_WidthFemoralComponent"])){this.KneeImplantController.ActionOkAPFemoralWithComponent((t=>{this.KneeImplantController.ShowMessageForAP_WidthFemoralComponent(this.KneeImplantController.Edition);this.KneeImplantController.ShowMessageForAP_GetDistalFemoralJointLineShaftAngle(this.KneeImplantController.Edition);r.Context.AnnotationController.CurrentGroup=null;this.KneeImplantController.KneeImplantView.IdDefault=OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP];this.KneeImplantController.KneeImplantView.ViewTab(t)}))}if(r.Context.AnnotationController.CurrentGroup&&r.Context.AnnotationController.CurrentGroup.GroupName==="AP_WidthTibialComponent"&&r.Context.AnnotationController.GroupIsSatisfied(r.Context.AnnotationController.Template.Groups["AP_WidthTibialComponent"])){this.KneeImplantController.ActionOkAPWithTibialComponent((t=>{this.KneeImplantController.ShowMessageForAP_WidthTibialComponent(this.KneeImplantController.Edition);this.KneeImplantController.ShowMessageForAP_GetDistalTibialJointLineShaftAngle(this.KneeImplantController.Edition);r.Context.AnnotationController.CurrentGroup=null;this.KneeImplantController.KneeImplantView.IdDefault=OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP];this.KneeImplantController.KneeImplantView.ViewTab(t)}))}}else if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.ML]){if(r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["ML_AnteriorFemoralCorticalLine"])&&r.Context.AnnotationController.CurrentGroup.GroupName==="ML_MostDistalCondylarPoint"){this.KneeImplantController.ShowTextAndControl(2,this.KneeImplantController.KneeImplantView.OrthoElementsSection2,"FemoralFitLineSection","TextFemoralFitLine","ML_MostDistalCondylarPoint",false)}if(r.Context.AnnotationController.GroupIsSatisfied(r.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"])){this.KneeImplantController.ShowMessageForML_TextMLFemoralDistance(this.KneeImplantController.Edition)}}}if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP]){if(m!==null&&m.GroupName==="AP_FemoralResection"&&r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["AP_FemoralResection"])){this.KneeImplantController.ActionOkAPFemoralResection((t=>{if(this.KneeImplantController.KneeAnnotation.Points["AP_WidthFemoralComponent"].length>=2){this.KneeImplantController.ShowMessageForAP_GetFemoralLateralResectionDepth(this.KneeImplantController.Edition);this.KneeImplantController.ShowMessageForAP_GetFemoralMedialResectionDepth(this.KneeImplantController.Edition)}this.KneeImplantController.KneeImplantView.IdDefault=OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP];this.KneeImplantController.KneeImplantView.ViewTab(t)}))}if(m!==null&&m.GroupName==="AP_TibialResection"&&r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["AP_TibialResection"])){this.KneeImplantController.ActionOkAPTibialResection((t=>{if(this.KneeImplantController.KneeAnnotation.Points["AP_WidthTibialComponent"]&&this.KneeImplantController.KneeAnnotation.Points["AP_WidthTibialComponent"].length>=2){this.KneeImplantController.ShowMessageForAP_GetTibialLateralResectionDepth(this.KneeImplantController.Edition);this.KneeImplantController.ShowMessageForAP_GetTibialMedialResectionDepth(this.KneeImplantController.Edition)}this.KneeImplantController.KneeImplantView.IdDefault=OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.AP];this.KneeImplantController.KneeImplantView.ViewTab(t)}))}try{if(r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["AP_WidthFemoralComponent"])&&r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["AP_FemoralResection"])&&r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["AP_WidthTibialComponent"])&&r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["AP_TibialResection"])){let t=WebClient.Form.GetFieldFromForms(this.KneeImplantController.KneeImplantView.DataSection1,"BtnImplantAP");t.htmlElement.click()}}catch(t){WebClient.Utils.DebugConsoleLog(t)}}else if(this.KneeImplantController.KneeImplantView.IdDefault===OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.ML]){if(m!==null&&m.GroupName==="ML_AnteriorFemoralCorticalLine"&&r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"])){this.KneeImplantController.ActionOKMLFemoralFitLine((t=>{this.KneeImplantController.KneeImplantView.IdDefault=OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.ML];this.KneeImplantController.KneeImplantView.ViewTab(t)}))}if(m!==null&&m.GroupName==="ML_MostDistalCondylarPoint"){if(r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"])){this.KneeImplantController.ShowMessageForML_TextMLFemoralDistance(this.KneeImplantController.Edition);this.KneeImplantController.StatusDraw=false;this.KneeImplantController.KneeImplantView.IdDefault=OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.ML];this.KneeImplantController.KneeImplantView.ViewTab(r.CurrentAnnotation)}}if(m!==null&&m.GroupName==="ML_TibialImplantDimension"){if(r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["ML_TibialImplantDimension"])){this.KneeImplantController.ActionOKMLTibialLongitudinalAxis((t=>{this.KneeImplantController.KneeImplantView.IdDefault=OrthoPlugin_1.ETemplateView[OrthoPlugin_1.ETemplateView.ML];this.KneeImplantController.KneeImplantView.ViewTab(t)}))}}try{if(r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["ML_AnteriorFemoralCorticalLine"])&&r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["ML_MostDistalCondylarPoint"])&&r.Context.AnnotationController.GroupIsComplete(r.Context.AnnotationController.Template.Groups["ML_TibialImplantDimension"])){let t=WebClient.Form.GetFieldFromForms(this.KneeImplantController.KneeImplantView.DataSection1,"BtnImplantML");t.htmlElement.click()}}catch(t){WebClient.Utils.DebugConsoleLog(t)}}}else{r.Context.AnnotationController.ReversePointRegister()}r.Context.Renderer.Render();r.Context.OverlayRenderer.Render();if(r.Context.AnnotationController.CurrentGroup===null){this.KneeImplantController.KneeAnnotation.CanDragPoint=true;this.Controller.SetCursorForViewports(this.Controller.ViewportPane,"default")}}var d=0;switch(r.Context.AnnotationController.CurrentGroup&&r.Context.AnnotationController.CurrentGroup.GroupName){case"AP_WidthFemoralComponent":d=r.Context.AnnotationController.Instance.Points["AP_WidthFemoralComponent"].length;if(d>=2)this.KneeImplantController.ShowTextAndControl(2,this.KneeImplantController.KneeImplantView.OrthoElementsSection2,"FemoralComponentSection","TextWidthFemoralComponent",null,this.KneeImplantController.Edition,"Measure the width of the distal femur by selecting points medially and laterally just above the joint line.");break;case"AP_WidthTibialComponent":d=r.Context.AnnotationController.Instance.Points["AP_WidthTibialComponent"].length;if(d>=2)this.KneeImplantController.ShowTextAndControl(2,this.KneeImplantController.KneeImplantView.OrthoElementsSection2,"WidtTibialComponentSection","TextAPWidthTibialComponent",null,this.KneeImplantController.Edition,"Select one point for the proximal tibial.");break;case"ML_AnteriorFemoralCorticalLine":d=r.Context.AnnotationController.Instance.Points["ML_AnteriorFemoralCorticalLine"].length;if(d===2)this.KneeImplantController.ShowTextAndControl(2,this.KneeImplantController.KneeImplantView.OrthoElementsSection2,"FemoralFitLineSection","TextFemoralFitLine",null,this.KneeImplantController.Edition,"Enter 1 point for posterior Condyle Tangent Point.")}this.KneeImplantController.WriteActionSummaryDataForEdition();this.KneeImplantController.KneeImplantView.ControlSkipButtonsForViews()}detectImplants(t,e,n,o=false){var l=n.PointInElement(n.Context.MouseDownX,n.Context.MouseDownY);let a=n.Context.ImageEntity["pixelSpacing"];if(a){let r={valueX:+a[0],valueY:+a[1],metric:a[2]};switch(t){case"OrthoAnnotationHipImplant":if(this.HipImplantController&&!this.HipImplantController.StatusDraw){let t=e.CurrentAnnotation?[e.CurrentAnnotation]:e.Annotations;t.forEach((t=>{if(t instanceof OrthoPlugin_1.HipImplantAnnotation){let e=false;let a=t;if(a.OrthoStemImplant.ImplantReadyForDraw){let t=a.OrthoStemImplant.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.OrthoStemImplant.UnSelectOtherImplants([a.OrthoAcetabularCupImplant]);if(a.OrthoStemImplant.Hover)a.OrthoStemImplant.Selected=false;if(o&&!a.OrthoStemImplant.Selected||!o)a.OrthoStemImplant.Selected=!a.OrthoStemImplant.Selected}else{if(!o)a.OrthoStemImplant.Selected=false}a.OrthoStemImplant.Hover=false}if(a.OrthoAcetabularCupImplant.ImplantReadyForDraw&&!e){let t=a.OrthoAcetabularCupImplant.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.OrthoStemImplant.UnSelectOtherImplants([a.OrthoStemImplant]);if(a.OrthoAcetabularCupImplant.Hover)a.OrthoAcetabularCupImplant.Selected=false;if(o&&!a.OrthoAcetabularCupImplant.Selected||!o)a.OrthoAcetabularCupImplant.Selected=!a.OrthoAcetabularCupImplant.Selected}else{if(!o)a.OrthoAcetabularCupImplant.Selected=false}a.OrthoStemImplant.Hover=false}}}))}break;case"OrthoAnnotationKneeImplant":if(this.KneeImplantController&&!this.KneeImplantController.StatusDraw){let t=e.CurrentAnnotation?[e.CurrentAnnotation]:e.Annotations;t.forEach((t=>{if(t instanceof OrthoPlugin_1.KneeImplantAnnotation){let e=false;let a=t;if(n===this.KneeImplantController.APviewport){e=false;if(a.APOrthoImplantFemoral.ImplantReadyForDraw){let t=a.APOrthoImplantFemoral.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.APOrthoImplantFemoral.UnSelectOtherImplants([a.APOrthoImplantTibial]);if(a.APOrthoImplantFemoral.Hover)a.APOrthoImplantFemoral.Selected=false;if(o&&!a.APOrthoImplantFemoral.Selected||!o)a.APOrthoImplantFemoral.Selected=!a.APOrthoImplantFemoral.Selected}else{if(!o)a.APOrthoImplantFemoral.Selected=false}a.APOrthoImplantFemoral.Hover=false}if(a.APOrthoImplantTibial.ImplantReadyForDraw&&!e){let t=a.APOrthoImplantTibial.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.APOrthoImplantTibial.UnSelectOtherImplants([a.APOrthoImplantFemoral]);if(a.APOrthoImplantTibial.Hover)a.APOrthoImplantTibial.Selected=false;if(o&&!a.APOrthoImplantTibial.Selected||!o)a.APOrthoImplantTibial.Selected=!a.APOrthoImplantTibial.Selected}else{if(!o)a.APOrthoImplantTibial.Selected=false}a.APOrthoImplantTibial.Hover=false}}else if(n===this.KneeImplantController.MLviewport){e=false;if(a.MLOrthoImplantFemoral.ImplantReadyForDraw){let t=a.MLOrthoImplantFemoral.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.MLOrthoImplantFemoral.UnSelectOtherImplants([a.MLOrthoImplantTibial]);if(a.MLOrthoImplantFemoral.Hover)a.MLOrthoImplantFemoral.Selected=false;if(o&&!a.MLOrthoImplantFemoral.Selected||!o)a.MLOrthoImplantFemoral.Selected=!a.MLOrthoImplantFemoral.Selected}else{if(!o)a.MLOrthoImplantFemoral.Selected=false}a.MLOrthoImplantFemoral.Hover=false}if(a.MLOrthoImplantTibial.ImplantReadyForDraw&&!e){let t=a.MLOrthoImplantTibial.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.MLOrthoImplantTibial.UnSelectOtherImplants([a.MLOrthoImplantFemoral]);if(a.MLOrthoImplantTibial.Hover)a.MLOrthoImplantTibial.Selected=false;if(o&&!a.MLOrthoImplantTibial.Selected||!o)a.MLOrthoImplantTibial.Selected=!a.MLOrthoImplantTibial.Selected}else{if(!o)a.MLOrthoImplantTibial.Selected=false}a.MLOrthoImplantTibial.Hover=false}}}}))}break;case"OrthoAnnotationShoulderImplant":if(this.ShoulderImplantController&&!this.ShoulderImplantController.StatusDraw){let t=e.CurrentAnnotation?[e.CurrentAnnotation]:e.Annotations;t.forEach((t=>{if(t instanceof OrthoPlugin_1.ShoulderImplantAnnotation){let e=false;let a=t;if(a.OrthoGlenosphereImplant.ImplantReadyForDraw){let t=a.OrthoGlenosphereImplant.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.OrthoGlenosphereImplant.UnSelectOtherImplants([a.OrthoGlenoidImplant,a.OrthoHumeralHeadImplant,a.OrthoStemImplant]);if(a.OrthoGlenosphereImplant.Hover)a.OrthoGlenosphereImplant.Selected=false;if(o&&!a.OrthoGlenosphereImplant.Selected||!o)a.OrthoGlenosphereImplant.Selected=!a.OrthoGlenosphereImplant.Selected}else{if(!o)a.OrthoGlenosphereImplant.Selected=false}a.OrthoGlenosphereImplant.Hover=false}if(a.OrthoGlenoidImplant.ImplantReadyForDraw&&!e){let t=a.OrthoGlenoidImplant.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.OrthoGlenosphereImplant.UnSelectOtherImplants([a.OrthoGlenosphereImplant,a.OrthoHumeralHeadImplant,a.OrthoStemImplant]);if(a.OrthoGlenoidImplant.Hover)a.OrthoGlenoidImplant.Selected=false;if(o&&!a.OrthoGlenoidImplant.Selected||!o)a.OrthoGlenoidImplant.Selected=!a.OrthoGlenoidImplant.Selected}else{if(!o)a.OrthoGlenoidImplant.Selected=false}a.OrthoGlenoidImplant.Hover=false}if(a.OrthoHumeralHeadImplant.ImplantReadyForDraw&&!e){let t=a.OrthoHumeralHeadImplant.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.OrthoGlenosphereImplant.UnSelectOtherImplants([a.OrthoGlenosphereImplant,a.OrthoGlenoidImplant,a.OrthoStemImplant]);if(a.OrthoHumeralHeadImplant.Hover)a.OrthoHumeralHeadImplant.Selected=false;if(o&&!a.OrthoHumeralHeadImplant.Selected||!o)a.OrthoHumeralHeadImplant.Selected=!a.OrthoHumeralHeadImplant.Selected}else{if(!o)a.OrthoHumeralHeadImplant.Selected=false}a.OrthoHumeralHeadImplant.Hover=false}if(a.OrthoStemImplant.ImplantReadyForDraw&&!e){let t=a.OrthoStemImplant.DetectImplant(r,n.Context.ScaleX,l);if(t){e=true;a.OrthoStemImplant.UnSelectOtherImplants([a.OrthoGlenosphereImplant,a.OrthoGlenoidImplant,a.OrthoHumeralHeadImplant]);if(a.OrthoStemImplant.Hover)a.OrthoStemImplant.Selected=false;if(o&&!a.OrthoStemImplant.Selected||!o)a.OrthoStemImplant.Selected=!a.OrthoStemImplant.Selected}else{if(!o)a.OrthoStemImplant.Selected=false}a.OrthoStemImplant.Hover=false}}}))}break}}}startDragImplants(t,e){let n=t.PointInElement(t.Context.MouseDownX,t.Context.MouseDownY);let o=e.CurrentAnnotation?[e.CurrentAnnotation]:e.Annotations;let l=t.Context.ImageEntity["pixelSpacing"];let a={valueX:+l[0],valueY:+l[1],metric:l[2]};o.forEach((e=>{if(e){if(e instanceof OrthoPlugin_1.HipImplantAnnotation){let o=e;if(o.OrthoStemImplant.ImplantReadyForDraw&&o.OrthoStemImplant.Selected){let e=o.OrthoStemImplant.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.OrthoStemImplant["rotateInitial"]=o.OrthoStemImplant.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.OrthoStemImplant.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}if(o.OrthoAcetabularCupImplant.ImplantReadyForDraw&&o.OrthoAcetabularCupImplant.Selected){let e=o.OrthoAcetabularCupImplant.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.OrthoAcetabularCupImplant["rotateInitial"]=o.OrthoAcetabularCupImplant.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.OrthoAcetabularCupImplant.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}}else if(e instanceof OrthoPlugin_1.KneeImplantAnnotation){let o=e;if(this.KneeImplantController&&t===this.KneeImplantController.APviewport){if(o.APOrthoImplantFemoral&&o.APOrthoImplantFemoral.Selected){let e=o.APOrthoImplantFemoral.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.APOrthoImplantFemoral["rotateInitial"]=o.APOrthoImplantFemoral.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.APOrthoImplantFemoral.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}if(o.APOrthoImplantTibial&&o.APOrthoImplantTibial.Selected){let e=o.APOrthoImplantTibial.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.APOrthoImplantTibial["rotateInitial"]=o.APOrthoImplantTibial.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.APOrthoImplantTibial.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}}else if(this.KneeImplantController&&t===this.KneeImplantController.MLviewport){if(o.MLOrthoImplantFemoral&&o.MLOrthoImplantFemoral.Selected){let e=o.MLOrthoImplantFemoral.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.MLOrthoImplantFemoral["rotateInitial"]=o.MLOrthoImplantFemoral.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.MLOrthoImplantFemoral.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}if(o.MLOrthoImplantTibial&&o.MLOrthoImplantTibial.Selected){let e=o.MLOrthoImplantTibial.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.MLOrthoImplantTibial["rotateInitial"]=o.MLOrthoImplantTibial.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.MLOrthoImplantTibial.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}}}else if(e instanceof OrthoPlugin_1.ShoulderImplantAnnotation){let o=e;if(o.OrthoGlenosphereImplant.ImplantReadyForDraw&&o.OrthoGlenosphereImplant.Selected){let e=o.OrthoGlenosphereImplant.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.OrthoGlenosphereImplant["rotateInitial"]=o.OrthoGlenosphereImplant.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.OrthoGlenosphereImplant.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}if(o.OrthoGlenoidImplant.ImplantReadyForDraw&&o.OrthoGlenoidImplant.Selected){let e=o.OrthoGlenoidImplant.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.OrthoGlenoidImplant["rotateInitial"]=o.OrthoGlenoidImplant.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.OrthoGlenoidImplant.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}if(o.OrthoHumeralHeadImplant.ImplantReadyForDraw&&o.OrthoHumeralHeadImplant.Selected){let e=o.OrthoHumeralHeadImplant.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.OrthoHumeralHeadImplant["rotateInitial"]=o.OrthoHumeralHeadImplant.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.OrthoHumeralHeadImplant.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}if(o.OrthoStemImplant.ImplantReadyForDraw&&o.OrthoStemImplant.Selected){let e=o.OrthoStemImplant.DetectPointRotate(a,t.Context.ScaleX,n);if(e){o.OrthoStemImplant["rotateInitial"]=o.OrthoStemImplant.Rotation;this.mouseRotateC=new WebClient.Point(n.X,n.Y);this.isDragControlRotateImplant=true}let l=o.OrthoStemImplant.DetectImplant(a,t.Context.ScaleX,n);if(l)this.isDragImplant=true;else this.isDragImplant=false}}}}))}moveImplants(t,e,n,o){let l;if(this.isDragImplant||this.isDragControlRotateImplant){let a;if(this.isDragControlRotateImplant){let o=t.Context.Viewport.PointInElement(e,n);this.mouseRotateB=new WebClient.Point(o.X,o.Y)}let r=t.CurrentAnnotation?[t.CurrentAnnotation]:t.Annotations;r.forEach((e=>{if(e){if(e instanceof OrthoPlugin_1.HipImplantAnnotation){let n=e;let o=t.Context.MouseDownX-t.Context.MouseMoveX;let r=t.Context.MouseDownY-t.Context.MouseMoveY;let s=Math.abs(o)>Math.abs(r)?o:r;if(n.OrthoStemImplant.ImplantReadyForDraw&&n.OrthoStemImplant.Selected){if(this.isDragControlRotateImplant){let t=n.OrthoStemImplant.PositionX+n.OrthoStemImplant.OffsetX-(n.OrthoStemImplant.GetViewBoxMin().X-n.OrthoStemImplant.GetOrigin().X);let e=n.OrthoStemImplant.PositionY+n.OrthoStemImplant.OffsetY-(n.OrthoStemImplant.GetViewBoxMin().Y-n.OrthoStemImplant.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.OrthoStemImplant.Rotation=a+n.OrthoStemImplant["rotateInitial"];n.OrthoStemImplant.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.OrthoStemImplant.PositionX=0;n.OrthoStemImplant.PositionY=0;n.OrthoStemImplant.OffsetX=l.X;n.OrthoStemImplant.OffsetY=l.Y;n.OrthoStemImplant.WasMoved=true}this.HipImplantController.HipImplantView.ChangeCISSAutomaticImplantsModeStatus(false);this.HipImplantController.ImplantInformation(e.OrthoStemImplant,OrthoPlugin_1.EHipImplant.Stem);this.HipImplantController.HipImplantView.UpdateUIAdjustImplant(e.OrthoStemImplant,OrthoPlugin_1.EHipImplant.Stem)}if(n.OrthoAcetabularCupImplant.ImplantReadyForDraw&&n.OrthoAcetabularCupImplant.Selected){if(this.isDragControlRotateImplant){let t=n.OrthoAcetabularCupImplant.PositionX+n.OrthoAcetabularCupImplant.OffsetX-(n.OrthoAcetabularCupImplant.GetViewBoxMin().X-n.OrthoAcetabularCupImplant.GetOrigin().X);let e=n.OrthoAcetabularCupImplant.PositionY+n.OrthoAcetabularCupImplant.OffsetY-(n.OrthoAcetabularCupImplant.GetViewBoxMin().Y-n.OrthoAcetabularCupImplant.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.OrthoAcetabularCupImplant.Rotation=a+n.OrthoAcetabularCupImplant["rotateInitial"];n.OrthoAcetabularCupImplant.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.OrthoAcetabularCupImplant.PositionX=0;n.OrthoAcetabularCupImplant.PositionY=0;n.OrthoAcetabularCupImplant.OffsetX=l.X;n.OrthoAcetabularCupImplant.OffsetY=l.Y;n.OrthoAcetabularCupImplant.WasMoved=true}this.HipImplantController.HipImplantView.ChangeCISSAutomaticImplantsModeStatus(false);this.HipImplantController.ImplantInformation(e.OrthoAcetabularCupImplant,OrthoPlugin_1.EHipImplant.Cup);this.HipImplantController.HipImplantView.UpdateUIAdjustImplant(e.OrthoAcetabularCupImplant,OrthoPlugin_1.EHipImplant.Cup)}}else if(e instanceof OrthoPlugin_1.KneeImplantAnnotation){let n=e;let r=t.Context.MouseDownX-t.Context.MouseMoveX;let s=t.Context.MouseDownY-t.Context.MouseMoveY;let h=Math.abs(r)>Math.abs(s)?r:s;if(o===this.KneeImplantController.APviewport){if(n.APOrthoImplantFemoral.ImplantReadyForDraw&&n.APOrthoImplantFemoral.Selected){if(this.isDragControlRotateImplant){let t=n.APOrthoImplantFemoral.PositionX+n.APOrthoImplantFemoral.OffsetX-(n.APOrthoImplantFemoral.GetViewBoxMin().X-n.APOrthoImplantFemoral.GetOrigin().X);let e=n.APOrthoImplantFemoral.PositionY+n.APOrthoImplantFemoral.OffsetY-(n.APOrthoImplantFemoral.GetViewBoxMin().Y-n.APOrthoImplantFemoral.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.APOrthoImplantFemoral.Rotation=a+n.APOrthoImplantFemoral["rotateInitial"];n.APOrthoImplantFemoral.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.APOrthoImplantFemoral.PositionX=0;n.APOrthoImplantFemoral.PositionY=0;n.APOrthoImplantFemoral.OffsetX=l.X;n.APOrthoImplantFemoral.OffsetY=l.Y;n.APOrthoImplantFemoral.WasMoved=true}if(this.KneeImplantController.ActionKnee!==OrthoPlugin_1.EActionKnee.APImplantAdjust){this.KneeImplantController.OpenUIInsertImplant((()=>{this.KneeImplantController.ActionAdjustAP();this.KneeImplantController.KneeImplantView.UpdateUIAdjustAPFemoralImplant(e.APOrthoImplantFemoral)}))}else{this.KneeImplantController.KneeImplantView.UpdateUIAdjustAPFemoralImplant(e.APOrthoImplantFemoral)}this.KneeImplantController.KneeImplantView.ChangeCISSAutomaticImplantsModeStatus(false)}if(n.APOrthoImplantTibial.ImplantReadyForDraw&&n.APOrthoImplantTibial.Selected){if(this.isDragControlRotateImplant){let t=n.APOrthoImplantTibial.PositionX+n.APOrthoImplantTibial.OffsetX-(n.APOrthoImplantTibial.GetViewBoxMin().X-n.APOrthoImplantTibial.GetOrigin().X);let e=n.APOrthoImplantTibial.PositionY+n.APOrthoImplantTibial.OffsetY-(n.APOrthoImplantTibial.GetViewBoxMin().Y-n.APOrthoImplantTibial.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.APOrthoImplantTibial.Rotation=a+n.APOrthoImplantTibial["rotateInitial"];n.APOrthoImplantTibial.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.APOrthoImplantTibial.PositionX=0;n.APOrthoImplantTibial.PositionY=0;n.APOrthoImplantTibial.OffsetX=l.X;n.APOrthoImplantTibial.OffsetY=l.Y;n.APOrthoImplantTibial.WasMoved=true}if(this.KneeImplantController.ActionKnee!==OrthoPlugin_1.EActionKnee.APImplantAdjust){this.KneeImplantController.OpenUIInsertImplant((()=>{this.KneeImplantController.ActionAdjustAP();this.KneeImplantController.KneeImplantView.UpdateUIAdjustAPTibialImplant(e.APOrthoImplantTibial)}))}else{this.KneeImplantController.KneeImplantView.UpdateUIAdjustAPTibialImplant(e.APOrthoImplantTibial)}this.KneeImplantController.KneeImplantView.ChangeCISSAutomaticImplantsModeStatus(false)}}else if(o===this.KneeImplantController.MLviewport){if(n.MLOrthoImplantFemoral.ImplantReadyForDraw&&n.MLOrthoImplantFemoral.Selected){if(this.isDragControlRotateImplant){let t=n.MLOrthoImplantFemoral.PositionX+n.MLOrthoImplantFemoral.OffsetX-(n.MLOrthoImplantFemoral.GetViewBoxMin().X-n.MLOrthoImplantFemoral.GetOrigin().X);let e=n.MLOrthoImplantFemoral.PositionY+n.MLOrthoImplantFemoral.OffsetY-(n.MLOrthoImplantFemoral.GetViewBoxMin().Y-n.MLOrthoImplantFemoral.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.MLOrthoImplantFemoral.Rotation=a+n.MLOrthoImplantFemoral["rotateInitial"];n.MLOrthoImplantFemoral.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.MLOrthoImplantFemoral.PositionX=0;n.MLOrthoImplantFemoral.PositionY=0;n.MLOrthoImplantFemoral.OffsetX=l.X;n.MLOrthoImplantFemoral.OffsetY=l.Y;n.MLOrthoImplantFemoral.WasMoved=true}if(this.KneeImplantController.ActionKnee!==OrthoPlugin_1.EActionKnee.MLImplantAdjust){this.KneeImplantController.OpenUIInsertImplant((()=>{this.KneeImplantController.ActionAdjustML();this.KneeImplantController.KneeImplantView.UpdateUIAdjustMLFemoralImplant(e.MLOrthoImplantFemoral)}))}else{this.KneeImplantController.KneeImplantView.UpdateUIAdjustMLFemoralImplant(e.MLOrthoImplantFemoral)}this.KneeImplantController.KneeImplantView.ChangeCISSAutomaticImplantsModeStatus(false)}if(n.MLOrthoImplantTibial.ImplantReadyForDraw&&n.MLOrthoImplantTibial.Selected){if(this.isDragControlRotateImplant){let t=n.MLOrthoImplantTibial.PositionX+n.MLOrthoImplantTibial.OffsetX-(n.MLOrthoImplantTibial.GetViewBoxMin().X-n.MLOrthoImplantTibial.GetOrigin().X);let e=n.MLOrthoImplantTibial.PositionY+n.MLOrthoImplantTibial.OffsetY-(n.MLOrthoImplantTibial.GetViewBoxMin().Y-n.MLOrthoImplantTibial.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.MLOrthoImplantTibial.Rotation=a+n.MLOrthoImplantTibial["rotateInitial"];n.MLOrthoImplantTibial.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.MLOrthoImplantTibial.PositionX=0;n.MLOrthoImplantTibial.PositionY=0;n.MLOrthoImplantTibial.OffsetX=l.X;n.MLOrthoImplantTibial.OffsetY=l.Y;n.MLOrthoImplantTibial.WasMoved=true}if(this.KneeImplantController.ActionKnee!==OrthoPlugin_1.EActionKnee.MLImplantAdjust){this.KneeImplantController.OpenUIInsertImplant((()=>{this.KneeImplantController.ActionAdjustML();this.KneeImplantController.KneeImplantView.UpdateUIAdjustMLTibialImplant(e.MLOrthoImplantTibial)}))}else{this.KneeImplantController.KneeImplantView.UpdateUIAdjustMLTibialImplant(e.MLOrthoImplantTibial)}this.KneeImplantController.KneeImplantView.ChangeCISSAutomaticImplantsModeStatus(false)}}}else if(e instanceof OrthoPlugin_1.ShoulderImplantAnnotation){let n=e;let o=t.Context.MouseDownX-t.Context.MouseMoveX;let r=t.Context.MouseDownY-t.Context.MouseMoveY;let s=Math.abs(o)>Math.abs(r)?o:r;if(n.OrthoGlenosphereImplant.ImplantReadyForDraw&&n.OrthoGlenosphereImplant.Selected){if(this.isDragControlRotateImplant){let t=n.OrthoGlenosphereImplant.PositionX+n.OrthoGlenosphereImplant.OffsetX-(n.OrthoGlenosphereImplant.GetViewBoxMin().X-n.OrthoGlenosphereImplant.GetOrigin().X);let e=n.OrthoGlenosphereImplant.PositionY+n.OrthoGlenosphereImplant.OffsetY-(n.OrthoGlenosphereImplant.GetViewBoxMin().Y-n.OrthoGlenosphereImplant.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.OrthoGlenosphereImplant.Rotation=a+n.OrthoGlenosphereImplant["rotateInitial"];n.OrthoGlenosphereImplant.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.OrthoGlenosphereImplant.PositionX=0;n.OrthoGlenosphereImplant.PositionY=0;n.OrthoGlenosphereImplant.OffsetX=l.X;n.OrthoGlenosphereImplant.OffsetY=l.Y}this.ShoulderImplantController.ImplantInformation(e.OrthoGlenosphereImplant,OrthoPlugin_1.EShoulderImplant.Glenosphere);this.ShoulderImplantController.ShoulderImplantView.UpdateUIAdjustImplant(e.OrthoGlenosphereImplant,OrthoPlugin_1.EShoulderImplant.Glenosphere)}if(n.OrthoGlenoidImplant.ImplantReadyForDraw&&n.OrthoGlenoidImplant.Selected){if(this.isDragControlRotateImplant){let t=n.OrthoGlenoidImplant.PositionX+n.OrthoGlenoidImplant.OffsetX-(n.OrthoGlenoidImplant.GetViewBoxMin().X-n.OrthoGlenoidImplant.GetOrigin().X);let e=n.OrthoGlenoidImplant.PositionY+n.OrthoGlenoidImplant.OffsetY-(n.OrthoGlenoidImplant.GetViewBoxMin().Y-n.OrthoGlenoidImplant.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.OrthoGlenoidImplant.Rotation=a+n.OrthoGlenoidImplant["rotateInitial"];n.OrthoGlenoidImplant.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.OrthoGlenoidImplant.PositionX=0;n.OrthoGlenoidImplant.PositionY=0;n.OrthoGlenoidImplant.OffsetX=l.X;n.OrthoGlenoidImplant.OffsetY=l.Y}this.ShoulderImplantController.ImplantInformation(e.OrthoGlenoidImplant,OrthoPlugin_1.EShoulderImplant.Glenoid);this.ShoulderImplantController.ShoulderImplantView.UpdateUIAdjustImplant(e.OrthoGlenoidImplant,OrthoPlugin_1.EShoulderImplant.Glenoid)}if(n.OrthoHumeralHeadImplant.ImplantReadyForDraw&&n.OrthoHumeralHeadImplant.Selected){if(this.isDragControlRotateImplant){let t=n.OrthoHumeralHeadImplant.PositionX+n.OrthoHumeralHeadImplant.OffsetX-(n.OrthoHumeralHeadImplant.GetViewBoxMin().X-n.OrthoHumeralHeadImplant.GetOrigin().X);let e=n.OrthoHumeralHeadImplant.PositionY+n.OrthoHumeralHeadImplant.OffsetY-(n.OrthoHumeralHeadImplant.GetViewBoxMin().Y-n.OrthoHumeralHeadImplant.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.OrthoHumeralHeadImplant.Rotation=a+n.OrthoHumeralHeadImplant["rotateInitial"];n.OrthoHumeralHeadImplant.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.OrthoHumeralHeadImplant.PositionX=0;n.OrthoHumeralHeadImplant.PositionY=0;n.OrthoHumeralHeadImplant.OffsetX=l.X;n.OrthoHumeralHeadImplant.OffsetY=l.Y}this.ShoulderImplantController.ImplantInformation(e.OrthoHumeralHeadImplant,OrthoPlugin_1.EShoulderImplant.Humeral_Head);this.ShoulderImplantController.ShoulderImplantView.UpdateUIAdjustImplant(e.OrthoHumeralHeadImplant,OrthoPlugin_1.EShoulderImplant.Humeral_Head)}if(n.OrthoStemImplant.ImplantReadyForDraw&&n.OrthoStemImplant.Selected){if(this.isDragControlRotateImplant){let t=n.OrthoStemImplant.PositionX+n.OrthoStemImplant.OffsetX-(n.OrthoStemImplant.GetViewBoxMin().X-n.OrthoStemImplant.GetOrigin().X);let e=n.OrthoStemImplant.PositionY+n.OrthoStemImplant.OffsetY-(n.OrthoStemImplant.GetViewBoxMin().Y-n.OrthoStemImplant.GetOrigin().Y);a=ImagingStudyView.Geometry.calculateRotationAngle(t,e,this.mouseRotateC.X,this.mouseRotateC.Y,this.mouseRotateB.X,this.mouseRotateB.Y);n.OrthoStemImplant.Rotation=a+n.OrthoStemImplant["rotateInitial"];n.OrthoStemImplant.WasRotated=true}else if(this.isDragImplant){l=t.Context.Viewport.PointInElement(t.Context.MouseMoveX,t.Context.MouseMoveY);n.OrthoStemImplant.PositionX=0;n.OrthoStemImplant.PositionY=0;n.OrthoStemImplant.OffsetX=l.X;n.OrthoStemImplant.OffsetY=l.Y}this.ShoulderImplantController.ImplantInformation(e.OrthoStemImplant,OrthoPlugin_1.EShoulderImplant.Stem);this.ShoulderImplantController.ShoulderImplantView.UpdateUIAdjustImplant(e.OrthoStemImplant,OrthoPlugin_1.EShoulderImplant.Stem)}}}}));t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}else{let e=t.CurrentAnnotation?[t.CurrentAnnotation]:t.Annotations;e.forEach((t=>{for(const e in t){if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];if(n instanceof OrthoPlugin_1.OrthoTemplate){if(n.ImplantReadyForDraw){n.Hover=false}}}}}));let n=this.GetImplantDetected(t.Context.Viewport,o.Context.MouseMoveX,o.Context.MouseMoveY);if(n){if(!n.template.Selected){n.template.Hover=true}}}}processAnnotations(tool,evObject,positionInCanvas,eventName,viewport){var orthoCtx=viewport.RendererPlugins[this.PluginName];var newPoint=new ImagingStudyView.AnnotationPoint(positionInCanvas,eventName);var allOk=this.preProcessAnnotations(tool,viewport);if(!allOk)return;if(orthoCtx.CurrentAnnotation===null||orthoCtx.CurrentAnnotation===undefined){var subTypeAnnotationName=tool.substr(15);if(subTypeAnnotationName==="CalibrationAuto")orthoCtx.CurrentAnnotation=eval("new Vue.Products.OrthoPlugin."+"Calibration"+"Annotation()");else orthoCtx.CurrentAnnotation=eval("new Vue.Products.OrthoPlugin."+subTypeAnnotationName+"Annotation()");orthoCtx.CurrentAnnotation.Context=viewport.Context;orthoCtx.CurrentAnnotation.Id=WebClient.Utils.GetGuid();orthoCtx.CurrentAnnotation.Selected=false;orthoCtx.CurrentAnnotation.Status=ImagingStudyView.EAnnotationStatus.New;orthoCtx.CurrentAnnotation.Author=sessionStorage["userEmail"];orthoCtx.CurrentAnnotation.Date=new Date;orthoCtx.CurrentAnnotation.Plugin=this.PluginName;orthoCtx.CurrentAnnotation["new"]=true;var currentGroupAnnotation;if(orthoCtx.Context.AnnotationController!==null&&orthoCtx.Context.AnnotationController!==undefined){currentGroupAnnotation=orthoCtx.Context.AnnotationController.CurrentGroup;if(orthoCtx.Context.AnnotationController.Instance instanceof OrthoPlugin_1.KneeImplantAnnotation){orthoCtx.CurrentAnnotation["APContext"]=orthoCtx.Context.AnnotationController.Instance["APContext"];orthoCtx.CurrentAnnotation["APImageGuid"]=orthoCtx.Context.AnnotationController.Instance["APImageGuid"];orthoCtx.CurrentAnnotation["MLContext"]=orthoCtx.Context.AnnotationController.Instance["MLContext"];orthoCtx.CurrentAnnotation["MLImageGuid"]=orthoCtx.Context.AnnotationController.Instance["MLImageGuid"]}else if(orthoCtx.Context.AnnotationController.Instance instanceof OrthoPlugin_1.AlignmentToolAnnotation){orthoCtx.CurrentAnnotation["Leg"]=orthoCtx.Context.AnnotationController.Instance["Leg"];orthoCtx.CurrentAnnotation["AnnotationIDBilateral"]=orthoCtx.Context.AnnotationController.Instance["AnnotationIDBilateral"]}}else{if(tool==="OrthoAnnotationKneeImplant"){if(this.KneeImplantController!==null&&this.KneeImplantController!==undefined){orthoCtx.CurrentAnnotation["APContext"]=this.KneeImplantController.KneeAnnotation["APContext"];orthoCtx.CurrentAnnotation["APImageGuid"]=this.KneeImplantController.KneeAnnotation["APImageGuid"];orthoCtx.CurrentAnnotation["MLContext"]=this.KneeImplantController.KneeAnnotation["MLContext"];orthoCtx.CurrentAnnotation["MLImageGuid"]=this.KneeImplantController.KneeAnnotation["MLImageGuid"]}}}orthoCtx.Context.AnnotationController=new ImagingStudyView.AnnotationController(orthoCtx.CurrentAnnotation);if(currentGroupAnnotation!==undefined)orthoCtx.Context.AnnotationController.CurrentGroup=currentGroupAnnotation;switch(tool){case"OrthoAnnotationSpine":this.processOrthoAnnotationSpine(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCalibrationAuto":this.processOrthoAnnotationAutoCalibration(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCalibrationLinear":this.processOrthoAnnotationCalibrationLinear(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCalibration":this.processOrthoAnnotationCalibration(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCobbAngle":this.processOrthoAnnotationCobbAngle(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationHipImplant":this.processOrthoAnnotationHipImplant(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationKneeImplant":this.processOrthoAnnotationKneeImplant(true,currentGroupAnnotation,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationReferenceLine":this.processOrthoReferenceLine(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationParallelLine":this.processOrthoAnnotationParallelLine(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationPerpendicularLine":this.processOrthoAnnotationPerpendicularLine(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationAngularLine":this.processOrthoAngularLine(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCircle":this.processOrthoAnnotationCircle(true,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationAlignmentTool":this.processOrthoAnnotationAlignmentTool(true,tool,viewport,positionInCanvas,eventName);break}orthoCtx.Context.Renderer.Render();orthoCtx.Context.OverlayRenderer.Render()}else{switch(tool){case"OrthoAnnotationCobbAngle":this.processOrthoAnnotationCobbAngle(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationHipImplant":this.processOrthoAnnotationHipImplant(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationKneeImplant":this.processOrthoAnnotationKneeImplant(false,null,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCalibrationAuto":this.processOrthoAnnotationAutoCalibration(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCalibrationLinear":this.processOrthoAnnotationCalibrationLinear(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCalibration":this.processOrthoAnnotationCalibration(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationReferenceLine":this.processOrthoReferenceLine(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationParallelLine":this.processOrthoAnnotationParallelLine(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationPerpendicularLine":this.processOrthoAnnotationPerpendicularLine(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationAngularLine":this.processOrthoAngularLine(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationCircle":this.processOrthoAnnotationCircle(false,tool,viewport,positionInCanvas,eventName);break;case"OrthoAnnotationAlignmentTool":this.processOrthoAnnotationAlignmentTool(false,tool,viewport,positionInCanvas,eventName);break}}}static GetHipImplatControllerInstance(){return OrthoPlugin.HipImplantControlerStaticInstance}static GetKneeImplantControlerInstance(){return OrthoPlugin.KneeImplantControlerStaticInstance}static RenderViewCiss(t,e,n,o,l){var a=false;try{var r=t.ViewportElement.getContext("2d");var s=parseInt(t.Context.ImageEntity["dicomTags"]["0028_0011"])/2;var h={right:{x:s-ImagingStudyView.Geometry.GetAdjustDistance(60,t.Context),y:0},left:{x:-(s-ImagingStudyView.Geometry.GetAdjustDistance(20,t.Context)),y:0}};r.save();a=true;r.translate(0,0);r.font=l+"pt Segoe UI, Arial, Tahoma, Verdana, sans-serif";r.fillStyle=WebClient.Colors.Clouds;r.shadowColor=WebClient.Colors.FullBlack;r.shadowOffsetX=1;r.shadowOffsetY=1;r.textAlign="left";r.textBaseline="top";var m;if(o){m=e===EViewCiss.AP?["R","L"]:["L","R"]}else{switch(e){case EViewCiss.AP:m=n?["M","L"]:["L","M"];break;case EViewCiss.PA:m=n?["L","M"]:["M","L"];break;case EViewCiss.ML:m=n?["P","A"]:["A","P"];break;case EViewCiss.LM:m=n?["A","P"]:["P","A"];break}}m.forEach(((t,e)=>{if(e===0)r.fillText(t,h.left.x,h.left.y);else r.fillText(t,h.right.x,h.right.y)}));r.restore()}catch(t){if(a)r.restore();WebClient.Utils.DebugConsoleLog(t)}}}OrthoPlugin_1.OrthoPlugin=OrthoPlugin})(OrthoPlugin=Products.OrthoPlugin||(Products.OrthoPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(e){var n;(function(e){var n=Efferent.Frontend.WebClient;var o=Efferent.Frontend.WebClient.HttpUtils;var l=Efferent.ClientViews.ImagingStudyView;var a=Efferent.ClientViews.ImplantTemplateView;let r;(function(t){t[t["Left"]=0]="Left";t[t["Right"]=1]="Right"})(r=e.EBodySide||(e.EBodySide={}));class OrthoTemplate{constructor(t,e){this.svgPoints={};this.Landmarks={};this.LandmarkItems=new Array;this.Annotation=t;this.AFemoralHeadOffset=0;this.ImplantReadyForDraw=false;this.PositionX=0;this.PositionY=0;this.Rotation=0;this.WasRotated=false;this.WasMoved=false;this.originX=0;this.originY=0;this.OffsetX=0;this.OffsetY=0;this.ImplantSvgUrl=null;this.implantImage=null;this.ComponentName=e;this.isWaitingImplant=false;this.Selected=false;this.Hover=false;this.ScaleX=1;this.ScaleY=1;this.iconRotateImages=this.createSvgImage();if(!this.LandmarksTemplate){this.LandmarksTemplate=new Array;a.LandmarksManager.GetTemplateLandmarks((t=>{this.LandmarksTemplate=t}))}}RenderImplant(t,e,o,a,r,s){if(this.implantImage!==null&&this.implantImage!==undefined){this.PositionX=parseFloat(this.PositionX.toString());this.PositionY=parseFloat(this.PositionY.toString());var h=this.Rotation/(180/Math.PI);var m=t.ImageEntity["pixelSpacing"];if(r){var d=1/m[0]*r}else{var d=1/m[0]*o}var u=1/m[1];e.save();e.translate(this.PositionX+this.OffsetX,this.PositionY+this.OffsetY);let g=0;if(s&&o===-1){g=-(3*Math.PI/180)}else if(s&&o===1){g=3*Math.PI/180}if(a!=null){this.IsRotateImplant=true;this.RotateGredeesImplant=h+a+g;e.rotate(this.RotateGredeesImplant)}else{this.IsRotateImplant=false;this.RotateGredeesImplant=h+g;e.rotate(this.RotateGredeesImplant)}this.ScaleX=d;this.ScaleY=u;e.scale(d,u);e.drawImage(this.implantImage,this.minXViewBox-this.originX,this.minYViewBox-this.originY,this.widthViewBox,this.heightViewBox);if(this.Selected){e.save();e.lineWidth=.3;e.strokeStyle=this.Hover?n.Colors.Alizarin:n.Colors.FullWhite;e.strokeRect(this.minXViewBox-this.originX,this.minYViewBox-this.originY,this.widthViewBox,this.heightViewBox);e.restore();e.save();const t=this.minXViewBox-this.originX;const o=this.minYViewBox-this.originY;e.drawImage(this.iconRotateImages[0],t,o,15,15);e.drawImage(this.iconRotateImages[1],t+this.widthViewBox-15,o,15,15);e.drawImage(this.iconRotateImages[3],t,o+this.heightViewBox-15,15,15);e.drawImage(this.iconRotateImages[2],t+this.widthViewBox-15,o+this.heightViewBox-15,15,15);e.restore()}else if(this.Hover){e.save();e.lineWidth=.3;e.strokeStyle=this.Hover?n.Colors.Alizarin:n.Colors.FullWhite;e.strokeRect(this.minXViewBox-this.originX,this.minYViewBox-this.originY,this.widthViewBox,this.heightViewBox);e.restore()}if(Object.keys(this.Landmarks).length>0){for(const t in this.Landmarks){if(this.Landmarks.hasOwnProperty(t)&&t!=="ORIGIN"){const o=this.Landmarks[t];e.save();e.scale(1,1);e.beginPath();e.lineWidth=1;e.arc(o.X,o.Y,1.5,0,2*Math.PI,false);e.fillStyle=n.Colors.BelizeHole;e.fill();e.closePath();e.restore()}}}var p=this.Landmarks["HEAD_ROTATION+0"];var c=new n.Point(0,0);var A;if(p&&c&&this.AFemoralHeadDiameter){p.X=Math.abs(parseFloat(p.X.toString()));p.Y=parseFloat(p.Y.toString());c.X=parseFloat(c.X.toString());c.Y=parseFloat(c.Y.toString());if(this.AFemoralHeadOffset===0){A=p}else{var C=new l.Vector2D(new l.AnnotationPoint(c),new l.AnnotationPoint(p));var S=C.Normalize();A=S.ScalarMult(this.AFemoralHeadOffset).AddVectorToPoint(p);A.X=parseFloat(A.X.toFixed(4));A.Y=parseFloat(A.Y.toFixed(4))}if(this.AFemoralHeadDiameter>0){e.save();e.beginPath();e.lineWidth=.8;e.arc(A.X,A.Y,this.AFemoralHeadDiameter/2,0,Math.PI/180*360,true);e.setLineDash([2.25,1.25]);e.strokeStyle=n.Colors.PeterRiver;e.stroke();e.restore()}}e.restore();e.save();e.beginPath();e.lineWidth=1;e.arc(this.PositionX+this.OffsetX,this.PositionY+this.OffsetY,Math.abs(2*d),0,2*Math.PI,false);e.fillStyle="yellow";e.fill();e.closePath();e.restore()}}isValidLandmark(t){return this.Landmarks[t]?true:false}GetImplantImage(){return this.implantImage}SetImplantImage(t){this.implantImage=t}LoadImplantFromSVG(t,e,l){if(this.ImplantSvgUrl){this.ImplantSvgUrl=o.UpdateUrlToCurrentHost(this.ImplantSvgUrl);if(e){let o=new DOMParser;let a=o.parseFromString(n.Utils.DecodeBase64(e),"text/xml");this.resetLandmarks();this.xml=a;this.readMetadataSvg((e=>{if(e)this.loadImplant(t)}),l)}else{if(!this.isWaitingImplant){document.body.style.cursor="wait";o.AjaxCall(this.ImplantSvgUrl,"GET","min",null,((e,n)=>{this.xml=n;this.readMetadataSvg((e=>{if(e)this.loadImplant(t);this.isWaitingImplant=false}),l)}),(t=>{this.isWaitingImplant=false;document.body.style.cursor="default"}),"document");this.isWaitingImplant=true}}}}DetectPointRotate(t,e,n){let o=false;let l=(this.minXViewBox-this.originX)*Math.abs(this.ScaleX);let a=(this.minYViewBox-this.originY)*Math.abs(this.ScaleY);let r=(this.minXViewBox-this.originX+this.widthViewBox)*Math.abs(this.ScaleX);let s=(this.minYViewBox-this.originY+this.heightViewBox)*Math.abs(this.ScaleY);let h=this.getPointInTemplate(n);var m=h.X>=l;var d=h.X<=r;var u=h.Y>=a;var p=h.Y<=s;o=m&&d&&(u&&p);if(o){let l=this.DetectImplant(t,e,n);if(l)o=false}return o}GetCentroidImplant(){let t=new n.Point(0,0);let e=this.PositionX+this.OffsetX;let o=this.PositionY+this.OffsetY;t.X=e;t.Y=o;return t}GetOriginPoint(){return new n.Point(this.originX,this.originY)}DetectImplant(t,e,n){let o=false;let l=20*t.valueX;l=l<=5?25:l;let a=n;let r=this.PositionX+this.OffsetX;let s=this.PositionY+this.OffsetY;o=this.getDiffWithThreshold(r,s,a.X,a.Y,l);return o}UnSelectOtherImplants(t){t.forEach((t=>{t.Selected=false}))}UnHoverOtherImplants(t){t.forEach((t=>{t.Hover=false}))}GetViewBoxMin(){return new n.Point(this.minXViewBox,this.minYViewBox)}GetOrigin(){return new n.Point(this.originX,this.originY)}getDiffWithThreshold(t,e,n,o,l){var a=l/Math.abs(this.ScaleX);var r=Math.abs(this.ScaleX*this.ScaleX);var s=Math.round(11/r*10)/10;var h=t-a;var m=t+a;var d=e-s;var u=e;if(n>=h&&n<=m&&o>=d&&o<=u)return true;var p=a;var c=p;var A=Math.atan2((o-e)*Math.abs(p/c),n-t);var C=t+Math.cos(A)*Math.abs(p);var S=e+Math.sin(A)*Math.abs(c);var g=n-C;var I=o-S;var P=Math.sqrt(g*g+I*I);if(P<l)return true;return false}getPointInTemplate(t){let e=new n.Point(t.X,t.Y);e.X-=this.OffsetX+this.PositionX;e.Y-=this.OffsetY+this.PositionY;if(this.Rotation!==0||this.IsRotateImplant){let t=this.RotateGredeesImplant;let n=e.X*Math.cos(-t)-e.Y*Math.sin(-t);let o=e.X*Math.sin(-t)+e.Y*Math.cos(-t);e.X=n;e.Y=o}return e}loadImplant(t){try{this.ImplantReadyForDraw=false;var e=this.xml.getElementsByTagName("svg")[0].getElementById("contour");if(e)e.setAttribute("stroke",n.Colors.SunFlower);var o=this.xml.getElementsByTagName("svg")[0].getElementById("reference");if(o)o.setAttribute("display","none");this.SvgXmlString=(new XMLSerializer).serializeToString(this.xml);var l="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(this.SvgXmlString);this.implantImage=new Image;this.implantImage.onload=()=>{this.ImplantReadyForDraw=true;t();document.body.style.cursor="default"};this.implantImage.src=l}catch(t){console.info(t);n.Toaster.ShowToast("svg implant not available.",n.Colors.Orange,3)}}parserLandmarks(t,e){var o;this.resetLandmarks();this.LandmarkItems=t;var l=t.some((t=>t.LandmarkName==="ORIGIN"));if(l){t.forEach((t=>{var e=t.LandmarkName;this.Landmarks[e]=new n.Point(parseFloat(t.X),parseFloat(t.Y));switch(e){case"ORIGIN":this.originX=parseFloat(t.X);this.originY=parseFloat(t.Y);this.OriginStem=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"HEAD_ROTATION+0":this.FemRotHeadStem=new n.Point(parseFloat(t.X),parseFloat(t.Y));case"RESECTION_LINE_1":this.PointResection1=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"RESECTION_LINE_2":this.PointResection2=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"STEM_SHOULDER":this.TemporalStemShoulderPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"STEM_DISTAL_END_POINT":this.TemporalStemDistalEndPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"CUP_CAUDAL_RIM_REF":this.CaudalRefPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"CUP_CRANIAL_RIM_REF":this.CranialRefPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"TIBIAL_BASEPLATE_TO_INSERT":this.TibialBptoInsertPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"TIBIAL_BASEPLATE_TO_STEM":this.TibialBptoStemPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"FEMORAL_COMP_TO_TIBIAL_INSERT":this.FemoralCotoInsertPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"FEMORAL_COMP_TO_STEM":this.FemoralCotoStemPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"PROXIMAL_REF_POINT":this.ProximalRefPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"LATERAL_REF":this.lateralPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"MEDIAL_REF":this.medialPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"ANTERIOR_REF":this.anteriorPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"POSTERIOR_REF":this.posteriorPoint=new n.Point(parseFloat(t.X),parseFloat(t.Y));break;case"STEM_TO_HUMERAL_ART_COMP":this.StemtoHumeralComp=new n.Point(parseFloat(t.X),parseFloat(t.Y));break}}));var a=this.xml.getElementsByTagName("svg")[0].getAttribute("viewBox").split(" ");this.minXViewBox=parseFloat(a[0]);this.minYViewBox=parseFloat(a[1]);this.widthViewBox=parseFloat(a[2]);this.heightViewBox=parseFloat(a[3]);o=true;e(o)}else{n.Toaster.ShowToast("The implant template has missing data",n.Colors.Orange,3);o=false;e(o)}}readMetadataSvg(t,e){var o;try{var l=this.ImplantSvgUrl.split("/").reverse();var a=l[0];var r=l[4];var s=l[2];if(this.LandmarkItems.length===0){if(e){this.parserLandmarks(e,t)}else{Efferent.ClientViews.ImplantTemplateView.LandmarksManager.GetLandmarks(r,s,a,(e=>{this.parserLandmarks(e,t)}))}}}catch(e){o=false;n.Toaster.ShowToast("Error parsing svg implant",n.Colors.Orange,3);t(o)}}resetLandmarks(){this.Landmarks={};this.LandmarkItems=new Array;this.originX=0;this.originY=0;this.OriginStem=undefined;this.FemRotHeadStem=undefined;this.PointResection1=undefined;this.PointResection2=undefined;this.TemporalStemShoulderPoint=undefined;this.TemporalStemDistalEndPoint=undefined;this.CaudalRefPoint=undefined;this.CranialRefPoint=undefined;this.TibialBptoInsertPoint=undefined;this.TibialBptoStemPoint=undefined;this.FemoralCotoInsertPoint=undefined;this.FemoralCotoStemPoint=undefined;this.ProximalRefPoint=undefined}createSvgImage(){const e=[t.Products.OrthoPlugin.ResourceBag.IconRotateArrow1Svg,t.Products.OrthoPlugin.ResourceBag.IconRotateArrow2Svg,t.Products.OrthoPlugin.ResourceBag.IconRotateArrow3Svg,t.Products.OrthoPlugin.ResourceBag.IconRotateArrow4Svg];return e.map((t=>{const e=document.createElement("div");e.innerHTML=t;const n=e.firstElementChild;const o=document.createElement("img");const l=(new XMLSerializer).serializeToString(n);const a=window.btoa(l);const r="data:image/svg+xml;base64,";const s=r+a;o.src=s;return o}))}}e.OrthoTemplate=OrthoTemplate})(n=e.OrthoPlugin||(e.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient.DOMUtils;const{div:n,h3:o,button:l}=e;class OrthoToolWindow{constructor(t,e){this.MainSection=n({className:"configPane"});this.LeftTopSection=n({className:"leftTopSection"});this.RightTopSection=n({className:"rightTopSection"});this.SelectSideMessage=o({innerText:"Please, select a side.",style:{display:t?"none":"block"}});const a=typeof t==="boolean"?t?"auto":"0px":"";const r=t?"unset":"hidden";let s=l({type:"button",innerHTML:"Cancel",className:"red",style:{width:"80px",height:"30px",display:t?"none":"block"},onclick:t=>{e()}});this.CloseFirstDialogContainer=n({className:"buttonsTemporalContainer",style:{margin:"0 auto"},children:[s]});this.OuterContainer=n({style:{height:a,overflow:r},children:[this.ButtonsElementsContainer=n({style:{height:"90px"}}),this.TabsContainer=n({className:"tabsContainer"}),this.ActionsSummaryContainer=n({className:"summaryContainer"}),this.ActionsWindowContainer=n({className:"actionsWindowMainContainer"})]})}InitComponents(){this.MainSection.innerHTML="";this.LeftTopSection.innerHTML="";this.RightTopSection.innerHTML="";this.ButtonsElementsContainer.innerHTML="";this.TabsContainer.innerHTML="";this.ActionsSummaryContainer.innerHTML="";this.ActionsWindowContainer.innerHTML=""}}t.OrthoToolWindow=OrthoToolWindow})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;t.HIPCONSTANTS={Radius:5,ShaftAngle:130,AbductionAngle:45,DashLine:10,SolidLine:0,FactorScale:1,FactorExtension:.3,FactorHeight:.25,AxisSize:.5,SizeText:11,OffsetLabel:15};t.KNEECONSTANTS={Radius:5,RadiusMl:5,Dash:10,FactorScale:1,FactorExtension:.4,SizeText:16,TriangleScale:10};t.COLORS={colorEntities:e.Colors.PeterRiver,colorAccesories:e.Colors.Carrot,colorAxis:e.Colors.Alizarin,colorDraft:e.Colors.Concrete,colorTransischial:e.Colors.Amethyst,colorImplants:e.Colors.SunFlower};t.LINETYPES={scaleLineThin:1,scaleLineMedium:2,scaleLineThick:3}})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){class ResourceBag{}ResourceBag.AlignmentToolTemplateJson={ClassName:"Vue.Products.OrthoPlugin.AlignmentToolAnnotation",Name:"AlignmentToolAnnotation",Groups:{FemoralPoints:{GroupName:"FemoralPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:3,MinPoints:3,PromptMessage:"Enter a point for Hip Center",NextGroup:"TibialPoints"},TibialPoints:{GroupName:"TibialPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Enter a point for Tibial Center at knee"},TKAFemoralPoints:{GroupName:"TKAFemoralPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Enter a point for Femoral Shaft Center",NextGroup:"TKATibialPoints"},TKATibialPoints:{GroupName:"TKATibialPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Enter a point for Tibial Center at knee"},TKAFemoralTeePoints:{GroupName:"TKAFemoralTeePoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Femoral Tee Points"},TKATibialTeePoints:{GroupName:"TKATibialTeePoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Tibial Tee Points"}}};ResourceBag.AngleToolTemplateJson={ClassName:"Vue.Products.OrthoPlugin.AngleToolAnnotation",Name:"AngleToolAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,IsOptional:true},LabelPoint:{GroupName:"LabelPoint",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click on the label position"}}};ResourceBag.AngularLineTemplateJson={ClassName:"Vue.Products.OrthoPlugin.AngularLineAnnotation",Name:"AngularLineAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Click point for the new Line"},IntersectionPoint:{GroupName:"IntersectionPoint",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click point for the new Line"},Label:{GroupName:"Label",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click on the label position"},LabelAngle:{GroupName:"LabelAngle",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click on the label position"}}};ResourceBag.CalibrationLinearTemplateJson={ClassName:"Vue.Products.OrthoPlugin.CalibrationLinearAnnotation",Name:"CalibrationLinearAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:false,MaxPoints:2,MinPoints:2,PromptMessage:"Please select the distance and mark the points"}}};ResourceBag.CalibrationTemplateJson={ClassName:"Vue.Products.OrthoPlugin.CalibrationAnnotation",Name:"CalibrationAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:false,MaxPoints:3,MinPoints:3,PromptMessage:"Click on 3 calibration shere border points"}}};ResourceBag.CircleTemplateJson={ClassName:"Vue.Products.OrthoPlugin.CircleAnnotation",Name:"CircleAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Click on the circle's endpoints"},IntersectionPoint:{GroupName:"IntersectionPoint",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click point for the new Line"},ReferenceLine:{GroupName:"ReferenceLine",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,IsOptional:true,PromptMessage:"Click point for the new Line"},Label:{GroupName:"Label",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click on the label position"},LabelDistance:{GroupName:"LabelDistance",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click on the label position"}}};ResourceBag.CobbAngleTemplateJson={ClassName:"Vue.Products.OrthoPlugin.CobbAngleAnnotation",Name:"CobbAngleAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:4,MinPoints:4,PromptMessage:"Click on the line's endpoints"}}};ResourceBag.FemoralHeadPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAZdJREFUeNrkVm2RhDAMhVWABM5BJXAOkICElVAHSEACdwp6DjgHSGAd9NKZ151sD/oB7a/tTIYBQvJIXj6q6t1PffZDrXVDF/E0VNc/xdGS055kJtn0/llIRpK2hOMVTgyAO0nH3rfmnkQ6em0O51OqQYBZEanhdI4RUmOkvwh+OPOxzbW4GMEhGQRyrHmeM6Rxi0ohQm+UZUYSN+DEFKMsAaApUEk6GAUglYX6iLE9+hQEUIpCAEyTWvizm6Njw95XZc43b9++MOkowqRHoA1GGCTkvT03Gf3lzcrQ1u6SixOw/QLg9m8+1/WDLl8kplw+8FhlAmFt/B4C2AHzSWJm/XJ6sLwCeMBusA0PB4NFXkiB8pIbdXo4ONhgmS5UQB9i6D2ipW6pFYLpuoaUoliPjrlCRITzIWq6OkuISNDtAmA37wzYMTzHLBHQPdx6sJoZ5+rKOiU9e9/kLKIjA2YJPZ3uppz13Aic21a9OKu5wl9vIULHgug461mrnp1U9ACqEJV8M8RhvSqxMaWQcy21sLzn+RNgAKjc6yOGEcA2AAAAAElFTkSuQmCC";ResourceBag.FemoralStemPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUFJREFUeNrsV4sNgjAQpcQBuoE4gWwgboIbOIJOgBsQJzBOABuoE4ATyAb1zhwJMeVnjzYhNrnUtF7f493jrJ43x6GUCiFuFLLru/4U4DBlEDnEHT/3keAEjyBeEHFjLR2iBJfsCJ5p1hUpMxn4nsATetqU1oNvRbiBEQBrXKD8tCZrEk0yU4DHjaeWGi+oIeCiAwAPTSACzXZELj8KIXJNbgHTGfYOJgQuMFV4kGa7hMPLljwkHcL+1lTirK7rD69hMDTHZ/QEliylspTWCdTdD8BPY5J8rg74MZQQu7G5C0PJERg73JIM61kjQJLjuEI8abZDgCSXIPnKtHwmHig5/MN+H+AkULW0YWsEHh0EQtclkOT8eXvAOQGs8do1gbab7Iau3E5LUP1NaMMDUUcfYBmi51dPtSbCmMU/6bcAAwAnWuG8/u2IiAAAAABJRU5ErkJggg==";ResourceBag.HipImplantTemplateJson={ClassName:"Vue.Products.OrthoPlugin.HipImplantAnnotation",Name:"HipImplantAnnotation",Groups:{Acetabulum:{GroupName:"Acetabulum",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:3,MinPoints:3,PromptMessage:"Enter 3 points for the acetabular perimeter"},FemoralHead:{GroupName:"FemoralHead",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:3,MinPoints:3,PromptMessage:"Enter 3 points for femoral head",NextGroup:"CurveDistal"},CurveDistal:{GroupName:"CurveDistal",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:4,MinPoints:4,PromptMessage:"Select 4 points along the lateral femoral canal and 4 points along the medial femoral canal.",NextGroup:"CurveMedial"},CurveMedial:{GroupName:"CurveMedial",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:4,MinPoints:4,PromptMessage:"<i>STARTING DISTALLY</i> and progressing proximally, select and click on 4 points on the <i>MEDIAL SIDE</i> of the <i>ISTHMUS</i> section of the femoral canal. DO NOT SELECT POINTS IN THE METAPHYSIS."},AbductionLine:{GroupName:"AbductionLine",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Select and click on the most inferior points of each ischial tuberosity. (2 points)"},LegLengthDiscrepancy:{GroupName:"LegLengthDiscrepancy",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:4,MinPoints:4,PromptMessage:"Drag points to legs. (2 points)"},LegLengthDiscrepancyLabel:{GroupName:"LegLengthDiscrepancylabel",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Drag points to legs. (2 points)"}}};ResourceBag.KneeImplantTemplateJson={ClassName:"Vue.Products.OrthoPlugin.KneeImplantAnnotation",Name:"KneeImplantAnnotation",Groups:{AP_WidthFemoralComponent:{GroupName:"AP_WidthFemoralComponent",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:5,MinPoints:4,PromptMessage:"<p>1<sup>st</sup> select point in the center of the femoral canal.</p> <p>2<sup>nd</sup> select point in the center of the distal femur.</p>"},AP_FemoralResection:{GroupName:"AP_FemoralResection",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Select points on the distal medial and lateral femoral condyles"},AP_WidthTibialComponent:{GroupName:"AP_WidthTibialComponent",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:5,MinPoints:3,PromptMessage:"<p>1<sup>st</sup> select a point at the center of the tibial canal.</p> <p>2<sup>nd</sup> select a point at the center of the proximal tibial.</p>"},AP_TibialResection:{GroupName:"AP_TibialResection",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Select subchondral points on the medial and lateral tibial condyles."},ML_AnteriorFemoralCorticalLine:{GroupName:"ML_AnteriorFemoralCorticalLine",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:3,MinPoints:3,PromptMessage:"Enter 2 points for Anterior Femoral Cortical Line.",NextGroup:"ML_MostDistalCondylarPoint"},ML_MostDistalCondylarPoint:{GroupName:"ML_MostDistalCondylarPoint",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Select 1 to Most distal condylar point."},ML_TibialImplantDimension:{GroupName:"ML_TibialImplantDimension",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:4,MinPoints:4,PromptMessage:"1<sup>st</sup> at the joint line of the tibia select two points, one anteriorly and a second posteriorly. <br />2<sup>nd</sup> select two longitudinal points at the center of the tibial canal."}}};ResourceBag.MarkersJson={Name:"Ortho",Groups:{General:["L","R","Portable","Supine","Prone","Upright","Semi-upright","Sitting","Trauma","LT-DECUB","RT-DECUB","W/GRID","Lateral","PA","AP","Scout","Post-Evac","Post Void","Expiration","Inspiration","X-Table","Neutral","Immediate"],"Time spans":["Immediate","1 Minute","2 Minute","5 Minute","10 Minute","15 Minute","20 Minute","30 Minute","40 Minute","1 Hour","2 Hour","3 Hour"],Arrows:["←","↑","→","↓","↖","↗","↘","↙"],Functional:["W/Weight","W/O Weight","Extension","Flexion","W/Collar","W/O Collar","Post-Reduct","Post-Mort","Post-Line","Post-Tube","STRESS","LT Stress","RT Stress","REST","INT-Rotate","EXT-Rotate","Standing","ERECT","Semi-Erect"],Angles:["L-90˚","L-45˚","L-60˚","L-30˚","R-30˚","R-45˚","R-60˚","R-90˚","RPO","RAO","LPO","LAO"]}};ResourceBag.OrthoPluginCss=`.floatingTopBar,.orthoCissDialog{width:316px;height:600px;padding:2px;opacity:.9;display:none;flex-direction:row;flex-wrap:wrap;justify-content:flex-start;position:absolute;z-index:1000;background-color:#3498db}.floatingTopBar .resizerBar,.orthoCissDialog .resizerBar{width:100%;height:10px;position:absolute;bottom:0px;cursor:s-resize;left:0px;z-index:2000}.highlight-drop-panel{width:32px !important;background-color:rgba(51,190,111,.4392156863);align-items:center}.highlight-drop-panel::after{content:" ";opacity:.5;display:block;width:32px;height:32px;background-image:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIHZpZXdCb3g9IjAgMCA1NiA1NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEyIiBoZWlnaHQ9IjU2IiBmaWxsPSJ3aGl0ZSIvPgo8cmVjdCB4PSIxOSIgeT0iMjQiIHdpZHRoPSIyOCIgaGVpZ2h0PSI4IiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTM5IDUyTDE0LjQ5NTEgMjhMMzkgNFYxMS4wOTExTDIxLjczNTMgMjhMMzkgNDQuOTA4OVY1MloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNTYgMEgwVjU2SDU2VjBaTTUyIDRINFY1Mkg1MlY0WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cg==");background-size:contain}.left-drop-panel.highlight-drop-panel::after{transform:rotate(0deg)}.right-drop-panel.highlight-drop-panel::after{transform:rotate(180deg)}*.static{position:static}.orthoCissDialog{padding:0}.orthoCissDialog .configPane{margin:6px}.orthoCissDialog.static{opacity:1;padding:4px;background-color:#7f8c8d;height:calc(100% - 8px) !important;z-index:1}.orthoCissDialog.static .configPane{margin:0;background-color:#34495e}.orthoCissDialog.static .resizerBar{display:none}.orthoCissDialog .margin{margin:10px;display:flex;flex-direction:column}.orthoCissDialog .topSection{display:flex}.orthoCissDialog .middleSection{height:auto;overflow:visible;display:flex;flex-direction:column;gap:8px;flex-grow:1;justify-content:space-between}.orthoCissDialog .summaryContainer{border:dotted 1px #fff;width:auto;min-height:100px;overflow-x:hidden;overflow-y:auto;font-size:13.5px;padding:4px;flex-grow:1}.orthoCissDialog .summaryContainer ul{list-style:square;padding-left:25px;line-height:15px}.orthoCissDialog .summaryContainer ul li{margin-bottom:5px}.orthoCissDialog .summaryContainer div:not(:first-child){margin:5px 5px}.orthoCissDialog .summaryContainer .infoTableRow td{width:25%}.orthoCissDialog .legendContainer{border:dotted 1px #fff;width:auto;margin:5px 10px;height:140px;overflow-x:hidden;overflow-y:auto;font-size:13.5px;padding:5px}.orthoCissDialog .actionsWindowMainContainer{display:flex;flex-direction:row;flex-wrap:wrap;margin-top:10px;gap:5px;position:sticky;bottom:5px;background:#33485e}.orthoCissDialog .actionsWindowMainContainer button{flex:1 0}.orthoCissDialog .actionsWindowMainContainer button:nth-child(1){flex-grow:2}.orthoCissDialog .actionsWindowMainContainer button:nth-child(2){flex-grow:3}.orthoCissDialog .actionsWindowMainContainer button:nth-child(3){flex-grow:2}.orthoCissDialog .tabsContainer{margin-bottom:8px}.orthoCissDialog .tabsContainer .content{font-size:13px;border:dotted 1px #fff;padding:4px;flex-grow:1}.orthoCissDialog .tabsContainer .content>div{margin:5px}.orthoCissDialog .tabsContainer .content .section .block button{margin-right:4px}.orthoCissDialog .tabsContainer .content .section .block button:last-child{margin-right:0}.orthoCissDialog .textLabel{font-size:14px;line-height:18px;margin:5px 0 10px 0;display:inline-block;margin-bottom:5px;width:90px}.orthoCissDialog .textDescription{font-size:14px;margin-bottom:5px;margin-top:4px}.orthoCissDialog .textDescription p{margin:0;margin-bottom:8px}.orthoCissDialog .femurAndAcetSteps{width:65px;font-size:40px;font-weight:bold}.orthoCissDialog .section{padding:0px !important;flex-direction:row}.orthoCissDialog .buttonGrid{display:grid;grid-template-columns:repeat(3, 1fr);gap:4px}.orthoCissDialog .block div button{width:95px}.orthoCissDialog .block .buttonGrid button{width:auto}.orthoCissDialog .topBarSelectBox{color:#2980b9;width:150px;background:no-repeat 134px center #ecf0f1 !important;background-image:url(svg-encode("<svg xmlns='http://www.w3.org/2000/svg' width='10px' height='10px'><polyline fill='#2980B9' points='10,3 5,10 0,3'/></svg>"));border-style:inset}.orthoCissDialog .topBarInput{background-color:#ecf0f1;color:#2980b9;width:82px;margin-bottom:10px}.orthoCissDialog .topbarOptionsHigh{width:110px;background-position:center center}.orthoCissDialog .leftIconTopBar{width:32px;float:left;margin-right:10px}.orthoCissDialog .buttonbar>label::nth-of-type(1){text-align:right}.orthoCissDialog .leftTopSection{font-size:12px;font-weight:bold;display:inline-block}.orthoCissDialog .leftTopSection .h3,.orthoCissDialog .leftTopSection h3{font-weight:bold;margin-top:0;margin-bottom:15px;font-size:16px;display:inline-block}.orthoCissDialog .leftTopSection div{margin-bottom:4px}.orthoCissDialog .leftTopSection .label,.orthoCissDialog .leftTopSection label{display:inline-block;margin-right:10px;font-size:12px;font-weight:bold;width:80px}.orthoCissDialog .leftTopSection .buttonbar>label{width:36px;font-size:12px;display:inline-block;padding:2px 4px 2px 4px;line-height:12px;text-align:center;vertical-align:bottom}.orthoCissDialog .leftTopSection label+.buttonbar{display:inline-block}.orthoCissDialog .rightTopSection .iconImage{width:42px;height:42px;background-size:cover;background-repeat:no-repeat;margin-left:36px;margin-top:36px}`;ResourceBag.ParallelLineTemplateJson={ClassName:"Vue.Products.OrthoPlugin.ParallelLineAnnotation",Name:"ParallelLineAnnotation",Groups:{OffsetPoint:{GroupName:"OffsetPoint",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click point for the new Line"},EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Click point for the new Line"},Label:{GroupName:"Label",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click on the label position"}}};ResourceBag.PerpendicularLineTemplateJson={ClassName:"Vue.Products.OrthoPlugin.PerpendicularLineAnnotation",Name:"PerpendicularLineAnnotation",Groups:{OffsetPoint:{GroupName:"OffsetPoint",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click point for the new Line"},EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,IsOptional:true,PromptMessage:"Click point for the new Line"},Label:{GroupName:"Label",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,IsOptional:true,PromptMessage:"Click on the label position"}}};ResourceBag.ReferenceLineTemplateJson={ClassName:"Vue.Products.OrthoPlugin.ReferenceLineAnnotation",Name:"ReferenceLineAnnotation",Groups:{EndPoints:{GroupName:"EndPoints",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:2,MinPoints:2,PromptMessage:"Click on the line's endpoints"},Label:{GroupName:"Label",IsDesign:false,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Click on the label position"}}};ResourceBag.ShoulderImplantTemplateJson={ClassName:"Vue.Products.OrthoPlugin.ShoulderImplantAnnotation",Name:"ShoulderImplantAnnotation",Groups:{General:{GroupName:"General",IsDesign:true,IsVisible:true,IsDraggable:true,MaxPoints:1,MinPoints:1,PromptMessage:"Enter 1 points for the general"}}};ResourceBag.AcetabularPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB8AAAAUCAYAAAB1aeb6AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKvSURBVEiJrZZLaFVXFIa/ZWJ8ggNDelu0tSoK1SjOdOAglUbBSTuuOvJRAiKCk+KoozpJKZRmpIKkQXRUpaJ0oCBO0kKL9UEVXxG0IookJBof+Dk468LhenOvadxw2Gvts/b///u5dtCkqLOA3UA30AG0AzOBucB04CUwCowDj4CHwO/ATxHxrBF2NCH+GvgeeAEcAv5LgnFgGHgNTAPmpaB24ENgewr7NiIGmg2wlrRV7VOH1T1q2yT7t6l71RH1Z7X1XTq1qOvUM+odtXNSqt/GW6UOJd46tWWiwC71iTqu/qpWpkJcwq2oJxL3idpV/ReloF+A2cDWiBirA9IGbAC+BFYAiyjW+xFwm2KTnYqIOxOImAP0A08jYgvZuVouAx21xLkUO4Eh4CgwBzgO9AA7gF7g37RvqP3q0lryxO1InreUHVP7a9o+UgfVB+o36ox6oyrFr1FPqk/VrXX+96vH6nUcVHtK/gr1nvqbOq8RaR2sLeqY+l1Ne486WBsceay60m9Xb6oHJ9yhzQWsTQE7S21dyRPlwAUWpZL+SfWcOv3/EJdwv1Kfq8vTryTPgnJQt/q4pG5c/WQqxCXso+rpkv9Y7a46fep19UL6Z9Uf3gdx4n2svqxeWOqF5OtDvaUOqJtzrV9N9WarI+CMeiDtzcl3C3VUva/+maMeUT9X579H8l3qX2lvS77RVmATRSb6AOikuOVOAHPV+8Al4J+sLwFXI+LFJPmvAMtyl28EBoHeuilVnQZ8CqxOQSvTXkKRRq+lkItZX46IoQYjXwjcpUi554AfI+Jww3xeB2Q28BmwKr/OrNsp8nt1di5SzNaViBhRFwM3gfkUb4L1EfHHZLgbiaqoX6j71CPq33m+zQ19Pu392T4LmrxkpiioFVhGMTvV5esErkdEN8AbjFFQnpz0KWkAAAAASUVORK5CYII=";ResourceBag.AngularLinePng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEfSURBVEiJ7dM/SgNBGIbxZ0LEgLJYxUJBsBFsRBAMgiCkMlhYeADJCTyElRdIZ2dhKelt9AI2FkIEDQj+wUJQtHosnGLKxcQBYd9ml3e//X4Dy0KVKv8l6pH6qO7nhj/8yUVOtKO+qFdqJxfaVu/U5SxgRDfUobqaE12P6FpOdEW9VzdzokvqrbqVC9xVb9RXdTsLGuHL+J++j7Kn/ot3esACcDwKXDpqUz0c175aSXQWOAcexgWXitpQd3KCE9mwBF1Ur9XmX+yvqwfx/jmEcBLRNnAK9IE54Cn2e8B8nO+FEL7UAujGbhBC6MfZFtCKfT+EMIh9FyjqwEx8+Jkc6A04A4bAZNJPJ/MhXmtJN5XMNpI+/WRF0lepUmX0fANJULMuTdhvmwAAAABJRU5ErkJggg==";ResourceBag.CheckedPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfmAxUPMyWYnXkIAAACPElEQVRIx52VS2hTURCG/xtbk5RgXahYEFFpwdSN0IValUpKMOlOEKE7HyvRveKyuPCBD9BSg2DRjVBduXMhlNYHCqIRbFOJmEDEok1TGnw0afO56E3MvXnd+O/unPvNOXNmzowhm5Ba1KWwAvKrQ17ltaCUpvRSzxVTzlAdIdbQw00+kcOuHAlGCeFB1IBFBxdJUU8ZhtlRxQVC7OUZyzRSgdccsrlAiACxhnBRMwTKXCDEwSZwgBi9JReI7bxoAl4iSZZJtmLibm43gSc4SxeDJLlOKxLiMPOO8bcEMBBiiHn6kfAx5hifZDerd+blAfAQrwjywyE+QbeJG5wiC3wnKEYc4uPsMnExwFfTOiLeOYBXeExnCQ8wU1qJykEAOUbZRLFiQsTL1tIi3wD/xSXWm3u7OEbCsrqkCuAzt/hY+lrgPG0UX+pxZu2/2x285wBiH1EAZjlJawk/US1cawjf6DMP28sH4hzFZeItnCZdJcC8LOYptpQuq4c9GGV49WrNyDys6Y+r+LB3CjdnyNS44qi4YzH84TLrKMe9XCBbM0cREWbOmhiG2UgRb2OInzXxNGHRzhObeYVH+DEQG7jGb2prDJ8QRyqOWGCaK5zjad0yyxDCjPIe/6MInmJP6rbkwpne0ElZU/33QJ0pbu/LLgYbjBQrPlA5GQyCjnpDgVerBV9tNu0kUrPmVjXHDbbVm44eQtwnWSV9Ob5wlz7WWmGj0o3c8qtf++XXZrULLSqlmCY0rmkt24G/oWwf7Oz17CcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjItMDMtMjFUMTU6NTE6MzctMDQ6MDD3aPCzAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIyLTAzLTIxVDE1OjUxOjM3LTA0OjAwhjVIDwAAAABJRU5ErkJggg==";ResourceBag.CheckedCopyPng="data:image/png;base64,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";ResourceBag.CobbPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIXSURBVFiF3dZNiE9hFMfxc8cwRhQpeY8FadKk7CyErEikhoUoGzUrWTArCwuREluZleU0KxbeNoqFYsFsJhEliomUd2E+FnOmbtP8Z+Y//5cpz+q593nO+X3vvc895xfxvw2cwcmp7m9pAMP7iOjGChzHADorbW6tpzLmRMTXiFgdEa8jYiAienPeuIEOnMd7fMJz3G606EIcwwP8xV0cwTzswHcsqrdoC3biGr7hdT75mjH7CrxAd72EV6EHL/EDfQlSTBBzGo9qEZ2Lrny1w3icr3zBFONX4g82VSu8Eb34jLc4h/XTfIibuFxt0F70YzdmTUe4lKsLH9BWS55aAOZgCAdmBCAhLuEW7mDrTABszDrxG0ubDpAQQxgcb62uvaCCeHtEzB+ZaimKYri83ohuOHZ0RcSXhNg+drFiJavXwL2IeBgRyyNiVlEUhxqtWRZfmwdwA7ZlGa9vg5oE4Czu57zAIPZMFDAb+9NY1Crekt3yaOnexHnRiY/521xERw0Au/Blqs2rHNiWNfxGdrOqumApTz96qxIfJ8nK9AGv0uFM6gMybjF+YktNAKWEo06oD7/yMPVgSYX9J/BsMtDpwizKT/I0YW7kJ2st7XmCU3UXHwdmM67kYXuT/nBfNp5lDQcogSww4ohH7dtQXrc3DSJB2tPKXU8nNIS9zQQ4jHdZ0NpwEOuaCXAVF5omWAGiqjL+D5aUcAUHHD40AAAAAElFTkSuQmCC";ResourceBag.EfferentPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAGVnpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7VdZsiMpDPznFHMEkBBCxxFbxNxgjj8JLrv9tn7u6P6ZiHHZRbGUEEopJYf5z98r/IUPSY4hi9ZipUR8smUjx0ONt4+de4r53M+Hrin034yHxwRhiNHyrat+rXeMy48X7nuk9nY81GuG6iXomrgL5L3z3m08K4lxuo2nfAmyeXsoVvVZ1Xap2q+FR5XrtzodedJuU7sfngeywkpDsBETTU4czz3fNODbz0/r+GWsSyx4TlwDGua7JjDIm+Pd2xifDfTGyPen8N76j6d3xie/xvmdLctlIzx8OpHkc+MfEz9tzA+N6O1EkwfCH428Rl1r3k7nucCi5fKoGO7WOdZfA2bPfF4ruBS/LVjPZbhq9NgB+Yg9Nlw9WSKgskLKaSRPK83T9tShYqZJipaoE5+xykpGnTdOeV9pkbLx4Ar8Os2wMWN66JLOvnb266li55GwlBKEJbzy5RV+NvkrV1irbxOlWB+2gl60/RpqbOT2HasASFoXbnIMfL8u+OOT/8BVgaAcM1cc0GO7iWiSfvgWH5wZ6wTtLYRS0HEJgImwt0CZxEAgFnh/KikqkaYEO1YA5NB8x0YDAkmEBpSkzFwoKFXae+MdTWctCRXaw+AmACFcWIGNsQOsnAX+o7nCh1xYsogUUalBTLxwyUVKKVo2ybmyZhUtqlrV1CvXXKWWqrVWq25kDA4UK6ZWzcydgmMjhyzHesdIo8YtN2mlaavNmne4T89deunaa7fugwYP0MQoQ0cdNnymMMEUM0+ZZeqs06Yv+NrilZessnTVZcsfqF2ofrh+AbV0oUYHqb1OH6hhNKjeRaRNJ7IxA2KUExDXjQAcmjZmsaacaSO3MYtGCAohKCkbmzDSRgwQ5plIVnpg9wO5l3ALUl/Cjb5DLmzo/gRyAdB9xO0T1MbOc/0gdovCbdPIiD7Mz+qBqu+k5r/b/i/oNwSttrEAJvW1Xvh6ssGTW81sdWrPhRjuAu8afdV2lhg1cY9jMM8YxKnNpd6QrPqr23/SC59OwtV3N53u8N21ZiuWkWQJD/WOAPSeUYpYX6BrCscquXjKgu8unL5opTbJ3hBG2hDas8T9JtignCXhZ+9+03JpVFoht8E55JalX7Lzd69ulVTSAIOA9vYYeCV2xC0HJACWaeCUIYCn8gJTJEWmUVngGm15gdeW2zLrOq5xWsUmCgDJixlUmoNPVAjOw9WiDuHeJ2iQWtsmeL/642KUEr4ymCcMqNddFCBAT2SEhRwJamsi5sYa3QcYz1EV5m7gqxWr9+izSqY1oG5RA/GEXTt1RfWUFqgM6HIGxgC5LCZdTRY8D6SEEoEnNoDXFdvKwloohFdBekBVzgHJZ+26ap8e/wI6AJB0xMQ1B3YA2/FessCh0Me84HDTxywJbAfG60eRsDWBlgOAYOWEt9UswNAbJKMQ1q2DgmxBpbXONB/HUXo+TfhwHH79OM+nCb9znGe7ooYEjq33myLIqUeVw/NfKXNTBYq0NUobJeMuQZEvR6nHTVMGQbQhL9LZzKX5hF0RgRbcS4HDeRW1hrDGUQ3ZGtlZVEtLs7UTH9nGT4MvvBKdsukK6RwBAy5D9kapXCXBZgOxk5D8RgoCe8BeEdlxbNts48fz+vd9l51oNycVC23kPiM4asnUJBMlR8uDW8wToZTH/cVs19a3nXN81ws/m/yVHmINqi0U920TLMgeKM8CEgXUoBYC2ENvOFXUGl8iGa6HWlCMFGEcjQ6HooBJhgJZcDyFIRBEtc/EU28U63m8kRb+UH58K8hNygSjNcALOqYudw5Gud2XaAY3cu7VdrbbxDQLTIJCiFpQeCJqI9RlJosaYgBF0RwFNdIOSNLegZjscinBbgIOY0NQJ8TUWaGr48AlJMTlcj1R2WQT66i24DKIvhkNcbxpGv5w4hpiENfwlbmFzBP9MS+rJViBbuOE5dhMvFCEAtp1/lAehRgRvvIcO7xL60gPlzp3ZWB4X+HUje+UQexf6qD0XQNRLshUNglUFludkjps8NhsW27HGiw7R71Ff4xftiWNMgVFusCbUu+Kv6u7WKWGurahGIXOUnF6FbNBNrrBXidz1PS9+EcbPk6gGN//Ouh1ISf3v7rwf0H/KUGIp2H4q/kv62LXFo3zMgcAAAGDaUNDUElDQyBwcm9maWxlAAB4nH2RPUjDQBzFX1NFkaqDHYo4ZKhOFkRFOmoVilAh1AqtOphc+gVNGpIUF0fBteDgx2LVwcVZVwdXQRD8AHFydFJ0kRL/lxRaxHhw3I939x537wChUWGa1TUBaLptppMJMZtbFXteISCCMAYQl5llzElSCr7j6x4Bvt7FeJb/uT9Hv5q3GBAQiWeZYdrEG8Qzm7bBeZ84zEqySnxOPG7SBYkfua54/Ma56LLAM8NmJj1PHCYWix2sdDArmRrxNHFU1XTKF7Ieq5y3OGuVGmvdk78wlNdXlrlOcwRJLGIJEkQoqKGMCmzEaNVJsZCm/YSPf9j1S+RSyFUGI8cCqtAgu37wP/jdrVWYmvSSQgmg+8VxPkaBnl2gWXec72PHaZ4AwWfgSm/7qw0g/kl6va1Fj4DBbeDiuq0pe8DlDhB5MmRTdqUgTaFQAN7P6JtywNAt0Lfm9dbax+kDkKGuUjfAwSEwVqTsdZ9393b29u+ZVn8/i89ysVccGGIAAAAGYktHRAAaALwAnObu7EcAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfkAhgUEiIY1+W/AAABmklEQVRYw+2Wv0vDQBTH36WmVQsWC6IOBXFyEtFJ+i+4CTq5u/hHCIKIi4t0VRzERVAQnFpUcBFEEaz4sxVppf6gSpLLvZx3DiU2btd6FIR8lrzAe3nffN9LOICQkJD/xn2pPM0Qc7brctkg6Hnyk9LrV8taXtrb7my8+fPzitQEF+K8UHmJR1Sbn97eDQ+lUmtEk5MGIb1AwGhTLRjs75sKNrcY2z97LM4/GLGnqGlwkCCBQC3FjwPX/NVlz1w6PZGMxxcJqaVFDGNSWTFyvu7bRxFF5uCoq5k3tyjd9p/jIkrlQgdxMzDCk6aX+PUtE9wF5RG4iABCAAAA8T1sBgL8173tulWVrT3M52f9mo1cdkzX12B0xmIJFeFR0/yJi9Wqtv+K4TBmqSR6vO7cQHdSS/MP235QTn637S2HMekwJiniqS4HlJew3TRFR30MX9pGoKw0EkE/Zp43untxmYBWUrXtheD2UsSd40JhvGUCrkulESGE1InDmNOQiJtyeVVqpmEnipXKDPO8rEXpn5sj5y/hCSskJOQbSXKgvk7j9UEAAAAASUVORK5CYII=";ResourceBag.EfitLogoPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABJCAYAAADSUvh2AAAI23pUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjarZdpciS7DYT/8xQ+AgkuII/DDRG+gY/vj6yWRtJolhd2V3RXNVcUMpEA3f7Pv839i49k8S5lraWV4vmklpp0Hqp/Pu3+Bp/u79snvH4/tbvUXt1CU+Qen7/aX7M67fnHhLc9wvjc7uqrR+probedXwvGs7PwsD4aSbs87SG9Fmr7eSit6kdThzz3+Rp4TXl9o96l3xc5/93HhqR4aWVGRZEdQ/T3Nz0WxOfbTzu/MQbG+fucY3PcfHyzBId8er0fDv7ooG+d7756/1fOl/4aEb/4srx8xMO3HSF/7/zr4g8bx3eL5HNHD+8I/+Rks1XN9vN2PRU8Wl6M8u7NO2cOAwcvF++0wqV8M896r8ZVffcTcJaffnDN0ILgfXMhhRV6sLDvfYaJiUm2KHeRKfG21ajSZAIMKJ4rmGhsccUKllO2A8YU5d2WcPdtd78ZKjuvwFAJLBaY8svL/a7zn1zObB4XXRcDfXgAlsNczDjInV9GAUiwF275OvjtesHvPxDrUDUx7Li58oLdj2eJkcMPbsWLc2Rc5v5ERXC6XgtgEHtnjAkRBHwJMYcSvIpoCPixAtAhh8QkAwRCzrIwUlKMRZxKlbM3czTcschUkdOMNgFEjiUq2LTYASulDH80VTjUc8wp51yy5upyy73EkkoupWg5Itc1atKsRVWrNu011lRzLVVrra32Ji2igbmVpq221noX19mos1ZnfKdlyIgjjTzK0FFHG31Cn5lmnmXqrLPNvmTFhUyssnTV1VbfwW2UYqedd9m66267G1yzaMmyFVOr1qy/o/ZC9afrH6AWXqjJReqM03fUaHWqb0uEIyf5YAZikgKI60EAQsvBzNeQkhzkDma+CUGRBSPzwcatcBADwrSDZAvv2P1A7q9wc7n+FW7yJ+Tcge7/gZwDup9x+wa1dfLcvIg9UXh86iPRx5gu1fFFFqX+r/evC7WeU2sh805PnMeKru3Ydmukpj3WtFHCAvQcUg7vd/e14fM9RVzuGxhoXHPWUAEujMTq2sk3JW2IEUsTNwYdeVkoue7a84ZNeWYcx0TflVkB35UCdWLdGpa2MIvfZbSMBysL8grVTS2jFP6AU0QeBBbOtmaMxkDgmyZ5rplanHONnpk0xigxNEk7Weqa++rJmQ5kvVhZqPqIsU3pgERJoGOV3WHwSka0WAPfMnKytcaQXZtamruRn5Cg4voyIIzbSjbTGc8/CzmpwR1ZedjWtSc3q8oktqmnLzS2Y+w8zTsVV+/f2ntkZT/XGXzXQwh5nhmZJLGNPKfZWKas4uVu92kn97aV92xW76JETR+MZx7mL/PPNGLqPlWkNd/t2+maFb01cyfLp3dbz4SXrXdRw1ShxDIwwhs69jarPj99H3d0ry3P2xLFRlDuWCv6MFoi3mZNeeBTlD6sXIdMKID+ByJHwa4boaY1LHeKq7GXFPRh7EH0p1En4eZrhCUTk7BYUkZYwmG3VFDUncBO03UJi6oSIiPolNFbJPp3sKENuVmGr9vh8dwqsVN57H4ILXh2lD5C6XNPrMm4tvfp8FDdc+V5w41apd4Iyacg/HBf+GVC6IxInTpl783SGmeJuy0bze1Wd/JE4Tezv79rzXGMOeDHldtBOMzp5sQBlCd80+p4rhn4xEF5ciFI+/yGg5WOQaW6FMaxdT/U0A5V6e+Ux6Qf5aWsEJkpWVy71FFtxLX08osCPG8873efLZQl6F4Fnn0ASTrH7CiQC0Ql7AhTbYj0vRsCEFeQjWoPaUS5rCVzFAsEqxJxURIijoKSF0lWC7G37o4SEJtIb4kmG7e2QdSng7Nv+5iYWlfAWR4GlbB7yRuuIe5Z8grZRrcU3SIxdCPYBIJFi7EPGHD5ARr7BvHRZV5/TAHXeLwI+ctl98KbvMzm1fYYWxZrjMKGvMCJqTHL2KiU7jVQnR0XnJdoAabKoQmkLbNPbbnaLDKzA/e4STytrL21ZyL/Cgs6enlLLkk0dE9XRgPaM+Dppv/pxtlvI+rEsKIrb3QXl6NfEQo+ND3y+TydY9S3d+f/MIBQyijVUYdQp6JbQrxsql2Un2AdQvUwbTvKgiNp6JPxlvzKozXjUIFs0Ddiv2EUs1EJBgd8W0gtF4YjsBulMWdN7sTVCKOxeSIDk2ZPorZNWobGcEXKQjNDQx01tLU2PqiayetwsmlKKGTdMVEtkEzaQewcMSSzPXG1QIzkNvuAH0FKDx3w8xNHO5vXOmIep0ZwdftKii+TetYzy6T5s0jlQJdLu0Q3QibogRdC5I5atIMN6XhvH47qqXfIndd0vlg7SWXkw5CMqqlw/tAIu0VgXyTkZkeMMhEPpRZqh1Adz2ouI7nljXQoyOUkKEs4WKu3WEhBI4wvLv3g0fBrZxcUY8Kl7o+gHzKeQEkBpKy2m69iXJQyW996xc+71cQi/IzjyE0nQe995IWlKwp9cssJu17HySuPPpUn5/zU7krG6zyxWMXa+LZXg29PtnsSU03T0tNjT9ri9HUtI9VTpLlgOZM0ximlKYa3bzX/0i/SibSaOK9QdECUkkiPMxSOdk7i2P7oi8EW/b0f1uPgl/Gn8LtjrvHOju1jTjhCwWOKOfV4J4htqmSihm4KjEJgg70neZ3adzbK52Fdqcg0wDanLEDVS63deuM8ShUbW6Pqqo1ki284Ty1SL5kSEuOaicQ2KvAK/bF/oz/86e77XMbhV428TMysRsFHzmmibRpZFd09ylUiLP8xyT0P1Pb5nA7YFYNOAbwXUaCDKMUVEtL+jdKcu/vYYDIskPF5/SWCyvOepENqb7I1mjBOTE4rSMLReyBqFFSRcNzm8il9T8ygW3YKIGRo2SS/19Stn+M9GYhAR2F7JxArEkIt2dCO82bnTDG5u0+u+bNm17j9DZ/G256CcHXYXctymTRM4bqQGE6mvp7cBoDGOeuuntoqf1EQBPcJq9ypkgr2KiforYWESqGNZOFzy2gPDsyxfzo/HCXBfPdfspcSFOMKgjwAAAGFaUNDUElDQyBwcm9maWxlAAB4nH2RPUjDQBzFX1OLUioOdhARzFB1sSAqoptWoQgVSq3QqoPJpV/QpCFJcXEUXAsOfixWHVycdXVwFQTBDxAnRydFFynxf0mhRYwHx/14d+9x9w4Q6mWmmh1jgKpZRioeEzPZVbHzFUEMIoAZjEjM1OeSyQQ8x9c9fHy9i/Is73N/jm4lZzLAJxLPMt2wiDeIpzYtnfM+cZgVJYX4nHjUoAsSP3JddvmNc8FhgWeGjXRqnjhMLBbaWG5jVjRU4kniiKJqlC9kXFY4b3FWy1XWvCd/YSinrSxzneYA4ljEEpIQIaOKEsqwEKVVI8VEivZjHv5+x58kl0yuEhg5FlCBCsnxg//B727N/MS4mxSKAYEX2/4YAjp3gUbNtr+PbbtxAvifgSut5a/UgelP0mstLXIE9GwDF9ctTd4DLneAviddMiRH8tMU8nng/Yy+KQv03gLBNbe35j5OH4A0dZW4AQ4OgeECZa97vLurvbd/zzT7+wHNBXLL2CN1oAAAAAZiS0dEABoAvACc5u7sRwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+QKHwU7BD7fRZYAAAfcSURBVHja7Z1pjJRFGsd/b/cMKMcO6gzHNLu6ijdGJaCux7qxHYMrRqKoGM+k8Uo8IiYaQbRjCOoHMeouq0iHRN0PizF4YCRAq4GgkYgQD7wVnYPBcRBErhm6Xz9UE407ZOptuvu9/r9kvkyqqitPVf3reJ96ynFdFyEiRD2QA64ABu4nTSswDVgWd2M5EgARMVosB/ZaYHzcjZVQfxERY6RlumaZSgIgYrz6lQkkAEJIAIQQEgAhhARACCEBECKc7LFMt0umkgCI6LES2GaR7mWZSo5AImJks1my2ezhwERgcB9JisBGYAmwVwIgARBCWwAhhARACCEBEEJIAIQQEgAhhARACCEBEEJEhbowVHJUPkcChmGCPRwLHBHwKq8HNjvwbS/s2ZzO+FUPB2gCDgGGhFTw9znudHvIMxI4D9Nn/njvvxf4GngbKFiW9yfgqLCMF0s2AW2BdQRylj1Dc7JuBHA1MBU4ERgUMiNvA9YAixKwsG1LZ8G9fGa1f3N0yV4XAKcADcCAkHfWncCVGO+9/hhXGtxD+0n3KnCJRXknA28Ch0Zs8t8L3BNIAUjlc8OBmZjAjYMiYvBuYLYD89vSmZ1VKH888AAwiWhGu1kNnG2RbiFwg2WZY4FP+knzFHBbRHcAXYFaEjpL55HK5yYB64A7IjT4AQ4DHndhTSqfO/rq9xdXqtwBwGPAe8DFRDfUlW2sv8M9rpb6oynCRwBNgREA54nraK4feBGwmGgHbDwRWP32ti1jKlDWYEwE3OnoQHcfySqljSSB6DR/W/k8zWPPnYi5olkXA7s3Ae+k8rkRB1BGPfAKcK7GvAi1AHzf29MEvB6Twf97EfjXsBULys1/P5BWFxahFoDBK56ltIeN4xJ2ymDHmVpGvmOBGeq+IvQCMMxJNAKXxrgNpo/K57zmmRGz1RLAVp9+d1uEbfpzEGbdu+k7cktcmJCAP3tI34B59y5OFIEns9msH7/9AvZxBsPGPF9nkZKH33llZv8R4/DxQUA66PmYA7n6MvJfAzxsmXYScFCZM+irJXttLnXqMHwyLAAbgC99EoBVwNEYp6r6MssYCiywXLVtBO6q8urcBb4H1voqAAnjYjnWY7Y9wIMOzG1LZ3qD0ks/hUfPz+dGAXMxnnheGPf3VS+w8pxrbNK2lDGAHgFmA7u16y2L1tJfuTSWJglboX65hmPQV0bjzdmnF2g5Y0jDo0Ea/ADHA+3pzKYCXAXM8Zj9wq96rFeZEzwq/fWYLwYa/CJwAjDBY/qne3FXvXT6lMAatDOdIQmz6N/F9PfYLunrgZSHchcB/1U3F0EVgEO8JHZgxg/paYE36kfpTBF4wkOWpANnWaRr8Lj/n60uLoIsAF5Y24P7Sxgq2mDEyuvMa3MgdzD2n/9azdGEENEQgHVdxWJoKtuDW40bf0nsT+6/wv6+u5AABJ5ut+Wm0FS2a9cOMJ8p/WKrureIkgCECnfSnfg8AxfVCkICIISQAAgh/p86MC65fviEOt6WyIVm75dmfMXRMlwEXQBS+dxlCXMdd7QPv9+OuQlosxKZ5cC9WmF5+u16whMizMV4eooarwCew7/Ye78UYHGnRdjsVD53Cwrh5IV/Am0hqq8LfAFkgC/VfLUTgEEyQyQZCAwPWZ1HYKLwTlTzRX+JKkRfnCATSABEfNE2TwIghJAACCEkAGoLIarX6RQpxn82FGGlzADALpmgdtRhvhffhXlXrtYvhQ5NwuRUPmfjrNLkQ/2qyQeYwIzvODBvk39PiAeNN2SCGgpAezrzlrN8/lujErU/fHXgdsxbgDbMcU1k1khQxIQPqyIbMc9ah4UC8DHwtIZlbVcA+HXPPpXPeXrIsUOzpBfWYrzqQkM2m8Wn0N+xPgMQIjACICQAQggJgBBCAvAbhzrL56vFhIipAJw1JlnnqMlEBWmUAISHE3a67hj1WdEPXnxFLor7waPfAuA1dPWskSELCyZqjpenvC/PZrOXSQD8Y43H9NcmYebwFQvUzcX++MlDWgf4H/AkcAzlP/8tASiTNsDrCzqz6x3n2VQ+l8qse03dXfTVp7yQxHikfo5xzf4M2AC8CzxIxOMT1Pn540X4OWHcP0/zmHUaMG3plh+WpfK5D4GuELfBbuC59nRGL/lUhgN5D3Fk6W8fZ5TOFB6KqrEc1/X3fk0qn5uOiUocZ75x4SgLV+cjgK8tV24vAVNiaMuxwIdULhryu8CZB1hGIyYC9gCLtOuBU+OyBQB4HtgRcwE40onQRSef+RjzMnKlGKozgCrSUSx0ATrahyEyQcVYWMlVsgSgipRuIs4hXDHsRbB5CtguM4RjC0B7OrMZmIresxeVoRvIygwhEQCAju1bVwOTgb1qFlEB5gJLZIaQCIA7+W46enuWAP8AOtQ0ogJcCSyXGUIgAADuxFtpT2dWJ+AvwL+Bzpi0gwt8Z5FuO9BjWeYWdW92AhcCjxzA9rISQUp3YR98tzu2ArCP1nSm0FEs3JaEFHAt5lPhTxHuqC8W7D5ddQMvWqTbTWVPwsNMAbgP4x+wCO9RsN+rQB12lPpwf+wF/lPLC0q+OwLZcPP613mtuxMHjiuJlgukCb/vdgJYmoDPWtMZ2xnKAcZjnnPv6xNVDybisLZRfdMItADnACcBfy39b2Afg3YpcGMFJ59xmNVtYj+D/yPg21oa41e6GcJ/kxqXkwAAAABJRU5ErkJggg==";ResourceBag.HeadPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKMSURBVFiF5dY/iFxlFAXw8zYrRk1iYQQTZSVgIYpo/orCWghCRISAhSCChUVioyDBImgsNARETeMGBFFbQdCYwn9gEQLGiI3IoiCIoC6IoBJjTNT8LOYujBvnzczbiYVemOZ75zvnzPfOu99N/u/VdN2IVUnWJVmT5IckC03TnJmUsUGit+AgvnRuncGHeBxXnQ/hYziN1/EArq9TCC7HzdiNj8vMC7hsucIr8HQRzuGKEffN4ji+wW1dxafxGr7FbMf9+/AbdnQx8CK+xoaxN/+dZ1e9utFPAvfhF9ywHPE+vqewMFImsBrf4eFJiBfnVGXi4CjgR+ozm56UgeKdrTCvHwb8DI9OUryP+xPsaQNcWU1lWcFr4d+DI/1rU0swG5JIcvv5MJDkaJKtWKrbqwrLF3UK+wcCOxbWF/fgHGAnzuLHarsXT9DA6jJwTRvoInyPvZjHR6O24BEMrC0DVy+unXPETdOcSvJSklvrdyLJsQk1pZkkZ5MsDDTQtz7VNM1PSe5M8n6So9i+TAPbksy3zg14sHr39iXrj9X6rq7qOIwDbYCdJXLvgOf34CSex4oxxWfwOzYNAlyAX3H/EKKtdbEcwiVjGHgZH7QBGr2R6jjWDSGbwafVWtt7ew9/R90Dm4cBL8V7NQe0ph5r8Lbe1HNTC+7a+qyfGGZ0ccN0DSM/D0t9YedwAnf9w/NtdbW/gvEmcL0B8zQeGvD8RjyHJ/EG/lAzBC7Um45P4dlxA9svsqNSf6CfBJtr/U28U+FdrEN6c+RXuLuT8BITW+oY38KqatXzmOvDrKygPYN3q5esHIV/pPeCmSSHk/yZ5PMkW5JsbJrmZIf/1K30brJXcQTX/WvC//n6Cy6N9yRVPSPzAAAAAElFTkSuQmCC";ResourceBag.HipMainIconPng="data:image/png;base64,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";ResourceBag.IconRotateArrow1Svg=`<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M12.1972 1L16 2.89873L12.1972 4.79747" stroke="white"/>\n<path d="M5.22535 12.5823L3.11267 16L0.999999 12.5823" stroke="white"/>\n<path d="M2.90141 15.0506C2.90141 5.17721 6.49296 2.89873 15.1549 2.89873" stroke="white"/>\n</svg>`;ResourceBag.IconRotateArrow2Svg=`<svg width="17" height="18" viewBox="0 0 17 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M16 12.1972L14.1013 16L12.2025 12.1972" stroke="white"/>\n<path d="M4.41772 5.22536L0.999999 3.11268L4.41772 1" stroke="white"/>\n<path d="M1.94937 2.90141C11.8228 2.90141 14.1013 6.49296 14.1013 15.1549" stroke="white"/>\n</svg>`;ResourceBag.IconRotateArrow3Svg=`<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5.80281 16L2 14.1013L5.80281 12.2025" stroke="white"/>\n<path d="M12.7747 4.41772L14.8873 1L17 4.41772" stroke="white"/>\n<path d="M15.0986 1.94937C15.0986 11.8228 11.507 14.1013 2.84507 14.1013" stroke="white"/>\n</svg>`;ResourceBag.IconRotateArrow4Svg=`<svg width="17" height="18" viewBox="0 0 17 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M1 5.80281L2.89873 1.99999L4.79747 5.80281" stroke="white"/>\n<path d="M12.5823 12.7746L16 14.8873L12.5823 17" stroke="white"/>\n<path d="M15.0506 15.0986C5.17721 15.0986 2.89873 11.507 2.89873 2.84507" stroke="white"/>\n</svg>`;ResourceBag.Icons8Drag32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGwSURBVFhHvZW9SgQxFIXHQu1FKxtt1/fwAbTYfRdlW61cC9/FQrCxEMR3EFwErawUBZnxu8O9o/NnknGSA4f83c35mE1INlRFUazkeX6OpzqVThp+QVvQfuGZLsWXheN3/IIfcRqIRvg+vsEneI7jQjTDZY62BNB+XAg2roWL6FcAIvoGMe7BZMMNvMRVuIhxDUDE+Ahf6zCuugCSKioAG29pt1e+ABzgTe269eu0P+tUr3wAWJ9gv9vRddX+EjVeX4Aa9xUNDRdR530GqOuHGBIuojboEFLbhhgaLqI+CEBEfR2CzgIIedWe8FWgX/FDY87Hb1ggDgVgqoMlHKchlt/g2661PlO/wJ9YXtKJfYUZFoh5OeEp6kPPwDq+xD/hJiaCIagNuQX94SYWgiCo8wKgxh1uosAgjnWqV9Q4AfjfV6nxCzdRKAfT+aRS4wRgfReIe1q/8BD5AERVUgCC9rRbqQuAz72Gd3Q4jgjZxq3b0QSgb6f9TqfGE5u2rij9CoDW/6oNFRvXIGhLABw/3ERABYEF4AynCTcRZBAfuP6wpBKBBpE+3ETwwf/Cs+wbb1Wj/Vz1yqoAAAAASUVORK5CYII=";ResourceBag.Icons8Erase32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMcSURBVFhH7ZZbaM5hHMenOS4zO9kYcspysSTtwoWNkjmMxFwNRZYhp6iVSArFjRJSLrhT48alQ2JOS4ZF5nwaSS5IjZbZ6/N9+77/Iu+7/7u9c8O3Pj3/3+H5PYf/8z7/N+2/UqnOzs4CqIXpdv09MWgxvIePINU51PtisInwDs7DAjgMHbDVKb0nBpkAb+FSJBLJoF0B82El/IAtTk29KD4eWhn4Mu1CqHJIsVVwFKTNdqdOFB0Lb+CKV14OlQ4rXg1ToAa0Exsc6rkYcAwFX8FVqITgXfO8GhbblL0XtBOaxHq7uy8GH02hl3ANMkFnYI7DGrAMJtuUXQUjYB1oEmsdSl50HgXP4TpUwDGHFFsOwbvmeR/Ms6mJ12MfAk2ixu7wotNIeAY3KZZFm0s7w2HFtRMlNmVPgyKbsivI11nZBJpEqUNdS4XgCQUitHehwSHFtMVHbMreDbU2Yysv83M6z/doP9OGO5Qk6v09hiYoBb1/vYZ8x3OgOJqMKK4DWmBT8RJ8GXqm7YOts/OF53HRhEQiqZDkFrgDOfLRakIPQFfuxWgi4nkb7Lcp+xQssym7mXq6L9qg628FSfqwPARtWZ7dUeHTqhuhFSbBIBgC8g8gP12Th4GQAVr5WdDg5S4TXyTlg1bZrGe7fxFFBxO7ALrzT9utvvoObLcpuwFUR4PPtDu+SNLg980fB4+JSfQn5wx8Ap3ybNCq+2FrB7UzJ6AN3yx3iy+S8kjWbLX6hIPHRB+d7OO00km7tRCdgdfwFWbbHV8k5YJ+Ynrvw+wOJQbWOz4A32Gj+sNB+AYVTkssiuiEttAW2pW06F8H0gdoh7kOJRaJmdq/0B0SiBrnPHhwDYcSHfSzCn7v3RF9df9r8OCzHFp0Gg6PoInNyLY7tOi3B9rpu8iu5EWB6LVLkdsw1O4uRR/d/1p58D+g26KIPjxP4RaTyLI7rsjbBTr9S+zquSgW+/Q2JpoE8Z3QQc5Su1InCsf+fNyAIgbRLReAbwdIa36PxaGvS4cXnfT36wVtKlTvssmJjlkwtaewkKRu139FaWk/AXYPZV8WWQg1AAAAAElFTkSuQmCC";ResourceBag.Icons8Implant32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMxSURBVFhH7ZZdaM5RHMdnRrSRYhfm7ULzlsnbSER5bUlLi0SWbLWUWNGs5b1RVi4UaVwgRF5a2c0mFsOWWi40G6ldMULETGQ2n+/Td09t/+dZa9tzI9/6dP6/l/M75znn/M//ifun1NHRMaq9vX24zdiLwcZBCTyH30wgJJ4/wC1Yj5ng9IEXA2QywAPaIlgDc7GXwDa4gd0KL2CZuwy8GGgQAyyAfDgBByELRsBYuABtsMtdBk4U1a+uZxJa9ka4B0/guykmNIw2BzSJPHftvyhWANI1SLU7JA+6Hd5CLSTDbvgJaU7ruyiSCL/hpF0RRTwFdECrmFQCbSVUONw/UegSPLUZVeRMgm+QC+nerhkO910UmQJahQy7ooqcYmj08yvYGwr0VxS6AjU2o4qcNP9yrcZZKHMoKPL0Wm2hLYSJdkcUedkuvNquiCJlCDnScjgAtQ4FRTAbdIG8hB9wDEY7HBIF5+ErB0kn/ZFDEUX+YHLaaFfS7qOtcygoErSsV0mKp9Wr1ASa0CO4Aw3E9KvvQjpMhz+wwiUCUo776Nychh63oI6EIpuy9fpkgg7SKSjAN81hFZ8Bb+ChXQER2w9Nfn5G/8OhQHcR0P63QJZdUUWOrtlS0JtQA1qFwJ2Pbzx8Bl3VqYyhlZjjcFcRmOCEmXYFRDiJ+FHQRPWhWSc/7U2oCiVZ2Mnk15mh2NfhscNBEVwFOixD7eoiYjqg76AZcskLf2qxZ0E7Pn0Ndeo3g7amAbQKG0GrtchdgiK4E17bDIuCOsWX4Rccwk5yqIuIlYEm9xX08SklV39S9NFq5bnQqZFF0hkotxmWCsEnmG9XRBGfCqqxA1I0UdojoMmUOC26SLrfPRE7wwWW2tUrMfhs+rwHrcgmu3sWidqzHJshYVdT7KLNXot+unbzINGunkXiSAbSG7DYLvl0eKSFdsVODNL5qQxfuzxrL5txx9sVOzHQVvhoMyTsCjhvM7ZioONQbbPzVvwCm+2KrRjoNpyzKXuytgSF7/2YigHrYY9NrcAG7Bba2O8/g+iLp1turV2akP4HRL+3B1JMQHd3Je0Yu+QrxJdv879ipLi4v9Fg9BvicVzQAAAAAElFTkSuQmCC";ResourceBag.Icons8Refline32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADBSURBVFhH7ZI9CgIxEIUjC7aCnb3Vgp33sPIC3sZzeADP4xG2EU+Q+A1MYFGjos40zgfDJC9k3tufFPwNpZRJznmhW18w7zA/UCeV/Kjm9At9rbIPYR7mKvsQ5mGu8ncwbMqwnW6bmD05w1YMFWYq3cGZ3Wt/FQDd9ps/C4Bm/8O1ArC3NxceBWDtYy7cBqD7mQvjAJSvuVAD0Ofu5sIowNHdXKgBBNZ72rZVnG/onV79DQztqfObNVBLvRoEH5LSFeVD5w2yvog+AAAAAElFTkSuQmCC";ResourceBag.Icons8Sphere32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMISURBVFhH1ZfLS1RhGMatNNKMgpoQzS5/Qe20TYuKWllBtYgMiYoMIajoAhW5qaWUhd0W7gzsZrUUpJAkohKhgtqF0EXoSmZYOf2e45O3mbE5M2eIHvgx533O+73fd875zne+yfuvNDQ0VAhVcALOw614PN7K7xk4DMuJpzo9OlG4Eq5DPwxAl+NGuAh3oAek13AWytw8c1FkCVyFX9AGm2CmTyeIc6WwG7rhG5yElPmTioYr4T10QqXttKTHQJut0AtPoNyn0hMNtsMPaKDYNNuhRdt51LgHb2Gp7clFoq58EPbaykoMooBaV6CX4xLbyUXCYhJ12xtsRSLqFlHzgeA433aiSNCE6yQp49ueStRdAJ+h1tZ4caICNNtDTbgwovYxeAOJbwbmDWhzmBP5UbyDOlvDwtAK9xU22sqZ6KMJ2h0OC2MdDDDCYls5E/2sgUH6mm0rMLW233eYU+kxQJz+VtkKBnABrjnMuejrA+xyGBg3odFh5KL2FtjpUPFzOOgwMPT+X3IYuSbW5/gl7HMYGKfhtsPIRe0uHnu9Q8X6rNc4DCbGEYweh5GK2sXU/g5VivmNeRJWBAkSgTYcUqmtyERNfZa1xhQ6rqb/T1AQJEgE+n5rJ5N8nc5Q1M2npibcOVsagOZDi8NRKQm6NRhbWYt6Wvv1AZrvuBy04G0IEsaKE2WgyVFtKyvRyWZq6eM2srxz3Iz/CKbYGi8STsEriNkKLYrrth+Hn3DAtmqvAA1odAWcKBrra6XHcBem205LtJsFmnDP4AuMvfJF0AdNtlKLJG0c+hhAK8ywnVTkbVMev9qma7uuR6i5NHIHOa9dlgbVkfZFkbiMBtrRPoSUrybnauEy+fX86g9L8Kr9EbFuu668A+baTk8ULaGRrkyz+ChxkU/9VeQupE0z6Jk3EY++82FEQ02oPaA1QjsZbSbWJhsMfgw0B/Se63E8htQTLozoUMtpHbSDNhNaSvVJfQovoN/eR2iB9YTJX7VsReE5sJpOdsAh2A81UIGf2a3+d8rL+w3KdopLVvDB3gAAAABJRU5ErkJggg==";ResourceBag.Icons8Vertebra32Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAOlSURBVFhH7ZdtaE5hGMdnZjOMmSamaGNrSjYhrK2lrEjUfBBbSDSyWgx5iXxgDMsXIa/z/mEow+QtL6EI+6CEGA2xkS2bLS+zx+9/XHuMtXGetpXyr1/XfV/XfV/XOee5z32fx++fVX19fYTH49mPXQdB5m4fUbA7PIN78AaOWah9RMHV8By6QhxPwoNNsnDbi2K74RZ1/bF9oRrSLNz2otgw3TWKp50FJRBi4bYXhXv8qO9JhOUUL7ZQ+4iC4aqOHQnL4L6FWlckDqaOv3W9whdlFxCDycCWWugX4Q8iHmBd9yKBVnoxSTqayxG+VKiWH5sAUpiFHdGPhPeQby73YvIJiuhOU0Cr/QL0hkI4qzGEO9P+AEtgNDh7Ana9zc1U3ycxP4oEn+EOJFvCb1BBM96GqdgcaFAFxIEu6hHj/vwTMDAMxkK4ubzCV2SFy8zugl4W9grfILgN2hNqQFpsYa/wRUMSqQLN5ThPKrlE+yVchjNwCb6Cdr618AQ2g5IshSOwh2kZ0BPu0tdFzIYi0NM4DefgOlSqhkQ7y8o7FzAY9v024DXsgBQb5oj+NPgCTxlWgNWFvoVy+rE2TD9fAL6ZcByqlFOirYW9gWaoDf0pAkEwCQ6BfkOt4pzGg+k/ho34OphLxbrguwbbzaVx0fh1WmoNvYAtMKrxvBbFYB00C0Cnnoo6Ry72FGg9NBzF+kl0l7Ww0MYMBa2FmzCZsU32kr8Wk8eB1Mf63UiajdXjvwL6fQ/ANHzO3dFOg1qNVd9nkUCP9gEUNiqci52OjYVA2iHY4dh5kAfp9HtiX8FeS+WbSLAVSkGbj1a3kuqxfqSIFlSdrERbC1FvTQ3dXEikrTco1dK5F5OrQJvMePgE/eQnubZgvTkTQPvHAGcCoj0V9JZoDR2GQgu5lyVSkWx4YO4WxbjeeiJI3wqb4LyF3IvJ2gtmgZ7CO3O3KMYNVXXsQDgoLOReTNYutg20zdZBgoWaFWNWQYm19foucgK+iMlzoRz0XaD3/iFEWLiJiCWD3v900MkoRVrYvSiq11BnQ57acJV2JeTAGPqdsCEwEfJBq17HsI7oG9gCS+W7SKQ3QI9fe4D290x4SNsr+t8wujh9NwSDdkv9X2j2abkSiWaAtlp9kIyQj4L9aY/F6sM0FPQ0poBOTO39Q5zJrSUSxsBFCumOtRZ2wgpYA0ehDLRX6ATtbtNaX9SPpcBK0DeEzn/tjDo950OTD5X/all+ft8BKesV5152sw4AAAAASUVORK5CYII=";ResourceBag.Icons8StartPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAACoklEQVRYhcXWy4vWVRgH8O/RzGIcmm4qMV2YIJ0gqCAIukBZEVILaxG1aBHoLnI3my4u/ReM3ESL3AlRBGVEaFBRIQpSlEwXoyuZ44RT6qfFewZ+TPO+zu/3NtMDh/c9l+/lPc/7nHOSIQITmBiGY6jAIRz6v8Q34bxe3NyVZ9UQHrYnOZrkSJJnhuBpH7gYP+E57MQvWLuSBh7HHK7GlTiDx1bSwFt4vdHfhzdXSnwcZ/FgY+whnMN1K2HgBXyL1Y2xVZjG88stXvAVXlxk7iUcxzCVdUEDW+pWX7/I3Hxq7m/DWbApybVJLkuyrtHGFunflORYKeXhPgbfTjKZ5MskJ5OcbrSF/T+SfFdwIsk1SWZrO53k98bC2Qqeqf19pZRjfQxMJnmiGh6tpkcaP+Ly+jlS2w/BLfgaX2Bzm+3rErgRR+sf+fb5wSvwLn5rltcyiN+Ln/EB1i+cvAi76x9pahnEd+Av7MGaQQu312P2NVz6HwivxV78jWeXCroLP+JDbBxC/Cq8Xy+r+9qCx/EJvscdHcRvrafjYdzQFj9PMoL9ONXmhMPqitmPkUFrB5KWUmaTfJ5kupRyfqkGSinnknyT5LPK0c1AjS1JDixVvBEHKrZ71BTM4ZEO2Ecrdt0wBrbW2h3tM78BG/rMjVbs1kEaF0rBA0k+KqXMLCAv2JHepXMcU833QZJUzMcZJg21hHYtGJvEQfxZhafq94P1Mmqu3YXDXcXX67377679NVXsTD3LNzfWTuCduuW71Rcy7qkc7Q8zPIWZKnwbPsVJvaf4v1JX0/I0fsUR3Fmxp/BkFwN78V7jgnoD40vAbcSrei+nPXW3XuliYFovTmBbB/y2ioXptuDRWsMvY6yteINnrHLM9SvlQeBLugq34foHt37ijW8UPKEAAAAASUVORK5CYII=";ResourceBag.Icons8Start1Png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAYFJREFUeNrsVoFxwyAMjDsBI3iDeoM6E9QjpBM0I7ABI3iGTJB0AqcT2BvUG1Dp7mkVzknA2PR6F93pQgDpHyMJbTYP+c9irT2y/hV4bX+lnuunSCDQXjgqirecpy9x8grKUuYkoOXdIxZ0TgJfpDvxv+G5XOA70n5ivpek1gJXANITa3usqdlZgECSyvJM6pxyup1JtxT1o0+OfjguKtITpnnPJ8aDU7IdrhE4Atht+PCMOd1O9+oDhlOHYHJn8rG9db8cYNUK11f5wZuNRDD4GiSiwYWhSSUhwPVcB+1cEgK8Tf2EjkQZYVMuAi4cdlxoIvZzUepC9j4F+lSiNoTIIIrXYk+virBRoU90yBdoUL3GCZA9nmblNScjynGzBIEX0sNEueUX8Z30lcf8JHt2B9gmX4F1aYhTG8xpr0GxWFMiDW0q+E+jgSa0R0ZUV/K+w55aNC5NCgGDOqD9U99p16ywNan5b+WpIlr2HrZdahU0sV2OFy/LVMOHrCXfAgwAnFb2hQ9xiDsAAAAASUVORK5CYII=";ResourceBag.KneeAlignPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAvFJREFUWIW1l0uIFFcUhr+jGY2icTQSGO0oWQhxIUzALIxG8QUS3GSTgIsoPsalj4UrRUiIhMCID0I2PhYRxLjWPNFFxiw0kCCKC0VG40QEZXxEIoJ+WfTtpGyrq6p79EDDrXPq/ue75946VQ0dmPqFOjGN31ffTuNedXs7WqM6SP4G8HFEPEiu9cDsNJ4CzHmpAMAHwInMdQ240YHOiABOtgB4BIzvFKbU1FfVv9RxGd+wOjqNp6pX2tFstwKfAccj4p+UcDJwPyKeAETEbWB8FvCFWTrtF5pWP0c903TfKfWdqrqVKpBWeghY01h9srwD+BuwrCpAleTd6ll1U05sg9rf5JuuXm/0iTIrrID6GvAj9X3fm3PLdGAo64iIIeBbYEsVgEJTd6h7CuIH1I9y/FPVq+rCkQJcU3sK4t+p77WI9aqDZTmqHML7BbEaTVvQsIj4A5jQ6BGdAgwDMwri04CbeQF1JnCz0SM6BdgL7FejRXxmRDxuEVsADJToFwNExGHgIbCxOaZ+CHyvfq3Oy5k+H/i1DKDU1HfVU5nrHvUrdUBdqH6iXlEPqrvUbWqf+md6dRdaq9JmAcYAt4BB4M00HgB+ABYDk4B9wFvA5PTrBi5HxKEy/VdKCSMeq6tSgtuAwFLqjeYgMAY4yvPb2aV2R8TuQv0yAAD1GDCW+uoB7gI7I+JRwZwpwAWgFhFPq+QpAjinLs3xr1VXFMw7rc4t0q76PbAZ6M9pKr3ArIJ5XdTPw8gAIuIMcAnY0BR6AuR2OvVzYDgifq6So9TUWnrNvp7x9atbc+79VP1FnVCmW/mTLCJuAEeAvoz7uQqo64BFwIqI+PuFASQ7BqzMXD/NaqTvh+3A6oh4WEWwXYDzQC2zDc0V2Al8ExGDVQXbAogIgZ+AJcn1XwXSE7IK+LIdzU7+mFyj/hqGZyswF7hYZd9HCnCXer+HZ8/AcqDtR64TgGH+by5ZgGXUt+elAwwlCIA7wD21C+gBfm9X7F8g+I5XgF8gRAAAAABJRU5ErkJggg==";ResourceBag.KneeImplantPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJsSURBVEiJ3ZdNSFVBFIC/MS2NDH8yKlQywoVQSVEJQRAELWojRrgOEtqWkS1y36ZVq2hlQbuEiggJaxEUFLURTdDQtB8StB9Qoexr4Ty8Pl7qk6dCB4Z758w5850zf3cu/O+ilqhhLcDP1Y61AI+oQ2oNQN4qQQuAQuApUL9qYGAH8AkYAapWE1wVoasOrgRG1wJcDXwAvgIV/wSrpTkGpzIeB8oygtXjwKi6JYfg1BxPZASrR4BbwCSQvwLgH0DxvBa1TB1UG9Q+dVuuqOoXtTC+T8D8jNuBOyGEl7kCRlAhQAhhOqnPj40VQBNQl0tolCpmF9Y8SWV8CngYQvi5QuARADUPMAk+CnSvAHQeGNgOfIa5lVsNvF9KL2oLsCtW/wDXQgjflwiuAYZgLuN1wO+lgIGLwFgMtBHYvUCQATgMDEfVznTwGJDN9rkdQrgJfFwAWgB0ADPA/ag+CPQmwa+AhoTfa+ByFoGkQ4uATmZH8XQIYVrdCJwG7ibBD4DmxJ2oBTikXlgGtAToAt4BZ0MIqSlsBe6FEMbTHZ6ojYl6udqrNqfZ9atbEz4HEm3b1LdqW5pPbbz6lGeKtF4dSH6Z1Jp4TzqhlsYyoDaqx9Q38Vmq1sWgzqX1u1ntSSaVCd6mdqkbErr90XEwlm/qZKIMRX2f2pTWX2m8XV79JzQaBvWG2q2WLWi8iMQR7FFbs3G6FDM5E4+5bHwr1etxFE4uJ+K96qO4wK6o+9T1GezyY9t5tVMdVtvVTQv1v+gvhbqH2f13HKgFfgFTQFEsM0A/8AJ4BjxObKHlgzMEUszsGT8dQpjK1j8lfwEuS8lsb4uY/wAAAABJRU5ErkJggg==";ResourceBag.LayoutToolsPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFiSURBVEiJ7ZOxS1tRGEfPTZ8YaAkFQYcWCnFI6eYmmYK6GDo4dOhY/Au6di8OHbsIHbo5OEr2lqKuig4OgoIERNuQodDSTsehd7hb3kvSB8I7y3387u/7zoPHg4qK+4L6Qb1V35Qt/u0/9suUdtWBeqJ2y5Kuqlfqi7wDK+pHtTWBtK321aURvefR1QnqAJgDboBvY3jngDZwCAxHdDvAAjDIgGNgDfgKfCooXQS2gHfAaY6+wGvgCDVTmwWFqC31Uu0UnGuqD4r6UDfUc3WorhdeMC7qQfxPf02yJxtjZht4BnyeRJwbdV59P619tZzSBeALcD0tcS7UuvqyTOFMabJE2lTP1Pn/sT9T38bnHyGEnShdBXaBHvAE+B7zV8DT2N8OIfxVG8BmzC5CCL3YXQaWY94LIVzEfBNoZMDjePkneaGfwB7QB2aT/FHSD/GsJdnDpFtP8vSTNZK8oqJicu4AignOOMhNqFUAAAAASUVORK5CYII=";ResourceBag.ParallelLinePng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADOSURBVEiJ7c4hT8NgFIXh92ZTtYCdmKEaSSZAUI3c3xqS/4EhJHMkNTXoGUwFMxgQEy/mbmlwkLTqe9TJyc13PiiKovgv9VbdqJcTbNXqg3oT6h44Az6A15G3r4ELYD8HOuAOeAEeRx7+BtZAhzpTlyMPnqhLdTbVXlFMJ9T7zJ8RsQVQF8BV9m8Rsct+BZxn/xQRB7UCmuz6iGjztgbq7NuI6LNvgGoOHIffgW3mxaD/AnaZV4PHnoEDUA1uO6DNXP96u8/cDD5fFEXxdz/stlK8cEbMQQAAAABJRU5ErkJggg==";ResourceBag.PerpendicularLinePng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADfSURBVEiJ7ZCxSgNREEXPhCiytYUWJu1iYSGCTeqt/RVbK39J/IDU29ikTqHNCmIhgggWx8IRQhpZV6LIO81cLjP38h4UCoXfQt1Tz9XDTRdf+8HtkJzRN24ecj4OKe6NuqXeqwdDcnq/OCLegFfgeaPFP0UpLsV/p1gdAdvAzpDisXqW+iki5hk+AY7TX0TEMv0ZcAHsA1fAqVoBTe52EdHmbg3U6bcR0aXfANUY+Cy+A+apJyv+C7BMPQOOUk9zViu7N0Cbul7L7lI3wO7Xf7KGOlUv1ZPex4VC4V/xDno6VjAzjzJ6AAAAAElFTkSuQmCC";ResourceBag.Project3dPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAImSURBVFiF7ZZdaM5hGMZ/dzZHM+sV2U5ptpKlsNRY2jC0fJxJHIk0jig5VY6o7dCZEnLiTGlqFNPa8nnkK+RzwmTMgaz9HOwp8+7dy/siB96rnno+7vu6rue+n3/9oYQSSijhf0fkO1R3AkeAkb+gXQMM5BPfpF5Xq/60sromcWdyVkBtATqB1cAQ0Ao0AbXAAmAmUAlUpJQR4CMwDNxPoxfoiYjRLO7lwHGgLSIGJxlQG4ETwDpgFXAU+AL0AHeBB8B74FMaADPSyCSDdcn0dGB/RJxM3IuAM0B7RDzJdfOF6j21Lq1fqp1qWc5a5oFapnapL9J6fuJumBgXExLmAeeBbRFxM+3tAI4BozkqMMz3x1nBeFsyjLepHmgBpgEHgMtAN7ArIq5NMqDWABeBPRFxNfsmjLeiifHS1iaxKn58Ax+Y/AYuAbPTvCMiunOVqkodUNdPWc8ioVaqt9XhqWJCvQIsAQazzqqAz8DX3/EAnAU2RMTiwjL1tNpRlKrOnTA/rHYVQ7JV7Ssib6X6Sq1IX8JDtbkYA+XqM3VtATnN6mu1Pa13q70Fi08g3Kg+VWflialRW9VT6lu1Le3Xq+/UZUUbSESd6o2pTKhDar96SM2kvVr1UbFvKFsgkomftiPFblffqHt/WzyLfLP6WO1T96kN6hy1Wl2qHlTvqLfUFb/Km/d/IIeJcmAL0A40AtXAGPAc6AfOARciYqwQ3hJK+Kf4Blexh2oSat6MAAAAAElFTkSuQmCC";ResourceBag.RefLinePng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAACpSURBVEiJ7c2hEcJQEITh/zKYqHQAM6CDAQyDiUFTB1WAoZ44GkhsNDqaHhazzKSBRN1n3s69e28hpZRSSmlxkkpJB0nFAl2Fu8qQ1ANn4A28IqLz0g6o/WaIiNHzBqgAIqL1rAIa744RMXheAzvPO+AJ3IF+BWx9sQcuXsAPbs5fYHRugLVz67Oa7HbA4FwDV+fPpGuLpJOkh6T/Z7ORtHHXce6ulNL8fveLR+VnIVRgAAAAAElFTkSuQmCC";ResourceBag.ShoulderPng="data:image/png;base64,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";ResourceBag.SpinePng="data:image/png;base64,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";ResourceBag.StartPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAQAAAC7KEemAAABKUlEQVR4AY3RA8zdUBQA4DPbtuNkjo3ZRuzZjp15wcx4tm3GmI1otr/x12ua169R23sPI0mo5ZRDqokMhDDMZx/0EzJdqO4I2KOyTPEH+wTe6yXkvVDVAQV2qCRv/P4+KPBWdyH9sDLq2qe4bWoro/gllTTWQW9jLbDVNZ8V98lV2yw2UX9dNVcl7HHbC1/k881rDxwOV2T30/nQzgFZ7dYqhOb2ymKXJv5Pp6md8tmusVA40Ea2+inNT1s0FIrvQAOHpDmogZBY22ppViT2LVRyXJojKiYvNHFLmhsaJS908UqalzolLwz1XYGP9tvrgwLfDE62PA/w2TGDVFFZf4d9BswWil9QyiZ8dc5oNcT/p5oRTvuC9ckLqzwzQ32hZOa6pnhoWcH3X/ijn3kNVVXCAAAAAElFTkSuQmCC";ResourceBag.StemPng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHuSURBVFiFxZbBbw1RGEfPfXl9baraR0vYdMuuCYktIcHGXiI27P0DIiFWEok/wMbCQqzsSCoqsZJYIMRWQlC8FvVapXoseiVNM3emY94832pyf3PnnHvnTr6Bmkptq+26nl8E36+uqIvqzn7Dj6q/1IfqRfWVurtf8PPqb/XGurFL6nt1qm74Idfq8YbxI+qqeqFO+O0Iuak+Vy/H8b3q8vod6TV4Qr2jzqln49iOKHEtHsLpOsAD6mm1q15RWxvy43FHPlaBTKof1K/qtPpCXVKfqvPqA/VYxrzBuPK7aqOIE3IEXsfLW8B9YBdwALgHPAkhZK5OvQ6cCiEMFy8zp+LndKLknH3qrDpZCR4f9lM9WOL+UbWjnqwMLyugNuNZmSnLKTwkm6wp4B1wuOzEZk7WAFqpUB0BrgJvgT3AWAjBXgoEYDwBbwBvgAHgETAEnCsLLxL4EQFZdQYYA5ohhNV/Af+tvDOwDKR6eRPoVoVvRiDzFQATrO1Q5coTWAK2J7LxfggsAql/um0xr1VgIUegDXTrFvgObE1kozGvVeAbsCWRjcS8VoH5AoEv/RBI9fThfgh8BgYT2RDQqVug878FZkn3ghbwqW4Byd+B0q03q/K64TMAdS4jC8DLXggk/4ojvJ24ZyWEsNALgT/c41Zz5Zpp1wAAAABJRU5ErkJggg==";ResourceBag.OrthoPluginLanguageJson={en:{orthoTool:"Ortho",eFit:"eFit",cobbangleTool:"CobbAngle",calibrationTool:"Calibration",calibrationTool1:"Calibration",calibrationTool2:"Calibration",cervical:"Cervical",thoracic:"Thoracic",lumbar:"Lumbar",sacrum:"Sacrum",progression:"Progression",topToBottom:"Top to bottom",BottomToTop:"Bottom to top",clearAllVertebras:"Clear all vertebras",spineTool:"Vertebra Marks",spineTool1:"Vertebra Marks",SaveCalibrationBtn:"Save",CancelCalibrationBtn:"Cancel",HipImplantTool:"Hip Implant",KneeImplantTool:"Knee Implant",basicOrthoToolTitle:"BASIC",specializedToolTite:"SPECIALIZED",ReferenceLineTool:"Reference Line",ParallelLineTool:"Parallel Line",PerpendicularLineTool:"Perpendicular Line",AngularLineTool:"Angular Line",Project3DTool:"Project 3D template",Project3DToolImplant:"Project implant",Project3DToolBone:"Project bone",Project3DToolBoth:"Project Both",AlignmentTool:"eLign Tool",LayoutTool:"Layout Tool",AlignmentTool1:"eLign Tool",LayoutTool1:"Layout Tool",ShoulderImplantTool:"Shoulder Implant",ImageCalibrated:"Image calibrated",ImageNotCalibrated:"Image not calibrated"},es:{orthoTool:"Orto.",eFit:"eFit",cobbangleTool:"CobbAngle",calibrationTool:"Calibrador",calibrationTool1:"Calibrador",calibrationTool2:"Calibrador",cervical:"Cervical",thoracic:"Torácica",lumbar:"Lumbar",sacrum:"Sacro",progression:"Progresión",topToBottom:"Arriba a abajo",BottomToTop:"Abajo a arriba",clearAllVertebras:"Borrar todas las vertebras",spineTool:"Vertebra",spineTool1:"Vertebra",SaveCalibrationBtn:"Guardar",CancelCalibrationBtn:"Cancelar",HipImplantTool:"Impl. Cadera",KneeImplantTool:"Impl. Rodilla",basicOrthoToolTitle:"BASICO",specializedToolTite:"ESPECIALIZADO",ReferenceLineTool:"Reference Line",ParallelLineTool:"Parallel Line",PerpendicularLineTool:"Perpendicular Line",AngularLineTool:"Angular Line",Project3DTool:"Project 3D template",Project3DToolImplant:"Project implant",Project3DToolBone:"Project bone",Project3DToolBoth:"Project Both",AlignmentTool:"eLign Tool",LayoutTool:"Layout Tool",AlignmentTool1:"eLign Tool",LayoutTool1:"Layout Tool",ShoulderImplantTool:"Impl. Hombro"}};t.ResourceBag=ResourceBag})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(e){var n;(function(e){var n=Efferent.Frontend.WebClient;var o=Efferent.Frontend.WebClient.HttpUtils;class SettingsOrthoCissPane{constructor(t,e){this.favoriteImplants={};this.dataForm={};this.container=t;this.platform=e;this.selectedImplant=new Array}BuildUI(){this.treeContainer=document.createElement("div");n.DOMUtils.AddClass(this.treeContainer,"treeListContainer");this.selectsContainer=document.createElement("div");var e=document.createElement("h2");e.innerText="Favorite implants";const l=document.createElement("div");l.classList.add("wrapContent");l.appendChild(this.treeContainer);l.appendChild(this.selectsContainer);this.container.appendChild(l);this.treeListContainer=document.createElement("div");this.treeContainer.appendChild(e);this.treeContainer.appendChild(this.treeListContainer);this.levels=[{RootExpression:".Favorites",DisplayExpression:".Name"},{RootExpression:".Manufacturer",DisplayExpression:".Name"},{RootExpression:".Groups",DisplayExpression:".Name"},{RootExpression:".ProductLines",DisplayExpression:".Name"},{RootExpression:".Types",DisplayExpression:".Name"},{RootExpression:".ProductFamilies",DisplayExpression:".Name"}];try{var a=n.Utils.DecodeBase64(this.platform.GetSetting("favoriteImplants"));this.favoriteImplants=JSON.parse(a);this.fillfavoritesTree()}catch(t){this.favoriteImplants={};this.favoriteImplants["Favorites"]=[];this.treeListContainer.innerHTML="No favorites implants yet."}var r=(new t.Products.OrthoPlugin.ConfigOrthoForm).Create(this.selectsContainer,[this.dataForm]);this.selectOptions=document.getElementsByClassName("implantOption");this.newfavorite=document.getElementById("idNewfavorite");this.newfavorite.addEventListener("click",(()=>{this.resetSelects()}));this.addfavorite=document.getElementById("idAddfavorite");this.addfavorite.disabled=true;this.addfavorite.addEventListener("click",(()=>{this.favImplantName.value=this.favImplantName.value.trim();if(this.favImplantName.value!==""){var t=false;for(var e=0;e<this.favoriteImplants["Favorites"].length;e++){if(this.favoriteImplants["Favorites"][e].CustomName===encodeURIComponent(this.favImplantName.value)){t=true;n.Toaster.ShowToast("Favorite implant name already exists. Please input a different name.",n.Colors.Carrot,3);break}}if(!t){var o=this.selectedImplant[0]["Sizes"];var l=Object.keys(o)[0];try{var a={Name:encodeURIComponent(this.favImplantName.value),CustomName:encodeURIComponent(this.favImplantName.value),Manufacturer:[{Name:this.manufacturerSelect.value,Groups:[{Name:this.groupSelect.value,ProductLines:[{Name:encodeURIComponent(this.productLineSelect[this.productLineSelect.value].text),Types:[]}]}]}]};if(this.selectedImplant.length===1){a.Manufacturer[0].Groups[0].ProductLines[0].Types.push({Name:this.selectedImplant[0]["Type"],ProductFamilies:[{CustomName:this.favImplantName.value,Manufacturer:this.manufacturerSelect.value,Groups:this.groupSelect.value,ProductLines:encodeURIComponent(this.productLineSelect[this.productLineSelect.value].text),Type:this.selectedImplant[0]["Type"],Name:encodeURIComponent(this.selectedImplant[0]["Name"])}]})}else if(this.groupSelect.value==="Knee"&&this.selectedImplant.length===2){a.Manufacturer[0].Groups[0].ProductLines[0].Types.push({Name:"Knee femoral/tibial set",ProductFamilies:[]});for(var e=0;e<this.selectedImplant.length;e++){a.Manufacturer[0].Groups[0].ProductLines[0].Types[0].ProductFamilies.push({CustomName:this.favImplantName.value,Manufacturer:this.manufacturerSelect.value,Groups:this.groupSelect.value,ProductLines:encodeURIComponent(this.productLineSelect[this.productLineSelect.value].text),Type:this.selectedImplant[e]["Type"],Name:encodeURIComponent(this.selectedImplant[e]["Name"])})}}this.favoriteImplants["Favorites"].push(a);this.fillfavoritesTree();var r=JSON.stringify(this.favoriteImplants);var s=n.Utils.EncodeBase64(r);this.platform.SetSetting(40,"favoriteImplants",s,(()=>{n.Loader.Hide();n.Toaster.ShowToast("New favorite implant saved.",n.Colors.Emerald,3);this.fillfavoritesTree()}))}catch(t){n.Loader.Hide();n.Toaster.ShowToast("Error getting implant data",n.Colors.Orange,3.5)}}}else{n.Toaster.ShowToast("Please, input a name for the favorite implant.",n.Colors.Orange,3)}}));this.removefavorite=document.getElementById("idRemovefavorite");this.removefavorite.disabled=true;this.removefavorite.addEventListener("click",(()=>{n.Loader.Show();this.favoriteImplants["Favorites"].splice(this.indexToRemove,1);this.platform.SetSetting(40,"favoriteImplants",n.Utils.EncodeBase64(JSON.stringify(this.favoriteImplants)),(()=>{n.Loader.Hide();n.Toaster.ShowToast("favorite implant removed.",n.Colors.Emerald,3);this.resetSelects();this.fillfavoritesTree()}))}));this.newfavorite.addEventListener("click",(()=>{this.resetSelects()}));this.favImplantName=document.getElementById("idFavImplantName");this.manufacturerSelect=document.getElementById("idManufacturer");this.manufacturerSelect.onchange=()=>{if(this.manufacturerSelect.value!=="null"){n.Loader.Show();o.AjaxCall(n.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.manufacturerSelect.value+"/groups","GET",null,null,(t=>{var e=JSON.parse(t.response);this.reProcessSelects(this.groupSelect,1);for(var o=0;o<e.length;o++){var l=document.createElement("option");var a=e[o].replace(/[\[\]/]/g,"");l.value=a;l.innerText=a;this.groupSelect.appendChild(l)}this.removePlaceholderOption(this.manufacturerSelect);n.Loader.Hide()}),(()=>{n.Toaster.ShowToast("Could not get the template group list",n.Colors.Orange,3);n.Loader.Hide()}))}};this.groupSelect=document.getElementById("idGroup");this.groupSelect.disabled=true;this.groupSelect.onchange=()=>{if(this.groupSelect.value!=="null"){n.Loader.Show();o.AjaxCall(n.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.manufacturerSelect.value+"/groups/"+this.groupSelect.value+"/products","GET",null,null,(t=>{this.indexJsonObject=JSON.parse(t.response);var e=this.indexJsonObject["ProductLines"];e.sort(this.compareByName);this.reProcessSelects(this.productLineSelect,2);for(var o=0;o<e.length;o++){var l=document.createElement("option");var a=e[o]["Name"];l.value=o.toString();l.innerText=a;this.productLineSelect.appendChild(l)}this.removePlaceholderOption(this.groupSelect);n.Loader.Hide()}),(()=>{n.Toaster.ShowToast("Could not get the template group list",n.Colors.Orange,3);n.Loader.Hide()}))}};this.productLineSelect=document.getElementById("idProductLine");this.productLineSelect.disabled=true;this.productLineSelect.onchange=()=>{if(this.groupSelect.value!=="null"){var t=parseInt(this.productLineSelect.value);var e=this.indexJsonObject["ProductLines"][t]["ProductFamilies"];this.productTypes={};for(var n=0;n<e.length;n++){if(!this.productTypes.hasOwnProperty(e[n]["Type"])){this.productTypes[e[n]["Type"]]=[]}this.productTypes[e[n]["Type"]].push(e[n])}this.switchControlsForGroup();if(this.groupSelect.value==="Knee"){var o=document.createElement("option");o.value="Knee femoral/tibial set";o.innerText="Knee femoral/tibial set";this.typeSelect.appendChild(o);this.reProcessSelects(this.femoralComponentForKneeSelect,5);this.reProcessSelects(this.tibialComponentForKneeSelect,6);if(this.productTypes["Femoral Component"]){for(var n=0;n<this.productTypes["Femoral Component"].length;n++){var l=document.createElement("option");l.value=n.toString();l.innerText=this.productTypes["Femoral Component"][n]["Name"];this.femoralComponentForKneeSelect.appendChild(l)}}if(this.productTypes["Tibial Component"]){for(var n=0;n<this.productTypes["Tibial Component"].length;n++){var l=document.createElement("option");l.value=n.toString();l.innerText=this.productTypes["Tibial Component"][n]["Name"];this.tibialComponentForKneeSelect.appendChild(l)}}}else{this.reProcessSelects(this.typeSelect,3);for(var a in this.productTypes){if(this.productTypes.hasOwnProperty(a)){var r=document.createElement("option");r.value=a;r.innerText=a;this.typeSelect.appendChild(r)}}}this.removePlaceholderOption(this.productLineSelect)}};this.typeSelect=document.getElementById("idType");this.typeSelect.disabled=true;this.typeSelect.onchange=()=>{if(this.groupSelect.value!=="null"){this.reProcessSelects(this.productFamilySelect,4);for(var t=0;t<this.productTypes[this.typeSelect.value].length;t++){var e=document.createElement("option");e.value=t.toString();e.innerText=this.productTypes[this.typeSelect.value][t]["Name"];this.productFamilySelect.appendChild(e)}this.removePlaceholderOption(this.typeSelect)}};this.productFamilySelect=document.getElementById("idProductFamily");this.productFamilySelect.disabled=true;this.productFamilySelect.onchange=()=>{this.selectedImplant[0]=this.productTypes[this.typeSelect.value][parseInt(this.productFamilySelect.value)];this.addfavorite.disabled=false};this.femoralComponentForKneeSelect=n.Form.GetFieldFromForms(this.dataForm,"selectFemoralComponent").htmlElement;this.tibialComponentForKneeSelect=n.Form.GetFieldFromForms(this.dataForm,"selectTibialComponent").htmlElement;this.femoralComponentForKneeSelect.onchange=()=>{this.selectedImplant.push(this.productTypes["Femoral Component"][parseInt(this.femoralComponentForKneeSelect.value)])};this.tibialComponentForKneeSelect.onchange=()=>{this.selectedImplant.push(this.productTypes["Tibial Component"][parseInt(this.tibialComponentForKneeSelect.value)]);this.addfavorite.disabled=false};this.resetSelects()}switchControlsForGroup(){var t=n.Form.GetFieldFromForms(this.dataForm,"LabelProductFamily");var e=n.Form.GetFieldFromForms(this.dataForm,"selectProductFamily");var o=n.Form.GetFieldFromForms(this.dataForm,"LabelFemoralComponent");var l=n.Form.GetFieldFromForms(this.dataForm,"selectFemoralComponent");var a=n.Form.GetFieldFromForms(this.dataForm,"LabelTibialComponent");var r=n.Form.GetFieldFromForms(this.dataForm,"selectTibialComponent");if(this.groupSelect.value==="Knee"){t.htmlElement.style.display="none";e.htmlElement.style.display="none";e.htmlElement.nextElementSibling.style.display="none";l.htmlElement.nextElementSibling.style.display="block";o.htmlElement.style.display="inline-block";l.htmlElement.style.display="inline-block";a.htmlElement.style.display="inline-block";r.htmlElement.style.display="inline-block";l.htmlElement.disabled=false;r.htmlElement.disabled=false}else{t.htmlElement.style.display="inline-block";e.htmlElement.style.display="inline-block";e.htmlElement.nextElementSibling.style.display="block";l.htmlElement.nextElementSibling.style.display="none";o.htmlElement.style.display="none";l.htmlElement.style.display="none";a.htmlElement.style.display="none";r.htmlElement.style.display="none";l.htmlElement.disabled=true;r.htmlElement.disabled=true}}resetSelects(){this.favImplantName.value="";this.favImplantName.disabled=false;for(var t=0;t<this.selectOptions.length;t++){var e=this.selectOptions[t];e.innerHTML="";e.disabled=true}n.Loader.Show();o.AjaxCall(n.PlatformContext.PlatformUri+"/implants/manufacturers","GET",null,null,(t=>{var e=JSON.parse(t.response);this.reProcessSelects(this.manufacturerSelect,4);for(var o=0;o<e.length;o++){var l=document.createElement("option");var a=e[o].replace(/[\[\]/]/g,"");l.value=a;l.innerText=a;this.manufacturerSelect.appendChild(l)}n.Loader.Hide()}),(()=>{n.Toaster.ShowToast("Could not get the manufacturers list",n.Colors.Orange,3);n.Loader.Hide()}))}reProcessSelects(t,e){for(var n=e;n<this.selectOptions.length;n++){var o=this.selectOptions[n];o.innerHTML="";o.disabled=true}t.innerHTML="";this.selectedImplant=new Array;this.addfavorite.disabled=true;this.removefavorite.disabled=true;var l=document.createElement("option");l.value=null;l.innerText="-- Select an option --";t.appendChild(l);t.disabled=false}removePlaceholderOption(t){if(t.options[0].value==="null"){t.options[0].remove()}}compareByName(t,e){var n=t.Name.toUpperCase();var o=e.Name.toUpperCase();if(n>o)return 1;else if(n<o)return-1;else return 0}fillfavoritesTree(){if(this.favoriteImplants["Favorites"].length>0){this.treeListContainer.innerHTML="";this.tree=new Efferent.Frontend.WebClient.TreeList(this.favoriteImplants,this.levels,this.treeListContainer,(t=>{this.selectfavoriteImplant(t)}))}else{this.favoriteImplants={};this.favoriteImplants["Favorites"]=[];this.treeListContainer.innerHTML="No favorites implants yet."}}selectfavoriteImplant(t){this.favImplantName.value=t["CustomName"];this.favImplantName.disabled=true;var e=["Manufacturer","Groups","ProductLines","Type","Name"];for(var n=0;n<this.selectOptions.length;n++){if(t[e[n]]){var o=this.selectOptions[n];var l=document.createElement("option");l.innerText=decodeURIComponent(t[e[n]]);o.disabled=true;o.innerHTML="";o.appendChild(l)}}this.switchControlsForGroup();if(t["Groups"]==="Knee"){var a=this.selectOptions[5];var r=this.selectOptions[6];if(t["Type"]==="Femoral Component"){var s=document.createElement("option");s.innerText=decodeURIComponent(t["Name"]);a.innerHTML="";a.appendChild(s)}else if(t["Type"]==="Tibial Component"){var h=document.createElement("option");h.innerText=decodeURIComponent(t["Name"]);r.innerHTML="";r.appendChild(h)}a.disabled=true;r.disabled=true}this.addfavorite.disabled=true;this.removefavorite.disabled=false;for(var m=0;m<this.favoriteImplants["Favorites"].length;m++){if(decodeURIComponent(this.favoriteImplants["Favorites"][m].CustomName)===t["CustomName"]){this.indexToRemove=m;break}}}}e.SettingsOrthoCissPane=SettingsOrthoCissPane})(n=e.OrthoPlugin||(e.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;var n=Efferent.ClientViews.ImagingStudyView;let o;(function(t){t[t["None"]=0]="None";t[t["Calibration"]=1]="Calibration";t[t["InsertImplant"]=2]="InsertImplant";t[t["GlenosphereImplant"]=3]="GlenosphereImplant";t[t["GlenoidImplant"]=4]="GlenoidImplant";t[t["HumeralHeadImplant"]=5]="HumeralHeadImplant";t[t["FavImplant"]=6]="FavImplant";t[t["StemImplant"]=7]="StemImplant";t[t["AdjustImplant"]=8]="AdjustImplant";t[t["AdjustGlenosphereImplant"]=9]="AdjustGlenosphereImplant";t[t["AdjustGlenoidImplant"]=10]="AdjustGlenoidImplant";t[t["AdjustHumeralHeadImplant"]=11]="AdjustHumeralHeadImplant";t[t["AdjustStemImplant"]=12]="AdjustStemImplant"})(o=t.EActionShoulder||(t.EActionShoulder={}));let l;(function(t){t[t["Glenosphere"]=0]="Glenosphere";t[t["Glenoid"]=1]="Glenoid";t[t["Humeral_Head"]=2]="Humeral_Head";t[t["Stem"]=3]="Stem"})(l=t.EShoulderImplant||(t.EShoulderImplant={}));class ShoulderImplantController{constructor(e,n){this.Plugin=e;this.LegSide=t.EBodySide.Right;this.ActionShoulder=o.None;this.ActionsSummaryData={};this.ImplantsPerFamily={};this.DataWasLoaded={};this.manufacturers={};this.ImplantsPerFamily[l[l.Glenosphere]]=new Array;this.ImplantsPerFamily[l[l.Glenoid]]=new Array;this.ImplantsPerFamily[l[l.Humeral_Head]]=new Array;this.ImplantsPerFamily[l[l.Stem]]=new Array;this.ShoulderImplantView=new t.ShoulderImplantView(this,n)}LoadSvgGlenosphereOnViewport(t,n,o,a=false){var r=this.ShoulderImplantView.GetSelectManufacturerGlenosphere();var s=this.ShoulderImplantView.GetSelectProductLineGlenosphere();var h=this.ShoulderImplantView.GetSelectComponentFamilyGlenosphere();var m=this.implantGlenosphereLibrary.GetImplantTemplateForId(s,h,n);this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantManufacturer=r;this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantProductLine=s;this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantComponentFamily=h;this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantSize=n;try{var d=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.ShoulderImplantView.GetSelectManufacturerGlenosphere()+"/groups/shoulder/files/";this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantSvgUrl=d+m.templates.filter((t=>t.title==="AP"))[0].url;this.ShoulderAnnotation.OrthoGlenosphereImplant.LoadImplantFromSVG((()=>{if(Efferent.ClientViews.ImplantTemplateView.LandmarksManager.LandmarksAreComplete("Shoulder","Glenosphere","AP",this.ShoulderAnnotation.OrthoGlenosphereImplant.LandmarksTemplate,this.ShoulderAnnotation.OrthoGlenosphereImplant.LandmarkItems)){var n=this.ShoulderAnnotation.GetInitialGlenosphereImplantPosition();this.ActionsSummaryData["Code02Glenosphere"]={Code:"Code02Glenosphere",Description:"Glenosphere rotation: "+Math.round(this.ShoulderAnnotation.OrthoGlenosphereImplant.Rotation)+" deg"};this.ActionsSummaryData["Code03Glenosphere"]={Code:"Code03Glenosphere",Description:"Glenosphere implant size: "+this.GetImplantSizeName(this.ShoulderAnnotation.OrthoGlenosphereImplant,l.Glenosphere)};this.ShowSummary();this.ShoulderAnnotation.OrthoGlenosphereImplant.PositionX=parseFloat(n.X.toString());this.ShoulderAnnotation.OrthoGlenosphereImplant.PositionY=parseFloat(n.Y.toString());this.ShoulderAnnotation.OrthoGlenosphereImplant.Rotation=this.ShoulderAnnotation.OrthoGlenosphereImplant.WasRotated?this.ShoulderAnnotation.OrthoGlenosphereImplant.Rotation:this.ShoulderAnnotation.GetInitialGlenosphereImplantRotationAngle()*(180/Math.PI);if(a)this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",o);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The implant cannot be shown due to non-existent data.",e.Colors.Orange,3.5);this.ShoulderAnnotation.OrthoGlenosphereImplant.SetImplantImage(null);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}}),m.templates.filter((t=>t.title==="AP"))[0].content,m.templates.filter((t=>t.title==="AP"))[0].landmarks)}catch(t){e.Toaster.ShowToast("Error getting implant parsing data",e.Colors.Orange,3.5)}}LoadSvgGlenoidOnViewport(t,n,o,a=false){var r=this.ShoulderImplantView.GetSelectManufacturerGlenoid();var s=this.ShoulderImplantView.GetSelectProductLineGlenoid();var h=this.ShoulderImplantView.GetSelectComponentFamilyGlenoid();var m=this.implantGlenoidLibrary.GetImplantTemplateForId(s,h,n);this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantManufacturer=r;this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantProductLine=s;this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantComponentFamily=h;this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantSize=n;try{var d=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.ShoulderImplantView.GetSelectManufacturerGlenoid()+"/groups/shoulder/files/";this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantSvgUrl=d+m.templates.filter((t=>t.title==="AP"))[0].url;this.ShoulderAnnotation.OrthoGlenoidImplant.LoadImplantFromSVG((()=>{if(Efferent.ClientViews.ImplantTemplateView.LandmarksManager.LandmarksAreComplete("Shoulder","Glenoid","AP",this.ShoulderAnnotation.OrthoGlenoidImplant.LandmarksTemplate,this.ShoulderAnnotation.OrthoGlenoidImplant.LandmarkItems)){var n=this.ShoulderAnnotation.GetInitialGlenoidImplantPosition();this.ActionsSummaryData["Code02Glenoid"]={Code:"Code02Glenoid",Description:"Glenoid rotation: "+Math.round(this.ShoulderAnnotation.OrthoGlenoidImplant.Rotation)+" deg"};this.ActionsSummaryData["Code03Glenoid"]={Code:"Code03Glenoid",Description:"Glenoid implant size: "+this.GetImplantSizeName(this.ShoulderAnnotation.OrthoGlenoidImplant,l.Glenoid)};this.ShowSummary();this.ShoulderAnnotation.OrthoGlenoidImplant.PositionX=parseFloat(n.X.toString());this.ShoulderAnnotation.OrthoGlenoidImplant.PositionY=parseFloat(n.Y.toString());this.ShoulderAnnotation.OrthoGlenoidImplant.Rotation=this.ShoulderAnnotation.OrthoGlenoidImplant.WasRotated?this.ShoulderAnnotation.OrthoGlenoidImplant.Rotation:this.ShoulderAnnotation.GetInitialGlenoidImplantRotationAngle()*(180/Math.PI);if(a)this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",o);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The implant cannot be shown due to non-existent data.",e.Colors.Orange,3.5);this.ShoulderAnnotation.OrthoGlenoidImplant.SetImplantImage(null);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}}),m.templates.filter((t=>t.title==="AP"))[0].content,m.templates.filter((t=>t.title==="AP"))[0].landmarks)}catch(t){e.Toaster.ShowToast("Error getting implant parsing data",e.Colors.Orange,3.5)}}LoadSvgHumeralHeadOnViewport(t,o,a,r=false){var s=this.ShoulderImplantView.GetSelectManufacturerHumeralHead();var h=this.ShoulderImplantView.GetSelectProductLineHumeralHead();var m=this.ShoulderImplantView.GetSelectComponentFamilyHumeralHead();var d=this.implantHumeralHeadLibrary.GetImplantTemplateForId(h,m,o);this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantManufacturer=s;this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantProductLine=h;this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantComponentFamily=m;this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantSize=o;try{var u=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.ShoulderImplantView.GetSelectManufacturerHumeralHead()+"/groups/shoulder/files/";this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantSvgUrl=u+d.templates.filter((t=>t.title==="AP"))[0].url;this.ShoulderAnnotation.OrthoHumeralHeadImplant.LoadImplantFromSVG((()=>{if(Efferent.ClientViews.ImplantTemplateView.LandmarksManager.LandmarksAreComplete("Shoulder","Humeral Head","AP",this.ShoulderAnnotation.OrthoHumeralHeadImplant.LandmarksTemplate,this.ShoulderAnnotation.OrthoHumeralHeadImplant.LandmarkItems)){var o=this.ShoulderAnnotation.GetInitialHumeralHeadImplantPosition();this.ActionsSummaryData["Code02HumeralHead"]={Code:"Code02HumeralHead",Description:"Humeral Head rotation: "+Math.round(n.Geometry.CalculateRotate360(this.ShoulderAnnotation.OrthoHumeralHeadImplant.Rotation))+" deg"};this.ActionsSummaryData["Code03HumeralHead"]={Code:"Code03HumeralHead",Description:"Humeral Head implant size: "+this.GetImplantSizeName(this.ShoulderAnnotation.OrthoHumeralHeadImplant,l.Humeral_Head)};this.ShowSummary();this.ShoulderAnnotation.OrthoHumeralHeadImplant.PositionX=parseFloat(o.X.toString());this.ShoulderAnnotation.OrthoHumeralHeadImplant.PositionY=parseFloat(o.Y.toString());this.ShoulderAnnotation.OrthoHumeralHeadImplant.Rotation=this.ShoulderAnnotation.OrthoHumeralHeadImplant.WasRotated?this.ShoulderAnnotation.OrthoHumeralHeadImplant.Rotation:this.ShoulderAnnotation.GetInitialHumeralHeadImplantRotationAngle()*(180/Math.PI);if(r)this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",a);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The implant cannot be shown due to non-existent data.",e.Colors.Orange,3.5);this.ShoulderAnnotation.OrthoHumeralHeadImplant.SetImplantImage(null);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}}),d.templates.filter((t=>t.title==="AP"))[0].content,d.templates.filter((t=>t.title==="AP"))[0].landmarks)}catch(t){e.Toaster.ShowToast("Error getting implant parsing data",e.Colors.Orange,3.5)}}LoadSvgStemOnViewport(t,o,a,r=false){var s=this.ShoulderImplantView.GetSelectManufacturerStem();var h=this.ShoulderImplantView.GetSelectProductLineStem();var m=this.ShoulderImplantView.GetSelectComponentFamilyStem();var d=this.implantStemLibrary.GetImplantTemplateForId(h,m,o);this.ShoulderAnnotation.OrthoStemImplant.ImplantManufacturer=s;this.ShoulderAnnotation.OrthoStemImplant.ImplantProductLine=h;this.ShoulderAnnotation.OrthoStemImplant.ImplantComponentFamily=m;this.ShoulderAnnotation.OrthoStemImplant.ImplantSize=o;try{var u=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+this.ShoulderImplantView.GetSelectManufacturerStem()+"/groups/shoulder/files/";this.ShoulderAnnotation.OrthoStemImplant.ImplantSvgUrl=u+d.templates.filter((t=>t.title==="AP"))[0].url;this.ShoulderAnnotation.OrthoStemImplant.LoadImplantFromSVG((()=>{if(Efferent.ClientViews.ImplantTemplateView.LandmarksManager.LandmarksAreComplete("Shoulder","Stem","AP",this.ShoulderAnnotation.OrthoStemImplant.LandmarksTemplate,this.ShoulderAnnotation.OrthoStemImplant.LandmarkItems)){var o=this.ShoulderAnnotation.GetInitialStemImplantPosition();this.ActionsSummaryData["Code02Stem"]={Code:"Code02Stem",Description:"Stem rotation: "+Math.round(n.Geometry.CalculateRotate360(this.ShoulderAnnotation.OrthoStemImplant.Rotation))+" deg"};this.ActionsSummaryData["Code03Stem"]={Code:"Code03Stem",Description:"Stem implant size: "+this.GetImplantSizeName(this.ShoulderAnnotation.OrthoStemImplant,l.Stem)};this.ShowSummary();this.ShoulderAnnotation.OrthoStemImplant.PositionX=parseFloat(o.X.toString());this.ShoulderAnnotation.OrthoStemImplant.PositionY=parseFloat(o.Y.toString());this.ShoulderAnnotation.OrthoStemImplant.Rotation=this.ShoulderAnnotation.OrthoStemImplant.WasRotated?this.ShoulderAnnotation.OrthoStemImplant.Rotation:this.ShoulderAnnotation.GetInitialStemImplantRotationAngle()*(180/Math.PI);if(r)this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",a);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}else{e.Toaster.ShowToast("The implant cannot be shown due to non-existent data.",e.Colors.Orange,3.5);this.ShoulderAnnotation.OrthoStemImplant.SetImplantImage(null);t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}}),d.templates.filter((t=>t.title==="AP"))[0].content,d.templates.filter((t=>t.title==="AP"))[0].landmarks)}catch(t){e.Toaster.ShowToast("Error getting implant parsing data",e.Colors.Orange,3.5)}}ShowTextAndControl(t,e,n,o,l,a,r){var s=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var h=s.RendererPlugins[this.Plugin.PluginName];this.Controller.TopBarElement.PostActionShow=()=>{};this.ShoulderImplantView.OrthoFloatingBar.BuildForm(e,[n]);this.ShoulderImplantView.ShowValueLabel(t,o,l,r);this.ShoulderImplantView.ControlStatusMainButtons(h,a,this.ActionShoulder,this.ShoulderAnnotation);this.ShoulderImplantView.ControlUI();this.ShoulderImplantView.ControlButtonsMainWindow(h,this.ShoulderAnnotation,this.ActionShoulder)}GetImplantSizeName(t,e){var n;try{var o;switch(e){case l.Glenosphere:o=this.implantGlenosphereLibrary;break;case l.Glenoid:o=this.implantGlenoidLibrary;break;case l.Humeral_Head:o=this.implantHumeralHeadLibrary;break;case l.Stem:o=this.implantStemLibrary;break}var a=o.GetSizes(t.ImplantProductLine,t.ImplantComponentFamily);var r=a.filter((e=>e.id===t.ImplantSize))[0];n=r.size}catch(t){n=""}return n}WriteActionSummaryDataForEdition(){}ChangeLegSideForLoadData(){}RerenderImplantBySide(n){try{var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=o.RendererPlugins[this.Plugin.PluginName];var a=!this.Edition?l.CurrentAnnotation:l.LastAnnotationCreatedOrSelected;a.SetShoulderSide(n===t.EBodySide.Left?t.EShoulderTemplateSide.Left:t.EShoulderTemplateSide.Right);o.Context.Renderer.Render();o.Context.OverlayRenderer.Render()}catch(t){e.Utils.DebugConsoleLog(t)}}ActionCalibrate(){this.ActionShoulder=o.Calibration;this.Plugin.CalibrationOptionFromMainMenu=false;this.Plugin.Menu.ProcessCalibrationToolEvent(null,"calibrationTool","eFit",this.ShoulderAnnotation)}ClearDataImplants(t){switch(t){case l.Stem:this.ShoulderImplantView.SetSelectProductLineStem(["--"],["--"],"--");this.ShoulderImplantView.SetSelectComponentFamilyStem(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeStem([new e.ValuesUD("-","-")],"");break;case l.Glenosphere:this.ShoulderImplantView.SetSelectProductLineGlenosphere(["--"],["--"],"--");this.ShoulderImplantView.SetSelectComponentFamilyGlenosphere(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere([new e.ValuesUD("-","-")],"");break;case l.Glenoid:this.ShoulderImplantView.SetSelectProductLineGlenoid(["--"],["--"],"--");this.ShoulderImplantView.SetSelectComponentFamilyGlenoid(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeGlenoid([new e.ValuesUD("-","-")],"");break;case l.Humeral_Head:this.ShoulderImplantView.SetSelectProductLineHumeralHead(["--"],["--"],"--");this.ShoulderImplantView.SetSelectComponentFamilyHumeralHead(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead([new e.ValuesUD("-","-")],"");break}this.CleanImplant(t,true)}CleanImplant(t,n){var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var a=o.RendererPlugins[this.Plugin.PluginName];try{switch(t){case l.Glenosphere:if(!n)this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantManufacturer=undefined;this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantProductLine=undefined;this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantComponentFamily=undefined;this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantSize=undefined;this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantReadyForDraw=false;this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantSvgUrl=null;this.ShoulderAnnotation.OrthoGlenosphereImplant.AFemoralHeadOffset=0;this.ShoulderAnnotation.OrthoGlenosphereImplant.AFemoralHeadDiameter=undefined;break;case l.Glenoid:if(!n)this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantManufacturer=undefined;this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantProductLine=undefined;this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantComponentFamily=undefined;this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantSize=undefined;this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantReadyForDraw=false;this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantSvgUrl=null;break;case l.Humeral_Head:if(!n)this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantManufacturer=undefined;this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantProductLine=undefined;this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantComponentFamily=undefined;this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantSize=undefined;this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantReadyForDraw=false;this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantSvgUrl=null;break;case l.Stem:if(!n)this.ShoulderAnnotation.OrthoStemImplant.ImplantManufacturer=undefined;this.ShoulderAnnotation.OrthoStemImplant.ImplantProductLine=undefined;this.ShoulderAnnotation.OrthoStemImplant.ImplantComponentFamily=undefined;this.ShoulderAnnotation.OrthoStemImplant.ImplantSize=undefined;this.ShoulderAnnotation.OrthoStemImplant.ImplantReadyForDraw=false;this.ShoulderAnnotation.OrthoStemImplant.ImplantSvgUrl=null;break}}catch(t){e.Utils.DebugConsoleLog(t)}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render()}LoadDataPerManufacturer(n,o,a,r){if(o&&o!=="--"){var s=e.PlatformContext.PlatformUri+"/implants/manufacturers/"+o+"/groups/shoulder/families?patientSide="+t.EBodySide[this.LegSide]+"&ProductType="+l[n].replace("_"," ");switch(n){case l.Glenosphere:t.ImplantLibraryReader.LoadImplantLibrary(s,(s=>{this.implantGlenosphereLibrary=s;this.DataWasLoaded[o]={SideImplant:t.EBodySide[this.LegSide],ImplantType:l[n],Loaded:true,implantLibrary:s};var h=this.ShoulderAnnotation.OrthoGlenosphereImplant;var m=this.implantGlenosphereLibrary.GetProductLineNames();m.unshift("--");this.ShoulderImplantView.SetSelectProductLineGlenosphere(m,m,h.ImplantProductLine);if(!a&&h.ImplantComponentFamily!==null&&h.ImplantComponentFamily!==undefined){var d=this.implantGlenosphereLibrary.GetFamilyNames(h.ImplantProductLine);d.unshift("--");this.ShoulderImplantView.SetSelectComponentFamilyGlenosphere(d,d,h.ImplantComponentFamily)}else{this.ShoulderImplantView.SetSelectComponentFamilyGlenosphere(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Glenosphere,true)}this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantManufacturer=o;if(!a&&h.ImplantSize!==null&&h.ImplantSize!==undefined){this.implantGlenosphereLibrary.GetFamilySizes(h.ImplantProductLine,h.ImplantComponentFamily,t.EBodySide[this.LegSide],"shoulder","Glenosphere",(t=>{var n=new Array;for(var o=0;o<t.length;o++){this.ShoulderAnnotation.OrthoGlenosphereImplant.svgPoints[t[o].id]=new Array;n.push(new e.ValuesUD(t[o].id,t[o].size))}this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere(n,h.ImplantSize)}));if(r)r(o)}else{if(r)r(o)}}));break;case l.Glenoid:t.ImplantLibraryReader.LoadImplantLibrary(s,(s=>{this.implantGlenoidLibrary=s;this.DataWasLoaded[o]={SideImplant:t.EBodySide[this.LegSide],ImplantType:l[n],Loaded:true,implantLibrary:s};var h=this.ShoulderAnnotation.OrthoGlenoidImplant;var m=this.implantGlenoidLibrary.GetProductLineNames();m.unshift("--");this.ShoulderImplantView.SetSelectProductLineGlenoid(m,m,h.ImplantProductLine);if(!a&&h.ImplantComponentFamily!==null&&h.ImplantComponentFamily!==undefined){var d=this.implantGlenoidLibrary.GetFamilyNames(h.ImplantProductLine);d.unshift("--");this.ShoulderImplantView.SetSelectComponentFamilyGlenoid(d,d,h.ImplantComponentFamily)}else{this.ShoulderImplantView.SetSelectComponentFamilyGlenoid(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeGlenoid([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Glenoid,true)}this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantManufacturer=o;if(!a&&h.ImplantSize!==null&&h.ImplantSize!==undefined){this.implantGlenoidLibrary.GetFamilySizes(h.ImplantProductLine,h.ImplantComponentFamily,t.EBodySide[this.LegSide],"shoulder","Glenoid",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.ShoulderAnnotation.OrthoGlenoidImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.ShoulderImplantView.SetUpDownImplantSizeGlenoid(n,h.ImplantSize);if(r)r(o)}))}else{if(r)r(o)}}));break;case l.Humeral_Head:t.ImplantLibraryReader.LoadImplantLibrary(s,(s=>{this.implantHumeralHeadLibrary=s;this.DataWasLoaded[o]={SideImplant:t.EBodySide[this.LegSide],ImplantType:t.EHipImplant[n],Loaded:true,implantLibrary:s};var h=this.ShoulderAnnotation.OrthoHumeralHeadImplant;var m=this.implantHumeralHeadLibrary.GetProductLineNames();m.unshift("--");this.ShoulderImplantView.SetSelectProductLineHumeralHead(m,m,h.ImplantProductLine);if(!a&&h.ImplantComponentFamily!==null&&h.ImplantComponentFamily!==undefined){var d=this.implantHumeralHeadLibrary.GetFamilyNames(h.ImplantProductLine);d.unshift("--");this.ShoulderImplantView.SetSelectComponentFamilyHumeralHead(d,d,h.ImplantComponentFamily)}else{this.ShoulderImplantView.SetSelectComponentFamilyHumeralHead(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Humeral_Head,true)}this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantManufacturer=o;if(!a&&h.ImplantSize!==null&&h.ImplantSize!==undefined){this.implantHumeralHeadLibrary.GetFamilySizes(h.ImplantProductLine,h.ImplantComponentFamily,t.EBodySide[this.LegSide],"shoulder","Humeral Head",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.ShoulderAnnotation.OrthoHumeralHeadImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead(n,h.ImplantSize);if(r)r(o)}))}else{if(r)r(o)}}));break;case l.Stem:t.ImplantLibraryReader.LoadImplantLibrary(s,(s=>{this.implantStemLibrary=s;this.DataWasLoaded[o]={SideImplant:t.EBodySide[this.LegSide],ImplantType:t.EHipImplant[n],Loaded:true,implantLibrary:s};var h=this.ShoulderAnnotation.OrthoStemImplant;var m=this.implantStemLibrary.GetProductLineNames();m.unshift("--");this.ShoulderImplantView.SetSelectProductLineStem(m,m,h.ImplantProductLine);if(!a&&h.ImplantComponentFamily!==null&&h.ImplantComponentFamily!==undefined){var d=this.implantStemLibrary.GetFamilyNames(h.ImplantProductLine);d.unshift("--");this.ShoulderImplantView.SetSelectComponentFamilyStem(d,d,h.ImplantComponentFamily)}else{this.ShoulderImplantView.SetSelectComponentFamilyStem(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeStem([new e.ValuesUD("-","-")],"");this.CleanImplant(l.Stem,true)}this.ShoulderAnnotation.OrthoStemImplant.ImplantManufacturer=o;if(!a&&h.ImplantSize!==null&&h.ImplantSize!==undefined){this.implantStemLibrary.GetFamilySizes(h.ImplantProductLine,h.ImplantComponentFamily,t.EBodySide[this.LegSide],"shoulder","Stem",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.ShoulderAnnotation.OrthoStemImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.ShoulderImplantView.SetUpDownImplantSizeStem(n,h.ImplantSize);if(r)r(o)}))}else{if(r)r(o)}}));break}}}ActionProductLineGlenosphere(t){var n=this.implantGlenosphereLibrary.GetFamilyNames(this.ShoulderImplantView.GetSelectProductLineGlenosphere());var o=new Array;var l;if(n!==undefined){o=n;o.unshift("--");l=t===undefined?"--":t}else{o=["--"];o=["--"];l="--"}this.ShoulderImplantView.SetSelectComponentFamilyGlenosphere(o,o,l);var a=new Array;a.push(new e.ValuesUD("--","--"));this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere(a,null,0);if(!t&&o.length>=2){this.ShoulderImplantView.SetSelectComponentFamilyGlenosphere(o,o,o[1]);this.ActionComponentFamilyGlenosphere()}}ActionComponentFamilyGlenosphere(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=n.RendererPlugins[this.Plugin.PluginName];var a=this.ShoulderImplantView.GetSelectProductLineGlenosphere();var r=this.ShoulderImplantView.GetSelectComponentFamilyGlenosphere();if(r!==""&&r!=="--"){this.implantGlenosphereLibrary.GetFamilySizes(a,r,t.EBodySide[this.LegSide],"shoulder","Glenosphere",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.ShoulderAnnotation.OrthoGlenosphereImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere(n,null,Math.floor(n.length/2));var a=n[Math.floor(n.length/2)].Value;this.LoadSvgGlenosphereOnViewport(o,a,this.Edition)}))}else{var s=new Array;s.push(new e.ValuesUD("--","--"));this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere(s,null,0);this.CleanImplant(l.Glenosphere)}}ActionProductLineGlenoid(t){var n=this.implantGlenoidLibrary.GetFamilyNames(this.ShoulderImplantView.GetSelectProductLineGlenoid());var o=new Array;var l;if(n!==undefined){o=n;o.unshift("--");l=t===undefined?"--":t}else{o=["--"];o=["--"];l="--"}this.ShoulderImplantView.SetSelectComponentFamilyGlenoid(o,o,l);var a=new Array;a.push(new e.ValuesUD("--","--"));this.ShoulderImplantView.SetUpDownImplantSizeGlenoid(a,null,0);if(!t&&o.length>=2){this.ShoulderImplantView.SetSelectComponentFamilyGlenoid(o,o,o[1]);this.ActionComponentFamilyGlenoid()}}ActionComponentFamilyGlenoid(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=n.RendererPlugins[this.Plugin.PluginName];var a=this.ShoulderImplantView.GetSelectProductLineGlenoid();var r=this.ShoulderImplantView.GetSelectComponentFamilyGlenoid();if(r!==""&&r!=="--"){this.implantGlenoidLibrary.GetFamilySizes(a,r,t.EBodySide[this.LegSide],"shoulder","Glenoid",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.ShoulderAnnotation.OrthoGlenoidImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.ShoulderImplantView.SetUpDownImplantSizeGlenoid(n,null,Math.floor(n.length/2));var a=n[Math.floor(n.length/2)].Value;this.LoadSvgGlenoidOnViewport(o,a,this.Edition)}))}else{var s=new Array;s.push(new e.ValuesUD("--","--"));this.ShoulderImplantView.SetUpDownImplantSizeGlenoid(s,null,0);this.CleanImplant(l.Glenoid)}}ActionProductLineHumeralHead(t){var n=this.implantHumeralHeadLibrary.GetFamilyNames(this.ShoulderImplantView.GetSelectProductLineHumeralHead());var o=new Array;var l;if(n!==undefined){o=n;o.unshift("--");l=t===undefined?"--":t}else{o=["--"];o=["--"];l="--"}this.ShoulderImplantView.SetSelectComponentFamilyHumeralHead(o,o,l);var a=new Array;a.push(new e.ValuesUD("--","--"));this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead(a,null,0);if(!t&&o.length>=2){this.ShoulderImplantView.SetSelectComponentFamilyHumeralHead(o,o,o[1]);this.ActionComponentFamilyHumeralHead()}}ActionComponentFamilyHumeralHead(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=n.RendererPlugins[this.Plugin.PluginName];var a=this.ShoulderImplantView.GetSelectProductLineHumeralHead();var r=this.ShoulderImplantView.GetSelectComponentFamilyHumeralHead();if(r!==""&&r!=="--"){this.implantHumeralHeadLibrary.GetFamilySizes(a,r,t.EBodySide[this.LegSide],"shoulder","Humeral Head",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.ShoulderAnnotation.OrthoHumeralHeadImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead(n,null,Math.floor(n.length/2));var a=n[Math.floor(n.length/2)].Value;this.LoadSvgHumeralHeadOnViewport(o,a,this.Edition)}))}else{var s=new Array;s.push(new e.ValuesUD("--","--"));this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead(s,null,0);this.CleanImplant(l.Humeral_Head)}}ActionProductLineStem(t){var n=this.implantStemLibrary.GetFamilyNames(this.ShoulderImplantView.GetSelectProductLineStem());var o=new Array;var l;if(n!==undefined){o=n;o.unshift("--");l=t===undefined?"--":t}else{o=["--"];o=["--"];l="--"}this.ShoulderImplantView.SetSelectComponentFamilyStem(o,o,l);var a=new Array;a.push(new e.ValuesUD("--","--"));this.ShoulderImplantView.SetUpDownImplantSizeStem(a,null,0);if(!t&&o.length>=2){this.ShoulderImplantView.SetSelectComponentFamilyStem(o,o,o[1]);this.ActionComponentFamilyStem()}}ActionComponentFamilyStem(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=n.RendererPlugins[this.Plugin.PluginName];var a=this.ShoulderImplantView.GetSelectProductLineStem();var r=this.ShoulderImplantView.GetSelectComponentFamilyStem();if(r!==""&&r!=="--"){this.implantStemLibrary.GetFamilySizes(a,r,t.EBodySide[this.LegSide],"shoulder","Stem",(t=>{var n=new Array;for(var l=0;l<t.length;l++){this.ShoulderAnnotation.OrthoStemImplant.svgPoints[t[l].id]=new Array;n.push(new e.ValuesUD(t[l].id,t[l].size))}this.ShoulderImplantView.SetUpDownImplantSizeStem(n,null,Math.floor(n.length/2));var a=n[Math.floor(n.length/2)].Value;this.LoadSvgStemOnViewport(o,a,this.Edition)}))}else{var s=new Array;s.push(new e.ValuesUD("--","--"));this.ShoulderImplantView.SetUpDownImplantSizeStem(s,null,0);this.CleanImplant(l.Stem)}}ActionOkShoulderStatusInsertImplantGlenosphere(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.None;this.ShoulderImplantView.ViewTab();this.LoadSvgGlenosphereOnViewport(n,this.ShoulderImplantView.GetUpDownImplantSizeGlenosphere(),true);this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(n,this.ShoulderAnnotation,this.ActionShoulder);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}ActionCancelShoulderStatusInsertImplantGlenosphere(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition)l.LastAnnotationCreatedOrSelected=null;this.implantGlenosphereLibrary=null;this.ShoulderAnnotation.OrthoGlenosphereImplant=new t.OrthoTemplate(this.ShoulderAnnotation);this.ShoulderImplantView.SetSelectProductLineGlenosphere(["--"],["--"],"--");this.ShoulderImplantView.SetSelectComponentFamilyGlenosphere(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere([new e.ValuesUD("-","-")],"");this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.Calibration;this.ShoulderImplantView.ViewTab();this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(l,this.ShoulderAnnotation,this.ActionShoulder);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}ActionOkShoulderStatusInsertImplantGlenoid(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.None;this.ShoulderImplantView.ViewTab();this.LoadSvgGlenoidOnViewport(n,this.ShoulderImplantView.GetUpDownImplantSizeGlenoid(),true);this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(n,this.ShoulderAnnotation,this.ActionShoulder);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}ActionCancelShoulderStatusInsertImplantGlenoid(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition)l.LastAnnotationCreatedOrSelected=null;this.implantGlenoidLibrary=null;this.ShoulderAnnotation.OrthoGlenoidImplant=new t.OrthoTemplate(this.ShoulderAnnotation);this.ShoulderImplantView.SetSelectProductLineGlenoid(["--"],["--"],"--");this.ShoulderImplantView.SetSelectComponentFamilyGlenoid(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeGlenoid([new e.ValuesUD("-","-")],"");this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.Calibration;this.ShoulderImplantView.ViewTab();this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(l,this.ShoulderAnnotation,this.ActionShoulder);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}ActionOkShoulderStatusInsertImplantHumeralHead(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.None;this.ShoulderImplantView.ViewTab();this.LoadSvgHumeralHeadOnViewport(n,this.ShoulderImplantView.GetUpDownImplantSizeHumeralHead(),true);this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(n,this.ShoulderAnnotation,this.ActionShoulder);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}ActionCancelShoulderStatusInsertImplantHumeralHead(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition)l.LastAnnotationCreatedOrSelected=null;this.implantHumeralHeadLibrary=null;this.ShoulderAnnotation.OrthoHumeralHeadImplant=new t.OrthoTemplate(this.ShoulderAnnotation);this.ShoulderImplantView.SetSelectProductLineHumeralHead(["--"],["--"],"--");this.ShoulderImplantView.SetSelectComponentFamilyHumeralHead(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead([new e.ValuesUD("-","-")],"");this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.Calibration;this.ShoulderImplantView.ViewTab();this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(l,this.ShoulderAnnotation,this.ActionShoulder);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}ActionOkShoulderStatusInsertImplantStem(){var e=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var n=e.RendererPlugins[this.Plugin.PluginName];this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.None;this.ShoulderImplantView.ViewTab();this.LoadSvgStemOnViewport(n,this.ShoulderImplantView.GetUpDownImplantSizeStem(),true);this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(n,this.ShoulderAnnotation,this.ActionShoulder);n.Context.Renderer.Render();n.Context.OverlayRenderer.Render()}ActionCancelShoulderStatusInsertImplantStem(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition)l.LastAnnotationCreatedOrSelected=null;this.implantStemLibrary=null;this.ShoulderAnnotation.OrthoStemImplant=new t.OrthoTemplate(this.ShoulderAnnotation);this.ShoulderImplantView.SetSelectProductLineStem(["--"],["--"],"--");this.ShoulderImplantView.SetSelectComponentFamilyStem(["--"],["--"],"--");this.ShoulderImplantView.SetUpDownImplantSizeStem([new e.ValuesUD("-","-")],"");this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.Calibration;this.ShoulderImplantView.ViewTab();this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"CalibrationSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(l,this.ShoulderAnnotation,this.ActionShoulder);l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}ControlAdjustImplant(t,n){var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var a=o.RendererPlugins[this.Plugin.PluginName];var r=t.getAttribute("data-control");switch(r){case"rotate-cw":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.WasRotated=true;this.ShoulderAnnotation.OrthoGlenosphereImplant.Rotation=(this.ShoulderAnnotation.OrthoGlenosphereImplant.Rotation-1)%360;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.WasRotated=true;this.ShoulderAnnotation.OrthoGlenoidImplant.Rotation=(this.ShoulderAnnotation.OrthoGlenoidImplant.Rotation-1)%360;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.WasRotated=true;this.ShoulderAnnotation.OrthoHumeralHeadImplant.Rotation=(this.ShoulderAnnotation.OrthoHumeralHeadImplant.Rotation-1)%360;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.WasRotated=true;this.ShoulderAnnotation.OrthoStemImplant.Rotation=(this.ShoulderAnnotation.OrthoStemImplant.Rotation-1)%360;break}break;case"rotate-ccw":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.WasRotated=true;this.ShoulderAnnotation.OrthoGlenosphereImplant.Rotation=(this.ShoulderAnnotation.OrthoGlenosphereImplant.Rotation+1)%360;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.WasRotated=true;this.ShoulderAnnotation.OrthoGlenoidImplant.Rotation=(this.ShoulderAnnotation.OrthoGlenoidImplant.Rotation+1)%360;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.WasRotated=true;this.ShoulderAnnotation.OrthoHumeralHeadImplant.Rotation=(this.ShoulderAnnotation.OrthoHumeralHeadImplant.Rotation+1)%360;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.WasRotated=true;this.ShoulderAnnotation.OrthoStemImplant.Rotation=(this.ShoulderAnnotation.OrthoStemImplant.Rotation+1)%360;break}break;case"left-up":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetX-=1;this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetY-=1;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetX-=1;this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetY-=1;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetX-=1;this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetY-=1;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.OffsetX-=1;this.ShoulderAnnotation.OrthoStemImplant.OffsetY-=1;break}break;case"up-right":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetX+=1;this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetY-=1;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetX+=1;this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetY-=1;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetX+=1;this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetY-=1;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.OffsetX+=1;this.ShoulderAnnotation.OrthoStemImplant.OffsetY-=1;break}break;case"down-right":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetX+=1;this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetY+=1;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetX+=1;this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetY+=1;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetX+=1;this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetY+=1;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.OffsetX+=1;this.ShoulderAnnotation.OrthoStemImplant.OffsetY+=1;break}break;case"down-left":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetX-=1;this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetY+=1;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetX-=1;this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetY+=1;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetX-=1;this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetY+=1;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.OffsetX-=1;this.ShoulderAnnotation.OrthoStemImplant.OffsetY+=1;break}break;case"up":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetY-=1;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetY-=1;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetY-=1;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.OffsetY-=1;break}break;case"right":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetX+=1;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetX+=1;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetX+=1;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.OffsetX+=1;break}break;case"down":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetY+=1;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetY+=1;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetY+=1;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.OffsetY+=1;break}break;case"left":switch(n){case l.Glenosphere:this.ShoulderAnnotation.OrthoGlenosphereImplant.OffsetX-=1;break;case l.Glenoid:this.ShoulderAnnotation.OrthoGlenoidImplant.OffsetX-=1;break;case l.Humeral_Head:this.ShoulderAnnotation.OrthoHumeralHeadImplant.OffsetX-=1;break;case l.Stem:this.ShoulderAnnotation.OrthoStemImplant.OffsetX-=1;break}break;case"minus":switch(n){case l.Glenosphere:var s=e.Form.GetFieldFromForms(this.ShoulderImplantView.DataSection2,"upDownImplantSizeGlenosphere");var h=s.htmlElement["UpDownObject"];if(h.Index-1>=0){this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere(h.Items,null,h.Index-1);this.ActionIncreaseDecreaseSizeImplantGlenosphere(h.Item,a)}break;case l.Glenoid:var m=e.Form.GetFieldFromForms(this.ShoulderImplantView.DataSection2,"upDownImplantSizeGlenoid");var d=m.htmlElement["UpDownObject"];if(d.Index-1>=0){this.ShoulderImplantView.SetUpDownImplantSizeGlenoid(d.Items,null,d.Index-1);this.ActionIncreaseDecreaseSizeImplantGlenoid(d.Item,a)}break;case l.Humeral_Head:var u=e.Form.GetFieldFromForms(this.ShoulderImplantView.DataSection2,"upDownImplantSizeHumeralHead");var p=u.htmlElement["UpDownObject"];if(p.Index-1>=0){this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead(p.Items,null,p.Index-1);this.ActionIncreaseDecreaseSizeImplantHumeralHead(p.Item,a)}break;case l.Stem:var c=e.Form.GetFieldFromForms(this.ShoulderImplantView.DataSection2,"upDownImplantSizeStem");var A=c.htmlElement["UpDownObject"];if(A.Index-1>=0){this.ShoulderImplantView.SetUpDownImplantSizeStem(A.Items,null,A.Index-1);this.ActionIncreaseDecreaseSizeImplantStem(A.Item,a)}break}break;case"plus":switch(n){case l.Glenosphere:var C=e.Form.GetFieldFromForms(this.ShoulderImplantView.DataSection2,"upDownImplantSizeGlenosphere");var S=C.htmlElement["UpDownObject"];if(S.Index+1<S.Items.length){this.ShoulderImplantView.SetUpDownImplantSizeGlenosphere(S.Items,null,S.Index+1);this.ActionIncreaseDecreaseSizeImplantGlenosphere(S.Item,a)}break;case l.Glenoid:var g=e.Form.GetFieldFromForms(this.ShoulderImplantView.DataSection2,"upDownImplantSizeGlenoid");var I=g.htmlElement["UpDownObject"];if(I.Index+1<I.Items.length){this.ShoulderImplantView.SetUpDownImplantSizeGlenoid(I.Items,null,I.Index+1);this.ActionIncreaseDecreaseSizeImplantGlenoid(I.Item,a)}break;case l.Humeral_Head:var P=e.Form.GetFieldFromForms(this.ShoulderImplantView.DataSection2,"upDownImplantSizeHumeralHead");var f=P.htmlElement["UpDownObject"];if(f.Index+1<f.Items.length){this.ShoulderImplantView.SetUpDownImplantSizeHumeralHead(f.Items,null,f.Index+1);this.ActionIncreaseDecreaseSizeImplantHumeralHead(f.Item,a)}break;case l.Stem:var w=e.Form.GetFieldFromForms(this.ShoulderImplantView.DataSection2,"upDownImplantSizeStem");var b=w.htmlElement["UpDownObject"];if(b.Index+1<b.Items.length){this.ShoulderImplantView.SetUpDownImplantSizeStem(b.Items,null,b.Index+1);this.ActionIncreaseDecreaseSizeImplantStem(b.Item,a)}break}break}a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();let v;switch(n){case l.Glenosphere:v=this.ShoulderAnnotation.OrthoGlenosphereImplant;break;case l.Glenoid:v=this.ShoulderAnnotation.OrthoGlenoidImplant;break;case l.Humeral_Head:v=this.ShoulderAnnotation.OrthoHumeralHeadImplant;break;case l.Stem:v=this.ShoulderAnnotation.OrthoStemImplant;break}this.ShoulderImplantView.UpdateUIAdjustImplant(v,n)}ActionIncreaseDecreaseSizeImplantGlenosphere(t,e){var n=t.Value;this.LoadSvgGlenosphereOnViewport(e,n,this.Edition)}ActionIncreaseDecreaseSizeImplantGlenoid(t,e){var n=t.Value;this.LoadSvgGlenoidOnViewport(e,n,this.Edition)}ActionIncreaseDecreaseSizeImplantHumeralHead(t,e){var n=t.Value;this.LoadSvgHumeralHeadOnViewport(e,n,this.Edition)}ActionIncreaseDecreaseSizeImplantStem(t,e){var n=t.Value;this.LoadSvgStemOnViewport(e,n,this.Edition)}ActionAdjust(t){this.OpenTabImplantGlenosphere((()=>{this.ActionShoulder=o.AdjustImplant;this.ActionShoulder=o.AdjustGlenosphereImplant;if(t)this.ShoulderImplantView.BuildUIAdjustControl(this.ShoulderAnnotation,t);else this.ShoulderImplantView.BuildUIAdjustControl(this.ShoulderAnnotation,l.Glenosphere)}))}ActionOkShoulderStatusAdjustImplant(e){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.None;this.ShowTextAndControl(1,this.ShoulderImplantView.OrthoElementsSection1,"SectionButtonsA","","",this.Edition);this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(l,this.ShoulderAnnotation,this.ActionShoulder);e();l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}ActionCancelShoulderStatusAdjustImplant(e){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition)l.LastAnnotationCreatedOrSelected=null;this.ShoulderImplantView.IdDefault=t.ETemplateView[t.ETemplateView.AP];this.ActionShoulder=o.None;this.ShowTextAndControl(1,this.ShoulderImplantView.OrthoElementsSection1,"SectionButtonsA","","",this.Edition);this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"AcetabulumSection","","",this.Edition);this.ShowSummary();this.ShoulderImplantView.ControlButtonsMainWindow(l,this.ShoulderAnnotation,this.ActionShoulder);e();l.Context.Renderer.Render();l.Context.OverlayRenderer.Render()}ImplantInformation(t,o){try{switch(o){case l.Glenosphere:if(t.ImplantSize){this.ActionsSummaryData["Code02Glenosphere"]={Code:"Code02Glenosphere",Description:"Glenosphere rotation: "+Math.round(n.Geometry.CalculateRotate360(t.Rotation))+" deg"};this.ActionsSummaryData["Code03Glenosphere"]={Code:"Code03Glenosphere",Description:"Glenosphere implant size: "+this.GetImplantSizeName(t,l.Glenosphere)}}else{delete this.ActionsSummaryData["Code02Glenosphere"];delete this.ActionsSummaryData["Code03Glenosphere"]}break;case l.Glenoid:if(t.ImplantSize){this.ActionsSummaryData["Code02Glenoid"]={Code:"Code02Glenoid",Description:"Glenoid rotation: "+Math.round(n.Geometry.CalculateRotate360(t.Rotation))+" deg"};this.ActionsSummaryData["Code03Glenoid"]={Code:"Code03Glenoid",Description:"Glenoid implant size: "+this.GetImplantSizeName(t,l.Glenoid)}}else{delete this.ActionsSummaryData["Code02Glenoid"];delete this.ActionsSummaryData["Code03Glenoid"]}break;case l.Humeral_Head:if(t.ImplantSize){this.ActionsSummaryData["Code02HumeralHead"]={Code:"Code02HumeralHead",Description:"Humeral Head rotation: "+Math.round(n.Geometry.CalculateRotate360(t.Rotation))+" deg"};this.ActionsSummaryData["Code03HumeralHead"]={Code:"Code03HumeralHead",Description:"Humeral Head implant size: "+this.GetImplantSizeName(t,l.Humeral_Head)}}else{delete this.ActionsSummaryData["Code02HumeralHead"];delete this.ActionsSummaryData["Code03HumeralHead"]}break;case l.Stem:if(t.ImplantSize){this.ActionsSummaryData["Code02Stem"]={Code:"Code02Stem",Description:"Stem rotation: "+Math.round(n.Geometry.CalculateRotate360(t.Rotation))+" deg"};this.ActionsSummaryData["Code03Stem"]={Code:"Code03Stem",Description:"Stem implant size: "+this.GetImplantSizeName(t,l.Stem)}}else{delete this.ActionsSummaryData["Code02Stem"];delete this.ActionsSummaryData["Code03Stem"]}break}}catch(t){e.Utils.DebugConsoleLog(t)}this.ShowSummary()}LoadManufacturers(t,e,n,o){let l=false;if(this.manufacturers[o]){if(this.manufacturers[o].sideManufacturers&&this.manufacturers[o].sideManufacturers[n])l=true}if(!l){this.Plugin.GetManufacturers((e=>{if(!this.manufacturers[o])this.manufacturers[o]={};if(!this.manufacturers[o].sideManufacturers)this.manufacturers[o].sideManufacturers={};this.manufacturers[o].sideManufacturers[n]=e;t(e)}),e,n,o)}else{t(this.manufacturers[o].sideManufacturers[n])}}OpenTabImplantGlenosphere(e){var n,o;this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"GlenoSphereImplantSection","","",this.Edition);if(this.implantGlenosphereLibrary){if((n=this.manufacturers[l[l.Glenosphere].replace("_"," ")])===null||n===void 0?void 0:n.sideManufacturers[t.EBodySide[this.LegSide]]){var a=new Array;(o=this.manufacturers[l[l.Glenosphere].replace("_"," ")])===null||o===void 0?void 0:o.sideManufacturers[t.EBodySide[this.LegSide]].forEach((t=>a.push(t)));a.unshift("--");this.ShoulderImplantView.SetSelectManufacturerGlenosphere(a,a,this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantManufacturer)}this.ImplantInformation(this.ShoulderAnnotation.OrthoGlenosphereImplant,l.Glenosphere);if(e)e();return}this.LoadManufacturers((t=>{if(!this.implantGlenosphereLibrary){var n=new Array;t.forEach((t=>n.push(t)));n.unshift("--");this.ShoulderImplantView.SetSelectManufacturerGlenosphere(n,n,this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantManufacturer);if(this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantManufacturer){this.LoadDataPerManufacturer(l.Glenosphere,this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantManufacturer,false,(()=>{this.ImplantInformation(this.ShoulderAnnotation.OrthoGlenosphereImplant,l.Glenosphere);if(e)e()}))}else{if(e)e()}}}),"shoulder",t.EBodySide[this.LegSide],l[l.Glenosphere].replace("_"," "))}OpenTabImplantGlenoid(e){var n,o;this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"GlenoidImplantSection","","",this.Edition);if(this.implantGlenoidLibrary){if((n=this.manufacturers[l[l.Glenoid].replace("_"," ")])===null||n===void 0?void 0:n.sideManufacturers[t.EBodySide[this.LegSide]]){var a=new Array;(o=this.manufacturers[l[l.Glenoid].replace("_"," ")])===null||o===void 0?void 0:o.sideManufacturers[t.EBodySide[this.LegSide]].forEach((t=>a.push(t)));a.unshift("--");this.ShoulderImplantView.SetSelectManufacturerGlenoid(a,a,this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantManufacturer)}this.ImplantInformation(this.ShoulderAnnotation.OrthoGlenoidImplant,l.Glenoid);if(e)e();return}this.LoadManufacturers((t=>{if(!this.implantGlenoidLibrary){var n=new Array;t.forEach((t=>n.push(t)));n.unshift("--");this.ShoulderImplantView.SetSelectManufacturerGlenoid(n,n,this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantManufacturer);if(this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantManufacturer){this.LoadDataPerManufacturer(l.Glenoid,this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantManufacturer,false,(()=>{this.ImplantInformation(this.ShoulderAnnotation.OrthoGlenoidImplant,l.Glenoid);if(e)e()}))}}}),"shoulder",t.EBodySide[this.LegSide],l[l.Glenoid].replace("_"," "))}OpenTabImplantHumeralHead(e){var n,o;this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"HumeralHeadImplantSection","","",this.Edition);if(this.implantHumeralHeadLibrary){if((n=this.manufacturers[l[l.Humeral_Head].replace("_"," ")])===null||n===void 0?void 0:n.sideManufacturers[t.EBodySide[this.LegSide]]){var a=new Array;(o=this.manufacturers[l[l.Humeral_Head].replace("_"," ")])===null||o===void 0?void 0:o.sideManufacturers[t.EBodySide[this.LegSide]].forEach((t=>a.push(t)));a.unshift("--");this.ShoulderImplantView.SetSelectManufacturerHumeralHead(a,a,this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantManufacturer)}this.ImplantInformation(this.ShoulderAnnotation.OrthoHumeralHeadImplant,l.Humeral_Head);if(e)e();return}this.LoadManufacturers((t=>{if(!this.implantHumeralHeadLibrary){var n=new Array;t.forEach((t=>n.push(t)));n.unshift("--");this.ShoulderImplantView.SetSelectManufacturerHumeralHead(n,n,this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantManufacturer);if(this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantManufacturer){this.LoadDataPerManufacturer(l.Humeral_Head,this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantManufacturer,false,(()=>{this.ImplantInformation(this.ShoulderAnnotation.OrthoHumeralHeadImplant,l.Humeral_Head);if(e)e()}))}}}),"shoulder",t.EBodySide[this.LegSide],l[l.Humeral_Head].replace("_"," "))}OpenTabImplantStem(e){var n,o;this.ShowTextAndControl(2,this.ShoulderImplantView.OrthoElementsSection2,"StemImplantSection","","",this.Edition);if(this.implantStemLibrary){if((n=this.manufacturers[l[l.Stem].replace("_"," ")])===null||n===void 0?void 0:n.sideManufacturers[t.EBodySide[this.LegSide]]){var a=new Array;(o=this.manufacturers[l[l.Stem].replace("_"," ")])===null||o===void 0?void 0:o.sideManufacturers[t.EBodySide[this.LegSide]].forEach((t=>a.push(t)));a.unshift("--");this.ShoulderImplantView.SetSelectManufacturerStem(a,a,this.ShoulderAnnotation.OrthoStemImplant.ImplantManufacturer)}this.ImplantInformation(this.ShoulderAnnotation.OrthoStemImplant,l.Stem);if(e)e();return}this.LoadManufacturers((t=>{if(!this.implantStemLibrary){var n=new Array;t.forEach((t=>n.push(t)));n.unshift("--");this.ShoulderImplantView.SetSelectManufacturerStem(n,n,this.ShoulderAnnotation.OrthoStemImplant.ImplantManufacturer);if(this.ShoulderAnnotation.OrthoStemImplant.ImplantManufacturer){this.LoadDataPerManufacturer(l.Stem,this.ShoulderAnnotation.OrthoStemImplant.ImplantManufacturer,false,(()=>{this.ImplantInformation(this.ShoulderAnnotation.OrthoStemImplant,l.Stem);if(e)e()}))}}}),"shoulder",t.EBodySide[this.LegSide],l[l.Stem].replace("_"," "))}ShowSummary(){if(this.ShoulderAnnotation){if(this.ShoulderAnnotation.OrthoGlenosphereImplant&&!this.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantReadyForDraw){delete this.ActionsSummaryData["Code02Glenosphere"];delete this.ActionsSummaryData["Code03Glenosphere"]}if(this.ShoulderAnnotation.OrthoGlenoidImplant&&!this.ShoulderAnnotation.OrthoGlenoidImplant.ImplantReadyForDraw){delete this.ActionsSummaryData["Code02Glenoid"];delete this.ActionsSummaryData["Code03Glenoid"]}if(this.ShoulderAnnotation.OrthoStemImplant&&!this.ShoulderAnnotation.OrthoStemImplant.ImplantReadyForDraw){delete this.ActionsSummaryData["Code02Stem"];delete this.ActionsSummaryData["Code04Stem"]}if(this.ShoulderAnnotation.OrthoHumeralHeadImplant&&!this.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantReadyForDraw){delete this.ActionsSummaryData["Code02HumeralHead"];delete this.ActionsSummaryData["Code03HumeralHead"]}}this.ShoulderImplantView.BuildSummary(this.ActionsSummaryData)}ActionOkShoulderStatusNone(t){var o=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var l=o.RendererPlugins[this.Plugin.PluginName];if(!this.Edition){this.ShoulderAnnotation.Status=n.EAnnotationStatus.Complete;this.ShoulderAnnotation.Visible=true;this.UnSelectAllImplants();l.Annotations.push(this.ShoulderAnnotation);l.LastAnnotationCreatedOrSelected=null;this.Plugin.AnnotationDone(o);this.Plugin.Controller.View.Platform.Toolbar.DeselectAllButtons();if(t)t()}else{this.ShoulderAnnotation.Visible=true;const annotationDoneCallback=()=>{e.Toaster.ShowToast("Last changes were saved.",e.Colors.Emerald,5)};l.CurrentAnnotation=this.ShoulderAnnotation;this.Plugin.AnnotationDone(o,annotationDoneCallback);if(t)t()}this.ShoulderAnnotation.Selected=true;this.UnSelectAllImplants();this.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool")}UnSelectAllImplants(){Object.keys(this.ShoulderAnnotation).forEach((e=>{if(this.ShoulderAnnotation[e]instanceof t.OrthoTemplate){if(this.ShoulderAnnotation[e]){this.ShoulderAnnotation[e].Hover=false;this.ShoulderAnnotation[e].Selected=false}}}))}ActionCancelShoulderStatusNone(){var n=this.Controller.GetSelectViewport(this.Controller.ViewportPane);var o=n.RendererPlugins[this.Plugin.PluginName];if(!this.Edition){var l={Action:()=>{o.LastAnnotationCreatedOrSelected=null;this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.Plugin.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Id);this.Plugin.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar=null;this.Plugin.Menu.CancelShoulderImplant(this.ShoulderAnnotation);this.Plugin.Controller.View.Platform.Toolbar.DeselectAllButtons();this.UnSelectAllImplants();this.Controller.SelectDefaultTool()},Name:"Ok",Text:"Yes",Id:"btnOkCancelHipImplant"};var a={Action:()=>{},Name:"Cancel",Text:"No",Id:"btnCancelCancelHipImplant"};l.ClassNames=[t.ButtonClasses.SUCCESS];a.ClassNames=[t.ButtonClasses.CRITIC];var r=new e.MessageBox("Do you want to cancel the whole operation?",[l,a]);r.Show()}else{o.LastAnnotationCreatedOrSelected=null;this.Plugin.ManagementFloatingBar.RemoveFloatingBar(this.Plugin.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar.Id);this.Plugin.ShoulderImplantController.ShoulderImplantView.OrthoFloatingBar=null;this.Plugin.Menu.CancelShoulderImplant(this.ShoulderAnnotation);this.Controller.SelectDefaultTool()}}static Create(o,l,a,r=[0],s){var h;var m=new ShoulderImplantController(o,s);m.Controller=o.Controller;m.ShoulderAnnotation=l;m.StatusDraw=false;m.Edition=a;m.Controller.ActiveContextMenu=false;if(m.ShoulderAnnotation){m.LegSide=t.EBodySide[m.ShoulderAnnotation.GetShoulderSide()]==="Left"?t.EBodySide.Left:t.EBodySide.Right;m.ShoulderImplantView.BuildUI()}m.ShoulderImplantView.BuildViewSide();m.ShoulderImplantView.BuildShowDesign();var d=m.Controller.GetSelectViewport(m.Controller.ViewportPane);m.InitialViewportStart=d;if(d===null)return;var u=d.RendererPlugins[o.PluginName];if(a){u.Context.AnnotationController=new n.AnnotationController(m.ShoulderAnnotation);m.WriteActionSummaryDataForEdition();document.querySelector("#BtnShowHide").style.display="block"}else{if(u.CurrentAnnotation===null||u.CurrentAnnotation===undefined){u.CurrentAnnotation=(h=m.ShoulderAnnotation)!==null&&h!==void 0?h:new t.ShoulderImplantAnnotation;u.CurrentAnnotation.Context=d.Context;u.CurrentAnnotation.Id=e.Utils.GetGuid();u.CurrentAnnotation.Selected=false;u.CurrentAnnotation.Status=n.EAnnotationStatus.New;u.CurrentAnnotation.Author=sessionStorage["userEmail"];u.CurrentAnnotation.Date=new Date;u.CurrentAnnotation.Plugin=o.PluginName;u.CurrentAnnotation["new"]=true;m.ShoulderAnnotation=u.CurrentAnnotation;u.Context.AnnotationController=new n.AnnotationController(u.CurrentAnnotation)}}m.ShoulderImplantView.InitFormDataAndEvents(m.ShoulderAnnotation,r,u,a);t.OrthoPlugin.ShoulderImplantControlerStaticInstance=m;return m}}t.ShoulderImplantController=ShoulderImplantController})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(Vue){var Products;(function(Products){var OrthoPlugin;(function(OrthoPlugin){var WebClient=Efferent.Frontend.WebClient;var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;var ImagingStudyView=Efferent.ClientViews.ImagingStudyView;const{div:div,h3:h3,label:label,input:input,ul:ul,li:li,img:img,button:button}=DOMUtils;class ShoulderImplantView{constructor(t,e){this.controller=t;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.orthoToolWindow=new OrthoPlugin.OrthoToolWindow(e,(()=>{this.controller.ActionCancelShoulderStatusNone()}));this.BuildUI()}BuildUI(){this.orthoToolWindow.InitComponents();this.OrthoFloatingBar=this.controller.Plugin.ManagementFloatingBar.CreateFloatingBar(document.body,"orthoCissDialog",true,"ShoulderTool",(()=>{this.controller.Controller.ResizeViewports()}));this.orthoToolWindow.RightTopSection.className="rightTopSection";this.orthoToolWindow.RightTopSection.appendChild(div({className:"iconImage",style:{backgroundImage:`url('${OrthoPlugin.ResourceBag.ShoulderPng}')`}}));this.orthoToolWindow.OuterContainer.className="middleSection";this.inputLeftSide=input({type:"radio",name:"radioBtnSide",id:"bbSideLeft",value:"Left",checked:this.controller.LegSide===OrthoPlugin.EBodySide.Left&&this.orthoToolWindow.OuterContainer.style.overflow!=="hidden",onchange:t=>{var e=t.target;if(e.value==="Left"){var n=this.controller.LegSide;this.controller.LegSide=OrthoPlugin.EBodySide.Left;if(n!==OrthoPlugin.EBodySide.Left)this.controller.ChangeLegSideForLoadData()}this.controller.RerenderImplantBySide(OrthoPlugin.EBodySide.Left);this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.OrthoFloatingBar.Element.querySelector("#BtnShowHide").style.display="block";DOMUtils.SetStyles(this.orthoToolWindow.OuterContainer,{height:"auto",overflow:"visible"});this.orthoToolWindow.MainSection.querySelector(".margin").style.minHeight="max(calc(100% - 20px), 550px)"}});this.inputRightSide=input({type:"radio",name:"radioBtnSide",id:"bbSideRight",value:"Right",checked:this.controller.LegSide===OrthoPlugin.EBodySide.Right&&this.orthoToolWindow.OuterContainer.style.overflow!=="hidden",onchange:t=>{var e=t.target;if(e.value==="Right"){var n=this.controller.LegSide;this.controller.LegSide=OrthoPlugin.EBodySide.Right;if(n!==OrthoPlugin.EBodySide.Right)this.controller.ChangeLegSideForLoadData()}this.controller.RerenderImplantBySide(OrthoPlugin.EBodySide.Right);this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.OrthoFloatingBar.Element.querySelector("#BtnShowHide").style.display="block";DOMUtils.SetStyles(this.orthoToolWindow.OuterContainer,{height:"auto",overflow:"visible"});this.orthoToolWindow.MainSection.querySelector(".margin").style.minHeight="max(calc(100% - 20px), 550px)"}});const t=div({className:"h3",innerHTML:"Shoulder implant"});const e=div({children:[div({className:"label",innerHTML:"Laterality: "}),div({className:"buttonbar",children:[this.inputRightSide,label({htmlFor:"bbSideRight",innerHTML:"Right"}),this.inputLeftSide,label({htmlFor:"bbSideLeft",innerHTML:"Left"})]})]});this.orthoToolWindow.LeftTopSection.className="leftTopSection";this.orthoToolWindow.LeftTopSection.appendChild(t);this.orthoToolWindow.LeftTopSection.appendChild(e);this.spaceTab=div({className:"content"});this.orthoToolWindow.TabsContainer.style.display="flex";this.orthoToolWindow.TabsContainer.appendChild(this.spaceTab);this.orthoToolWindow.MainSection.appendChild(div({className:"margin",children:[div({className:"topSection",children:[this.orthoToolWindow.LeftTopSection,this.orthoToolWindow.RightTopSection]}),this.orthoToolWindow.SelectSideMessage,this.orthoToolWindow.CloseFirstDialogContainer,this.orthoToolWindow.OuterContainer]}));this.OrthoFloatingBar.Element.innerHTML="";this.OrthoFloatingBar.Element.style.height="auto";this.OrthoFloatingBar.MinHeight=510;this.OrthoFloatingBar.Element.appendChild(this.orthoToolWindow.MainSection);this.OrthoFloatingBar.SetContentBox(this.orthoToolWindow.ActionsSummaryContainer);this.orthoToolWindow.ButtonsElementsContainer.style.removeProperty("height")}BuildViewSide(){let t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);let e=t.RendererPlugins[this.controller.Plugin.PluginName];let n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;const o=input({type:"radio",name:"radioBtnView",id:"bbSideAP",value:"AP",checked:!n||n&&n.ViewDirection===OrthoPlugin.EViewCiss.AP,onchange:o=>{t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);e=t.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;var l=o.target;if(l.value==="AP")n.ViewDirection=OrthoPlugin.EViewCiss.AP;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}});const l=input({type:"radio",name:"radioBtnView",id:"bbSidePA",value:"PA",checked:n&&n.ViewDirection===OrthoPlugin.EViewCiss.PA,onchange:o=>{t=this.controller.Plugin.Controller.GetSelectViewport(this.controller.Plugin.Controller.ViewportPane);e=t.RendererPlugins[this.controller.Plugin.PluginName];n=!this.controller.Edition?e.CurrentAnnotation:e.LastAnnotationCreatedOrSelected;var l=o.target;if(l.value==="PA")n.ViewDirection=OrthoPlugin.EViewCiss.PA;t.Context.Renderer.Render();t.Context.OverlayRenderer.Render()}});const a=div({children:[label({innerHTML:"Orientation: "}),div({className:"buttonbar",children:[o,label({htmlFor:"bbSideAP",innerHTML:"AP"}),l,label({htmlFor:"bbSidePA",innerHTML:"PA"})]})]});this.orthoToolWindow.LeftTopSection.appendChild(a)}ValidateViewportStarted(){var t=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var e=true;if(t.Id!==this.controller.InitialViewportStart.Id){var n=this.controller.InitialViewportStart.RendererPlugins[this.controller.Plugin.PluginName];this.controller.StatusDraw=false;this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.Calibration;this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"default");n.Context.AnnotationController.ResetOnlyCurrentGroup();n.Context.AnnotationController.CurrentGroup=null;this.controller.ShowTextAndControl(2,this.OrthoElementsSection2,"CalibrationSection","","",this.controller.Edition);this.GetButtonsForm().forEach((t=>{t.disabled=true}));n.Context.Renderer.Render();n.Context.OverlayRenderer.Render();WebClient.Toaster.ShowToast("Please remain on the active viewport to continue editing.",WebClient.Colors.GreenSea,5);e=false}return e}GetButtonsForm(){var t=new Array;var e=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnGlenosphereAction").htmlElement;var n=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnGlenoidAction").htmlElement;var o=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnStemAction").htmlElement;var l=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnHumeralHeadAction").htmlElement;var a=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAdjust").htmlElement;var r=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavorites").htmlElement;t.push(...[e,n,o,l,a,r]);return t}ControlStatusMainButtons(t,e,n,o){var l=t.Context.ImageEntity.IsCalibrated();var a=this.DataSection1[0]["forms"][0];var r=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnGlenosphereAction").htmlElement;var s=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnGlenoidAction").htmlElement;var h=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnStemAction").htmlElement;var m=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnHumeralHeadAction").htmlElement;var d=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAdjust").htmlElement;var u=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavorites").htmlElement;r.disabled=!l;s.disabled=!l;h.disabled=!l;m.disabled=!l;d.disabled=!l;u.disabled=!l;this.ControlTabContent(n);this.cleanClassColorOfButtonDisabled(a)}BuildSummary(t){const e=div({innerHTML:"Measurements :",style:{fontWeight:"bold",marginBottom:"8px"}});const sortObject=t=>Object.keys(t).sort().reduce(((e,n)=>(e[n]=t[n],e)),{});t=sortObject(t);const n=ul({children:Object.keys(t).map((e=>li({className:"blinkOnce",innerHTML:t[e].Description})))});this.orthoToolWindow.ActionsSummaryContainer.innerHTML="";this.orthoToolWindow.ActionsSummaryContainer.appendChild(e);this.orthoToolWindow.ActionsSummaryContainer.appendChild(n);this.orthoToolWindow.ActionsSummaryContainer.focus();this.orthoToolWindow.ActionsSummaryContainer.scrollTop=this.orthoToolWindow.ActionsSummaryContainer.clientHeight}ControlButtonsMainWindow(t,e,n){const o=this.DataSection1[0]["forms"][0];var l=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAp").htmlElement;var a=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnFavorites").htmlElement;var r=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnGlenosphereAction").htmlElement;var s=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnGlenoidAction").htmlElement;var h=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnStemAction").htmlElement;var m=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnHumeralHeadAction").htmlElement;var d=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAdjust").htmlElement;const cleanGroup=t=>{for(var e=0;e<t.GetFields().length;e++){var n=t.GetFields()[e].htmlElement;DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.ACTIVE);DOMUtils.AddClass(n,OrthoPlugin.ButtonClasses.ENABLE)}};cleanGroup(o);switch(n){case OrthoPlugin.EActionShoulder.None:case OrthoPlugin.EActionShoulder.Calibration:DOMUtils.RemoveClass(l,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(l,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionShoulder.AdjustImplant:case OrthoPlugin.EActionShoulder.AdjustGlenosphereImplant:DOMUtils.RemoveClass(d,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(d,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionShoulder.GlenosphereImplant:DOMUtils.RemoveClass(r,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(r,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionShoulder.GlenoidImplant:DOMUtils.RemoveClass(s,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(s,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionShoulder.StemImplant:DOMUtils.RemoveClass(h,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(h,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionShoulder.HumeralHeadImplant:DOMUtils.RemoveClass(m,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(m,OrthoPlugin.ButtonClasses.ACTIVE);break;case OrthoPlugin.EActionShoulder.FavImplant:DOMUtils.RemoveClass(a,OrthoPlugin.ButtonClasses.ENABLE);DOMUtils.AddClass(a,OrthoPlugin.ButtonClasses.ACTIVE);break}const u=button({innerHTML:"Generate report",className:`${OrthoPlugin.ButtonClasses.SUCCESS} inline`,type:"button",disabled:true,onclick:t=>{}});const p=button({innerHTML:this.controller.Edition?"Close":"Cancel",className:`${OrthoPlugin.ButtonClasses.CRITIC} inline`,type:"button",onclick:t=>{this.controller.ActionCancelShoulderStatusNone()}});const c=button({innerHTML:"Save",className:`${OrthoPlugin.ButtonClasses.SUCCESS} inline`,type:"button",onclick:t=>{this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.ActionOkShoulderStatusNone();p.innerHTML="Close";this.controller.Edition=true}});let A=[];A.push(c);if(WebClient.Utils.CheckNotAllowTag("guest")){A.push(u)}else{c.style.flexGrow="2";p.style.flexGrow="2"}A.push(p);DOMUtils.SetOptions(this.orthoToolWindow.ActionsWindowContainer,{innerHTML:"",children:A});this.ControlStatusMainButtons(t,this.controller.Edition,n,e)}ResetGlenosphereSelection(t=false){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenosphere");var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineGlenosphere");var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyGlenosphere");var l=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var a=l.RendererPlugins[this.controller.Plugin.PluginName];n.htmlElement.selectedIndex=0;o.htmlElement.selectedIndex=0;this.SetSelectComponentFamilyGlenosphere(["--"],["--"],"--");this.SetUpDownImplantSizeGlenosphere([new WebClient.ValuesUD("-","-")],"");e.htmlElement.disabled=false;n.htmlElement.disabled=false;o.htmlElement.disabled=false;if(!t){e.htmlElement.selectedIndex=0;this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantManufacturer=undefined;this.SetSelectProductLineGlenosphere(["--"],["--"],"--")}this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantProductLine=undefined;this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantComponentFamily=undefined;this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantSize=undefined;this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantReadyForDraw=false;this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantSvgUrl=null;a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();delete this.controller.ActionsSummaryData["Code02Glenosphere"];delete this.controller.ActionsSummaryData["Code03Glenosphere"];this.controller.ShowSummary()}ResetGlenoidSelection(t=false){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenoid");var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineGlenoid");var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyGlenoid");var l=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var a=l.RendererPlugins[this.controller.Plugin.PluginName];n.htmlElement.selectedIndex=0;o.htmlElement.selectedIndex=0;this.SetSelectComponentFamilyGlenoid(["--"],["--"],"--");this.SetUpDownImplantSizeGlenoid([new WebClient.ValuesUD("-","-")],"");e.htmlElement.disabled=false;n.htmlElement.disabled=false;o.htmlElement.disabled=false;if(!t){e.htmlElement.selectedIndex=0;this.controller.ShoulderAnnotation.OrthoGlenoidImplant.ImplantManufacturer=undefined;this.SetSelectProductLineGlenoid(["--"],["--"],"--")}this.controller.ShoulderAnnotation.OrthoGlenoidImplant.ImplantProductLine=undefined;this.controller.ShoulderAnnotation.OrthoGlenoidImplant.ImplantComponentFamily=undefined;this.controller.ShoulderAnnotation.OrthoGlenoidImplant.ImplantSize=undefined;this.controller.ShoulderAnnotation.OrthoGlenoidImplant.ImplantReadyForDraw=false;this.controller.ShoulderAnnotation.OrthoGlenoidImplant.ImplantSvgUrl=null;a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();delete this.controller.ActionsSummaryData["Code02Glenoid"];delete this.controller.ActionsSummaryData["Code03Glenoid"];this.controller.ShowSummary()}ResetHumeralHeadSelection(t=false){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerHumeralHead");var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineHumeralHead");var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyHumeralHead");var l=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var a=l.RendererPlugins[this.controller.Plugin.PluginName];n.htmlElement.selectedIndex=0;o.htmlElement.selectedIndex=0;this.SetSelectComponentFamilyHumeralHead(["--"],["--"],"--");this.SetUpDownImplantSizeHumeralHead([new WebClient.ValuesUD("-","-")],"");e.htmlElement.disabled=false;n.htmlElement.disabled=false;o.htmlElement.disabled=false;if(!t){e.htmlElement.selectedIndex=0;this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantManufacturer=undefined;this.SetSelectProductLineHumeralHead(["--"],["--"],"--")}this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantProductLine=undefined;this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantComponentFamily=undefined;this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantSize=undefined;this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantReadyForDraw=false;this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantSvgUrl=null;a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();delete this.controller.ActionsSummaryData["Code02HumeralHead"];delete this.controller.ActionsSummaryData["Code03HumeralHead"];this.controller.ShowSummary()}ResetStemSelection(t=false){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");var l=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var a=l.RendererPlugins[this.controller.Plugin.PluginName];n.htmlElement.selectedIndex=0;o.htmlElement.selectedIndex=0;this.SetSelectComponentFamilyStem(["--"],["--"],"--");this.SetUpDownImplantSizeStem([new WebClient.ValuesUD("-","-")],"");e.htmlElement.disabled=false;n.htmlElement.disabled=false;o.htmlElement.disabled=false;if(!t){e.htmlElement.selectedIndex=0;this.controller.ShoulderAnnotation.OrthoStemImplant.ImplantManufacturer=undefined;this.SetSelectProductLineStem(["--"],["--"],"--")}this.controller.ShoulderAnnotation.OrthoStemImplant.ImplantProductLine=undefined;this.controller.ShoulderAnnotation.OrthoStemImplant.ImplantComponentFamily=undefined;this.controller.ShoulderAnnotation.OrthoStemImplant.ImplantSize=undefined;this.controller.ShoulderAnnotation.OrthoStemImplant.ImplantReadyForDraw=false;this.controller.ShoulderAnnotation.OrthoStemImplant.ImplantSvgUrl=null;a.Context.Renderer.Render();a.Context.OverlayRenderer.Render();delete this.controller.ActionsSummaryData["Code02Stem"];delete this.controller.ActionsSummaryData["Code03Stem"];this.controller.ShowSummary()}ValidateManufacturesComponents(t,e){let n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenosphere");let o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenoid");let l=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerHumeralHead");let a=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");switch(t){case OrthoPlugin.EShoulderImplant.Glenosphere:if(n.htmlElement.selectedIndex!==0&&o.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenoid,e,true);this.ResetGlenoidSelection(true)}if(n.htmlElement.selectedIndex!==0&&l.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Humeral_Head,e,true);this.ResetHumeralHeadSelection(true)}if(n.htmlElement.selectedIndex!==0&&a.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Stem,e,true);this.ResetStemSelection(true)}break;case OrthoPlugin.EShoulderImplant.Glenoid:if(o.htmlElement.selectedIndex!==0&&n.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenosphere,e,true);this.ResetGlenosphereSelection(true)}if(o.htmlElement.selectedIndex!==0&&l.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Humeral_Head,e,true);this.ResetHumeralHeadSelection(true)}if(o.htmlElement.selectedIndex!==0&&a.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Stem,e,true);this.ResetStemSelection(true)}break;case OrthoPlugin.EShoulderImplant.Humeral_Head:if(l.htmlElement.selectedIndex!==0&&n.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenosphere,e,true);this.ResetGlenosphereSelection(true)}if(l.htmlElement.selectedIndex!==0&&o.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenoid,e,true);this.ResetGlenoidSelection(true)}if(l.htmlElement.selectedIndex!==0&&a.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Stem,e,true);this.ResetStemSelection(true)}break;case OrthoPlugin.EShoulderImplant.Stem:if(a.htmlElement.selectedIndex!==0&&n.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenosphere,e,true);this.ResetGlenosphereSelection(true)}if(a.htmlElement.selectedIndex!==0&&o.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenoid,e,true);this.ResetGlenoidSelection(true)}if(a.htmlElement.selectedIndex!==0&&l.htmlElement.value!==e){this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Humeral_Head,e,true);this.ResetHumeralHeadSelection(true)}break}}ShowValueLabel(t,e,n,o){const l=t===1?this.DataSection1:this.DataSection2;try{const t=WebClient.Form.GetFieldFromForms(l,e);const a=OrthoPlugin.ResourceBag.HipImplantTemplateJson;t.htmlElement.innerHTML=o||a.Groups[n].PromptMessage}catch(t){}}ControlUI(){var t=this.OrthoFloatingBar.Element.getElementsByClassName("section");for(var e=0;e<t.length;e++){if(t[e]["style"]["display"]!=="none"){var n=t[e].getElementsByClassName("block");if(e>=0){for(var o=0;o<n.length;o++){n[o].style.paddingBottom="0"}var l=n[0].childNodes[0];l["style"]["justify-content"]="left"}}}}ViewTab(){this.viewTab()}GetUpDownImplantSizeGlenosphere(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeGlenosphere");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}GetUpDownImplantSizeHumeralHead(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeHumeralHead");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}GetUpDownImplantSizeGlenoid(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeGlenoid");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}GetUpDownImplantSizeStem(){try{var t=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeStem");var e=t.htmlElement["UpDownObject"];t.htmlElement["UpdateInputReference"](e);return e.Item.Value}catch(t){return""}}SetSelectManufacturerGlenosphere(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenosphere");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectManufacturerGlenoid(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenoid");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectManufacturerHumeralHead(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerHumeralHead");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectManufacturerStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}BuildComponentForAdjustControl(t,e){const n=input({type:"radio",name:"radioBtnComponent",id:"bbGlenosphere",value:"Glenosphere",checked:e===OrthoPlugin.EShoulderImplant.Glenosphere,onchange:t=>{var e=t.target;if(e.value==="Glenosphere"){this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.AdjustGlenosphereImplant;this.controller.OpenTabImplantGlenosphere((()=>{this.BuildUIAdjustControl(this.controller.ShoulderAnnotation,OrthoPlugin.EShoulderImplant.Glenosphere)}))}}});const o=input({type:"radio",name:"radioBtnComponent",id:"bbGlenoid",value:"Glenoid",checked:e===OrthoPlugin.EShoulderImplant.Glenoid,onchange:t=>{var e=t.target;if(e.value==="Glenoid"){this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.AdjustGlenoidImplant;this.controller.OpenTabImplantGlenoid((()=>{this.BuildUIAdjustControl(this.controller.ShoulderAnnotation,OrthoPlugin.EShoulderImplant.Glenoid)}))}}});const l=input({type:"radio",name:"radioBtnComponent",id:"bbHumeralHead",value:"HumeralHead",checked:e===OrthoPlugin.EShoulderImplant.Humeral_Head,onchange:t=>{var e=t.target;if(e.value==="HumeralHead"){this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.AdjustHumeralHeadImplant;this.controller.OpenTabImplantHumeralHead((()=>{this.BuildUIAdjustControl(this.controller.ShoulderAnnotation,OrthoPlugin.EShoulderImplant.Humeral_Head)}))}}});const a=input({type:"radio",name:"radioBtnComponent",id:"bbStem",value:"Stem",checked:e===OrthoPlugin.EShoulderImplant.Stem,onchange:t=>{var e=t.target;if(e.value==="Stem"){this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.AdjustStemImplant;this.controller.OpenTabImplantStem((()=>{this.BuildUIAdjustControl(this.controller.ShoulderAnnotation,OrthoPlugin.EShoulderImplant.Stem)}))}}});const r=div({className:"buttonbar",style:{display:"inline-block"},children:[n,label({htmlFor:"bbGlenosphere",innerHTML:"Glenosph.",style:{fontSize:"13px"}}),o,label({htmlFor:"bbGlenoid",innerHTML:"Glenoid",style:{fontSize:"13px"}}),a,label({htmlFor:"bbStem",innerHTML:"Stem",style:{fontSize:"13px"}}),l,label({htmlFor:"bbHumeralHead",innerHTML:"H. Head",style:{fontSize:"13px"}})]});t.style.textAlign="center";t.appendChild(r)}BuildUIAdjustControl(t,e){const n=div({innerHTML:"Adjust implant",style:{marginBottom:"10px"}});const o=div({style:{margin:"5px auto",width:"fit-content"}});const l=div({});const a=div({style:{margin:"0 auto",width:"fit-content",marginBottom:"10px"}});let r="";let s=0;let h=0;let m=0;let d="";switch(e){case OrthoPlugin.EShoulderImplant.Glenosphere:r="Glenosphere component";if(t!==null){s=parseFloat(t.OrthoGlenosphereImplant.OffsetX.toFixed(1));h=parseFloat(t.OrthoGlenosphereImplant.OffsetY.toFixed(1));m=parseFloat(t.OrthoGlenosphereImplant.Rotation.toFixed(1));d=this.controller.GetImplantSizeName(t.OrthoGlenosphereImplant,OrthoPlugin.EShoulderImplant.Glenosphere)}break;case OrthoPlugin.EShoulderImplant.Glenoid:r="Glenoid component";if(t!==null){s=parseFloat(t.OrthoGlenoidImplant.OffsetX.toFixed(1));h=parseFloat(t.OrthoGlenoidImplant.OffsetY.toFixed(1));m=parseFloat(t.OrthoGlenoidImplant.Rotation.toFixed(1));d=this.controller.GetImplantSizeName(t.OrthoGlenoidImplant,OrthoPlugin.EShoulderImplant.Glenoid)}break;case OrthoPlugin.EShoulderImplant.Humeral_Head:r="Humeral Head component";if(t!==null){s=parseFloat(t.OrthoHumeralHeadImplant.OffsetX.toFixed(1));h=parseFloat(t.OrthoHumeralHeadImplant.OffsetY.toFixed(1));m=parseFloat(t.OrthoHumeralHeadImplant.Rotation.toFixed(1));d=this.controller.GetImplantSizeName(t.OrthoHumeralHeadImplant,OrthoPlugin.EShoulderImplant.Humeral_Head)}break;case OrthoPlugin.EShoulderImplant.Stem:r="Stem component";if(t!==null){s=parseFloat(t.OrthoStemImplant.OffsetX.toFixed(1));h=parseFloat(t.OrthoStemImplant.OffsetY.toFixed(1));m=parseFloat(t.OrthoStemImplant.Rotation.toFixed(1));d=this.controller.GetImplantSizeName(t.OrthoStemImplant,OrthoPlugin.EShoulderImplant.Stem)}break}a.innerHTML=r;this.offsetXContainer=div({innerHTML:"Offset x: "+s,style:{marginLeft:"90px",marginTop:"5px"}});this.offsetYContainer=div({innerHTML:"Offset y: "+h,style:{marginLeft:"90px",marginTop:"5px"}});this.rotationContainer=div({innerHTML:"Rotation: "+ImagingStudyView.Geometry.CalculateRotate360(m)+" deg",style:{marginLeft:"90px",marginTop:"5px"}});this.implantSizeContainer=div({innerHTML:"Implant: "+d,style:{marginLeft:"90px",marginTop:"5px"}});const u=this;this.containerBSection2.innerHTML="";DOMUtils.SetOptions(this.containerBSection2,{children:[n,l,o,a,u.offsetXContainer,u.offsetYContainer,u.rotationContainer,u.implantSizeContainer]});var p;var c;var A;if(t!==null&&t!==undefined){p=s;c=h;A=m}var C=new WebClient.AdjustControl(o,150,(t=>{this.controller.ControlAdjustImplant(t,e)}));this.BuildComponentForAdjustControl(l,e);var S=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var g=S.RendererPlugins[this.controller.Plugin.PluginName];this.ControlUI();this.ControlButtonsMainWindow(g,this.controller.ShoulderAnnotation,this.controller.ActionShoulder)}UpdateUIAdjustImplant(t,e){this.rotationContainer.innerHTML="Rotation: "+ImagingStudyView.Geometry.CalculateRotate360(t.Rotation).toFixed(1)+" deg";this.offsetXContainer.innerHTML="Offset x: "+t.OffsetX.toFixed(1);this.offsetYContainer.innerHTML="Offset y: "+t.OffsetY.toFixed(1);this.implantSizeContainer.innerHTML="Implant: "+this.controller.GetImplantSizeName(t,e);this.controller.ImplantInformation(t,e)}UnSelectAllImplants(){var t=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var e=t.RendererPlugins[this.controller.Plugin.PluginName];if(this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.ImplantReadyForDraw&&this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.Selected){this.controller.ShoulderAnnotation.OrthoGlenosphereImplant.Selected=false;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}if(this.controller.ShoulderAnnotation.OrthoGlenoidImplant.ImplantReadyForDraw&&this.controller.ShoulderAnnotation.OrthoGlenoidImplant.Selected){this.controller.ShoulderAnnotation.OrthoGlenoidImplant.Selected=false;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}if(this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.ImplantReadyForDraw&&this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.Selected){this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant.Selected=false;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}if(this.controller.ShoulderAnnotation.OrthoStemImplant.ImplantReadyForDraw&&this.controller.ShoulderAnnotation.OrthoStemImplant.Selected){this.controller.ShoulderAnnotation.OrthoStemImplant.Selected=false;e.Context.Renderer.Render();e.Context.OverlayRenderer.Render()}}SetBodyShoulder(t){if(t===OrthoPlugin.EBodySide.Left)this.inputLeftSide.checked=true;else this.inputRightSide.checked=true;this.orthoToolWindow.OuterContainer.style.height="auto";this.orthoToolWindow.OuterContainer.style.overflow="visible";this.orthoToolWindow.SelectSideMessage.style.display="none";this.orthoToolWindow.CloseFirstDialogContainer.style.display="none";this.OrthoFloatingBar.Element.querySelector("#BtnShowHide").style.display="block"}ActionApButton(t){var e=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var n=e.RendererPlugins[this.controller.Plugin.PluginName];this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);if(t)this.controller.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.Calibration;this.controller.ShowTextAndControl(2,this.OrthoElementsSection2,"CalibrationSection","","",this.controller.Edition);this.controller.StatusDraw=false;n.Context.AnnotationController.CurrentGroup=null;this.controller.Controller.SetCursorForViewports(this.controller.Controller.ViewportPane,"default");this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.AP];this.ControlTabContent(this.controller.ActionShoulder);this.ControlStatusMainButtons(n,this.controller.Edition,this.controller.ActionShoulder,this.controller.ShoulderAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.ShoulderAnnotation,this.controller.ActionShoulder);this.OrthoFloatingBar.Element.style.height="auto";this.ControlCalibrationButton()}InitFormDataAndEvents(t,e,n,o){this.orthoToolWindow.ButtonsElementsContainer.innerHTML="";this.spaceTab.innerHTML="";var l={};var a={};var r={};var s={};var h={};var m={};this.DataSection1=[l];this.DataSection2=[a,r,s,h,m];l["actionBtnAp"]=t=>{this.ActionApButton(true)};m["actionBtnCalibration"]=t=>{this.controller.ActionCalibrate()};l["actionBtnAdjust"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");this.controller.ActionAdjust()};l["actionBtnGlenosphere"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");let e=n.Context.ImageEntity.IsCalibrated();if(e){this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.GlenosphereImplant;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.Glenosphere];this.controller.OpenTabImplantGlenosphere();this.ControlTabContent(this.controller.ActionShoulder);this.ControlStatusMainButtons(n,o,this.controller.ActionShoulder,this.controller.ShoulderAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.ShoulderAnnotation,this.controller.ActionShoulder);this.OrthoFloatingBar.Element.style.height="auto"}else{WebClient.Toaster.ShowToast("Image calibration is mandatory.",WebClient.Colors.Orange,3)}};l["actionBtnGlenoid"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");let e=n.Context.ImageEntity.IsCalibrated();if(e){this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.GlenoidImplant;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.Glenoid];this.controller.OpenTabImplantGlenoid();this.ControlTabContent(this.controller.ActionShoulder);this.ControlStatusMainButtons(n,o,this.controller.ActionShoulder,this.controller.ShoulderAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.ShoulderAnnotation,this.controller.ActionShoulder);this.OrthoFloatingBar.Element.style.height="auto"}else{WebClient.Toaster.ShowToast("Image calibration is mandatory.",WebClient.Colors.Orange,3)}};l["actionBtnStem"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");let e=n.Context.ImageEntity.IsCalibrated();if(e){this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.StemImplant;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.Stem];this.controller.OpenTabImplantStem();this.ControlTabContent(this.controller.ActionShoulder);this.ControlStatusMainButtons(n,o,this.controller.ActionShoulder,this.controller.ShoulderAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.ShoulderAnnotation,this.controller.ActionShoulder);this.OrthoFloatingBar.Element.style.height="auto"}else{WebClient.Toaster.ShowToast("Image calibration is mandatory.",WebClient.Colors.Orange,3)}};l["actionBtnHumeralHead"]=t=>{n=this.controller.Plugin.GetOrthoContext();this.controller.Plugin.SetSpecialAnnotationToCurrentDrawObject(this.controller);this.controller.Controller.SelectTool("OrthoAnnotationShoulderImplant","ShoulderImplantTool");let e=n.Context.ImageEntity.IsCalibrated();if(e){this.controller.ActionShoulder=OrthoPlugin.EActionShoulder.HumeralHeadImplant;this.IdDefault=OrthoPlugin.ETemplateView[OrthoPlugin.ETemplateView.HumeralHead];this.controller.OpenTabImplantHumeralHead();this.ControlTabContent(this.controller.ActionShoulder);this.ControlStatusMainButtons(n,o,this.controller.ActionShoulder,this.controller.ShoulderAnnotation);this.controller.ShowSummary();this.ControlButtonsMainWindow(n,this.controller.ShoulderAnnotation,this.controller.ActionShoulder);this.OrthoFloatingBar.Element.style.height="auto"}else{WebClient.Toaster.ShowToast("Image calibration is mandatory.",WebClient.Colors.Orange,3)}};a["actionGlenosphereManufacturer"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineGlenosphere");n.htmlElement.innerHTML="";if(t.currentTarget.selectedIndex===0){this.ResetGlenosphereSelection()}else{this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenosphere,t.currentTarget.value,true,(t=>{this.ValidateManufacturesComponents(OrthoPlugin.EShoulderImplant.Glenosphere,t)}))}};a["optionsGlenosphereManufacturer"]="--";a["valuesGlenosphereManufacturer"]="--";a["manufactrurerGlenosphere"]="--";a["actionGlenosphereProductLine"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyGlenosphere");n.htmlElement.innerHTML="";this.controller.CleanImplant(OrthoPlugin.EShoulderImplant.Glenosphere);this.controller.ActionProductLineGlenosphere()};a["optionsGlenosphereProductLine"]="--";a["valuesGlenosphereProductLine"]="--";a["productLineGlenosphere"]="--";a["actionGlenosphereComponentFamily"]=(t,e)=>{this.controller.ActionComponentFamilyGlenosphere()};a["optionsGlenosphereComponentFamily"]="--";a["valuesGlenosphereComponentFamily"]="--";a["componentFamilyGlenosphere"]="--";a["implantSizeGlenosphere"]="";a["dataImplantSizeGlenosphere"]=[new WebClient.ValuesUD("-","-")];a["actionBtnDoneInsertImplantGlenosphere"]=t=>{this.controller.ActionOkShoulderStatusInsertImplantGlenosphere();this.controller.ActionAdjust(OrthoPlugin.EShoulderImplant.Glenosphere)};a["actionBtnClearInsertImplantGlenosphere"]=t=>{var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenosphere");this.controller.ClearDataImplants(OrthoPlugin.EShoulderImplant.Glenosphere);this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenosphere,e.htmlElement.value,true,null);this.controller.ShowSummary()};a["actionBtnCancelInsertImplantGlenosphere"]=t=>{this.controller.ActionCancelShoulderStatusInsertImplantGlenosphere()};r["actionGlenoidManufacturer"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineGlenoid");n.htmlElement.innerHTML="";if(t.currentTarget.selectedIndex===0){this.ResetGlenoidSelection()}else{this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenoid,t.currentTarget.value,true,(t=>{this.ValidateManufacturesComponents(OrthoPlugin.EShoulderImplant.Glenoid,t)}))}};r["optionsGlenoidManufacturer"]="--";r["valuesGlenoidManufacturer"]="--";r["manufacturerGlenoid"]="--";r["actionGlenoidProductLine"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyGlenoid");n.htmlElement.innerHTML="";this.controller.CleanImplant(OrthoPlugin.EShoulderImplant.Glenoid);this.controller.ActionProductLineGlenoid()};r["optionsGlenoidProductLine"]="--";r["valuesGlenoidProductLine"]="--";r["productLineGlenoid"]="--";r["actionGlenoidComponentFamily"]=(t,e)=>{this.controller.ActionComponentFamilyGlenoid()};r["optionsGlenoidComponentFamily"]="--";r["valuesGlenoidComponentFamily"]="--";r["componentFamilyGlenoid"]="--";r["implantSizeGlenoid"]="";r["dataImplantSizeGlenoid"]=[new WebClient.ValuesUD("-","-")];r["actionBtnDoneInsertImplantGlenoid"]=t=>{this.controller.ActionOkShoulderStatusInsertImplantGlenoid();this.controller.ActionAdjust(OrthoPlugin.EShoulderImplant.Glenoid)};r["actionBtnClearInsertImplantGlenoid"]=t=>{var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenoid");this.controller.ClearDataImplants(OrthoPlugin.EShoulderImplant.Glenoid);this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Glenoid,e.htmlElement.value,true,null);this.controller.ShowSummary()};r["actionBtnCancelInsertImplantGlenoid"]=t=>{this.controller.ActionCancelShoulderStatusInsertImplantGlenoid()};s["actionHumeralHeadManufacturer"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineHumeralHead");n.htmlElement.innerHTML="";if(t.currentTarget.selectedIndex===0){this.ResetHumeralHeadSelection()}else{this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Humeral_Head,t.currentTarget.value,true,(t=>{this.ValidateManufacturesComponents(OrthoPlugin.EShoulderImplant.Humeral_Head,t)}))}};s["optionsHumeralHeadManufacturer"]="--";s["valuesHumeralHeadManufacturer"]="--";s["manufactrurerHumeralHead"]="--";s["actionHumeralHeadProductLine"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyHumeralHead");n.htmlElement.innerHTML="";this.controller.CleanImplant(OrthoPlugin.EShoulderImplant.Humeral_Head);this.controller.ActionProductLineHumeralHead()};s["optionsHumeralHeadProductLine"]="--";s["valuesHumeralHeadProductLine"]="--";s["productLineHumeralHead"]="--";s["actionHumeralHeadComponentFamily"]=(t,e)=>{this.controller.ActionComponentFamilyHumeralHead()};s["optionsHumeralHeadComponentFamily"]="--";s["valuesHumeralHeadComponentFamily"]="--";s["componentFamilyHumeralHead"]="--";s["implantSizeHumeralHead"]="";s["dataImplantSizeHumeralHead"]=[new WebClient.ValuesUD("-","-")];s["actionBtnDoneInsertImplantHumeralHead"]=t=>{this.controller.ActionOkShoulderStatusInsertImplantHumeralHead();this.controller.ActionAdjust(OrthoPlugin.EShoulderImplant.Humeral_Head)};s["actionBtnClearInsertImplantHumeralHead"]=t=>{var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerHumeralHead");this.controller.ClearDataImplants(OrthoPlugin.EShoulderImplant.Humeral_Head);this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Humeral_Head,e.htmlElement.value,true,null);this.controller.ShowSummary()};s["actionBtnCancelInsertImplantHumeralHead"]=t=>{this.controller.ActionCancelShoulderStatusInsertImplantHumeralHead()};h["actionStemManufacturer"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");n.htmlElement.innerHTML="";if(t.currentTarget.selectedIndex===0){this.ResetStemSelection()}else{this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Stem,t.currentTarget.value,true,(t=>{this.ValidateManufacturesComponents(OrthoPlugin.EShoulderImplant.Stem,t)}))}};h["optionsStemManufacturer"]="--";h["valuesStemManufacturer"]="--";h["manufactrurerStem"]="--";h["actionStemProductLine"]=(t,e)=>{var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");n.htmlElement.innerHTML="";this.controller.CleanImplant(OrthoPlugin.EShoulderImplant.Stem);this.controller.ActionProductLineStem()};h["optionsStemProductLine"]="--";h["valuesStemProductLine"]="--";h["productLineStem"]="--";h["actionStemComponentFamily"]=(t,e)=>{this.controller.ActionComponentFamilyStem()};h["optionsStemComponentFamily"]="--";h["valuesStemComponentFamily"]="--";h["componentFamilyStem"]="--";h["implantSizeStem"]="";h["dataImplantSizeStem"]=[new WebClient.ValuesUD("-","-")];h["actionBtnDoneInsertImplantStem"]=t=>{this.controller.ActionOkShoulderStatusInsertImplantStem();this.controller.ActionAdjust(OrthoPlugin.EShoulderImplant.Stem)};h["actionBtnClearInsertImplantStem"]=t=>{var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");this.controller.ClearDataImplants(OrthoPlugin.EShoulderImplant.Stem);this.controller.LoadDataPerManufacturer(OrthoPlugin.EShoulderImplant.Stem,e.htmlElement.value,true,null);this.controller.ShowSummary()};h["actionBtnCancelInsertImplantStem"]=t=>{this.controller.ActionCancelShoulderStatusInsertImplantStem()};this.OrthoElementsSection1=(new Vue.Products.OrthoPlugin.ShoulderImplantSection1Form).Create(this.orthoToolWindow.ButtonsElementsContainer,this.DataSection1);this.OrthoFloatingBar.BuildForm(this.OrthoElementsSection1,e);this.ControlUI();this.ControlStatusMainButtons(n,o,this.controller.ActionShoulder,t);this.containerASection2=div({style:{display:"none"}});this.containerBSection2=div({style:{display:"none"}});this.spaceTab.appendChild(this.containerASection2);this.spaceTab.appendChild(this.containerBSection2);this.OrthoElementsSection2=(new Vue.Products.OrthoPlugin.ShoulderImplantSection2Form).Create(this.containerASection2,this.DataSection2);this.controller.Controller.View.Platform.Toolbar.SelectButton("toolbarviewer.2","eFit","optionInMenuPressed");this.AppendIconsToMainButtons();this.ControlCalibrationButton();this.BuildUIAdjustControl(t,OrthoPlugin.EShoulderImplant.Glenosphere);this.setPostControls(n);this.viewTab();WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAp").htmlElement.click();this.OrthoFloatingBar.Element.querySelector("#SectionButtonsA").style.margin="0px"}ControlCalibrationButton(){let t=WebClient.Form.GetFieldFromForms(this.DataSection2,"BtnCalibration");let e=WebClient.Form.GetFieldFromForms(this.DataSection2,"TextCalibrationStatus");let n=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);if(n===null)return;let o=n.RendererPlugins[this.controller.Plugin.PluginName];let l=o.Context.ImageEntity.IsCalibrated();if(l){t.htmlElement.style.backgroundColor=WebClient.Colors.BelizeHole;e.htmlElement.innerHTML="Image calibrated"}else{t.htmlElement.style.backgroundColor=WebClient.Colors.Alizarin;e.htmlElement.innerHTML="Image not calibrated"}}AppendIconsToMainButtons(){const t=WebClient.Form.GetFieldFromForms(this.DataSection1,"BtnAdjust");const e=WebClient.Form.GetFieldFromForms(this.DataSection2,"BtnCalibration");[{field:t,text:"Adjust",icon:OrthoPlugin.ResourceBag.Icons8Drag32Png}].forEach((e=>{e.field.htmlElement.innerHTML="";e.field.htmlElement.appendChild(img({src:e.icon,style:{verticalAlign:"middle",marginRight:"5px",width:[t].indexOf(e.field)>-1?"24px":""}}));e.field.htmlElement.appendChild(label({innerHTML:e.text}))}));e.htmlElement.appendChild(img({src:OrthoPlugin.ResourceBag.Icons8Sphere32Png}));this.ControlUI()}SetSelectProductLineGlenosphere(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineGlenosphere");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectComponentFamilyGlenosphere(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyGlenosphere");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o);if(t.length>1&&(t[0]!=="--"&&n!=="--")){}}GetSelectProductLineGlenosphere(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineGlenosphere");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectComponentFamilyGlenosphere(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyGlenosphere");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectManufacturerGlenosphere(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenosphere");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectProductLineGlenoid(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineGlenoid");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectProductLineHumeralHead(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineHumeralHead");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectProductLineStem(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectComponentFamilyGlenoid(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyGlenoid");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectComponentFamilyHumeralHead(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyHumeralHead");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectComponentFamilyStem(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectManufacturerGlenoid(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerGlenoid");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectManufacturerHumeralHead(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerHumeralHead");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}GetSelectManufacturerStem(){try{var field=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectManufacturerStem");var value=field.htmlElement.value;if(["undefined","null"].some((t=>t===value)))value=eval(value);return value}catch(t){return""}}SetUpDownImplantSizeGlenosphere(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeGlenosphere");var l=o.htmlElement["UpDownObject"];l.Items=t;if(e!==undefined&&e!==null){var a=t.filter((t=>t.Value===e));var r=e;if(a.length>0)r=a[0].Text;l.Item=new WebClient.ValuesUD(e,r)}if(n!==undefined&&n!==null){l.Index=n;o.htmlElement["UpdateInputReference"](l,true)}else{o.htmlElement["UpdateInputReference"](l,false)}}SetSelectProductLineGlenoid(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineGlenoid");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectProductLineHumeralHead(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineHumeralHead");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectProductLineStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectProductLineStem");o["params"]["options"]=t;o["params"]["values"]=e;if(n!==null&&n!==undefined){o["params"]["value"]=n}else{var l;try{if(this.controller.Edition){l="--"}}catch(t){l="--"}finally{l=l||"--"}o["params"]["value"]=l}o["htmlElement"]["UpdateData"](o)}SetSelectComponentFamilyGlenoid(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyGlenoid");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o);if(t.length>1&&t[0]!=="--"&&n!=="--"){}}SetSelectComponentFamilyHumeralHead(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyHumeralHead");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o);if(t.length>1&&t[0]!=="--"&&n!=="--"){}}SetSelectComponentFamilyStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"selectComponentFamilyStem");o["params"]["options"]=t;o["params"]["values"]=e;o["params"]["value"]=n;o["htmlElement"]["UpdateData"](o);if(t.length>1&&t[0]!=="--"&&n!=="--"){}}SetUpDownImplantSizeGlenoid(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeGlenoid");var l=o.htmlElement["UpDownObject"];l.Items=t;if(e!==undefined&&e!==null){var a=t.filter((t=>t.Value===e));var r=e;if(a.length>0)r=a[0].Text;l.Item=new WebClient.ValuesUD(e,r)}if(n!==undefined&&n!==null){l.Index=n;o.htmlElement["UpdateInputReference"](l,true)}else o.htmlElement["UpdateInputReference"](l,false)}SetUpDownImplantSizeHumeralHead(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeHumeralHead");var l=o.htmlElement["UpDownObject"];l.Items=t;if(e!==undefined&&e!==null){var a=t.filter((t=>t.Value===e));var r=e;if(a.length>0)r=a[0].Text;l.Item=new WebClient.ValuesUD(e,r)}if(n!==undefined&&n!==null){l.Index=n;o.htmlElement["UpdateInputReference"](l,true)}else o.htmlElement["UpdateInputReference"](l,false)}SetUpDownImplantSizeStem(t,e,n){var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeStem");var l=o.htmlElement["UpDownObject"];l.Items=t;if(e!==undefined&&e!==null){var a=t.filter((t=>t.Value===e));var r=e;if(a.length>0)r=a[0].Text;l.Item=new WebClient.ValuesUD(e,r)}if(n!==undefined&&n!==null){l.Index=n;o.htmlElement["UpdateInputReference"](l,true)}else o.htmlElement["UpdateInputReference"](l,false)}ControlTabContent(t){this.spaceTab.style.minHeight="100px";switch(t){case OrthoPlugin.EActionShoulder.None:this.spaceTab.style.display="block";var e=this.spaceTab.getElementsByClassName("section");for(var n in e){if(e.hasOwnProperty(n))e[n].style.display="none"}if(this.containerASection2!==undefined)this.containerASection2.style.display="none";if(this.containerBSection2!==undefined)this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break;case OrthoPlugin.EActionShoulder.Calibration:this.spaceTab.style.display="block";this.containerASection2.style.display="block";this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break;case OrthoPlugin.EActionShoulder.InsertImplant:case OrthoPlugin.EActionShoulder.GlenosphereImplant:case OrthoPlugin.EActionShoulder.GlenoidImplant:case OrthoPlugin.EActionShoulder.HumeralHeadImplant:case OrthoPlugin.EActionShoulder.StemImplant:this.spaceTab.style.display="block";this.containerASection2.style.display="block";this.containerBSection2.style.display="none";this.spaceTab.style.height="auto";this.orthoToolWindow.ActionsSummaryContainer.style.display="block";break;case OrthoPlugin.EActionShoulder.AdjustImplant:case OrthoPlugin.EActionShoulder.AdjustGlenosphereImplant:case OrthoPlugin.EActionShoulder.AdjustGlenoidImplant:case OrthoPlugin.EActionShoulder.AdjustHumeralHeadImplant:case OrthoPlugin.EActionShoulder.AdjustStemImplant:this.spaceTab.style.display="block";this.containerASection2.style.display="none";this.containerBSection2.style.display="block";this.spaceTab.style.height="350px";this.orthoToolWindow.ActionsSummaryContainer.style.display="none";switch(t){case OrthoPlugin.EActionShoulder.AdjustGlenosphereImplant:this.UpdateUIAdjustImplant(this.controller.ShoulderAnnotation.OrthoGlenosphereImplant,OrthoPlugin.EShoulderImplant.Glenosphere);break;case OrthoPlugin.EActionShoulder.AdjustGlenoidImplant:this.UpdateUIAdjustImplant(this.controller.ShoulderAnnotation.OrthoGlenoidImplant,OrthoPlugin.EShoulderImplant.Glenoid);break;case OrthoPlugin.EActionShoulder.AdjustHumeralHeadImplant:this.UpdateUIAdjustImplant(this.controller.ShoulderAnnotation.OrthoHumeralHeadImplant,OrthoPlugin.EShoulderImplant.Humeral_Head);break;case OrthoPlugin.EActionShoulder.AdjustStemImplant:this.UpdateUIAdjustImplant(this.controller.ShoulderAnnotation.OrthoStemImplant,OrthoPlugin.EShoulderImplant.Stem);break}break}}BuildShowDesign(){var toogleDesign=t=>{var e=this.controller.Controller.GetSelectViewport(this.controller.Controller.ViewportPane);var n=e.RendererPlugins[this.controller.Plugin.PluginName];var o=!this.controller.Edition?n.CurrentAnnotation:n.LastAnnotationCreatedOrSelected;this.controller.Plugin.HideAnnotationSpecialForOrtho=!t;if(o)e.SwitchVisibleAnnotations(t,o.Name,o)};const t=input({type:"radio",name:"radioBtnDesign",id:"bbShowDesignYes",value:"Yes",checked:!this.controller.Plugin.HideAnnotationSpecialForOrtho,onchange:t=>{var e=t.target;if(e.value==="Yes")toogleDesign(true)}});const e=input({type:"radio",name:"radioBtnDesign",id:"bbShowDesignNo",value:"No",checked:this.controller.Plugin.HideAnnotationSpecialForOrtho,onchange:t=>{var e=t.target;if(e.value==="No")toogleDesign(false)}});const n=div({id:"BtnShowHide",children:[div({className:"label",innerHTML:"Show design: "}),div({className:"buttonbar",children:[t,label({htmlFor:"bbShowDesignYes",innerHTML:"Yes"}),e,label({htmlFor:"bbShowDesignNo",innerHTML:"No"})]})]});if(WebClient.DOMUtils.IsDisplay(this.orthoToolWindow.SelectSideMessage))n.style.display="none";this.orthoToolWindow.LeftTopSection.appendChild(n)}cleanClassColorOfButtonDisabled(t){for(var e=0;e<t.GetFields().length;e++){var n=t.GetFields()[e].htmlElement;if(n.disabled){DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.ACTIVE);DOMUtils.RemoveClass(n,OrthoPlugin.ButtonClasses.ENABLE)}}}viewTab(){this.orthoToolWindow.MainSection.style.display="block"}setPostControls(t){var e=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeGlenosphere");e.htmlElement["Decrease"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantGlenosphere(e,t)};e.htmlElement["Increase"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantGlenosphere(e,t)};var n=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeGlenoid");n.htmlElement["Decrease"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantGlenoid(e,t)};n.htmlElement["Increase"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantGlenoid(e,t)};var o=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeHumeralHead");o.htmlElement["Decrease"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantHumeralHead(e,t)};o.htmlElement["Increase"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantHumeralHead(e,t)};var l=WebClient.Form.GetFieldFromForms(this.DataSection2,"upDownImplantSizeStem");l.htmlElement["Decrease"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantStem(e,t)};l.htmlElement["Increase"]=e=>{this.controller.ActionIncreaseDecreaseSizeImplantStem(e,t)}}}OrthoPlugin.ShoulderImplantView=ShoulderImplantView})(OrthoPlugin=Products.OrthoPlugin||(Products.OrthoPlugin={}))})(Products=Vue.Products||(Vue.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient;let n;(function(t){t[t["Cervical"]=0]="Cervical";t[t["Thoracic"]=1]="Thoracic";t[t["Lumbar"]=2]="Lumbar";t[t["Sacrum"]=3]="Sacrum"})(n=t.ESpineSection||(t.ESpineSection={}));let o;(function(t){t[t["TopToBottom"]=0]="TopToBottom";t[t["BottomToTop"]=1]="BottomToTop"})(o=t.ESpineDirection||(t.ESpineDirection={}));class SpineController extends e.SubView{constructor(n){super(n.Controller.View.Platform.GetMainContainer(),n.Controller.View.Platform,"DicomPluginLanguage");this.orthoPlugin=n;this.SpineProgression=o.TopToBottom;this.SpineCurrent="C2";this.ResizeListeners.push(new e.ResizeStructure(this.constructor.name.toLowerCase(),this,this.orthoPlugin.Controller.View.ViewName));this.SpineView=new t.SpinePane(this.BodySection,this.orthoPlugin);this.Element.style.display="none"}SetButtons(){super.SetButtons([],(()=>{if(this.SpineCurrent==="")this.orthoPlugin.Controller.SelectTool("Pointer","pointerTool");this.SpineView.Toggle()}))}ClearAllVertebras(){var t=this.orthoPlugin.Controller.GetSelectViewport(this.orthoPlugin.Controller.ViewportPane);if(t!==undefined){var e=t.RendererPlugins[this.orthoPlugin.PluginName].Annotations;for(var n=0;n<e.length;n++){var o=e[n];if(o.Name==="SpineAnnotation")o.Selected=true}t.Annotations[this.orthoPlugin.PluginName]=t.RendererPlugins[this.orthoPlugin.PluginName].Annotations;this.orthoPlugin.DeleteSelectedAnnotations(t);this.SpineCurrent="";this.SpineView.RenderStylesInButtons()}}GetNextValue(e){var n;var l=t.SpineAnnotation.SpineCervical.slice();var a=t.SpineAnnotation.SpineThoracic.slice();var r=t.SpineAnnotation.SpineLumbar.slice();var s=t.SpineAnnotation.SpineSacrum.slice();if(this.SpineProgression===o.BottomToTop){l=l.reverse();a=a.reverse();r=r.reverse();s=s.reverse()}var h=[l,a,r,s];var m=false;if(this.SpineProgression===o.BottomToTop)h=h.reverse();for(var d=0;d<h.length;d++){if(m){n=h[d][0];break}for(var u=0;u<h[d].length;u++){if(h[d][u].toLowerCase()===e.toLowerCase()){if(h[d].length===u+1&&d<h.length-1){m=true;break}else{if(u+1<h[d].length)n=h[d][u+1];else n=null;break}}}}return n}OnWindowResize(t,e,n){super.OnWindowResize(t,e,n)}}t.SpineController=SpineController})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));var Vue;(function(t){var e;(function(t){var e;(function(t){var e=Efferent.Frontend.WebClient.DOMUtils;class SpinePane{constructor(t,n){this.parent=t;this.plugin=n;this.cervicalButtons=new Array;this.thoracicButtons=new Array;this.lumbarButtons=new Array;this.sacrumButtons=new Array;var o=document.createElement("div");e.AddClass(o,"spinePane");this.PaneSection=o;this.parent.appendChild(o);this.plugin.Controller.View.Platform.ResizeListeners.push(new Efferent.Frontend.WebClient.ResizeStructure(this.constructor.name.toLowerCase(),this,this.plugin.Controller.View.ViewName))}Create(){this.PaneSection.innerHTML="";var e=this.plugin.Controller.View.Platform.LanguageManager;var n="OrthoPluginLanguage";var o=e.GetValuesFromDict(n,"cervical").toUpperCase();var l=e.GetValuesFromDict(n,"thoracic").toUpperCase();var a=e.GetValuesFromDict(n,"lumbar").toUpperCase();var r=e.GetValuesFromDict(n,"sacrum").toUpperCase();var s=e.GetValuesFromDict(n,"progression").toUpperCase();var h=e.GetValuesFromDict(n,"topToBottom").toUpperCase();var m=e.GetValuesFromDict(n,"BottomToTop").toUpperCase();var d=e.GetValuesFromDict(n,"clearAllVertebras").toUpperCase();var u=document.createElement("h3");u.innerHTML=o;var p=document.createElement("div");p.className="barSpineElements";var c;var A;for(c=0;c<t.SpineAnnotation.SpineCervical.length;c++){A=document.createElement("button");A.id="btn_"+t.SpineAnnotation.SpineCervical[c].toLowerCase();A.innerHTML=t.SpineAnnotation.SpineCervical[c];A.onclick=t=>{this.plugin.SpineController.SpineCurrent=t.target.innerHTML;this.RenderStylesInButtons(true)};p.appendChild(A);this.cervicalButtons.push(A)}var C=document.createElement("h3");C.innerHTML=l;var S=document.createElement("div");S.className="barSpineElements";for(c=0;c<t.SpineAnnotation.SpineThoracic.length;c++){A=document.createElement("button");A.id="btn_"+t.SpineAnnotation.SpineThoracic[c].toLowerCase();A.innerHTML=t.SpineAnnotation.SpineThoracic[c];A.onclick=t=>{this.plugin.SpineController.SpineCurrent=t.target.innerHTML;this.RenderStylesInButtons(true)};S.appendChild(A);this.thoracicButtons.push(A)}var g=document.createElement("h3");g.innerHTML=a;var I=document.createElement("div");I.className="barSpineElements";for(c=0;c<t.SpineAnnotation.SpineLumbar.length;c++){A=document.createElement("button");A.id="btn_"+t.SpineAnnotation.SpineLumbar[c].toLowerCase();A.innerHTML=t.SpineAnnotation.SpineLumbar[c];A.onclick=t=>{this.plugin.SpineController.SpineCurrent=t.target.innerHTML;this.RenderStylesInButtons(true)};I.appendChild(A);this.lumbarButtons.push(A)}var P=document.createElement("h3");P.innerHTML=r;var f=document.createElement("div");f.className="barSpineElements";for(c=0;c<t.SpineAnnotation.SpineSacrum.length;c++){A=document.createElement("button");A.id="btn_"+t.SpineAnnotation.SpineSacrum[c].toLowerCase();A.innerHTML=t.SpineAnnotation.SpineSacrum[c];A.onclick=t=>{this.plugin.SpineController.SpineCurrent=t.target.innerHTML;this.RenderStylesInButtons(true)};f.appendChild(A);this.sacrumButtons.push(A)}var w=document.createElement("h3");w.innerHTML=s;var b=document.createElement("input");b.type="radio";b.name="progressInput";b.id="progressInputT1";b.onclick=e=>{this.plugin.SpineController.SpineProgression=t.ESpineDirection.TopToBottom};b.checked=this.plugin.SpineController.SpineProgression===t.ESpineDirection.TopToBottom;var v=document.createElement("label");v.setAttribute("for","progressInputT1");v.innerHTML=h;var T=document.createElement("input");T.type="radio";T.name="progressInput";T.id="progressInputT2";T.onclick=e=>{this.plugin.SpineController.SpineProgression=t.ESpineDirection.BottomToTop};T.checked=this.plugin.SpineController.SpineProgression===t.ESpineDirection.BottomToTop;var F=document.createElement("label");F.setAttribute("for","progressInputT2");F.style.marginLeft="10px";F.innerHTML=m;var O=document.createElement("button");O.innerHTML=d;O.className="red btnClearAll";O.onclick=t=>{this.plugin.SpineController.ClearAllVertebras()};this.PaneSection.appendChild(u);this.PaneSection.appendChild(p);this.PaneSection.appendChild(C);this.PaneSection.appendChild(S);this.PaneSection.appendChild(g);this.PaneSection.appendChild(I);this.PaneSection.appendChild(P);this.PaneSection.appendChild(f);this.PaneSection.appendChild(w);this.PaneSection.appendChild(b);this.PaneSection.appendChild(v);this.PaneSection.appendChild(T);this.PaneSection.appendChild(F);this.PaneSection.appendChild(O);this.RenderStylesInButtons()}RenderStylesInButtons(n=false){var o=this.plugin.Controller.GetSelectViewport(this.plugin.Controller.ViewportPane);var l;var a;var r;if(o!==undefined){var s=o.RendererPlugins[this.plugin.PluginName].Annotations;var h=[this.cervicalButtons,this.thoracicButtons,this.lumbarButtons,this.sacrumButtons];for(l=0;l<h.length;l++){for(a=0;a<h[l].length;a++){e.RemoveClass(h[l][a],t.ButtonClasses.ACTIVE);e.RemoveClass(h[l][a],t.ButtonClasses.ENABLE)}}var m=null;var d=0;var u="A";for(l=0;l<s.length;l++){var p=s[l];if(p.Name==="SpineAnnotation"){var c=p.TextLabel;if(c!==undefined){var A=c.match(/[A-Z]/gi).pop();var C=parseInt(c.match(/[0-9]/gi).pop());if(A>u)u=A;if(C>d)d=C;for(r=0;r<h.length;r++){for(a=0;a<h[r].length;a++){if(h[r][a].innerHTML.toUpperCase()===c.toUpperCase()){e.RemoveClass(h[r][a],"spineNormal");e.RemoveClass(h[r][a],t.ButtonClasses.ACTIVE);e.AddClass(h[r][a],t.ButtonClasses.ENABLE)}}}}}}if(d!==0&&u!=="A")m=(u+""+d.toString()).toUpperCase();if(m!==null&&!n)this.plugin.SpineController.SpineCurrent=this.plugin.SpineController.GetNextValue(m);for(l=0;l<h.length;l++){for(a=0;a<h[l].length;a++){if(this.plugin.SpineController.SpineCurrent!==null&&this.plugin.SpineController.SpineCurrent.toUpperCase()===h[l][a].innerHTML.toUpperCase()){e.RemoveClass(h[l][a],"spineNormal");e.RemoveClass(h[l][a],t.ButtonClasses.ENABLE);e.AddClass(h[l][a],t.ButtonClasses.ACTIVE)}}}}}Toggle(){var t=e.IsDisplay(this.PaneSection);if(!t){this.OnWindowResize(0,0);this.plugin.SpineController.SpineCurrent="";this.Create();this.PaneSection.style.display="block";this.plugin.SpineController.SetButtons();this.plugin.SpineController.Element.style.display="block"}else{this.plugin.SpineController.Element.style.display="none";this.PaneSection.style.display="none";this.plugin.SpineController.CloseSubView()}}OnWindowResize(t,n){if(e.IsDisplay(this.PaneSection)){var o=this.parent.clientWidth;var l=this.parent.clientHeight;this.PaneSection.style.width=o+"px";this.PaneSection.style.height=l+"px"}}}t.SpinePane=SpinePane})(e=t.OrthoPlugin||(t.OrthoPlugin={}))})(e=t.Products||(t.Products={}))})(Vue||(Vue={}));