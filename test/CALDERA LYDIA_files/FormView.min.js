var Efferent;(function(e){var t;(function(t){var r;(function(t){var r=e.Frontend.WebClient;var s=e.Frontend.WebClient.DOMUtils;class FormViewYaml{Create(e,t,n){var o=new Array;var a=document.createElement("div");s.AddClass(a,"section");var l=document.createElement("div");s.AddClass(l,"block");a["formViewContent"]=l;var c=new r.Form(l,t[0],n);c.AddField(new r.Field(r.EFieldType.Container,"formBodyContainer",{id:"formBody"},{},[]));c.AddField(new r.Field(r.EFieldType.Button,"SaveButton",{text:"Save"},{"margin-right":"10px","margin-bottom":"10px"},["green","inline"],t[0].actionSave));c.AddField(new r.Field(r.EFieldType.Button,"SaveAndCloseButton",{text:"Save and close"},{"margin-right":"10px","margin-bottom":"10px"},["green","inline"],t[0].actionSaveAndClose));c.AddField(new r.Field(r.EFieldType.Button,"Cancel",{text:"Cancel"},{"margin-right":"10px","margin-bottom":"10px"},["red","inline"],t[0].actionCancelForm));c.Render();a.appendChild(l);e.appendChild(a);o.push(a);return o}}t.FormViewYaml=FormViewYaml})(r=t.FormView||(t.FormView={}))})(t=e.ClientViews||(e.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(Efferent){var ClientViews;(function(ClientViews){var FormView;(function(FormView_1){var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;var HttpUtils=Efferent.Frontend.WebClient.HttpUtils;var Utils=Efferent.Frontend.WebClient.Utils;var WebClient=Efferent.Frontend.WebClient;var FhirClient=Efferent.Frontend.FhirClient;var CommonView=Efferent.ClientViews.CommonView;class FormView{constructor(e,t,r,s,n,o){var a;this.elementContainers=[];this.propertiesToHide=["resourceType","code","extension","modifierExtension","meta","id","identifier"];this.datePickerTypes=["DATE","DATETIME","PERIOD","AGE","RANGE","INSTANT"];this.complexControls=["CONTACTPOINT","ADDRESS"];this.waitingDataCallback=false;this.reverseReferences=[];this.SubFormsToUpdate=[];this.ReferenceBlocks=[];this.ViewName="FormView";this.Inputs=[];this.ParentView=o;this.SpecView=r;this.Platform=t;this.Parent=e;this.ReferenceBlocks=new Array;this.ResourceBag=FormView_1.ResourceBag;this.Fields=s.hasOwnProperty("Fields")?s["Fields"]:t.CurrentSpec.FormTemplates[r.TemplateId].Fields;this.fieldsOrder=new Array(this.Fields.length);this.formTemplates=t.CurrentSpec["FormTemplates"];this.views=t.CurrentSpec.Functions[0]["Views"];this.OptionalParameters=n;this.ParentContext=s["ParentContext"];this.readOnlyForm=s["ReadOnlyForm"];this.TabForm=s["TabForm"];this.CreateResourceCallback=s["CreateResourceCallback"];this.PassParentContext=s["PassParentContext"];this.UpdateResourceCallback=s["UpdateResourceCallback"];this.SwitchThemeOnSubView=(a=s["SwitchThemeOnSubView"])!==null&&a!==void 0?a:true;this.HardResourceData=s["HardResourceData"];let l={actionSave:()=>{this.FormViewController.SaveData(false)},actionSaveAndClose:()=>{this.FormViewController.SaveData(true)},actionCancelForm:()=>{n=[{lastResourceId:HttpUtils.GetUrlParameter("ResourceId").split("/")[1]}];if(!this.ReturnIfReference())this.Platform.SwitchView(this.Platform.BrowsingHistory[this.Platform.BrowsingHistory.length-1],"back",n)}};this.formViewYaml=(new FormView_1.FormViewYaml).Create(this.Parent,[l]);const c=this.formViewYaml[0]["children"];this.containerDiv=c[0];this.containerDiv.classList.add("formViewContent");this.containerDiv.parentElement.style.width="100%";this.resourcePicker=new CommonView.ResourcePickerController(this);this.containerDiv.parentNode.insertBefore(this.resourcePicker.ResourceListBox,this.containerDiv);const d=WebClient.Form.GetFieldFromForms(l,"formBodyContainer");this.formBody=d.htmlElement;this.formBody.classList.add("formView");this.FormViewController=new FormView_1.FormViewController(this);if(!this.TabForm)this.Platform.ResizeListeners.push(new WebClient.ResizeStructure(this.constructor.name.toLowerCase(),this,this.ViewName));const h=decodeURIComponent(s["ResourceId"]).split("/");this.FormViewController.FormMode=FormView_1.EFormMode[s["FormMode"]];this.FormViewController.Title=HttpUtils.GetUrlParameter("Title");let u;try{var p=this.OptionalParameters[2]["FormMode"];u=FormView_1.EFormMode[p]}catch(e){u=undefined}if(o||this.readOnlyForm||this.FormViewController.FormMode===FormView_1.EFormMode.reference||u===FormView_1.EFormMode.reference||this.FormViewController.FormMode===FormView_1.EFormMode.new){const e=l["forms"][0].GetField("Cancel").htmlElement;if(o||this.TabForm||this.FormViewController.FormMode===FormView_1.EFormMode.reference){e.remove()}else if(this.readOnlyForm){e.innerText="Close"}if(this.FormViewController.FormMode!==FormView_1.EFormMode.reference&&u===FormView_1.EFormMode.reference||this.readOnlyForm||this.FormViewController.FormMode===FormView_1.EFormMode.new){const e=l["forms"][0].GetField("SaveButton").htmlElement;e.remove()}if(this.readOnlyForm||this.FormViewController.FormMode===FormView_1.EFormMode.reference&&u===FormView_1.EFormMode.reference){const e=l["forms"][0].GetField("SaveAndCloseButton").htmlElement;e.remove()}}for(let e=0;e<this.Fields.length;e++){const t=this.Fields[e];if(t.hasOwnProperty("TargetProperty")){this.reverseReferences.push(t)}else if(t.hasOwnProperty("Expression")){const e=t["Expression"];const r=/\[([0-9]*)\]/;const s=r.exec(e);if(s)this.FormViewController.ResourceIDs.push(e.replace(s[0],""));else this.FormViewController.ResourceIDs.push(e)}else if(t.hasOwnProperty("Extension")){this.FormViewController.ResourceIDs.push("");let e={};e["url"]=t["Extension"];e["valueString"]=t["ExtensionValue"];this.FormViewController.Extensions.push(e)}}this.mainResourceType=h[0];this.FormViewController.ResourceType=this.mainResourceType;this.FormViewController.Id=h[1];this.FormViewController.GetControlsForConstructor(this.FormViewController.FormMode);if(this.SwitchThemeOnSubView&&(!this.OptionalParameters||this.OptionalParameters&&(this.OptionalParameters.length<3||this.OptionalParameters[2]["FormMode"]!=="reference")))t.SwitchTheme(this);t.Toolbar.HideButton("main.1","back",true);if(r&&!this.TabForm){const e=t.CurrentSpec.Functions[0].Views[r.Id].Actions;t.Toolbar.CreateButtonGroupFromSpecView(e,t,FormView_1.ResourceBag)}}ReturnIfReference(){try{if(this.OptionalParameters[2]["FormMode"]==="reference"){this.Parent.innerHTML="";this.OptionalParameters.push("invoke");let e=new Efferent.ClientViews.FormView.FormView(this.Parent,this.Platform,this.Platform.CurrentSpec.Functions[0].Views[this.OptionalParameters[2]["view"]],this.OptionalParameters[2],this.OptionalParameters);return true}}catch(e){}return false}InjectFields(e){const t=document.createElement("div");DOMUtils.AddClass(t,"breadCrumbContainer");if(sessionStorage["BrowsingHistory"]!==undefined){let e=[];const r=sessionStorage["BrowsingHistory"].split(",");for(let t=r.length-1;t>=0;t--){let s=r[t];if(s.indexOf("view=")>-1){let t=s.split("view=")[1].split("&")[0];if(this.views[t]["Type"]==="FormView"){const r=this.views[t]["TemplateId"];const s=this.formTemplates[r]["ResourceType"];e.unshift(s)}else{break}}}if(e.length>0){t.style.display="flex";e.push(this.mainResourceType);t.innerText=e.join(" > ");this.currentBreadCrumb=t.innerText}else{this.currentBreadCrumb=this.mainResourceType}}this.formBody.appendChild(t);const r=e?e[0]:this.FormViewController.Title;const s=e?e[1]:this.FormViewController.ResourceType;const n=document.createElement("div");this.formBody.appendChild(n);if(!this.TabForm){const e=document.createElement("h3");e.innerText=r!==""?r:s;n.appendChild(e)}const o=FhirClient.ValueHelper.StructureDefinitions[s].snapshot.element;for(let e=0;e<o.length;e++){let t=[];const r=o[e]["id"].split(".")[1];t.push(o[e]);if(e<o.length-1){for(let s=e+1;s<o.length;s++){const e=o[s]["id"].split(".")[1];if(r===e)t.push(o[s])}}this.createFromParameter(n,t)}this.FormViewController.CreateReferenceBlock(n,null,null,this.reverseReferences);WebClient.Loader.Hide()}Refresh(){const e={ResourceId:this.FormViewController.ResourceType+"/"+this.FormViewController.Id,FormMode:"edit",ParentContext:this.ParentContext,Fields:this.Fields};const t=this.Platform.ActivateSubView("SubFormView",e);t.SetButtons([]);this.ParentView.CloseSubView()}UpdateUI(){}CreateReferenceBlockAction(e,t,r,s,n){const o=document.createElement("div");o.setAttribute("hidden",n["Hidden"]?"true":"false");t.appendChild(o);o.style.display="none";this.ReferenceBlocks.push(o);o.classList.add("referencesContainer");const a=document.createElement("h3");o.appendChild(a);a.innerText=n["Label"]||this.getReferenceTitle(e);if(n.hasOwnProperty("ShowAs")&&this.FormViewController.FormMode===FormView_1.EFormMode.edit&&s){switch(n["ShowAs"]){case"worklist":const e=new FormView_1.GridListPane(o,this,s,n["GridTemplate"]);break;case"tabs":const t=s["entry"];this.createResourceTabs(o,t,n);break}}else{o.setAttribute("min",e["min"]);const t=n["ForceSingle"];const l=n["ForceMultiple"];if(t)e["max"]="1";else if(l)e["max"]="*";o.setAttribute("max",e["max"]);const c=document.createElement("div");c.classList.add("referenceNoneLabel");c.innerText="- None -";o.appendChild(c);const d=n["Expression"];o.setAttribute("path",d);this.appendStringInputAsReference(o,e,n);const h=parseInt(e["min"])>0?"* ":"";a.innerText=h+a.innerText;const u=n["ReadOnly"];if(!u&&!this.readOnlyForm){const t=document.createElement("button");t.style.marginLeft="15px";DOMUtils.AddClass(t,"referenceButton autowith");t.innerText="Add";o.querySelector("h3").appendChild(t);const s=o.querySelector(".StringAsReferenceContainer");t.addEventListener("click",(()=>{t.style.backgroundColor="grey";s.style.display="flex";s.querySelector("input").value="";o.querySelector(".referenceNoneLabel").style.display="none"}));const a=s.querySelector(".selectResourceType");const l=s.querySelector(".altSelectResourceBtn");const c=n["AllowedRefTypes"];if(!c&&r.length>1||c&&c.length>1){const e=document.createElement("option");e.innerText="Pick...";e.value="";a.appendChild(e)}for(let e=0;e<r.length;e++){const t=r[e].split("/");const s=t[t.length-1];if(!c||c&&c.indexOf(s)>-1){const e=document.createElement("option");e.innerText=s;e.value=s;a.appendChild(e)}}const selectResourceTypeAction=()=>{var r={thisParameter:e,referencesContainer:o,addButton:t,thisView:this};t.style.backgroundColor="";this.resourcePicker.OpenResourceListBox(a.value,this.currentBreadCrumb,n,this.selectAction,this.cancelAction,this.createAction,r);if(o.getElementsByClassName("referenceRow").length===0)o.querySelector(".referenceNoneLabel").style.display="block";s.style.display="none";a.selectedIndex=0};if(c&&c.length>1||!c&&r.length>1){a.addEventListener("change",(()=>{if(a.value)selectResourceTypeAction()}))}else{a.style.display="none";l.style.display="inline-block";l.addEventListener("click",(()=>{selectResourceTypeAction()}))}}if(s){if(Array.isArray(s)&&s.length>0||s["resourceType"]==="Bundle"){let t=[];if(s["resourceType"]==="Bundle"){s["entry"].forEach((e=>{t.push(e["resource"])}))}else if(Array.isArray(s)){t=s}for(let r=0;r<t.length;r++){this.fillReferenceBlock(t[r],e,o,n)}}else{this.fillReferenceBlock(s,e,o,n)}}}if(this.elementContainers.length+this.ReferenceBlocks.length+this.FormViewController.Extensions.length===this.fieldsOrder.length)this.orderFields();if(!n["ShowAs"])this.OnWindowResize(0,0)}InjectUnwrappedField(e,t,r){const s=document.createElement("div");s.classList.add("multipleField");t.appendChild(s);e.appendChild(t);s.innerHTML=r}ShowPanes(e){this.containerDiv.style.display=e?"block":"none";this.resourcePicker.Show(!e)}LoadData(){}OnWindowResize(e,t){if(this.FormViewController.FormMode!==FormView_1.EFormMode.reference){if(DOMUtils.IsDisplay(this.containerDiv)||DOMUtils.IsDisplay(this.resourcePicker.ResourceListBox)){const e=document.documentElement.clientHeight-this.Platform.ToolbarSectionHeight()-this.Platform.GetActiveMessageHeight();const t=e-50;this.containerDiv.style.height=t+"px";this.resourcePicker.Resize(t)}}}SwitchTheme(){this.Platform.SwitchTheme(this)}GetFhirEntities(){return this.FormViewController.SaveData(false,true)}GetLanguageDictionary(){return""}OnTagChanged(e){}SetInitialStatus(){}OpenActionsConfig(){}CloseActionsConfig(){}OnFullScreenChange(e){}Dispose(){}OnPopState(e){}OnBeforeUnload(e){}OnUnload(e){}fillReferenceBlock(parsedResponse,thisParameter,referencesContainer,fieldProperties){let reverseReferencesToProcess=this.FormViewController.ReverseReferencesToProcess;const referenceRow=document.createElement("div");DOMUtils.AddClass(referenceRow,"referenceRow");const referenceBox=document.createElement("div");DOMUtils.AddClass(referenceBox,"referenceBox dottedBorder");referenceRow.appendChild(referenceBox);referencesContainer.appendChild(referenceRow);const maxReferences=referencesContainer.getAttribute("max");const addButton=referencesContainer.querySelector("h3").querySelector(".referenceButton");let reverseReferencesInLine;if(thisParameter===null||thisParameter===void 0?void 0:thisParameter.hasOwnProperty("targetProperty")){for(let e=0;e<reverseReferencesToProcess.length;e++){if(parsedResponse["id"]===reverseReferencesToProcess[e]["resourceToUpdate"]["id"]){reverseReferencesInLine=reverseReferencesToProcess[e];break}}if(!reverseReferencesInLine){const e={targetProperty:thisParameter["targetProperty"],resourceToUpdate:parsedResponse,operation:"ADD"};reverseReferencesToProcess.push(e);reverseReferencesInLine=e}}if(maxReferences==="1"&&!fieldProperties["ReadOnly"]&&!this.readOnlyForm)addButton.style.display="none";if(typeof parsedResponse==="string")parsedResponse=JSON.parse(parsedResponse);referencesContainer.querySelector(".referenceNoneLabel").style.display="none";const synthesizedData=WebClient.ResourceDataSynthesizer.Synthesize(parsedResponse);if(synthesizedData){const e=document.createElement("div");const t=document.createElement("div");const r=document.createElement("input");e.classList.add("formViewLabel");referenceBox.appendChild(e);r.setAttribute("type","text");r.readOnly=true;t.appendChild(r);e.appendChild(t);r.value=synthesizedData}for(const e in parsedResponse){if(parsedResponse.hasOwnProperty(e)&&this.propertiesToHide.indexOf(e)===-1){const t=document.createElement("div");t.classList.add("formViewLabel");const r=document.createElement("h2");r.innerText=e;referenceBox.appendChild(t);const s=document.createElement("div");t.appendChild(r);if(parsedResponse[e]&&typeof parsedResponse[e]==="string"&&parsedResponse[e].includes("T")&&Utils.IsValidDate(parsedResponse[e])){t.classList.add("half")}if(Array.isArray(parsedResponse[e])||typeof parsedResponse[e]==="object"){let r=parsedResponse[e];if(e==="name"&&r[0].hasOwnProperty("text"))r=[{text:r[0]["text"]}];this.FormViewController.UnwrapParamaters(t,s,r)}else{const r=document.createElement("input");r.setAttribute("type","text");r.readOnly=true;s.appendChild(r);t.appendChild(s);r.value=parsedResponse[e]}}}const actionButtonsContainer=document.createElement("div");DOMUtils.AddClass(actionButtonsContainer,"actionButtonsContainer");const firstFormViewLabel=referenceRow.children[0].children[0];referenceRow.children[0].insertBefore(actionButtonsContainer,firstFormViewLabel.nextSibling);if(parsedResponse.hasOwnProperty("resourceType")){const e=document.createElement("button");e.innerText="Expand ▼";DOMUtils.AddClass(e,"referenceButton autowidth");actionButtonsContainer.appendChild(e);e.addEventListener("click",(()=>{this.expandContract(referenceRow,e)}));const t=document.createElement("button");DOMUtils.AddClass(t,"referenceButton autowidth");const r=fieldProperties["DisableEdit"];if(!r&&!this.readOnlyForm){t.innerText="Edit...";actionButtonsContainer.appendChild(t);t.addEventListener("click",(()=>{const action=()=>{let e="genericResourceForm";if(fieldProperties.hasOwnProperty("FormTemplate")){e=fieldProperties["FormTemplate"]}else{for(const t in this.formTemplates){if(this.formTemplates.hasOwnProperty(t)){if(this.formTemplates[t]["ResourceType"]===parsedResponse["resourceType"]){for(const r in this.views){if(this.views.hasOwnProperty(r)){if(this.views[r]["TemplateId"]===t&&this.views[r]["Type"]==="FormView"){e=r;break}}}}}}}if(this.FormViewController.FormMode===FormView_1.EFormMode.reference){const t={view:e,ResourceId:parsedResponse["resourceType"]+"/"+parsedResponse["id"],FormMode:"edit"};this.Parent.innerHTML="";const r=new FormView(this.Parent,this.Platform,this.Platform.CurrentSpec.Functions[0].Views[e],t,this.OptionalParameters);this.OptionalParameters.push("invoke")}else{if(this.ParentView){const t=this.Platform.CurrentSpec.Functions[0].Views[e]["TemplateId"];const r=this.Platform.CurrentSpec.FormTemplates[t]["Fields"];const s={ResourceId:parsedResponse["resourceType"]+"/"+parsedResponse["id"],FormMode:"edit",ParentContext:this.ParentContext,Fields:r};const n=this.Platform.ActivateSubView("SubFormView",s);n.SetButtons([],(()=>{this.Refresh()}))}else{const t="?view="+e+"&ResourceId="+parsedResponse["resourceType"]+"/"+parsedResponse["id"]+"&FormMode=edit";this.Platform.SwitchView(t)}}};const e={Id:"noButton",Name:"no",Text:"No",ClassNames:["red"],Action:()=>{}};const t={Id:"yesButton",Name:"yes",ClassNames:["green"],Text:"Yes",Action:e=>{action()}};if(this.FormViewController.Changed){const r=new WebClient.MessageBox("Changes were detected on this resource. Do you want to leave this page without saving?",[t,e]);r.Show()}else{action()}}))}}if(!this.readOnlyForm){const removeButton=document.createElement("button");DOMUtils.AddClass(removeButton,"referenceButton autowidth");removeButton.innerText="Remove";removeButton.style.backgroundColor=WebClient.Colors.Alizarin;actionButtonsContainer.appendChild(removeButton);removeButton.addEventListener("click",(()=>{let found=false;if(thisParameter.hasOwnProperty("targetProperty")){reverseReferencesInLine["operation"]="REMOVE"}else{const path=referencesContainer.getAttribute("path").replace(".reference","");const resourceProperty=eval("this.FormViewController.ResourceData."+path);if(Array.isArray(resourceProperty)){for(let i=0;i<resourceProperty.length;i++){if(resourceProperty[i].hasOwnProperty("reference")){if(resourceProperty[i]["reference"]===parsedResponse["resourceType"]+"/"+parsedResponse["id"])found=true}else if(resourceProperty[i].hasOwnProperty("display")){if(resourceProperty[i]["display"]===referenceRow.querySelector("input").value)found=true}if(found){eval("this.FormViewController.ResourceData."+path+".splice(i, 1)");break}}if(resourceProperty.length===0)eval("delete this.FormViewController.ResourceData."+path)}else{eval("delete this.FormViewController.ResourceData."+path)}}referenceRow.remove();if(referencesContainer.getElementsByClassName("referenceRow").length===0)referencesContainer.querySelector(".referenceNoneLabel").style.display="block";this.FormViewController.Changed=true;if(!fieldProperties["ReadOnly"]&&maxReferences==="1"&&!fieldProperties["ReadOnly"])addButton.style.display="inline-block"}))}}createResourceTabs(parentContainter,resources,fieldProperties){let tabsHeader;let tabsBody;const tabsContainer=DOMUtils.div({className:"tabsContainer",children:[tabsHeader=DOMUtils.div({className:"tabsHeader"}),tabsBody=DOMUtils.div({className:"tabsBody"})]});parentContainter.appendChild(tabsContainer);for(let i=0;i<resources.length;i++){const thisResource=resources[i]["resource"];let tabNameText;try{tabNameText=eval("thisResource."+fieldProperties["tabNameExpression"])}catch(e){tabNameText=thisResource["resourceType"].toUpperCase()+" "+i}const tabName=DOMUtils.div({className:"tabName",innerText:tabNameText});tabsHeader.appendChild(tabName);if(i===0)tabName.classList.add("activeTab");else tabName.classList.add("inactiveTab");const tabContent=DOMUtils.div({className:"tabContent"});const parameters={ResourceId:thisResource["resourceType"]+"/"+thisResource["id"],FormMode:"edit",ReadOnlyForm:true,TabForm:true};const form=new FormView(tabContent,this.Platform,this.Platform.CurrentSpec.Functions[0].Views[fieldProperties["TabFormView"]],parameters,null,this);tabsBody.appendChild(tabContent);if(i>0)tabContent.style.display="none";tabName.addEventListener("click",(()=>{const e=tabsHeader.children;for(let t=0;t<e.length;t++){e[t].classList.remove("activeTab");e[t].classList.add("inactiveTab")}tabName.classList.remove("inactiveTab");tabName.classList.add("activeTab");const t=tabsBody.children;for(let e=0;e<t.length;e++){t[e].style.display="none"}tabContent.style.display="block";this.OnWindowResize(0,0)}))}}expandContract(e,t){if(e.style.height!=="fit-content"){e.style.height="fit-content";t.innerText="Collapse ▲"}else{e.style.height="68px";t.innerText="Expand ▼"}}appendStringInputAsReference(parent,thisParameter,fieldProperties){const container=document.createElement("div");DOMUtils.AddClass(container,"StringAsReferenceContainer");const referenceBoxLabel=parent.querySelector("h3");parent.insertBefore(container,referenceBoxLabel.nextSibling);const stringReference=document.createElement("input");DOMUtils.ForceCharacter(stringReference);stringReference.style.marginRight="15px";DOMUtils.ForceNoSpecialCharacters(stringReference);stringReference.setAttribute("type","text");DOMUtils.AddClass(stringReference,"stringReference");DOMUtils.AddClass(stringReference,"stringReference");container.appendChild(stringReference);const selectResourceType=document.createElement("select");DOMUtils.AddClass(selectResourceType,"referenceButton selectResourceType");container.appendChild(selectResourceType);const divBreakLine=document.createElement("div");divBreakLine.className="breakLine";const altSelectResourceBtn=document.createElement("button");DOMUtils.AddClass(altSelectResourceBtn,"referenceButton autowith altSelectResourceBtn");altSelectResourceBtn.innerText="Pick...";container.appendChild(divBreakLine);container.appendChild(altSelectResourceBtn);const okButtonHandler=()=>{const valueToSet=stringReference.value;if(valueToSet){let displayRefExists=false;let resourceProperty;const addButton=parent.querySelector("h3").querySelector(".referenceButton");let basePath="this.FormViewController.ResourceData";let thisParameterSplit=parent.getAttribute("path").replace(".reference","").split(".");for(let x=0;x<thisParameterSplit.length;x++){const regex=/\[([0-9]*)\]/;const regexResult=regex.exec(thisParameterSplit[x]);const indexZeroCheck=Array.isArray(eval(basePath))?"[0]":"";let isArray;let newPath;if(regexResult){newPath=basePath+indexZeroCheck+"['"+thisParameterSplit[x].replace(regexResult[0],"")+"']";isArray=true}else{newPath=basePath+indexZeroCheck+"['"+thisParameterSplit[x]+"']";isArray=false}if(x<thisParameterSplit.length-1){if(isArray)eval(newPath+" = [{}]");else eval(newPath+" = {}")}else{eval("resourceProperty = "+newPath);if(!resourceProperty){eval(newPath+" = []");eval("resourceProperty = "+newPath)}}basePath=newPath}if(Array.isArray(resourceProperty)&&thisParameter["max"]!=="1"){for(let e=0;e<resourceProperty.length;e++){if(resourceProperty[e].hasOwnProperty("display")&&resourceProperty[e]["display"].toUpperCase()===valueToSet.toUpperCase())displayRefExists=true}if(!displayRefExists)resourceProperty.push({display:valueToSet})}else{if(thisParameter["max"]==="1")eval(basePath+" = {display: '"+valueToSet+"'}");else eval(basePath+" = [{display: '"+valueToSet+"'}]")}if(!displayRefExists&&valueToSet!==""){if(parent.getAttribute("max")==="1")addButton.style.display="none";this.FormViewController.Changed=true;addButton.style.backgroundColor="";container.style.display="none";const e={path:parent.getAttribute("path").replace(".reference","")+".display"};this.fillReferenceBlock({display:valueToSet},e,parent,fieldProperties)}}else{WebClient.Toaster.ShowToast("Please enter a description.",WebClient.Colors.Orange,3)}};const okButton=document.createElement("button");okButton.innerText="Ok";okButton.className="referenceButton autowith";okButton.addEventListener("click",okButtonHandler);container.appendChild(okButton);if(thisParameter.hasOwnProperty("targetProperty")||fieldProperties["ForceReference"]){stringReference.placeholder="Pick a resource";okButton.style.display="none";stringReference.readOnly=true}else{stringReference.placeholder="Enter a simple description or pick a resource"}const cancelButtonHandler=()=>{container.style.display="none";const e=parent.querySelector("h3").querySelector(".referenceButton");e.style.backgroundColor="";if(parent.getElementsByClassName("referenceRow").length===0)parent.querySelector(".referenceNoneLabel").style.display="block"};const cancelButton=document.createElement("button");cancelButton.innerText="Cancel";cancelButton.className="referenceButton autowidth";cancelButton.style.backgroundColor=WebClient.Colors.Alizarin;cancelButton.addEventListener("click",cancelButtonHandler);container.appendChild(cancelButton)}createFromParameter(e,t){const r=this.FormViewController.GetIDindex(t);if(r.IDindex<0)return;this.FormViewController.ResourceIDs[r.IDindex]="";if(this.Fields[r.IDindex].Required)r.Parameter["min"]="1";this.createFromParameter(e,t);if(r.Parameter.hasOwnProperty("type")&&r.Parameter["type"][0].code==="Reference"||r.Parameter["type"][0].code==="Resource"){this.FormViewController.CreateReferenceBlock(e,r.IDindex,r.Parameter);return}const s=this.FormViewController.ResourceType;const n=r.IDindex;const o=r.Parameter;const a=document.createElement("div");this.elementContainers.push(a);a.style.display="none";a.classList.add("formViewLabel");a.setAttribute("hidden",this.Fields[r.IDindex].Hidden?"true":"false");const l=document.createElement("h2");const c=parseInt(o["min"])>0?"* ":"";l.innerText=c+this.Fields[r.IDindex].Label||"";a.appendChild(l);e.appendChild(a);const d=document.createElement("div");a.appendChild(d);const createInputCallback=e=>{var t;this.waitingDataCallback=false;const r=this.createInput(d,n,o,e);if(r&&r.value&&typeof r.value==="string"&&((t=r.value)===null||t===void 0?void 0:t.includes("T"))&&Utils.IsValidDate(r.value)){a.classList.add("half")}};if(FhirClient.ValueHelper.StructureDefinitions[this.FormViewController.ResourceType]!==null){const e=FhirClient.ValueHelper.StructureDefinitions[s]["snapshot"].element;for(let t=0;t<e.length;t++){if(e[t]["path"].toLowerCase()===r.Parameter["id"].toLowerCase()){if(e[t].hasOwnProperty("binding")){this.waitingDataCallback=true;FhirClient.ValueHelper.GetValueSet(e[t],createInputCallback)}else{createInputCallback()}break}}}else{createInputCallback()}}orderFields(){for(let e=0;e<this.elementContainers.length;e++){const t=this.elementContainers[e];if(t.getAttribute("hidden")==="false")t.style.display="flex"}for(let e=0;e<this.ReferenceBlocks.length;e++){const t=this.ReferenceBlocks[e];if(t.getAttribute("hidden")==="false")t.style.display="block"}let e=[].concat(this.elementContainers,this.ReferenceBlocks);const t=e[0].parentElement;const r=this.Fields.slice();let s=t.firstChild;for(let n=0;n<r.length;n++){for(let o=0;o<e.length;o++){const a=e[o];let l=a.getAttribute("path");if(l){if(r[n].hasOwnProperty("Expression")){let c=r[n]["Expression"];if(c===l){t.insertBefore(a,s.nextSibling);s=a;e.splice(o,1);r.splice(n,1);n=-1;break}}}}}for(let e=0;e<this.Inputs.length;e++){this.FormViewController.EnforceHumanNameConstraints(this.Inputs[e])}}getReferenceTitle(e){const t=e["path"].split(".");const r=t[t.length-1];const s=r.charAt(0).toUpperCase()+r.slice(1);return s}processChoiceOfTypes(e){let t=e;if(e.indexOf("[x]")>-1){t="";const r=e.split(".");for(let e=1;e<r.length;e++){t+=r[e]+(e<r.length-1?".":"")}const s=r[0].replace("[x]","");const n=r[1].replace(s,"");return{cleanExpression:t,fieldType:n}}return{cleanExpression:t}}createInput(inputBox,IDindex,elementParameter,valueSet){var _a;let input;const inputProps={value:undefined,path:undefined};const expression=this.Fields[IDindex].Expression;const defaultValue=Utils.ResolveVariables(null,this.Fields[IDindex].DefaultValue);const inputType=(_a=this.Fields[IDindex].InputType)!==null&&_a!==void 0?_a:"input";const processedExpression=this.processChoiceOfTypes(expression);const structureType=(processedExpression.hasOwnProperty("fieldType")?processedExpression["fieldType"]:elementParameter["type"][0].code).toUpperCase();const localResourceData=this.FormViewController.ResourceData;let evalParameter;try{const cleanExpression=processedExpression["cleanExpression"];evalParameter=eval("localResourceData."+cleanExpression);if(evalParameter===undefined)evalParameter=null}catch(e){evalParameter=null}inputProps.value=evalParameter;inputProps.path=expression;if(valueSet&&!this.Fields[IDindex].InputType){input=document.createElement("select");const createOptions=e=>{for(let t=0;t<e.length;t++){let r=e[t];const s=document.createElement("option");const n=e[t].hasOwnProperty("display")?e[t]["display"]:e[t]["code"];if(r.hasOwnProperty("extension")){r["system"]=r["extension"][0].url;delete r["extension"];delete r["definition"]}s.setAttribute("object",JSON.stringify(e[t]));s.value=e[t]["code"];s.text=n;input.appendChild(s)}};if(valueSet.hasOwnProperty("concept")){const e=Array.from(valueSet["concept"]);e.unshift({code:"-- Select an option --",display:"-- Select an option --"});createOptions(e)}else{const e=valueSet["compose"].include;for(let t=0;t<e.length;t++){if(e[t].hasOwnProperty("concept")){const r=Array.from(e[t]["concept"]);r.unshift({code:"-- Select an option --",display:"-- Select an option --"});createOptions(r)}}}if(defaultValue)input.value=defaultValue;input.disabled=this.Fields[IDindex].ReadOnly}else if(this.datePickerTypes.indexOf(structureType)>-1){let e;let t=new Date;let r=new Date;let s=false;input=document.createElement("div");switch(this.FormViewController.FormMode){case FormView_1.EFormMode.edit:if(defaultValue||evalParameter!==null&&evalParameter.indexOf("-")!==-1){const t=defaultValue||evalParameter;const r=t.split("-");e=new Date(parseInt(r[0]),parseInt(r[1])-1,parseInt(r[2]));s=true}else{e=null;t=null;r=null}break;default:if(defaultValue){const t=defaultValue.split("-");e=new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]));s=true}else{e=null}t=null;r=null}let n;const o=WebClient.EDateRangeType.Single;const a=0;if(structureType==="PERIOD"||structureType==="INSTANT"||(defaultValue===null||defaultValue===void 0?void 0:defaultValue.indexOf("T"))>-1){const e=defaultValue||evalParameter;n="";if((this.FormViewController.FormMode===FormView_1.EFormMode.edit||(defaultValue===null||defaultValue===void 0?void 0:defaultValue.indexOf("T"))>-1)&&e){if(e.indexOf("T")>-1){const t=e.split("T")[1].split(":");n=Utils.AddZeroToN(t[0])+":"+Utils.AddZeroToN(t[1])}}}const l=new WebClient.DateRangePicker(input,{date:e,from:t,to:r,range:a,type:o},{onlySingle:true,allowEmpty:true,readOnly:this.Fields[IDindex].ReadOnly},s,n)}else if(structureType==="CONTACTPOINT"){const e=new WebClient.ContactPointControl(inputBox,this.FormViewController.ResourceData)}else if(structureType==="ADDRESS"){const e=new WebClient.AddressControl(inputBox,this.FormViewController.ResourceData)}else{input=document.createElement(inputType);if(defaultValue)input.value=defaultValue;if(inputType==="input"){input.setAttribute("type","text")}else if(inputType==="textarea"){input.style.maxWidth="100%";input.style.width="800px";input.style.height="250px"}}if(this.complexControls.indexOf(structureType)===-1){if((this.FormViewController.FormMode===FormView_1.EFormMode.edit||this.FormViewController.FormMode===FormView_1.EFormMode.reference)&&!defaultValue)input.value=evalParameter!==undefined?evalParameter:"";let e=false;if(this.FormViewController.ResourceType==="Practitioner"){if(!localResourceData["active"]&&localResourceData["active"]!==undefined)e=true}input.readOnly=!e?this.Fields[IDindex].ReadOnly:true;inputBox.parentElement.setAttribute("path",this.Fields[IDindex].Expression);input.setAttribute("path",this.processChoiceOfTypes(this.Fields[IDindex].Expression)["cleanExpression"]);input.setAttribute("structureType",structureType);input.setAttribute("min",elementParameter["min"]);input.setAttribute("max",elementParameter["max"]);inputBox.appendChild(input);this.Inputs.push(input)}if(this.elementContainers.length+this.ReferenceBlocks.length+this.FormViewController.Extensions.length===this.fieldsOrder.length&&!this.waitingDataCallback)this.orderFields();if(!this.TabForm)this.OnWindowResize(0,0);return inputProps}selectAction(resourceToSend,thisResourceCleanCopy,fieldProperties,context){if(this!==context.thisView){context.thisView.selectAction(resourceToSend,thisResourceCleanCopy,fieldProperties,context);return}const referencePath=resourceToSend["resourceType"]+"/"+resourceToSend["id"];let resourceProperty;let referenceExists=false;let contentExists=false;const checkForContentExpressions=fieldProperties["CheckReferenceContent"];this.ShowPanes(true);const continuePick=e=>{if(referenceExists){WebClient.Toaster.ShowToast("Reference already exists.",WebClient.Colors.Orange,3)}else if(contentExists||e){WebClient.Toaster.ShowToast("Reference content already exists.",WebClient.Colors.Orange,3)}else{this.fillReferenceBlock(resourceToSend,context.thisParameter,context.referencesContainer,fieldProperties);this.FormViewController.Changed=true;if(context.addButton)context.addButton.style.display="none"}};if(context.thisParameter.hasOwnProperty("targetProperty")){for(let x=0;x<this.FormViewController.ReverseReferencesToProcess.length;x++){let reverseReference=this.FormViewController.ReverseReferencesToProcess[x];if(checkForContentExpressions){for(let y=0;y<checkForContentExpressions.length;y++){const baseObject=reverseReference["resourceToUpdate"];const reverseReferenceContent=eval("baseObject."+checkForContentExpressions[y]);const selectedResourceContent=eval("thisResourceCleanCopy."+checkForContentExpressions[y]);if(reverseReferenceContent===selectedResourceContent&&reverseReference["operation"]==="ADD"){contentExists=true;break}}}if(reverseReference["resourceToUpdate"]["id"]===thisResourceCleanCopy["id"]){if(reverseReference["operation"]==="ADD")referenceExists=true;else reverseReference["operation"]="ADD"}}continuePick()}else{let basePath="this.FormViewController.ResourceData";let thisParameterSplit=context.referencesContainer.getAttribute("path").replace(".reference","").split(".");for(let x=0;x<thisParameterSplit.length;x++){const regex=/\[([0-9]*)\]/;const regexResult=regex.exec(thisParameterSplit[x]);let isArray;const indexZeroCheck=Array.isArray(eval(basePath))?"[0]":"";let newPath;if(regexResult){newPath=basePath+indexZeroCheck+"['"+thisParameterSplit[x].replace(regexResult[0],"")+"']";isArray=true}else{newPath=basePath+indexZeroCheck+"['"+thisParameterSplit[x]+"']";isArray=false}if(x<thisParameterSplit.length-1){if(isArray)eval(newPath+" = [{}]");else eval(newPath+" = {}")}else{eval("resourceProperty = "+newPath);if(!resourceProperty){eval(newPath+" = []");eval("resourceProperty = "+newPath)}}basePath=newPath}if(Array.isArray(resourceProperty)&&context.thisParameter["max"]!=="1"){if(resourceProperty.length===0){resourceProperty.push({reference:referencePath});continuePick()}else{for(let e=0;e<resourceProperty.length;e++){if(resourceProperty[e].hasOwnProperty("reference")&&resourceProperty[e]["reference"].toUpperCase()===referencePath.toUpperCase())referenceExists=true}if(!referenceExists){if(!checkForContentExpressions){resourceProperty.push({reference:referencePath});continuePick()}else{let referencesArray=[];let contentsToCompare={};for(let y=0;y<checkForContentExpressions.length;y++){for(let e=0;e<resourceProperty.length;e++){referencesArray.push(resourceProperty[e]["reference"])}try{contentsToCompare[checkForContentExpressions[y]]=eval("resourceToSend."+checkForContentExpressions[y])}catch(e){contentsToCompare[checkForContentExpressions[y]]=""}}const pushReferenceIfOk=()=>{resourceProperty.push({reference:referencePath})};FormView.checkForReferenceContent(referencesArray,continuePick,pushReferenceIfOk,contentsToCompare)}}else{continuePick()}}}else{if(context.thisParameter["max"]==="1")eval(basePath+" = {reference: '"+referencePath+"'}");else eval(basePath+" = [{reference: '"+referencePath+"'}]");continuePick()}}}cancelAction(e){if(this!==e.thisView){e.thisView.cancelAction(e);return}this.ShowPanes(true)}createAction(e,t,r){if(this!==r.thisView){r.thisView.createAction(e,t,r);return}this.FormViewController.CreateNewResource(e,(e=>{this.selectAction(e,e,t,r)}))}static checkForReferenceContent(references,callBack,pushReferenceIfOk,contentsToCompare){let refContentExists=false;let referencesQuery=[];for(let e=0;e<references.length;e++){referencesQuery.push(references[e].split("/")[1])}WebClient.Loader.Show();const existingReferenceUrl=WebClient.PlatformContext.PlatformUri+"/fhir/"+references[0].split("/")[0]+"?_id="+referencesQuery.join(",");let existingReferenceCall=new Efferent.Frontend.FhirClient.FhirCall(existingReferenceUrl,"GET");existingReferenceCall.FuncOk=data=>{const parsedResponse=JSON.parse(data);for(let i=0;i<parsedResponse["entry"].length;i++){const thisResource=parsedResponse["entry"][i]["resource"];for(let expression in contentsToCompare){if(contentsToCompare.hasOwnProperty(expression)){let thisResourceContent;try{thisResourceContent=eval("thisResource."+expression)}catch(e){thisResourceContent=""}if(thisResourceContent===contentsToCompare[expression]){refContentExists=true;break}}}}if(!refContentExists)pushReferenceIfOk();callBack(refContentExists);WebClient.Loader.Hide()};existingReferenceCall.FuncError=()=>{WebClient.Toaster.ShowToast("Could not get resources to compare contents.",WebClient.Colors.Alizarin,3);pushReferenceIfOk();callBack(false);WebClient.Loader.Hide()};existingReferenceCall.Send()}}FormView_1.FormView=FormView})(FormView=ClientViews.FormView||(ClientViews.FormView={}))})(ClientViews=Efferent.ClientViews||(Efferent.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(Efferent){var ClientViews;(function(ClientViews){var FormView;(function(FormView){var WebClient=Efferent.Frontend.WebClient;var FhirClient=Efferent.Frontend.FhirClient;var Utils=Efferent.Frontend.WebClient.Utils;var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;let EFormMode;(function(e){e[e["read"]=0]="read";e[e["new"]=1]="new";e[e["edit"]=2]="edit";e[e["reference"]=3]="reference"})(EFormMode=FormView.EFormMode||(FormView.EFormMode={}));class FormViewController{constructor(e){this.invalidDataDetected=false;this.emptyRequiredField=false;this.badInputNotices=[];this.ResourceIDs=[];this.Extensions=[];this.Changed=false;this.StringUpdateDCMBodyObject=null;this.ReverseReferencesToProcess=[];this.FormView=e;this.FormViewManager=new FormView.FormViewManager}GetControlsForConstructor(e){WebClient.Loader.Show();switch(e){case EFormMode.edit:if(this.FormView.HardResourceData){this.ResourceData=this.FormView.HardResourceData;FhirClient.ValueHelper.GetStructureDefinition(this.ResourceType,this.FormView.InjectFields.bind(this.FormView,[this.Title,this.ResourceType]))}else{this.FormViewManager.GetResourceForId(this.ResourceType,this.Id,((e,t,r)=>{if(!t){if(e!==""){let t=false;this.ResourceData=JSON.parse(e);if(this.ResourceData.hasOwnProperty("meta")&&this.ResourceData["meta"].tag!==undefined){this.ResourceData["meta"].tag.forEach((e=>{if(e["code"]==="CASE"){WebClient.Toaster.ShowToast("Select a non CASE study from general worklist",WebClient.Colors.BelizeHole,3);t=true}}))}if(!t){FhirClient.ValueHelper.GetStructureDefinition(this.ResourceType,this.FormView.InjectFields.bind(this.FormView,[this.Title,this.ResourceType]))}else{if(this.FormView.ParentView)this.FormView.ParentView.CloseSubView();else{const e=[{lastResourceId:WebClient.HttpUtils.GetUrlParameter("ResourceId").split("/")[1]}];this.FormView.Platform.SwitchView(this.FormView.Platform.BrowsingHistory[this.FormView.Platform.BrowsingHistory.length-1],"back",e)}if(this.FormView.ParentContext)this.FormView.ParentContext.Refresh()}}}else{Utils.DebugConsoleLog(r)}}))}break;case EFormMode.reference:this.ResourceData=this.FormView.OptionalParameters[0];FhirClient.ValueHelper.GetStructureDefinition(this.ResourceType,this.FormView.InjectFields.bind(this.FormView,[this.Title,this.ResourceType]));break;default:this.ResourceData={resourceType:this.ResourceType};FhirClient.ValueHelper.GetStructureDefinition(this.ResourceType,this.FormView.InjectFields.bind(this.FormView,[this.Title,this.ResourceType]))}}GetIDindex(e){let t=[];for(let r=0;r<e.length;r++){let s=e[r]["id"].split(".");if(s.length>1)s.splice(0,1);t.push(s.join("."))}for(let r=0;r<this.ResourceIDs.length;r++){let s=this.ResourceIDs[r].split(".");const n=s.length;for(let o=0;o<n;o++){const n=t.indexOf(s.join("."));if(n>-1)return{IDindex:r,Parameter:e[n]};s.splice(-1,1)}}return{IDindex:-1}}SearchParameter(e,t){this.FormViewManager.SearchParameter(e,t)}CreateNewResource(e,t){let r=[];const s=this.FormView.Platform.CurrentSpec.FormTemplates;for(const t in s){if(s.hasOwnProperty(t)){if(s[t]["ResourceType"]===e)r=s[t]["Fields"]}}const n={ResourceId:e,FormMode:"new",Fields:r,CreateResourceCallback:t,SwitchThemeOnSubView:this.FormView.SwitchThemeOnSubView};if(this.FormView["PassParentContext"])n["ParentContext"]=this.FormView;const o=this.FormView.Platform.ActivateSubView("SubFormView",n);o.SetButtons([],(()=>{}))}CreateReferenceBlock(e,t,r,s){let n;if(r)n=r["type"][0]["targetProfile"];if(s){for(let t=0;t<s.length;t++){const r=s[t];const o=[];const a=r["Expression"];const l=a.indexOf("contained.")>-1;if(l){let e=[];FhirClient.FhirParser.GetField2(this.ResourceData,a,e);if(e){for(let t=0;t<e.length;t++){if(e[t][r["TargetProperty"]]["reference"]==="#"){o.push(e[t])}}}}const c={min:r["Required"]?1:0,max:"*",path:a,targetProperty:r["TargetProperty"]};if(!l||l&&o.length>0){const t=["http://hl7.org/fhir/StructureDefinition/"+a];if(this.FormMode===EFormMode.edit){if(l){this.FormView.CreateReferenceBlockAction(c,e,t,o,r)}else{const s=WebClient.PlatformContext.PlatformUri+(r["NoFhir"]?"/":"/fhir/")+a+"?"+r["TargetProperty"]+"="+this.ResourceData["id"];let n=new Efferent.Frontend.FhirClient.FhirCall(s,"GET");WebClient.Loader.Show();n.FuncOk=s=>{const n=JSON.parse(s);if(n["total"]>0)this.FormView.CreateReferenceBlockAction(c,e,t,n,r);else this.FormView.CreateReferenceBlockAction(c,e,t,null,r);WebClient.Loader.Hide()};n.FuncError=()=>{this.FormView.CreateReferenceBlockAction(c,e,t,null,r);WebClient.Toaster.ShowToast("Could not get reverse references.",WebClient.Colors.Alizarin,3);WebClient.Loader.Hide()};n.Send()}}else{this.FormView.CreateReferenceBlockAction(c,e,t,null,r)}}else{this.FormView.CreateReferenceBlockAction(c,e,n,null,r)}}}else{try{this.FormViewManager.LoadResourceData(this.ResourceData,this.FormView.Fields[t],r,((s,o)=>{if(!o)this.FormView.CreateReferenceBlockAction(r,e,n,s,this.FormView.Fields[t]);else this.FormView.CreateReferenceBlockAction(r,e,n,null,this.FormView.Fields[t])}))}catch(s){this.FormView.CreateReferenceBlockAction(r,e,n,null,this.FormView.Fields[t])}}}UnwrapParamaters(e,t,r){DOMUtils.AddClass(t,"multipleFieldsBox");if(Array.isArray(r)){for(let s=0;s<r.length;s++){for(const n in r[s]){if(r[s].hasOwnProperty(n))this.FormView.InjectUnwrappedField(e,t,r[s][n])}}}else{for(const s in r){if(r.hasOwnProperty(s)){if(typeof r[s]==="string"){this.FormView.InjectUnwrappedField(e,t,r[s])}else if(typeof r[s]==="object"){for(const n in r[s]){if(r[s].hasOwnProperty(n))this.FormView.InjectUnwrappedField(e,t,r[s][n])}}}}}}EnforceHumanNameConstraints(e){if(e.getAttribute("structuretype")==="HUMANNAME"){e.onkeydown=e=>{const t=/[,;\.\/_]+/.test(e.key);return!t}}}SaveData(saveAndClose,localSave,simpleUpdate){let enforcedTextNames=[];WebClient.Loader.Show();this.NewResourceData=this.ResourceData;this.removeInvalidInputNotice();this.invalidDataDetected=false;this.emptyRequiredField=false;if(!simpleUpdate){for(let i=0;i<this.FormView.Inputs.length;i++){const structuretype=this.FormView.Inputs[i].getAttribute("structuretype").toUpperCase();const minAttribute=this.FormView.Inputs[i].getAttribute("min");const maxAttribute=this.FormView.Inputs[i].getAttribute("max");const isRequired=minAttribute!=="0";const thisInput=this.FormView.Inputs[i];let value;let path;switch(structuretype){case"HUMANNAME":const thisPath=this.FormView.Inputs[i].getAttribute("path");let splitName;if(maxAttribute==="1"){splitName="name"}else{splitName="name[0]"}const pathBase=thisPath.split(splitName)[0]+splitName+".text";const isFamily=thisPath.split(splitName)[1]==="family";const isText=thisPath.split(splitName)[1]===".text";if(!isText){let thisNameProperty;value=this.FormView.Inputs[i].value;if(isRequired&&value===""){this.emptyRequiredField=true;this.addInvalidInputNotice(this.FormView.Inputs[i],"Required field")}try{thisNameProperty=eval("this.NewResourceData."+pathBase)}catch(e){thisNameProperty=""}let existingValueForText="";if(thisNameProperty===null||thisNameProperty===""||enforcedTextNames.indexOf(pathBase)===-1){if(maxAttribute==="1"){eval("this.NewResourceData."+thisPath.split(splitName)[0]+"name = {}")}else{eval("this.NewResourceData."+thisPath.split(splitName)[0]+"name = [{}]")}eval("this.NewResourceData."+thisPath.split(splitName)[0]+splitName+"['text'] = \""+value+'"')}else{existingValueForText=eval("this.NewResourceData."+pathBase)}if(enforcedTextNames.indexOf(pathBase)>-1){if(isFamily)eval("this.NewResourceData."+pathBase+' = "'+value.concat(" "+existingValueForText+'"'));else eval("this.NewResourceData."+pathBase+' = "'+existingValueForText.concat(" "+value+'"'))}eval("this.NewResourceData."+thisPath+' = "'+value+'"');enforcedTextNames.push(pathBase)}break;case"DATE":case"DATETIME":case"PERIOD":case"AGE":case"RANGE":case"INSTANT":value=thisInput.getAttribute("data-range").split(",")[0];if(thisInput.getAttribute("data-validDate")==="false"||thisInput.getAttribute("data-validTime")==="false"){this.invalidDataDetected=true;this.addInvalidInputNotice(thisInput,"Invalid date format")}if(thisInput.getAttribute("data-range")===","&&thisInput.getAttribute("data-time")){this.invalidDataDetected=true;this.addInvalidInputNotice(thisInput,"Time set without a date")}const setTime=thisInput.getAttribute("data-time");const dateValue=setTime?value+setTime+":00":value;if(isRequired&&dateValue===""){this.emptyRequiredField=true;this.addInvalidInputNotice(thisInput,"Required field")}path=thisInput.getAttribute("path");try{eval("this.NewResourceData."+path+' = "'+dateValue+'"')}catch(_b){const splitPath=path.split(".");eval("this.NewResourceData['"+splitPath[0]+"'] = {"+splitPath[1]+":'"+dateValue+"'}")}break;default:if(structuretype==="CODEABLECONCEPT"||structuretype==="CODE"){try{const e=this.FormView.Inputs[i];const t=JSON.parse(e.options[e.selectedIndex].getAttribute("object")).code;value=t!=="-- Select an option --"?t:""}catch(e){value=this.FormView.Inputs[i].value}}else{value=this.FormView.Inputs[i].value}if(isRequired&&(value==="-- Select an option --"||value==="")){this.emptyRequiredField=true;this.addInvalidInputNotice(this.FormView.Inputs[i],"Required field")}path=this.FormView.Inputs[i].getAttribute("path");if(this.FormMode===EFormMode.new)this.createEmptyValue(this.NewResourceData,path);try{if(structuretype==="CODEABLECONCEPT"){try{const select=this.FormView.Inputs[i];value=select.options[select.selectedIndex].getAttribute("object");const newPath=path.replace(".code","");eval("this.NewResourceData."+newPath+" = "+value);const codeObject=JSON.parse(select.options[select.selectedIndex].getAttribute("object"));let displayValue=codeObject["code"]?codeObject["display"]:"";displayValue=displayValue.replace("-- Select an option --","");const parentPath=path.split(".")[0];eval("this.NewResourceData."+parentPath+"['text'] = \""+displayValue+'"')}catch(_d){eval("this.NewResourceData."+path+' = "'+value+'"')}}else{const tempFn=()=>value;eval("this.NewResourceData."+path+" = tempFn();")}}catch(_e){if(path.indexOf("[")>-1){let resourceProperty;let basePath="this.ResourceData";let thisParameterSplit=path.split(".");for(let x=0;x<thisParameterSplit.length;x++){const isArray=thisParameterSplit[x].indexOf("[0]")>-1;const indexZeroCheck=Array.isArray(eval(basePath))?"[0]":"";let newPath=basePath+indexZeroCheck+"['"+thisParameterSplit[x].replace("[0]","")+"']";const dataExists=eval(newPath);if(x<thisParameterSplit.length-1&&!dataExists){if(isArray)eval(newPath+" = [{}]");else eval(newPath+" = {}")}else{eval("resourceProperty = "+newPath);if(!resourceProperty){eval(newPath+" = []");eval("resourceProperty = "+newPath)}}basePath=newPath}eval(basePath+' = "'+value+'"')}}}}for(let e=0;e<this.FormView.ReferenceBlocks.length;e++){const t=this.FormView.ReferenceBlocks[e];const r=t.getAttribute("min");const s=r&&r!=="0";const n=t.getElementsByClassName("referenceRow");if(s&&n.length===0){this.emptyRequiredField=true;this.addInvalidInputNotice(t,"Required field",true)}}if(this.Extensions.length>0){this.NewResourceData["extension"]=[];for(let e=0;e<this.Extensions.length;e++){this.NewResourceData["extension"].push(this.Extensions[e])}}}let verb;let resourceId="";switch(this.FormMode){case EFormMode.read:break;case EFormMode.edit:verb="PUT";resourceId="/"+this.Id;break;case EFormMode.reference:this.ResourceData=this.NewResourceData;break;case EFormMode.new:verb="POST";break}if(verb!==undefined){if(!this.emptyRequiredField&&!this.invalidDataDetected){const e=WebClient.PlatformContext.PlatformUri+"/fhir/"+this.ResourceType+resourceId;if(this.ResourceData["resourceType"]==="ImagingStudy"&&verb==="PUT"){WebClient.Loader.Show();let t={};const r=WebClient.PlatformContext.PlatformUri+"/fhir/ImagingStudy?_id="+this.ResourceData["id"]+"&_include=ImagingStudy:subject&_include=ImagingStudy:referrer&_include=ImagingStudy:location";this.FormViewManager.ProcessOperationsWithResources("GET",r,null,((r,s,n)=>{if(!s){if(n===200||n===201){if(!this.FormView.HardResourceData){let e=JSON.parse(r);for(let t=0;t<e["entry"].length;t++){if(e["entry"][t]["resource"]["resourceType"]==="ImagingStudy"){delete e["entry"][t]["resource"]["series"];break}}const s={OldBundle:e,OrganizationName:sessionStorage["organizationName"]};t["InputParameters"]=btoa(JSON.stringify(s));t["Progress"]=0;t["AuthorReference"]=sessionStorage["practitionerId"];t["Author"]=sessionStorage["userEmail"];t["Notify"]=false;t["IncludeInputFile"]=true;this.StringUpdateDCMBodyObject=JSON.stringify(t)}if(!this.invalidDataDetected&&!this.emptyRequiredField){if(localSave)return[this.NewResourceData];else this.saveDataOperation(verb,e,saveAndClose)}else{WebClient.Loader.Hide();WebClient.Toaster.ShowToast(this.invalidDataDetected?"Invalid data in the form.":"Required field is empty.",WebClient.Colors.Alizarin,3)}}}else{WebClient.Loader.Hide();WebClient.Toaster.ShowToast("Error study data.",WebClient.Colors.Alizarin,3)}}),this.FormView.HardResourceData?this.NewResourceData:null)}else{this.StringUpdateDCMBodyObject=null;if(!this.invalidDataDetected&&!this.emptyRequiredField){if(localSave)return[this.NewResourceData];else this.saveDataOperation(verb,e,saveAndClose)}else{WebClient.Loader.Hide();WebClient.Toaster.ShowToast(this.invalidDataDetected?"Invalid data in the form.":"Required field is empty.",WebClient.Colors.Alizarin,3)}}}WebClient.Loader.Hide()}else{WebClient.Loader.Hide();this.FormView.OptionalParameters[1]()}}removeInvalidInputNotice(){this.badInputNotices.forEach((e=>{e.remove()}));this.badInputNotices=[]}addInvalidInputNotice(e,t,r){const s=document.createElement("div");this.badInputNotices.push(s);s.innerText=t;if(r){DOMUtils.AddClass(s,"badInputNoticeReference");e.prepend(s)}else{DOMUtils.AddClass(s,"badInputNotice");e.parentElement.appendChild(s)}}saveDataOperation(e,t,r){WebClient.Loader.Show();this.FormViewManager.ProcessOperationsWithResources(e,t,this.NewResourceData,((t,s,n)=>{if(!s){WebClient.Loader.HideAll();if(n===200||n===201){if(e==="PUT"){WebClient.Toaster.ShowToast("Resource data was altered.",WebClient.Colors.Emerald,3);for(let e=0;e<this.FormView.SubFormsToUpdate.length;e++){this.FormView.SubFormsToUpdate[e].SaveData(false,false,true)}}else if(e==="POST"){if(n===201)WebClient.Toaster.ShowToast("Resource was created.",WebClient.Colors.Emerald,3);else WebClient.Toaster.ShowToast("Resource already exists.",WebClient.Colors.Orange,3)}this.Changed=false;this.FormView.SubFormsToUpdate=[];this.FormView.ReturnIfReference();if(this.StringUpdateDCMBodyObject!==null){WebClient.Loader.Show();WebClient.HttpUtils.AjaxCall(WebClient.PlatformContext.PlatformUri+"/task/studytools-modifier","POST","min",this.StringUpdateDCMBodyObject,(()=>{WebClient.Loader.Hide();WebClient.Toaster.ShowToast("The Dicom file was updated.",WebClient.Colors.Emerald,3)}),(()=>{WebClient.Toaster.ShowToast("Could not update the Dicom file.",WebClient.Colors.Alizarin,3);WebClient.Loader.Hide()}))}if(this.ReverseReferencesToProcess.length>0){const e=typeof t==="string"?JSON.parse(t):t;const s=e["resourceType"]+"/"+e["id"];this.manageReverseReferences(s,r)}else if(r){if(!this.FormView.ReturnIfReference()){if(this.FormView.ParentView){this.FormView.ParentView.CloseSubView();if(this.FormView.CreateResourceCallback){this.FormView.CreateResourceCallback(typeof t==="string"?JSON.parse(t):t)}}else{const e=[{lastResourceId:WebClient.HttpUtils.GetUrlParameter("ResourceId").split("/")[1]}];this.FormView.Platform.SwitchView(this.FormView.Platform.BrowsingHistory[this.FormView.Platform.BrowsingHistory.length-1],"back",e)}if(this.FormView.ParentContext&&!this.FormView.ParentContext.PassParentContext)this.FormView.ParentContext.Refresh()}}}if(this.FormView.UpdateResourceCallback){if(typeof t==="string")this.FormView.UpdateResourceCallback(JSON.parse(t));else if(typeof t==="object")this.FormView.UpdateResourceCallback(t)}}else{WebClient.Loader.Hide();WebClient.Toaster.ShowToast("Error saving resource data.",WebClient.Colors.Alizarin,3);this.FormView.ReturnIfReference()}}),this.FormView.HardResourceData?this.NewResourceData:null)}manageReverseReferences(e,t){const r=this.ReverseReferencesToProcess.length;let s=0;for(let n=0;n<r;n++){let o=this.ReverseReferencesToProcess[n]["resourceToUpdate"];let a=false;const l=this.ReverseReferencesToProcess[n]["targetProperty"];const c=new FhirClient.FhirCall(WebClient.PlatformContext.PlatformUri+"/fhir/"+o["resourceType"]+"/"+o["id"],"PUT");const d=this.ReverseReferencesToProcess[n]["operation"];switch(d){case"ADD":if(!o[l]||o[l]["reference"]!==e){o[l]={reference:e};a=true}break;case"REMOVE":if(o[l]){delete o[l];a=true}break;default:}if(a){WebClient.Loader.Show();c.BodyData=JSON.stringify(o);c.FuncOk=()=>{WebClient.Loader.Hide();s++;if(d==="REMOVE")this.ReverseReferencesToProcess.splice(n,1);if(s===r){WebClient.Toaster.ShowToast("Reverse references updated",WebClient.Colors.Emerald,3);if(t){if(this.FormView.ParentView)this.FormView.ParentView.CloseSubView();else{const e=[{lastResourceId:WebClient.HttpUtils.GetUrlParameter("ResourceId").split("/")[1]}];this.FormView.Platform.SwitchView(this.FormView.Platform.BrowsingHistory[this.FormView.Platform.BrowsingHistory.length-1],"back",e)}if(this.FormView.ParentContext)this.FormView.ParentContext.Refresh()}}};c.FuncError=()=>{WebClient.Loader.Hide();WebClient.Toaster.ShowToast("Error processing reverse reference",WebClient.Colors.Alizarin,3)};c.Send()}else{s++;if(s===r&&t){if(this.FormView.ParentView)this.FormView.ParentView.CloseSubView();else{const e=[{lastResourceId:WebClient.HttpUtils.GetUrlParameter("ResourceId").split("/")[1]}];this.FormView.Platform.SwitchView(this.FormView.Platform.BrowsingHistory[this.FormView.Platform.BrowsingHistory.length-1],"back",e)}if(this.FormView.ParentContext)this.FormView.ParentContext.Refresh()}}}}createEmptyValue(newResourceData,path){const splitPathProperty=path.split(".");let evalNewResourceData=newResourceData;let testPath="";for(let i=0;i<splitPathProperty.length;i++){const propertySegment=splitPathProperty[i];const prePath=testPath;let allowCreation=false;testPath+="."+propertySegment;try{const test=eval("evalNewResourceData"+testPath);if(test===undefined)allowCreation=true}catch(e){allowCreation=true}if(allowCreation){const arrayOrObject=propertySegment.indexOf("[")>-1?"[{}]":"{}";eval("newResourceData"+prePath+"['"+propertySegment.split("[")[0]+"'] = "+arrayOrObject)}}}}FormView.FormViewController=FormViewController})(FormView=ClientViews.FormView||(ClientViews.FormView={}))})(ClientViews=Efferent.ClientViews||(Efferent.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(Efferent){var ClientViews;(function(ClientViews){var FormView;(function(FormView){var WebClient=Efferent.Frontend.WebClient;var FhirClient=Efferent.Frontend.FhirClient;class FormViewManager{GetResourceForId(e,t,r){const s=WebClient.PlatformContext.PlatformUri+"/fhir/"+e+"/"+t;FhirClient.FhirCall.Retrieve(s,"GET",r)}ProcessOperationsWithResources(e,t,r,s,n){this.processData(t,e,r,s,n)}SearchParameter(e,t){const r=WebClient.Utils.Capitalize(e);const s=sessionStorage["technology"]==="Efferent"?"/fhir/SearchParameter?base="+r:"/azurestorage/"+r+".json";const n=WebClient.PlatformContext.PlatformUri+s;FhirClient.FhirCall.Retrieve(n,"GET",t)}LoadResourceData(localResourceData,fieldProperties,parameter,callBack){const localResourceDataEval=localResourceData;const expression=fieldProperties["Expression"];let evalParameterA;if(fieldProperties.hasOwnProperty("DefaultValue")){let resourceProperty;evalParameterA=fieldProperties["DefaultValue"];let basePath="localResourceData";let expressionSplit=fieldProperties["Expression"].replace(".reference","").split(".");for(let i=0;i<expressionSplit.length;i++){const isArray=expressionSplit[i].indexOf("[0]")>-1;const indexZeroCheck=Array.isArray(eval(basePath))?"[0]":"";let newPath=basePath+indexZeroCheck+"['"+expressionSplit[i].replace("[0]","")+"']";if(i<expressionSplit.length-1){if(isArray)eval(newPath+" = [{}]");else eval(newPath+" = {}")}else{eval("resourceProperty = "+newPath);if(!expressionSplit){eval(newPath+" = []");eval("resourceProperty = "+newPath)}}basePath=newPath}if(parameter["max"]==="1")eval(basePath+" = {reference: '"+evalParameterA+"'}");else eval(basePath+" = [{reference: '"+evalParameterA+"'}]")}else{evalParameterA=eval("localResourceDataEval."+expression)}if(evalParameterA){const e=WebClient.PlatformContext.PlatformUri+"/fhir/"+evalParameterA;FhirClient.FhirCall.Retrieve(e,"GET",callBack)}else{if(expression.indexOf(".reference")>-1){const cleanExpression=expression.replace(".reference","");try{const evalParameterB=eval("localResourceDataEval."+cleanExpression);if(Array.isArray(evalParameterB)&&evalParameterB.length>0){const e=[];for(let t=0;t<evalParameterB.length;t++){if(evalParameterB[t].hasOwnProperty("reference"))e.push(WebClient.PlatformContext.PlatformUri+"/fhir/"+evalParameterB[t]["reference"]);else if(evalParameterB[t].hasOwnProperty("display")||evalParameterB[t].hasOwnProperty("resourceType"))e.push(evalParameterB[t])}FhirClient.FhirCall.Retrieve(e,"GET",callBack)}else if(evalParameterB.hasOwnProperty("display")){callBack(evalParameterB,false)}else{callBack(null,true)}}catch(e){callBack(null,true)}}else{callBack(null,true)}}}processData(e,t,r,s,n){if(n){s(n,false,200)}else{const n=new Efferent.Frontend.FhirClient.FhirCall(e,t);if(t!=="GET"){n.BodyData=JSON.stringify(r);n.Headers={"Content-Type":"application/json; charset=utf-8"}}n.FuncOk=(e,t)=>{s(e,false,t)};n.FuncError=e=>{s(null,true,e)};n.Send()}}}FormView.FormViewManager=FormViewManager})(FormView=ClientViews.FormView||(ClientViews.FormView={}))})(ClientViews=Efferent.ClientViews||(Efferent.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(Efferent){var ClientViews;(function(ClientViews){var FormView;(function(FormView){var DOMUtils=Efferent.Frontend.WebClient.DOMUtils;var WebClient=Efferent.Frontend.WebClient;class GridListPane extends WebClient.WorklistGrid{constructor(e,t,r,s){let n;if(s){n=t.Platform.CurrentSpec.GridTemplates[s]}else{let e;if(r.hasOwnProperty("entry"))e=r["entry"][0]["resource"]["resourceType"];else if(Array.isArray(r))e=r[0]["resourceType"];const s=t.Platform.CurrentSpec.GridTemplates;for(const t in s){if(s[t]["ResourceType"]===e){n=s[t];break}}}let o=[];for(let e=0;e<n["Columns"].length;e++){const t=n["Columns"][e]["Label"];o.push(new WebClient.WorklistColumn(t,180,((e,t)=>{}),WebClient.EWorklistSort.None,WebClient.EWorklistFilter.Up))}super(o);this.dateFormat=t.Platform.GetSetting("dateFormat");this.listGridTemplate=n;this.Controller=t;this.worklistPaneSection=document.createElement("div");this.Parent=e;const a=document.createElement("div");DOMUtils.AddClass(a,"worklistPane");a.appendChild(this.worklistPaneSection);const l=document.createElement("table");l.setAttribute("class","workListTable");this.table=l;const c=document.createElement("ul");c.setAttribute("class","workListUl");this.list=c;const d=document.createElement("thead");const h=document.createElement("tbody");this.tHead=d;this.tBody=h;this.table.appendChild(d);this.table.appendChild(h);this.resourcesSection=a;this.navigationButtonsContainer=document.createElement("div");this.worklistPaneSection.appendChild(this.navigationButtonsContainer);this.worklistPaneSection.appendChild(this.table);this.worklistPaneSection.appendChild(this.list);this.Parent.appendChild(this.resourcesSection);this.fillGrid(r)}GetResources(e){const t=WebClient.PlatformContext.PlatformUri+"/"+e;const r=new Efferent.Frontend.FhirClient.FhirCall(t,"GET");WebClient.Loader.Show();r.FuncOk=e=>{WebClient.Loader.HideAll();if(e!=="")this.fillGrid(JSON.parse(e))};r.FuncError=()=>{WebClient.Loader.Hide();WebClient.Toaster.ShowToast("Could not load resources list.",WebClient.Colors.Alizarin,3)};r.Send()}createNavigationButtons(e){const t=e["link"];this.navigationButtonsContainer.innerHTML="";for(let e=0;e<t.length;e++){if(t[e].url!==""){const r=document.createElement("div");r.setAttribute("url",t[e].url);DOMUtils.AddClass(r,"navButton");switch(t[e].relation){case"self":r.style.backgroundImage="url('"+Efferent.ClientViews.CommonView.ResourceBag.Icons8Refresh32Png+"')";break;case"first":r.style.backgroundImage="url('"+Efferent.ClientViews.CommonView.ResourceBag.Icons8First132Png+"')";break;case"last":r.style.backgroundImage="url('"+Efferent.ClientViews.CommonView.ResourceBag.Icons8Last132Png+"')";break;case"next":r.style.backgroundImage="url('"+Efferent.ClientViews.CommonView.ResourceBag.Icons8Forward32Png+"')";break;case"previous":r.style.backgroundImage="url('"+Efferent.ClientViews.CommonView.ResourceBag.Icons8Back32Png+"')";break}r.addEventListener("click",(e=>{const t=e.target.getAttribute("url");this.GetResources(t)}));if(t[e].url!==undefined&&t[e].url!=="")this.navigationButtonsContainer.appendChild(r)}}}buildTableHeader(){this.tHead.innerHTML="";super.CreateHead(this.tHead)}buildBodyTable(e,t){this.tBody.innerHTML="";this.list.innerHTML="";const r=new Array;this.From=1;this.PageSize=10;for(const t in e){if(e.hasOwnProperty(t)){const s=e[t];const n=new Array;for(const e in s){if(s.hasOwnProperty(e)){let t;if(s[e]instanceof Object)t=WebClient.ECellType.Checkbox;else t=WebClient.ECellType.Text;n.push(new WebClient.ItemCell(s[e],t))}}const o=new WebClient.WorklistRow(s,n,(()=>{const e=this.GetRowsPerSelectedEntities();this.selectedRow=e[0]["elementTableTr"];this.selectedRowAlt=e[0]["elementListLi"]}),(()=>{}),this);r.push(o)}}this.Rows=r;super.CreateBody(this.tBody,this.list,(()=>{}),(()=>{}))}fillGrid(parsedData){const arrayResources=new Array;this.buildTableHeader();let resources;let contained;if(parsedData.hasOwnProperty("entry")){this.createNavigationButtons(parsedData);resources=Efferent.Frontend.FhirClient.FhirParser.ProcessBundle(parsedData,this.listGridTemplate["ResourceType"]);contained=false}else if(Array.isArray(parsedData)){resources=parsedData;contained=true}if(resources.length>0){for(let i=0;i<resources.length;i++){const item={};const thisResource=resources[i];const thisFormViewController=this.Controller.FormViewController;const resourceData=thisFormViewController.ResourceData;for(let x=0;x<this.listGridTemplate["Columns"].length;x++){const column=this.listGridTemplate["Columns"][x];try{if(column.hasOwnProperty("Checkbox")){item[column.Label]={Checked:column.Checkbox.Checked,Unchecked:column.Checkbox.Unchecked,Value:eval("thisResource."+column.Expression),Action:checkState=>{if(contained){for(let z=0;z<resourceData["contained"].length;z++){if(thisResource["id"]===resourceData["contained"][z]["id"]){const newValue=checkState?column.Checkbox.Checked:column.Checkbox.Unchecked;eval("resourceData.contained[z]."+column.Expression+' = "'+newValue+'"');const SubFormsToUpdate=thisFormViewController.FormView.ParentView.SubFormsToUpdate;if(SubFormsToUpdate.indexOf(thisFormViewController)===-1)SubFormsToUpdate.push(thisFormViewController);break}}}else{}}}}else{let value=eval("thisResource."+column.Expression);if(value){if(WebClient.Utils.IsValidDate(value)){item[column.Label]=WebClient.CalendarUtils.GetFormattedDateTimeFromDB(value,this.dateFormat)}else if(column.LookupTable){if(column.LookupTable.hasOwnProperty(value)){item[column.Label]=column.LookupTable[value]}}else{item[column.Label]=WebClient.Utils.FormatValue(value)}}else{item[column.Label]="-"}}}catch(e){item[column.Label]="-"}}arrayResources.push(item)}this.buildBodyTable(arrayResources,this.Controller.FormViewController)}}}FormView.GridListPane=GridListPane})(FormView=ClientViews.FormView||(ClientViews.FormView={}))})(ClientViews=Efferent.ClientViews||(Efferent.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(e){var t;(function(e){var t;(function(e){class ResourceBag{}ResourceBag.FormViewCss=`.formViewContent{overflow-y:auto;margin-left:10px;margin-right:10px}@media(min-width: 600px){.formViewContent>div{width:80vw}}@media(min-width: 768px){.formViewContent>div{margin-left:0;margin-right:0}}@media(min-width: 801px){.formViewContent>div{width:60vw}}@media(min-width: 1025px){.formViewContent>div{width:50vw}}@media(min-width: 1025px){.formViewContent>div{width:50vw}}@media(min-width: 1281px){.formViewContent>div{width:min(540px,40vw)}}.tabsContainer .tabsHeader{display:flex}.tabsContainer .tabsHeader .tabName{padding:0px 10px;cursor:pointer;border-bottom:solid 4px}.tabsContainer .tabsHeader .activeTab{border-color:#f39c12}.tabsContainer .tabsHeader .inactiveTab{color:#95a5a6;border-color:rgba(0,0,0,0)}.tabsContainer .tabsBody{border:dotted 1px;padding:10px 0px;width:fit-content}.referencesContainer{position:relative;margin-bottom:15px}.referencesContainer .worklistPane{overflow:visible}.referencesContainer>h3{margin:0px 15px 10px 0px;font-size:16px}.referenceBox{padding:0 0 0 10px;display:flex;border-right:0px;border-top:0px;border-bottom:0px;flex-direction:column}.referenceBox h2{margin-right:5px !important}.referenceNoneLabel{margin:0px 0px 15px 15px}.multipleFieldsBox{padding:0 3px 0 3px;font-size:13px;outline:none;border:1px inset var(--color-border-input);border-radius:3px;overflow:hidden;min-height:24px;color:var(--font-color);box-shadow:0px 1px rgba(255,255,255,.75)}.multipleField{margin:3px 1px}.referenceButton{display:inline-block;padding:2px 10px;border-radius:3px;font-size:13px;cursor:pointer;text-align:center;color:#fff;background-color:#3498db;width:auto;height:24px}.StringAsReferenceContainer>.referenceButton+.referenceButton{margin-left:10px}.StringAsReferenceContainer button.referenceButton{margin-top:8px}@media(min-width: 600px){.StringAsReferenceContainer button.referenceButton{margin-top:0}}.marginLR{margin:0px 15px !important}.formViewLabel{margin-bottom:10px;display:flex;flex-direction:column}.formViewLabel.half input{flex-grow:0;min-width:240px}.formViewLabel.half .daterange_box input{min-width:auto}@media(min-width: 1025px){.formViewLabel{flex-direction:row}}.formViewLabel>div{display:flex;flex-grow:1}.formViewLabel .daterange_header span{font-size:13px !important}.formViewLabel input,.formViewLabel select{flex-grow:1}.formViewLabel h2{width:100px;min-width:100px;margin:0px 15px 0px 0px;font-size:16px;height:25px;line-height:25px;font-weight:normal;display:inline-block;text-overflow:ellipsis;overflow:hidden}.formViewLabel select{width:208px}.badInputNotice{height:0px;font-size:10px;color:#e74c3c;display:inline-block;margin-left:5px}.badInputNoticeReference{height:0px;font-size:10px;color:#e74c3c;transform:translate(12px, 21px);width:90px}.stringReference{width:320px !important}.StringAsReferenceContainer{display:none;margin-bottom:15px;flex-wrap:wrap}.StringAsReferenceContainer .breakline{display:block;width:100%;height:0}@media(min-width: 600px){.StringAsReferenceContainer .breakline{display:none}}.referenceRow{height:60px;overflow-y:hidden;margin-bottom:15px}.wrapButtons{display:flex;gap:5px}.selectResourceType{padding:0px 20px 0px 5px;border:0px;height:22px}.selectResourceType option{background-color:#fff;color:#2c3e50}.altSelectResourceBtn{display:none}`;e.ResourceBag=ResourceBag})(t=e.FormView||(e.FormView={}))})(t=e.ClientViews||(e.ClientViews={}))})(Efferent||(Efferent={}));var Efferent;(function(e){var t;(function(t){var r;(function(t){var r=e.Frontend.WebClient;class SubFormView extends r.SubView{constructor(t,s,n){super(t,s,"PlatformLanguageJson",n["ParentContext"]);this.Platform=s;this.ResourceBag=e.ClientViews.FormView.ResourceBag;this.formContainer=document.createElement("div");this.BodySection.appendChild(this.formContainer);const o=new e.ClientViews.FormView.FormView(this.formContainer,s,null,n,null,this);this.ResizeListeners.push(new r.ResizeStructure(this.constructor.name.toLowerCase(),this,this.constructor.name));this.OnWindowResize(0,0)}CloseSubView(){super.CloseSubView()}SetButtons(e,t){super.SetButtons(e,t)}OnWindowResize(e,t,r){var s=this.BodySection.clientWidth;this.formContainer.style.width=s+"px";this.formContainer.style.height="100%";super.OnWindowResize(e,t,r)}}t.SubFormView=SubFormView})(r=t.SubFormView||(t.SubFormView={}))})(t=e.ClientViews||(e.ClientViews={}))})(Efferent||(Efferent={}));